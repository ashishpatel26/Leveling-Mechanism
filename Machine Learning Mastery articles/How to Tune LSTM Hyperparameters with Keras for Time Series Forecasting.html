<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting - Machine Learning Mastery" property="og:title"/>
<meta content="Configuring neural networks is difficult because there is no good theory on how to do it. You must be systematic and explore different configurations both from a dynamical and an objective results point of a view to try to understand what is going on for a given predictive modeling problem. In this tutorial, you will …" property="og:description"/>
<meta content="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-04-12T05:00:16+11:00" property="article:published_time"/>
<meta content="2017-07-20T08:56:56+11:00" property="article:modified_time"/>
<meta content="2017-07-20T08:56:56+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-500-Epochs.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-500-Epochs.png" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="480" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/tune-lstm-hyperparameters-keras-time-series-forecasting\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/feed/" rel="alternate" title="Machine Learning Mastery » How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3900" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftune-lstm-hyperparameters-keras-time-series-forecasting%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftune-lstm-hyperparameters-keras-time-series-forecasting%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3900 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3900 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-04-12T05:00:16+1100">April 12, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftune-lstm-hyperparameters-keras-time-series-forecasting%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/&amp;summary=Configuring+neural+networks+is+difficult+because+there+is+no+good+theory+on+how+to+do+it.%0D%0A%0D%0AYou+mus..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/&amp;summary=Configuring+neural+networks+is+difficult+because+there+is+no+good+theory+on+how+to+do+it.%0D%0A%0D%0AYou+mus...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Configuring neural networks is difficult because there is no good theory on how to do it.</p>
<p>You must be systematic and explore different configurations both from a dynamical and an objective results point of a view to try to understand what is going on for a given predictive modeling problem.</p>
<p>In this tutorial, you will discover how you can explore how to configure an LSTM network on a time series forecasting problem.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to tune and interpret the results of the number of training epochs.</li>
<li>How to tune and interpret the results of the size of training batches.</li>
<li>How to tune and interpret the results of the number of neurons.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_3913" style="max-width: 650px"><img alt="How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting" class="size-full wp-image-3913" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/How-to-Tune-LSTM-Hyperparameters-with-Keras-for-Time-Series-Forecasting.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/How-to-Tune-LSTM-Hyperparameters-with-Keras-for-Time-Series-Forecasting.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/How-to-Tune-LSTM-Hyperparameters-with-Keras-for-Time-Series-Forecasting-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting<br/>Photo by <a href="https://www.flickr.com/photos/80502454@N00/6585205675/">David Saddler</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is broken down into 6 parts; they are:</p>
<ol>
<li>Shampoo Sales Dataset</li>
<li>Experimental Test Harness</li>
<li>Tuning the Number of Epochs</li>
<li>Tuning the Batch Size</li>
<li>Tuning the Number of Neurons</li>
<li>Summary of Results</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this example.</p>
<p>This tutorial assumes you have Keras v2.0 or higher installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy and Matplotlib installed.</p>
<p>If you need help setting up your Python environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Shampoo Sales Dataset</h2>
<p>This dataset describes the monthly number of sales of shampoo over a 3-year period.</p>
<p>The units are a sales count and there are 36 observations. The original dataset is credited to Makridakis, Wheelwright, and Hyndman (1998).</p>
<p><a href="https://datamarket.com/data/set/22r0/sales-of-shampoo-over-a-three-year-period">You can download and learn more about the dataset here</a>.</p>
<p>The example below loads and creates a plot of the loaded dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0914357224977" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from pandas import datetime
from matplotlib import pyplot
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# summarize first few rows
print(series.head())
# line plot
series.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-10">10</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0914357224977-12">12</div><div class="crayon-num" data-line="crayon-5a658c7df0914357224977-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0914357224977-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-4"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-6"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-8"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-9"><span class="crayon-p"># summarize first few rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-11"><span class="crayon-p"># line plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0914357224977-12"><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0914357224977-13"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Running the example loads the dataset as a Pandas Series and prints the first 5 rows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0920122025144" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01 266.0
1901-02-01 145.9
1901-03-01 183.1
1901-04-01 119.3
1901-05-01 180.3
Name: Sales, dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0920122025144-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0920122025144-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0920122025144-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0920122025144-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0920122025144-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0920122025144-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0920122025144-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0920122025144-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0920122025144-2">1901-01-01 266.0</div><div class="crayon-line" id="crayon-5a658c7df0920122025144-3">1901-02-01 145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0920122025144-4">1901-03-01 183.1</div><div class="crayon-line" id="crayon-5a658c7df0920122025144-5">1901-04-01 119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0920122025144-6">1901-05-01 180.3</div><div class="crayon-line" id="crayon-5a658c7df0920122025144-7">Name: Sales, dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the series is then created showing a clear increasing trend.</p>
<div class="wp-caption aligncenter" id="attachment_3901" style="max-width: 650px"><img alt="Line Plot of Shampoo Sales Dataset" class="size-full wp-image-3901" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Shampoo Sales Dataset</p></div>
<p>Next, we will take a look at the LSTM configuration and test harness used in the experiment.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Experimental Test Harness</h2>
<p>This section describes the test harness used in this tutorial.</p>
<h3>Data Split</h3>
<p>We will split the Shampoo Sales dataset into two parts: a training and a test set.</p>
<p>The first two years of data will be taken for the training dataset and the remaining one year of data will be used for the test set.</p>
<p>Models will be developed using the training dataset and will make predictions on the test dataset.</p>
<p>The persistence forecast (naive forecast) on the test dataset achieves an error of 136.761 monthly shampoo sales. This provides a lower acceptable bound of performance on the test set.</p>
<h3>Model Evaluation</h3>
<p>A rolling-forecast scenario will be used, also called walk-forward model validation.</p>
<p>Each time step of the test dataset will be walked one at a time. A model will be used to make a forecast for the time step, then the actual expected value from the test set will be taken and made available to the model for the forecast on the next time step.</p>
<p>This mimics a real-world scenario where new Shampoo Sales observations would be available each month and used in the forecasting of the following month.</p>
<p>This will be simulated by the structure of the train and test datasets. We will make all of the forecasts in a one-shot method.</p>
<p>All forecasts on the test dataset will be collected and an error score calculated to summarize the skill of the model. The root mean squared error (RMSE) will be used as it punishes large errors and results in a score that is in the same units as the forecast data, namely monthly shampoo sales.</p>
<h3>Data Preparation</h3>
<p>Before we can fit an LSTM model to the dataset, we must transform the data.</p>
<p>The following three data transforms are performed on the dataset prior to fitting a model and making a forecast.</p>
<ol>
<li>Transform the time series data so that it is stationary. Specifically, a lag=1 differencing to remove the increasing trend in the data.</li>
<li>Transform the time series into a supervised learning problem. Specifically, the organization of data into input and output patterns where the observation at the previous time step is used as an input to forecast the observation at the current time time step</li>
<li>Transform the observations to have a specific scale. Specifically, to rescale the data to values between -1 and 1 to meet the default hyperbolic tangent activation function of the LSTM model.</li>
</ol>
<p>These transforms are inverted on forecasts to return them into their original scale before calculating and error score.</p>
<h3>Experimental Runs</h3>
<p>Each experimental scenario will be run 10 times.</p>
<p>The reason for this is that the random initial conditions for an LSTM network can result in very different results each time a given configuration is trained.</p>
<p>A diagnostic approach will be used to investigate model configurations. This is where line plots of model skill over time (training iterations called epochs) will be created and studied for insight into how a given configuration performs and how it may be adjusted to elicit better performance.</p>
<p>The model will be evaluated on both the train and the test datasets at the end of each epoch and the RMSE scores saved.</p>
<p>The train and test RMSE scores at the end of each scenario are printed to give an indication of progress.</p>
<p>The series of train and test RMSE scores are plotted at the end of a run as a line plot. Train scores are colored blue and test scores are colored orange.</p>
<p>Let’s dive into the results.</p>
<h2>Tuning the Number of Epochs</h2>
<p>The first LSTM parameter we will look at tuning is the number of training epochs.</p>
<p>The model will use a batch size of 4, and a single neuron. We will explore the effect of training this configuration for different numbers of training epochs.</p>
<h3>Diagnostic of 500 Epochs</h3>
<p>The complete code listing for this diagnostic is listed below.</p>
<p>The code is reasonably well commented and should be easy to follow. This code will be the basis for all future experiments in this tutorial and only the changes made in each subsequent experiment will be listed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0925497898611" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
import matplotlib
# be able to save images on server
matplotlib.use('Agg')
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df = df.drop(0)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, yhat):
	new_row = [x for x in X] + [yhat]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# evaluate the model on a dataset, returns RMSE in transformed units
def evaluate(model, raw_data, scaled_dataset, scaler, offset, batch_size):
	# separate
	X, y = scaled_dataset[:,0:-1], scaled_dataset[:,-1]
	# reshape
	reshaped = X.reshape(len(X), 1, 1)
	# forecast dataset
	output = model.predict(reshaped, batch_size=batch_size)
	# invert data transforms on forecast
	predictions = list()
	for i in range(len(output)):
		yhat = output[i,0]
		# invert scaling
		yhat = invert_scale(scaler, X[i], yhat)
		# invert differencing
		yhat = yhat + raw_data[i]
		# store forecast
		predictions.append(yhat)
	# report performance
	rmse = sqrt(mean_squared_error(raw_data[1:], predictions))
	return rmse

# fit an LSTM network to training data
def fit_lstm(train, test, raw, scaler, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# prepare model
	model = Sequential()
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	# fit model
	train_rmse, test_rmse = list(), list()
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		model.reset_states()
		# evaluate model on train data
		raw_train = raw[-(len(train)+len(test)+1):-len(test)]
		train_rmse.append(evaluate(model, raw_train, train, scaler, 0, batch_size))
		model.reset_states()
		# evaluate model on test data
		raw_test = raw[-(len(test)+1):]
		test_rmse.append(evaluate(model, raw_test, test, scaler, 0, batch_size))
		model.reset_states()
	history = DataFrame()
	history['train'], history['test'] = train_rmse, test_rmse
	return history

# run diagnostic experiments
def run():
	# load dataset
	series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, 1)
	supervised_values = supervised.values
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# fit and evaluate model
	train_trimmed = train_scaled[2:, :]
	# config
	repeats = 10
	n_batch = 4
	n_epochs = 500
	n_neurons = 1
	# run diagnostic tests
	for i in range(repeats):
		history = fit_lstm(train_trimmed, test_scaled, raw_values, scaler, n_batch, n_epochs, n_neurons)
		pyplot.plot(history['train'], color='blue')
		pyplot.plot(history['test'], color='orange')
		print('%d) TrainRMSE=%f, TestRMSE=%f' % (i, history['train'].iloc[-1], history['test'].iloc[-1]))
	pyplot.savefig('epochs_diagnostic.png')

# entry point
run()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-10">10</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-12">12</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-14">14</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-16">16</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-18">18</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-20">20</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-22">22</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-24">24</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-26">26</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-28">28</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-30">30</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-32">32</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-34">34</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-36">36</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-38">38</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-40">40</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-42">42</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-44">44</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-46">46</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-48">48</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-50">50</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-52">52</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-54">54</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-56">56</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-58">58</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-60">60</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-62">62</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-64">64</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-66">66</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-68">68</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-70">70</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-72">72</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-74">74</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-76">76</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-78">78</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-80">80</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-82">82</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-84">84</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-86">86</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-88">88</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-90">90</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-92">92</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-94">94</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-96">96</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-98">98</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-100">100</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-102">102</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-104">104</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-106">106</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-108">108</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-110">110</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-112">112</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-114">114</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-116">116</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-118">118</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-120">120</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-122">122</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-124">124</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-126">126</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-128">128</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-130">130</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-132">132</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-134">134</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-136">136</div><div class="crayon-num" data-line="crayon-5a658c7df0925497898611-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0925497898611-138">138</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0925497898611-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-11"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-12"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-13"><span class="crayon-p"># be able to save images on server</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-14"><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-s">'Agg'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-15"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-16"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-18"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-19"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-22"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-23"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-24"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-25"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-26"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-27"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-28"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-30"> </div><div class="crayon-line" id="crayon-5a658c7df0925497898611-31"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-32"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-33"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-35"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-36"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-38"> </div><div class="crayon-line" id="crayon-5a658c7df0925497898611-39"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-40"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-41"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-42"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-43"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-44"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-45"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-46"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-47"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-48"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-49"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-50"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-51"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-52"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-53"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-54"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yhat</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-55"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-56"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-57"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-58"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-59"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-60"><span class="crayon-p"># evaluate the model on a dataset, returns RMSE in transformed units</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-61"><span class="crayon-e">def </span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">offset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-62"><span class="crayon-h"> </span><span class="crayon-p"># separate</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-63"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaled_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-64"><span class="crayon-h"> </span><span class="crayon-p"># reshape</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-65"><span class="crayon-h"> </span><span class="crayon-v">reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-66"><span class="crayon-h"> </span><span class="crayon-p"># forecast dataset</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-67"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-68"><span class="crayon-h"> </span><span class="crayon-p"># invert data transforms on forecast</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-69"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-70"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-71"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-72"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-73"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-74"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-75"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">raw_data</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-76"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-77"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-78"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-79"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-82"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-83"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-84"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-85"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-86"><span class="crayon-h"> </span><span class="crayon-p"># prepare model</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-87"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-88"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-89"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-90"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-91"><span class="crayon-h"> </span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-92"><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-93"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-94"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-95"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-96"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model on train data</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-97"><span class="crayon-h"> </span><span class="crayon-v">raw_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-98"><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-99"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-100"><span class="crayon-h"> </span><span class="crayon-p"># evaluate model on test data</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-101"><span class="crayon-h"> </span><span class="crayon-v">raw_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-102"><span class="crayon-h"> </span><span class="crayon-v">test_rmse</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-103"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-104"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-105"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_rmse</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">test_rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-106"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">history</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-107"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-108"><span class="crayon-p"># run diagnostic experiments</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-109"><span class="crayon-e">def </span><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-110"><span class="crayon-h"> </span><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-111"><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-112"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-113"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-114"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-115"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-116"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-117"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-118"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-119"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-120"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-121"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-122"><span class="crayon-h"> </span><span class="crayon-p"># fit and evaluate model</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-123"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-124"><span class="crayon-h"> </span><span class="crayon-p"># config</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-125"><span class="crayon-h"> </span><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-126"><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-127"><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">500</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-128"><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-129"><span class="crayon-h"> </span><span class="crayon-p"># run diagnostic tests</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-130"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-131"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-132"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'blue'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-133"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'orange'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-134"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) TrainRMSE=%f, TestRMSE=%f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'train'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-v">iloc</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0925497898611-135"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'epochs_diagnostic.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-136"> </div><div class="crayon-line" id="crayon-5a658c7df0925497898611-137"><span class="crayon-p"># entry point</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0925497898611-138"><span class="crayon-e">run</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0115 seconds] -->
<p>Running the experiment prints the RMSE for the train and the test sets at the end of each of the 10 experimental runs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df092d731899351" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=63.495594, TestRMSE=113.472643
1) TrainRMSE=60.446307, TestRMSE=100.147470
2) TrainRMSE=59.879681, TestRMSE=95.112331
3) TrainRMSE=66.115269, TestRMSE=106.444401
4) TrainRMSE=61.878702, TestRMSE=86.572920
5) TrainRMSE=73.519382, TestRMSE=103.551694
6) TrainRMSE=64.407033, TestRMSE=98.849227
7) TrainRMSE=72.684834, TestRMSE=98.499976
8) TrainRMSE=77.593773, TestRMSE=124.404747
9) TrainRMSE=71.749335, TestRMSE=126.396615</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df092d731899351-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df092d731899351-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df092d731899351-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df092d731899351-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df092d731899351-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df092d731899351-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df092d731899351-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df092d731899351-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df092d731899351-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df092d731899351-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df092d731899351-1">0) TrainRMSE=63.495594, TestRMSE=113.472643</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df092d731899351-2">1) TrainRMSE=60.446307, TestRMSE=100.147470</div><div class="crayon-line" id="crayon-5a658c7df092d731899351-3">2) TrainRMSE=59.879681, TestRMSE=95.112331</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df092d731899351-4">3) TrainRMSE=66.115269, TestRMSE=106.444401</div><div class="crayon-line" id="crayon-5a658c7df092d731899351-5">4) TrainRMSE=61.878702, TestRMSE=86.572920</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df092d731899351-6">5) TrainRMSE=73.519382, TestRMSE=103.551694</div><div class="crayon-line" id="crayon-5a658c7df092d731899351-7">6) TrainRMSE=64.407033, TestRMSE=98.849227</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df092d731899351-8">7) TrainRMSE=72.684834, TestRMSE=98.499976</div><div class="crayon-line" id="crayon-5a658c7df092d731899351-9">8) TrainRMSE=77.593773, TestRMSE=124.404747</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df092d731899351-10">9) TrainRMSE=71.749335, TestRMSE=126.396615</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the series of RMSE scores on the train and test sets after each training epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3902" style="max-width: 650px"><img alt="Diagnostic Results with 500 Epochs" class="size-full wp-image-3902" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-500-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-500-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-500-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 500 Epochs</p></div>
<p>The results clearly show a downward trend in RMSE over the training epochs for almost all of the experimental runs.</p>
<p>This is a good sign, as it shows the model is learning the problem and has some predictive skill. In fact, all of the final test scores are below the error of a simple persistence model (naive forecast) that achieves an RMSE of 136.761 on this problem.</p>
<p>The results suggest that more training epochs will result in a more skillful model.</p>
<p>Let’s try doubling the number of epochs from 500 to 1000.</p>
<h3>Diagnostic of 1000 Epochs</h3>
<p>In this section, we use the same experimental setup and fit the model over 1000 training epochs.</p>
<p>Specifically, the <em>n_epochs</em> parameter is set to <em>1000</em> in the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0932826908680" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_epochs = 1000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0932826908680-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0932826908680-1"><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running the example prints the RMSE for the train and test sets from the final epoch.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0935765755115" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=69.242394, TestRMSE=90.832025
1) TrainRMSE=65.445810, TestRMSE=113.013681
2) TrainRMSE=57.949335, TestRMSE=103.727228
3) TrainRMSE=61.808586, TestRMSE=89.071392
4) TrainRMSE=68.127167, TestRMSE=88.122807
5) TrainRMSE=61.030678, TestRMSE=93.526607
6) TrainRMSE=61.144466, TestRMSE=97.963895
7) TrainRMSE=59.922150, TestRMSE=94.291120
8) TrainRMSE=60.170052, TestRMSE=90.076229
9) TrainRMSE=62.232470, TestRMSE=98.174839</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0935765755115-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0935765755115-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0935765755115-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0935765755115-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0935765755115-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0935765755115-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0935765755115-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0935765755115-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0935765755115-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0935765755115-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0935765755115-1">0) TrainRMSE=69.242394, TestRMSE=90.832025</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0935765755115-2">1) TrainRMSE=65.445810, TestRMSE=113.013681</div><div class="crayon-line" id="crayon-5a658c7df0935765755115-3">2) TrainRMSE=57.949335, TestRMSE=103.727228</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0935765755115-4">3) TrainRMSE=61.808586, TestRMSE=89.071392</div><div class="crayon-line" id="crayon-5a658c7df0935765755115-5">4) TrainRMSE=68.127167, TestRMSE=88.122807</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0935765755115-6">5) TrainRMSE=61.030678, TestRMSE=93.526607</div><div class="crayon-line" id="crayon-5a658c7df0935765755115-7">6) TrainRMSE=61.144466, TestRMSE=97.963895</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0935765755115-8">7) TrainRMSE=59.922150, TestRMSE=94.291120</div><div class="crayon-line" id="crayon-5a658c7df0935765755115-9">8) TrainRMSE=60.170052, TestRMSE=90.076229</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0935765755115-10">9) TrainRMSE=62.232470, TestRMSE=98.174839</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3903" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs" class="size-full wp-image-3903" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs</p></div>
<p>We can see that the downward trend of model error does continue and appears to slow.</p>
<p>The lines for the train and test cases become more horizontal, but still generally show a downward trend, although at a lower rate of change. Some examples of test error show a possible inflection point around 600 epochs and may show a rising trend.</p>
<p>It is worth extending the epochs further. We are interested in the average performance continuing to improve on the test set and this may continue.</p>
<p>Let’s try doubling the number of epochs from 1000 to 2000.</p>
<h3>Diagnostic of 2000 Epochs</h3>
<p>In this section, we use the same experimental setup and fit the model over 2000 training epochs.</p>
<p>Specifically, the <em>n_epochs</em> parameter is set to 2000 in the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0938214471513" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_epochs = 2000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0938214471513-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0938214471513-1"><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2000</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running the example prints the RMSE for the train and test sets from the final epoch.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df093b921279958" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=67.292970, TestRMSE=83.096856
1) TrainRMSE=55.098951, TestRMSE=104.211509
2) TrainRMSE=69.237206, TestRMSE=117.392007
3) TrainRMSE=61.319941, TestRMSE=115.868142
4) TrainRMSE=60.147575, TestRMSE=87.793270
5) TrainRMSE=59.424241, TestRMSE=99.000790
6) TrainRMSE=66.990082, TestRMSE=80.490660
7) TrainRMSE=56.467012, TestRMSE=97.799062
8) TrainRMSE=60.386380, TestRMSE=103.810569
9) TrainRMSE=58.250862, TestRMSE=86.212094</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df093b921279958-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df093b921279958-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df093b921279958-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df093b921279958-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df093b921279958-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df093b921279958-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df093b921279958-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df093b921279958-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df093b921279958-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df093b921279958-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df093b921279958-1">0) TrainRMSE=67.292970, TestRMSE=83.096856</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df093b921279958-2">1) TrainRMSE=55.098951, TestRMSE=104.211509</div><div class="crayon-line" id="crayon-5a658c7df093b921279958-3">2) TrainRMSE=69.237206, TestRMSE=117.392007</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df093b921279958-4">3) TrainRMSE=61.319941, TestRMSE=115.868142</div><div class="crayon-line" id="crayon-5a658c7df093b921279958-5">4) TrainRMSE=60.147575, TestRMSE=87.793270</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df093b921279958-6">5) TrainRMSE=59.424241, TestRMSE=99.000790</div><div class="crayon-line" id="crayon-5a658c7df093b921279958-7">6) TrainRMSE=66.990082, TestRMSE=80.490660</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df093b921279958-8">7) TrainRMSE=56.467012, TestRMSE=97.799062</div><div class="crayon-line" id="crayon-5a658c7df093b921279958-9">8) TrainRMSE=60.386380, TestRMSE=103.810569</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df093b921279958-10">9) TrainRMSE=58.250862, TestRMSE=86.212094</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3904" style="max-width: 650px"><img alt="Diagnostic Results with 2000 Epochs" class="size-full wp-image-3904" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-2000-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-2000-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-2000-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 2000 Epochs</p></div>
<p>As one might have guessed, the downward trend in error continues over the additional 1000 epochs on both the train and test datasets.</p>
<p>Of note, about half of the cases continue to decrease in error all the way to the end of the run, whereas the rest show signs of an increasing trend.</p>
<p>The increasing trend is a sign of overfitting. This is when the model overfits the training dataset at the cost of worse performance on the test dataset. It is exemplified by continued improvements on the training dataset and improvements followed by an inflection point and worsting skill in the test dataset. A little less than half of the runs show the beginnings of this type of pattern on the test dataset.</p>
<p>Nevertheless, the final epoch results on the test dataset are very good. If there is a chance we can see further gains by even longer training, we must explore it.</p>
<p>Let’s try doubling the number of epochs from 2000 to 4000.</p>
<h3>Diagnostic of 4000 Epochs</h3>
<p>In this section, we use the same experimental setup and fit the model over 4000 training epochs.</p>
<p>Specifically, the <em>n_epochs</em> parameter is set to 4000 in the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df093f559554661" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_epochs = 4000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df093f559554661-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df093f559554661-1"><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4000</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running the example prints the RMSE for the train and test sets from the final epoch.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0941703005098" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=58.889277, TestRMSE=99.121765
1) TrainRMSE=56.839065, TestRMSE=95.144846
2) TrainRMSE=58.522271, TestRMSE=87.671309
3) TrainRMSE=53.873962, TestRMSE=113.920076
4) TrainRMSE=66.386299, TestRMSE=77.523432
5) TrainRMSE=58.996230, TestRMSE=136.367014
6) TrainRMSE=55.725800, TestRMSE=113.206607
7) TrainRMSE=57.334604, TestRMSE=90.814642
8) TrainRMSE=54.593069, TestRMSE=105.724825
9) TrainRMSE=56.678498, TestRMSE=83.082262</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0941703005098-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0941703005098-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0941703005098-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0941703005098-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0941703005098-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0941703005098-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0941703005098-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0941703005098-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0941703005098-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0941703005098-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0941703005098-1">0) TrainRMSE=58.889277, TestRMSE=99.121765</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0941703005098-2">1) TrainRMSE=56.839065, TestRMSE=95.144846</div><div class="crayon-line" id="crayon-5a658c7df0941703005098-3">2) TrainRMSE=58.522271, TestRMSE=87.671309</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0941703005098-4">3) TrainRMSE=53.873962, TestRMSE=113.920076</div><div class="crayon-line" id="crayon-5a658c7df0941703005098-5">4) TrainRMSE=66.386299, TestRMSE=77.523432</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0941703005098-6">5) TrainRMSE=58.996230, TestRMSE=136.367014</div><div class="crayon-line" id="crayon-5a658c7df0941703005098-7">6) TrainRMSE=55.725800, TestRMSE=113.206607</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0941703005098-8">7) TrainRMSE=57.334604, TestRMSE=90.814642</div><div class="crayon-line" id="crayon-5a658c7df0941703005098-9">8) TrainRMSE=54.593069, TestRMSE=105.724825</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0941703005098-10">9) TrainRMSE=56.678498, TestRMSE=83.082262</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3905" style="max-width: 650px"><img alt="Diagnostic Results with 4000 Epochs" class="size-full wp-image-3905" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-4000-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-4000-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-4000-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 4000 Epochs</p></div>
<p>A similar pattern continues.</p>
<p>There is a general trend of improving performance, even over the 4000 epochs. There is one case of severe overfitting where test error rises sharply.</p>
<p>Again, most runs end with a “good” (better than persistence) final test error.</p>
<h3>Summary of Results</h3>
<p>The diagnostic runs above are helpful to explore the dynamical behavior of the model, but fall short of an objective and comparable mean performance.</p>
<p>We can address this by repeating the same experiments and calculating and comparing summary statistics for each configuration. In this case, 30 runs were completed of the epoch values 500, 1000, 2000, 4000, and 6000.</p>
<p>The idea is to compare the configurations using summary statistics over a larger number of runs and see exactly which of the configurations might perform better on average.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0945369398491" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
import matplotlib
# be able to save images on server
matplotlib.use('Agg')
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df = df.drop(0)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, yhat):
	new_row = [x for x in X] + [yhat]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# fit an LSTM network to training data
def fit_lstm(train, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	model = Sequential()
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		model.reset_states()
	return model

# run a repeated experiment
def experiment(repeats, series, epochs):
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, 1)
	supervised_values = supervised.values
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# run experiment
	error_scores = list()
	for r in range(repeats):
		# fit the model
		batch_size = 4
		train_trimmed = train_scaled[2:, :]
		lstm_model = fit_lstm(train_trimmed, batch_size, epochs, 1)
		# forecast the entire training dataset to build up state for forecasting
		train_reshaped = train_trimmed[:, 0].reshape(len(train_trimmed), 1, 1)
		lstm_model.predict(train_reshaped, batch_size=batch_size)
		# forecast test dataset
		test_reshaped = test_scaled[:,0:-1]
		test_reshaped = test_reshaped.reshape(len(test_reshaped), 1, 1)
		output = lstm_model.predict(test_reshaped, batch_size=batch_size)
		predictions = list()
		for i in range(len(output)):
			yhat = output[i,0]
			X = test_scaled[i, 0:-1]
			# invert scaling
			yhat = invert_scale(scaler, X, yhat)
			# invert differencing
			yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
			# store forecast
			predictions.append(yhat)
		# report performance
		rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
		print('%d) Test RMSE: %.3f' % (r+1, rmse))
		error_scores.append(rmse)
	return error_scores


# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
# vary training epochs
epochs = [500, 1000, 2000, 4000, 6000]
for e in epochs:
	results[str(e)] = experiment(repeats, series, e)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_epochs.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-10">10</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-12">12</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-14">14</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-16">16</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-18">18</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-20">20</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-22">22</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-24">24</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-26">26</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-28">28</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-30">30</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-32">32</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-34">34</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-36">36</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-38">38</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-40">40</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-42">42</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-44">44</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-46">46</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-48">48</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-50">50</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-52">52</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-54">54</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-56">56</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-58">58</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-60">60</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-62">62</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-64">64</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-66">66</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-68">68</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-70">70</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-72">72</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-74">74</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-76">76</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-78">78</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-80">80</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-82">82</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-84">84</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-86">86</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-88">88</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-90">90</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-92">92</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-94">94</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-96">96</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-98">98</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-100">100</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-102">102</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-104">104</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-106">106</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-108">108</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-110">110</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-112">112</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-114">114</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-116">116</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-118">118</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-120">120</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-122">122</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-124">124</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-126">126</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-128">128</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-130">130</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0945369398491-132">132</div><div class="crayon-num" data-line="crayon-5a658c7df0945369398491-133">133</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0945369398491-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-11"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-12"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-13"><span class="crayon-p"># be able to save images on server</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-14"><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-s">'Agg'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-15"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-16"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-18"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-19"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-22"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-23"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-24"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-25"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-26"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-27"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-28"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-30"> </div><div class="crayon-line" id="crayon-5a658c7df0945369398491-31"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-32"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-33"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-35"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-36"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-38"> </div><div class="crayon-line" id="crayon-5a658c7df0945369398491-39"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-40"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-42"> </div><div class="crayon-line" id="crayon-5a658c7df0945369398491-43"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-44"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-45"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-46"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-47"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-48"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-49"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-50"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-51"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-52"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-53"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-54"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-56"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-57"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-58"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">yhat</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-59"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-60"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-61"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-64"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-65"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-66"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-67"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-69"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-70"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-71"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-72"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-73"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-74"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-75"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-76"> </div><div class="crayon-line" id="crayon-5a658c7df0945369398491-77"><span class="crayon-p"># run a repeated experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-78"><span class="crayon-e">def </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-79"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-80"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-81"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-82"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-83"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-84"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-85"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-86"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-87"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-88"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-89"><span class="crayon-h"> </span><span class="crayon-p"># run experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-90"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-91"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-92"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-93"><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-94"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-95"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-96"><span class="crayon-h"> </span><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-97"><span class="crayon-h"> </span><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-98"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-99"><span class="crayon-h"> </span><span class="crayon-p"># forecast test dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-100"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-101"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-102"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-103"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-104"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-105"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-106"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-107"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-108"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-109"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-110"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-111"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-112"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-113"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-114"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-115"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-116"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-117"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error_scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-118"> </div><div class="crayon-line" id="crayon-5a658c7df0945369398491-119"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-120"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-121"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-122"><span class="crayon-p"># experiment</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-123"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-124"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-125"><span class="crayon-p"># vary training epochs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-126"><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6000</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-127"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">e</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-128"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-129"><span class="crayon-p"># summarize results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-130"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-131"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0945369398491-132"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df0945369398491-133"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_epochs.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0107 seconds] -->
<p>Running the code first prints summary statistics for each of the 5 configurations. Notably, this includes the mean and standard deviations of the RMSE scores from each population of results.</p>
<p>The mean gives an idea of the average expected performance of a configuration, whereas the standard deviation gives an idea of the variance. The min and max RMSE scores also give an idea of the range of possible best and worst case examples that might be expected.</p>
<p>Looking at just the mean RMSE scores, the results suggest that an epoch configured to 1000 may be better. The results also suggest further investigations may be warranted of epoch values between 1000 and 2000.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df094b638479185" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
              500        1000        2000        4000        6000
count   30.000000   30.000000   30.000000   30.000000   30.000000
mean   109.439203  104.566259  107.882390  116.339792  127.618305
std     14.874031   19.097098   22.083335   21.590424   24.866763
min     87.747708   81.621783   75.327883   77.399968   90.512409
25%     96.484568   87.686776   86.753694  102.127451  105.861881
50%    110.891939   98.942264  116.264027  121.898248  125.273050
75%    121.067498  119.248849  125.518589  130.107772  150.832313
max    138.879278  139.928055  146.840997  157.026562  166.111151</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df094b638479185-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df094b638479185-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df094b638479185-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df094b638479185-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df094b638479185-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df094b638479185-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df094b638479185-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df094b638479185-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df094b638479185-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df094b638479185-1">              500        1000        2000        4000        6000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df094b638479185-2">count   30.000000   30.000000   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5a658c7df094b638479185-3">mean   109.439203  104.566259  107.882390  116.339792  127.618305</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df094b638479185-4">std     14.874031   19.097098   22.083335   21.590424   24.866763</div><div class="crayon-line" id="crayon-5a658c7df094b638479185-5">min     87.747708   81.621783   75.327883   77.399968   90.512409</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df094b638479185-6">25%     96.484568   87.686776   86.753694  102.127451  105.861881</div><div class="crayon-line" id="crayon-5a658c7df094b638479185-7">50%    110.891939   98.942264  116.264027  121.898248  125.273050</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df094b638479185-8">75%    121.067498  119.248849  125.518589  130.107772  150.832313</div><div class="crayon-line" id="crayon-5a658c7df094b638479185-9">max    138.879278  139.928055  146.840997  157.026562  166.111151</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The distributions are also shown on a box and whisker plot. This is helpful to see how the distributions directly compare.</p>
<p>The green line shows the median and the box shows the 25th and 75th percentiles, or the middle 50% of the data. This comparison also shows that the choice of setting epochs to 1000 is better than the tested alternatives. It also shows that the best possible performance may be achieved with epochs of 2000 or 4000, at the cost of worse performance on average.</p>
<div class="wp-caption aligncenter" id="attachment_3906" style="max-width: 650px"><img alt="Box and Whisker Plot Summarizing Epoch Results" class="size-full wp-image-3906" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Epoch-Results.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Epoch-Results.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Epoch-Results-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot Summarizing Epoch Results</p></div>
<p>Next, we will look at the effect of batch size.</p>
<h2>Tuning the Batch Size</h2>
<p>Batch size controls how often to update the weights of the network.</p>
<p>Importantly in Keras, the batch size must be a factor of the size of the test and the training dataset.</p>
<p>In the previous section exploring the number of training epochs, the batch size was fixed at 4, which cleanly divides into the test dataset (with the size 12) and in a truncated version of the test dataset (with the size of 20).</p>
<p>In this section, we will explore the effect of varying the batch size. We will hold the number of training epochs constant at 1000.</p>
<h3>Diagnostic of 1000 Epochs and Batch Size of 4</h3>
<p>As a reminder, the previous section evaluated a batch size of 4 in the second experiment with a number of epochs of 1000.</p>
<p>The results showed a downward trend in error that continued for most runs all the way to the final training epoch.</p>
<div class="wp-caption aligncenter" id="attachment_3903" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs" class="size-full wp-image-3903" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs</p></div>
<h3>Diagnostic of 1000 Epochs and Batch Size of 2</h3>
<p>In this section, we look at halving the batch size from 4 to 2.</p>
<p>This change is made to the <em>n_batch</em> parameter in the <em>run()</em> function; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0950450098746" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_batch = 2</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0950450098746-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0950450098746-1"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running the example shows the same general trend in performance as a batch size of 4, perhaps with a higher RMSE on the final epoch.</p>
<p>The runs may show the behavior of stabilizing the RMES sooner rather than seeming to continue the downward trend.</p>
<p>The RSME scores from the final exposure of each run are listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0953300076613" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=63.510219, TestRMSE=115.855819
1) TrainRMSE=58.336003, TestRMSE=97.954374
2) TrainRMSE=69.163685, TestRMSE=96.721446
3) TrainRMSE=65.201764, TestRMSE=110.104828
4) TrainRMSE=62.146057, TestRMSE=112.153553
5) TrainRMSE=58.253952, TestRMSE=98.442715
6) TrainRMSE=67.306530, TestRMSE=108.132021
7) TrainRMSE=63.545292, TestRMSE=102.821356
8) TrainRMSE=61.693847, TestRMSE=99.859398
9) TrainRMSE=58.348250, TestRMSE=99.682159</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0953300076613-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0953300076613-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0953300076613-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0953300076613-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0953300076613-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0953300076613-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0953300076613-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0953300076613-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0953300076613-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0953300076613-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0953300076613-1">0) TrainRMSE=63.510219, TestRMSE=115.855819</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0953300076613-2">1) TrainRMSE=58.336003, TestRMSE=97.954374</div><div class="crayon-line" id="crayon-5a658c7df0953300076613-3">2) TrainRMSE=69.163685, TestRMSE=96.721446</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0953300076613-4">3) TrainRMSE=65.201764, TestRMSE=110.104828</div><div class="crayon-line" id="crayon-5a658c7df0953300076613-5">4) TrainRMSE=62.146057, TestRMSE=112.153553</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0953300076613-6">5) TrainRMSE=58.253952, TestRMSE=98.442715</div><div class="crayon-line" id="crayon-5a658c7df0953300076613-7">6) TrainRMSE=67.306530, TestRMSE=108.132021</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0953300076613-8">7) TrainRMSE=63.545292, TestRMSE=102.821356</div><div class="crayon-line" id="crayon-5a658c7df0953300076613-9">8) TrainRMSE=61.693847, TestRMSE=99.859398</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0953300076613-10">9) TrainRMSE=58.348250, TestRMSE=99.682159</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3907" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs and Batch Size of 2" class="size-full wp-image-3907" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-2.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-2.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-2-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs and Batch Size of 2</p></div>
<p>Let’s try having the batch size again.</p>
<h3>Diagnostic of 1000 Epochs and Batch Size of 1</h3>
<p>A batch size of 1 is technically performing online learning.</p>
<p>That is where the network is updated after each training pattern. This can be contrasted with batch learning, where the weights are only updated at the end of each epoch.</p>
<p>We can change the <em>n_batch</em> parameter in the <em>run()</em> function; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0957944306246" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_batch = 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0957944306246-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0957944306246-1"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Again, running the example prints the RMSE scores from the final epoch of each run.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0959696146745" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=60.349798, TestRMSE=100.182293
1) TrainRMSE=62.624106, TestRMSE=95.716070
2) TrainRMSE=64.091859, TestRMSE=98.598958
3) TrainRMSE=59.929993, TestRMSE=96.139427
4) TrainRMSE=59.890593, TestRMSE=94.173619
5) TrainRMSE=55.944968, TestRMSE=106.644275
6) TrainRMSE=60.570245, TestRMSE=99.981562
7) TrainRMSE=56.704995, TestRMSE=111.404182
8) TrainRMSE=59.909065, TestRMSE=90.238473
9) TrainRMSE=60.863807, TestRMSE=105.331214</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0959696146745-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0959696146745-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0959696146745-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0959696146745-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0959696146745-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0959696146745-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0959696146745-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0959696146745-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0959696146745-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0959696146745-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0959696146745-1">0) TrainRMSE=60.349798, TestRMSE=100.182293</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0959696146745-2">1) TrainRMSE=62.624106, TestRMSE=95.716070</div><div class="crayon-line" id="crayon-5a658c7df0959696146745-3">2) TrainRMSE=64.091859, TestRMSE=98.598958</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0959696146745-4">3) TrainRMSE=59.929993, TestRMSE=96.139427</div><div class="crayon-line" id="crayon-5a658c7df0959696146745-5">4) TrainRMSE=59.890593, TestRMSE=94.173619</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0959696146745-6">5) TrainRMSE=55.944968, TestRMSE=106.644275</div><div class="crayon-line" id="crayon-5a658c7df0959696146745-7">6) TrainRMSE=60.570245, TestRMSE=99.981562</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0959696146745-8">7) TrainRMSE=56.704995, TestRMSE=111.404182</div><div class="crayon-line" id="crayon-5a658c7df0959696146745-9">8) TrainRMSE=59.909065, TestRMSE=90.238473</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0959696146745-10">9) TrainRMSE=60.863807, TestRMSE=105.331214</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<p>The plot suggests more variability in the test RMSE over time and perhaps a train RMSE that stabilizes sooner than with larger batch sizes. The increased variability in the test RMSE is to be expected given the large changes made to the network give so little feedback each update.</p>
<p>The graph also suggests that perhaps the decreasing trend in RMSE may continue if the configuration was afforded more training epochs.</p>
<div class="wp-caption aligncenter" id="attachment_3908" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs and Batch Size of 1" class="size-full wp-image-3908" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-1.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-Batch-Size-of-1-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs and Batch Size of 1</p></div>
<h3>Summary of Results</h3>
<p>As with training epochs, we can objectively compare the performance of the network given different batch sizes.</p>
<p>Each configuration was run 30 times and summary statistics calculated on the final results.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df095c740942299" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...

# run a repeated experiment
def experiment(repeats, series, batch_size):
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, 1)
	supervised_values = supervised.values
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# run experiment
	error_scores = list()
	for r in range(repeats):
		# fit the model
		train_trimmed = train_scaled[2:, :]
		lstm_model = fit_lstm(train_trimmed, batch_size, 1000, 1)
		# forecast the entire training dataset to build up state for forecasting
		train_reshaped = train_trimmed[:, 0].reshape(len(train_trimmed), 1, 1)
		lstm_model.predict(train_reshaped, batch_size=batch_size)
		# forecast test dataset
		test_reshaped = test_scaled[:,0:-1]
		test_reshaped = test_reshaped.reshape(len(test_reshaped), 1, 1)
		output = lstm_model.predict(test_reshaped, batch_size=batch_size)
		predictions = list()
		for i in range(len(output)):
			yhat = output[i,0]
			X = test_scaled[i, 0:-1]
			# invert scaling
			yhat = invert_scale(scaler, X, yhat)
			# invert differencing
			yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
			# store forecast
			predictions.append(yhat)
		# report performance
		rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
		print('%d) Test RMSE: %.3f' % (r+1, rmse))
		error_scores.append(rmse)
	return error_scores


# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
# vary training batches
batches = [1, 2, 4]
for b in batches:
	results[str(b)] = experiment(repeats, series, b)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_batches.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-10">10</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-12">12</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-14">14</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-16">16</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-18">18</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-20">20</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-22">22</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-24">24</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-26">26</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-28">28</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-30">30</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-32">32</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-34">34</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-36">36</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-38">38</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-40">40</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-42">42</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-44">44</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-46">46</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-48">48</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-50">50</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-52">52</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-54">54</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-56">56</div><div class="crayon-num" data-line="crayon-5a658c7df095c740942299-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df095c740942299-58">58</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df095c740942299-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-2"> </div><div class="crayon-line" id="crayon-5a658c7df095c740942299-3"><span class="crayon-p"># run a repeated experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-4"><span class="crayon-e">def </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-5"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-6"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-7"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-8"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-9"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-10"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-11"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-12"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-13"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-14"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-15"><span class="crayon-h"> </span><span class="crayon-p"># run experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-16"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-18"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-19"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-20"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-21"><span class="crayon-h"> </span><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-22"><span class="crayon-h"> </span><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-23"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-24"><span class="crayon-h"> </span><span class="crayon-p"># forecast test dataset</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-25"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-26"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-27"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-28"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-29"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-30"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-31"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-32"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-33"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-34"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-35"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-36"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-37"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-38"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-39"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-40"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-41"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-42"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error_scores</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-43"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-44"> </div><div class="crayon-line" id="crayon-5a658c7df095c740942299-45"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-46"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-47"><span class="crayon-p"># experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-48"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-49"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-50"><span class="crayon-p"># vary training batches</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-51"><span class="crayon-v">batches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-52"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">b</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">batches</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-53"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-54"><span class="crayon-p"># summarize results</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-56"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line" id="crayon-5a658c7df095c740942299-57"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df095c740942299-58"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_batches.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>From the mean performance alone, the results suggest lower RMSE with a batch size of 1. As was noted in the previous section, this may be improved further with more training epochs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0960585949980" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
                1           2           4
count   30.000000   30.000000   30.000000
mean    98.697017  102.642594  100.320203
std     12.227885    9.144163   15.957767
min     85.172215   85.072441   83.636365
25%     92.023175   96.834628   87.671461
50%     95.981688  101.139527   91.628144
75%    102.009268  110.171802  114.660192
max    147.688818  120.038036  135.290829</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0960585949980-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0960585949980-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0960585949980-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0960585949980-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0960585949980-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0960585949980-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0960585949980-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0960585949980-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0960585949980-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0960585949980-1">                1           2           4</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0960585949980-2">count   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5a658c7df0960585949980-3">mean    98.697017  102.642594  100.320203</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0960585949980-4">std     12.227885    9.144163   15.957767</div><div class="crayon-line" id="crayon-5a658c7df0960585949980-5">min     85.172215   85.072441   83.636365</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0960585949980-6">25%     92.023175   96.834628   87.671461</div><div class="crayon-line" id="crayon-5a658c7df0960585949980-7">50%     95.981688  101.139527   91.628144</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0960585949980-8">75%    102.009268  110.171802  114.660192</div><div class="crayon-line" id="crayon-5a658c7df0960585949980-9">max    147.688818  120.038036  135.290829</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot of the data was also created to help graphically compare the distributions. The plot shows the median performance as a green line where a batch size of 4 shows both the largest variability and also the lowest median RMSE.</p>
<p>Tuning a neural network is a tradeoff of average performance and variability of that performance, with an ideal result having a low mean error with low variability, meaning that it is generally good and reproducible.</p>
<div class="wp-caption aligncenter" id="attachment_3909" style="max-width: 650px"><img alt="Box and Whisker Plot Summarizing Batch Size Results" class="size-full wp-image-3909" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Batch-Size-Results.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Batch-Size-Results.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Batch-Size-Results-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot Summarizing Batch Size Results</p></div>
<h2>Tuning the Number of Neurons</h2>
<p>In this section, we will investigate the effect of varying the number of neurons in the network.</p>
<p>The number of neurons affects the learning capacity of the network. Generally, more neurons would be able to learn more structure from the problem at the cost of longer training time. More learning capacity also creates the problem of potentially overfitting the training data.</p>
<p>We will use a batch size of 4 and 1000 training epochs.</p>
<h3>Diagnostic of 1000 Epochs and 1 Neuron</h3>
<p>We will start with 1 neuron.</p>
<p>As a reminder, this is the second configuration tested from the epochs experiments.</p>
<div class="wp-caption aligncenter" id="attachment_3903" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs" class="size-full wp-image-3903" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs</p></div>
<h3>Diagnostic of 1000 Epochs and 2 Neurons</h3>
<p>We can increase the number of neurons from 1 to 2. This would be expected to improve the learning capacity of the network.</p>
<p>We can do this by changing the <em>n_neurons</em> variable in the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0965184810243" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_neurons = 2</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0965184810243-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0965184810243-1"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Running this configuration prints the RMSE scores from the final epoch of each run.</p>
<p>The results suggest a good, but not great, general performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0968162830342" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=59.466223, TestRMSE=95.554547
1) TrainRMSE=58.752515, TestRMSE=101.908449
2) TrainRMSE=58.061139, TestRMSE=86.589039
3) TrainRMSE=55.883708, TestRMSE=94.747927
4) TrainRMSE=58.700290, TestRMSE=86.393213
5) TrainRMSE=60.564511, TestRMSE=101.956549
6) TrainRMSE=63.160916, TestRMSE=98.925108
7) TrainRMSE=60.148595, TestRMSE=95.082825
8) TrainRMSE=63.029242, TestRMSE=89.285092
9) TrainRMSE=57.794717, TestRMSE=91.425071</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0968162830342-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0968162830342-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0968162830342-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0968162830342-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0968162830342-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0968162830342-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0968162830342-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0968162830342-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0968162830342-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0968162830342-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0968162830342-1">0) TrainRMSE=59.466223, TestRMSE=95.554547</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0968162830342-2">1) TrainRMSE=58.752515, TestRMSE=101.908449</div><div class="crayon-line" id="crayon-5a658c7df0968162830342-3">2) TrainRMSE=58.061139, TestRMSE=86.589039</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0968162830342-4">3) TrainRMSE=55.883708, TestRMSE=94.747927</div><div class="crayon-line" id="crayon-5a658c7df0968162830342-5">4) TrainRMSE=58.700290, TestRMSE=86.393213</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0968162830342-6">5) TrainRMSE=60.564511, TestRMSE=101.956549</div><div class="crayon-line" id="crayon-5a658c7df0968162830342-7">6) TrainRMSE=63.160916, TestRMSE=98.925108</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0968162830342-8">7) TrainRMSE=60.148595, TestRMSE=95.082825</div><div class="crayon-line" id="crayon-5a658c7df0968162830342-9">8) TrainRMSE=63.029242, TestRMSE=89.285092</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0968162830342-10">9) TrainRMSE=57.794717, TestRMSE=91.425071</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<p>This is more telling. It shows a rapid decrease in test RMSE to about epoch 500-750 where an inflection point shows a rise in test RMSE almost across the board on all runs. Meanwhile, the training dataset shows a continued decrease to the final epoch.</p>
<p>These are good signs of overfitting of the training dataset.</p>
<div class="wp-caption aligncenter" id="attachment_3910" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs and 2 Neurons" class="size-full wp-image-3910" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-2-Neurons.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-2-Neurons.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-2-Neurons-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs and 2 Neurons</p></div>
<p>Let’s see if this trend continues with even more neurons.</p>
<h3>Diagnostic of 1000 Epochs and 3 Neurons</h3>
<p>This section looks at the same configuration with the number of neurons increased to 3.</p>
<p>We can do this by setting the <em>n_neurons</em> variable in the <em>run()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0976460295168" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_neurons = 3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0976460295168-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0976460295168-1"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Running this configuration prints the RMSE scores from the final epoch of each run.</p>
<p>The results are similar to the previous section; we do not see much general difference between the final epoch test scores for 2 or 3 neurons. The final train scores do appear to be lower with 3 neurons, perhaps showing an acceleration of overfitting.</p>
<p>The inflection point in the training dataset seems to be happening sooner than the 2 neurons experiment, perhaps at epoch 300-400.</p>
<p>These increases in the number of neurons may benefit from additional changes to slowing down the rate of learning. Such as the use of regularization methods like dropout, decrease to the batch size, and decrease to the number of training epochs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0979309786292" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
0) TrainRMSE=55.686242, TestRMSE=90.955555
1) TrainRMSE=55.198617, TestRMSE=124.989622
2) TrainRMSE=55.767668, TestRMSE=104.751183
3) TrainRMSE=60.716046, TestRMSE=93.566307
4) TrainRMSE=57.703663, TestRMSE=110.813226
5) TrainRMSE=56.874231, TestRMSE=98.588524
6) TrainRMSE=57.206756, TestRMSE=94.386134
7) TrainRMSE=55.770377, TestRMSE=124.949862
8) TrainRMSE=56.876467, TestRMSE=95.059656
9) TrainRMSE=57.067810, TestRMSE=94.123620</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0979309786292-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0979309786292-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0979309786292-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0979309786292-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0979309786292-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0979309786292-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0979309786292-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0979309786292-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0979309786292-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0979309786292-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0979309786292-1">0) TrainRMSE=55.686242, TestRMSE=90.955555</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0979309786292-2">1) TrainRMSE=55.198617, TestRMSE=124.989622</div><div class="crayon-line" id="crayon-5a658c7df0979309786292-3">2) TrainRMSE=55.767668, TestRMSE=104.751183</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0979309786292-4">3) TrainRMSE=60.716046, TestRMSE=93.566307</div><div class="crayon-line" id="crayon-5a658c7df0979309786292-5">4) TrainRMSE=57.703663, TestRMSE=110.813226</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0979309786292-6">5) TrainRMSE=56.874231, TestRMSE=98.588524</div><div class="crayon-line" id="crayon-5a658c7df0979309786292-7">6) TrainRMSE=57.206756, TestRMSE=94.386134</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0979309786292-8">7) TrainRMSE=55.770377, TestRMSE=124.949862</div><div class="crayon-line" id="crayon-5a658c7df0979309786292-9">8) TrainRMSE=56.876467, TestRMSE=95.059656</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0979309786292-10">9) TrainRMSE=57.067810, TestRMSE=94.123620</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test and train RMSE scores each epoch is also created.</p>
<div class="wp-caption aligncenter" id="attachment_3911" style="max-width: 650px"><img alt="Diagnostic Results with 1000 Epochs and 3 Neurons" class="size-full wp-image-3911" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-3-Neurons.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-3-Neurons.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Diagnostic-Results-with-1000-Epochs-and-3-Neurons-300x225.png 300w" width="640"/><p class="wp-caption-text">Diagnostic Results with 1000 Epochs and 3 Neurons</p></div>
<h3>Summary of Results</h3>
<p>Again, we can objectively compare the impact of increasing the number of neurons while keeping all other network configurations fixed.</p>
<p>In this section, we repeat each experiment 30 times and compare the average test RMSE performance with the number of neurons ranging from 1 to 5.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df097c010822547" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...

# run a repeated experiment
def experiment(repeats, series, neurons):
	# transform data to be stationary
	raw_values = series.values
	diff_values = difference(raw_values, 1)
	# transform data to be supervised learning
	supervised = timeseries_to_supervised(diff_values, 1)
	supervised_values = supervised.values
	# split data into train and test-sets
	train, test = supervised_values[0:-12], supervised_values[-12:]
	# transform the scale of the data
	scaler, train_scaled, test_scaled = scale(train, test)
	# run experiment
	error_scores = list()
	for r in range(repeats):
		# fit the model
		batch_size = 4
		train_trimmed = train_scaled[2:, :]
		lstm_model = fit_lstm(train_trimmed, batch_size, 1000, neurons)
		# forecast the entire training dataset to build up state for forecasting
		train_reshaped = train_trimmed[:, 0].reshape(len(train_trimmed), 1, 1)
		lstm_model.predict(train_reshaped, batch_size=batch_size)
		# forecast test dataset
		test_reshaped = test_scaled[:,0:-1]
		test_reshaped = test_reshaped.reshape(len(test_reshaped), 1, 1)
		output = lstm_model.predict(test_reshaped, batch_size=batch_size)
		predictions = list()
		for i in range(len(output)):
			yhat = output[i,0]
			X = test_scaled[i, 0:-1]
			# invert scaling
			yhat = invert_scale(scaler, X, yhat)
			# invert differencing
			yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
			# store forecast
			predictions.append(yhat)
		# report performance
		rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
		print('%d) Test RMSE: %.3f' % (r+1, rmse))
		error_scores.append(rmse)
	return error_scores


# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# experiment
repeats = 30
results = DataFrame()
# vary neurons
neurons = [1, 2, 3, 4, 5]
for n in neurons:
	results[str(n)] = experiment(repeats, series, n)
# summarize results
print(results.describe())
# save boxplot
results.boxplot()
pyplot.savefig('boxplot_neurons.png')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-10">10</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-12">12</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-14">14</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-16">16</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-18">18</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-20">20</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-22">22</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-24">24</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-26">26</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-28">28</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-30">30</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-32">32</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-34">34</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-36">36</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-38">38</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-40">40</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-42">42</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-44">44</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-46">46</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-48">48</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-50">50</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-52">52</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-54">54</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-56">56</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df097c010822547-58">58</div><div class="crayon-num" data-line="crayon-5a658c7df097c010822547-59">59</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df097c010822547-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-2"> </div><div class="crayon-line" id="crayon-5a658c7df097c010822547-3"><span class="crayon-p"># run a repeated experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-4"><span class="crayon-e">def </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-5"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-6"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-7"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-8"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-9"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-10"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-11"><span class="crayon-h"> </span><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-12"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-13"><span class="crayon-h"> </span><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-14"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-15"><span class="crayon-h"> </span><span class="crayon-p"># run experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-16"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-18"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-19"><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-20"><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-21"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-22"><span class="crayon-h"> </span><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-23"><span class="crayon-h"> </span><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_trimmed</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-24"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-25"><span class="crayon-h"> </span><span class="crayon-p"># forecast test dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-26"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-27"><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-28"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-29"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-30"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-31"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-33"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-34"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-35"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-36"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-37"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-38"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-39"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-40"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-41"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-42"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">error_scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-44"> </div><div class="crayon-line" id="crayon-5a658c7df097c010822547-45"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-46"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-47"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-48"><span class="crayon-p"># experiment</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-49"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-50"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-51"><span class="crayon-p"># vary neurons</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-52"><span class="crayon-v">neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-53"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-54"><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">experiment</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-55"><span class="crayon-p"># summarize results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-56"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-57"><span class="crayon-p"># save boxplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df097c010822547-58"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658c7df097c010822547-59"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">savefig</span><span class="crayon-sy">(</span><span class="crayon-s">'boxplot_neurons.png'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0048 seconds] -->
<p>Running the experiment prints the summary statistics for each configuration.</p>
<p>From the mean performance alone, the results suggest a network configuration with 1 neuron as having the best performance over 1000 epochs with a batch size of 4. This configuration also shows the tightest variance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658c7df0981600600712" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
                1           2           3           4           5
count   30.000000   30.000000   30.000000   30.000000   30.000000
mean    98.344696  103.268147  102.726894  112.453766  122.843032
std     13.538599   14.720989   12.905631   16.296657   25.586013
min     81.764721   87.731385   77.545899   85.632492   85.955093
25%     88.524334   94.040807   95.152752  102.477366  104.192588
50%     93.543948  100.330678  103.622600  110.906970  117.022724
75%    102.944050  105.087384  110.235754  118.653850  133.343669
max    132.934054  152.588092  130.551521  162.889845  184.678185</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658c7df0981600600712-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0981600600712-2">2</div><div class="crayon-num" data-line="crayon-5a658c7df0981600600712-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0981600600712-4">4</div><div class="crayon-num" data-line="crayon-5a658c7df0981600600712-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0981600600712-6">6</div><div class="crayon-num" data-line="crayon-5a658c7df0981600600712-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658c7df0981600600712-8">8</div><div class="crayon-num" data-line="crayon-5a658c7df0981600600712-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658c7df0981600600712-1">                1           2           3           4           5</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0981600600712-2">count   30.000000   30.000000   30.000000   30.000000   30.000000</div><div class="crayon-line" id="crayon-5a658c7df0981600600712-3">mean    98.344696  103.268147  102.726894  112.453766  122.843032</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0981600600712-4">std     13.538599   14.720989   12.905631   16.296657   25.586013</div><div class="crayon-line" id="crayon-5a658c7df0981600600712-5">min     81.764721   87.731385   77.545899   85.632492   85.955093</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0981600600712-6">25%     88.524334   94.040807   95.152752  102.477366  104.192588</div><div class="crayon-line" id="crayon-5a658c7df0981600600712-7">50%     93.543948  100.330678  103.622600  110.906970  117.022724</div><div class="crayon-line crayon-striped-line" id="crayon-5a658c7df0981600600712-8">75%    102.944050  105.087384  110.235754  118.653850  133.343669</div><div class="crayon-line" id="crayon-5a658c7df0981600600712-9">max    132.934054  152.588092  130.551521  162.889845  184.678185</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The box and whisker plot shows a clear trend in the median test set performance where the increase in neurons results in a corresponding increase in the test RMSE.</p>
<div class="wp-caption aligncenter" id="attachment_3912" style="max-width: 650px"><img alt="Box and Whisker Plot Summarizing Neuron Results" class="size-full wp-image-3912" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Neuron-Results.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Neuron-Results.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Box-and-Whisker-Plot-Summarizing-Neuron-Results-300x225.png 300w" width="640"/><p class="wp-caption-text">Box and Whisker Plot Summarizing Neuron Results</p></div>
<h2>Summary of All Results</h2>
<p>We completed quite a few LSTM experiments on the Shampoo Sales dataset in this tutorial.</p>
<p>Generally, it seems that a stateful LSTM configured with 1 neuron, a batch size of 4, and trained for 1000 epochs might be a good configuration.</p>
<p>The results also suggest that perhaps this configuration with a batch size of 1 and fit for more epochs may be worthy of further exploration.</p>
<p>Tuning neural networks is difficult empirical work, and LSTMs are proving to be no exception.</p>
<p>This tutorial demonstrated the benefit of both diagnostic studies of configuration behavior over time, as well as objective studies of test RMSE.</p>
<p>Nevertheless, there are always more studies that could be performed. Some ideas are listed in the next section.</p>
<h3>Extensions</h3>
<p>This section lists some ideas for extensions to the experiments performed in this tutorial.</p>
<p>If you explore any of these, report your results in the comments; I’d love to see what you come up with.</p>
<ul>
<li><strong>Dropout</strong>. Slow down learning with regularization methods like dropout on the recurrent LSTM connections.</li>
<li><strong>Layers</strong>. Explore additional hierarchical learning capacity by adding more layers and varied numbers of neurons in each layer.</li>
<li><strong>Regularization</strong>. Explore how weight regularization, such as L1 and L2, can be used to slow down learning and overfitting of the network on some configurations.</li>
<li><strong>Optimization Algorithm</strong>. Explore the use of <a href="https://keras.io/optimizers/">alternate optimization algorithms</a>, such as classical gradient descent, to see if specific configurations to speed up or slow down learning can lead to benefits.</li>
<li><strong>Loss Function</strong>. Explore the use of <a href="https://keras.io/objectives/">alternative loss functions</a> to see if these can be used to lift performance.</li>
<li><strong>Features and Timesteps</strong>. Explore the use of lag observations as input features and input time steps of the feature to see if their presence as input can improve learning and/or predictive capability of the model.</li>
<li><strong>Larger Batch Size</strong>. Explore larger batch sizes than 4, perhaps requiring further manipulation of the size of the training and test datasets.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how you can systematically investigate the configuration for an LSTM network for time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to design a systematic test harness for evaluating model configurations.</li>
<li>How to use model diagnostics over time, as well as objective prediction error to interpret model behavior.</li>
<li>How to explore and interpret the effects of the number of training epochs, batch size, and number of neurons.</li>
</ul>
<p>Do you have any questions about tuning LSTMs, or about this tutorial?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftune-lstm-hyperparameters-keras-time-series-forecasting%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/&amp;summary=Configuring+neural+networks+is+difficult+because+there+is+no+good+theory+on+how+to+do+it.%0D%0A%0D%0AYou+mus..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Tune%20LSTM%20Hyperparameters%20with%20Keras%20for%20Time%20Series%20Forecasting&amp;url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/&amp;summary=Configuring+neural+networks+is+difficult+because+there+is+no+good+theory+on+how+to+do+it.%0D%0A%0D%0AYou+mus...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/seed-state-lstms-time-series-forecasting-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Seed State for LSTMs for Time Series Forecasting in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="next">How to Update LSTM Networks During Training for Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">32 Responses to <em>How to Tune LSTM Hyperparameters with Keras for Time Series Forecasting</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-396182">
<div class="comment-container" id="li-comment-396182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/06bc97889b4e088e58e6c3e9f687401b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/06bc97889b4e088e58e6c3e9f687401b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John Richards</span>
<span class="date">April 12, 2017 at 8:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome Work!</p>
<div class="reply">
<a aria-label="Reply to John Richards" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396182#respond" onclick='return addComment.moveForm( "comment-396182", "396182", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-396183">
<div class="comment-container" id="li-comment-396183">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 12, 2017 at 9:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396183" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks John!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396183#respond" onclick='return addComment.moveForm( "comment-396183", "396183", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-396191">
<div class="comment-container" id="li-comment-396191">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 12, 2017 at 10:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396191" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>line 137, in<br/>
results[str(e)] = experiment(repeats, series, e)<br/>
line 104, in experiment<br/>
lstm_model = fit_lstm(train_trimmed, batch_size, epochs, 1)<br/>
line 81, in fit_lstm<br/>
model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)<br/>
File “C:\Anaconda3\lib\site-packages\keras\models.py”, line 654, in fit<br/>
str(kwargs))<br/>
TypeError: Received unknown keyword arguments: {‘epochs’: 1}<br/>
Is there something wrong?</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396191#respond" onclick='return addComment.moveForm( "comment-396191", "396191", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-396277">
<div class="comment-container" id="li-comment-396277">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396277" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You need to upgrade to Keras v2.0 or higher.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396277#respond" onclick='return addComment.moveForm( "comment-396277", "396277", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-399823">
<div class="comment-container" id="li-comment-399823">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Logan</span>
<span class="date">May 17, 2017 at 12:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-399823" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You should replace model.fit(X, y, epochs=1, …) for model.fit(X, y, nb_epoch=1…) It worked perfectly for me.</p>
<div class="reply">
<a aria-label="Reply to Logan" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=399823#respond" onclick='return addComment.moveForm( "comment-399823", "399823", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-399856">
<div class="comment-container" id="li-comment-399856">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 17, 2017 at 8:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-399856" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The example was updated to use Keras v2.0 which changed the “nb_epochs” argument to now be “epochs”.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=399856#respond" onclick='return addComment.moveForm( "comment-399856", "399856", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-396212">
<div class="comment-container" id="li-comment-396212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e06702f04d3799e19644f31990bcbaff?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e06702f04d3799e19644f31990bcbaff?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">April 12, 2017 at 6:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice blog post once again. What is the size of the data set that you are using? What is the maximum data size that one can use with your example if I have a system with 8GB RAM?</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396212#respond" onclick='return addComment.moveForm( "comment-396212", "396212", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-396281">
<div class="comment-container" id="li-comment-396281">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396281" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The examples use small &lt;1 MB datasets.</p>
<p>The size of supported datasets depends on data types, number of rows and number of columns. </p>
<p>Consider doing some experiments with synthetic data to find the limits of your system.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396281#respond" onclick='return addComment.moveForm( "comment-396281", "396281", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-396241">
<div class="comment-container" id="li-comment-396241">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7c2afe026605049fe9267f27d1f128c9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7c2afe026605049fe9267f27d1f128c9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lorenzo</span>
<span class="date">April 13, 2017 at 1:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396241" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Amazing tutorial as always. Would you have an example of running the LSTM on a multivariate regression problem like the Walmart’s on Kaggle (<a href="https://www.kaggle.com/c/walmart-recruiting-store-sales-forecasting" rel="nofollow">https://www.kaggle.com/c/walmart-recruiting-store-sales-forecasting</a>) ?</p>
<div class="reply">
<a aria-label="Reply to Lorenzo" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396241#respond" onclick='return addComment.moveForm( "comment-396241", "396241", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-396289">
<div class="comment-container" id="li-comment-396289">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 10:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396289" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There should be some examples on the blog soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396289#respond" onclick='return addComment.moveForm( "comment-396289", "396289", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-396260">
<div class="comment-container" id="li-comment-396260">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7924862f07e1ad39c9010fcd1b59e493?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7924862f07e1ad39c9010fcd1b59e493?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tykimos</span>
<span class="date">April 13, 2017 at 4:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396260" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work! I have a question regarding batch_size. I think that only one batch_size is reasonable for this case because stateful is true. If batch_size is 4, there are 4 states separately. That means 4 states don’t share each other. Although every sample has connection with the next sample sequently, every sample is connected the quaternary next sample.</p>
<p>For example,<br/>
1 &gt; 5 &gt; 9<br/>
2 &gt; 6 &gt; 10<br/>
3 &gt; 7 &gt; 11<br/>
4 &gt; 8 &gt; 12</p>
<div class="reply">
<a aria-label="Reply to Tykimos" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396260#respond" onclick='return addComment.moveForm( "comment-396260", "396260", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-396297">
<div class="comment-container" id="li-comment-396297">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 10:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396297" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I understand your question, perhaps you can restate it.</p>
<p>We are using stateful LSTMs and regardless of the batch size, state is only reset when we reset it explicitly with a call to model.reset_states()</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396297#respond" onclick='return addComment.moveForm( "comment-396297", "396297", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-396363">
<div class="comment-container" id="li-comment-396363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7924862f07e1ad39c9010fcd1b59e493?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7924862f07e1ad39c9010fcd1b59e493?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tykimos</span>
<span class="date">April 14, 2017 at 1:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think that the batch_size depends on not user tuning parameter but dataset design relative to the number of sequence set.</p>
<p>When batch_size is 4 and stateful is true, output of LSTM is weight_count * batch_size. This means that there are 4 different and independent states. It seems good for the following dataset :<br/>
A1-B1-C1-D1-A2-B2-C2-D2-A3-B3-C3-D3<br/>
– sample is 12<br/>
– batch_size is 4<br/>
– sequence set is 4<br/>
Because A isn’t relative to others in sequence, the next of A1 should be not B1 but A2. For this we have to choose batch_size as 4.</p>
<p>For each epoch,<br/>
A1-A2-A3 and reset<br/>
B1-B2-B3 and reset<br/>
C1-C2-C3 and reset<br/>
D1-D2-D3 and reset</p>
<p>Your example is one sequence set like:<br/>
A1-A2-A3-A4-A5-A6-A7-A8-A9-A10-A11-A12<br/>
If we set batch_size as 4, state is transferred as the following:<br/>
A1-A5-A9 and reset<br/>
A2-A6-A10 and reset<br/>
A3-A7-A11 and reset<br/>
A4-A8-A12 and reset</p>
<p>So, I think that batch_size should be 1 in your dataset. Other batch_size values are invalid.</p>
<div class="reply">
<a aria-label="Reply to tykimos" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396363#respond" onclick='return addComment.moveForm( "comment-396363", "396363", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-396394">
<div class="comment-container" id="li-comment-396394">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 14, 2017 at 8:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396394" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree with the first part, it makes sense to reset state at the natural end of a sequence.</p>
<p>I also agree that with the dataset used that there is no natural end to the sequence other than the end of the data, so no state resets are needed.</p>
<p>I disagree that you “have to have” a batch size of 1. We can have a batch size of 1. We can also have a batch size equal to the sequence length. </p>
<p>My previous point is that batch size does not matter when stateful=True because we manage exactly when the state is reset. It does not matter what batch size is used, as long as the state is reset at the natural end of the sequence.</p>
<p>Yes, you are right, there is a bug. The regime of resetting state after each batch of 4 input patterns does not make sense. I’ll schedule time to fix the examples and re-run the experiments.</p>
<p>Thanks for pointing this out and thanks for having the patients to help me see what you saw.</p>
<p>UPDATE: There is no fault, all weight updates are occurring within one epoch regardless of batch size.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396394#respond" onclick='return addComment.moveForm( "comment-396394", "396394", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-397409">
<div class="comment-container" id="li-comment-397409">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2017 at 8:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-397409" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Update I have taken a much closer look at this code (it was written months ago).</p>
<p>I believe there is no fault. </p>
<p>Take a close look at the loop for running manual epochs.</p>
<p>Although the batch sizes vary, we are performing one entire epoch + all weight updates before resetting state.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-396342">
<div class="comment-container" id="li-comment-396342">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f8a16d47557a679ca1707b74045e036?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f8a16d47557a679ca1707b74045e036?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sebastian</span>
<span class="date">April 13, 2017 at 7:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396342" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great blog post!</p>
<div class="reply">
<a aria-label="Reply to Sebastian" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396342#respond" onclick='return addComment.moveForm( "comment-396342", "396342", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396389">
<div class="comment-container" id="li-comment-396389">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 14, 2017 at 8:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-396389" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Sebastian.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=396389#respond" onclick='return addComment.moveForm( "comment-396389", "396389", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397670">
<div class="comment-container" id="li-comment-397670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/65e49d6586ca2d61845bf65bac1bfe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/65e49d6586ca2d61845bf65bac1bfe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jesse</span>
<span class="date">April 26, 2017 at 4:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-397670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Cool post! I already learnt a lot from your blogs.</p>
<p>I have 2 questions regarding this post, I hope you can help me:</p>
<p>1. Why aren’t you specifying activation functions in your model layers (for the LSTM layer for example?) I read on the keras docs that no activation function is used if you don’t pass one. It seems to me that a tanh activation would fit the [-1,1] scaling?<br/>
2. Do you always remove the increasing trend from the data?</p>
<p>Thanks a lot!</p>
<div class="reply">
<a aria-label="Reply to Jesse" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=397670#respond" onclick='return addComment.moveForm( "comment-397670", "397670", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397731">
<div class="comment-container" id="li-comment-397731">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2017 at 8:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-397731" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am using the default for LSTMs which are tanh and sigmoid.</p>
<p>Yes, making time series data stationary is a recommended in general.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=397731#respond" onclick='return addComment.moveForm( "comment-397731", "397731", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-402646">
<div class="comment-container" id="li-comment-402646">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cabf6cb231a5df6a5f356b9db2e1862d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cabf6cb231a5df6a5f356b9db2e1862d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sebastian</span>
<span class="date">June 16, 2017 at 12:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-402646" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>very nice post, but still got a question.</p>
<p>When reversing difference for predicitions, isn’t it wrong to reverse it using the raw values? Instead, shouldn’t you use the last prediction to reverse the difference?<br/>
Like, instead of yhat = yhat + history[-interval] it is yhat = yhat + predictions[-interval]?</p>
<p>Or am I misunderstanding something?</p>
<p>Freetings</p>
<div class="reply">
<a aria-label="Reply to Sebastian" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=402646#respond" onclick='return addComment.moveForm( "comment-402646", "402646", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402699">
<div class="comment-container" id="li-comment-402699">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 8:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-402699" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but if you have the real observations for a past time step, we should use them instead to better reflect the “real” level.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=402699#respond" onclick='return addComment.moveForm( "comment-402699", "402699", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-415165">
<div class="comment-container" id="li-comment-415165">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc53d396b96524eb772f15fceb86f433?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc53d396b96524eb772f15fceb86f433?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sepideh</span>
<span class="date">September 30, 2017 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-415165" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Dr. Jason for the great blog. Is it possible to use GPU for this example? If so, how can I apply it! I appreciate your help. The reason I want to use GPU is that I need to get results faster. I am using google compute engine with 6vCPUs and 39 GB memory.</p>
<div class="reply">
<a aria-label="Reply to Sepideh" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=415165#respond" onclick='return addComment.moveForm( "comment-415165", "415165", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415173">
<div class="comment-container" id="li-comment-415173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-415173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps. The GPU configuration is controlled by the library used by Keras, such as TensorFlow.</p>
<p>I have found that it is better to run models sequentially on the GPU and instead use multiple GPUs/servers to test configurations.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=415173#respond" onclick='return addComment.moveForm( "comment-415173", "415173", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422323">
<div class="comment-container" id="li-comment-422323">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aafb47a4754cc19e957d555d3e83906e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aafb47a4754cc19e957d555d3e83906e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Farzad</span>
<span class="date">December 7, 2017 at 1:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-422323" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many thanks for your great tutorial.<br/>
I have a question regarding updating the model after making a prediction on each timestep of the test dataset. Could you please explain which line of the code is responsible for doing this; I mean the line that implements this statement: “… then the actual expected value from the test set will be taken and made available to the model for the forecast on the next time step.”</p>
<div class="reply">
<a aria-label="Reply to Farzad" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=422323#respond" onclick='return addComment.moveForm( "comment-422323", "422323", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423325">
<div class="comment-container" id="li-comment-423325">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-423325" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model is not updated after making a prediction in this post.</p>
<p>This is called updating a model, see an example here:<br/>
<a href="https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/</a></p>
<p>By that line, I meant that we are adding observations to the history used by the model for making the next prediction.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=423325#respond" onclick='return addComment.moveForm( "comment-423325", "423325", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425512">
<div class="comment-container" id="li-comment-425512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9820bcc858e210057efe1d2458d2f758?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9820bcc858e210057efe1d2458d2f758?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Suraj Nepal</span>
<span class="date">January 3, 2018 at 4:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you so much for this wonderful tutorial.</p>
<p>Can you please help me to implement Grid search and Bayesian optimization approach  for LSTM hyper parameter tuning.</p>
<p>Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to Suraj Nepal" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425512#respond" onclick='return addComment.moveForm( "comment-425512", "425512", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425567">
<div class="comment-container" id="li-comment-425567">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425567" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What problem are you having exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425567#respond" onclick='return addComment.moveForm( "comment-425567", "425567", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-425596">
<div class="comment-container" id="li-comment-425596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9820bcc858e210057efe1d2458d2f758?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9820bcc858e210057efe1d2458d2f758?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Suraj Nepal</span>
<span class="date">January 4, 2018 at 1:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I want to implement proper hyper parameter tuning mechanism for LSTM time series forecasting. </p>
<p>But I am facing difficulties using grid search for time series model.<br/>
Also I dont find proper guidelines for using Bayesian optimization in LSTM time series forecasting.<br/>
Thank you in advance</p>
<div class="reply">
<a aria-label="Reply to Suraj Nepal" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425596#respond" onclick='return addComment.moveForm( "comment-425596", "425596", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-425603">
<div class="comment-container" id="li-comment-425603">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 3:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425603" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry I don’t have an example of using Bayesian optimization for tuning LSTMs. Thanks for the suggestion.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425603#respond" onclick='return addComment.moveForm( "comment-425603", "425603", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425559">
<div class="comment-container" id="li-comment-425559">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Edward</span>
<span class="date">January 4, 2018 at 5:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425559" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!<br/>
Can we use GridSearchCV to tune LSTM Hyperparameters with Keras for Time Series Forecasting?<br/>
or we can not do this because for GridSearchCV we need cross validation but in this case we can not use cross validation (time seies)</p>
<div class="reply">
<a aria-label="Reply to Edward" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425559#respond" onclick='return addComment.moveForm( "comment-425559", "425559", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425586">
<div class="comment-container" id="li-comment-425586">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425586" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend writing your own for-loop and using walk-forward validation to test time series forecasting models.<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425586#respond" onclick='return addComment.moveForm( "comment-425586", "425586", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-425645">
<div class="comment-container" id="li-comment-425645">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Edward</span>
<span class="date">January 5, 2018 at 3:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/#comment-425645" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks a lot Jason</p>
<div class="reply">
<a aria-label="Reply to Edward" class="comment-reply-link" href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/?replytocom=425645#respond" onclick='return addComment.moveForm( "comment-425645", "425645", "respond", "3900" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/tune-lstm-hyperparameters-keras-time-series-forecasting/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3900"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="87145e51de"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="204"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>