<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Text Generation With LSTM Recurrent Neural Networks in Python with Keras - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Text Generation With LSTM Recurrent Neural Networks in Python with Keras - Machine Learning Mastery" property="og:title"/>
<meta content="Recurrent neural networks can also be used as generative models. This means that in addition to being used for predictive models (making predictions) they can learn the sequences of a problem and then generate entirely new plausible sequences for the problem domain. Generative models like this are useful not only to study how well a …" property="og:description"/>
<meta content="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Natural Language Processing" property="article:section"/>
<meta content="2016-08-04T05:00:46+11:00" property="article:published_time"/>
<meta content="2018-01-08T14:48:30+11:00" property="article:modified_time"/>
<meta content="2018-01-08T14:48:30+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="426" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/text-generation-lstm-recurrent-neural-networks-python-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/feed/" rel="alternate" title="Machine Learning Mastery » Text Generation With LSTM Recurrent Neural Networks in Python with Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=2964" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftext-generation-lstm-recurrent-neural-networks-python-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftext-generation-lstm-recurrent-neural-networks-python-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-2964 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Need help with Deep Learning for Text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-2964 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">Text Generation With LSTM Recurrent Neural Networks in Python with Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2016-08-04T05:00:46+1100">August 4, 2016</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Natural Language Processing">Natural Language Processing</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftext-generation-lstm-recurrent-neural-networks-python-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/&amp;summary=Recurrent+neural+networks+can+also+be+used+as+generative+models.%0D%0A%0D%0AThis+means+that+in+addition+to+b..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/&amp;summary=Recurrent+neural+networks+can+also+be+used+as+generative+models.%0D%0A%0D%0AThis+means+that+in+addition+to+b...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Recurrent neural networks can also be used as generative models.</p>
<p>This means that in addition to being used for predictive models (making predictions) they can learn the sequences of a problem and then generate entirely new plausible sequences for the problem domain.</p>
<p>Generative models like this are useful not only to study how well a model has learned a problem, but to learn more about the problem domain itself.</p>
<p>In this post you will discover how to create a generative model for text, character-by-character using LSTM recurrent neural networks in Python with Keras.</p>
<p>After reading this post you will know:</p>
<ul>
<li>Where to download a free corpus of text that you can use to train text generative models.</li>
<li>How to frame the problem of text sequences to a recurrent neural network generative model.</li>
<li>How to develop an LSTM to generate plausible text sequences for a given problem.</li>
</ul>
<p>Let’s get started.</p>
<p><strong>Note</strong>: LSTM recurrent neural networks can be slow to train and it is highly recommend that you train them on GPU hardware. You can access GPU hardware in the cloud very cheaply using Amazon Web Services, <a href="http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/">see the tutorial here</a>.</p>
<ul>
<li><strong>Update Oct/2016</strong>: Fixed a few minor comment typos in the code.</li>
<li><strong>Update Mar/2017</strong>: Updated example for Keras 2.0.2, TensorFlow 1.0.1 and Theano 0.9.0.</li>
</ul>
<div class="wp-caption aligncenter" id="attachment_2965" style="max-width: 650px"><img alt="Text Generation With LSTM Recurrent Neural Networks in Python with Keras" class="size-full wp-image-2965" height="426" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/Text-Generation-With-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-300x200.jpg 300w" width="640"/><p class="wp-caption-text">Text Generation With LSTM Recurrent Neural Networks in Python with Keras<br/>Photo by <a href="https://www.flickr.com/photos/tearstone/5028273685/">Russ Sanderlin</a>, some rights reserved.</p></div>
<h2>Problem Description: Project Gutenberg</h2>
<p>Many of the classical texts are no longer protected under copyright.</p>
<p>This means that you can download all of the text for these books for free and use them in experiments, like creating generative models. Perhaps the best place to get access to free books that are no longer protected by copyright is <a href="https://www.gutenberg.org">Project Gutenberg</a>.</p>
<p>In this tutorial we are going to use a favorite book from childhood as the dataset: <a href="https://www.gutenberg.org/ebooks/11">Alice’s Adventures in Wonderland by Lewis Carroll</a>.</p>
<p>We are going to learn the dependencies between characters and the conditional probabilities of characters in sequences so that we can in turn generate wholly new and original sequences of characters.</p>
<p>This is a lot of fun and I recommend repeating these experiments with other books from Project Gutenberg, <a href="https://www.gutenberg.org/ebooks/search/%3Fsort_order%3Ddownloads">here is a list of the most popular books on the site</a>.</p>
<p>These experiments are not limited to text, you can also experiment with other ASCII data, such as computer source code, marked up documents in LaTeX, HTML or Markdown and more.</p>
<p>You can <a href="http://www.gutenberg.org/cache/epub/11/pg11.txt">download the complete text in ASCII format</a> (Plain Text UTF-8) for this book for free and place it in your working directory with the filename <strong>wonderland.txt</strong>.</p>
<p>Now we need to prepare the dataset ready for modeling.</p>
<p>Project Gutenberg adds a standard header and footer to each book and this is not part of the original text. Open the file in a text editor and delete the header and footer.</p>
<p>The header is obvious and ends with the text:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29d2180752551" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
*** START OF THIS PROJECT GUTENBERG EBOOK ALICE'S ADVENTURES IN WONDERLAND ***</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29d2180752551-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29d2180752551-1">*** START OF THIS PROJECT GUTENBERG EBOOK ALICE'S ADVENTURES IN WONDERLAND ***</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The footer is all of the text after the line of text that says:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29dc268005607" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
THE END</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29dc268005607-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29dc268005607-1">THE END</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You should be left with a text file that has about 3,330 lines of text.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Develop a Small LSTM Recurrent Neural Network</h2>
<p>In this section we will develop a simple LSTM network to learn sequences of characters from Alice in Wonderland. In the next section we will use this model to generate new sequences of characters.</p>
<p>Let’s start off by importing the classes and functions we intend to use to train our model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29de885620976" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29de885620976-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29de885620976-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29de885620976-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29de885620976-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede29de885620976-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29de885620976-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede29de885620976-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29de885620976-1"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29de885620976-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6593ede29de885620976-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29de885620976-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="crayon-5a6593ede29de885620976-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29de885620976-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="crayon-5a6593ede29de885620976-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we need to load the ASCII text for the book into memory and convert all of the characters to lowercase to reduce the vocabulary that the network must learn.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29e1935147020" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename).read()
raw_text = raw_text.lower()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29e1935147020-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29e1935147020-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29e1935147020-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29e1935147020-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29e1935147020-1"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29e1935147020-2"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line" id="crayon-5a6593ede29e1935147020-3"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29e1935147020-4"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Now that the book is loaded, we must prepare the data for modeling by the neural network. We cannot model the characters directly, instead we must convert the characters to integers.</p>
<p>We can do this easily by first creating a set of all of the distinct characters in the book, then creating a map of each character to a unique integer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29e3996774174" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29e3996774174-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29e3996774174-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29e3996774174-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29e3996774174-1"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29e3996774174-2"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29e3996774174-3"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>For example, the list of unique sorted lowercase characters in the book is as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29e6750873752" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
['\n', '\r', ' ', '!', '"', "'", '(', ')', '*', ',', '-', '.', ':', ';', '?', '[', ']', '_', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '\xbb', '\xbf', '\xef']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29e6750873752-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29e6750873752-1">['\n', '\r', ' ', '!', '"', "'", '(', ')', '*', ',', '-', '.', ':', ';', '?', '[', ']', '_', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '\xbb', '\xbf', '\xef']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You can see that there may be some characters that we could remove to further clean up the dataset that will reduce the vocabulary and may improve the modeling process.</p>
<p>Now that the book has been loaded and the mapping prepared, we can summarize the dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29e8067789693" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29e8067789693-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29e8067789693-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29e8067789693-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29e8067789693-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29e8067789693-1"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29e8067789693-2"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29e8067789693-3"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29e8067789693-4"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Running the code to this point produces the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29eb104350593" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total Characters:  147674
Total Vocab:  47</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29eb104350593-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29eb104350593-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29eb104350593-1">Total Characters:  147674</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29eb104350593-2">Total Vocab:  47</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can see that the book has just under 150,000 characters and that when converted to lowercase that there are only 47 distinct characters in the vocabulary for the network to learn. Much more than the 26 in the alphabet.</p>
<p>We now need to define the training data for the network. There is a lot of flexibility in how you choose to break up the text and expose it to the network during training.</p>
<p>In this tutorial we will split the book text up into subsequences with a fixed length of 100 characters, an arbitrary length. We could just as easily split the data up by sentences and pad the shorter sequences and truncate the longer ones.</p>
<p>Each training pattern of the network is comprised of 100 time steps of one character (X) followed by one character output (y). When creating these sequences, we slide this window along the whole book one character at a time, allowing each character a chance to be learned from the 100 characters that preceded it (except the first 100 characters of course).</p>
<p>For example, if the sequence length is 5 (for simplicity) then the first two training patterns would be as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29ed225451449" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
CHAPT -&gt; E
HAPTE -&gt; R</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29ed225451449-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29ed225451449-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29ed225451449-1">CHAPT -&gt; E</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29ed225451449-2">HAPTE -&gt; R</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>As we split up the book into these sequences, we convert the characters to integers using our lookup table we prepared earlier.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29f0810998233" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f0810998233-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f0810998233-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f0810998233-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f0810998233-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f0810998233-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede29f0810998233-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29f0810998233-1"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f0810998233-2"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6593ede29f0810998233-3"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f0810998233-4"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede29f0810998233-5"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f0810998233-6"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede29f0810998233-7"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f0810998233-8"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29f0810998233-9"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f0810998233-10"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29f0810998233-11"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Running the code to this point shows us that when we split up the dataset into training data for the network to learn that we have just under 150,000 training pattens. This makes sense as excluding the first 100 characters, we have one training pattern to predict each of the remaining characters.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29f2673793070" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total Patterns:  147574</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29f2673793070-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29f2673793070-1">Total Patterns:  147574</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Now that we have prepared our training data we need to transform it so that it is suitable for use with Keras.</p>
<p>First we must transform the list of input sequences into the form <em>[samples, time steps, features]</em> expected by an LSTM network.</p>
<p>Next we need to rescale the integers to the range 0-to-1 to make the patterns easier to learn by the LSTM network that uses the sigmoid activation function by default.</p>
<p>Finally, we need to convert the output patterns (single characters converted to integers) into a one hot encoding. This is so that we can configure the network to predict the probability of each of the 47 different characters in the vocabulary (an easier representation) rather than trying to force it to predict precisely the next character. Each y value is converted into a sparse vector with a length of 47, full of zeros except with a 1 in the column for the letter (integer) that the pattern represents.</p>
<p>For example, when “n” (integer value 31) is one hot encoded it looks as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29f5466145404" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[ 0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.
  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  1.  0.  0.  0.  0.
  0.  0.  0.  0.  0.  0.  0.  0.]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29f5466145404-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f5466145404-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29f5466145404-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29f5466145404-1">[ 0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f5466145404-2">  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  0.  1.  0.  0.  0.  0.</div><div class="crayon-line" id="crayon-5a6593ede29f5466145404-3">  0.  0.  0.  0.  0.  0.  0.  0.]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can implement these steps as below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29f7310889841" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29f7310889841-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f7310889841-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29f7310889841-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f7310889841-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede29f7310889841-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29f7310889841-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29f7310889841-1"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f7310889841-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29f7310889841-3"><span class="crayon-p"># normalize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f7310889841-4"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29f7310889841-5"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29f7310889841-6"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can now define our LSTM model. Here we define a single hidden LSTM layer with 256 memory units. The network uses dropout with a probability of 20. The output layer is a Dense layer using the softmax activation function to output a probability prediction for each of the 47 characters between 0 and 1.</p>
<p>The problem is really a single character classification problem with 47 classes and as such is defined as optimizing the log loss (cross entropy), here using the ADAM optimization algorithm for speed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29fa717837254" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29fa717837254-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29fa717837254-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29fa717837254-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29fa717837254-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede29fa717837254-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29fa717837254-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29fa717837254-1"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29fa717837254-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29fa717837254-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29fa717837254-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede29fa717837254-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29fa717837254-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>There is no test dataset. We are modeling the entire training dataset to learn the probability of each character in a sequence.</p>
<p>We are not interested in the most accurate (classification accuracy) model of the training dataset. This would be a model that predicts each character in the training dataset perfectly. Instead we are interested in a generalization of the dataset that minimizes the chosen loss function. We are seeking a balance between generalization and overfitting but short of memorization.</p>
<p>The network is slow to train (about 300 seconds per epoch on an Nvidia K520 GPU). Because of the slowness and because of our optimization requirements, we will use model checkpointing to record all of the network weights to file each time an improvement in loss is observed at the end of the epoch. We will use the best set of weights (lowest loss) to instantiate our generative model in the next section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29fd128265674" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29fd128265674-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29fd128265674-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede29fd128265674-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede29fd128265674-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29fd128265674-1"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29fd128265674-2"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"</span></div><div class="crayon-line" id="crayon-5a6593ede29fd128265674-3"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede29fd128265674-4"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can now fit our model to the data. Here we use a modest number of 20 epochs and a large batch size of 128 patterns.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede29ff976641601" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.fit(X, y, epochs=20, batch_size=128, callbacks=callbacks_list)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede29ff976641601-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede29ff976641601-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The full code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a01676705648" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Small LSTM Network to Generate Text for Alice in Wonderland
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename).read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]
# fit the model
model.fit(X, y, epochs=20, batch_size=128, callbacks=callbacks_list)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-16">16</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-18">18</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-20">20</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-22">22</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-24">24</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-26">26</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-28">28</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-30">30</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-32">32</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-34">34</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-36">36</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-38">38</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-40">40</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-42">42</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-44">44</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-46">46</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a01676705648-48">48</div><div class="crayon-num" data-line="crayon-5a6593ede2a01676705648-49">49</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a01676705648-1"><span class="crayon-p"># Small LSTM Network to Generate Text for Alice in Wonderland</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-9"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-10"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-11"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-13"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-14"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-15"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-16"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-17"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-18"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-19"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-20"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-21"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-22"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-23"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-24"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-25"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-26"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-27"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-28"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-29"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-30"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-31"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-32"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-33"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-34"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-36"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-37"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-38"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-39"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-44"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-45"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-46"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-47"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a01676705648-48"><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5a6593ede2a01676705648-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0037 seconds] -->
<p>You will see different results because of the stochastic nature of the model, and because it is hard to fix the random seed for LSTM models to get 100% reproducible results. This is not a concern for this generative model.</p>
<p>After running the example, you should have a number of weight checkpoint files in the local directory.</p>
<p>You can delete them all except the one with the smallest loss value. For example, when I ran this example, below was the checkpoint with the smallest loss that I achieved.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a05636118593" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
weights-improvement-19-1.9435.hdf5</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a05636118593-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a05636118593-1">weights-improvement-19-1.9435.hdf5</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The network loss decreased almost every epoch and I expect the network could benefit from training for many more epochs.</p>
<p>In the next section we will look at using this model to generate new text sequences.</p>
<h2>Generating Text with an LSTM Network</h2>
<p>Generating text using the trained LSTM network is relatively straightforward.</p>
<p>Firstly, we load the data and define the network in exactly the same way, except the network weights are loaded from a checkpoint file and the network does not need to be trained.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a07609343217" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load the network weights
filename = "weights-improvement-19-1.9435.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a07609343217-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a07609343217-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a07609343217-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a07609343217-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a07609343217-1"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a07609343217-2"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-19-1.9435.hdf5"</span></div><div class="crayon-line" id="crayon-5a6593ede2a07609343217-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a07609343217-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Also, when preparing the mapping of unique characters to integers, we must also create a reverse mapping that we can use to convert the integers back to characters so that we can understand the predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a09221850067" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
int_to_char = dict((i, c) for i, c in enumerate(chars))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a09221850067-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a09221850067-1"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Finally, we need to actually make predictions.</p>
<p>The simplest way to use the Keras LSTM model to make predictions is to first start off with a seed sequence as input, generate the next character then update the seed sequence to add the generated character on the end and trim off the first character. This process is repeated for as long as we want to predict new characters (e.g. a sequence of 1,000 characters in length).</p>
<p>We can pick a random input pattern as our seed sequence, then print generated characters as we generate them.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a0c249682743" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0c249682743-16">16</div><div class="crayon-num" data-line="crayon-5a6593ede2a0c249682743-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-1"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-2"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-3"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-4"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-5"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-6"><span class="crayon-p"># generate characters</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-7"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-8"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-9"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-10"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-11"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-12"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-13"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-14"><span class="crayon-h"> </span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-15"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0c249682743-16"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0c249682743-17"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>The full code example for generating text using the loaded LSTM model is listed below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a0e710616967" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Load LSTM network and generate text
import sys
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename).read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers, and a reverse mapping
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
int_to_char = dict((i, c) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2])))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
# load the network weights
filename = "weights-improvement-19-1.9435.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-16">16</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-18">18</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-20">20</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-22">22</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-24">24</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-26">26</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-28">28</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-30">30</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-32">32</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-34">34</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-36">36</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-38">38</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-40">40</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-42">42</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-44">44</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-46">46</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-48">48</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-50">50</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-52">52</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-54">54</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-56">56</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-58">58</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-60">60</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-62">62</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a0e710616967-64">64</div><div class="crayon-num" data-line="crayon-5a6593ede2a0e710616967-65">65</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-1"><span class="crayon-p"># Load LSTM network and generate text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-2"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-3"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-10"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-11"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-13"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-14"><span class="crayon-p"># create mapping of unique chars to integers, and a reverse mapping</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-15"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-16"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-17"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-18"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-19"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-20"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-21"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-22"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-23"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-24"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-25"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-26"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-28"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-29"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-30"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-31"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-32"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-33"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-34"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-36"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-37"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-38"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-39"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-40"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-45"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-46"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-19-1.9435.hdf5"</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-47"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-48"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-49"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-50"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-51"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-52"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-53"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-54"><span class="crayon-p"># generate characters</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-55"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-56"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-57"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-58"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-59"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-60"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-61"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-62"><span class="crayon-h"> </span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-63"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a0e710616967-64"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a0e710616967-65"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0052 seconds] -->
<p>Running this example first outputs the selected random seed, then each character as it is generated.</p>
<p>For example, below are the results from one run of this text generator. The random seed was:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a12373037213" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
be no mistake about it: it was neither more nor less than a pig, and she
felt that it would be quit</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a12373037213-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a12373037213-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a12373037213-1">be no mistake about it: it was neither more nor less than a pig, and she</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a12373037213-2">felt that it would be quit</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The generated text with the random seed (cleaned up for presentation) was:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a14517743992" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
be no mistake about it: it was neither more nor less than a pig, and she
felt that it would be quit e aelin that she was a little want oe toiet
ano a grtpersent to the tas a little war th tee the tase oa teettee
the had been tinhgtt a little toiee at the cadl in a long tuiee aedun
thet sheer was a little tare gereen to be a gentle of the tabdit  soenee
the gad  ouw ie the tay a tirt of toiet at the was a little 
anonersen, and thiu had been woite io a lott of tueh a tiie  and taede
bot her aeain  she cere thth the bene tith the tere bane to tee
toaete to tee the harter was a little tire the same oare cade an anl ano
the garee and the was so seat the was a little gareen and the sabdit,
and the white rabbit wese tilel an the caoe and the sabbit se teeteer,
and the white rabbit wese tilel an the cade in a lonk tfne the sabdi
ano aroing to tea the was sf teet whitg the was a little tane oo thete
the sabeit  she was a little tartig to the tar tf tee the tame of the
cagd, and the white rabbit was a little toiee to be anle tite thete ofs
and the tabdit was the wiite rabbit, and</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a14517743992-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a14517743992-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a14517743992-1">be no mistake about it: it was neither more nor less than a pig, and she</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-2">felt that it would be quit e aelin that she was a little want oe toiet</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-3">ano a grtpersent to the tas a little war th tee the tase oa teettee</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-4">the had been tinhgtt a little toiee at the cadl in a long tuiee aedun</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-5">thet sheer was a little tare gereen to be a gentle of the tabdit  soenee</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-6">the gad  ouw ie the tay a tirt of toiet at the was a little </div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-7">anonersen, and thiu had been woite io a lott of tueh a tiie  and taede</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-8">bot her aeain  she cere thth the bene tith the tere bane to tee</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-9">toaete to tee the harter was a little tire the same oare cade an anl ano</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-10">the garee and the was so seat the was a little gareen and the sabdit,</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-11">and the white rabbit wese tilel an the caoe and the sabbit se teeteer,</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-12">and the white rabbit wese tilel an the cade in a lonk tfne the sabdi</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-13">ano aroing to tea the was sf teet whitg the was a little tane oo thete</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-14">the sabeit  she was a little tartig to the tar tf tee the tame of the</div><div class="crayon-line" id="crayon-5a6593ede2a14517743992-15">cagd, and the white rabbit was a little toiee to be anle tite thete ofs</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a14517743992-16">and the tabdit was the wiite rabbit, and</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can note some observations about the generated text.</p>
<ul>
<li>It generally conforms to the line format observed in the original text of less than 80 characters before a new line.</li>
<li>The characters are separated into word-like groups and most groups are actual English words (e.g. “the”, “little” and “was”), but many do not (e.g. “lott”, “tiie” and “taede”).</li>
<li>Some of the words in sequence make sense(e.g. “<em>and the white rabbit</em>“), but many do not (e.g. “<em>wese tilel</em>“).</li>
</ul>
<p>The fact that this character based model of the book produces output like this is very impressive. It gives you a sense of the learning capabilities of LSTM networks.</p>
<p>The results are not perfect. In the next section we look at improving the quality of results by developing a much larger LSTM network.</p>
<h2>Larger LSTM Recurrent Neural Network</h2>
<p>We got results, but not excellent results in the previous section. Now, we can try to improve the quality of the generated text by creating a much larger network.</p>
<p>We will keep the number of memory units the same at 256, but add a second layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a18168274358" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a18168274358-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a18168274358-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a18168274358-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a18168274358-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a18168274358-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a18168274358-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a18168274358-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a18168274358-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a18168274358-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a18168274358-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a18168274358-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a18168274358-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a18168274358-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a18168274358-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We will also change the filename of the checkpointed weights so that we can tell the difference between weights for this network and the previous (by appending the word “bigger” in the filename).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a1a954698238" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
filepath="weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a1a954698238-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a1a954698238-1"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, we will increase the number of training epochs from 20 to 50 and decrease the batch size from 128 to 64 to give the network more of an opportunity to be updated and learn.</p>
<p>The full code listing is presented below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a1c851714748" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Larger LSTM Network to Generate Text for Alice in Wonderland
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename).read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam')
# define the checkpoint
filepath="weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"
checkpoint = ModelCheckpoint(filepath, monitor='loss', verbose=1, save_best_only=True, mode='min')
callbacks_list = [checkpoint]
# fit the model
model.fit(X, y, epochs=50, batch_size=64, callbacks=callbacks_list)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-16">16</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-18">18</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-20">20</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-22">22</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-24">24</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-26">26</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-28">28</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-30">30</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-32">32</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-34">34</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-36">36</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-38">38</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-40">40</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-42">42</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-44">44</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-46">46</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-48">48</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a1c851714748-50">50</div><div class="crayon-num" data-line="crayon-5a6593ede2a1c851714748-51">51</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-1"><span class="crayon-p"># Larger LSTM Network to Generate Text for Alice in Wonderland</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-9"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-10"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-11"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-13"><span class="crayon-p"># create mapping of unique chars to integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-14"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-15"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-16"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-17"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-18"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-19"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-20"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-21"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-22"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-23"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-24"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-25"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-26"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-27"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-28"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-29"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-30"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-31"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-32"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-33"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-34"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-36"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-37"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-38"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-39"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-45"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-46"><span class="crayon-p"># define the checkpoint</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-47"><span class="crayon-v">filepath</span><span class="crayon-o">=</span><span class="crayon-s">"weights-improvement-{epoch:02d}-{loss:.4f}-bigger.hdf5"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-48"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filepath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-49"><span class="crayon-v">callbacks_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a1c851714748-50"><span class="crayon-p"># fit the model</span></div><div class="crayon-line" id="crayon-5a6593ede2a1c851714748-51"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-v">callbacks_list</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>Running this example takes some time, at least 700 seconds per epoch.</p>
<p>After running this example you may achieved a loss of about 1.2. For example the best result I achieved from running this model was stored in a checkpoint file with the name:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a24379590951" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
weights-improvement-47-1.2219-bigger.hdf5</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a24379590951-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a24379590951-1">weights-improvement-47-1.2219-bigger.hdf5</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Achieving a loss of 1.2219 at epoch 47.</p>
<p>As in the previous section, we can use this best model from the run to generate text.</p>
<p>The only change we need to make to the text generation script from the previous section is in the specification of the network topology and from which file to seed the network weights.</p>
<p>The full code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a27069378843" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Load Larger LSTM network and generate text
import sys
import numpy
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Dropout
from keras.layers import LSTM
from keras.callbacks import ModelCheckpoint
from keras.utils import np_utils
# load ascii text and covert to lowercase
filename = "wonderland.txt"
raw_text = open(filename).read()
raw_text = raw_text.lower()
# create mapping of unique chars to integers, and a reverse mapping
chars = sorted(list(set(raw_text)))
char_to_int = dict((c, i) for i, c in enumerate(chars))
int_to_char = dict((i, c) for i, c in enumerate(chars))
# summarize the loaded data
n_chars = len(raw_text)
n_vocab = len(chars)
print "Total Characters: ", n_chars
print "Total Vocab: ", n_vocab
# prepare the dataset of input to output pairs encoded as integers
seq_length = 100
dataX = []
dataY = []
for i in range(0, n_chars - seq_length, 1):
	seq_in = raw_text[i:i + seq_length]
	seq_out = raw_text[i + seq_length]
	dataX.append([char_to_int[char] for char in seq_in])
	dataY.append(char_to_int[seq_out])
n_patterns = len(dataX)
print "Total Patterns: ", n_patterns
# reshape X to be [samples, time steps, features]
X = numpy.reshape(dataX, (n_patterns, seq_length, 1))
# normalize
X = X / float(n_vocab)
# one hot encode the output variable
y = np_utils.to_categorical(dataY)
# define the LSTM model
model = Sequential()
model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]), return_sequences=True))
model.add(Dropout(0.2))
model.add(LSTM(256))
model.add(Dropout(0.2))
model.add(Dense(y.shape[1], activation='softmax'))
# load the network weights
filename = "weights-improvement-47-1.2219-bigger.hdf5"
model.load_weights(filename)
model.compile(loss='categorical_crossentropy', optimizer='adam')
# pick a random seed
start = numpy.random.randint(0, len(dataX)-1)
pattern = dataX[start]
print "Seed:"
print "\"", ''.join([int_to_char[value] for value in pattern]), "\""
# generate characters
for i in range(1000):
	x = numpy.reshape(pattern, (1, len(pattern), 1))
	x = x / float(n_vocab)
	prediction = model.predict(x, verbose=0)
	index = numpy.argmax(prediction)
	result = int_to_char[index]
	seq_in = [int_to_char[value] for value in pattern]
	sys.stdout.write(result)
	pattern.append(index)
	pattern = pattern[1:len(pattern)]
print "\nDone."</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-16">16</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-18">18</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-20">20</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-22">22</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-24">24</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-26">26</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-28">28</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-30">30</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-32">32</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-34">34</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-36">36</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-38">38</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-40">40</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-42">42</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-44">44</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-46">46</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-48">48</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-50">50</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-52">52</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-54">54</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-56">56</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-58">58</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-60">60</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-62">62</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-64">64</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a27069378843-66">66</div><div class="crayon-num" data-line="crayon-5a6593ede2a27069378843-67">67</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a27069378843-1"><span class="crayon-p"># Load Larger LSTM network and generate text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-2"><span class="crayon-e">import </span><span class="crayon-e">sys</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-3"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-e">ModelCheckpoint</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">np_utils</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-10"><span class="crayon-p"># load ascii text and covert to lowercase</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-11"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"wonderland.txt"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-12"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-13"><span class="crayon-v">raw_text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-14"><span class="crayon-p"># create mapping of unique chars to integers, and a reverse mapping</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-15"><span class="crayon-v">chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sorted</span><span class="crayon-sy">(</span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-16"><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-17"><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-18"><span class="crayon-p"># summarize the loaded data</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-19"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-20"><span class="crayon-v">n_vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">chars</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-21"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Characters: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">n_chars</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-22"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Vocab: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_vocab</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-23"><span class="crayon-p"># prepare the dataset of input to output pairs encoded as integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-24"><span class="crayon-v">seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-25"><span class="crayon-v">dataX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-26"><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-28"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-29"><span class="crayon-h"> </span><span class="crayon-v">seq_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_text</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-30"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-31"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-v">seq_out</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-32"><span class="crayon-v">n_patterns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-33"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Total Patterns: "</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-34"><span class="crayon-p"># reshape X to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-35"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">n_patterns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-36"><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-37"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-38"><span class="crayon-p"># one hot encode the output variable</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-39"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np_utils</span><span class="crayon-sy">.</span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-40"><span class="crayon-p"># define the LSTM model</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">256</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-45"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-46"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-47"><span class="crayon-p"># load the network weights</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-48"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"weights-improvement-47-1.2219-bigger.hdf5"</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">load_weights</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-50"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-51"><span class="crayon-p"># pick a random seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-52"><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-53"><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">[</span><span class="crayon-v">start</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-54"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"Seed:"</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-55"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"\""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-56"><span class="crayon-p"># generate characters</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-58"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-59"><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">n_vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-60"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-61"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-62"><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-63"><span class="crayon-h"> </span><span class="crayon-v">seq_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-64"><span class="crayon-h"> </span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-65"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a27069378843-66"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6593ede2a27069378843-67"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"\nDone."</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>One example of running this text generation script produces the output below.</p>
<p>The randomly chosen seed text was:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a2b753247261" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
d herself lying on the bank, with her
head in the lap of her sister, who was gently brushing away s</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a2b753247261-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2b753247261-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a2b753247261-1">d herself lying on the bank, with her</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2b753247261-2">head in the lap of her sister, who was gently brushing away s</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The generated text with the seed (cleaned up for presentation) was :</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede2a2d987676707" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
herself lying on the bank, with her
head in the lap of her sister, who was gently brushing away
so siee, and she sabbit said to herself and the sabbit said to herself and the sood
way of the was a little that she was a little lad good to the garden,
and the sood of the mock turtle said to herself, 'it was a little that
the mock turtle said to see it said to sea it said to sea it say it
the marge hard sat hn a little that she was so sereated to herself, and
she sabbit said to herself, 'it was a little little shated of the sooe
of the coomouse it was a little lad good to the little gooder head. and
said to herself, 'it was a little little shated of the mouse of the
good of the courte, and it was a little little shated in a little that
the was a little little shated of the thmee said to see it was a little
book of the was a little that she was so sereated to hare a little the
began sitee of the was of the was a little that she was so seally and
the sabbit was a little lad good to the little gooder head of the gad
seared to see it was a little lad good to the little good</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-2">2</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-4">4</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-6">6</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-8">8</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-10">10</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-12">12</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-14">14</div><div class="crayon-num" data-line="crayon-5a6593ede2a2d987676707-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6593ede2a2d987676707-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-1">herself lying on the bank, with her</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-2">head in the lap of her sister, who was gently brushing away</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-3">so siee, and she sabbit said to herself and the sabbit said to herself and the sood</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-4">way of the was a little that she was a little lad good to the garden,</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-5">and the sood of the mock turtle said to herself, 'it was a little that</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-6">the mock turtle said to see it said to sea it said to sea it say it</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-7">the marge hard sat hn a little that she was so sereated to herself, and</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-8">she sabbit said to herself, 'it was a little little shated of the sooe</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-9">of the coomouse it was a little lad good to the little gooder head. and</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-10">said to herself, 'it was a little little shated of the mouse of the</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-11">good of the courte, and it was a little little shated in a little that</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-12">the was a little little shated of the thmee said to see it was a little</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-13">book of the was a little that she was so sereated to hare a little the</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-14">began sitee of the was of the was a little that she was so seally and</div><div class="crayon-line" id="crayon-5a6593ede2a2d987676707-15">the sabbit was a little lad good to the little gooder head of the gad</div><div class="crayon-line crayon-striped-line" id="crayon-5a6593ede2a2d987676707-16">seared to see it was a little lad good to the little good</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that generally there are fewer spelling mistakes and the text looks more realistic, but is still quite nonsensical.</p>
<p>For example the same phrases get repeated again and again like “<em>said to herself</em>” and “<em>little</em>“. Quotes are opened but not closed.</p>
<p>These are better results but there is still a lot of room for improvement.</p>
<h2>10 Extension Ideas to Improve the Model</h2>
<p>Below are 10 ideas that may further improve the model that you could experiment with are:</p>
<ul>
<li>Predict fewer than 1,000 characters as output for a given seed.</li>
<li>Remove all punctuation from the source text, and therefore from the models’ vocabulary.</li>
<li>Try a one hot encoded for the input sequences.</li>
<li>Train the model on padded sentences rather than random sequences of characters.</li>
<li>Increase the number of training epochs to 100 or many hundreds.</li>
<li>Add dropout to the visible input layer and consider tuning the dropout percentage.</li>
<li>Tune the batch size, try a batch size of 1 as a (very slow) baseline and larger sizes from there.</li>
<li>Add more memory units to the layers and/or more layers.</li>
<li>Experiment with scale factors (<a href="https://en.wikipedia.org/wiki/Softmax_function#Reinforcement_learning">temperature</a>) when interpreting the prediction probabilities.</li>
<li>Change the LSTM layers to be “stateful” to maintain state across batches.</li>
</ul>
<p>Did you try any of these extensions? Share your results in the comments.</p>
<h2>Resources</h2>
<p>This character text model is a popular way for generating text using recurrent neural networks.</p>
<p>Below are some more resources and tutorials on the topic if you are interested in going deeper. Perhaps the most popular is the tutorial by Andrej Karpathy titled “<a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a>“.</p>
<ul>
<li><a href="http://www.cs.utoronto.ca/~ilya/pubs/2011/LANG-RNN.pdf">Generating Text with Recurrent Neural Networks</a> [pdf], 2011</li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py">Keras code example of LSTM for text generation</a>.</li>
<li><a href="https://github.com/Lasagne/Recipes/blob/master/examples/lstm_text_generation.py">Lasagne code example of LSTM for text generation</a>.</li>
<li><a href="http://mxnetjl.readthedocs.io/en/latest/tutorial/char-lstm.html">MXNet tutorial for using an LSTM for text generation</a>.</li>
<li><a href="https://larseidnes.com/2015/10/13/auto-generating-clickbait-with-recurrent-neural-networks/">Auto-Generating Clickbait With Recurrent Neural Networks</a>.</li>
</ul>
<h2>Summary</h2>
<p>In this post you discovered how you can develop an LSTM recurrent neural network for text generation in Python with the Keras deep learning library.</p>
<p>After reading this post you know:</p>
<ul>
<li>Where to download the ASCII text for classical books for free that you can use for training.</li>
<li>How to train an LSTM network on text sequences and how to use the trained network to generate new sequences.</li>
<li>How to develop stacked LSTM networks and lift the performance of the model.</li>
</ul>
<p>Do you have any questions about text generation with LSTM networks or about this post? Ask your questions in the comments below and I will do my best to answer them.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftext-generation-lstm-recurrent-neural-networks-python-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/&amp;summary=Recurrent+neural+networks+can+also+be+used+as+generative+models.%0D%0A%0D%0AThis+means+that+in+addition+to+b..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Text%20Generation%20With%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/&amp;summary=Recurrent+neural+networks+can+also+be+used+as+generative+models.%0D%0A%0D%0AThis+means+that+in+addition+to+b...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/save-machine-learning-model-make-predictions-weka/" rel="prev"><i class="fa fa-angle-left"></i> How to Save Your Machine Learning Model and Make Predictions in Weka</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/multi-class-classification-tutorial-weka/" rel="next">How To Work Through a Multi-Class Classification Project in Weka <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">193 Responses to <em>Text Generation With LSTM Recurrent Neural Networks in Python with Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-359710">
<div class="comment-container" id="li-comment-359710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cf89bfd507ec9e103178f2ec5ba4693d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cf89bfd507ec9e103178f2ec5ba4693d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Avi Levy</span>
<span class="date">August 12, 2016 at 10:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-359710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post. Thanks!</p>
<div class="reply">
<a aria-label="Reply to Avi Levy" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=359710#respond" onclick='return addComment.moveForm( "comment-359710", "359710", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-360043">
<div class="comment-container" id="li-comment-360043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2016 at 12:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-360043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome Avi.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=360043#respond" onclick='return addComment.moveForm( "comment-360043", "360043", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-412097">
<div class="comment-container" id="li-comment-412097">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ed1f2824b9eb6b6a70b006f2ab520ec5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ed1f2824b9eb6b6a70b006f2ab520ec5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shreyas</span>
<span class="date">September 2, 2017 at 3:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412097" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
when i try to run the codes, I get an error with the weights file.<br/>
ValueError: Dimension 1 in both shapes must be equal, but are 52 and 44 for Assign_13 with input shapes [256,52], [256,44].<br/>
Can you please let me know what is happening</p>
<div class="reply">
<a aria-label="Reply to Shreyas" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412097#respond" onclick='return addComment.moveForm( "comment-412097", "412097", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-412123">
<div class="comment-container" id="li-comment-412123">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412123" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Confirm that you have copied and run all of the code and that your environment and libraries are all up to date.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412123#respond" onclick='return addComment.moveForm( "comment-412123", "412123", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-412367">
<div class="comment-container" id="li-comment-412367">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8ce29dd4de59026a0e82c4fd497c288?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8ce29dd4de59026a0e82c4fd497c288?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shreyas Becker Lalitha Venkatramanan</span>
<span class="date">September 3, 2017 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412367" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Just updated all libraries. Still getting the same error.<br/>
Thanks!<br/>
–</p>
<div class="reply">
<a aria-label="Reply to Shreyas Becker Lalitha Venkatramanan" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412367#respond" onclick='return addComment.moveForm( "comment-412367", "412367", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-412394">
<div class="comment-container" id="li-comment-412394">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 3, 2017 at 3:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412394" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, it is not clear to me what your fault could be.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-412422">
<div class="comment-container" id="li-comment-412422">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8ce29dd4de59026a0e82c4fd497c288?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8ce29dd4de59026a0e82c4fd497c288?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shreyas Becker Lalitha Venkatramanan</span>
<span class="date">September 3, 2017 at 8:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412422" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,<br/>
Thanks. I got it to work now!!! But I am getting random results will work on it further. But i feel like it is a good start. Thanks for the codes!<br/>
Thanks!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-412466">
<div class="comment-container" id="li-comment-412466">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412466" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done on your progress, hang in there!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-360198">
<div class="comment-container" id="li-comment-360198">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/25324eaaa5ea3f6b93698807406d6f2c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/25324eaaa5ea3f6b93698807406d6f2c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max</span>
<span class="date">August 16, 2016 at 3:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-360198" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m excited to try combining this with nltk… it’s probably going to be long and frustrating, but I’ll try to let you know my results.</p>
<p>Thanks for sharing!</p>
<div class="reply">
<a aria-label="Reply to Max" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=360198#respond" onclick='return addComment.moveForm( "comment-360198", "360198", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-360268">
<div class="comment-container" id="li-comment-360268">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2016 at 9:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-360268" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good luck Max, report back and let us know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=360268#respond" onclick='return addComment.moveForm( "comment-360268", "360268", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-394193">
<div class="comment-container" id="li-comment-394193">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/611be5a4a6b239d6a178baf7bcc05ba9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/611be5a4a6b239d6a178baf7bcc05ba9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Al</span>
<span class="date">March 26, 2017 at 7:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-394193" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Max, </p>
<p>Did you get anywhere with combining NLTK with this?<br/>
Just curious…</p>
<div class="reply">
<a aria-label="Reply to Al" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=394193#respond" onclick='return addComment.moveForm( "comment-394193", "394193", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-364150">
<div class="comment-container" id="li-comment-364150">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c55c0ec7a60d9936c88f50d99696d4b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c55c0ec7a60d9936c88f50d99696d4b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sviat</span>
<span class="date">September 10, 2016 at 10:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-364150" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I really like your article, thank you for sharing. I can launch your code but I have a crash after finalization of 1st epoch:<br/>
—————————————————<br/>
Traceback (most recent call last):<br/>
  File “train.py”, line 61, in<br/>
    model.fit(X, y, nb_epoch=20, batch_size=128, callbacks=callbacks_list)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/models.py”, line 620, in fit<br/>
    sample_weight=sample_weight)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/engine/training.py”, line 1104, in fit<br/>
    callback_metrics=callback_metrics)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/engine/training.py”, line 842, in _fit_loop<br/>
    callbacks.on_epoch_end(epoch, epoch_logs)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/callbacks.py”, line 40, in on_epoch_end<br/>
    callback.on_epoch_end(epoch, logs)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/callbacks.py”, line 296, in on_epoch_end<br/>
    self.model.save(filepath, overwrite=True)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/engine/topology.py”, line 2427, in save<br/>
    save_model(self, filepath, overwrite)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/models.py”, line 56, in save_model<br/>
    model.save_weights_to_hdf5_group(model_weights_group)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/keras/engine/topology.py”, line 2476, in save_weights_to_hdf5_group<br/>
    dtype=val.dtype)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/h5py/_hl/group.py”, line 108, in create_dataset<br/>
    self[name] = dset<br/>
  File “_objects.pyx”, line 54, in h5py._objects.with_phil.wrapper (/scratch/pip_build_sbilokin/h5py/h5py/_objects.c:2513)<br/>
  File “_objects.pyx”, line 55, in h5py._objects.with_phil.wrapper (/scratch/pip_build_sbilokin/h5py/h5py/_objects.c:2466)<br/>
  File “/afs/in2p3.fr/home/s/sbilokin/.local/lib/python2.7/site-packages/h5py/_hl/group.py”, line 277, in __setitem__<br/>
    h5o.link(obj.id, self.id, name, lcpl=lcpl, lapl=self._lapl)<br/>
  File “_objects.pyx”, line 54, in h5py._objects.with_phil.wrapper (/scratch/pip_build_sbilokin/h5py/h5py/_objects.c:2513)<br/>
  File “_objects.pyx”, line 55, in h5py._objects.with_phil.wrapper (/scratch/pip_build_sbilokin/h5py/h5py/_objects.c:2466)<br/>
  File “h5o.pyx”, line 202, in h5py.h5o.link (/scratch/pip_build_sbilokin/h5py/h5py/h5o.c:3726)</p>
<p>RuntimeError: Unable to create link (Name already exists)<br/>
—————————————————–<br/>
The file names are unique, probably there is a collision of names in keras or h5py for me.<br/>
Could you help me please?</p>
<div class="reply">
<a aria-label="Reply to Sviat" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=364150#respond" onclick='return addComment.moveForm( "comment-364150", "364150", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-364190">
<div class="comment-container" id="li-comment-364190">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c55c0ec7a60d9936c88f50d99696d4b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c55c0ec7a60d9936c88f50d99696d4b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sviat</span>
<span class="date">September 11, 2016 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-364190" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Found my mistake, I didn’t edit topology.py in keras correctly to fix another problem. </p>
<p>This is my second attempt to study NN, but I always have problems with versions, errors, dependencies and this scares me away.<br/>
For example now I have a problem to load the weights, using the example above on python 3 with intermediate weight files: </p>
<p>Traceback (most recent call last):<br/>
  File “bot.py”, line 49, in<br/>
    model.load_weights(filename)<br/>
  File “.local/lib/python3.3/site-packages/keras/engine/topology.py”, line 2490, in load_weights<br/>
    self.load_weights_from_hdf5_group(f)<br/>
  File “.local/lib/python3.3/site-packages/keras/engine/topology.py”, line 2533, in load_weights_from_hdf5_group<br/>
    weight_names = [n.decode(‘utf8’) for n in g.attrs[‘weight_names’]]<br/>
  File “h5py/_objects.pyx”, line 54, in h5py._objects.with_phil.wrapper (/scratch/pip_build_/h5py/h5py/_objects.c:2691)<br/>
  File “h5py/_objects.pyx”, line 55, in h5py._objects.with_phil.wrapper (/scratch/pip_build_/h5py/h5py/_objects.c:2649)<br/>
  File “/.local/lib/python3.3/site-packages/h5py/_hl/attrs.py”, line 58, in __getitem__<br/>
    attr = h5a.open(self._id, self._e(name))<br/>
  File “h5py/_objects.pyx”, line 54, in h5py._objects.with_phil.wrapper (/scratch/pip_build_/h5py/h5py/_objects.c:2691)<br/>
  File “h5py/_objects.pyx”, line 55, in h5py._objects.with_phil.wrapper (/scratch/pip_build_/h5py/h5py/_objects.c:2649)<br/>
  File “h5py/h5a.pyx”, line 77, in h5py.h5a.open (/scratch/pip_build_/h5py/h5py/h5a.c:2179)<br/>
KeyError: “Can’t open attribute (Can’t locate attribute)”</p>
<div class="reply">
<a aria-label="Reply to Sviat" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=364190#respond" onclick='return addComment.moveForm( "comment-364190", "364190", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-364254">
<div class="comment-container" id="li-comment-364254">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 12, 2016 at 8:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-364254" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t think I can give you good advice if you are modifying the Keras framework files. </p>
<p>Good luck!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=364254#respond" onclick='return addComment.moveForm( "comment-364254", "364254", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-364459">
<div class="comment-container" id="li-comment-364459">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e9fa198c16f38c9bcd925a6983918998?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e9fa198c16f38c9bcd925a6983918998?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">September 14, 2016 at 11:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-364459" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I followed your tutorial and then built my own sequence-to-sequence model, trained at word level.<br/>
Might soon share results and code, but wanted first to thank you for the great post, helped me a lot getting started with Keras.</p>
<p>Keep up the amazing work!</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=364459#respond" onclick='return addComment.moveForm( "comment-364459", "364459", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-364493">
<div class="comment-container" id="li-comment-364493">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2016 at 8:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-364493" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great, well done Alex. It would be cool if you can post or link to your code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=364493#respond" onclick='return addComment.moveForm( "comment-364493", "364493", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-365205">
<div class="comment-container" id="li-comment-365205">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">September 22, 2016 at 2:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365205" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I try to get the unique set of characters:<br/>
I get the following:<br/>
[‘\n’, ‘ ‘, ‘!’, ‘”‘, “‘”, ‘(‘, ‘)’, ‘*’, ‘,’, ‘-‘, ‘.’, ‘:’, ‘;’, ‘?’, ‘[‘, ‘]’, ‘_’, ‘a’, ‘b’, ‘c’, ‘d’, ‘e’, ‘f’, ‘g’, ‘h’, ‘i’, ‘j’, ‘k’, ‘l’, ‘m’, ‘n’, ‘o’, ‘p’, ‘q’, ‘r’, ‘s’, ‘t’, ‘u’, ‘v’, ‘w’, ‘x’, ‘y’, ‘z’, ‘\xbb’, ‘\xbf’, ‘\xef’]</p>
<p>Note, that the ‘\r’ is missing, why ?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365205#respond" onclick='return addComment.moveForm( "comment-365205", "365205", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365239">
<div class="comment-container" id="li-comment-365239">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 22, 2016 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365239" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is not needed on some platforms, like Unix and friends. Only windows uses CRLF.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365239#respond" onclick='return addComment.moveForm( "comment-365239", "365239", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-365245">
<div class="comment-container" id="li-comment-365245">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">September 22, 2016 at 11:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365245" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the reply.<br/>
I am using windows.<br/>
I am running the fitting as I type.<br/>
🙂</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365245#respond" onclick='return addComment.moveForm( "comment-365245", "365245", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-365265">
<div class="comment-container" id="li-comment-365265">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 22, 2016 at 5:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365265" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365265#respond" onclick='return addComment.moveForm( "comment-365265", "365265", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-365290">
<div class="comment-container" id="li-comment-365290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">September 22, 2016 at 11:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your reply, Jason.<br/>
Question:</p>
<p>Can I generate a text book the size of Alice in Wonderland using the same technique ? </p>
<p>And if so, how ? </p>
<p>Do I generate 50,000 characters for example ? </p>
<p>And how do I use a “SEED” to actually generate such a text ? </p>
<p>In the example you are using a 100 characters as a way to breakup the text and expose it to the network. DOES increasing the characters help with producing a more meaningful text ? </p>
<p>And another question ?</p>
<p>How many epochs should I run the fitting ? 100, 200 ? Because the loss keeps decreasing, but if it gets close to zero is that a good thing ?</p>
<p>Sorry for so many questions. </p>
<p>Thank you VERY VERY MUCH 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-365319">
<div class="comment-container" id="li-comment-365319">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2016 at 8:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365319" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great questions, but these are research questions. </p>
<p>You would have to experiment and see.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-393490">
<div class="comment-container" id="li-comment-393490">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.meerkat.com.br/en/" rel="external nofollow">Gustavo Führ</a></span>
<span class="date">March 21, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393490" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I did a similar project, and I removed non ASCII characters using:</p>
<p>ascii_values = ascii_values[np.where(ascii_values &lt; 128)]</p>
<div class="reply">
<a aria-label="Reply to Gustavo Führ" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393490#respond" onclick='return addComment.moveForm( "comment-393490", "393490", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-393523">
<div class="comment-container" id="li-comment-393523">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 21, 2017 at 8:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393523" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tip!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393523#respond" onclick='return addComment.moveForm( "comment-393523", "393523", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-365300">
<div class="comment-container" id="li-comment-365300">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d1f0c5072f789cddfe5e47dba88b464c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d1f0c5072f789cddfe5e47dba88b464c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Landon</span>
<span class="date">September 23, 2016 at 2:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365300" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, nice article. Can you explain why you are using 256 as your output dimension for LSTM? Does the reasoning for 256 come from other parameters?</p>
<div class="reply">
<a aria-label="Reply to Landon" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365300#respond" onclick='return addComment.moveForm( "comment-365300", "365300", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365320">
<div class="comment-container" id="li-comment-365320">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2016 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-365320" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The network only outputs a single character.</p>
<p>There are 256 nodes in the LSTM layers, I chose a large number to increase the representational capacity of the network. I chose it arbitrarily. You could experiment with different values.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=365320#respond" onclick='return addComment.moveForm( "comment-365320", "365320", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-368056">
<div class="comment-container" id="li-comment-368056">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2bdc64ca71151bb2241ec9c17a9ab687?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2bdc64ca71151bb2241ec9c17a9ab687?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lino</span>
<span class="date">October 24, 2016 at 3:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368056" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>awesome explanation. Thanks for sharing</p>
<div class="reply">
<a aria-label="Reply to Lino" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368056#respond" onclick='return addComment.moveForm( "comment-368056", "368056", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-368132">
<div class="comment-container" id="li-comment-368132">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2016 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368132" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad you found it useful Lino.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368132#respond" onclick='return addComment.moveForm( "comment-368132", "368132", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-368352">
<div class="comment-container" id="li-comment-368352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9f2374484a422cd0ca0cc58d732b59eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9f2374484a422cd0ca0cc58d732b59eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shamit</span>
<span class="date">October 27, 2016 at 7:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the nice article. Why do we have to specify the number of times-teps beforehand in LSTM ( in input_shape)? What if different data points have different number of sequence lengths? How can we make keras lstm work in that case?</p>
<div class="reply">
<a aria-label="Reply to Shamit" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368352#respond" onclick='return addComment.moveForm( "comment-368352", "368352", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-368362">
<div class="comment-container" id="li-comment-368362">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 27, 2016 at 7:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368362" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Shamit,</p>
<p>The network needs to know the size of data so that it can prepare efficient data structures (backend computation) for the model.</p>
<p>If you have variable length sequences, you will need to pad them with zeros. Keras offers a padding function for this purpose:<br/>
<a href="https://keras.io/preprocessing/sequence/" rel="nofollow">https://keras.io/preprocessing/sequence/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368362#respond" onclick='return addComment.moveForm( "comment-368362", "368362", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-368405">
<div class="comment-container" id="li-comment-368405">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cbf872d2712e749a5954a201794c3f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cbf872d2712e749a5954a201794c3f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Julian</span>
<span class="date">October 27, 2016 at 6:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368405" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thanks a lot for the code and the easy explanations.</p>
<p>Only a short notice: For the model checkpoints you will need the h5py module which was not preinstalled with my python. I obviously only noticed it after the first epoch, when keras tried to import it. Might be a good idea for people to check before they waste time running the code on slow hardware like I did 🙂</p>
<div class="reply">
<a aria-label="Reply to Julian" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368405#respond" onclick='return addComment.moveForm( "comment-368405", "368405", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-368457">
<div class="comment-container" id="li-comment-368457">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 28, 2016 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-368457" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice one, thanks Julian!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=368457#respond" onclick='return addComment.moveForm( "comment-368457", "368457", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-370455">
<div class="comment-container" id="li-comment-370455">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c097aa48b97a588fc8acf739edf4141d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c097aa48b97a588fc8acf739edf4141d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bruce</span>
<span class="date">November 13, 2016 at 7:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-370455" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>I ran the exact same code of your small LSTM network on the same book(wonderland.txt)  for 20 epochs. But the generated text in my case is not making any sense. A snippet of it is as below:</p>
<p>Seed:<br/>
” e chin.</p>
<p>æiÆve a right to think,Æ said alice sharply, for she was beginning to<br/>
feel a little worried ”</p>
<p>up!uif!tbccju!xp!cf!b!mpsu!pg!uif!tbbufs!bos!uif!ebsufs-!boe!uifo!tif<br/>
xbt!bom!uif!ebuufs!xiui!uif!sbtu!po!uif!!boe!uif!xbt!bpmjoh!up!uif!<br/>
bpvme-</p>
<p>uif!nbuuf!xbt!b!mpsumf!ujfff!up!cf!b!mpsu!pg!uif!tbbufs!bos!uif!ibouf<br/>
uif!tbt!pg!uif!xbt!tp!tff!pg!uif!xbt!pp!bo!bo!pg!tifof!!bou!uif!xbt!bom<br/>
!tif!ibe!tv!co!bo!uif!sbccju!xpvme!cf!bspmpvt!up!tffff!<br/>
uif!ibe!tp!cfe</p>
<p>Could you give some insights on why this is happening and how to fix it?</p>
<div class="reply">
<a aria-label="Reply to Bruce" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=370455#respond" onclick='return addComment.moveForm( "comment-370455", "370455", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-370501">
<div class="comment-container" id="li-comment-370501">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2016 at 7:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-370501" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ouch, something is going on there Bruce.</p>
<p>Perhaps confirm Keras 1.1.0 and TensorFlow 0.10.</p>
<p>It looks like maybe the network was not trained for long enough or the character conversion from ints is not working out. </p>
<p>Also, conform that there were no copy-paste errors.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=370501#respond" onclick='return addComment.moveForm( "comment-370501", "370501", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-371931">
<div class="comment-container" id="li-comment-371931">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0ac16b10b742074e03b18c6dcd59e83?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0ac16b10b742074e03b18c6dcd59e83?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Keerthimanu</span>
<span class="date">November 24, 2016 at 10:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-371931" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to take the seed from user instead of program generating the random text ?</p>
<div class="reply">
<a aria-label="Reply to Keerthimanu" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=371931#respond" onclick='return addComment.moveForm( "comment-371931", "371931", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-371940">
<div class="comment-container" id="li-comment-371940">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2016 at 10:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-371940" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can read from sys.stdin, for example:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede7d96872219395" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
userinput = stdin.readline()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede7d96872219395-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede7d96872219395-1"><span class="crayon-v">userinput</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">stdin</span><span class="crayon-sy">.</span><span class="crayon-e">readline</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=371940#respond" onclick='return addComment.moveForm( "comment-371940", "371940", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-411789">
<div class="comment-container" id="li-comment-411789">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e5f3bbc1efe46eaeff71e014c19f524?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e5f3bbc1efe46eaeff71e014c19f524?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.thetechnologyupdates.com" rel="external nofollow">Srce Cde (Chirag)</a></span>
<span class="date">August 30, 2017 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-411789" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For user input you can use userinput = stdin.readline()</p>
<p>For ex the input is:</p>
<p>userinput = “Alice was beginning to get very tired of sitting by her sister on the bank, and of                                                                        having nothing to”</p>
<p>sort_sen = sorted(list(p))<br/>
pattern = [char_to_int[value.lower()] for value in sort_sen]</p>
<p>This is how you can deal with user input. Hope this helps.</p>
<div class="reply">
<a aria-label="Reply to Srce Cde (Chirag)" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=411789#respond" onclick='return addComment.moveForm( "comment-411789", "411789", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-411847">
<div class="comment-container" id="li-comment-411847">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-411847" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=411847#respond" onclick='return addComment.moveForm( "comment-411847", "411847", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-372590">
<div class="comment-container" id="li-comment-372590">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4b8352e397b4f693a3cd404d566d438?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4b8352e397b4f693a3cd404d566d438?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Victor</span>
<span class="date">November 27, 2016 at 6:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-372590" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you so much for the great post!<br/>
Can you please explain the need to reshape the X ?<br/>
What is wrong with the initial shape of list of lists?<br/>
Thank you!</p>
<div class="reply">
<a aria-label="Reply to Victor" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=372590#respond" onclick='return addComment.moveForm( "comment-372590", "372590", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-372664">
<div class="comment-container" id="li-comment-372664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2016 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-372664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Victor, great question.</p>
<p>All LSTM input must be in the form [samples, timesteps, features]. The data was loaded as [samples, timesteps]. Rather than timesteps, think of sequence – it’s the same thing.</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=372664#respond" onclick='return addComment.moveForm( "comment-372664", "372664", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-373037">
<div class="comment-container" id="li-comment-373037">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ATM</span>
<span class="date">November 30, 2016 at 1:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373037" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Using a similar approach: Can one generate numeric sequences from time series data, much like sentences?  I don’t see a reason why we can’t. Any input is appreciated, Jason. thanks.</p>
<div class="reply">
<a aria-label="Reply to ATM" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373037#respond" onclick='return addComment.moveForm( "comment-373037", "373037", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-373152">
<div class="comment-container" id="li-comment-373152">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 1, 2016 at 7:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373152" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For sure, change the output from one node to n-nodes. </p>
<p>For sequence output, you’ll need a lot more data and a lot more training.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373152#respond" onclick='return addComment.moveForm( "comment-373152", "373152", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-373708">
<div class="comment-container" id="li-comment-373708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ATM</span>
<span class="date">December 4, 2016 at 2:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, but why should we change to n-nodes? Considering you generated a sequence of text, can’t I get a numeric sequence with the same 1 node setup?</p>
<p>Also, I don’t understand “index = numpy.argmax(prediction)<br/>
	result = int_to_char[index]” part of the code. Can you please explain why its necessary?</p>
<p>I’m new to your website….Keep up the great work! Looking to hear from you.</p>
<div class="reply">
<a aria-label="Reply to ATM" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373708#respond" onclick='return addComment.moveForm( "comment-373708", "373708", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-373804">
<div class="comment-container" id="li-comment-373804">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 5, 2016 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373804" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi ATM,</p>
<p>Yes, there are a few ways to frame a sequence prediction problem. You can use a one-step prediction model many times. Another approach is to predict part or the entire sequence at once, and all the levels in between.</p>
<p>The line:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6593ede7c2a482362425" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
index = numpy.argmax(prediction)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6593ede7c2a482362425-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6593ede7c2a482362425-1"><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p>Selects the node with the largest output value. The index of the node is the same as the index of the class to predict.</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373804#respond" onclick='return addComment.moveForm( "comment-373804", "373804", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-374201">
<div class="comment-container" id="li-comment-374201">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/24432ef1db8a6f569eb132c9147bb27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ATM</span>
<span class="date">December 7, 2016 at 5:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-374201" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the clarification, Jason: I got the code running with decent predictions for time series data.</p>
<p>I think you might want to add in the tutorial that prediction usually works well for only somewhat statistically stationary datasets, regardless of training size?</p>
<p>I’ve tried it on both stationary and non-stationary, and I’ve come to this conclusion (which makes sense). Very often, time series collected from both financial and scientific datasets are not stationary, so LSTM has to be used very conservatively.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-374280">
<div class="comment-container" id="li-comment-374280">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 8, 2016 at 8:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-374280" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks ATM! I agree, I’ll be going into a lot more details on stationary time series and making non-stationary data stationary in coming blog posts.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-373941">
<div class="comment-container" id="li-comment-373941">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c0f302f6d7d4f424d466473c7470bb65?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c0f302f6d7d4f424d466473c7470bb65?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sban</span>
<span class="date">December 6, 2016 at 2:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373941" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,<br/>
I have been running this. But thebloss instead of decreasing is always increasing. So far, i ran it for 20 epochs. Do you have any idea what might be the case. I didn’t change anything in the program, though.</p>
<p>Best,<br/>
Sban</p>
<div class="reply">
<a aria-label="Reply to Sban" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373941#respond" onclick='return addComment.moveForm( "comment-373941", "373941", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-374005">
<div class="comment-container" id="li-comment-374005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 6, 2016 at 9:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-374005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe your network is too small? Maybe overlearning?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=374005#respond" onclick='return addComment.moveForm( "comment-374005", "374005", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-373945">
<div class="comment-container" id="li-comment-373945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2155178000a2dc4f1ce818127825887f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2155178000a2dc4f1ce818127825887f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ben</span>
<span class="date">December 6, 2016 at 2:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-373945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello,<br/>
how would you handle a much bigger dataset ? I scraped all public declarations of the French goverment for the past few years so my corpus is Total Characters: 465163150<br/>
Total Vocab: 146<br/>
the dataX and dataY will likely crash due to size constraints, how could I circumvent that issue and use the full dataset ?</p>
<div class="reply">
<a aria-label="Reply to ben" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=373945#respond" onclick='return addComment.moveForm( "comment-373945", "373945", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-374006">
<div class="comment-container" id="li-comment-374006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 6, 2016 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-374006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps read the data in batches from disk – I believe Keras has this capability for images (data generator), perhaps for text too? I’m not sure off hand.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=374006#respond" onclick='return addComment.moveForm( "comment-374006", "374006", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-379486">
<div class="comment-container" id="li-comment-379486">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bda5da78b53cbcb3e2684321ee253b34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bda5da78b53cbcb3e2684321ee253b34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Julian</span>
<span class="date">January 2, 2017 at 5:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-379486" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the example. I wonder about the loss function: categorical cross-entropy. I tried to find the source code but was not successful with it. Do you know what a loss of 1.2 actually means? Is there a unit to this number?</p>
<p>From my understanding, the goal is to somehow get the network to learn a probability distribution for the predictions as similar as possible to the one of the training data. But how similar is 1.2?</p>
<p>Obviously a loss of 0 would mean that the network could accurately predict the target to any given sample with 100% accuracy which is already quite difficult to imagine as the output to this network is not binary but rather a softmax over an array with values for all characters in the vocabulary.</p>
<p>Thanks again.</p>
<div class="reply">
<a aria-label="Reply to Julian" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=379486#respond" onclick='return addComment.moveForm( "comment-379486", "379486", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-379625">
<div class="comment-container" id="li-comment-379625">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 3, 2017 at 7:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-379625" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Julian,</p>
<p>Great question. I need to dedicate a post to this question, thanks for the prompt.</p>
<p>Cross entropy is also called log loss in your googling, the math is here:<br/>
<a href="https://en.wikipedia.org/wiki/Cross_entropy" rel="nofollow">https://en.wikipedia.org/wiki/Cross_entropy</a></p>
<p>I’ll work on a write-up ASAP.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=379625#respond" onclick='return addComment.moveForm( "comment-379625", "379625", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-381487">
<div class="comment-container" id="li-comment-381487">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eyal</span>
<span class="date">January 11, 2017 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-381487" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, thanks for the post, will this work on Theano instead of tensorflow? I understand Keras can work with both, and I am having difficulties installing tensorflow on my mac</p>
<div class="reply">
<a aria-label="Reply to Eyal" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=381487#respond" onclick='return addComment.moveForm( "comment-381487", "381487", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-381594">
<div class="comment-container" id="li-comment-381594">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2017 at 9:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-381594" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the code will work on either backend.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=381594#respond" onclick='return addComment.moveForm( "comment-381594", "381594", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-381914">
<div class="comment-container" id="li-comment-381914">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eyal</span>
<span class="date">January 14, 2017 at 1:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-381914" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, TensorFlow worked after all. I am running the training on a big data like the book with these messages:<br/>
Total Characters:  237084<br/>
Total Vocab:  50<br/>
Total Patterns:  236984</p>
<p>on Epoche 13, loss is 1.5. I had to stop it there since it took my MacBook Pro 20 hours to create 13 epoches. Anyways, this is my result, notice it starts to repeat itself at a certain point:</p>
<p>is all the love and the sain on my baby </p>
<p>bnd i love you to be a line to be a line</p>
<p> to be a line to me, i’m she way the lov</p>
<p>es me down and i do and i do and i do an</p>
<p>d i do and i do and i do and i do and i </p>
<p>do and i do and i do and i do and i do a</p>
<p>nd i do and i do and i do and i do and i</p>
<p> do and i do and i do and i do and i do </p>
<p>and i do and i do and i do and i do and </p>
<p>This is another result from another run of the program:</p>
<p>oe mine i want you to ban tee the sain o</p>
<p>f move and i do and i do and i love you </p>
<p>to be a line to me, i’m she way the way </p>
<p>the way the way the way the way the way </p>
<p>the way the way the way the way the way </p>
<p>the way the way the way the way the way </p>
<p>the way the way the way the way the way </p>
<p>the way the way the way the way the way </p>
<p>This is pretty frustrating (while still incredibly awesome), do you have an idea why this should happen?</p>
<p>Regardless, this is such a great post that gives access to RNN and LSTM in a great nature!</p>
<div class="reply">
<a aria-label="Reply to Eyal" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=381914#respond" onclick='return addComment.moveForm( "comment-381914", "381914", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-381915">
<div class="comment-container" id="li-comment-381915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eyal</span>
<span class="date">January 14, 2017 at 1:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-381915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>maybe it is overfitting?</p>
<div class="reply">
<a aria-label="Reply to Eyal" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=381915#respond" onclick='return addComment.moveForm( "comment-381915", "381915", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-382140">
<div class="comment-container" id="li-comment-382140">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382140" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done!</p>
<p>The network may require greater representational capacity. Try more layers and/or more neurons per layer.</p>
<p>Also try running on AWS to give your poor laptop a break:<br/>
<a href="http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/" rel="nofollow">http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=382140#respond" onclick='return addComment.moveForm( "comment-382140", "382140", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-382690">
<div class="comment-container" id="li-comment-382690">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e1afd3d8a651ea98e062305c024ad72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eyal</span>
<span class="date">January 18, 2017 at 5:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382690" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks! i will also try breaking into words instead of letters. Will update 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-382169">
<div class="comment-container" id="li-comment-382169">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c353c22051e2bed34bd5dc6939bf408?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c353c22051e2bed34bd5dc6939bf408?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://twg.io" rel="external nofollow">Jack</a></span>
<span class="date">January 15, 2017 at 8:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382169" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Would we get better result if we trained the network at the word level instead of character? We would split the dataset into words, index them, the same way we do with the characters, and use them as input. Wouldn’t that at least eliminate the made up words in the generated text making it seem more plausible?</p>
<div class="reply">
<a aria-label="Reply to Jack" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=382169#respond" onclick='return addComment.moveForm( "comment-382169", "382169", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-382376">
<div class="comment-container" id="li-comment-382376">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2017 at 10:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382376" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yep. Try it out Jack! I’d love to see the result.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=382376#respond" onclick='return addComment.moveForm( "comment-382376", "382376", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-382658">
<div class="comment-container" id="li-comment-382658">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a4f2c178ce3fb2bca76c23ac015b294?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a4f2c178ce3fb2bca76c23ac015b294?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fateh</span>
<span class="date">January 18, 2017 at 12:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382658" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there any benchmark dataset for this task, to actually evaluate the model ?</p>
<div class="reply">
<a aria-label="Reply to Fateh" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=382658#respond" onclick='return addComment.moveForm( "comment-382658", "382658", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-382740">
<div class="comment-container" id="li-comment-382740">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2017 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-382740" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not as far as I’m aware Fateh.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=382740#respond" onclick='return addComment.moveForm( "comment-382740", "382740", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-383079">
<div class="comment-container" id="li-comment-383079">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69b13e5af9085e1531ff20f1d6460176?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69b13e5af9085e1531ff20f1d6460176?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">January 20, 2017 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383079" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason amazing post! I have a doubt. I tried the following: instead of training with Alice’s Adventures, I train with this a list of barcodes. Unique barcodes in a plain text (example, 123455, 143223, etc etc) and they can be of different lengths. Is this approach still valid? What i want to do is to input a potentially barcode with errors (maybe a character is missing) and the LSTM returns me “the correct one”. Any suggestion? Many thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383079#respond" onclick='return addComment.moveForm( "comment-383079", "383079", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-383238">
<div class="comment-container" id="li-comment-383238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2017 at 10:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice idea Don.</p>
<p>LSTMs can indeed correct sequences, but they would need to memorize all of the barcodes. You would then have to train it to fill in the gaps (0) with the missing values.</p>
<p>Very nice idea!</p>
<p>You could also try uses an autoencoder to do the same trick.</p>
<p>I’d love to hear how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383238#respond" onclick='return addComment.moveForm( "comment-383238", "383238", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-383326">
<div class="comment-container" id="li-comment-383326">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69b13e5af9085e1531ff20f1d6460176?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69b13e5af9085e1531ff20f1d6460176?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">January 21, 2017 at 10:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383326" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason! For sure i will come back 🙂</p>
<p>Do you have any suggested read for either LSTM as a “word corrector” or an autoencoder for that task?</p>
<p>Best!</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383326#respond" onclick='return addComment.moveForm( "comment-383326", "383326", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-383365">
<div class="comment-container" id="li-comment-383365">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 22, 2017 at 5:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383365" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry I don’t Don. Good luck with your project!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383365#respond" onclick='return addComment.moveForm( "comment-383365", "383365", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-383156">
<div class="comment-container" id="li-comment-383156">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/98fb928e002210f9f57f5feb0d3bff7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/98fb928e002210f9f57f5feb0d3bff7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex Bing</span>
<span class="date">January 20, 2017 at 8:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383156" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you very much for your post.</p>
<p>I was thinking about changing the input and output to be a coordinate, which is 2D vector (x and y position) to predict movement.</p>
<p>I understood that we can change the input to be a vector instead of scalar. For example using one hot vector like you’re suggesting.</p>
<p>However, I don’t understand what to do when we want the output to be a 2D vector. Does this mean that I don’t need to use softmax layer as the output? </p>
<p>Thanks for your help.</p>
<div class="reply">
<a aria-label="Reply to Alex Bing" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383156#respond" onclick='return addComment.moveForm( "comment-383156", "383156", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-383247">
<div class="comment-container" id="li-comment-383247">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2017 at 10:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-383247" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alex, interesting idea – movement generator.</p>
<p>You can output a vector by changing the number of neurons in the output layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=383247#respond" onclick='return addComment.moveForm( "comment-383247", "383247", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-384621">
<div class="comment-container" id="li-comment-384621">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashok Kumar</span>
<span class="date">January 28, 2017 at 3:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-384621" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>The features in the exercise are characters which are mapped to integers. It’s like replacing a nominal vector by a continuous variable. Isn’t that an issue? </p>
<p>Also, would you consider using Embedding as the first layer in this model – why or why not. </p>
<p>Thank you, your posts are immensely helpful.</p>
<div class="reply">
<a aria-label="Reply to Ashok Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=384621#respond" onclick='return addComment.moveForm( "comment-384621", "384621", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-384657">
<div class="comment-container" id="li-comment-384657">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 28, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-384657" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Ashok,</p>
<p>The input data is ordinal, either as chars or ints. The neural net expects to work with arrays of numbers instead of chars, so we use ints here.</p>
<p>An embedding layer would create a projection for the chars into a higher dimensional space. That would not be useful here as we are trying to learn and generalize the way sequences of chars are put together. </p>
<p>I could be wrong though, try it and see if you can make it work – perhaps with projections of word sequences?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=384657#respond" onclick='return addComment.moveForm( "comment-384657", "384657", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-384663">
<div class="comment-container" id="li-comment-384663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashok</span>
<span class="date">January 28, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-384663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason. This is helpful. </p>
<p>On the embedding layer, I have another question – how are the projections learnt? Is it a simple method like multiplying with a known matrix or are they learnt iteratively? If iteratively, then are they learnt a) first before the other weights or b) are the embedding projection weights learnt along with the other weights. </p>
<p>Ashok</p>
<div class="reply">
<a aria-label="Reply to Ashok" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=384663#respond" onclick='return addComment.moveForm( "comment-384663", "384663", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-385378">
<div class="comment-container" id="li-comment-385378">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2017 at 10:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-385378" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Ashok.</p>
<p>The embedding layer is not really described well in the Keras doc:<br/>
<a href="https://keras.io/layers/embeddings/" rel="nofollow">https://keras.io/layers/embeddings/</a></p>
<p>This SO post helps:<br/>
<a href="http://stackoverflow.com/questions/38189713/what-is-an-embedding-in-keras" rel="nofollow">http://stackoverflow.com/questions/38189713/what-is-an-embedding-in-keras</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=385378#respond" onclick='return addComment.moveForm( "comment-385378", "385378", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-384805">
<div class="comment-container" id="li-comment-384805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6bb3b02e3873eeeeb778acbbfe2fbdad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashok</span>
<span class="date">January 29, 2017 at 3:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-384805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason: </p>
<p>The below code for text generation is treating chars as nominal variables and hence giving assigning a separate dimension for each. Since this is a more complex approach, I will check if this leads to an improvement. </p>
<p>Again, thanks for your response. It only added to my curiosity . </p>
<p><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py" rel="nofollow">https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py</a></p>
<div class="reply">
<a aria-label="Reply to Ashok" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=384805#respond" onclick='return addComment.moveForm( "comment-384805", "384805", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-385386">
<div class="comment-container" id="li-comment-385386">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2017 at 10:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-385386" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d love to hear how the representational approaches compare in practice Ashok.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=385386#respond" onclick='return addComment.moveForm( "comment-385386", "385386", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-392851">
<div class="comment-container" id="li-comment-392851">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/28763b4e3e2980fdb243a10ed4789ecf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/28763b4e3e2980fdb243a10ed4789ecf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Konstantin</span>
<span class="date">March 16, 2017 at 7:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-392851" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, could you explain please how the input data is ordinal? Instead of one-hot encoding we simply enumerate characters.</p>
<div class="reply">
<a aria-label="Reply to Konstantin" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=392851#respond" onclick='return addComment.moveForm( "comment-392851", "392851", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-408298">
<div class="comment-container" id="li-comment-408298">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a013a04efc9894abcf77fb4c1ffe7a4d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a013a04efc9894abcf77fb4c1ffe7a4d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pasquinell</span>
<span class="date">August 2, 2017 at 9:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-408298" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have the same question. Have you found any answer?</p>
<div class="reply">
<a aria-label="Reply to Pasquinell" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=408298#respond" onclick='return addComment.moveForm( "comment-408298", "408298", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-408353">
<div class="comment-container" id="li-comment-408353">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2017 at 6:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-408353" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If your input is text, you can use:</p>
<p>– an integer encoding of the sequence<br/>
– a bag of word encoding (e.g. counts of tf-idf)<br/>
– one hot encoding of integer encoding<br/>
– word embedding (word2vec, glove or learned)</p>
<p>Does that help?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-391093">
<div class="comment-container" id="li-comment-391093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hendrik</span>
<span class="date">March 3, 2017 at 8:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-391093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason!</p>
<p>Nice work. But I don’t really understand what is the point of applying RNN for this particular task. If one wants to predict the next character of a 100-long sequence, this is seems me achievable with any other common regression task where you feed in the training sequences and the following single character as output while training. What is the additional feat of your approach?</p>
<div class="reply">
<a aria-label="Reply to Hendrik" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=391093#respond" onclick='return addComment.moveForm( "comment-391093", "391093", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-391452">
<div class="comment-container" id="li-comment-391452">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 6, 2017 at 10:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-391452" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, here are many ways to approach this problem.</p>
<p>LSTMs are supposed to particularly good at modeling the underlying PDF of char or words in a text corpus.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=391452#respond" onclick='return addComment.moveForm( "comment-391452", "391452", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-391698">
<div class="comment-container" id="li-comment-391698">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4aac06ac6fc821ea5c6dd300a33a5367?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hendrik</span>
<span class="date">March 7, 2017 at 9:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-391698" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The example doesn’t run anymore under TensorFlow 1.0.0. (previous versions are OK, at least with 0.10.0rc0).</p>
<div class="reply">
<a aria-label="Reply to Hendrik" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=391698#respond" onclick='return addComment.moveForm( "comment-391698", "391698", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-391771">
<div class="comment-container" id="li-comment-391771">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 8, 2017 at 9:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-391771" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What error do you see Hendrik?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=391771#respond" onclick='return addComment.moveForm( "comment-391771", "391771", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-393492">
<div class="comment-container" id="li-comment-393492">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.meerkat.com.br/en/" rel="external nofollow">Gustavo Führ</a></span>
<span class="date">March 21, 2017 at 6:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393492" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post Jason, I was trying to do almost the same thing and your post gave a lot of help. As some of the comments suggest, the RNN seems to achieve a loop quite quickly. I was wondering what you meant with “Add dropout to the visible input layer and consider tuning the dropout percentage.”, seems it appears to attack this problem.</p>
<div class="reply">
<a aria-label="Reply to Gustavo Führ" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393492#respond" onclick='return addComment.moveForm( "comment-393492", "393492", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-393524">
<div class="comment-container" id="li-comment-393524">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 21, 2017 at 8:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393524" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can apply regularization to the LSTMs on recurrent and input connections. </p>
<p>I have found adding a drop out of 40% or so on input connections for LSTMs very useful on other projects.</p>
<p>More details here:<br/>
<a href="https://keras.io/layers/recurrent/#lstm" rel="nofollow">https://keras.io/layers/recurrent/#lstm</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393524#respond" onclick='return addComment.moveForm( "comment-393524", "393524", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-393857">
<div class="comment-container" id="li-comment-393857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02c61a127b97fb174b3f5d56e5ef1941?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.meerkat.com.br/en/" rel="external nofollow">Gustavo Führ</a></span>
<span class="date">March 23, 2017 at 9:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually Jason,</p>
<p>I advanced my experiments and found some interesting things, I will probably do a Medium about it. </p>
<p>For the loop problem, as mentioned in <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/" rel="nofollow">http://karpathy.github.io/2015/05/21/rnn-effectiveness/</a>, makes no sense to always use the argmax in the generation. Since the network output a list of probabilities is easy to randomically sample letter using this distribution:</p>
<p>def sample_prediction(char_map, prediction):<br/>
	rnd_idx = np.random.choice(len(prediction), p=prediction)<br/>
	return char_map[rnd_idx]</p>
<p>That simple change made the network to avoid loops and be much more diverse. (Using<br/>
temperature as you mentioned will be even better)</p>
<p>Here is a sample of a one-layer network (same as yours), trained with Cervante’s Dom<br/>
Quixote, for 20 epochs:</p>
<p>=====<br/>
from its beginning to its end, and above all manner; as so able to be almost unable to repeat the, which he had protected him to leave it. As now, for her face because I will be, that he ow her its missing their resckes my eyes, proved<br/>
for the descance in the mouth as saying, to eat for a<br/>
shepherdess and this knight ais, they<br/>
did so that was rockly than to possess the new lose of, that in a sword of      now another<br/>
golden without a change on which not this; if shore of the Micomicona his dame, ‘To know some little why as capacquery; I will make any ammorimence is seen in their<br/>
countless<br/>
soicour and the adventure of her damsel a pearls that shows and vonquished callshind him, away itself, her fever and evil comrisoness by where they<br/>
will show not in time in which all the chain<br/>
himself of the<br/>
solmings of the hores of this<br/>
your nyiugh and it,<br/>
should have punisented, not to portion for, as it<br/>
just be-with his sort rich as the shaken of the<br/>
sun to<br/>
three lady male love?”</p>
<p>Am I he will not believe. I will disreel her more so knight, for<br/>
=====</p>
<p>Isn’t that cool? I hope that helps other people.</p>
<div class="reply">
<a aria-label="Reply to Gustavo Führ" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393857#respond" onclick='return addComment.moveForm( "comment-393857", "393857", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-393964">
<div class="comment-container" id="li-comment-393964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 24, 2017 at 7:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-393964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very cool Gustavo, thanks for sharing!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=393964#respond" onclick='return addComment.moveForm( "comment-393964", "393964", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-4" id="comment-394869">
<div class="comment-container" id="li-comment-394869">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/525993c57f4da6a0b8a86319b4de7957?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/525993c57f4da6a0b8a86319b4de7957?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jatin</span>
<span class="date">March 31, 2017 at 10:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-394869" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all big thanks to Jason for such a valuable write up.</p>
<p>I have 1 question :</p>
<p>To Gustavo Führ and Jason Brownlee </p>
<p>Could you please explain in a little more detail what you did there. i didn’t understand, how you got such a good output on a single layer.</p>
<p>I ran my training on this book as my data -&gt; <a href="http://www.gutenberg.org/cache/epub/5200/pg5200.txt" rel="nofollow">http://www.gutenberg.org/cache/epub/5200/pg5200.txt</a></p>
<p>See below the output i am getting..</p>
<p>Seed :<br/>
see it coming.  we can’t all work as hard as we have to and then come hometo be tortured like this, we can’t endure it.  i can’t endure it anymore.”  and she broke out so heavily in tears that they flo<br/>
Prediction :<br/>
led to het hemd and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and she was so the door and</p>
<p>As you can see here a text is repeating itself. This the result of 20th epoch out of 50 epochs in a dual layer LSTM with 256 cells and a sequence of 200 characters.</p>
<p>This is a result pattern i am seeing in all my trainings and i believe i am doing something wrong here. Could you please help out?</p>
<div class="reply">
<a aria-label="Reply to Jatin" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=394869#respond" onclick='return addComment.moveForm( "comment-394869", "394869", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-420915">
<div class="comment-container" id="li-comment-420915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3b9b1ea2f0bf6489e34f548a3903fbae?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3b9b1ea2f0bf6489e34f548a3903fbae?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.rforgione.com" rel="external nofollow">Rob</a></span>
<span class="date">November 23, 2017 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-420915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I had a very similar experience in my own experimentation. This comment verified what I had found — thank you for sharing Jatin!</p>
<div class="reply">
<a aria-label="Reply to Rob" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=420915#respond" onclick='return addComment.moveForm( "comment-420915", "420915", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-395413">
<div class="comment-container" id="li-comment-395413">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1de41726c5279d7702b3b21c464428df?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1de41726c5279d7702b3b21c464428df?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Henok S Mengistu</span>
<span class="date">April 5, 2017 at 8:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-395413" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>what is the need for normalization </p>
<p># normalize<br/>
X = X / float(n_vocab)</p>
<div class="reply">
<a aria-label="Reply to Henok S Mengistu" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=395413#respond" onclick='return addComment.moveForm( "comment-395413", "395413", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-395779">
<div class="comment-container" id="li-comment-395779">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-395779" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This normalizes the integer values by the largest integer value. All values are rescaled to 0-1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=395779#respond" onclick='return addComment.moveForm( "comment-395779", "395779", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-413565">
<div class="comment-container" id="li-comment-413565">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4659f38a392fe3d2b0f19ac1863e7a8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4659f38a392fe3d2b0f19ac1863e7a8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 12, 2017 at 4:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413565" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is this because it’s using a relu activation function? Or because generally you need input values to be between 0-1?</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413565#respond" onclick='return addComment.moveForm( "comment-413565", "413565", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-413646">
<div class="comment-container" id="li-comment-413646">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413646" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs prefer normalized inputs – confirm this with some experiments (I have).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413646#respond" onclick='return addComment.moveForm( "comment-413646", "413646", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-396122">
<div class="comment-container" id="li-comment-396122">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/219d8df803b9377c7026529a7c6e54fa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/219d8df803b9377c7026529a7c6e54fa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">June</span>
<span class="date">April 11, 2017 at 11:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-396122" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello~ I am your one of fans.</p>
<p>I have a question about lstm settings that I may apply your text generation model in a different way.</p>
<p>Your model generated texts by adding(updating) a character.</p>
<p>Do you think it is possible to generate texts by adding a word rather than a character. </p>
<p>If it is possible, adding word_embedding layer is effective for a performance of text generation??</p>
<div class="reply">
<a aria-label="Reply to June" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=396122#respond" onclick='return addComment.moveForm( "comment-396122", "396122", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396169">
<div class="comment-container" id="li-comment-396169">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 12, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-396169" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I expect it may even work better June. Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=396169#respond" onclick='return addComment.moveForm( "comment-396169", "396169", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-396195">
<div class="comment-container" id="li-comment-396195">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/219d8df803b9377c7026529a7c6e54fa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/219d8df803b9377c7026529a7c6e54fa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JUNETAE KIM</span>
<span class="date">April 12, 2017 at 12:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-396195" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, Jason. </p>
<p>I will try it~!</p>
<p>You know, I am a doctoral student majored in management information system. </p>
<p>My research interest include medical informatics and healthcare business analytics. </p>
<p>Your excellent blog posts have helped me a lot. </p>
<p>I appreciated it so much!</p>
<div class="reply">
<a aria-label="Reply to JUNETAE KIM" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=396195#respond" onclick='return addComment.moveForm( "comment-396195", "396195", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-396278">
<div class="comment-container" id="li-comment-396278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-396278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m really glad to hear that. Thanks for your support and your kind words, I really appreciate it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=396278#respond" onclick='return addComment.moveForm( "comment-396278", "396278", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-398765">
<div class="comment-container" id="li-comment-398765">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f15a831e6e531d46d73bb147d7b1bedd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f15a831e6e531d46d73bb147d7b1bedd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dave</span>
<span class="date">May 6, 2017 at 11:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-398765" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Very interesting example – can’t wait to try training on other texts!</p>
<p>I have a question regarding the training of this, or in fact any neural network, on a GPU – I have a couple of CNNs written but that I can’t execute :(.</p>
<p>Suppose I am using either Amazon EC2 or Google Cloud, I can successfully log into the instance and run a simple ANN using just a CPU but I am totally confused as to how to get the GPU working. I am accessing the instance from Windows 10. Can you tell me the exact steps I need to do – presumably I need to get CUDA and CUDNN somehow? Then is there any other stuff I need to do or can I just pip install the necessary packages and then execute my code?</p>
<p>Thank you so much.</p>
<div class="reply">
<a aria-label="Reply to Dave" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=398765#respond" onclick='return addComment.moveForm( "comment-398765", "398765", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398866">
<div class="comment-container" id="li-comment-398866">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 7, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-398866" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My best advice would be to use an AMI that is already set up to use the GPU.</p>
<p>I have step by step instructions here:<br/>
<a href="http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/" rel="nofollow">http://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=398866#respond" onclick='return addComment.moveForm( "comment-398866", "398866", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399710">
<div class="comment-container" id="li-comment-399710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">FractalProb</span>
<span class="date">May 15, 2017 at 2:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>nice post!<br/>
two questions,<br/>
1) what is the role of “seq_in = [int_to_char[value] for value in pattern]” in line 63 (doesn’t seem to be used in the loop) and,<br/>
2) could you expand on where and how Gustavo’s fix is needed? (I also get repeated predictions using argmax)</p>
<p>Does your Deep Learning book expand on (2) in regards to LSTM’s?<br/>
It seems problematic to output the same predictions over different inputs.</p>
<div class="reply">
<a aria-label="Reply to FractalProb" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399710#respond" onclick='return addComment.moveForm( "comment-399710", "399710", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399766">
<div class="comment-container" id="li-comment-399766">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 16, 2017 at 8:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399766" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>seq_in is the input sequence used in prediction. Agreed it is not needed in the latter part of the example.</p>
<p>His fix is not needed, it can just reduce the size of the universe of possible values. My book does not go into more detail on this.</p>
<p>I am working on a new book dedicated to LSTMs that may be of interest when it is released (next month).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399766#respond" onclick='return addComment.moveForm( "comment-399766", "399766", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399752">
<div class="comment-container" id="li-comment-399752">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">FractalProb</span>
<span class="date">May 16, 2017 at 3:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399752" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is my implementation of Gustavo’s suggestions so that the predicted output tends to avoid repeated patterns</p>
<p>def sample_prediction(prediction):<br/>
    “””Get rand index from preds based on its prob distribution.</p>
<p>    Params<br/>
    ——<br/>
    prediction (array (array)): array of length 1 containing array of probs that sums to 1</p>
<p>    Returns<br/>
    ——-<br/>
    rnd_idx (int): random index from prediction[0]</p>
<p>    Notes<br/>
    —–<br/>
    Helps to solve problem of repeated outputs.</p>
<p>    len(prediction) = 1<br/>
    len(prediction[0]) &gt;&gt; 1<br/>
    “””<br/>
    X = prediction[0]  # sum(X) is approx 1<br/>
    rnd_idx = np.random.choice(len(X), p=X)<br/>
    return rnd_idx</p>
<p>for i in range(num_outputs):<br/>
    x = np.reshape(pattern, (1, len(pattern), 1))<br/>
    x = x / float(n_vocab)<br/>
    prediction = model.predict(x, verbose=0)<br/>
    #index = numpy.argmax(prediction)<br/>
    # per Gustavo’s suggestion, we should not use argmax here<br/>
    index = sample_prediction(prediction)<br/>
    result = int_to_char[index]<br/>
    #seq_in = [int_to_char[value] for value in pattern]<br/>
    # not sure why seq_in was here<br/>
    sys.stdout.write(result)<br/>
    pattern.append(index)<br/>
    pattern = pattern[1:len(pattern)]<br/>
print “\nDone.”</p>
<div class="reply">
<a aria-label="Reply to FractalProb" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399752#respond" onclick='return addComment.moveForm( "comment-399752", "399752", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399781">
<div class="comment-container" id="li-comment-399781">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 16, 2017 at 8:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399781" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399781#respond" onclick='return addComment.moveForm( "comment-399781", "399781", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399753">
<div class="comment-container" id="li-comment-399753">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/967f042c36df36c84135ad08573460fa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/967f042c36df36c84135ad08573460fa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rathish</span>
<span class="date">May 16, 2017 at 5:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399753" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, great post. </p>
<p>I wanted to ask you if there is a way to train this system or use the current setup with dynamic input length. </p>
<p>The reason for that is if one to use this for real text generation, given a random seed of variable length say.. “I have a dream” or “To be or not to be” would it be possible to still generate coherent sentences if we train using dynamic length?</p>
<p>I tried with pad sequence in the predict stage (not the train stage) to match the input length for shorter sentences, but that doesn’t seem to work.</p>
<p>Regards</p>
<div class="reply">
<a aria-label="Reply to Rathish" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399753#respond" onclick='return addComment.moveForm( "comment-399753", "399753", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399782">
<div class="comment-container" id="li-comment-399782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 16, 2017 at 8:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you are on the right track.</p>
<p>I would recommend zero-padding all sequences to be the same length and see how the model fairs.</p>
<p>You could try Masking the input layer and see what impact that has.</p>
<p>You could also try truncating sequences.</p>
<p>I have a post scheduled that gives many ways to handle input sequences of different lengths, perhaps in a few weeks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399782#respond" onclick='return addComment.moveForm( "comment-399782", "399782", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-400480">
<div class="comment-container" id="li-comment-400480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/967f042c36df36c84135ad08573460fa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/967f042c36df36c84135ad08573460fa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rathish</span>
<span class="date">May 25, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That would be much appreciated. Looking forward to it.</p>
<div class="reply">
<a aria-label="Reply to Rathish" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400480#respond" onclick='return addComment.moveForm( "comment-400480", "400480", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-399962">
<div class="comment-container" id="li-comment-399962">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b4a06d11f4d5950d0be7ab607a27440b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b4a06d11f4d5950d0be7ab607a27440b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">May 18, 2017 at 6:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-399962" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>may I ask about these two lines<br/>
	seq_in = raw_text[i:i + seq_length]<br/>
	seq_out = raw_text[i + seq_length]</p>
<p>should model predict next one abc -&gt; d instead of abc -&gt; c</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=399962#respond" onclick='return addComment.moveForm( "comment-399962", "399962", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400284">
<div class="comment-container" id="li-comment-400284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abbey</span>
<span class="date">May 23, 2017 at 1:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I need to thank you for all the good work on Keras, wounderful and awesome package.</p>
<p>However, i got a floating point exception (core dumped) running the code. Please, i need your advise to resolve the issues. I have upgrade the my keras from 1.0.8 to 2.0.1 and the issues is still the same.</p>
<p>88/200 [============&gt;……………..] – ETA: 27s – loss: 11.3334 – acc: 0.0971{‘acc’: array(0.10470587760210037, dtype=float32), ‘loss’: array(9.283703804016113, dtype=float32), ‘batch’: 88, ‘size’: 17}<br/>
 89/200 [============&gt;……………..] – ETA: 26s – loss: 11.3103 – acc: 0.0972Floating point exception (core dumped)</p>
<p>Warm Regards</p>
<div class="reply">
<a aria-label="Reply to abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400284#respond" onclick='return addComment.moveForm( "comment-400284", "400284", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400305">
<div class="comment-container" id="li-comment-400305">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 23, 2017 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400305" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m sorry to hear that.</p>
<p>Perhaps you could try a different backend (theano or tensorflow)?</p>
<p>Perhaps you could try posting to stackoverflow or the keras user group?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400305#respond" onclick='return addComment.moveForm( "comment-400305", "400305", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-400364">
<div class="comment-container" id="li-comment-400364">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abbey</span>
<span class="date">May 23, 2017 at 6:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400364" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason.</p>
<div class="reply">
<a aria-label="Reply to abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400364#respond" onclick='return addComment.moveForm( "comment-400364", "400364", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-400376">
<div class="comment-container" id="li-comment-400376">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abbey</span>
<span class="date">May 23, 2017 at 9:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400376" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi guys,</p>
<p>With Tensorflow backend, i got different error messages. After about 89 batch from the second epochs, the loss become nan and the accuracy also the same. Any suggestion or advices</p>
<p> 87/200 [============&gt;……………..] – ETA: 113s – loss: 9.4303 – acc: 0.0947{‘acc’: 0.10666667, ‘loss’: 9.2033749, ‘batch’: 87, ‘size’: 32}<br/>
 88/200 [============&gt;……………..] – ETA: 112s – loss: 9.4277 – acc: 0.0949{‘acc’: 0.10862745, ‘loss’: 9.2667055, ‘batch’: 88, ‘size’: 17}<br/>
 89/200 [============&gt;……………..] – ETA: 110s – loss: 9.4259 – acc: 0.0950{‘acc’: nan, ‘loss’: nan, ‘batch’: 89, ‘size’: 0}<br/>
 90/200 [============&gt;……………..] – ETA: 108s – loss: nan – acc: nan      {‘acc’: nan, ‘loss’: nan, ‘batch’: 90, ‘size’: 0}<br/>
 91/200 [============&gt;……………..] – ETA: 106s – loss: nan – acc: nan{‘acc’: nan, ‘loss’: nan, ‘batch’: 91, ‘size’: 0}<br/>
 92/200 [============&gt;……………..] – ETA: 105s – loss: nan – acc: nan{‘acc’: nan, ‘loss’: nan, ‘batch’: 92, ‘size’: 0}</p>
<div class="reply">
<a aria-label="Reply to abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400376#respond" onclick='return addComment.moveForm( "comment-400376", "400376", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400401">
<div class="comment-container" id="li-comment-400401">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 24, 2017 at 4:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400401" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This can happen and is caused by exploding or vanishing gradients.</p>
<p>Try using a clipnorm on the optimization algorithm:<br/>
<a href="https://keras.io/optimizers/" rel="nofollow">https://keras.io/optimizers/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400401#respond" onclick='return addComment.moveForm( "comment-400401", "400401", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-400458">
<div class="comment-container" id="li-comment-400458">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6efb21b3cdf4ea1b4c2144b7cd36f4cf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6efb21b3cdf4ea1b4c2144b7cd36f4cf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://adataanalyst.com/" rel="external nofollow">Piush</a></span>
<span class="date">May 24, 2017 at 11:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400458" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the example. Piush.</p>
<div class="reply">
<a aria-label="Reply to Piush" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400458#respond" onclick='return addComment.moveForm( "comment-400458", "400458", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401114">
<div class="comment-container" id="li-comment-401114">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 11:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-401114" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=401114#respond" onclick='return addComment.moveForm( "comment-401114", "401114", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-400582">
<div class="comment-container" id="li-comment-400582">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abbey</span>
<span class="date">May 26, 2017 at 3:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400582" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I tried your suggestion and the problem of nan for loss and accuracy still the same after second epoch while the batch size is 39/50.</p>
<p>I have also try all the activation function and regularization but still the same problems. Too bad!</p>
<div class="reply">
<a aria-label="Reply to abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400582#respond" onclick='return addComment.moveForm( "comment-400582", "400582", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400820">
<div class="comment-container" id="li-comment-400820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abbey</span>
<span class="date">May 30, 2017 at 4:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>The problem of loss and accuracy becoming nan after few epoch as to do with the batch generator. I fix it now.</p>
<p>Thank you so much.</p>
<div class="reply">
<a aria-label="Reply to abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400820#respond" onclick='return addComment.moveForm( "comment-400820", "400820", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401198">
<div class="comment-container" id="li-comment-401198">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-401198" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=401198#respond" onclick='return addComment.moveForm( "comment-401198", "401198", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400996">
<div class="comment-container" id="li-comment-400996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eff05bbe19f58d12c95cba6d727c61d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eff05bbe19f58d12c95cba6d727c61d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">IanEden</span>
<span class="date">June 1, 2017 at 8:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-400996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, </p>
<p>I was wondering how I could add more hidden layers. I was wondering if this could help generate text with more efficiency</p>
<p>I tried using model.add(LSTM(some_number)) again but it failed and gave me the error:</p>
<p>“Input 0 is incompatible with layer lstm_3: expected ndim=3, found ndim=2”</p>
<div class="reply">
<a aria-label="Reply to IanEden" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=400996#respond" onclick='return addComment.moveForm( "comment-400996", "400996", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-401850">
<div class="comment-container" id="li-comment-401850">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/12d44ed2c3ccf17b6c16d4e311a30837?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/12d44ed2c3ccf17b6c16d4e311a30837?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mo</span>
<span class="date">June 8, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-401850" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Thanks for your great post it helped me a lot. Since I finished reading your post, I was thinking of how to implement it in a word level instead of character level. I am just confused of how to implement it because with characters we only have few characters but with words we might have say 10000 or even more. Would you please share your thoughts. I am really excited to see the results in a words-level and make further enhancements.</p>
<div class="reply">
<a aria-label="Reply to Mo" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=401850#respond" onclick='return addComment.moveForm( "comment-401850", "401850", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401931">
<div class="comment-container" id="li-comment-401931">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-401931" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great idea.</p>
<p>I would recommend ranking all words by frequency the assign integers to each word based on rank. New words not in the corpus can then also be assigned integers later.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=401931#respond" onclick='return addComment.moveForm( "comment-401931", "401931", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-402649">
<div class="comment-container" id="li-comment-402649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adi</span>
<span class="date">June 16, 2017 at 12:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-402649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi jason , thanks for such an awesome post<br/>
I keep getting the error :<br/>
ImportError: <code>load_weights</code> requires h5py.<br/>
even if i have installed h5py, did anyone else face this error, please help</p>
<div class="reply">
<a aria-label="Reply to Adi" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=402649#respond" onclick='return addComment.moveForm( "comment-402649", "402649", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-402701">
<div class="comment-container" id="li-comment-402701">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-402701" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps your environment cannot see the h5py library?</p>
<p>Confirm you installed it the correct way for your environment.</p>
<p>Try important the library itself and refine env until it works.</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=402701#respond" onclick='return addComment.moveForm( "comment-402701", "402701", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-402972">
<div class="comment-container" id="li-comment-402972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adi</span>
<span class="date">June 18, 2017 at 5:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-402972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It was solved, I just restarted python after installing h5py.<br/>
when I predicted using the model, it through the characters like this, whats up with the 1s why are they coming?<br/>
t1<br/>
h1<br/>
e1<br/>
 1<br/>
s1<br/>
e1<br/>
r1<br/>
e1<br/>
 1<br/>
t1<br/>
o1<br/>
 1<br/>
t1<br/>
e1<br/>
e1<br/>
 1<br/>
w1<br/>
e1<br/>
r1<br/>
 1<br/>
i1<br/>
n1<br/>
 1<br/>
a1<br/>
n1<br/>
d1</p>
<div class="reply">
<a aria-label="Reply to Adi" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=402972#respond" onclick='return addComment.moveForm( "comment-402972", "402972", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-403021">
<div class="comment-container" id="li-comment-403021">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 19, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-403021" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t know. Confirm that you have a copy of the code from the tutorial without modification.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=403021#respond" onclick='return addComment.moveForm( "comment-403021", "403021", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-403174">
<div class="comment-container" id="li-comment-403174">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79b7a34e5c0bc8f45c12a871c35a5e7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adi</span>
<span class="date">June 20, 2017 at 2:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-403174" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can we use print() in place of sys.stdout.write()</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-403256">
<div class="comment-container" id="li-comment-403256">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2017 at 8:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-403256" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-403317">
<div class="comment-container" id="li-comment-403317">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87393ac8db44b4f93393d51de251374d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abbey</span>
<span class="date">June 21, 2017 at 9:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-403317" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Please, I need your help. I try to validate my test data using the already training result from the model but I got the following error:</p>
<p>##################<br/>
AttributeError Traceback (most recent call last)<br/>
in ()<br/>
1 # load weights into new model<br/>
—-&gt; 2 model_info.load_weights(save_best_weights)<br/>
3 predictions = model.predict([test_q1, test_q2, test_q1, test_q2,test_q1, test_q2], verbose = True)</p>
<p>AttributeError: ‘History’ object has no attribute ‘load_weights’</p>
<p>In [ ]:<br/>
#####################</p>
<p>Below is the snippets of my code:</p>
<p>###Fitting model</p>
<p>save the best weights for predicting the test question pairs</p>
<p>save_best_weights = “weights-pairs1.h5”</p>
<p>checkpoint = ModelCheckpoint(filepath, monitor=’loss’, verbose=1, save_best_only=True, mode=’min’)</p>
<p>callbacks = [ModelCheckpoint(save_best_weights, monitor=’val_loss’, save_best_only=True),<br/>
EarlyStopping(monitor=’val_loss’, patience=5, verbose=1, mode=’auto’)]<br/>
start = time.time()<br/>
model_info=merged_model.fit([x1, x2, x1, x2, x1, x2], y=y, batch_size=64, epochs=3, verbose=True,<br/>
validation_split=0.33, shuffle=True, callbacks=callbacks)<br/>
end = time.time()<br/>
print(“Minutes elapsed: %f” % ((start – end) / 60.))</p>
<p>#####evaluting</p>
<p>#load weights into a new model</p>
<p>model_info.load_weights(save_best_weights)<br/>
predictions = model.predict([test_q1, test_q2, test_q1, test_q2,test_q1, test_q2], verbose = True)</p>
<p>Rgeards</p>
<div class="reply">
<a aria-label="Reply to Abbey" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=403317#respond" onclick='return addComment.moveForm( "comment-403317", "403317", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403365">
<div class="comment-container" id="li-comment-403365">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2017 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-403365" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this tutorial on how to load a saved model:<br/>
<a href="http://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">http://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=403365#respond" onclick='return addComment.moveForm( "comment-403365", "403365", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-404557">
<div class="comment-container" id="li-comment-404557">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3e23c689987306c0049680120293a303?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3e23c689987306c0049680120293a303?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunal chakraborty</span>
<span class="date">July 2, 2017 at 8:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-404557" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Great tutorial. I have just one doubt though, in np.reshape command what does feature mean?<br/>
and why is it set to 1?</p>
<div class="reply">
<a aria-label="Reply to Kunal chakraborty" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=404557#respond" onclick='return addComment.moveForm( "comment-404557", "404557", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404583">
<div class="comment-container" id="li-comment-404583">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 3, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-404583" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The raw data are sequences of integers. There is only one observation (feature) per time step and it is an integer. That is why the first reshape specifies one feature.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=404583#respond" onclick='return addComment.moveForm( "comment-404583", "404583", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-404655">
<div class="comment-container" id="li-comment-404655">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83c686bbf31493c38ca1173bd7fba4e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83c686bbf31493c38ca1173bd7fba4e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">July 4, 2017 at 12:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-404655" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent tutorial!</p>
<p>I have one question. I need predict some words inside text and I currently use LSTM based on your code and binary coding. Is a good practice to use n-words behind and k-words ahead of word which I want to predict?<br/>
It’s good to train model on data like this or we must rather use only data behind our prediction?</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=404655#respond" onclick='return addComment.moveForm( "comment-404655", "404655", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404871">
<div class="comment-container" id="li-comment-404871">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 6, 2017 at 10:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-404871" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try a few method and see what works best on your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=404871#respond" onclick='return addComment.moveForm( "comment-404871", "404871", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-405513">
<div class="comment-container" id="li-comment-405513">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7bdd32aa259003066c7b67d9384f12fd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7bdd32aa259003066c7b67d9384f12fd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://themeforu.com/" rel="external nofollow">Francesca</a></span>
<span class="date">July 11, 2017 at 3:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-405513" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, This can make a good reference for me</p>
<div class="reply">
<a aria-label="Reply to Francesca" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=405513#respond" onclick='return addComment.moveForm( "comment-405513", "405513", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405593">
<div class="comment-container" id="li-comment-405593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2017 at 9:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-405593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=405593#respond" onclick='return addComment.moveForm( "comment-405593", "405593", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-408577">
<div class="comment-container" id="li-comment-408577">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e342a0ad3e04aedc1a421a22f1b4b6f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e342a0ad3e04aedc1a421a22f1b4b6f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe Melle</span>
<span class="date">August 5, 2017 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-408577" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why not one hot encode the numbers?</p>
<div class="reply">
<a aria-label="Reply to Joe Melle" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=408577#respond" onclick='return addComment.moveForm( "comment-408577", "408577", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408686">
<div class="comment-container" id="li-comment-408686">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 6, 2017 at 7:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-408686" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure, try it.</p>
<p>Also try an encoding layer.</p>
<p>There are many ways to improve the example Joe, let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=408686#respond" onclick='return addComment.moveForm( "comment-408686", "408686", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-412423">
<div class="comment-container" id="li-comment-412423">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4c8e2dc9f9a54276854846a2fb7b7a09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4c8e2dc9f9a54276854846a2fb7b7a09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sivasailam</span>
<span class="date">September 3, 2017 at 8:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412423" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,<br/>
Great post. Thanks much. I am very new to LSTM. I am trying to recreate the codes here. How to increase the number of epochs?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Sivasailam" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412423#respond" onclick='return addComment.moveForm( "comment-412423", "412423", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412467">
<div class="comment-container" id="li-comment-412467">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412467" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Change the value after “epochs=”</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412467#respond" onclick='return addComment.moveForm( "comment-412467", "412467", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-412712">
<div class="comment-container" id="li-comment-412712">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/abd0fcf43ca10915d73dee7d32b8a84e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/abd0fcf43ca10915d73dee7d32b8a84e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Greg</span>
<span class="date">September 5, 2017 at 4:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412712" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you so much for these guides and tutorials! I’m finding them to be very helpful.</p>
<div class="reply">
<a aria-label="Reply to Greg" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412712#respond" onclick='return addComment.moveForm( "comment-412712", "412712", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412948">
<div class="comment-container" id="li-comment-412948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that Greg.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412948#respond" onclick='return addComment.moveForm( "comment-412948", "412948", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-412920">
<div class="comment-container" id="li-comment-412920">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">September 7, 2017 at 11:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412920" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your great post, and all the other great post as a matter of fact. I’m interested to train the model on padded sentences rather than random sequences of characters, but it’s not clear to me how to implement it. Can you please elaborate about it and give an example?</p>
<p>Many thanks!<br/>
Don</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412920#respond" onclick='return addComment.moveForm( "comment-412920", "412920", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412974">
<div class="comment-container" id="li-comment-412974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-412974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Keras has a great pad function for this:<br/>
<a href="https://keras.io/preprocessing/sequence/" rel="nofollow">https://keras.io/preprocessing/sequence/</a></p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=412974#respond" onclick='return addComment.moveForm( "comment-412974", "412974", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-413097">
<div class="comment-container" id="li-comment-413097">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">September 8, 2017 at 3:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413097" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks again for the post and all the info!  I have another question. What should I do if I want to predict by a inserting a string shorter than 100 characters?</p>
<p>Many thanks again!</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413097#respond" onclick='return addComment.moveForm( "comment-413097", "413097", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-413218">
<div class="comment-container" id="li-comment-413218">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413218" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Use padding:<br/>
<a href="https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/" rel="nofollow">https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413218#respond" onclick='return addComment.moveForm( "comment-413218", "413218", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-413298">
<div class="comment-container" id="li-comment-413298">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">September 10, 2017 at 2:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413298" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<p>I have a question regarding the number of parameter in the model and the amount of data. When I look at the summary of the simplest model, I get: Total params: 275,757.0, Trainable params: 275,757.0, and Non-trainable params: 0.0 (for some reason I didn’t succeed to sent a reply with the whole summary).</p>
<p>The number of characters in the Alice book is about  150,000. Thus, isn’t the number of parameter larger than the number of characters (data)?</p>
<p>Thanks again!</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413298#respond" onclick='return addComment.moveForm( "comment-413298", "413298", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-413424">
<div class="comment-container" id="li-comment-413424">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 11, 2017 at 12:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413424" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413424#respond" onclick='return addComment.moveForm( "comment-413424", "413424", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-413452">
<div class="comment-container" id="li-comment-413452">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0887e35e7a67e720228622e204567c49?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Don</span>
<span class="date">September 11, 2017 at 2:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413452" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Isn’t that over-fitting? I ask because you suggested to improve the quality of results by developing an even much larger LSTM network. But if in the simple LSTM network you already have more parameters than data, shouldn’t you simplify the network even more?</p>
<p>Thanks a lot for all the tips!</p>
<div class="reply">
<a aria-label="Reply to Don" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413452#respond" onclick='return addComment.moveForm( "comment-413452", "413452", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-413630">
<div class="comment-container" id="li-comment-413630">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413630" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A simpler model is preferred, but overfitting is only the case when skill on test/validation data is worse than train data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413630#respond" onclick='return addComment.moveForm( "comment-413630", "413630", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-413613">
<div class="comment-container" id="li-comment-413613">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manar</span>
<span class="date">September 13, 2017 at 4:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413613" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Dr.Jason, </p>
<p>What if I want to output the probability of a sequence under  a trained model rather than finding the most probable  next charterer. </p>
<p>The use case that I have in mind is to feed the model test sentence and it prints  the probability of this sentence being true under the model </p>
<p>Much thanks in advance</p>
<div class="reply">
<a aria-label="Reply to Manar" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413613#respond" onclick='return addComment.moveForm( "comment-413613", "413613", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-413654">
<div class="comment-container" id="li-comment-413654">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413654" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That would be a different framing of the problem, or perhaps you can collect the probabilities of each char step by step.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413654#respond" onclick='return addComment.moveForm( "comment-413654", "413654", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-413717">
<div class="comment-container" id="li-comment-413717">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manar</span>
<span class="date">September 14, 2017 at 2:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413717" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So when I train, Xs is similarly he sequence, but what would the Ys be ?<br/>
Thanks!</p>
<div class="reply">
<a aria-label="Reply to Manar" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413717#respond" onclick='return addComment.moveForm( "comment-413717", "413717", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-413885">
<div class="comment-container" id="li-comment-413885">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413885" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The next char or word in the sequence.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=413885#respond" onclick='return addComment.moveForm( "comment-413885", "413885", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-413909">
<div class="comment-container" id="li-comment-413909">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b003f228c5f48538ad828771060e5db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manar</span>
<span class="date">September 15, 2017 at 12:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413909" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If we do this then how it will differ from the original framing of the problem? I mean the resulted probability will measure the how likely it is a character X will be the next rather than the  probability of the seen sequence under the trained model </p>
<p>e.g. if we feed the model with “I am”  and the next word either [egg or Sam]. Following the above-reply the output will be the probability of egg or Sam to be the next. Rather, I need to find the probability of the entire segment ” I am Sam” and “I am egg” to be able to tell which one makes more sense</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-413984">
<div class="comment-container" id="li-comment-413984">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 16, 2017 at 8:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-413984" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is the same framing. The difference is how you handle the probabilities. Sorry, I should have been clearer.</p>
<p>E.g. you can beam search the probabilities across each word/char, or output the probabilities for a specific output sequence, or list the top n most likely output sequences. </p>
<p>Does that make sense?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414195">
<div class="comment-container" id="li-comment-414195">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/93c745693a256b8e48b1936aaa0ce84e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/93c745693a256b8e48b1936aaa0ce84e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rohit</span>
<span class="date">September 18, 2017 at 7:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414195" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for the tutorial. When I am using one-hot encoded input, my accuracy and loss is not improving and becomes stagnant</p>
<p>function:<br/>
def one_hot_encode(sequences, next_chars, char_to_idx):<br/>
    X = np.zeros((n_patterns, seq_length, N_CHARS),dtype=float)<br/>
    y = np.zeros((n_patterns, N_CHARS),dtype=float)<br/>
    for i, sequence in enumerate(sequences):<br/>
        for t, char in enumerate(sequence):<br/>
            X[i, t, char] = 1<br/>
            #print(i,t,char)<br/>
    y[i,[next_chars[i]]] = 1<br/>
    return X, y</p>
<p>X, y = one_hot_encode(dataX, dataY, char_to_int)</p>
<p>Is it the layer size or a bug in one_hot_encoding?</p>
<div class="reply">
<a aria-label="Reply to Rohit" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414195#respond" onclick='return addComment.moveForm( "comment-414195", "414195", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414237">
<div class="comment-container" id="li-comment-414237">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2017 at 7:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414237" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The fault is not obvious to me, sorry. </p>
<p>Perhaps this list of ideas may give you ways to help lift model skill:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414237#respond" onclick='return addComment.moveForm( "comment-414237", "414237", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414299">
<div class="comment-container" id="li-comment-414299">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/99c34eb50b3d0e5ba2ee8675197beb20?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/99c34eb50b3d0e5ba2ee8675197beb20?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vinicius</span>
<span class="date">September 20, 2017 at 1:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414299" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for the great tutorial!</p>
<p>If I begin with some random character and use the trained model to predict the next one, how can the network generate different sentences using the same first character?</p>
<div class="reply">
<a aria-label="Reply to Vinicius" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414299#respond" onclick='return addComment.moveForm( "comment-414299", "414299", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414328">
<div class="comment-container" id="li-comment-414328">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2017 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414328" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It will predict probabilities across all output characters and you can use a beam search through those probabilities to get multiple different output sequences.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414328#respond" onclick='return addComment.moveForm( "comment-414328", "414328", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414342">
<div class="comment-container" id="li-comment-414342">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">September 20, 2017 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414342" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,<br/>
I’m attempting to run the lastf ull code example for generating text using the loaded LSTM model.<br/>
However, line 59 simply produces the same number (effectively a space character) each time across the whole 1000 range.<br/>
Not sure what I’m doing wrong ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414342#respond" onclick='return addComment.moveForm( "comment-414342", "414342", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414358">
<div class="comment-container" id="li-comment-414358">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2017 at 3:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-414358" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that Sam.</p>
<p>Have you tried to run the example a few times?<br/>
Have you confirmed that your environment is up to date?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=414358#respond" onclick='return addComment.moveForm( "comment-414358", "414358", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415030">
<div class="comment-container" id="li-comment-415030">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Iain Strachan</span>
<span class="date">September 29, 2017 at 1:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-415030" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I did the experiment with a different corpus of text; Shakespeare’s sonnets, two LSTM layers of 256, and 20 epochs (probably needs longer).  I found that the method in your post where you simply choose the next character from the maximum output, quickly produces very repetitive text – the same two lines repeat after a while, like this:</p>
<p>Seed:<br/>
” raise is crowned,<br/>
  but those same tongues that give thee so thine own,<br/>
  in other accents do this p ”<br/>
oor so me<br/>
   the world with the shee the world with thee,<br/>
    the world with the shee the world wour self stolne,<br/>
    the world with the shee the world with thee shee steel.</p>
<p>                     12<br/>
  the world with the the world with the dearty see,<br/>
  the world with the shee the world with thee wour self,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with the shee the world with thee shee shee,<br/>
  the world with the shee the world wour self so bear,<br/>
  the world with t</p>
<p>However, if you introduce some randomness by sampling the prediction probability distribution randomly, you get much more interesting results – although it’s gibberish, there are many gibberish words that are pronounceable – ie not just randomly selected, and the overall effect looks like it might be middle English, or even german in places.  The randomness means that sometimes it doesn’t get the line breaks in approximately the right place.  Nonetheless a very interesting result, and it doesn’t loop.</p>
<p>I love the way it puts the sonnet number in the right place!</p>
<p>Seed:<br/>
” nds to the course of alt’ring things:<br/>
  alas why fearing of time’s tyranny,<br/>
  might i not then say ‘ ”<br/>
to sof bn bde,<br/>
  the iroelge gatesds bever neagne brmions<br/>
  ph puspper stais, delcs tien love ahena,<br/>
  thich thi derter worndsm hin fafn’sianlu thee:<br/>
    shese blunq so me for they fadr mnhit creet.</p>
<p>                     64<br/>
  cscv thy swbiss io ht the yanjes sast,<br/>
  mftt pwr thet thai, io mengdvr to mehpt<br/>
  nadengoes’dflret, acseriog of shein puonl.<br/>
  to slobn of wourt)s fron shy fort siou mavt   dr chotert fold (mn heart oo shoedh stcete,<br/>
  that hil bu toun fass rrunhng of aeteinen<br/>
  rie trilg mf prinlenlss, and ge voids,<br/>
  batse mi tey betine out le il your wou,<br/>
  these own taref in formuiers wien,io hise)<br/>
  h eaar nonlhng uhe wari her bfsriite,<br/>
  ming oat,s al she wantero wo me.</p>
<p>                     96<br/>
  theteeo i fave shee wout fnler fiselgct<br/>
sreanind,<br/>
  whthsu doom that brss nn len; a<br/>
tekl of me<br/>
 tr pfngslcs,tien gojeses tore dothen,<br/>
  o beau aal wierefe, oo ttomnaei ofs.<br/>
  au in doace fiasss eireen thae despered,<br/>
  thv urut ninyak wtaprr’ and thereoo dlg hns<br/>
cooh,<br/>
  afaonyt o</p>
<p>PS this is just to test it out – I really want to generate synthetic time-series data, but I found that just predicting the next value then running generatively always produced a decay to a constant value.</p>
<div class="reply">
<a aria-label="Reply to Iain Strachan" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=415030#respond" onclick='return addComment.moveForm( "comment-415030", "415030", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-415031">
<div class="comment-container" id="li-comment-415031">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Iain Strachan</span>
<span class="date">September 29, 2017 at 1:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-415031" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>PS – having cut pasted it the pasting on this blog puts the sonnet number in the wrong place at the beginning of the line.  In the generated text, the sonnet number is centred, ie preceded by a number of spaces, as in the original.</p>
<div class="reply">
<a aria-label="Reply to Iain Strachan" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=415031#respond" onclick='return addComment.moveForm( "comment-415031", "415031", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415046">
<div class="comment-container" id="li-comment-415046">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 29, 2017 at 5:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-415046" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very nice, thanks for sharing.</p>
<p>Perhaps you can use a beam search to better sample the output probabilities and get a sequence that maximizes the likelihood.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=415046#respond" onclick='return addComment.moveForm( "comment-415046", "415046", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-415102">
<div class="comment-container" id="li-comment-415102">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/31e8e16b5e7d50a6575d27fbe1a0b960?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Iain Strachan</span>
<span class="date">September 29, 2017 at 8:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-415102" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like a good idea, and also applicable to my goal – to generate synthetic sensor data.</p>
<div class="reply">
<a aria-label="Reply to Iain Strachan" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=415102#respond" onclick='return addComment.moveForm( "comment-415102", "415102", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-415161">
<div class="comment-container" id="li-comment-415161">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-415161" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it Iain.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=415161#respond" onclick='return addComment.moveForm( "comment-415161", "415161", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416745">
<div class="comment-container" id="li-comment-416745">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b0e4dc34fd10fe2b9d039541b08b54aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b0e4dc34fd10fe2b9d039541b08b54aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vibhu</span>
<span class="date">October 15, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-416745" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>Thanks for such a nice effort in deep learning stuff. </p>
<p>I am trying to run your code on my machine and it throws me this hdf5 error:</p>
<p>  File “C:/Users/CPL-Admin/PycharmProjects/Tensor/KerasCNN.py”, line 59, in<br/>
    model.load_weights(filename)<br/>
  File “C:\Users\CPL-Admin\AppData\Local\Programs\Python\Python36\lib\site-packages\keras\models.py”, line 707, in load_weights<br/>
    f = h5py.File(filepath, mode=’r’)<br/>
  File “C:\Users\CPL-Admin\AppData\Local\Programs\Python\Python36\lib\site-packages\h5py\_hl\files.py”, line 269, in __init__<br/>
    fid = make_fid(name, mode, userblock_size, fapl, swmr=swmr)<br/>
  File “C:\Users\CPL-Admin\AppData\Local\Programs\Python\Python36\lib\site-packages\h5py\_hl\files.py”, line 99, in make_fid<br/>
    fid = h5f.open(name, flags, fapl=fapl)<br/>
  File “h5py\_objects.pyx”, line 54, in h5py._objects.with_phil.wrapper<br/>
  File “h5py\_objects.pyx”, line 55, in h5py._objects.with_phil.wrapper<br/>
  File “h5py\h5f.pyx”, line 78, in h5py.h5f.open<br/>
OSError: Unable to open file (unable to open file: name = ‘weights-improvement-47-1.2219-bigger.hdf5’, errno = 2, error message = ‘No such file or directory’, flags = 0, o_flags = 0)</p>
<div class="reply">
<a aria-label="Reply to Vibhu" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=416745#respond" onclick='return addComment.moveForm( "comment-416745", "416745", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416828">
<div class="comment-container" id="li-comment-416828">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-416828" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks like the file or path does not exist. </p>
<p>Perhaps check that the file with that name exists in the current working directory.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=416828#respond" onclick='return addComment.moveForm( "comment-416828", "416828", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416746">
<div class="comment-container" id="li-comment-416746">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bb92d72bf9f00c93893f4e66b4a21f8e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bb92d72bf9f00c93893f4e66b4a21f8e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Flo</span>
<span class="date">October 15, 2017 at 8:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-416746" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello.</p>
<p>I’m currently trying to convert your process, using characters as an unit of information, to a system where I’m using the words as an unit of information. Currently dabbling in the domain of NN, I’m trying to figure out why I would get a repeated sequence of words without any change, and I may have some clues:<br/>
– Too much classes? With letters we have arond 30 or so classes (as we have the alphabet + the residual tick/backtick). Does it have really an impact during learning so generation can give this kind of repetitive result?<br/>
  + A few notions from the Markov chain is staying with me and I have a supposition why the system repeats in such cases : maybe the link between words isn’t pronounced enough fror the generator to choose anything else than what was provided to it?<br/>
– Wrong parameters? I’m trying multiple settings for the learning process, such as changing seq_length to 10 or 50 or something else and/or changing the batch size?<br/>
– Corpus too small? Should I grab other books?<br/>
– Training too short? Is 60 epochs a relatively small or important processus?<br/>
– Note : I’m currently using a set to remove repeated sequences once the text tokenized . It really helps is seq_len is small, I think it could also help for character-based processing. That’s additional init overhead, but I think it might worth it.</p>
<p>I copied the code into this gist to avoid cluttering any further the comment log : <a href="https://gist.github.com/anonymous/28f30611bb0849ef0d99fd341e6e1d7b" rel="nofollow">https://gist.github.com/anonymous/28f30611bb0849ef0d99fd341e6e1d7b</a></p>
<p>Thanks for the article, it was pretty interesting and made me learn quite a bit on notions I forgot or didn’t understand well. I look forward to learn more and understand how to progress!</p>
<p>Have a nice day!</p>
<div class="reply">
<a aria-label="Reply to Flo" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=416746#respond" onclick='return addComment.moveForm( "comment-416746", "416746", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416829">
<div class="comment-container" id="li-comment-416829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-416829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work, I recommend testing each hypothesis.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=416829#respond" onclick='return addComment.moveForm( "comment-416829", "416829", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416989">
<div class="comment-container" id="li-comment-416989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b888037450d078fff5f8eba237fc9ac2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b888037450d078fff5f8eba237fc9ac2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bhau</span>
<span class="date">October 17, 2017 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-416989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Instead of letters, can we map each individual word to a number? Then we can use a few words worth of context to predict the next word.<br/>
So we could have [“I”,”am”,”a”] as the input and have [“human”] as the output.</p>
<p>I’m still learning a few concepts, so I might be wrong.</p>
<div class="reply">
<a aria-label="Reply to Bhau" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=416989#respond" onclick='return addComment.moveForm( "comment-416989", "416989", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417015">
<div class="comment-container" id="li-comment-417015">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 17, 2017 at 4:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-417015" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Absolutely!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=417015#respond" onclick='return addComment.moveForm( "comment-417015", "417015", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417869">
<div class="comment-container" id="li-comment-417869">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/096bba8a73ba91f954823f94504a49eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/096bba8a73ba91f954823f94504a49eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stuart</span>
<span class="date">October 25, 2017 at 1:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-417869" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>book text link is dead.  new location seems to be: <a href="http://www.gutenberg.org/files/11/11-0.txt" rel="nofollow">http://www.gutenberg.org/files/11/11-0.txt</a></p>
<div class="reply">
<a aria-label="Reply to Stuart" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=417869#respond" onclick='return addComment.moveForm( "comment-417869", "417869", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-417871">
<div class="comment-container" id="li-comment-417871">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/096bba8a73ba91f954823f94504a49eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/096bba8a73ba91f954823f94504a49eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stuart</span>
<span class="date">October 25, 2017 at 1:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-417871" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>nevermind, i’m totally wrong.  please delete 🙂</p>
<div class="reply">
<a aria-label="Reply to Stuart" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=417871#respond" onclick='return addComment.moveForm( "comment-417871", "417871", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417885">
<div class="comment-container" id="li-comment-417885">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 4:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-417885" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may have to visit the link twice to set/use the cookie.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=417885#respond" onclick='return addComment.moveForm( "comment-417885", "417885", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419964">
<div class="comment-container" id="li-comment-419964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ed47d4429d540cac1b22577a6991000c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ed47d4429d540cac1b22577a6991000c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ari</span>
<span class="date">November 14, 2017 at 1:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-419964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just wanted to say you are an amazing human who is enabling tons of people to learn complex material that otherwise might not be able to. I’m also astounded with your dedication in responding to literally every single comment, and within a short time too. You’re making the world a better place.</p>
<div class="reply">
<a aria-label="Reply to Ari" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=419964#respond" onclick='return addComment.moveForm( "comment-419964", "419964", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420036">
<div class="comment-container" id="li-comment-420036">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-420036" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Ari, I appreciate your support and recognition!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=420036#respond" onclick='return addComment.moveForm( "comment-420036", "420036", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420597">
<div class="comment-container" id="li-comment-420597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4c4129181745b8d5a1bddca54eed588c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4c4129181745b8d5a1bddca54eed588c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.iie.ac.cn" rel="external nofollow">Ying Sha</a></span>
<span class="date">November 20, 2017 at 12:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-420597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,Jason, Thank you so much for the great post!<br/>
    I ran the exact same code of your small LSTM network on the same book(wonderland.txt)<br/>
    for 20 epochs.<br/>
    But I get an error with this line:<br/>
    “model.add(LSTM(256, input_shape=(X.shape[1], X.shape[2]))) ”</p>
<p>    The error:<br/>
    “TypeError: Expected int32, got list containing Tensors of type ‘_Message’ instead.”</p>
<p>    Could you please give me some insights on why this is happening and how to fix it?<br/>
    Thank you very much!</p>
<p>    Tensorflow: 0.10.0rc0<br/>
    Keras: 2.1.1</p>
<div class="reply">
<a aria-label="Reply to Ying Sha" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=420597#respond" onclick='return addComment.moveForm( "comment-420597", "420597", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420642">
<div class="comment-container" id="li-comment-420642">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2017 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-420642" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not seen this error before.</p>
<p>Perhaps double check that you have copied all of the code from the example exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=420642#respond" onclick='return addComment.moveForm( "comment-420642", "420642", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421751">
<div class="comment-container" id="li-comment-421751">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/94b12ae0724413e9eabe396f7eec3c25?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/94b12ae0724413e9eabe396f7eec3c25?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Martin</span>
<span class="date">November 30, 2017 at 10:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-421751" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>I have been looking at examples of LSTM text generation for some time and I have the following question:</p>
<p>Once the network has been trained and all the weights have been fixed at some acceptable values, would the network generate different text every time it is fed the same input seed text (“What would happen” , for example), or would the output text sequence always be the same for that exact input seed because the next character with the highest probability after the sequence “What would happen” would always be predicted to be the same on each run due to the network’s fixed weights, and then the next one after appending the previously predicted character to the input as well, etc.?</p>
<p>I am working on a similar LSTM network in tensorflow for a sequence-labeling problem, and so far it appears that my generated output sequence is always exactly the same for a fixed starting input. Is there a way to generate different output sequences for the same input seed?</p>
<div class="reply">
<a aria-label="Reply to Martin" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=421751#respond" onclick='return addComment.moveForm( "comment-421751", "421751", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421806">
<div class="comment-container" id="li-comment-421806">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 1, 2017 at 7:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-421806" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Once the network is trained, it will make deterministic predictions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=421806#respond" onclick='return addComment.moveForm( "comment-421806", "421806", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421830">
<div class="comment-container" id="li-comment-421830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/94b12ae0724413e9eabe396f7eec3c25?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/94b12ae0724413e9eabe396f7eec3c25?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Martin</span>
<span class="date">December 1, 2017 at 11:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-421830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the answer. I suppose what I was describing was a stochastic Neural Network.</p>
<div class="reply">
<a aria-label="Reply to Martin" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=421830#respond" onclick='return addComment.moveForm( "comment-421830", "421830", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422329">
<div class="comment-container" id="li-comment-422329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d8eb21f4ff617f2b9c6e91eb9d2eaa8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d8eb21f4ff617f2b9c6e91eb9d2eaa8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Martin</span>
<span class="date">December 7, 2017 at 3:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-422329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason</p>
<p>May I ask why you used a normalized X vector as input and not just onehot-encoded input? Is this done by someone else as well? Just curious because I don’t really see an advantage over onehot encoding.</p>
<div class="reply">
<a aria-label="Reply to Martin" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=422329#respond" onclick='return addComment.moveForm( "comment-422329", "422329", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422362">
<div class="comment-container" id="li-comment-422362">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 8:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-422362" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend one hot encoding instead these days.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=422362#respond" onclick='return addComment.moveForm( "comment-422362", "422362", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423012">
<div class="comment-container" id="li-comment-423012">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dd73bdae1ce21860983feb37e9df56b0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dd73bdae1ce21860983feb37e9df56b0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://na" rel="external nofollow">Arshdeep</a></span>
<span class="date">December 13, 2017 at 6:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-423012" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can you put your pretrained weights?</p>
<div class="reply">
<a aria-label="Reply to Arshdeep" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=423012#respond" onclick='return addComment.moveForm( "comment-423012", "423012", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423055">
<div class="comment-container" id="li-comment-423055">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 14, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-423055" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can use pre-trained weights.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=423055#respond" onclick='return addComment.moveForm( "comment-423055", "423055", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423013">
<div class="comment-container" id="li-comment-423013">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dd73bdae1ce21860983feb37e9df56b0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dd73bdae1ce21860983feb37e9df56b0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://na" rel="external nofollow">Emilia Stark</a></span>
<span class="date">December 13, 2017 at 6:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-423013" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Shouldn’t we use word2vec instead of one-hot encoding?</p>
<div class="reply">
<a aria-label="Reply to Emilia Stark" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=423013#respond" onclick='return addComment.moveForm( "comment-423013", "423013", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423056">
<div class="comment-container" id="li-comment-423056">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 14, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-423056" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=423056#respond" onclick='return addComment.moveForm( "comment-423056", "423056", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425269">
<div class="comment-container" id="li-comment-425269">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f97013c69221c402abb5485d13d5d8ef?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f97013c69221c402abb5485d13d5d8ef?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David</span>
<span class="date">December 31, 2017 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425269" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
thanks for this great post. Do you have experience in using the LSTM as a model for Genetic Programming to further improve the output? Or have you ever heard about it? It would then be something like an EDA-GP. If you know anything about it, i’d be happy if you let me know!<br/>
Many thanks in advance!<br/>
David</p>
<div class="reply">
<a aria-label="Reply to David" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425269#respond" onclick='return addComment.moveForm( "comment-425269", "425269", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425319">
<div class="comment-container" id="li-comment-425319">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 1, 2018 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425319" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’ve not heard about using LSTMs with GPs. Interesting idea.</p>
<p>What makes you want to explore this combination?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425319#respond" onclick='return addComment.moveForm( "comment-425319", "425319", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-425468">
<div class="comment-container" id="li-comment-425468">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f97013c69221c402abb5485d13d5d8ef?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f97013c69221c402abb5485d13d5d8ef?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David</span>
<span class="date">January 3, 2018 at 4:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425468" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Oh I was just wondering. I’ve recently seen some other text generation work, they implemented it quite similarly as you did but came to the conclusion that in future this could probably be improved by using the LSTM as a model for a genetic program, to add further constraints and thus to improve the output. I just wanted to know if something like this has already been implemented. Yesterday I came across a really interesting paper. (<a href="https://arxiv.org/pdf/1602.07776.pdf" rel="nofollow">https://arxiv.org/pdf/1602.07776.pdf</a>) They invented a new method: Recurrent Neural Network Grammars (RNNGs). They report major improvements both in language modeling as also in parsing. I will maybe try this out, as a topic for my master thesis.<br/>
Thanks for you prompt reply!<br/>
Best regards and happy new year!<br/>
David</p>
<div class="reply">
<a aria-label="Reply to David" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425468#respond" onclick='return addComment.moveForm( "comment-425468", "425468", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-425487">
<div class="comment-container" id="li-comment-425487">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 3, 2018 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425487" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Looks interesting, thanks for sharing.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425487#respond" onclick='return addComment.moveForm( "comment-425487", "425487", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425895">
<div class="comment-container" id="li-comment-425895">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a022b4cf7598637720437a865209120e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a022b4cf7598637720437a865209120e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jens Albrecht</span>
<span class="date">January 8, 2018 at 11:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425895" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you for your great site and all the material that you offer.</p>
<p>I’ve been trying to modify the LSTM to predict words instead of letters. I stripped all special characters and numbers from the text and vectorized the words. It’s 26386 words in total and  2771 distinct words. The model could be trained, but it always and only predicts the word “the” as next word. I tried different sequence lengths with the simple and the complex model, but the result stays the same. Of “the” is the most frequent word with 1600 occurences, but shouldn’t the model still be able to predict something else? Or is the corpus just too small? What do you think?</p>
<div class="reply">
<a aria-label="Reply to Jens Albrecht" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425895#respond" onclick='return addComment.moveForm( "comment-425895", "425895", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425919">
<div class="comment-container" id="li-comment-425919">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 9, 2018 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-425919" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post has an example of a word-based language generator:<br/>
<a href="https://machinelearningmastery.com/develop-word-based-neural-language-models-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-word-based-neural-language-models-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=425919#respond" onclick='return addComment.moveForm( "comment-425919", "425919", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426222">
<div class="comment-container" id="li-comment-426222">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a86d0e8be37315eda8b41fbae237278f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a86d0e8be37315eda8b41fbae237278f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kay</span>
<span class="date">January 11, 2018 at 6:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-426222" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Thanks for good contents, I have a question.<br/>
Is it possible to make similar sentence with RNN?<br/>
For example, seed sentence : “The rabbit-hole went straight on like a tunnel for some way”<br/>
generating several similar sentences :<br/>
” The rabbit is  go straight on like a tunnel”<br/>
” The rabbit hole went straight”<br/>
“The rabbit straight for some way”</p>
<p>I don’t focus the semantic for sentences, just need to make training data with tagging to solve other text domain problem</p>
<div class="reply">
<a aria-label="Reply to kay" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=426222#respond" onclick='return addComment.moveForm( "comment-426222", "426222", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426257">
<div class="comment-container" id="li-comment-426257">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/#comment-426257" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, generate multiple times, or generate once and use beam search to read off multiple output lines.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/?replytocom=426257#respond" onclick='return addComment.moveForm( "comment-426257", "426257", "respond", "2964" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/text-generation-lstm-recurrent-neural-networks-python-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="2964"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="5c07d4a8dd"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="122"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Text Data</h3>
<p>Cut through the math and research papers.<br/>
Discover Word Embeddings, Text Translation and more.</p>
<p><a href="/deep-learning-for-nlp/">Get Started With Deep Learning for NLP Today!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>