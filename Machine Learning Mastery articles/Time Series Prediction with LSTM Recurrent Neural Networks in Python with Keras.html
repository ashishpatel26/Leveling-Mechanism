<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras - Machine Learning Mastery" property="og:title"/>
<meta content="Time series prediction problems are a difficult type of predictive modeling problem. Unlike regression predictive modeling, time series also adds the complexity of a sequence dependence among the input variables. A powerful type of neural network designed to handle sequence dependence is called recurrent neural networks. The Long Short-Term Memory network or LSTM network is …" property="og:description"/>
<meta content="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2016-07-21T05:00:25+11:00" property="article:published_time"/>
<meta content="2017-08-21T16:33:19+11:00" property="article:modified_time"/>
<meta content="2017-08-21T16:33:19+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/time-series-prediction-lstm-recurrent-neural-networks-python-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/feed/" rel="alternate" title="Machine Learning Mastery » Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=2929" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-prediction-lstm-recurrent-neural-networks-python-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-prediction-lstm-recurrent-neural-networks-python-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-2929 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-2929 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2016-07-21T05:00:25+1100">July 21, 2016</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-prediction-lstm-recurrent-neural-networks-python-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/&amp;summary=Time+series+prediction+problems+are+a+difficult+type+of+predictive+modeling+problem.%0D%0A%0D%0AUnlike+regre..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/&amp;summary=Time+series+prediction+problems+are+a+difficult+type+of+predictive+modeling+problem.%0D%0A%0D%0AUnlike+regre...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Time series prediction problems are a difficult type of predictive modeling problem.</p>
<p>Unlike regression predictive modeling, time series also adds the complexity of a sequence dependence among the input variables.</p>
<p>A powerful type of neural network designed to handle sequence dependence is called <a href="http://machinelearningmastery.com/crash-course-recurrent-neural-networks-deep-learning/">recurrent neural networks</a>. The Long Short-Term Memory network or LSTM network is a type of recurrent neural network used in deep learning because very large architectures can be successfully trained.</p>
<p>In this post, you will discover how to develop LSTM networks in Python using the Keras deep learning library to address a demonstration time-series prediction problem.</p>
<p>After completing this tutorial you will know how to implement and develop LSTM networks for your own time series prediction problems and other more general sequence problems. You will know:</p>
<ul>
<li>About the International Airline Passengers time-series prediction problem.</li>
<li>How to develop LSTM networks for regression, window and time-step based framing of time series prediction problems.</li>
<li>How to develop and make predictions using LSTM networks that maintain state (memory) across very long sequences.</li>
</ul>
<p>In this tutorial, we will develop a number of LSTMs for a standard time series prediction problem. The problem and the chosen configuration for the LSTM networks are  for demonstration purposes only they are not optimized.</p>
<p>These examples will show you exactly how you can develop your own differently structured LSTM networks for time series predictive modeling problems.</p>
<p>Let’s get started.</p>
<ul>
<li><strong>Update Oct/2016</strong>: There was an error in the way that RMSE was calculated in each example. Reported RMSEs were just plain wrong. Now, RMSE is calculated directly from predictions and both RMSE and graphs of predictions are in the units of the original dataset. Models were evaluated using Keras 1.1.0, TensorFlow 0.10.0 and scikit-learn v0.18. Thanks to all those that pointed out the issue, and to Philip O’Brien for helping to point out the fix.</li>
<li><strong>Update Mar/2017</strong>: Updated example for Keras 2.0.2, TensorFlow 1.0.1 and Theano 0.9.0.</li>
<li><strong>Update Apr/2017</strong>: For a more complete and better explained tutorial of LSTMs for time series forecasting see the post <a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>.</li>
</ul>
<h3>Updated LSTM Time Series Forecasting Posts:</h3>
<p>The example in this post is quite dated, I have better examples available for using LSTMs on time series, see:</p>
<ol>
<li><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/">LSTMs for Univariate Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/">LSTMs for Multivariate Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/">LSTMs for Multi-Step Time Series Forecasting</a></li>
</ol>
<div class="wp-caption aligncenter" id="attachment_2937" style="max-width: 650px"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="size-full wp-image-2937" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-300x200.jpg 300w" width="640"/><p class="wp-caption-text">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras<br/>Photo by <a href="https://www.flickr.com/photos/124559226@N08/15792381395/">Margaux-Marguerite Duquesnoy</a>, some rights reserved.</p></div>
<h2>Problem Description</h2>
<p>The problem we are going to look at in this post is theInternational Airline Passengers prediction problem.</p>
<p>This is a problem where, given a year and a month, the task is to predict the number of international airline passengers in units of 1,000. The data ranges from January 1949 to December 1960, or 12 years, with 144 observations.</p>
<p>The dataset is available for free from the <a href="https://datamarket.com/data/set/22u3/international-airline-passengers-monthly-totals-in-thousands-jan-49-dec-60#!ds=22u3&amp;display=line">DataMarket webpage as a CSV download</a> with the filename “<em>international-airline-passengers.csv</em>“.</p>
<p>Below is a sample of the first few lines of the file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecbea525815391" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
"Month","International airline passengers: monthly totals in thousands. Jan 49 ? Dec 60"
"1949-01",112
"1949-02",118
"1949-03",132
"1949-04",129
"1949-05",121</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecbea525815391-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbea525815391-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecbea525815391-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbea525815391-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecbea525815391-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbea525815391-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecbea525815391-1">"Month","International airline passengers: monthly totals in thousands. Jan 49 ? Dec 60"</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbea525815391-2">"1949-01",112</div><div class="crayon-line" id="crayon-5a65929fecbea525815391-3">"1949-02",118</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbea525815391-4">"1949-03",132</div><div class="crayon-line" id="crayon-5a65929fecbea525815391-5">"1949-04",129</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbea525815391-6">"1949-05",121</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can load this dataset easily using the Pandas library. We are not interested in the date, given that each observation is separated by the same interval of one month. Therefore, when we load the dataset we can exclude the first column.</p>
<p>The downloaded dataset also has footer information that we can exclude with the <strong>skipfooter</strong> argument to <strong>pandas.read_csv()</strong> set to 3 for the 3 footer lines. Once loaded we can easily plot the whole dataset. The code to load and plot the dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecbf5386545742" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import pandas
import matplotlib.pyplot as plt
dataset = pandas.read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
plt.plot(dataset)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecbf5386545742-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf5386545742-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecbf5386545742-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf5386545742-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecbf5386545742-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecbf5386545742-1"><span class="crayon-e">import </span><span class="crayon-e">pandas</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf5386545742-2"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line" id="crayon-5a65929fecbf5386545742-3"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pandas</span><span class="crayon-sy">.</span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf5386545742-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecbf5386545742-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>You can see an upward trend in the dataset over time.</p>
<p>You can also see some periodicity to the dataset that probably corresponds to the Northern Hemisphere vacation period.</p>
<div class="wp-caption aligncenter" id="attachment_2925" style="max-width: 810px"><img alt="Plot of the Airline Passengers Dataset" class="size-full wp-image-2925" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Airline-Passengers-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Airline-Passengers-Dataset.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Airline-Passengers-Dataset-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Airline-Passengers-Dataset-768x576.png 768w" width="800"/><p class="wp-caption-text">Plot of the Airline Passengers Dataset</p></div>
<p>We are going to keep things simple and work with the data as-is.</p>
<p>Normally, it is a good idea to investigate various data preparation techniques to rescale the data and to make it stationary.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Long Short-Term Memory Network</h2>
<p>The Long Short-Term Memory network, or LSTM network, is a recurrent neural network that is trained using Backpropagation Through Time and overcomes the vanishing gradient problem.</p>
<p>As such, it can be used to create large recurrent networks that in turn can be used to address difficult sequence problems in machine learning and achieve state-of-the-art results.</p>
<p>Instead of neurons, LSTM networks have memory blocks that are connected through layers.</p>
<p>A block has components that make it smarter than a classical neuron and a memory for recent sequences. A block contains gates that manage the block’s state and output. A block operates upon an input sequence and each gate within a block uses the sigmoid activation units to control whether they are triggered or not, making the change of state and addition of information flowing through the block conditional.</p>
<p>There are three types of gates within a unit:</p>
<ul>
<li><strong>Forget Gate</strong>: conditionally decides what information to throw away from the block.</li>
<li><strong>Input Gate</strong>: conditionally decides which values from the input to update the memory state.</li>
<li><strong>Output Gate</strong>: conditionally decides what to output based on input and the memory of the block.</li>
</ul>
<p>Each unit is like a mini-state machine where the gates of the units have weights that are learned during the training procedure.</p>
<p>You can see how you may achieve sophisticated learning and memory from a layer of LSTMs, and it is not hard to imagine how higher-order abstractions may be layered with multiple such layers.</p>
<h2>LSTM Network for Regression</h2>
<p>We can phrase the problem as a regression problem.</p>
<p>That is, given the number of passengers (in units of thousands) this month, what is the number of passengers next month?</p>
<p>We can write a simple function to convert our single column of data into a two-column dataset: the first column containing this month’s (t) passenger count and the second column containing next month’s (t+1) passenger count, to be predicted.</p>
<p>Before we get started, let’s first import all of the functions and classes we intend to use. This assumes a working SciPy environment with the Keras deep learning library installed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecbf9610755782" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import numpy
import matplotlib.pyplot as plt
import pandas
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecbf9610755782-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf9610755782-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecbf9610755782-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf9610755782-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecbf9610755782-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf9610755782-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecbf9610755782-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbf9610755782-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecbf9610755782-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecbf9610755782-1"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf9610755782-2"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line" id="crayon-5a65929fecbf9610755782-3"><span class="crayon-e">import </span><span class="crayon-e">pandas</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf9610755782-4"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line" id="crayon-5a65929fecbf9610755782-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf9610755782-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5a65929fecbf9610755782-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbf9610755782-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line" id="crayon-5a65929fecbf9610755782-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Before we do anything, it is a good idea to fix the random number seed to ensure our results are reproducible.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecbfc636932034" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fix random seed for reproducibility
numpy.random.seed(7)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecbfc636932034-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbfc636932034-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecbfc636932034-1"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbfc636932034-2"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can also use the code from the previous section to load the dataset as a Pandas dataframe. We can then extract the NumPy array from the dataframe and convert the integer values to floating point values, which are more suitable for modeling with a neural network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecbfe345258692" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load the dataset
dataframe = pandas.read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecbfe345258692-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbfe345258692-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecbfe345258692-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecbfe345258692-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecbfe345258692-1"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbfe345258692-2"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pandas</span><span class="crayon-sy">.</span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecbfe345258692-3"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecbfe345258692-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>LSTMs are sensitive to the scale of the input data, specifically when the sigmoid (default) or tanh activation functions are used. It can be a good practice to rescale the data to the range of 0-to-1, also called normalizing. We can easily normalize the dataset using the <strong>MinMaxScaler</strong> preprocessing class from the scikit-learn library.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc01445510194" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc01445510194-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc01445510194-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc01445510194-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc01445510194-1"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc01445510194-2"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc01445510194-3"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>After we model our data and estimate the skill of our model on the training dataset, we need to get an idea of the skill of the model on new unseen data. For a normal classification or regression problem, we would do this using cross validation.</p>
<p>With time series data, the sequence of values is important. A simple method that we can use is to split the ordered dataset into train and test datasets. The code below calculates the index of the split point and separates the data into the training datasets with 67% of the observations that we can use to train our model, leaving the remaining 33% for testing the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc04179415842" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
print(len(train), len(test))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc04179415842-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc04179415842-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc04179415842-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc04179415842-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc04179415842-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc04179415842-1"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc04179415842-2"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc04179415842-3"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc04179415842-4"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65929fecc04179415842-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Now we can define a function to create a new dataset, as described above.</p>
<p>The function takes two arguments: the <strong>dataset</strong>, which is a NumPy array that we want to convert into a dataset, and the <strong>look_back</strong>, which is the number of previous time steps to use as input variables to predict the next time period — in this case defaulted to 1.</p>
<p>This default will create a dataset where X is the number of passengers at a given time (t) and Y is the number of passengers at the next time (t + 1).</p>
<p>It can be configured, and we will by constructing a differently shaped dataset in the next section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc06263883000" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc06263883000-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc06263883000-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc06263883000-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc06263883000-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc06263883000-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc06263883000-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc06263883000-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc06263883000-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc06263883000-1"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc06263883000-2"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc06263883000-3"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc06263883000-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc06263883000-5"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc06263883000-6"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc06263883000-7"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc06263883000-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Let’s take a look at the effect of this function on the first rows of the dataset (shown in the unnormalized form for clarity).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc09375302831" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X		Y
112		118
118		132
132		129
129		121
121		135</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc09375302831-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc09375302831-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc09375302831-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc09375302831-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc09375302831-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc09375302831-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc09375302831-1">X		Y</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc09375302831-2">112		118</div><div class="crayon-line" id="crayon-5a65929fecc09375302831-3">118		132</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc09375302831-4">132		129</div><div class="crayon-line" id="crayon-5a65929fecc09375302831-5">129		121</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc09375302831-6">121		135</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><span style="line-height: 1.5;">If you compare these first 5 rows to the original dataset sample listed in the previous section, you can see the X=t and Y=t+1 pattern in the numbers.</span></p>
<p>Let’s use this function to prepare the train and test datasets for modeling.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc0b943850130" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape into X=t and Y=t+1
look_back = 1
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc0b943850130-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc0b943850130-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc0b943850130-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc0b943850130-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc0b943850130-1"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc0b943850130-2"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65929fecc0b943850130-3"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc0b943850130-4"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The LSTM network expects the input data (X) to be provided with a specific array structure in the form of: <em>[samples, time steps, features]</em>.</p>
<p>Currently, our data is in the form: [<em>samples, features</em>] and we are framing the problem as one time step for each sample. We can transform the prepared train and test input data into the expected structure using <strong>numpy.reshape()</strong> as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc0e921289933" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc0e921289933-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc0e921289933-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc0e921289933-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc0e921289933-1"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc0e921289933-2"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc0e921289933-3"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We are now ready to design and fit our LSTM network for this problem.</p>
<p>The network has a visible layer with 1 input, a hidden layer with 4 LSTM blocks or neurons, and an output layer that makes a single value prediction. The default sigmoid activation function is used for the LSTM blocks. The network is trained for 100 epochs and a batch size of 1 is used.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc10575355240" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create and fit the LSTM network
model = Sequential()
model.add(LSTM(4, input_shape=(1, look_back)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
model.fit(trainX, trainY, epochs=100, batch_size=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc10575355240-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc10575355240-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc10575355240-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc10575355240-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc10575355240-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc10575355240-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc10575355240-1"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc10575355240-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc10575355240-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc10575355240-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc10575355240-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc10575355240-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Once the model is fit, we can estimate the performance of the model on the train and test datasets. This will give us a point of comparison for new models.</p>
<p>Note that we invert the predictions before calculating error scores to ensure that performance is reported in the same units as the original data (thousands of passengers per month).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc13508725808" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make predictions
trainPredict = model.predict(trainX)
testPredict = model.predict(testX)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc13508725808-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc13508725808-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc13508725808-1"><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-2"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-3"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-4"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-5"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-6"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-7"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-8"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-9"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-10"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc13508725808-12"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc13508725808-13"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>Finally, we can generate predictions using the model for both the train and test dataset to get a visual indication of the skill of the model.</p>
<p>Because of how the dataset was prepared, we must shift the predictions so that they align on the x-axis with the original dataset. Once prepared, the data is plotted, showing the original dataset in blue, the predictions for the training dataset in green, and the predictions on the unseen test dataset in red.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc16570984666" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc16570984666-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc16570984666-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc16570984666-1"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-2"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-3"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-4"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-5"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-6"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-7"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-8"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-9"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-10"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-11"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc16570984666-12"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc16570984666-13"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>We can see that the model did an excellent job of fitting both the training and the test datasets.</p>
<div class="wp-caption aligncenter" id="attachment_3303" style="max-width: 810px"><img alt="LSTM Trained on Regression Formulation of Passenger Prediction Problem" class="size-full wp-image-3303" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Trained-on-Regression-Formulation-of-Passenger-Prediction-Problem-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Trained-on-Regression-Formulation-of-Passenger-Prediction-Problem-1.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Trained-on-Regression-Formulation-of-Passenger-Prediction-Problem-1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Trained-on-Regression-Formulation-of-Passenger-Prediction-Problem-1-768x576.png 768w" width="800"/><p class="wp-caption-text">LSTM Trained on Regression Formulation of Passenger Prediction Problem</p></div>
<p>For completeness, below is the entire code example.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc18458013885" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# LSTM for international airline passengers problem with regression framing
import numpy
import matplotlib.pyplot as plt
from pandas import read_csv
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)
# fix random seed for reproducibility
numpy.random.seed(7)
# load the dataset
dataframe = read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
# reshape into X=t and Y=t+1
look_back = 1
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))
# create and fit the LSTM network
model = Sequential()
model.add(LSTM(4, input_shape=(1, look_back)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
model.fit(trainX, trainY, epochs=100, batch_size=1, verbose=2)
# make predictions
trainPredict = model.predict(trainX)
testPredict = model.predict(testX)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-16">16</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-18">18</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-20">20</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-22">22</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-24">24</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-26">26</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-28">28</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-30">30</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-32">32</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-34">34</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-36">36</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-38">38</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-40">40</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-42">42</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-44">44</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-46">46</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-48">48</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-50">50</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-52">52</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-54">54</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-56">56</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-58">58</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-60">60</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-62">62</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-64">64</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-66">66</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-68">68</div><div class="crayon-num" data-line="crayon-5a65929fecc18458013885-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc18458013885-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc18458013885-1"><span class="crayon-p"># LSTM for international airline passengers problem with regression framing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-3"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-5"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-11"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-12"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-13"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-15"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-16"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-17"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-19"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-20"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-21"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-22"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-23"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-24"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-25"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-26"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-27"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-28"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-29"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-30"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-31"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-32"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-33"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-34"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-35"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-36"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-37"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-38"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-39"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-40"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-45"><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-46"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-47"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-48"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-49"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-50"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-51"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-52"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-53"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-54"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-56"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-57"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-58"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-59"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-60"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-61"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-62"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-63"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-64"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-65"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-66"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-67"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-68"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc18458013885-69"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc18458013885-70"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Running the example produces the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc1d080256168" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 95/100
0s - loss: 0.0020
Epoch 96/100
0s - loss: 0.0020
Epoch 97/100
0s - loss: 0.0020
Epoch 98/100
0s - loss: 0.0020
Epoch 99/100
0s - loss: 0.0020
Epoch 100/100
0s - loss: 0.0020
Train Score: 22.93 RMSE
Test Score: 47.53 RMSE</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc1d080256168-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc1d080256168-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc1d080256168-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-2">Epoch 95/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-3">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-4">Epoch 96/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-5">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-6">Epoch 97/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-7">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-8">Epoch 98/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-9">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-10">Epoch 99/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-11">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-12">Epoch 100/100</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-13">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc1d080256168-14">Train Score: 22.93 RMSE</div><div class="crayon-line" id="crayon-5a65929fecc1d080256168-15">Test Score: 47.53 RMSE</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that the model has an average error of about 23 passengers (in thousands) on the training dataset, and about 52 passengers (in thousands) on the test dataset. Not that bad.</p>
<h2>LSTM for Regression Using the Window Method</h2>
<p>We can also phrase the problem so that multiple, recent time steps can be used to make the prediction for the next time step.</p>
<p>This is called a window, and the size of the window is a parameter that can be tuned for each problem.</p>
<p>For example, given the current time (t) we want to predict the value at the next time in the sequence (t+1), we can use the current time (t), as well as the two prior times (t-1 and t-2) as input variables.</p>
<p>When phrased as a regression problem, the input variables are t-2, t-1, t and the output variable is t+1.</p>
<p>The <strong>create_dataset()</strong> function we created in the previous section allows us to create this formulation of the time series problem by increasing the <strong>look_back</strong> argument from 1 to 3.</p>
<p>A sample of the dataset with this formulation looks as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc20143372423" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X1	X2	X3	Y
112	118	132	129
118	132	129	121
132	129	121	135
129	121	135	148
121	135	148	148</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc20143372423-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc20143372423-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc20143372423-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc20143372423-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc20143372423-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc20143372423-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc20143372423-1">X1	X2	X3	Y</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc20143372423-2">112	118	132	129</div><div class="crayon-line" id="crayon-5a65929fecc20143372423-3">118	132	129	121</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc20143372423-4">132	129	121	135</div><div class="crayon-line" id="crayon-5a65929fecc20143372423-5">129	121	135	148</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc20143372423-6">121	135	148	148</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can re-run the example in the previous section with the larger window size. The whole code listing with just the window size change is listed below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc22534671571" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# LSTM for international airline passengers problem with window regression framing
import numpy
import matplotlib.pyplot as plt
from pandas import read_csv
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)
# fix random seed for reproducibility
numpy.random.seed(7)
# load the dataset
dataframe = read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
# reshape into X=t and Y=t+1
look_back = 3
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))
# create and fit the LSTM network
model = Sequential()
model.add(LSTM(4, input_shape=(1, look_back)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
model.fit(trainX, trainY, epochs=100, batch_size=1, verbose=2)
# make predictions
trainPredict = model.predict(trainX)
testPredict = model.predict(testX)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-16">16</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-18">18</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-20">20</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-22">22</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-24">24</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-26">26</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-28">28</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-30">30</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-32">32</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-34">34</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-36">36</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-38">38</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-40">40</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-42">42</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-44">44</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-46">46</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-48">48</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-50">50</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-52">52</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-54">54</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-56">56</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-58">58</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-60">60</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-62">62</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-64">64</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-66">66</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-68">68</div><div class="crayon-num" data-line="crayon-5a65929fecc22534671571-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc22534671571-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc22534671571-1"><span class="crayon-p"># LSTM for international airline passengers problem with window regression framing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-3"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-5"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-11"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-12"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-13"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-15"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-16"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-17"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-19"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-20"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-21"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-22"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-23"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-24"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-25"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-26"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-27"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-28"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-29"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-30"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-31"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-32"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-33"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-34"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-35"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-36"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-37"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-38"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-39"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-40"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-45"><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-46"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-47"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-48"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-49"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-50"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-51"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-52"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-53"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-54"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-56"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-57"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-58"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-59"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-60"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-61"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-62"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-63"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-64"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-65"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-66"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-67"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-68"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc22534671571-69"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc22534671571-70"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0060 seconds] -->
<p>Running the example provides the following output:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc26044066704" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 95/100
0s - loss: 0.0021
Epoch 96/100
0s - loss: 0.0021
Epoch 97/100
0s - loss: 0.0021
Epoch 98/100
0s - loss: 0.0021
Epoch 99/100
0s - loss: 0.0022
Epoch 100/100
0s - loss: 0.0020
Train Score: 24.19 RMSE
Test Score: 58.03 RMSE</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc26044066704-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc26044066704-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc26044066704-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-2">Epoch 95/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-3">0s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-4">Epoch 96/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-5">0s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-6">Epoch 97/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-7">0s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-8">Epoch 98/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-9">0s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-10">Epoch 99/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-11">0s - loss: 0.0022</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-12">Epoch 100/100</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-13">0s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc26044066704-14">Train Score: 24.19 RMSE</div><div class="crayon-line" id="crayon-5a65929fecc26044066704-15">Test Score: 58.03 RMSE</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that the error was increased slightly compared to that of the previous section. The window size and the network architecture were not tuned: this is just a demonstration of how to frame a prediction problem.</p>
<div class="wp-caption aligncenter" id="attachment_3304" style="max-width: 810px"><img alt="LSTM Trained on Window Method Formulation of Passenger Prediction Problem" class="size-full wp-image-3304" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Window-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Window-1.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Window-1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Window-1-768x576.png 768w" width="800"/><p class="wp-caption-text">LSTM Trained on Window Method Formulation of Passenger Prediction Problem</p></div>
<h2>LSTM for Regression with Time Steps</h2>
<p>You may have noticed that the data preparation for the LSTM network includes time steps.</p>
<p>Some sequence problems may have a varied number of time steps per sample. For example, you may have measurements of a physical machine leading up to a point of failure or a point of surge. Each incident would be a sample the observations that lead up to the event would be the time steps, and the variables observed would be the features.</p>
<p>Time steps provide another way to phrase our time series problem. Like above in the window example, we can take prior time steps in our time series as inputs to predict the output at the next time step.</p>
<p>Instead of phrasing the past observations as separate input features, we can use them as time steps of the one input feature, which is indeed a more accurate framing of the problem.</p>
<p>We can do this using the same data representation as in the previous window-based example, except when we reshape the data, we set the columns to be the time steps dimension and change the features dimension back to 1. For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc2a689174042" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc2a689174042-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2a689174042-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc2a689174042-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc2a689174042-1"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2a689174042-2"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2a689174042-3"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The entire code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc2c458461102" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# LSTM for international airline passengers problem with time step regression framing
import numpy
import matplotlib.pyplot as plt
from pandas import read_csv
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)
# fix random seed for reproducibility
numpy.random.seed(7)
# load the dataset
dataframe = read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
# reshape into X=t and Y=t+1
look_back = 3
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))
# create and fit the LSTM network
model = Sequential()
model.add(LSTM(4, input_shape=(look_back, 1)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
model.fit(trainX, trainY, epochs=100, batch_size=1, verbose=2)
# make predictions
trainPredict = model.predict(trainX)
testPredict = model.predict(testX)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-16">16</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-18">18</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-20">20</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-22">22</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-24">24</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-26">26</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-28">28</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-30">30</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-32">32</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-34">34</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-36">36</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-38">38</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-40">40</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-42">42</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-44">44</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-46">46</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-48">48</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-50">50</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-52">52</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-54">54</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-56">56</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-58">58</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-60">60</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-62">62</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-64">64</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-66">66</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-68">68</div><div class="crayon-num" data-line="crayon-5a65929fecc2c458461102-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc2c458461102-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc2c458461102-1"><span class="crayon-p"># LSTM for international airline passengers problem with time step regression framing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-3"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-5"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-11"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-12"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-13"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-15"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-16"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-17"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-19"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-20"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-21"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-22"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-23"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-24"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-25"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-26"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-27"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-28"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-29"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-30"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-31"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-32"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-33"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-34"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-35"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-36"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-37"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-38"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-39"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-40"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-45"><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-46"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-47"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-48"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-49"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-50"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-51"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-52"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-53"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-54"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-56"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-57"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-58"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-59"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-60"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-61"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-62"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-63"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-64"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-65"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-66"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-67"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-68"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc2c458461102-69"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc2c458461102-70"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0062 seconds] -->
<p>Running the example provides the following output:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc30862635757" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 95/100
1s - loss: 0.0021
Epoch 96/100
1s - loss: 0.0021
Epoch 97/100
1s - loss: 0.0021
Epoch 98/100
1s - loss: 0.0020
Epoch 99/100
1s - loss: 0.0021
Epoch 100/100
1s - loss: 0.0020
Train Score: 23.69 RMSE
Test Score: 58.88 RMSE</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc30862635757-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc30862635757-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc30862635757-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-2">Epoch 95/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-3">1s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-4">Epoch 96/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-5">1s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-6">Epoch 97/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-7">1s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-8">Epoch 98/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-9">1s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-10">Epoch 99/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-11">1s - loss: 0.0021</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-12">Epoch 100/100</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-13">1s - loss: 0.0020</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc30862635757-14">Train Score: 23.69 RMSE</div><div class="crayon-line" id="crayon-5a65929fecc30862635757-15">Test Score: 58.88 RMSE</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that the results are slightly better than previous example, although the structure of the input data makes a lot more sense.</p>
<div class="wp-caption aligncenter" id="attachment_3305" style="max-width: 810px"><img alt="LSTM Trained on Time Step Formulation of Passenger Prediction Problem" class="size-full wp-image-3305" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Time-Steps-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Time-Steps-1.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Time-Steps-1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Time-Steps-1-768x576.png 768w" width="800"/><p class="wp-caption-text">LSTM Trained on Time Step Formulation of Passenger Prediction Problem</p></div>
<h2>LSTM with Memory Between Batches</h2>
<p>The LSTM network has memory, which is capable of remembering across long sequences.</p>
<p>Normally, the state within the network is reset after each training batch when fitting the model, as well as each call to <strong>model.predict()</strong> or <strong>model.evaluate()</strong>.</p>
<p>We can gain finer control over when the internal state of the LSTM network is cleared in Keras by making the LSTM layer “stateful”. This means that it can build state over the entire training sequence and even maintain that state if needed to make predictions.</p>
<p>It requires that the training data not be shuffled when fitting the network. It also requires explicit resetting of the network state after each exposure to the training data (epoch) by calls to <strong>model.reset_states()</strong>. This means that we must create our own outer loop of epochs and within each epoch call <strong>model.fit()</strong> and <strong>model.reset_states()</strong>. For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc3a448382328" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
for i in range(100):
	model.fit(trainX, trainY, epochs=1, batch_size=batch_size, verbose=2, shuffle=False)
	model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc3a448382328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc3a448382328-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc3a448382328-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc3a448382328-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc3a448382328-2"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc3a448382328-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Finally, when the LSTM layer is constructed, the <strong>stateful</strong> parameter must be set <strong>True</strong> and instead of specifying the input dimensions, we must hard code the number of samples in a batch, number of time steps in a sample and number of features in a time step by setting the <strong>batch_input_shape</strong> parameter. For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc3c842515728" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(4, batch_input_shape=(batch_size, time_steps, features), stateful=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc3c842515728-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc3c842515728-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">time_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">features</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>This same batch size must then be used later when evaluating the model and making predictions. For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc3f802343589" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.predict(trainX, batch_size=batch_size)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc3f802343589-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc3f802343589-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can adapt the previous time step example to use a stateful LSTM. The full code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc41225174811" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# LSTM for international airline passengers problem with memory
import numpy
import matplotlib.pyplot as plt
from pandas import read_csv
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)
# fix random seed for reproducibility
numpy.random.seed(7)
# load the dataset
dataframe = read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
# reshape into X=t and Y=t+1
look_back = 3
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))
# create and fit the LSTM network
batch_size = 1
model = Sequential()
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
for i in range(100):
	model.fit(trainX, trainY, epochs=1, batch_size=batch_size, verbose=2, shuffle=False)
	model.reset_states()
# make predictions
trainPredict = model.predict(trainX, batch_size=batch_size)
model.reset_states()
testPredict = model.predict(testX, batch_size=batch_size)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-16">16</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-18">18</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-20">20</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-22">22</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-24">24</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-26">26</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-28">28</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-30">30</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-32">32</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-34">34</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-36">36</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-38">38</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-40">40</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-42">42</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-44">44</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-46">46</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-48">48</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-50">50</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-52">52</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-54">54</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-56">56</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-58">58</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-60">60</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-62">62</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-64">64</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-66">66</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-68">68</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-70">70</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-72">72</div><div class="crayon-num" data-line="crayon-5a65929fecc41225174811-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc41225174811-74">74</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc41225174811-1"><span class="crayon-p"># LSTM for international airline passengers problem with memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-3"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-5"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-11"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-12"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-13"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-15"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-16"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-17"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-19"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-20"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-21"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-22"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-23"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-24"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-25"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-26"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-27"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-28"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-29"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-30"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-31"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-32"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-33"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-34"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-35"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-36"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-37"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-38"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-39"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-40"><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-45"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-46"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-47"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-48"><span class="crayon-p"># make predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-49"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-50"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-51"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-52"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-53"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-54"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-55"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-56"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-57"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-58"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-59"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-60"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-61"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-62"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-63"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-64"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-65"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-66"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-67"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-68"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-69"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-70"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-71"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-72"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc41225174811-73"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc41225174811-74"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0065 seconds] -->
<p>Running the example provides the following output:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc47666133007" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0016
Train Score: 20.74 RMSE
Test Score: 52.23 RMSE</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc47666133007-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc47666133007-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc47666133007-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-3">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-5">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-7">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-9">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-11">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-12">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-13">1s - loss: 0.0016</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc47666133007-14">Train Score: 20.74 RMSE</div><div class="crayon-line" id="crayon-5a65929fecc47666133007-15">Test Score: 52.23 RMSE</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We do see that results are worse. The model may need more modules and may need to be trained for more epochs to internalize the structure of the problem.</p>
<div class="wp-caption aligncenter" id="attachment_3306" style="max-width: 810px"><img alt="Stateful LSTM Trained on Regression Formulation of Passenger Prediction Problem" class="size-full wp-image-3306" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Stateful-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Stateful-1.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Stateful-1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/LSTM-Regression-Stateful-1-768x576.png 768w" width="800"/><p class="wp-caption-text">Stateful LSTM Trained on Regression Formulation of Passenger Prediction Problem</p></div>
<h2>Stacked LSTMs with Memory Between Batches</h2>
<p>Finally, we will take a look at one of the big benefits of LSTMs: the fact that they can be successfully trained when stacked into deep network architectures.</p>
<p>LSTM networks can be stacked in Keras in the same way that other layer types can be stacked. One addition to the configuration that is required is that an LSTM layer prior to each subsequent LSTM layer must return the sequence. This can be done by setting the <strong>return_sequences</strong> parameter on the layer to <strong>True</strong>.</p>
<p>We can extend the stateful LSTM in the previous section to have two layers, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc4d853971083" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True, return_sequences=True))
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc4d853971083-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc4d853971083-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc4d853971083-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc4d853971083-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The entire code listing is provided below for completeness.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc52943111883" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Stacked LSTM for international airline passengers problem with memory
import numpy
import matplotlib.pyplot as plt
from pandas import read_csv
import math
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
# convert an array of values into a dataset matrix
def create_dataset(dataset, look_back=1):
	dataX, dataY = [], []
	for i in range(len(dataset)-look_back-1):
		a = dataset[i:(i+look_back), 0]
		dataX.append(a)
		dataY.append(dataset[i + look_back, 0])
	return numpy.array(dataX), numpy.array(dataY)
# fix random seed for reproducibility
numpy.random.seed(7)
# load the dataset
dataframe = read_csv('international-airline-passengers.csv', usecols=[1], engine='python', skipfooter=3)
dataset = dataframe.values
dataset = dataset.astype('float32')
# normalize the dataset
scaler = MinMaxScaler(feature_range=(0, 1))
dataset = scaler.fit_transform(dataset)
# split into train and test sets
train_size = int(len(dataset) * 0.67)
test_size = len(dataset) - train_size
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]
# reshape into X=t and Y=t+1
look_back = 3
trainX, trainY = create_dataset(train, look_back)
testX, testY = create_dataset(test, look_back)
# reshape input to be [samples, time steps, features]
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))
# create and fit the LSTM network
batch_size = 1
model = Sequential()
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True, return_sequences=True))
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
for i in range(100):
	model.fit(trainX, trainY, epochs=1, batch_size=batch_size, verbose=2, shuffle=False)
	model.reset_states()
# make predictions
trainPredict = model.predict(trainX, batch_size=batch_size)
model.reset_states()
testPredict = model.predict(testX, batch_size=batch_size)
# invert predictions
trainPredict = scaler.inverse_transform(trainPredict)
trainY = scaler.inverse_transform([trainY])
testPredict = scaler.inverse_transform(testPredict)
testY = scaler.inverse_transform([testY])
# calculate root mean squared error
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))
print('Train Score: %.2f RMSE' % (trainScore))
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))
print('Test Score: %.2f RMSE' % (testScore))
# shift train predictions for plotting
trainPredictPlot = numpy.empty_like(dataset)
trainPredictPlot[:, :] = numpy.nan
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict
# shift test predictions for plotting
testPredictPlot = numpy.empty_like(dataset)
testPredictPlot[:, :] = numpy.nan
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict
# plot baseline and predictions
plt.plot(scaler.inverse_transform(dataset))
plt.plot(trainPredictPlot)
plt.plot(testPredictPlot)
plt.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-14">14</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-16">16</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-18">18</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-20">20</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-22">22</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-24">24</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-26">26</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-28">28</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-30">30</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-32">32</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-34">34</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-36">36</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-38">38</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-40">40</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-42">42</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-44">44</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-46">46</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-48">48</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-50">50</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-52">52</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-54">54</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-56">56</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-58">58</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-60">60</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-62">62</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-64">64</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-66">66</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-68">68</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-70">70</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-72">72</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc52943111883-74">74</div><div class="crayon-num" data-line="crayon-5a65929fecc52943111883-75">75</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc52943111883-1"><span class="crayon-p"># Stacked LSTM for international airline passengers problem with memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-2"><span class="crayon-e">import </span><span class="crayon-e">numpy</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-3"><span class="crayon-e">import </span><span class="crayon-v">matplotlib</span><span class="crayon-sy">.</span><span class="crayon-e">pyplot </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">plt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-5"><span class="crayon-e">import </span><span class="crayon-e">math</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-10"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-11"><span class="crayon-p"># convert an array of values into a dataset matrix</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-12"><span class="crayon-e">def </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-13"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-14"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">look_back</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-15"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-16"><span class="crayon-h"> </span><span class="crayon-v">dataX</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-17"><span class="crayon-h"> </span><span class="crayon-v">dataY</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataX</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">dataY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-19"><span class="crayon-p"># fix random seed for reproducibility</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-20"><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-v">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-21"><span class="crayon-p"># load the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-22"><span class="crayon-v">dataframe</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'international-airline-passengers.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">usecols</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">engine</span><span class="crayon-o">=</span><span class="crayon-s">'python'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">skipfooter</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-23"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataframe</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-24"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-25"><span class="crayon-p"># normalize the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-26"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-27"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-28"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-29"><span class="crayon-v">train_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">0.67</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-30"><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">train_size</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-31"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">train_size</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">train_size</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-32"><span class="crayon-p"># reshape into X=t and Y=t+1</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-33"><span class="crayon-v">look_back</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-34"><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-35"><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-36"><span class="crayon-p"># reshape input to be [samples, time steps, features]</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-37"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-38"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-39"><span class="crayon-p"># create and fit the LSTM network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-40"><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-41"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-44"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-45"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-46"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-47"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-48"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-49"><span class="crayon-p"># make predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-50"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-51"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-52"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-53"><span class="crayon-p"># invert predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-54"><span class="crayon-v">trainPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-55"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-56"><span class="crayon-v">testPredict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">testPredict</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-57"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-58"><span class="crayon-p"># calculate root mean squared error</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-59"><span class="crayon-v">trainScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-60"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">trainScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-61"><span class="crayon-v">testScore</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">math</span><span class="crayon-sy">.</span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-62"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Score: %.2f RMSE'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">testScore</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-63"><span class="crayon-p"># shift train predictions for plotting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-64"><span class="crayon-v">trainPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-65"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-66"><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-v">look_back</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-v">look_back</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">trainPredict</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-67"><span class="crayon-p"># shift test predictions for plotting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-68"><span class="crayon-v">testPredictPlot</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">empty_like</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-69"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">nan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-70"><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredict</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-sy">(</span><span class="crayon-e ">look_back*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">testPredict</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-71"><span class="crayon-p"># plot baseline and predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-72"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-73"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">trainPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc52943111883-74"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">testPredictPlot</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65929fecc52943111883-75"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0067 seconds] -->
<p>Running the example produces the following output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65929fecc59051147966" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0017
Epoch 1/1
1s - loss: 0.0016
Train Score: 20.49 RMSE
Test Score: 56.35 RMSE</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-2">2</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-4">4</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-6">6</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-8">8</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-10">10</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65929fecc59051147966-12">12</div><div class="crayon-num" data-line="crayon-5a65929fecc59051147966-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65929fecc59051147966-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-3">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-5">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-7">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-9">1s - loss: 0.0017</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-11">1s - loss: 0.0016</div><div class="crayon-line crayon-striped-line" id="crayon-5a65929fecc59051147966-12">Train Score: 20.49 RMSE</div><div class="crayon-line" id="crayon-5a65929fecc59051147966-13">Test Score: 56.35 RMSE</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The predictions on the test dataset are again worse. This is more evidence to suggest the need for additional training epochs.</p>
<div class="wp-caption aligncenter" id="attachment_3307" style="max-width: 810px"><img alt="Stacked Stateful LSTMs Trained on Regression Formulation of Passenger Prediction Problem" class="size-full wp-image-3307" height="600" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Stacked-LSTM-Regression-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Stacked-LSTM-Regression-1.png 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Stacked-LSTM-Regression-1-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Stacked-LSTM-Regression-1-768x576.png 768w" width="800"/><p class="wp-caption-text">Stacked Stateful LSTMs Trained on Regression Formulation of Passenger Prediction Problem</p></div>
<h2>Summary</h2>
<p>In this post, you discovered how to develop LSTM recurrent neural networks for time series prediction in Python with the Keras deep learning network.</p>
<p>Specifically, you learned:</p>
<ul>
<li>About the international airline passenger time series prediction problem.</li>
<li>How to create an LSTM for a regression and a window formulation of the time series problem.</li>
<li>How to create an LSTM with a time step formulation of the time series problem.</li>
<li>How to create an LSTM with state and stacked LSTMs with state to learn long sequences.</li>
</ul>
<p style="text-align: center;">Do you have any questions about LSTMs for time series prediction or about this post?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<h3 style="text-align: left;">Updated LSTM Time Series Forecasting Posts:</h3>
<p>The example in this post is quite dated, I have better examples available for using LSTMs on time series, see:</p>
<p> </p>
<ol>
<li><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/">LSTMs for Univariate Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/">LSTMs for Multivariate Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/">LSTMs for Multi-Step Time Series Forecasting</a></li>
</ol>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-prediction-lstm-recurrent-neural-networks-python-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/&amp;summary=Time+series+prediction+problems+are+a+difficult+type+of+predictive+modeling+problem.%0D%0A%0D%0AUnlike+regre..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Prediction%20with%20LSTM%20Recurrent%20Neural%20Networks%20in%20Python%20with%20Keras&amp;url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/&amp;summary=Time+series+prediction+problems+are+a+difficult+type+of+predictive+modeling+problem.%0D%0A%0D%0AUnlike+regre...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/estimate-baseline-performance-machine-learning-models-weka/" rel="prev"><i class="fa fa-angle-left"></i> How To Estimate A Baseline Performance For Your Machine Learning Models in Weka</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/use-regression-machine-learning-algorithms-weka/" rel="next">How To Use Regression Machine Learning Algorithms in Weka <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">697 Responses to <em>Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-357599">
<div class="comment-container" id="li-comment-357599">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3432fe73699aca1308b55753eedc3f34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3432fe73699aca1308b55753eedc3f34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shilin Zhang</span>
<span class="date">July 21, 2016 at 12:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-357599" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I like Keras, the example is excellent.</p>
<div class="reply">
<a aria-label="Reply to Shilin Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=357599#respond" onclick='return addComment.moveForm( "comment-357599", "357599", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-357603">
<div class="comment-container" id="li-comment-357603">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 21, 2016 at 1:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-357603" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=357603#respond" onclick='return addComment.moveForm( "comment-357603", "357603", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-369368">
<div class="comment-container" id="li-comment-369368">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f9db9a2c5bd188bbb99541b018ecb41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f9db9a2c5bd188bbb99541b018ecb41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://none" rel="external nofollow">Robin Schäfer</a></span>
<span class="date">November 4, 2016 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369368" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for your awesome tutorial!</p>
<p>I just don’t get one thing… If you’d like to predict 1 step in the future, why does the red line stop before the blue line does?</p>
<p>So for example, we have the testset untill end of the year 1960. How can i predict the future year? Or passangers at the 1/1/1961 (if dataset ends at 12/31/1960).</p>
<p>Best,</p>
<p>Robin</p>
<div class="reply">
<a aria-label="Reply to Robin Schäfer" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369368#respond" onclick='return addComment.moveForm( "comment-369368", "369368", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-369404">
<div class="comment-container" id="li-comment-369404">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2016 at 11:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369404" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question, there might be a small bug in how I am displaying the predictions in the plot.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369404#respond" onclick='return addComment.moveForm( "comment-369404", "369404", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-370565">
<div class="comment-container" id="li-comment-370565">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fa09a90485b23184838c12108b842e59?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fa09a90485b23184838c12108b842e59?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Terrence</span>
<span class="date">November 15, 2016 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370565" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, great tutorial. </p>
<p>I have the same question about the future prediction. The “testPredict” has two fewer rows that the “test” once the algorithm is done running, how would I obtain the values for the a prediction 1 or 2 days ahead from the end date of the time series? Thanks.</p>
<p>Terrence</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-385744">
<div class="comment-container" id="li-comment-385744">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">zhang</span>
<span class="date">February 3, 2017 at 7:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385744" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think in the ”create_dataset” function, the range should be “len(dataset)-look_back” but not “len(dataset)-look_back-1”. No “1”should be subtracted here.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-399329">
<div class="comment-container" id="li-comment-399329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a3b31b448ab5005c8a18694251004410?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a3b31b448ab5005c8a18694251004410?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shiva</span>
<span class="date">May 11, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
how to fix this bug? what modifications you need to make in the code to predict the values for 1/31/1961, if the dataset ends at 12/31/1960?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-4" id="comment-399328">
<div class="comment-container" id="li-comment-399328">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a3b31b448ab5005c8a18694251004410?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a3b31b448ab5005c8a18694251004410?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shiva</span>
<span class="date">May 11, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399328" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Robin,<br/>
Are you up with a solution for the bug? as you rightly said, the testpredict is smaller than test. How do you modify the code so that it predicts the value on 1/1/1961?</p>
<div class="reply">
<a aria-label="Reply to Shiva" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399328#respond" onclick='return addComment.moveForm( "comment-399328", "399328", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-423188">
<div class="comment-container" id="li-comment-423188">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/144a9482be8d005560aa5e8446b0fdf4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/144a9482be8d005560aa5e8446b0fdf4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lihle</span>
<span class="date">December 15, 2017 at 7:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-423188" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have tried to check how to fix the bug. Simply delect the  -1 in line 14 and for </p>
<p>testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict</p>
<p>replace it with </p>
<p>testPredictPlot[len(trainPredict)+(look_back):len(dataset)-1, :] = testPredict </p>
<p>The challenge would be that the  length of the list would 1 less. but in that way the bug is fixed.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-388251">
<div class="comment-container" id="li-comment-388251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a25275cfca19073b01aae42251286419?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a25275cfca19073b01aae42251286419?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shovon Sengupta</span>
<span class="date">February 16, 2017 at 1:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Thanks for sharing this great tutorial! Can you please also suggest the way to get the forward forecast based on the LSTM method. For example, if we want to forecast the value of the series for the next few weeks (ahead of current time–As we usually do for the  any time series data), then what would be process to do that.</p>
<p>Regards<br/>
Shovon</p>
<div class="reply">
<a aria-label="Reply to Shovon Sengupta" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388251#respond" onclick='return addComment.moveForm( "comment-388251", "388251", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-388335">
<div class="comment-container" id="li-comment-388335">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 16, 2017 at 11:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388335" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Shovon,</p>
<p>I would suggest reframing the problem to predict a long output sequence, then develop a model on this framing of the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388335#respond" onclick='return addComment.moveForm( "comment-388335", "388335", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-405700">
<div class="comment-container" id="li-comment-405700">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1852a07c2b4ff848b2082d504b2a5d98?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1852a07c2b4ff848b2082d504b2a5d98?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andrew</span>
<span class="date">July 13, 2017 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405700" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Can you elaborate a bit on what is the use of modeling a time-series without being able to make predictions of future time? I ask because I’m learning LSTMs and I’m facing the same issue as the person above: I can model a time series and make accurate predictions for data that I already have, but have difficulty predicting future observations.</p>
<p>Thanks a bunch.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-405730">
<div class="comment-container" id="li-comment-405730">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 10:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405730" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Time series analysis is the study of time series without the interest in making predictions.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-408331">
<div class="comment-container" id="li-comment-408331">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9a30c2870f893029229a77872f2f8487?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9a30c2870f893029229a77872f2f8487?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">dal</span>
<span class="date">August 3, 2017 at 3:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408331" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can RNN be used on Input with multi-variables?</p>
<div class="reply">
<a aria-label="Reply to dal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408331#respond" onclick='return addComment.moveForm( "comment-408331", "408331", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-408359">
<div class="comment-container" id="li-comment-408359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2017 at 6:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. LSTMs can take multiple input features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408359#respond" onclick='return addComment.moveForm( "comment-408359", "408359", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-409253">
<div class="comment-container" id="li-comment-409253">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5b1101734cbcf1ec5aebd64d3300341d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5b1101734cbcf1ec5aebd64d3300341d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rachid</span>
<span class="date">August 11, 2017 at 2:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409253" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this great tutorial Jason. I’m still having trouble figuring out what kind of graph do you get when you do this:<br/>
# create and fit the LSTM network<br/>
model = Sequential()<br/>
model.add(LSTM(4, input_shape=(1, look_back)))<br/>
model.add(Dense(1))</p>
<p>for instance if your lookback=1: the input is one value xt, and the target output is xt+1. How is “LSTM(4, input_shape=(1, look_back))” linking your LSTM blocks with the input?<br/>
Or do you have 1 input =&gt; 1 LSTM block which hidden value (output of the LSTM) is fed to a 4X1 dense MLP? So that the output of the LSTM is actually the input of a 1x4x1 MLP…</p>
<p>And if your input is [xt-1, xt] with target xt+1 (lookback=2), you have two LSTMs blocks (fed with xt-1 and xt respectively) and the hidden value of the second block is the input of a 1x4x1 MLP. </p>
<p>I hope I’m being clear, I really have troubles answering this question. Your tutorial helps though!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-409274">
<div class="comment-container" id="li-comment-409274">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 11, 2017 at 6:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409274" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The input_shape define the input, the LSTM is the first hidden layer, the Dense is the output layer.</p>
<p>Try this to get an idea of the graph:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6592a003a4e552557917" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6592a003a4e552557917-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6592a003a4e552557917-1"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-357601">
<div class="comment-container" id="li-comment-357601">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4d04570059e89798f4b43de8cd0ead1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4d04570059e89798f4b43de8cd0ead1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">July 21, 2016 at 1:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-357601" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for the walkthrough. I’ve tried modifying the code to run the network for online prediction, but I’m having some issues. Would you be willing to take a look at my SO question? <a href="http://stackoverflow.com/questions/38313673/lstm-with-keras-for-mini-batch-training-and-online-testing" rel="nofollow">http://stackoverflow.com/questions/38313673/lstm-with-keras-for-mini-batch-training-and-online-testing</a></p>
<p>Cheers,<br/>
Alex</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=357601#respond" onclick='return addComment.moveForm( "comment-357601", "357601", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-357792">
<div class="comment-container" id="li-comment-357792">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 23, 2016 at 2:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-357792" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry Alex, you’re question is a little vague. </p>
<p>It’s of the order “I have data like this…, what is the best way to model this problem”. It’s a tough StackOverflow question because it’s an open question rather than a specific technical question.</p>
<p>Generally, my answer would be “no idea, try lots of stuff and see what works best”.</p>
<p>I think your notion of online might also be confused (or I’m confused). Have you seen online implementations of LSTM? Keras does not support it as far as I know. You train your model then you make predictions. Unless of course you mean the maintained state of the model – but this is not online learning, it is just static model with state, the weights are not updated in an online manner unless you re-train your model frequently.</p>
<p>It might be worth stepping back from the code and taking some time to clearly define I/O of the problem and requirements to then figure out the right kind of algorithm/setup you need to solve it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=357792#respond" onclick='return addComment.moveForm( "comment-357792", "357792", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-358027">
<div class="comment-container" id="li-comment-358027">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f5d9de95213ec55c1b6c43699c591733?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f5d9de95213ec55c1b6c43699c591733?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy Johnson</span>
<span class="date">July 26, 2016 at 2:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358027" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Dr. Brownlee,<br/>
I have a question about the difference between the Time Steps and Windows method. Am I correct in understanding that the only difference is the shape of the data you feeding into the model? If so, can you give some intuition why the Time Steps method works better? If I have two sequences (For example, if I have 2 noisy signals, one noisier than the other), and I’m using them both to predict a sequence, which method do you think is better?</p>
<p>Best</p>
<div class="reply">
<a aria-label="Reply to Tommy Johnson" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358027#respond" onclick='return addComment.moveForm( "comment-358027", "358027", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358047">
<div class="comment-container" id="li-comment-358047">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2016 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358047" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Tommy,</p>
<p>The window method creates new features, like new attributes for the model, where as timesteps are a sequence within a batch for a given feature.</p>
<p>I would not say one works better than another, the examples in this post are for demonstration only and are not tuned.</p>
<p>I would advise you to try both methods and see what works best, or frame your problem in the way that best makes sense.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358047#respond" onclick='return addComment.moveForm( "comment-358047", "358047", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358259">
<div class="comment-container" id="li-comment-358259">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/05c0b0c41c484ecdb2d1be2fa627136a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/05c0b0c41c484ecdb2d1be2fa627136a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pedro Ferreira</span>
<span class="date">July 29, 2016 at 1:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358259" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>What are the hyperparameters of your network?</p>
<p>Thanks,<br/>
Pedro</p>
<div class="reply">
<a aria-label="Reply to Pedro Ferreira" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358259#respond" onclick='return addComment.moveForm( "comment-358259", "358259", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358271">
<div class="comment-container" id="li-comment-358271">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 29, 2016 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358271" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Pedro, the hyperparameters for each network are available right there in the code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358271#respond" onclick='return addComment.moveForm( "comment-358271", "358271", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-382999">
<div class="comment-container" id="li-comment-382999">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a3b3e5726a4029f5ce37e11002f376f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a3b3e5726a4029f5ce37e11002f376f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://outputlogic.com" rel="external nofollow">Evgeni Stavinov</a></span>
<span class="date">January 19, 2017 at 11:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-382999" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is it possible to perform hyperparameter optimization of the LTSM, for example using hyperopt?</p>
<div class="reply">
<a aria-label="Reply to Evgeni Stavinov" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=382999#respond" onclick='return addComment.moveForm( "comment-382999", "382999", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-383069">
<div class="comment-container" id="li-comment-383069">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2017 at 10:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383069" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t see why not Evgeni., Sorry I don’t have an example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383069#respond" onclick='return addComment.moveForm( "comment-383069", "383069", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-358379">
<div class="comment-container" id="li-comment-358379">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/120ebf27726ecfecf4edfb9ec6c7f395?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/120ebf27726ecfecf4edfb9ec6c7f395?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Kinkade</span>
<span class="date">July 30, 2016 at 7:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358379" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Interesting post and a very useful website!  Can I use LSTMS for time series classification, for a binary supervised problem? My data is arranged as time steps of 1 hr sequences leading up to an event and the occurrence and non-occurrence of the event are labelled in each instance. I have done a bit of research and have not seen many use cases in the literature. Do you think a different recurrent neural net or simpler MLP might work better in this case? Most of my the research done in my area has got OK results(70% accuracy)  from feed forward neural networks and i thought to try out recurrent neural nets, specifically LSTMs to improve my accuracy.</p>
<div class="reply">
<a aria-label="Reply to Jack Kinkade" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358379#respond" onclick='return addComment.moveForm( "comment-358379", "358379", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358416">
<div class="comment-container" id="li-comment-358416">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2016 at 7:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358416" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t see why not Jack.</p>
<p>I would suggest using a standard MLP with the window method as the baseline, then develop some LSTMs for comparison. I would expect LSTMs to generally perform better if there is information in the long sequences.</p>
<p>This post on binary classification may help, you can combine some of the details with the LSTMs in this post (e.g. the specifics of the Dense output layer and loss function):<br/>
<a href="http://machinelearningmastery.com/binary-classification-tutorial-with-the-keras-deep-learning-library/" rel="nofollow">http://machinelearningmastery.com/binary-classification-tutorial-with-the-keras-deep-learning-library/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358416#respond" onclick='return addComment.moveForm( "comment-358416", "358416", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358444">
<div class="comment-container" id="li-comment-358444">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4decf8d3afb46f7b441cdd4168f3a9d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4decf8d3afb46f7b441cdd4168f3a9d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Peter Ostrowski</span>
<span class="date">July 31, 2016 at 11:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358444" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this example. I ran the first code example (lookback=1) by just copying the code and can reproduce your train and test scores precisely, however my graph looks differently. Specifically for me the predicted graph (green and red lines) looks as if it is shifted by one to the right in comparison to what I see on this page. It also looks like the predicted graph starts at x=0 in your example, but my predicted graph starts at 1. So in my case it looks like the prediction is almost like predicting identity? Is there a way for me to verify what I could have done wrong? </p>
<p>Thanks,<br/>
  Peter</p>
<div class="reply">
<a aria-label="Reply to Peter Ostrowski" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358444#respond" onclick='return addComment.moveForm( "comment-358444", "358444", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358469">
<div class="comment-container" id="li-comment-358469">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 1, 2016 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358469" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Peter.</p>
<p>I think you’re right, I need to update my graphs in the post.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358469#respond" onclick='return addComment.moveForm( "comment-358469", "358469", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-358518">
<div class="comment-container" id="li-comment-358518">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4decf8d3afb46f7b441cdd4168f3a9d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4decf8d3afb46f7b441cdd4168f3a9d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Peter Ostrowski</span>
<span class="date">August 2, 2016 at 12:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358518" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>when outputting the train and test score, you scale the output of the model.evaluate with the minmaxscaler to match into the original scale. I am not sure if I understand that correctly. The data values are between 104 and 622, the trainScore (which is the mean squared error) will be scaled into that range using a linear mapping, right? So your transformed trainscore can never be lower than the minimum of the dataset, i.e. 104. Shouldn’t the square root of the trainScore be transformed and then the minimum of the range be subtracted and squared again to get the mean square error in the original domain range? Like numpy.square(scalar.inverse_transform([[nump.sqrt(trainScore)]])-scaler.data_min_)</p>
<p>Thanks,<br/>
Peter</p>
<div class="reply">
<a aria-label="Reply to Peter Ostrowski" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358518#respond" onclick='return addComment.moveForm( "comment-358518", "358518", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-358681">
<div class="comment-container" id="li-comment-358681">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2016 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358681" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Peter, you may have found a bug, thanks. </p>
<p>I believe I thought the default evaluation metric was RMSE rather than MSE and I was using the scaler to transform the RMSE score back into original units. </p>
<p>I will update the examples ASAP.</p>
<p>Update: All estimates of model error were updated to first convert the error score to RMSE and then invert scale transform back to original units.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358681#respond" onclick='return addComment.moveForm( "comment-358681", "358681", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-358595">
<div class="comment-container" id="li-comment-358595">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/53892c56f64f996edd4155175f52058f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/53892c56f64f996edd4155175f52058f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">seiya.kumada</span>
<span class="date">August 2, 2016 at 3:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358595" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your excellent post.</p>
<p>I have one question.<br/>
In your examples, you are discussing a predictor such as {x(t-2),x(t-1),x(t)} -&gt; x(t+1).<br/>
I want to know how to implement a predictor like {x(t-2),x(t-1),x(t)} -&gt; {x(t+1), x(t+2)}.<br/>
Could you tell me how to do so?</p>
<div class="reply">
<a aria-label="Reply to seiya.kumada" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358595#respond" onclick='return addComment.moveForm( "comment-358595", "358595", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358664">
<div class="comment-container" id="li-comment-358664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2016 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a sequence in and sequence out type problem.</p>
<p>I believe you prepare the dataset in this form and model it directly with LSTMs and MLPs. </p>
<p>I don’t have a worked example at this stage for you, but I believe it would be straight forward.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358664#respond" onclick='return addComment.moveForm( "comment-358664", "358664", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358615">
<div class="comment-container" id="li-comment-358615">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://sachinruk.github.io" rel="external nofollow">Sachin</a></span>
<span class="date">August 2, 2016 at 6:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358615" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>First of all thanks for the tutorial. An excellent one at that.</p>
<p>However, I do have some questions regarding the underlying architecture that I’m trying to reconcile with what I’ve done learnt about. I posted a question here: <a href="http://stackoverflow.com/questions/38714959/understanding-keras-lstms" rel="nofollow">http://stackoverflow.com/questions/38714959/understanding-keras-lstms</a> which I felt was too long to post in this forum.</p>
<p>I would really appreciate your input, especially the question on time_steps vs features argument.</p>
<p>Thanks,<br/>
Sachin</p>
<div class="reply">
<a aria-label="Reply to Sachin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358615#respond" onclick='return addComment.moveForm( "comment-358615", "358615", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358666">
<div class="comment-container" id="li-comment-358666">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2016 at 6:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358666" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If I understand correctly, you want more elaboration on time steps vs features?</p>
<p>Features are your input variables. In this airline example we only have one input variable, but we can contrive multiple input variables using past time steps in what is called the window method. Normally, multiple features would be a multivariate time series.</p>
<p>Timesteps are the sequence through time for a give attribute. As we comment in the tutorial, this is the natural mapping of the problem onto LSTMs for this airline problem.</p>
<p>You always need a 3D array as input for LSTMs [samples, features, timesteps], but you can reduce each dimension to one if needed. We explore this ability in reframe the problem in the tutorial above.</p>
<p>You also ask about the point of stateful. It is helpful to have memory between batches over one training run. If we keep all of out time series samples in order, the method can learn the relationships between values across batches. If we did not enable the stateful parameter, the algorithm we no knowledge beyond each batch, much like a MLP.</p>
<p>I hope that helps, I’m happy to dig into a specific topic further if you have more questions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358666#respond" onclick='return addComment.moveForm( "comment-358666", "358666", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408064">
<div class="comment-container" id="li-comment-408064">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 1, 2017 at 4:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408064" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Jason,<br/>
I think this is a good place to bring this question. Suppose if I have X_train, X_test, y_train and y_test, should I transform all the values into a np.array? If I have in this format, should I still use ‘create_dataset’ function to create X and y?</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408064#respond" onclick='return addComment.moveForm( "comment-408064", "408064", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-408098">
<div class="comment-container" id="li-comment-408098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 1, 2017 at 8:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes Jack.</p>
<p>Generally, prepare your data consistently.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408098#respond" onclick='return addComment.moveForm( "comment-408098", "408098", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-408100">
<div class="comment-container" id="li-comment-408100">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 1, 2017 at 8:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408100" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr Jason,<br/>
I have an hourly time series with multiple predictor variables. I skipped <code>create_dataset</code> and just converted all my X_train, X_test, y_train and y_test into np arrays. The reason is, ex: I use past three months as my training and I would like to predict for next 7 days, which will be about 168 observations. If this is the case, if I happen to prepare consistent, would my ‘look_back = 168’ in <code>create_dataset</code> function?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-408204">
<div class="comment-container" id="li-comment-408204">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408204" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend preparing data with the function in this post:<br/>
<a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-408181">
<div class="comment-container" id="li-comment-408181">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 2, 2017 at 1:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408181" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Jason,</p>
<p>After a deep thought and research I am thinking to just use my X_train, y_train, X_test and y_test without doing a look back. The reason is, y_train is dependent on on my X_train features. Therefore, my gut feeling is not use look back or sliding window. I just wanted to confirm with you and please let me know if I am on right track. BTW, when are you planning on doing a multivariate time series analysis? if you can educate us on that, it will be great. Thank you sir!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-408227">
<div class="comment-container" id="li-comment-408227">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408227" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may not need an LSTM if there is no input sequence, consider an MLP.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-358843">
<div class="comment-container" id="li-comment-358843">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sachin</span>
<span class="date">August 4, 2016 at 3:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358843" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So does that mean (in reference to the LSTM diagram in <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="nofollow">http://colah.github.io/posts/2015-08-Understanding-LSTMs/</a>) that the cell memory is not passed between consecutive lstms if stateful=false (i.e. set to zero)? Or do you mean cell memory is reset to zero between consecutive batches (In this tutorial batch_size is 1). Although I guess I should point out that the hidden layer values are passed on, so it will still be different to a MLP (wouldn’t it?)</p>
<p>On a side note, the fact that the output has to be a factor of batch_size seems to be confounding. Feels like it limits me to using a batch_size of one.</p>
<div class="reply">
<a aria-label="Reply to Sachin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358843#respond" onclick='return addComment.moveForm( "comment-358843", "358843", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358914">
<div class="comment-container" id="li-comment-358914">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 5, 2016 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358914" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If stateful is set to false (the default), then I understand according to the Keras documentation that the state within each LSTM node is reset after each batch, either for prediction or training.</p>
<p>This is useful if you do not want to use LSTMs in a stateful manner of you want to train with all of the required memory to learn from within each batch.</p>
<p>This does tie into the limit on batch size for prediction. The TF/Theano structures created from this network definition are optimized for the batch size.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358914#respond" onclick='return addComment.moveForm( "comment-358914", "358914", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-367219">
<div class="comment-container" id="li-comment-367219">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e035660cbe59be613d01e3d792b9cf52?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e035660cbe59be613d01e3d792b9cf52?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mango Freezz</span>
<span class="date">October 16, 2016 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367219" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m super confused here. If the LSTM node is reset after each batch (in this case batch_size 1), does that mean in each forward-backprop session, the LSTM starts with a fresh state without any memory of previous inputs, and it’s only input is a single value? If that’s the case, how could it possibly learn anything?</p>
<p>E.g., let’s say on both time step 10 and 15 the input value is 150, how does the network predict step (10+1) to be 180 and step (15+1) to be 130 while the only input is 150 and the LSTM start with a fresh state?</p>
<div class="reply">
<a aria-label="Reply to Mango Freezz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367219#respond" onclick='return addComment.moveForm( "comment-367219", "367219", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-374001">
<div class="comment-container" id="li-comment-374001">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f20addc8bf4a44b78f276c288924e43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f20addc8bf4a44b78f276c288924e43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ARandomPerson</span>
<span class="date">December 6, 2016 at 9:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-374001" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Mango, I think you’re right. If the number of time-steps is one and the LSTM is not stateful, then I don’t think he is using the recurrent property of the LSTM at all.</p>
<div class="reply">
<a aria-label="Reply to ARandomPerson" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=374001#respond" onclick='return addComment.moveForm( "comment-374001", "374001", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-358864">
<div class="comment-container" id="li-comment-358864">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aab6494f366fcff3b8369d6c50e83689?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aab6494f366fcff3b8369d6c50e83689?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nuno Fonseca</span>
<span class="date">August 4, 2016 at 8:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358864" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi!</p>
<p>First of all, thank you for that great post</p>
<p>I have just one small question: For some research work i am working on, I need to make a prediction, so I’ve been looking for the best possible solution and I am guessing its LSTM…</p>
<p>The app. that I am developing is used in a learning environment, so to predict is the probability of a certain student will submit one solution for a certain assignment…   </p>
<p>I have data from previous years in this format:</p>
<p>                     A1 A2 A3 A4 …<br/>
Student 1 –  Y    Y   Y   Y   N   Y   Y   N<br/>
Student 2 – N   N   N   N   N   Y   Y   Y<br/>
…</p>
<p>Where Y means that the student has submitted, and N otherwise…</p>
<p>From what I understood, the best to achieve what I need is by using the solution described in the section “LSTM For Regression Using the Window Method” where my data will be something like</p>
<p>I1   I2   I3    O<br/>
N    N   N     N<br/>
Y    Y   Y     Y</p>
<p>And when I present a new case like Y   N   N the “LSTM” will make a prediction according to what has been learnt in the training moment.</p>
<p>Did I understand it right? Do you suggest another way?  </p>
<p>Sorry for the eventually dumb question…</p>
<p>Best regards</p>
<div class="reply">
<a aria-label="Reply to Nuno Fonseca" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358864#respond" onclick='return addComment.moveForm( "comment-358864", "358864", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-358899">
<div class="comment-container" id="li-comment-358899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 5, 2016 at 5:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-358899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Looks fine Nuno, although I would suggest you try to frame the problem a few different ways and see what gives you the best results.</p>
<p>Also compare results from LSTMs to MLPs with the window method and ensure it is worth the additional complexity.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=358899#respond" onclick='return addComment.moveForm( "comment-358899", "358899", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-359078">
<div class="comment-container" id="li-comment-359078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/55aca9cc07b929b0172f10f2509af2d1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/55aca9cc07b929b0172f10f2509af2d1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dunhui Xiao</span>
<span class="date">August 7, 2016 at 6:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-359078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Very interesting. Is there a function to descale the scaled data (0-1)?  You show the data from 0-1.  I want to see the original scale data.  This is a easy question. But, it is better to show the original scale data, I suppose.</p>
<div class="reply">
<a aria-label="Reply to Dunhui Xiao" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=359078#respond" onclick='return addComment.moveForm( "comment-359078", "359078", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-359122">
<div class="comment-container" id="li-comment-359122">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 7, 2016 at 8:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-359122" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great point.</p>
<p>Yes, you can save the MinMaxScaler used to scale the training data and use it later to scale new input data and in turn descale predictions. The call is scaler.inverse_transform() from memory.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=359122#respond" onclick='return addComment.moveForm( "comment-359122", "359122", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-359289">
<div class="comment-container" id="li-comment-359289">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/09663ef28790e96f5f98eefe3f62b464?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/09663ef28790e96f5f98eefe3f62b464?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pacchu</span>
<span class="date">August 9, 2016 at 5:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-359289" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why is the shift necessary for plotting the output? Isn’t it unavailable information at time ‘t+1’?</p>
<div class="reply">
<a aria-label="Reply to Pacchu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=359289#respond" onclick='return addComment.moveForm( "comment-359289", "359289", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-360023">
<div class="comment-container" id="li-comment-360023">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2016 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360023" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Pacchu, the framing of the problem is to predict t+1, given t, and possibly some subset of t-n.</p>
<p>I hope that is clearer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360023#respond" onclick='return addComment.moveForm( "comment-360023", "360023", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-359352">
<div class="comment-container" id="li-comment-359352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7cee24bb2390f6edcb7aa80723e1b4a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7cee24bb2390f6edcb7aa80723e1b4a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mat</span>
<span class="date">August 10, 2016 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-359352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does the output simply mimics the input ? (the copy is shifted by one)<br/>
Just like here : <a href="https://github.com/fchollet/keras/issues/2856" rel="nofollow">https://github.com/fchollet/keras/issues/2856</a> ?</p>
<div class="reply">
<a aria-label="Reply to Mat" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=359352#respond" onclick='return addComment.moveForm( "comment-359352", "359352", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-360024">
<div class="comment-container" id="li-comment-360024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2016 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, the output is a prediction of the next time step given prior time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360024#respond" onclick='return addComment.moveForm( "comment-360024", "360024", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-399598">
<div class="comment-container" id="li-comment-399598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a3794db73b04bdb0e768f2f64c63369?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a3794db73b04bdb0e768f2f64c63369?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://blog.andersen.im" rel="external nofollow">André C. Andersen</a></span>
<span class="date">May 14, 2017 at 1:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Have you tried to use the input value as a prediction? It produces an RMSE similar to what you are getting, 48.66.</p>
<div class="reply">
<a aria-label="Reply to André C. Andersen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399598#respond" onclick='return addComment.moveForm( "comment-399598", "399598", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-399630">
<div class="comment-container" id="li-comment-399630">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 14, 2017 at 7:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399630" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, this is call persistence, here is an example:<br/>
<a href="http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399630#respond" onclick='return addComment.moveForm( "comment-399630", "399630", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-404136">
<div class="comment-container" id="li-comment-404136">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/230150546b589eaa202c85d63d563090?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/230150546b589eaa202c85d63d563090?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Clifford Young</span>
<span class="date">June 29, 2017 at 3:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404136" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i think the point is that the default DNN models are no better than persistence model?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-406796">
<div class="comment-container" id="li-comment-406796">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/02ec6e468c9646d4cc2c80a7765d7205?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/02ec6e468c9646d4cc2c80a7765d7205?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jacky</span>
<span class="date">July 22, 2017 at 4:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-406796" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the tutorial. Is it because the input features or hyperparameter are not tuned so the prediction (t+1) is only using the input (t)? Thanks</p>
<div class="reply">
<a aria-label="Reply to Jacky" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=406796#respond" onclick='return addComment.moveForm( "comment-406796", "406796", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-359414">
<div class="comment-container" id="li-comment-359414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6a44fdab183b666a77db85fa0357c8dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6a44fdab183b666a77db85fa0357c8dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shaifu</span>
<span class="date">August 10, 2016 at 6:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-359414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi sir</p>
<p>I tried your code for time series prediction. On passing either univariate or multivariate data, the predictions of the target variable are same. Should’nt there be a difference in the predicted values. I expect the predictions to improve with the multivariate data. Please shed some light on this.</p>
<div class="reply">
<a aria-label="Reply to Shaifu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=359414#respond" onclick='return addComment.moveForm( "comment-359414", "359414", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-360025">
<div class="comment-container" id="li-comment-360025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2016 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The performance of the model is dependent on both the framing of your problem and how the model is configured.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360025#respond" onclick='return addComment.moveForm( "comment-360025", "360025", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-360293">
<div class="comment-container" id="li-comment-360293">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d0ae7a3d906b223fc7508a5b02ee6b64?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d0ae7a3d906b223fc7508a5b02ee6b64?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Madhav</span>
<span class="date">August 17, 2016 at 4:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360293" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the wonderful tutorial. It felt great following your code and implementing my first LSTM network. Looking forward to learning a lot more!!</p>
<p>Can we extend time series forecasting problems to multiple time series? I have the following problem in my mind. Suppose we have stock prices of 100 companies (instead of one) and we wanna forecast what happens in the next month for all the companies? Is it possible to use LSTMs and RNNs for such multiple time series problems?</p>
<div class="reply">
<a aria-label="Reply to Madhav" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360293#respond" onclick='return addComment.moveForm( "comment-360293", "360293", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-360352">
<div class="comment-container" id="li-comment-360352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2016 at 7:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Forecasting stock prices is not my area of expertise. Nevertheless, LSTMs can be used for multiple regression as well as sequence prediction (if you want to predict multiple steps ahead). Give it a shot.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360352#respond" onclick='return addComment.moveForm( "comment-360352", "360352", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-375819">
<div class="comment-container" id="li-comment-375819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ea625db98ee53bac98c62037983099f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ea625db98ee53bac98c62037983099f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://none" rel="external nofollow">Mango</a></span>
<span class="date">December 18, 2016 at 10:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i guess i have the same idea in mind as Madhav..^^ i want to predict multiple time series, each one represent the flow of one grid in the city(since i assume that the neighboured grids influence each other to some extend).. have you done your stock prediction with LSTM?? will you share me some tricks or experience?  Thankyou~</p>
<div class="reply">
<a aria-label="Reply to Mango" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375819#respond" onclick='return addComment.moveForm( "comment-375819", "375819", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-360326">
<div class="comment-container" id="li-comment-360326">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Liu</span>
<span class="date">August 18, 2016 at 2:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360326" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I guess the function learnt is only an one-step lag identity (mimic) prediction.</p>
<p>If the code of your basic version runs, it will look like this:</p>
<p><a href="http://imgur.com/BvPnwGu" rel="nofollow">http://imgur.com/BvPnwGu</a></p>
<p>I change the csv (setting all the data points after some time to be 400 until the end) and run the same code, it will look like this:</p>
<p><a href="http://imgur.com/TvuQDRZ" rel="nofollow">http://imgur.com/TvuQDRZ</a></p>
<p>If it is truly learning the dynamics of the pattern, the prediction should not look like a strict line. At least the previous information before the 400 values will pull down the curve a little bit.</p>
<div class="reply">
<a aria-label="Reply to Liu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360326#respond" onclick='return addComment.moveForm( "comment-360326", "360326", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-360337">
<div class="comment-container" id="li-comment-360337">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Liu</span>
<span class="date">August 18, 2016 at 3:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360337" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Typo: a *straight line</p>
<p>Clarification: Of course what I said may not be correct. But I think this is an alarming concern to interrupt what the LSTM is really learning behind the scene.</p>
<div class="reply">
<a aria-label="Reply to Liu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360337#respond" onclick='return addComment.moveForm( "comment-360337", "360337", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-360358">
<div class="comment-container" id="li-comment-360358">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2016 at 8:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360358" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A key to the examples is that the LSTM is capable of learning the sequence, not just the input-output pairs. From the sequence, it is able to predict the next step.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360358#respond" onclick='return addComment.moveForm( "comment-360358", "360358", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408317">
<div class="comment-container" id="li-comment-408317">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/996778057d6a69594322f2ec6f3b3171?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/996778057d6a69594322f2ec6f3b3171?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sevity</span>
<span class="date">August 3, 2017 at 2:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408317" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think Liu is right. because even when I change LSTM to Dense, result is almost the same.<br/>
if you use time-step=1. it is actually not LSTM anymore.</p>
<div class="reply">
<a aria-label="Reply to sevity" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408317#respond" onclick='return addComment.moveForm( "comment-408317", "408317", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-360455">
<div class="comment-container" id="li-comment-360455">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ecbd72032e526cfafa7c6ae4f104538?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ecbd72032e526cfafa7c6ae4f104538?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nicholas</span>
<span class="date">August 19, 2016 at 7:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360455" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Liu,</p>
<p>after investigating a bit, I have concluded that the 1 time-step LSTM is indeed the trivial identity function (you can convince yourself by reducing the layer to 1 neuron, and adding ad-hoc data to the test set, as you have). But if we think about it, this makes alot of sense that the ‘mimic’ function would minimize MSE for such a simple network – it doesn’t see enough time steps to learn the sequence, anyways. </p>
<p>However, if you increase the number of timesteps, you will see that it can reach lower MSE on the test set by slowly moving away from the mimic function to actually learning the sequence, although for low #’s of neurons the approximation will be rougher-looking. I recommend experimenting with the look_back amount, and adding more layers to see how the MSE can be reduced further!</p>
<div class="reply">
<a aria-label="Reply to Nicholas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360455#respond" onclick='return addComment.moveForm( "comment-360455", "360455", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-360596">
<div class="comment-container" id="li-comment-360596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/29e44d5a58298e32d84fa39602dd78da?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Liu</span>
<span class="date">August 20, 2016 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Nicholas,</p>
<p>Thanks for the comment!</p>
<p>I guess the problem (or feature you can say) in the first example is that ‘time-step’ is set to 1 if I understand the API correctly:</p>
<p>trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))</p>
<p>It means it is feeding sequence of length 1 to the network in each training. Therefore, the RNN/LSTM is not unrolled. The updated internal state is not used anywhere (as it is also resetting the states of the machine in each batch).</p>
<p>I agree with what you said. But by setting timestep and look_back to be 1 as in the first example, it is not learning a sequence at all.</p>
<p>For other readers, I think it worths to look at <a href="http://stackoverflow.com/questions/38714959/understanding-keras-lstms" rel="nofollow">http://stackoverflow.com/questions/38714959/understanding-keras-lstms</a></p>
<div class="reply">
<a aria-label="Reply to Liu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360596#respond" onclick='return addComment.moveForm( "comment-360596", "360596", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-363267">
<div class="comment-container" id="li-comment-363267">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7545be2a92268d9e89c25b7f793fc09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7545be2a92268d9e89c25b7f793fc09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gilles</span>
<span class="date">September 2, 2016 at 5:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363267" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Nicholas,</p>
<p>This is a very good point, thanks for mentioning it.</p>
<p>I have implemented an LSTM on a 1,500 points sample size and indeed sometimes I was wondering whether there really was a big difference with a “mimic” function. </p>
<p>A lot of work to predict the value t+1 while value at t would have been a good enough predictor!</p>
<p>Will try more experiments as I have more data.</p>
<div class="reply">
<a aria-label="Reply to Gilles" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363267#respond" onclick='return addComment.moveForm( "comment-363267", "363267", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-395474">
<div class="comment-container" id="li-comment-395474">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Logan</span>
<span class="date">April 6, 2017 at 4:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395474" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hey Liu, it’s a very good observation. I still on the basics and I think these sort of information is really important if we want to build something with quality. Thanks.<br/>
Thanks for the tutorial as well.</p>
<div class="reply">
<a aria-label="Reply to Logan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395474#respond" onclick='return addComment.moveForm( "comment-395474", "395474", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-360521">
<div class="comment-container" id="li-comment-360521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8541cab0c8aec1819f95f2980684ef9e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8541cab0c8aec1819f95f2980684ef9e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">August 20, 2016 at 12:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this amazing tut, could you please tell me about what is the main role of batch_size in model.fit() and output shape of LSTM layer parameter ?<br/>
I read somewhere that using batch_size is depend on our dataset why you chose batch_size = 1 for fitting model and what is the effect of choosing it’s value on calculating gradient of the model?</p>
<p>thanks</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360521#respond" onclick='return addComment.moveForm( "comment-360521", "360521", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-360580">
<div class="comment-container" id="li-comment-360580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2016 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Chris.</p>
<p>The batch_size is the number of samples from your train dataset shown to the model at a time. After batch_size samples are run through the network and error calculated, an update to the weights is performed. Too many and the updates are too big, too few, and the updates are too noisy. The hardware you use is also a factor for batch_size and you want to ensure you can fit the batch of samples in memory (e.g. so your GPU can get at them).</p>
<p>I chose a batch_size of 1 because I want to explore and demonstrate LSTMs on time series working with only one sample at a time, but potentially vary the number of features or time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360580#respond" onclick='return addComment.moveForm( "comment-360580", "360580", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-360921">
<div class="comment-container" id="li-comment-360921">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/03c98637586f2a7cba1c0fab45417a46?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/03c98637586f2a7cba1c0fab45417a46?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hany El-Ghaish</span>
<span class="date">August 22, 2016 at 8:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-360921" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this series. I have a question for you.<br/>
I want to apply a multi-classification problem for videos using LSTM. also, video samples have a different number of frames.<br/>
Dataset: samples of videos for actions like boxing, jumping, hand waving, etc.. (Dataset like UCF1101)  . each class of action has one label.</p>
<p>so, each video has a label.<br/>
Really, I  do not know how to describe the data set to LSTM when a number of frames  sequence are different from one action to another and I do not know how to use it when a number of frames are fixed as well.</p>
<p>if you have any example of how to use:<br/>
LSTM, stacked of LSTM, or CNN with LSTM with this problem this will help me too much.<br/>
I wait for your recommendations<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Hany El-Ghaish" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=360921#respond" onclick='return addComment.moveForm( "comment-360921", "360921", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-362748">
<div class="comment-container" id="li-comment-362748">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0ea48066369be91c9bc10701d745bc24?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0ea48066369be91c9bc10701d745bc24?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harsha</span>
<span class="date">August 30, 2016 at 7:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362748" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason. Thanks for such a wonderful tutorial. it helped me a lot to get an insight on LSTM’s. I too have a similar question. Can you please comment on this question.</p>
<div class="reply">
<a aria-label="Reply to Harsha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362748#respond" onclick='return addComment.moveForm( "comment-362748", "362748", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-361707">
<div class="comment-container" id="li-comment-361707">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">August 26, 2016 at 3:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-361707" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this great tutorial! I would like to ask, suppose I have a set of X points : X1, X2, .. Xn that contributes to the total sales of the day represented by Y,  and I have 60 days data (Y1 until Y60), how do I do time series forecast using these data? Assuming that I would like to predict Y65. Do you have any sample or coding references?</p>
<p>Thanks in advance</p>
<div class="reply">
<a aria-label="Reply to Alvin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=361707#respond" onclick='return addComment.moveForm( "comment-361707", "361707", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-361778">
<div class="comment-container" id="li-comment-361778">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 26, 2016 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-361778" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe you could adapt one of the examples in your post directly to your problem. Little effort required.</p>
<p>Consider normalizing or standardizing your input and output values when working with neural networks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=361778#respond" onclick='return addComment.moveForm( "comment-361778", "361778", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-362633">
<div class="comment-container" id="li-comment-362633">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">August 30, 2016 at 8:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362633" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I just found out the question that I have is a multi step ahead prediction, where all the X contributes to Y, and I would like to predict ahead the value of Y n days ahead. Is the example that you gave in this tutorial still relevant?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Alvin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362633#respond" onclick='return addComment.moveForm( "comment-362633", "362633", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-362839">
<div class="comment-container" id="li-comment-362839">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2016 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362839" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alvin,</p>
<p>Yes, you could trivially extend the example to do sequence-to-sequence prediction as it is called in recurrent neural network parlance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362839#respond" onclick='return addComment.moveForm( "comment-362839", "362839", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-362882">
<div class="comment-container" id="li-comment-362882">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">August 31, 2016 at 1:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362882" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your reply. I still would like to clarify after looking at the sequence to sequence concept. Assuming I would like to predict the daily total sales (Y), given x1 such as the total number of customers, total item A sold as x2, total item B sold as x3 and so on for the next few items, is sequence to sequence suitable for this?</p>
<p>Thanks</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-362920">
<div class="comment-container" id="li-comment-362920">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">August 31, 2016 at 6:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362920" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have another question. Looking at your example for the Window method, on line 35:<br/>
# reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</p>
<p>what if I would like to change the time steps to more than 1? What other parts of codes I would need to change? Currently when I change it, it says<br/>
ValueError: total size of new array must be unchanged.</p>
<p>Thanks</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-364353">
<div class="comment-container" id="li-comment-364353">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">September 13, 2016 at 11:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364353" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>For using stateful LSTM, to predict multiple steps, I came across suggestions to feed the output vector back into the model for the next timestep’s prediction. May I know how to get an output vector from based on your LSTM stateful example?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-364416">
<div class="comment-container" id="li-comment-364416">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 14, 2016 at 10:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364416" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alvin,</p>
<p>The LSTM will maintain internal state so that you only need to provide the next input pattern. The LSTM implementation in Keras does require that you provide your data in consistent batch sizes, but when experimenting with this you could reduce the batch size down to 1.</p>
<p>I hope that helps.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-362317">
<div class="comment-container" id="li-comment-362317">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DRD</span>
<span class="date">August 29, 2016 at 2:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362317" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Apparently, when using the tensor flow backend, you have to specify input_length in the LTSM constructor. Otherwise, you get an exception. I assume it would just be input_length=1</p>
<div class="reply">
<a aria-label="Reply to DRD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362317#respond" onclick='return addComment.moveForm( "comment-362317", "362317", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-362318">
<div class="comment-container" id="li-comment-362318">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DRD</span>
<span class="date">August 29, 2016 at 2:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362318" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So like this:<br/>
model.add(LSTM(4, input_dim=look_back, input_length=1))</p>
<p>This references the first example where number of features and timesteps is 1. Here input_length corresponds to timesteps.</p>
<div class="reply">
<a aria-label="Reply to DRD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362318#respond" onclick='return addComment.moveForm( "comment-362318", "362318", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-362634">
<div class="comment-container" id="li-comment-362634">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f3961174a7608cb03f5e2ff7f3ea455b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alvin</span>
<span class="date">August 30, 2016 at 8:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362634" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi DRD,</p>
<p>Is this the setting used to solve multi step ahead prediction? </p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Alvin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362634#respond" onclick='return addComment.moveForm( "comment-362634", "362634", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-363000">
<div class="comment-container" id="li-comment-363000">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/72010d5cd7b247fac67db9270c234e55?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DRD</span>
<span class="date">September 1, 2016 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363000" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI, </p>
<p>Haven’t tried it yet, but in the section titled: “LSTM With Memory Between Batches</p>
<p>”  input_length should be 3. Basically the same as look_back</p>
<div class="reply">
<a aria-label="Reply to DRD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363000#respond" onclick='return addComment.moveForm( "comment-363000", "363000", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-362782">
<div class="comment-container" id="li-comment-362782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nick</span>
<span class="date">August 31, 2016 at 1:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I applied your technique on stock prediction:<br/>
But, I am having some issues.<br/>
I take all the historical prices of a stock and frame it the same way the airline passenger prices are in a .csv file. </p>
<p>I use a look_back=20 and I get the following image: </p>
<p><a href="https://postimg.org/image/p53hw2nc7/" rel="nofollow">https://postimg.org/image/p53hw2nc7/</a></p>
<p>Then I try to predict the next stock price and the prediction is not accurate. </p>
<p>Why is the model able to predict the airline passengers so precisely ?</p>
<p><a href="https://postimg.org/image/z0lywvru1/" rel="nofollow">https://postimg.org/image/z0lywvru1/</a></p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Nick" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362782#respond" onclick='return addComment.moveForm( "comment-362782", "362782", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-362853">
<div class="comment-container" id="li-comment-362853">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2016 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362853" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would suggest tuning the number of layers and number of blocks to suits your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362853#respond" onclick='return addComment.moveForm( "comment-362853", "362853", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-363011">
<div class="comment-container" id="li-comment-363011">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">September 1, 2016 at 7:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363011" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you.<br/>
I will play around the network. </p>
<p>In general, For input_dim (windows size),  is a smaller or larger number better ?</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363011#respond" onclick='return addComment.moveForm( "comment-363011", "363011", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-362934">
<div class="comment-container" id="li-comment-362934">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marcel</span>
<span class="date">August 31, 2016 at 8:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362934" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>First off, thanks again for this great blog, without you I would be nowhere, with LSTM, and life!</p>
<p>I am running a LSTM model that works, but when I make predictions with “model.predict” it spits out 4000 predictions, which look fine. However, when I run “model.predict” again and save those 4000 predictions again, they are different. From prediction 50 onward, they are all essentially the same, but the first few (that are very important to me) are very different. To give you an idea, the correlation between the first 10 predictions of both rounds is 0.11. </p>
<p>Please help!</p>
<div class="reply">
<a aria-label="Reply to Marcel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362934#respond" onclick='return addComment.moveForm( "comment-362934", "362934", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-362949">
<div class="comment-container" id="li-comment-362949">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marcel</span>
<span class="date">August 31, 2016 at 10:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362949" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The problem wasn’t with numpy.random.seed(0) as I originally thought. I’ve tested this over and over, and even if on the exact same data, predictions are always different/inconsistent for the first few predictions, and only “converge” to some consistent predictions after about 50 predictions have been made previously (on the same or different input data).</p>
<div class="reply">
<a aria-label="Reply to Marcel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362949#respond" onclick='return addComment.moveForm( "comment-362949", "362949", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-362964">
<div class="comment-container" id="li-comment-362964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1646b1e66946371f888d272526d84f0e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Marcel</span>
<span class="date">September 1, 2016 at 1:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-362964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It seems like I have made an error by neglecting to include “model.reset_states()” after one line of calling model.predict()</p>
<div class="reply">
<a aria-label="Reply to Marcel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=362964#respond" onclick='return addComment.moveForm( "comment-362964", "362964", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-363022">
<div class="comment-container" id="li-comment-363022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 1, 2016 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear you worked it out Marcel.</p>
<p>A good lesson for all of to remember or calls to reset state.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363022#respond" onclick='return addComment.moveForm( "comment-363022", "363022", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-363152">
<div class="comment-container" id="li-comment-363152">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">September 1, 2016 at 9:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363152" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In the part “LSTM For Regression with Time Steps”, </p>
<p>should’t the reshaping be in the form:</p>
<p>[Samples, Features, Time] = (trainX, (trainX.shape[0], trainX.shape[1], 1] </p>
<p>Because in the previous two section:<br/>
“LSTM Network For Regression” and<br/>
“LSTM For Regression Using the Window Method” we used:</p>
<p>[Samples, Time Steps, Features] = (trainX, (trainX.shape[0], 1, trainX.shape[1])</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363152#respond" onclick='return addComment.moveForm( "comment-363152", "363152", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-363261">
<div class="comment-container" id="li-comment-363261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75d910050ccc1bc26073167739158abf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://sachinruk.github.io" rel="external nofollow">sachin</a></span>
<span class="date">September 2, 2016 at 3:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Correct me if I’m wrong, but you don’t want to reset_state in the last training iteration do you? Basically my logic is that you want to carry through the last ‘state’ onto the test set because they occur right after the other.</p>
<p>Cheers,<br/>
Sachin</p>
<div class="reply">
<a aria-label="Reply to sachin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363261#respond" onclick='return addComment.moveForm( "comment-363261", "363261", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-363352">
<div class="comment-container" id="li-comment-363352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 3, 2016 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You do. The reason is that you can seed the network with state later when you are ready to use it to make a prediction.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363352#respond" onclick='return addComment.moveForm( "comment-363352", "363352", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-363444">
<div class="comment-container" id="li-comment-363444">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a6a5036eb94a2d81de12b42d9572471a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a6a5036eb94a2d81de12b42d9572471a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Megs</span>
<span class="date">September 3, 2016 at 10:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363444" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Am I correct if I was to use Recurrent Neural Networks to predict Dengue Incidences against data on temperature, rainfall, humidity, and dengue incidences.. If so, how would I go about in the processing of my data. I already have the aforementioned data at hand and I have tried using a feed forward neural network using pybrain. It doesn’t seem to get the trend hence my trying of Recurrent Neural Network.</p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Megs" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363444#respond" onclick='return addComment.moveForm( "comment-363444", "363444", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-363596">
<div class="comment-container" id="li-comment-363596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4923737ce90e184faa7481c5db35d04b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4923737ce90e184faa7481c5db35d04b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Christoph</span>
<span class="date">September 5, 2016 at 4:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am a little bit confused regarding the “statefulness”. </p>
<p>If I use a Sequential Model with LSTM layers and stateful set to false. Will this still be a recurrent network that feeds back into my nodes? How would I compare it to the standard LSTM model proposed by Hochreiter et al. (1997)? Do I have to use the stateful layers to mimic the behaviour presented in the original paper?</p>
<p>In essence, I have a simple time series of sales forecasts that show a weekly and partly a yearly pattern. It was easy to create a simple MLP with the Dense layer and the time window method. I put some sales values from the last week, the same week day a few weeks back and the sales of the days roughly a year before into my feature vector. Results are pretty good so far. </p>
<p>I now want to compare it to an LSTM approach. I am however not sure how I can model the weekly and yearly pattern correctly and if I need to use the stateful LSTM or not. Basically I want to use the power of an LSTM to predict a sequence of a longer period of time and hope that the forecasts will be better than with a standard (and much faster) MLP.</p>
<div class="reply">
<a aria-label="Reply to Christoph" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363596#respond" onclick='return addComment.moveForm( "comment-363596", "363596", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-363887">
<div class="comment-container" id="li-comment-363887">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c39732bad8d02da98a637993affaa924?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c39732bad8d02da98a637993affaa924?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nathan George</span>
<span class="date">September 7, 2016 at 3:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363887" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>These lines don’t make sense to me:</p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</p>
<p>Isn’t it [samples, fetaures, timesteps] ?<br/>
When you switch to lookback = 3, you still use trainX.shape[0], 1, trainX.shape[1] as your reshape, and aren’t the timesteps the lookback?  I noticed the Keras model doesn’t work unless you reshape in this way, which is really strange to me.  Why do we have to have a matrix full of 1×1 vectors which hold another vector inside of them?  Is this in case we have more features or something?  Are there ever any cases where the ‘1’ in the reshape would be any other number?</p>
<div class="reply">
<a aria-label="Reply to Nathan George" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363887#respond" onclick='return addComment.moveForm( "comment-363887", "363887", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-363988">
<div class="comment-container" id="li-comment-363988">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4923737ce90e184faa7481c5db35d04b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4923737ce90e184faa7481c5db35d04b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Christoph</span>
<span class="date">September 8, 2016 at 10:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-363988" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the example given here is wrong in the sense, that each data point represents a sample with one single timestep. This doesn’t make sense at all if you think about the strengths of recurrent networks and especially LSTM. How is the LSTM going to memorize if there’s only one timestep for each sample? </p>
<p>Since we are working on a single time series, it should probably be the other way around, with one sample and n timesteps. One could also try and reduce the number of timesteps and split the time series up into samples of a week or a month depending on the data. </p>
<p>Not sure if this is all correct what I just said, but I get the feeling that this popular tutorial isn’t a 100% correct and therefore a bit misleading for the community.</p>
<div class="reply">
<a aria-label="Reply to Christoph" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=363988#respond" onclick='return addComment.moveForm( "comment-363988", "363988", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-364028">
<div class="comment-container" id="li-comment-364028">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2016 at 7:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364028" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I do provide multiple examples just so you can compare the methods, both learning by single sample, by window and by timestep.</p>
<p>For this specific problem, the timestep approach is probably the best way to model it, but if you want to use some of these examples as a template for your own problem, you have a few options to choose from.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364028#respond" onclick='return addComment.moveForm( "comment-364028", "364028", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-364037">
<div class="comment-container" id="li-comment-364037">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/61a1a8c025af6f0fbeb8a92f18b1de36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/61a1a8c025af6f0fbeb8a92f18b1de36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Oswaldo</span>
<span class="date">September 9, 2016 at 10:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364037" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If I want to predict t+1 in a test set with t, the prediction doesn’t make sense. If I shift the prediction, it make sense but I end up predicting t with t, using a next-step model that learnt the sequence. Nice exercise to get used with the implementation, but what’s the point in real life? I really want a t+1 prediction that match t+1 (not t) in the test set, What I’m missing?</p>
<div class="reply">
<a aria-label="Reply to Oswaldo" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364037#respond" onclick='return addComment.moveForm( "comment-364037", "364037", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-364235">
<div class="comment-container" id="li-comment-364235">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb4bf016a7e6252cf767ad979d65669d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb4bf016a7e6252cf767ad979d65669d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Easwar</span>
<span class="date">September 12, 2016 at 1:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364235" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>  This is an excellent tutuorial. I have a question. You have one LSTM (hidden) layer with 4 neurons. What if I construct a LSTM layer with only 1 neuron. Why should I have 4 neurons ? I suppose this is different from having two or layers (depth) ? Depth in my understanding is if you have more layers of LSTM. </p>
<p>If you have 4 LSTM neurons in first layers, does input get fed to all the 4 neurons in a fully connected fashion ? Can you explain that ?</p>
<p>Best Regards,<br/>
Easwar</p>
<div class="reply">
<a aria-label="Reply to Easwar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364235#respond" onclick='return addComment.moveForm( "comment-364235", "364235", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-364262">
<div class="comment-container" id="li-comment-364262">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 12, 2016 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364262" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Easwar.</p>
<p>More neurons means more representational capacity at that layer. More layers means more opportunity to abstract hierarchical features.</p>
<p>The number of neurons (LSTM call them blocks) and layers to use is a matter of trial and error (tuning).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364262#respond" onclick='return addComment.moveForm( "comment-364262", "364262", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-389028">
<div class="comment-container" id="li-comment-389028">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 19, 2017 at 2:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389028" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If we reduce the number of neurons BELOW the number of features fed into an RNN, then does the model simply use as many features as the neuron number allows ?<br/>
For example, if I have 10 features but define a model with only 5 neurons in the initial layer(s), would the model only use the FIRST 5 features ?</p>
<p>Thanks,<br/>
Sam</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389028#respond" onclick='return addComment.moveForm( "comment-389028", "389028", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-389150">
<div class="comment-container" id="li-comment-389150">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 20, 2017 at 9:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389150" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, I expect it will cause an error. Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389150#respond" onclick='return addComment.moveForm( "comment-389150", "389150", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-389661">
<div class="comment-container" id="li-comment-389661">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 23, 2017 at 12:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389661" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>NO, surprisingly it works very well and gives great prediction results.<br/>
Is there a requirement that each feature have a neuron ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-364334">
<div class="comment-container" id="li-comment-364334">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fbb9ead611524a53bdc781a6a3169f59?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fbb9ead611524a53bdc781a6a3169f59?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max Clayer</span>
<span class="date">September 13, 2016 at 4:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364334" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi I have found when running your raw example on the data, the training data seems to be shifted to the right of the true plot and not the same as your graph in your first example, why could this be?</p>
<div class="reply">
<a aria-label="Reply to Max Clayer" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364334#respond" onclick='return addComment.moveForm( "comment-364334", "364334", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-364889">
<div class="comment-container" id="li-comment-364889">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfc3ba4b3f95c38125d815a098a1a38b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfc3ba4b3f95c38125d815a098a1a38b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stijn</span>
<span class="date">September 19, 2016 at 1:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364889" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Nice blog post.</p>
<p>I noticed however, that when you do not scale the input data and switch the activation of the LSTMs to ReLu, you are able to get performance comparable to the feedforward models in your other blog post (<a href="http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/</a>).  The performance becomes: Train Score: 23.07 RMSE, Test Score: 48.59 RMSE</p>
<p>Moreover, when you run the feedforward models in the other blog post with scaling of the input data their performance degrades.</p>
<p>Any idea why scaling the dataset seems to worsen the performance performance?</p>
<p>Cheers,</p>
<p>Stijn</p>
<div class="reply">
<a aria-label="Reply to Stijn" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364889#respond" onclick='return addComment.moveForm( "comment-364889", "364889", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-364907">
<div class="comment-container" id="li-comment-364907">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2016 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-364907" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting finding Stijn, thanks for reporting it.</p>
<p>I need to experiment more myself. Not scaling and using ReLu would go hand in hand.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=364907#respond" onclick='return addComment.moveForm( "comment-364907", "364907", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-365343">
<div class="comment-container" id="li-comment-365343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">V</span>
<span class="date">September 23, 2016 at 2:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason – actually I was able to verify Stjin’s results (could you please delete my inquiry to him).</p>
<p>But I am curious about this:</p>
<p>Train Score: 22.51 RMSE<br/>
Test Score: 49.75 RMSE</p>
<p>The error is almost twice as large on the out of sample data, what does that mean about the quality of our model?</p>
<div class="reply">
<a aria-label="Reply to V" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365343#respond" onclick='return addComment.moveForm( "comment-365343", "365343", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-365342">
<div class="comment-container" id="li-comment-365342">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6e5854357c24b24c01330cd25700f91a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">V</span>
<span class="date">September 23, 2016 at 2:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365342" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Stijn – I wasn’t able to replicate your results, could you please post your code. Thanks!</p>
<div class="reply">
<a aria-label="Reply to V" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365342#respond" onclick='return addComment.moveForm( "comment-365342", "365342", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-366205">
<div class="comment-container" id="li-comment-366205">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/caf83ee03275d00855f613dc310962f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/caf83ee03275d00855f613dc310962f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max Clayer</span>
<span class="date">October 4, 2016 at 3:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366205" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p><a href="http://stats.stackexchange.com/questions/59630/test-accuracy-higher-than-training-how-to-interpret" rel="nofollow">http://stats.stackexchange.com/questions/59630/test-accuracy-higher-than-training-how-to-interpret</a></p>
<div class="reply">
<a aria-label="Reply to Max Clayer" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366205#respond" onclick='return addComment.moveForm( "comment-366205", "366205", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-366222">
<div class="comment-container" id="li-comment-366222">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 4, 2016 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366222" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great link, thanks Max.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366222#respond" onclick='return addComment.moveForm( "comment-366222", "366222", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-365288">
<div class="comment-container" id="li-comment-365288">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bc0c102fa8f850ef3d6496dfb6880d14?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bc0c102fa8f850ef3d6496dfb6880d14?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jakob Aungiers</span>
<span class="date">September 22, 2016 at 10:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365288" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>As far as I can tell (and you’ll have to excuse me if I’m being naive) this isn’t predicting the next timestep at all? Merely doing a good job at mimicking the previous timestep?</p>
<p>For example the with the first example, if we take the first timestep of trainX (trainX[0]) the prediction from the model doesn’t seem to be trying to predict what t+1 (trainX[1]) is, but merely mimics what it thinks fits the model at that particular timestep (trainX[0]) i.e. tries to copy the current timestep. Same for trainX[1], the prediction is not a prediction of trainX[2] but a guess at trainX[1]… Hence which the graphs in the post (which as you mentioned above you need to update) look like they’re forwardlooking, but running the code actually produces graphs which have the predictions shifted t+look_back.</p>
<p>How would you make this a forward looking graph? Hence also, I tried to predict multiple future timesteps with your first model by initialising the first prediction with testX[0] and then feeding the next predictions with the prior predictions but the predictions just plummeted downwards into a downwards curve. Not predicting the next timesteps at all.</p>
<p>Am I being naive to the purpose of this blog post here?</p>
<p>All the best, love your work,<br/>
Jakob</p>
<div class="reply">
<a aria-label="Reply to Jakob Aungiers" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365288#respond" onclick='return addComment.moveForm( "comment-365288", "365288", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-365389">
<div class="comment-container" id="li-comment-365389">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d87701cf30f425e018a7f89cb2d7cc5c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d87701cf30f425e018a7f89cb2d7cc5c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://jirvin16.github.io" rel="external nofollow">Jeremy Irvin</a></span>
<span class="date">September 24, 2016 at 11:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365389" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jakob, </p>
<p>I believe you are correct.</p>
<p>I have tried these methods on many different time series and the same mimicking behavior occurs – the training loss is somehow minimized by outputting the previous timestep.</p>
<p>A similar mimicking behavior occurs when predicting multiple time steps ahead as well (for example, if predicting two steps ahead, the model learns to output the previous two timesteps). </p>
<p>There is a small discussion on this issue found here – <a href="https://github.com/fchollet/keras/issues/2856" rel="nofollow">https://github.com/fchollet/keras/issues/2856</a> – but besides that I haven’t discovered any ways to combat this (or if there is some underlying problem with Keras, my code, etc.).</p>
<p>I am in the process of writing a blog to uncover this phenomenon in more detail. Will follow up when I am done.</p>
<p>Any other advancements or suggestions would be greatly appreciated!</p>
<p>Thanks,<br/>
Jeremy</p>
<div class="reply">
<a aria-label="Reply to Jeremy Irvin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365389#respond" onclick='return addComment.moveForm( "comment-365389", "365389", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-366207">
<div class="comment-container" id="li-comment-366207">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/caf83ee03275d00855f613dc310962f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/caf83ee03275d00855f613dc310962f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max Clayer</span>
<span class="date">October 4, 2016 at 4:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366207" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are you simply using t-1 to predict t+1 in the time window, if so I don’t think there is enough data being fed into the neural network to learn effectively. with a bigger time window I notice that the model does start to fit better.</p>
<div class="reply">
<a aria-label="Reply to Max Clayer" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366207#respond" onclick='return addComment.moveForm( "comment-366207", "366207", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-365299">
<div class="comment-container" id="li-comment-365299">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c413ed3843a29fa93452b2c66a53c406?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c413ed3843a29fa93452b2c66a53c406?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dominic</span>
<span class="date">September 23, 2016 at 2:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365299" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason<br/>
Thank you for your post.<br/>
I am still confused about LSTM for regression with window method and time steps.<br/>
Could you explain more about this point. Could you use some figures to show the difference between them?<br/>
Many thanks!</p>
<div class="reply">
<a aria-label="Reply to Dominic" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365299#respond" onclick='return addComment.moveForm( "comment-365299", "365299", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-365310">
<div class="comment-container" id="li-comment-365310">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c413ed3843a29fa93452b2c66a53c406?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c413ed3843a29fa93452b2c66a53c406?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dominic</span>
<span class="date">September 23, 2016 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365310" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>As my understanding, the LSTM for regression with window method is the same as a standard MLP method, which has 3 input features and one output as the example. Is this correct? What’s the difference?</p>
<div class="reply">
<a aria-label="Reply to Dominic" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365310#respond" onclick='return addComment.moveForm( "comment-365310", "365310", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-365404">
<div class="comment-container" id="li-comment-365404">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7ee764828682624020d180f399a871e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7ee764828682624020d180f399a871e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wolfgang</span>
<span class="date">September 24, 2016 at 4:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365404" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much for the detailed article!</p>
<p>Does anybody have a scientific source for the time window? I can’t seem to find one.</p>
<div class="reply">
<a aria-label="Reply to Wolfgang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365404#respond" onclick='return addComment.moveForm( "comment-365404", "365404", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-365452">
<div class="comment-container" id="li-comment-365452">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 25, 2016 at 8:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365452" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>I don’t know of any, but there must be something written up about it back in the early days. I also expect it’s in old neural net texts.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365452#respond" onclick='return addComment.moveForm( "comment-365452", "365452", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-365445">
<div class="comment-container" id="li-comment-365445">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1bb9d681c73d4e543ce7dbee55241665?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1bb9d681c73d4e543ce7dbee55241665?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brian</span>
<span class="date">September 25, 2016 at 7:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365445" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Have you experimented with having predictors (multivariate time series) versus a univariate? Is that possible in Keras?</p>
<div class="reply">
<a aria-label="Reply to Brian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365445#respond" onclick='return addComment.moveForm( "comment-365445", "365445", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-365454">
<div class="comment-container" id="li-comment-365454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 25, 2016 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can have multiple input features for multiple regression.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365454#respond" onclick='return addComment.moveForm( "comment-365454", "365454", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-365509">
<div class="comment-container" id="li-comment-365509">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5251c2b259a949fdb11f18f6c2eddfe3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5251c2b259a949fdb11f18f6c2eddfe3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brian</span>
<span class="date">September 26, 2016 at 12:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365509" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Any chance you will add this type of example?</p>
<div class="reply">
<a aria-label="Reply to Brian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365509#respond" onclick='return addComment.moveForm( "comment-365509", "365509", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-365531">
<div class="comment-container" id="li-comment-365531">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 26, 2016 at 6:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365531" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I will in coming weeks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365531#respond" onclick='return addComment.moveForm( "comment-365531", "365531", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-365680">
<div class="comment-container" id="li-comment-365680">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/14a97f2fd7d2c80353e37d6278ad8f4f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/14a97f2fd7d2c80353e37d6278ad8f4f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://prvt" rel="external nofollow">Jacques Rand</a></span>
<span class="date">September 27, 2016 at 11:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365680" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Me too will be interested in using multivariate(numerical) data !<br/>
Been trying for a few days , but the “reshaping/shaping/data-format-blackmagic” always breaks<br/>
Purely cause I don’t yet understand it !<br/>
Otherwise great example !</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-365714">
<div class="comment-container" id="li-comment-365714">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2016 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365714" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Understood, I’ll prepare tutorials.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-366162">
<div class="comment-container" id="li-comment-366162">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1bafba9ede64f51694d5a20a2f285090?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1bafba9ede64f51694d5a20a2f285090?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://daviswind.net%20/%20davishydro.com" rel="external nofollow">Richard Ely</a></span>
<span class="date">October 3, 2016 at 4:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366162" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir,  Awesome work!!!  </p>
<p>I am very interested in cross-sectional time series estimation… How can that be done? </p>
<p>I am starting your Python track, but will eventually target data with say 50 explanatory variables, with near infinite length of time series observations available  on each one.  Since the explanatory variables are not independent normal OLS is useless and wish to learn your methods.  </p>
<p>I would be most interested in your approach to deriving an optimal sampling temporal window and estimation procedure.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-366214">
<div class="comment-container" id="li-comment-366214">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 4, 2016 at 7:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366214" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry Richard, I don’t know about cross-sectional time series estimation.</p>
<p>For good window sizes, I recommend designing a study and resolving the question empirically.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-377442">
<div class="comment-container" id="li-comment-377442">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/14b89a6aa5ee7f2b0246c3beb30f4eff?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/14b89a6aa5ee7f2b0246c3beb30f4eff?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zhang Wenjie</span>
<span class="date">December 25, 2016 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377442" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>As you mentioned before, you will prepare the tutorial for  multiple input features for multiple regression. Could you provide us the link to that tutorial?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-377649">
<div class="comment-container" id="li-comment-377649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 26, 2016 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It will be part of a new book I am writing. I will put a version of it on the blog soon.</p>
<p>Multiple regression is straight forward with LSTMs, remember input is defined as [samples, timesteps, features]. Your multiple inputs are features. </p>
<p>For multiple output multi-step regression you can recurse the LSTM or change the number of outputs in the output layer.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-398208">
<div class="comment-container" id="li-comment-398208">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/de5e9b964adde3626dcf06fe48de8d98?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/de5e9b964adde3626dcf06fe48de8d98?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zach</span>
<span class="date">May 2, 2017 at 2:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398208" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Did you ever create a tutorial for multivariate LSTM? I can’t seem to find any!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-365661">
<div class="comment-container" id="li-comment-365661">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e8573dccbe5d38b3340ed028ae6f61e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e8573dccbe5d38b3340ed028ae6f61e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bob</span>
<span class="date">September 27, 2016 at 12:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365661" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I get this error when I run your script with the Theano backend:</p>
<p>ValueError: (‘The following error happened while compiling the node’, forall_inplace,cpu,scan_fn}(Elemwise{maximum,no_inplace}.0, Subtensor{int64:int64:int8}.0, IncSubtensor{InplaceSet;:int64:}.0, IncSubtensor{InplaceSet;:int64:}.0, Elemwise{Maximum}[(0, 0)].0, lstm_1_U_o, lstm_1_U_f, lstm_1_U_i, lstm_1_U_c), ‘\n’, ‘numpy.dtype has the wrong size, try recompiling’)</p>
<p>Any idea what might be happening?</p>
<div class="reply">
<a aria-label="Reply to Bob" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365661#respond" onclick='return addComment.moveForm( "comment-365661", "365661", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365710">
<div class="comment-container" id="li-comment-365710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2016 at 7:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Bob, it might be a problem with your backend. Try reinstalling Theano or Tensorflow – whichever you are using. Try switching up the one you are using.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365710#respond" onclick='return addComment.moveForm( "comment-365710", "365710", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-365778">
<div class="comment-container" id="li-comment-365778">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/20e9f02964ad4d4da8821d144c9e0373?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/20e9f02964ad4d4da8821d144c9e0373?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Philip</span>
<span class="date">September 28, 2016 at 9:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365778" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent article, really insightful. Do you have an article which expands on this to forecast data? An approach that would mimic that of say arima.predict in statsmodels? So ideally we train/fit the model on historical data, but then attempt to predict future values?</p>
<div class="reply">
<a aria-label="Reply to Philip" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365778#respond" onclick='return addComment.moveForm( "comment-365778", "365778", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-365807">
<div class="comment-container" id="li-comment-365807">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 29, 2016 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365807" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Philip, I plan to prepare many more time series examples.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365807#respond" onclick='return addComment.moveForm( "comment-365807", "365807", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-367480">
<div class="comment-container" id="li-comment-367480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/46c571cf35e19e5e3f93476b44f4d35a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/46c571cf35e19e5e3f93476b44f4d35a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Waldemar</span>
<span class="date">October 19, 2016 at 12:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,Mr.Brownlee!<br/>
I don’t see future values on your plots, as I understand your model don’t predict the Future, only describe History. Can you give advice, how can I do this? And how I can print predictive values?<br/>
Thanks a lot!</p>
<div class="reply">
<a aria-label="Reply to Waldemar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367480#respond" onclick='return addComment.moveForm( "comment-367480", "367480", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-365812">
<div class="comment-container" id="li-comment-365812">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cba8989ab8513a23f879c18029f708e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cba8989ab8513a23f879c18029f708e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tucker Siegel</span>
<span class="date">September 29, 2016 at 10:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365812" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great article Jason.<br/>
I was just wondering if there was any way I could input more than 1 feature , and have 1 output, which is what I am trying to predict? I am trying to build a stock market predictor. And yes I know, it is nearly impossible to predict the stock market, but I am just testing this, so lets say we live in a perfect world and it can be predicted. How would I do this?</p>
<div class="reply">
<a aria-label="Reply to Tucker Siegel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365812#respond" onclick='return addComment.moveForm( "comment-365812", "365812", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-365859">
<div class="comment-container" id="li-comment-365859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2016 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Tucker, </p>
<p>You can have multiple features as inputs. </p>
<p>The input structure for LSTMS is [samples, time steps, features], as explained above. In fact, there are examples of what you are looking for above (see the section on the window method).</p>
<p>Just specify the features (e.g. different indicators) in the third dimension. You may have 1 or more timesteps for each feature (second dimension).</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365859#respond" onclick='return addComment.moveForm( "comment-365859", "365859", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-365892">
<div class="comment-container" id="li-comment-365892">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cba8989ab8513a23f879c18029f708e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cba8989ab8513a23f879c18029f708e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tucker Siegel</span>
<span class="date">September 30, 2016 at 1:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-365892" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I did what you said, but now it wants to output 2 sequences out of the activation layer, but I only wanted it to have a final output of 1. Basically what I am doing is trying to use open and close stock data, and use it to predict tomorrow’s close. So I need to input 2 sequences and have an output of 1. I hope I explained that right. What should I do?</p>
<div class="reply">
<a aria-label="Reply to Tucker Siegel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=365892#respond" onclick='return addComment.moveForm( "comment-365892", "365892", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-366026">
<div class="comment-container" id="li-comment-366026">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/37316641439462b9a66568408ade754d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/37316641439462b9a66568408ade754d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joe</span>
<span class="date">October 1, 2016 at 11:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366026" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, you mentioned that LSTMs input shape must be [samples, time stamps, features]. What if my time series is sampled (t, x), i.e. each sample has its own time stamp, and the time stamps are NOT evenly spaced. Do I have to generate another time series in which all samples are evenly spaced? Is there any way to handle the original time series?</p>
<div class="reply">
<a aria-label="Reply to Joe" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366026#respond" onclick='return addComment.moveForm( "comment-366026", "366026", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-366057">
<div class="comment-container" id="li-comment-366057">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 2, 2016 at 8:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366057" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Really good question Joe. Thanks. I have not thought about this. </p>
<p>My instinct would be to pad the time series, fill in the spaces with zeros and make the time series steps equidistant. At least, I would try that against not doing it and evaluate the effect on performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366057#respond" onclick='return addComment.moveForm( "comment-366057", "366057", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-369559">
<div class="comment-container" id="li-comment-369559">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf6e9f611e605e855ef8593779d77cfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf6e9f611e605e855ef8593779d77cfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://np.nan" rel="external nofollow">Pho King</a></span>
<span class="date">November 5, 2016 at 3:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369559" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Take samples in blocks via Sklearn.model_selection.TimeSeriesSplit</p>
<div class="reply">
<a aria-label="Reply to Pho King" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369559#respond" onclick='return addComment.moveForm( "comment-369559", "369559", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-366359">
<div class="comment-container" id="li-comment-366359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rio</span>
<span class="date">October 6, 2016 at 4:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What an excellent article!<br/>
Recently I used LSTM to predict stock market index where the data is fluctuating and has no seasonal pattern like the air passanger data. I was just wondering about how does LSTM (or every gate) decide when to forget or keep a certain value of this type of series data. Any explanation about this? Thank you.</p>
<div class="reply">
<a aria-label="Reply to Rio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366359#respond" onclick='return addComment.moveForm( "comment-366359", "366359", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-366397">
<div class="comment-container" id="li-comment-366397">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 6, 2016 at 9:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366397" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Rio. I would love to work through how the gates compute/output on a specific problem. </p>
<p>I think this would be a new blog post in the future.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366397#respond" onclick='return addComment.moveForm( "comment-366397", "366397", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-366518">
<div class="comment-container" id="li-comment-366518">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rio</span>
<span class="date">October 7, 2016 at 1:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366518" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m looking forward to that post, Jason. Thank you</p>
<div class="reply">
<a aria-label="Reply to Rio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366518#respond" onclick='return addComment.moveForm( "comment-366518", "366518", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-366459">
<div class="comment-container" id="li-comment-366459">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d9096fc10c3caa033aa6fc73394177d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d9096fc10c3caa033aa6fc73394177d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">SalemAmeen</span>
<span class="date">October 6, 2016 at 10:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366459" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I used “LSTM For Regression Using the Window Method” with the following parameters<br/>
look_back = 20<br/>
LSTM(20,input_dim=look_back)</p>
<p>I got the following results</p>
<p>Train_Score: 113.67 RMSE<br/>
Test_Score: 122.88 RMSE</p>
<p>I computed R-squared and I got 0.93466300136</p>
<p>In addition I tried changing the hyperparameters in the other two models but R-squared was less in both comparing to this model.</p>
<div class="reply">
<a aria-label="Reply to SalemAmeen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366459#respond" onclick='return addComment.moveForm( "comment-366459", "366459", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-399146">
<div class="comment-container" id="li-comment-399146">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dae5cd4d649bdb25992611019a0e89cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dae5cd4d649bdb25992611019a0e89cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Cas</span>
<span class="date">May 9, 2017 at 5:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399146" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear SalemAmeen,</p>
<p>I am currently working with lstm recurrent neural networks and I am curious how you calculated R-squared. Are you willing to share your code about the R-squared calculation with me? Thank you very much!</p>
<p>Kind regards<br/>
Cas</p>
<div class="reply">
<a aria-label="Reply to Cas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399146#respond" onclick='return addComment.moveForm( "comment-399146", "399146", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-399252">
<div class="comment-container" id="li-comment-399252">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2017 at 8:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399252" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If you collect your predictions, you can calculate r^2 using the sklearn library:<br/>
<a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html" rel="nofollow">http://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html</a></p>
<p>You can also use a custom metric to report r^2 each epoch:<br/>
<a href="https://keras.io/metrics/" rel="nofollow">https://keras.io/metrics/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399252#respond" onclick='return addComment.moveForm( "comment-399252", "399252", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-366556">
<div class="comment-container" id="li-comment-366556">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Randy</span>
<span class="date">October 7, 2016 at 11:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366556" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason<br/>
First of all, this is really a fantastic post and thank you so much!<br/>
I’ve got confused on the “model.predict(x,batch_size)”.<br/>
I can’t figure what it means “predict in a batched way” on the keras official website.<br/>
My situation is like:<br/>
batch_size=10<br/>
I have a test sample [x_1] \in R^{2}, and I put it into the function,<br/>
[x_2] = model.predict([x_1],batch_size=batch_size)<br/>
(Let’s skip the numpy form issue)<br/>
Then,  subsequently, I put [x_2] into it, similarly, and I get [x_3] = model.predict([x_2],batch_size=batch_size), and so on, till x_10.</p>
<p>I don’t know if the function “predict” treats [x_1],[x_2],…[x_3] as in a batch ?<br/>
I guess it does.(although I didn’t put them into the function at one time) </p>
<p>Otherwise, I’ve tried another way to compute [x_2],…[x_10] and I got the same as above.<br/>
Another strategy is like:<br/>
[x_2] = model.predict([x_1],batch_size=batch_size)<br/>
[x_3] = model.predict([[x_1],[x_2],batch_size=batch_size)<br/>
[x_4] = model.predict([[x_1],[x_2],[x_3]],batch_size=batch_size)<br/>
…</p>
<p>What’s the difference between the two ways?<br/>
Thanks!</p>
<div class="reply">
<a aria-label="Reply to Randy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366556#respond" onclick='return addComment.moveForm( "comment-366556", "366556", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-366558">
<div class="comment-container" id="li-comment-366558">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Randy</span>
<span class="date">October 7, 2016 at 11:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366558" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>btw, I am also confused at “batch”.<br/>
If batch_size=1, does that mean there’s no relation between samples? I mean the state s_t won’t be sent to affect the next step s_(t+1).<br/>
So, why we need RNN?</p>
<div class="reply">
<a aria-label="Reply to Randy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366558#respond" onclick='return addComment.moveForm( "comment-366558", "366558", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-366587">
<div class="comment-container" id="li-comment-366587">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 8, 2016 at 10:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366587" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It’s a good point.</p>
<p>We need RNN because the state they can maintain gives results better than methods that do not maintain state.</p>
<p>As for batch_size=1 during calls to model.predict() I have not tested whether indeed state is lost as in training, but I expect it may be. I expect one would need batch_size=n_samples and replay data each time a prediction is needed.</p>
<p>I must experiment with this and get back to you.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366587#respond" onclick='return addComment.moveForm( "comment-366587", "366587", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-366585">
<div class="comment-container" id="li-comment-366585">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 8, 2016 at 10:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366585" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I understand the “two ways” you’re comparing, sorry.</p>
<p>The batch size is the number of records that the network will process at once  – as in load into memory and perform computation upon.</p>
<p>In training, this is the constraint on data before weight update. In test, it is data before computed predictions are returned.</p>
<p>Does that help at all?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366585#respond" onclick='return addComment.moveForm( "comment-366585", "366585", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-367061">
<div class="comment-container" id="li-comment-367061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89d977d2ee8042b34489af9513ce9296?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Randy</span>
<span class="date">October 13, 2016 at 3:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>yes, it does!<br/>
I appreciate it !!</p>
<div class="reply">
<a aria-label="Reply to Randy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367061#respond" onclick='return addComment.moveForm( "comment-367061", "367061", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-366605">
<div class="comment-container" id="li-comment-366605">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7ead1e2020288b7c27741ee5510a346?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7ead1e2020288b7c27741ee5510a346?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">dubi dubi</span>
<span class="date">October 8, 2016 at 3:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366605" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a great post! Thanks for the guidance. I’m wondering about performance. I’ve setup my network very similarly to yours, just have a larger data set (about 2500 samples, each with 218 features). Up to about 20 epochs runs in a reasonable amount of time, but anything over that seems to take forever.</p>
<p>I’ve set-up random forests and MLPs, and nothing has run so slowly. I can see all CPUs are being used, so am wondering whether Keras and/or LSTM has performance issues with larger data sets.</p>
<div class="reply">
<a aria-label="Reply to dubi dubi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366605#respond" onclick='return addComment.moveForm( "comment-366605", "366605", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-366650">
<div class="comment-container" id="li-comment-366650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 9, 2016 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-366650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>LSTMs do use more resources than classical networks because of all the internal gates. No significant, but you will notice it at scale.</p>
<p>I have not performed any specific studies on this, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=366650#respond" onclick='return addComment.moveForm( "comment-366650", "366650", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-367005">
<div class="comment-container" id="li-comment-367005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e1459cdec7c2e12166f1764ce8110fc7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e1459cdec7c2e12166f1764ce8110fc7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jason Wills</span>
<span class="date">October 12, 2016 at 4:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am confusing about deep learning and machine learning in Stock Market , forex . There are a lot of models which analyses via chart using amibroker or metastock which redraw the history price  and take the prediction in that model . Does it call the machine learning or deep learning ?<br/>
How is it when we could do farther to make better prediction via deep learning if it’s right ?</p>
<div class="reply">
<a aria-label="Reply to Jason Wills" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367005#respond" onclick='return addComment.moveForm( "comment-367005", "367005", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-367044">
<div class="comment-container" id="li-comment-367044">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 13, 2016 at 8:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367044" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, it sounds like you are already using predictive models. </p>
<p>It may fair to call them machine learning. Deep learning is one group of specific techniques you may or may not be using.</p>
<p>There are may ways to improve results, but it is trial and error. I offer some ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<p>Sorry, I don’t know the specifics of stockmarket data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367044#respond" onclick='return addComment.moveForm( "comment-367044", "367044", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-367053">
<div class="comment-container" id="li-comment-367053">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9323d8433eb6f7e121a501271be52139?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9323d8433eb6f7e121a501271be52139?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 13, 2016 at 12:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367053" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>These models do not predict, they extrapolate current value 1 step ahead in more or less obscured way. As seen on the pictures, prediction is just shifted original data. For this data one can achieve much better RMSE 33.7 without neural net, in just one line of code:</p>
<p>trainScore = math.sqrt(mean_squared_error(x[:-1], x[1:]))</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367053#respond" onclick='return addComment.moveForm( "comment-367053", "367053", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-367109">
<div class="comment-container" id="li-comment-367109">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 14, 2016 at 8:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367109" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alexander, thanks. </p>
<p>This is good motivation for me/community to go beyond making LSTMs “just work” for time series and dive into how to train LSTMs effectively and even competitively on even very simple problems. </p>
<p>It’s an exciting open challenge.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367109#respond" onclick='return addComment.moveForm( "comment-367109", "367109", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-367394">
<div class="comment-container" id="li-comment-367394">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cae442f26e783ab35a36e458264a5964?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cae442f26e783ab35a36e458264a5964?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leftriver</span>
<span class="date">October 18, 2016 at 12:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367394" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a nice tutorial for starters. Thank you.</p>
<p>However, I have some concerns about the <code>create_dataset</code> function. I think it just make a simple problem complicated (or even wrong).</p>
<p>When <code>look_back=1</code>, the function is simply equivalent to: dataX = dataset[:len(dataset)-look_back], dataY = dataset[look_back:].</p>
<p>When <code>look_back</code> is larger than 1, the function is wrong: after each iteration, <code>dataX</code> is appended by more than 1 data, but <code>dataY</code> is appended by just 1 data. Finally, dataX will be <code>look_back</code> times larger than dataY. </p>
<p>Is that what <code>create_dataset</code> supposed to do?</p>
<p>def create_dataset(dataset, look_back=1):<br/>
	dataX, dataY = [], []<br/>
	for i in range(len(dataset)-look_back-1):<br/>
		a = dataset[i:(i+look_back), 0]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back, 0])<br/>
	return numpy.array(dataX), numpy.array(dataY)</p>
<div class="reply">
<a aria-label="Reply to Leftriver" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367394#respond" onclick='return addComment.moveForm( "comment-367394", "367394", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-367789">
<div class="comment-container" id="li-comment-367789">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/10137757ee3cd44e5333c77b0cd50fdf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/10137757ee3cd44e5333c77b0cd50fdf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pang wenfeng</span>
<span class="date">October 21, 2016 at 3:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367789" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your great article! I have a question that when I use the model “Stacked LSTMs With Memory Between Batches” with my own data, I found that cpu is much faster than gpu.<br/>
May data contains many files and each files’ size is about 3M. I put  each file into the model to<br/>
trian one by one. I guess that the data is too small so the gpu is useless, but I can’t sure. I use thano backend and I can sure that the type of the data is float32. So I want to know what reason would make this happen, or the only reason is the data too small? Thank you very much and best wishes to you.</p>
<div class="reply">
<a aria-label="Reply to pang wenfeng" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367789#respond" onclick='return addComment.moveForm( "comment-367789", "367789", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-367883">
<div class="comment-container" id="li-comment-367883">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/46dd894b6e6fb5eae6f0f077d67cd64e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/46dd894b6e6fb5eae6f0f077d67cd64e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rajesh</span>
<span class="date">October 22, 2016 at 4:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367883" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Excellent tutorial. I am new to time series prediction. I have a basic question. In this example(international-airline-passengers) model predicted the values on test data from 1957-01 to 1960-12 time period.</p>
<p>How to predict the passengers in next one year from 1961-01 – 1961-12.</p>
<p>How to pass input values to model, so it will predict the passengers count in each month for next one year.</p>
<div class="reply">
<a aria-label="Reply to Rajesh" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367883#respond" onclick='return addComment.moveForm( "comment-367883", "367883", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-367985">
<div class="comment-container" id="li-comment-367985">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/46dd894b6e6fb5eae6f0f077d67cd64e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/46dd894b6e6fb5eae6f0f077d67cd64e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rajesh</span>
<span class="date">October 23, 2016 at 5:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367985" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Any inputs to solve below question</p>
<p>How to predict the passengers in next one year from 1961-01 – 1961-12.</p>
<p>Regards,<br/>
Rajesh</p>
<div class="reply">
<a aria-label="Reply to Rajesh" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367985#respond" onclick='return addComment.moveForm( "comment-367985", "367985", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-367902">
<div class="comment-container" id="li-comment-367902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">NicoAd</span>
<span class="date">October 22, 2016 at 8:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>“The dataset is available for free from the DataMarket webpage as a CSV download with the filename “international-airline-passengers.csv“.”</p>
<p>Not anymore I guess.</p>
<p>Any other way to get the file?</p>
<p>Thanks,<br/>
Nicolas</p>
<div class="reply">
<a aria-label="Reply to NicoAd" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367902#respond" onclick='return addComment.moveForm( "comment-367902", "367902", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-367956">
<div class="comment-container" id="li-comment-367956">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2016 at 10:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-367956" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is still available NicoAd.</p>
<p>Visit: <a href="https://datamarket.com/data/set/22u3/international-airline-passengers-monthly-totals-in-thousands-jan-49-dec-60" rel="nofollow">https://datamarket.com/data/set/22u3/international-airline-passengers-monthly-totals-in-thousands-jan-49-dec-60</a></p>
<p>Click “Export” on the left-hand side, and choose the CSV file format.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=367956#respond" onclick='return addComment.moveForm( "comment-367956", "367956", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-368411">
<div class="comment-container" id="li-comment-368411">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">NicoAd</span>
<span class="date">October 27, 2016 at 9:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368411" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks !</p>
<div class="reply">
<a aria-label="Reply to NicoAd" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368411#respond" onclick='return addComment.moveForm( "comment-368411", "368411", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-397509">
<div class="comment-container" id="li-comment-397509">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397509" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just a new location:</p>
<p><a href="https://github.com/ufal/npfl114/blob/master/labs06/international-airline-passengers.tsv" rel="nofollow">https://github.com/ufal/npfl114/blob/master/labs06/international-airline-passengers.tsv</a></p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397509#respond" onclick='return addComment.moveForm( "comment-397509", "397509", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-368109">
<div class="comment-container" id="li-comment-368109">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63d1b7a23b8eefd36b528619d1ce3160?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63d1b7a23b8eefd36b528619d1ce3160?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brian</span>
<span class="date">October 25, 2016 at 3:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368109" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Great article on LSTM and keras. I was really struggling with this, until I read through your examples. Now I have a much better understanding and can use LSTM on my own data.</p>
<p>One thing I’d like to point out. The reuse of trainY and trainX on lines 55 &amp; 57.<br/>
Line 55 trainY = scaler.inverse_transform([trainY])</p>
<p>This confused me a lot, because the model can’t run fit() or predict() again, after this is done.  I was struggling to understand why it could not do a second predict or fit. Until i very carefully read each line of code.  </p>
<p>I think renaming the above variables would make the example code clearer.</p>
<p>Unless I am missing something….. and being a novice programmer that’s very possible.</p>
<p>Thanks again for the great work.<br/>
Brian.</p>
<div class="reply">
<a aria-label="Reply to Brian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368109#respond" onclick='return addComment.moveForm( "comment-368109", "368109", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-368147">
<div class="comment-container" id="li-comment-368147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2016 at 8:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Brian, I’m glad the examples were useful to get you started.</p>
<p>Great point about remaining variables.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368147#respond" onclick='return addComment.moveForm( "comment-368147", "368147", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-368471">
<div class="comment-container" id="li-comment-368471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cec9a1fb9da33ddc3027589735867b43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cec9a1fb9da33ddc3027589735867b43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joaco</span>
<span class="date">October 28, 2016 at 12:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason, thank you for the example.<br/>
 I have used the method on my own data. The data is about the prediction of the average temperature per month. I want to predict more than one month. But I can only predict one month now. Because the inputs are X1 X2 X3, the result is only y. I want to kown how to modify the code to use ,like, X1 X2 X3 X4 X5 X6 to predict Y1 Y2 Y3.<br/>
I don’t know if I have made it clear. I hope you will help me.<br/>
Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Joaco" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368471#respond" onclick='return addComment.moveForm( "comment-368471", "368471", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-368549">
<div class="comment-container" id="li-comment-368549">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2016 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368549" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Joaco, that is a sequence to sequence problem. I will prepare an example soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368549#respond" onclick='return addComment.moveForm( "comment-368549", "368549", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-377886">
<div class="comment-container" id="li-comment-377886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 27, 2016 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Joaco,<br/>
 I am also looking forward to a similar example 🙂</p>
<p>Je</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377886#respond" onclick='return addComment.moveForm( "comment-377886", "377886", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-401052">
<div class="comment-container" id="li-comment-401052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Donato</span>
<span class="date">June 1, 2017 at 9:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry do you have prepare this example? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Donato" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401052#respond" onclick='return addComment.moveForm( "comment-401052", "401052", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-401234">
<div class="comment-container" id="li-comment-401234">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401234" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, see here:<br/>
<a href="http://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" rel="nofollow">http://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401234#respond" onclick='return addComment.moveForm( "comment-401234", "401234", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-368475">
<div class="comment-container" id="li-comment-368475">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/da128b3e9d8a74f3b3e02452a45bc8fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nida</span>
<span class="date">October 28, 2016 at 1:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368475" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice post Jason!<br/>
I read that GRU has a less complex architecture than the LSTM has, but many people still use LSTM for forecasting. I’d like to ask, what are the advantages LSTM compared to GRU? Thank you</p>
<div class="reply">
<a aria-label="Reply to Nida" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368475#respond" onclick='return addComment.moveForm( "comment-368475", "368475", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-368551">
<div class="comment-container" id="li-comment-368551">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2016 at 7:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368551" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Nida, I would defer to model skill in most circumstances, rather than concerns of computational complexity – unless that is a requirement of your project.</p>
<p>Agreed, we do want the simplest and best performing model possible, so perhaps evaluate GRUs and then see of LSTMs can out perform them on your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368551#respond" onclick='return addComment.moveForm( "comment-368551", "368551", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-368502">
<div class="comment-container" id="li-comment-368502">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/19bf0bfa08f9be3aebf3797e19996d9f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/19bf0bfa08f9be3aebf3797e19996d9f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://sty.nu/" rel="external nofollow">Tim</a></span>
<span class="date">October 28, 2016 at 9:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368502" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m a total newbie to Keras and LSTM and most things NN, but if you’ll excuse that, I’d like to run this idea past you just to see if I’m talking the same language let alone on the same page… :</p>
<p>I’m interested in time-series prediction, mostly stocks / commodities etc, and have encountered the same problem as others in these comments, namely, how is it prediction if it’s mostly constrained to within the time-span for which we already have data? </p>
<p>With most ML algorithms I could train the model and implement a shuffle, ie get the previous day’s prediction for today and append it in the input-variable column, get another prediction, … repeat. The worst that would happen is a little fudge around the last day in the learning dataset.<br/>
That seems rather laborious if we want to predict how expensive gold is going to be in 6 months’ time.<br/>
(Doubly so, since in other worlds (R + RSNNS + elman or jordan), the prediction is bound-up with training so a prediction would involve rebuilding the entire NN for every day’s result, but we digress.)</p>
<p>I saw somewhere Keras has a notion of “masking”, assigning a dummy value that tells the training the values are missing. Would it be possible to use this with LSTM, just append a bunch of 180 mask zeroes, let it train itself on this and then use the testing phase to impute the last values, thereby filling in the blanks for the next 6 months?</p>
<p>It would also be possible to run an ensemble of these models and draw a pretty graph similar to arima.predict with varying degrees of confidence as to what might happen. </p>
<p>Waffle ends.</p>
<div class="reply">
<a aria-label="Reply to Tim" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368502#respond" onclick='return addComment.moveForm( "comment-368502", "368502", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-368556">
<div class="comment-container" id="li-comment-368556">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 29, 2016 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368556" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting idea.</p>
<p>My thoughts go more towards updating the model. A great thing about neural nets is that they are updatable. This means that you can prepare just some additional training data for today/this week and update the weights with the new knowledge, rather than training them from scratch.</p>
<p>Again, the devil is in the detail and often updating may require careful tuning and perhaps balance of old data to avoid overfitting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368556#respond" onclick='return addComment.moveForm( "comment-368556", "368556", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-368710">
<div class="comment-container" id="li-comment-368710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/05dfcf8ac4213c650e6a299b2c539e34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/05dfcf8ac4213c650e6a299b2c539e34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lazaros</span>
<span class="date">October 30, 2016 at 6:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,</p>
<p>I am trying to implement your code in order to make forecasting on a time-series that i am receiving from a server. My only problem is that the length of my dataset is continuously increasing. Is there any way to read the last N rows from my csv file? What changes do i have to make in code below in order to succeed it. </p>
<p>def create_dataset(dataset, look_back=1):<br/>
		dataX, dataY = [], []<br/>
		for i in range(len(dataset)-look_back-1):<br/>
			a = dataset[i:(i+look_back), 0]<br/>
			dataX.append(a)<br/>
			dataY.append(dataset[i + look_back, 0])<br/>
		return numpy.array(dataX), numpy.array(dataY)<br/>
	# fix random seed for reproducibility<br/>
	numpy.random.seed(7)<br/>
	# load the dataset<br/>
	dataframe = pandas.read_csv(‘timeseries.csv’, usecols=[1], engine=’python’, skipfooter=3)<br/>
	dataset = dataframe.values<br/>
	dataset = dataset.astype(‘float32’)</p>
<div class="reply">
<a aria-label="Reply to Lazaros" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368710#respond" onclick='return addComment.moveForm( "comment-368710", "368710", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-368753">
<div class="comment-container" id="li-comment-368753">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2016 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-368753" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post might help with loading your CSV into memory:<br/>
<a href="http://machinelearningmastery.com/load-machine-learning-data-python/" rel="nofollow">http://machinelearningmastery.com/load-machine-learning-data-python/</a></p>
<p>If you load your data with Pandas, you can use DataFrame.tail() to select the last n records of your dataset, for example:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6592a008bc8700065937" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Load CSV using Pandas
from pandas import read_csv
filename = 'pima-indians-diabetes.csv'
names = ['preg', 'plas', 'pres', 'skin', 'test', 'mass', 'pedi', 'age', 'class']
data = read_csv(filename, names=names)
data = data.tail(10)
print(data.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6592a008bc8700065937-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6592a008bc8700065937-2">2</div><div class="crayon-num" data-line="crayon-5a6592a008bc8700065937-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6592a008bc8700065937-4">4</div><div class="crayon-num" data-line="crayon-5a6592a008bc8700065937-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6592a008bc8700065937-6">6</div><div class="crayon-num" data-line="crayon-5a6592a008bc8700065937-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6592a008bc8700065937-1"><span class="crayon-p"># Load CSV using Pandas</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6592a008bc8700065937-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a6592a008bc8700065937-3"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'pima-indians-diabetes.csv'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6592a008bc8700065937-4"><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'preg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'plas'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pres'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'skin'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'test'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mass'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'pedi'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'age'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'class'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6592a008bc8700065937-5"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-o">=</span><span class="crayon-v">names</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6592a008bc8700065937-6"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">tail</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6592a008bc8700065937-7"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=368753#respond" onclick='return addComment.moveForm( "comment-368753", "368753", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-369242">
<div class="comment-container" id="li-comment-369242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/412c6c968b08ee51a4d0af534e81ef82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/412c6c968b08ee51a4d0af534e81ef82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alisson Pereira</span>
<span class="date">November 3, 2016 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, I would like to use that your model. But the problem I am using sliding window size greater than one. Type {[x-2], [x-1], [x]} ==&gt; [x + 1]. But I found several problems in training. For example, when I turn your trainX in {[x-2], [x-1], [x]} and trainY in [x + 1], the keras tells me that the input and the target must have same size. Can you help me with this?</p>
<div class="reply">
<a aria-label="Reply to Alisson Pereira" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369242#respond" onclick='return addComment.moveForm( "comment-369242", "369242", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-369377">
<div class="comment-container" id="li-comment-369377">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2016 at 9:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369377" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Alisson, I think the error suggests that input and target do not have the same number of rows.</p>
<p>Check your prepared data, maybe even save it to file and look in a text editor or excel.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369377#respond" onclick='return addComment.moveForm( "comment-369377", "369377", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-370001">
<div class="comment-container" id="li-comment-370001">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/412c6c968b08ee51a4d0af534e81ef82?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/412c6c968b08ee51a4d0af534e81ef82?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alisson Pereira</span>
<span class="date">November 9, 2016 at 3:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370001" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thaks, Jason. I was able to solve my problem. But see, the use of the ReLu function in the memory cell and the sigmoid function on the output showed strange behavior. You have some experience with this setting.<br/>
Congratulations on the work, this page has helped me a lot.</p>
<div class="reply">
<a aria-label="Reply to Alisson Pereira" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370001#respond" onclick='return addComment.moveForm( "comment-370001", "370001", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-369347">
<div class="comment-container" id="li-comment-369347">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffa50b2ca24453993f3a1aaefc6db603?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffa50b2ca24453993f3a1aaefc6db603?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Soren</span>
<span class="date">November 4, 2016 at 2:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369347" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your great content.</p>
<p>As you did i upgraded to Keras 1.1.0 and scikit-learn v0.18. however i run Theano v.0.9.0dev3 as im on Windows 10. Also im on Anaconda 3.5. (installed from this article: <a href="http://ankivil.com/installing-keras-theano-and-dependencies-on-windows-10/" rel="nofollow">http://ankivil.com/installing-keras-theano-and-dependencies-on-windows-10/</a>)</p>
<p>Your examples run fine on my setup – but i seem to be getting slightly different results.</p>
<p>For eamples in your first example: # LSTM for international airline passengers problem with window regression framing – i get:</p>
<p>Train Score: 22.79 RMSE<br/>
Test Score: 48.80 RMSE</p>
<p>Should i be getting exact the same results as in your tutorial? If yes, any idea what i should be looking at changing?</p>
<p>Best regards<br/>
Soren</p>
<div class="reply">
<a aria-label="Reply to Soren" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369347#respond" onclick='return addComment.moveForm( "comment-369347", "369347", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-369388">
<div class="comment-container" id="li-comment-369388">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2016 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369388" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work Soren!</p>
<p>Don’t worry about small differences. It is hard to get 100% reproducible results with Keras/Theano/TensorFlow at the moment. I hope the community can work something out soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369388#respond" onclick='return addComment.moveForm( "comment-369388", "369388", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-369420">
<div class="comment-container" id="li-comment-369420">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dd6f3e9a3f441759db81c125a0d9d441?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dd6f3e9a3f441759db81c125a0d9d441?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pemfir</span>
<span class="date">November 4, 2016 at 2:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369420" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>great post ! thank you so much. I was wondering how can be adapt the code to make multiple-step-ahead prediction. One of the commenters suggested defining the out-put like [x(t+1),x(t+2),x(t+3),…x(t+n)] , but is there a way to make prediction recursively ? More specifically, to build an LSTM with only one output. We first predict x(t+1), then use the predicted x(t+1) as the input for the next time step to predict x(t+2) and continue doing so ‘n’ times.</p>
<div class="reply">
<a aria-label="Reply to pemfir" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369420#respond" onclick='return addComment.moveForm( "comment-369420", "369420", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-369542">
<div class="comment-container" id="li-comment-369542">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/555c3d8b8f3c8c238c132f8198010480?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/555c3d8b8f3c8c238c132f8198010480?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bill</span>
<span class="date">November 5, 2016 at 12:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369542" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>I am wondering how to apply LSTM to real time data. The first change I can see is the data normalisation. Concretely, a new sample could be well out of min max among previous observations. How would you go about this problem?</p>
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Bill" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369542#respond" onclick='return addComment.moveForm( "comment-369542", "369542", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-369606">
<div class="comment-container" id="li-comment-369606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cb9eb64d5c3757c7cfba93488e2697d8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cb9eb64d5c3757c7cfba93488e2697d8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Noque</span>
<span class="date">November 6, 2016 at 2:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could it be that in:</p>
<p># calculate root mean squared error<br/>
math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))</p>
<p>you mean :</p>
<p># calculate root mean squared error<br/>
trainScore = math.sqrt(mean_squared_error(trainY[:], trainPredict[:,0]))</p>
<div class="reply">
<a aria-label="Reply to Noque" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369606#respond" onclick='return addComment.moveForm( "comment-369606", "369606", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-376596">
<div class="comment-container" id="li-comment-376596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b96b2be523053a1e9b5234a350d958f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b96b2be523053a1e9b5234a350d958f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kit</span>
<span class="date">December 21, 2016 at 9:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>trainY is an array of (one) array. Compare:</p>
<p>print len(trainYi[0]) # 720<br/>
print len(trainYi[:]) # 1</p>
<p>print len(trainPredict[:,0]) # 720</p>
<p>So the original code is the right one.</p>
<div class="reply">
<a aria-label="Reply to Kit" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376596#respond" onclick='return addComment.moveForm( "comment-376596", "376596", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-369618">
<div class="comment-container" id="li-comment-369618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63943354e49cfb6883a28181808e27ae?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63943354e49cfb6883a28181808e27ae?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sherlockatszx</span>
<span class="date">November 6, 2016 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason, i got a question,that have stacked me for many days,how can i add hidden layer into the LSTM model(By using model.add(LSTM()).what i tried : say ,in your first code example,  I assume ‘model.add(LSTM(4, input_dim=look_back))’ this line was to create a hidden layer in the LSTM model. So i thought:oh , 1 hidden layer is so easy , why don’t add one hidden layer into it .So i try to add one layer. After the code:’model.add(LSTM(4, input_dim=look_back))’ , i try many ways to insert one hidden layer , such as : just copy model.add(LSTM(4,input_dim=look_back)) and insert after it . I try many ways ,but it always got the error that got the wrong input _ dimension. So can you show me how to add one hidden layer in example 1st . Or , i don’t got the LSTM model right ,it can’t be inserted ?</p>
<div class="reply">
<a aria-label="Reply to sherlockatszx" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369618#respond" onclick='return addComment.moveForm( "comment-369618", "369618", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-369741">
<div class="comment-container" id="li-comment-369741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2016 at 7:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See the section titled “Stacked LSTMs With Memory Between Batches”.</p>
<p>It gives an example of multiple hidden layers in an LSTM network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369741#respond" onclick='return addComment.moveForm( "comment-369741", "369741", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-369770">
<div class="comment-container" id="li-comment-369770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63943354e49cfb6883a28181808e27ae?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63943354e49cfb6883a28181808e27ae?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sherlockatszx</span>
<span class="date">November 7, 2016 at 1:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks . I got that.<br/>
However, I got another question: compared to the other article you published ‘time series prediction with deep learning ‘(<a href="http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/?utm_source=tuicool&amp;utm_medium=referral" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/?utm_source=tuicool&amp;utm_medium=referral</a>) , It seems that ‘LSTM’ model doesn’t predict as well as the simple neurons. Does that mean LSTM may not a good choice for some specific time series structure?</p>
<div class="reply">
<a aria-label="Reply to sherlockatszx" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369770#respond" onclick='return addComment.moveForm( "comment-369770", "369770", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-369862">
<div class="comment-container" id="li-comment-369862">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 8, 2016 at 9:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369862" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would not agree, these are just demonstration projects and were not optimized for top performance. </p>
<p>These examples show how LSTMs could be used for time series projects (and how to use MLPs for time series projects), but not optimally tuned for the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369862#respond" onclick='return addComment.moveForm( "comment-369862", "369862", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-369963">
<div class="comment-container" id="li-comment-369963">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cb9eb64d5c3757c7cfba93488e2697d8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cb9eb64d5c3757c7cfba93488e2697d8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Noque</span>
<span class="date">November 9, 2016 at 1:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-369963" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, great post! Thanks</p>
<p>How could I set the input if I have several observations (time series) with same length of the same feature and I want to predict t+1? Would I concatenate them all? In that case the last sample of one observation would predict the first one of the next.. Or should I explicitly assign the length of each time series to the batch_size?</p>
<div class="reply">
<a aria-label="Reply to Noque" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=369963#respond" onclick='return addComment.moveForm( "comment-369963", "369963", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-370181">
<div class="comment-container" id="li-comment-370181">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/acf5262588a322a9b732a8c44c970add?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/acf5262588a322a9b732a8c44c970add?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mauro</span>
<span class="date">November 10, 2016 at 9:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370181" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, you’re predicting one day after your last entry, if i want to predict a day five days after what should i do?</p>
<div class="reply">
<a aria-label="Reply to Mauro" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370181#respond" onclick='return addComment.moveForm( "comment-370181", "370181", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-370261">
<div class="comment-container" id="li-comment-370261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 11, 2016 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Mauro, that would be a sequence to sequence prediction.</p>
<p>Sorry, I don’t have an example just yet.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370261#respond" onclick='return addComment.moveForm( "comment-370261", "370261", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-370756">
<div class="comment-container" id="li-comment-370756">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/18238d1c5ecb5b4c93cac90f6551f8a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/18238d1c5ecb5b4c93cac90f6551f8a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ron</span>
<span class="date">November 16, 2016 at 7:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370756" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi</p>
<p>This is a great example. I am quite new in deep learning and keras. But this website has been very helpful. I want to learn more.</p>
<p>Like many commenters, I am also requesting to find out: how to predict future time periods. Is that possible? How can I achieve this using the example above? If there are multiple series or Ys and there are categorical predictors, how can I accomodate that?</p>
<p>Please help, and am very keen to learn this via other channels in this website if required. Please let me know.</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Ron" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370756#respond" onclick='return addComment.moveForm( "comment-370756", "370756", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-370794">
<div class="comment-container" id="li-comment-370794">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2016 at 9:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370794" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The example does indeed predict future values.</p>
<p>You can adapt the example and call model.predict to make a prediction for new data, rather than just evaluate the performance of predictions on new data as in the example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370794#respond" onclick='return addComment.moveForm( "comment-370794", "370794", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-370895">
<div class="comment-container" id="li-comment-370895">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nico AD</span>
<span class="date">November 17, 2016 at 3:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370895" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>I tried to predict future values, but have trouble finding the right way to do it</p>
<p>I work with the window method so my current data à t-3 t-2 t-1 t looks like this</p>
<p>[100,110,108]</p>
<p>If I try </p>
<p>data = [[100,110,108]]</p>
<p>model.predict(data) </p>
<p>I get the following error :</p>
<p>Attribute error : ‘list’ object has no attribute “shape”</p>
<p>I guess the format is not correct, and I need sort of reshape.</p>
<p>but for me the line</p>
<p>trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1])) is not clear.</p>
<p>and if I try to apply the same transform on my new data I get this error :</p>
<p>IndexError : tuple index out of range</p>
<p>could you provide an exemple dealing with new data ?</p>
<p>Thanks !</p>
<div class="reply">
<a aria-label="Reply to Nico AD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370895#respond" onclick='return addComment.moveForm( "comment-370895", "370895", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-370901">
<div class="comment-container" id="li-comment-370901">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nico AD</span>
<span class="date">November 17, 2016 at 3:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370901" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think I almost here but still have a last error (my window side is 8)</p>
<p>todayData = numpy.array([[1086.22,827.62,702.94,779.5,711.8399999999999,1181.25,1908.69,2006.39]])<br/>
todayData = todayData.astype(‘float32’)<br/>
todayData = scaler.fit_transform(todayData)<br/>
print “todayData scaled ” + str(todayData)</p>
<p>todayData = scaler.inverse_transform(todayData)<br/>
print “todayData inversed ” + str(todayData)<br/>
todayData = numpy.reshape(todayData, (todayData.shape[0], 1, todayData.shape[1]))</p>
<p>predictTomorrow = model.predict(todayData)<br/>
predictTomorrow = scaler.inverse_transform([predictTomorrow])<br/>
print “prediction” + str(predictTomorrow)</p>
<p>the inverse_transform line on predictTomorrow generate the following error</p>
<p>ValueError : Found array with dim 3 . Estimator expected &lt;= 2</p>
<p>again a reshape issue 🙁</p>
<div class="reply">
<a aria-label="Reply to Nico AD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370901#respond" onclick='return addComment.moveForm( "comment-370901", "370901", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-370934">
<div class="comment-container" id="li-comment-370934">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 17, 2016 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370934" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am working on a new example Nico, it may be a new blog post.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370934#respond" onclick='return addComment.moveForm( "comment-370934", "370934", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-371553">
<div class="comment-container" id="li-comment-371553">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nico AD</span>
<span class="date">November 22, 2016 at 8:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371553" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks Jason. I tried various things with no luck. for me some part of the tutorial (like the reshape part / scaling ) are pure magic 🙂 trying to get some help from the keras community on gitter 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-371598">
<div class="comment-container" id="li-comment-371598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3d203b7c730fc1d54078c17b65f2492b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nico AD</span>
<span class="date">November 23, 2016 at 2:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>finally got it , I need to reshape in  (1,1,8) ( where 8 is the look_back size)</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-371695">
<div class="comment-container" id="li-comment-371695">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2016 at 9:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371695" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done Nico.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-370757">
<div class="comment-container" id="li-comment-370757">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/18238d1c5ecb5b4c93cac90f6551f8a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/18238d1c5ecb5b4c93cac90f6551f8a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ron</span>
<span class="date">November 16, 2016 at 7:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370757" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Which book gives complete examples/codes with time series keras? I want to predict future time periods ahead and want add other predictor variables? Is that achievable? </p>
<p>Please let me know if you have any resources / book that I can purchase.</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Ron" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370757#respond" onclick='return addComment.moveForm( "comment-370757", "370757", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-370795">
<div class="comment-container" id="li-comment-370795">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2016 at 9:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-370795" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Deep Learning With Python:<br/>
<a href="https://machinelearningmastery.com/deep-learning-with-python/" rel="nofollow">https://machinelearningmastery.com/deep-learning-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=370795#respond" onclick='return addComment.moveForm( "comment-370795", "370795", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-371177">
<div class="comment-container" id="li-comment-371177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sarah</span>
<span class="date">November 19, 2016 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thank you for your great tutorial,<br/>
I have a question about number of features. How could I have input with 5 variables?</p>
<p>Thank you in advance</p>
<p>Sarah</p>
<div class="reply">
<a aria-label="Reply to Sarah" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371177#respond" onclick='return addComment.moveForm( "comment-371177", "371177", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-371196">
<div class="comment-container" id="li-comment-371196">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 19, 2016 at 8:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371196" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sarah, LSTMs take input in the form [samples, timesteps, features], e.g. [n, 1, 5].</p>
<p>You can prepare your data in this way, then set the input configuration of your network appropriately, e.g. input_dim=5.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371196#respond" onclick='return addComment.moveForm( "comment-371196", "371196", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-371212">
<div class="comment-container" id="li-comment-371212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d1d9dbc4b9be435853c9f8ffb813ff71?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d1d9dbc4b9be435853c9f8ffb813ff71?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">November 19, 2016 at 1:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice tutorial, thanks.<br/>
I think the line<br/>
for i in range(len(dataset)-look_back-1):<br/>
should be<br/>
for i in range(len(dataset)-(look_back-1)):</p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371212#respond" onclick='return addComment.moveForm( "comment-371212", "371212", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-371214">
<div class="comment-container" id="li-comment-371214">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d1d9dbc4b9be435853c9f8ffb813ff71?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d1d9dbc4b9be435853c9f8ffb813ff71?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">November 19, 2016 at 1:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371214" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually, I think its<br/>
<code>for i in range(len(dataset)-look_back):</code><br/>
and<br/>
<code>testPredictPlot[train_size+(look_back-1):len(dataset)-1, :] = testPredict</code></p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371214#respond" onclick='return addComment.moveForm( "comment-371214", "371214", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-371481">
<div class="comment-container" id="li-comment-371481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2016 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Adam, I’ll take a look.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371481#respond" onclick='return addComment.moveForm( "comment-371481", "371481", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-371684">
<div class="comment-container" id="li-comment-371684">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffbea40ff9de47daa66cc74dec01bffe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffbea40ff9de47daa66cc74dec01bffe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ben</span>
<span class="date">November 23, 2016 at 8:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371684" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Adam, nice blog ! I only have a small suggestion for shifting data: use the shift() method from pandas. Cheers</p>
<div class="reply">
<a aria-label="Reply to Ben" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371684#respond" onclick='return addComment.moveForm( "comment-371684", "371684", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-371702">
<div class="comment-container" id="li-comment-371702">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2016 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371702" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great suggestion Ben. I have been using this myself recent to create a lagged dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371702#respond" onclick='return addComment.moveForm( "comment-371702", "371702", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-371771">
<div class="comment-container" id="li-comment-371771">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="external nofollow">Weixian</a></span>
<span class="date">November 23, 2016 at 3:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371771" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>As i am new to RNN, i would like to ask about the difference in stateful:</p>
<p>for i in range(100):<br/>
	model.fit(trainX, trainY, nb_epoch=1, batch_size=batch_size, verbose=2, shuffle=False)<br/>
	model.reset_states()</p>
<p>and the stateless:</p>
<p>model.fit(trainX, trainY, nb_epoch=100, batch_size=1, verbose=2)</p>
<p>Do the range of 100(nb_epoch=1) the same as nb_epoch=100?<br/>
What is the difference between these 2?</p>
<div class="reply">
<a aria-label="Reply to Weixian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371771#respond" onclick='return addComment.moveForm( "comment-371771", "371771", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-371933">
<div class="comment-container" id="li-comment-371933">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2016 at 10:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371933" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question Weixian.</p>
<p>In the stateful case, we are running each epoch manually and resetting the state of the network at the end of each epoch.</p>
<p>In the stateless case, we let the Keras infrastructure run the loop over epochs for us and we’re not concerned with resetting network state.</p>
<p>I hope that is clear.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371933#respond" onclick='return addComment.moveForm( "comment-371933", "371933", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-371983">
<div class="comment-container" id="li-comment-371983">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="external nofollow">Weixian</a></span>
<span class="date">November 24, 2016 at 4:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371983" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the reply.</p>
<p>In this case for the stateful:<br/>
if i reset the network, would the next input from the last trained epoch?</p>
<p>For the stateless:<br/>
Does it loop from the epochs that was previously trained?</p>
<p>How does the 2 affect the data trained or tested?</p>
<div class="reply">
<a aria-label="Reply to Weixian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371983#respond" onclick='return addComment.moveForm( "comment-371983", "371983", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-372186">
<div class="comment-container" id="li-comment-372186">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 25, 2016 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372186" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t understand your questions. Perhaps you could provide more context?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372186#respond" onclick='return addComment.moveForm( "comment-372186", "372186", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-372741">
<div class="comment-container" id="li-comment-372741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a91d41abf12e584a0db66d590dfdaaa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="external nofollow">Weixian</a></span>
<span class="date">November 28, 2016 at 7:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>stateful:<br/>
I mean like the training results of the last epoch [Y1] output  for example A<br/>
Would the [X2] input of the network be A from the last epoch?</p>
<p>Stateless:<br/>
How would the top situation be different from the epoch=2?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-372816">
<div class="comment-container" id="li-comment-372816">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2016 at 8:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372816" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you need to have the same inputs in both cases. The difference is the LSTM is maintaining some internal state when stateful.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-371797">
<div class="comment-container" id="li-comment-371797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/26ee5dc77a8cc29aa33495e584d0e48b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/26ee5dc77a8cc29aa33495e584d0e48b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Quinn</span>
<span class="date">November 23, 2016 at 5:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
Thank you for your LSTM tutorial.</p>
<p>But i found that an error always occurred, when i ran the first code in ‘model.add(LSTM(4, input_dim=look_back))’</p>
<p>The error is : TypeError: super() argument 1 must be type, not None</p>
<p>So, why?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Quinn" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371797#respond" onclick='return addComment.moveForm( "comment-371797", "371797", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-371934">
<div class="comment-container" id="li-comment-371934">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2016 at 10:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371934" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Check your white space Quinn, it’s possible to let extra white space sneak in when doing the copy-paste.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371934#respond" onclick='return addComment.moveForm( "comment-371934", "371934", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-371822">
<div class="comment-container" id="li-comment-371822">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://vedhaspandit.blogspot.com" rel="external nofollow">Vedhas</a></span>
<span class="date">November 23, 2016 at 9:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371822" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many thanks for this article. I am trying to wrap my head around </p>
<p>trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))<br/>
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))</p>
<p>(from LSTM for Regression with Time Steps section), since this is exactly what I need.</p>
<p>Let’s say I have 4 videos (prefix v) , of different lengths (say, 2,3,1 sec) (prefix t) , and for every 1 sec, I get a feature vector of length 3 (prefix f).</p>
<p>So, as I understand my trainX would be like this, right? –&gt;</p>
<p>trainX=np.array (<br/>
[  </p>
<p>[  [v1_t1_f1, v1_t1_f2, v1_t1_f3],<br/>
[v1_t2_f1, v1_t2_f2, v1_t2_f3]    ],</p>
<p>[ [v2_t1_f1, v2_t1_f2, v2_t1_f3],<br/>
[v2_t2_f1, v2_t2_f2, v2_t2_f3],<br/>
[v2_t3_f1, v2_t3_f2, v2_t3_f3],  ],</p>
<p>[ [v3_t1_f1, v3_t1_f2, v3_t1_f3] ] )<br/>
]<br/>
(=[ [v1], [v2], [v3] ], and v is Nt x Nf python list?)</p>
<p>If I have v1, v2,v3, how do I start with an **empty** xTrain and update them **recursively** to xTrain, so that xTrain can be used by Keras?</p>
<p>I have tried np.append, np.insert, np.stack methods, but no success as yet, I always get some error. Kindly help!!!</p>
<div class="reply">
<a aria-label="Reply to Vedhas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371822#respond" onclick='return addComment.moveForm( "comment-371822", "371822", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-371830">
<div class="comment-container" id="li-comment-371830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://vedhaspandit.blogspot.com" rel="external nofollow">Vedhas</a></span>
<span class="date">November 23, 2016 at 10:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If I make my ‘v1′,’v2′,v3′ ..’v19’ as np arrays, and trainX as a list =[ v1, v2, v3…v19 ] using trainX.append(vn) –&gt; and eventually outside of for loop: trainX=np.array(trainX), I get following error.</p>
<p>File “/usr/local/lib/python2.7/dist-packages/keras/engine/training.py”, line 100, in standardize_input_data<br/>
str(array.shape))<br/>
Exception: Error when checking model input: expected lstm_input_1 to have 3 dimensions, but got array with shape (19, 1)</p>
<p>Which makes sense since, Keras must be expecting input to have 3 dimensions = (sample,tstep, features).</p>
<p>But how do I fix this???</p>
<p>Your comment is awaiting moderation.</p>
<div class="reply">
<a aria-label="Reply to Vedhas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371830#respond" onclick='return addComment.moveForm( "comment-371830", "371830", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-371829">
<div class="comment-container" id="li-comment-371829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://vedhaspandit.blogspot.com" rel="external nofollow">Vedhas</a></span>
<span class="date">November 23, 2016 at 10:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-371829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If I make my ‘v1′,’v2′,v3′ ..’v19’ as np arrays, and trainX as a list =[ v1, v2, v3…v19 ] using  trainX.append(vn) –&gt; and eventually outside of for loop: trainX=np.array(trainX), I get following error.</p>
<p> File “/usr/local/lib/python2.7/dist-packages/keras/engine/training.py”, line 100, in standardize_input_data<br/>
    str(array.shape))<br/>
Exception: Error when checking model input: expected lstm_input_1 to have 3 dimensions, but got array with shape (19, 1)</p>
<p>Which makes sense since, Keras must be expecting input to have 3 dimensions = (sample,tstep, features). </p>
<p>But how do I fix this???</p>
<div class="reply">
<a aria-label="Reply to Vedhas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=371829#respond" onclick='return addComment.moveForm( "comment-371829", "371829", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-372213">
<div class="comment-container" id="li-comment-372213">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9e8abedd3869110de46326844be84067?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9e8abedd3869110de46326844be84067?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ilias</span>
<span class="date">November 25, 2016 at 12:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372213" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Guestion about the stateful data representation.<br/>
If I understood correctly prepare_data makes repeats the previous look_back sequences.<br/>
For example the original data<br/>
1<br/>
2<br/>
3<br/>
4<br/>
5<br/>
6</p>
<p>will become<br/>
1 2 3 -&gt; 4<br/>
2 3 4 -&gt;5<br/>
3 4 5 -&gt;6</p>
<p>Then when you reshape for the stateful LSTM don’t you feed these sequences like this ?<br/>
batch 1 sequences  [ 1, 2, 3] -&gt; predict 4<br/>
batch 2 sequences  [ 2, 3, 4] -&gt; predict 5<br/>
batch 3 sequences  [ 3, 4, 5] -&gt; predict 6</p>
<p>In the stateful RNN shouldn’t it be two batches only that continue one from the next:<br/>
batch 1 sequences  [ 1, 2, 3] -&gt; predict 4<br/>
batch 2 sequences  [ 3, 4, 5] -&gt; predict 6</p>
<p>Or alternatively you can have it to return the full state and predict all of them<br/>
batch 1 sequences  [ 1, 2, 3] -&gt; predict [2, 3, 4]<br/>
batch 2 sequences  [ 3, 4, 5] -&gt; predict [4, 5, 6]</p>
<p>Thanks,<br/>
Ilias</p>
<div class="reply">
<a aria-label="Reply to Ilias" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372213#respond" onclick='return addComment.moveForm( "comment-372213", "372213", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-372214">
<div class="comment-container" id="li-comment-372214">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9e8abedd3869110de46326844be84067?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9e8abedd3869110de46326844be84067?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ilias</span>
<span class="date">November 25, 2016 at 12:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372214" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry i mean for the stateful RNN<br/>
batch 1 sequences [ 1, 2, 3] -&gt; predict 4<br/>
batch 2 sequences [ 4, 5, 6] -&gt; predict 7 (not 3,4,5)</p>
<div class="reply">
<a aria-label="Reply to Ilias" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372214#respond" onclick='return addComment.moveForm( "comment-372214", "372214", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-372278">
<div class="comment-container" id="li-comment-372278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luca</span>
<span class="date">November 25, 2016 at 8:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi!<br/>
First of all, thanks for the tutorial. I’m trying to predict data that are very similar to the example ones. I was playing with the code you gave, but then something very strange happened: if I fit a model using the flight data and i use those hyper parameters to predict white noise I receive a very accurate results. Example:</p>
<p>#Data Generation:</p>
<p>dataset = numpy.random.randint(500, size=(200,1))<br/>
dataset = dataset.astype(‘float32’)</p>
<p>#Data Prediction:</p>
<p>scaler = MinMaxScaler(feature_range=(0, 1))<br/>
dataset = scaler.fit_transform(dataset)</p>
<p>prediction in red:</p>
<p><a href="https://s17.postimg.org/oavua7uq7/download.png" rel="nofollow">https://s17.postimg.org/oavua7uq7/download.png</a></p>
<p>How could that be possible? White noise should be not predictable, what am I doing wrong?</p>
<div class="reply">
<a aria-label="Reply to Luca" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372278#respond" onclick='return addComment.moveForm( "comment-372278", "372278", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-372282">
<div class="comment-container" id="li-comment-372282">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luca</span>
<span class="date">November 25, 2016 at 8:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372282" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, i was doing something very stupid, just ignore my latest post.</p>
<p>Cheers</p>
<div class="reply">
<a aria-label="Reply to Luca" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372282#respond" onclick='return addComment.moveForm( "comment-372282", "372282", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-372293">
<div class="comment-container" id="li-comment-372293">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3fe641a6a3acaaede04ec4a239f78e41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luca</span>
<span class="date">November 25, 2016 at 10:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372293" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ok, sorry again for the last correction, the result was obtained using:</p>
<p>plt.plot(dataset,”b”,model.predict(dataset[:,:,numpy.newaxis]),”r”)</p>
<p>so I’am actually predicting white noise, how could that be possible?</p>
<div class="reply">
<a aria-label="Reply to Luca" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372293#respond" onclick='return addComment.moveForm( "comment-372293", "372293", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-372371">
<div class="comment-container" id="li-comment-372371">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 26, 2016 at 10:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372371" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Luca, glad you’re making progress.</p>
<p>If results are too good to be true, they usually are. There will be a bug somewhere.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372371#respond" onclick='return addComment.moveForm( "comment-372371", "372371", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-372747">
<div class="comment-container" id="li-comment-372747">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vedhas</span>
<span class="date">November 28, 2016 at 10:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372747" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Kindly reply to my question above as well, please?</p>
<p>How do I shape trainX for 4 videos (v1,..v4) , of different lengths (2,3,1 sec) and for every 1 sec, I get a feature vector [f1 f2 f3] ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-372818">
<div class="comment-container" id="li-comment-372818">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2016 at 8:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372818" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have examples of working with video data. Hopefully soon.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-372944">
<div class="comment-container" id="li-comment-372944">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/44d0c02ff389748e58f26cb99d87a86b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vedhas</span>
<span class="date">November 30, 2016 at 4:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372944" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>oh, it is not about videos.. Question is about ‘instances/samples’ in general…<br/>
I am saying,<br/>
Instance1 through instance4 correspond to 2,3,1,5 feature vectors in time respectively, each of dimension 3. How do I shape these to train LSTM?</p>
<p>That is the whole idea behind the section “LSTM for Regression with Time Steps” above, right?</p>
<p>Features of instance1 should not be considered when training LSTM on instance2! Just as your paragraph says:</p>
<p>“Some sequence problems may have a varied number of time steps per sample. For example, you may have measurements of a physical machine leading up to a point of failure or a point of surge. Each incident would be a sample the observations that lead up to the event would be the time steps, and the variables observed would be the features.”</p>
<p>I don’t need *examples of working with video data.* Kindly advise only on how to shape trainX I mentioned above.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-376228">
<div class="comment-container" id="li-comment-376228">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a2c8293711c438a8fd3ee9d39803e330?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a2c8293711c438a8fd3ee9d39803e330?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shu</span>
<span class="date">December 20, 2016 at 3:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376228" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>look careful, isn’t there +1 shift in your white noise prediction? )))<br/>
same as in charts in tutorial?<br/>
best prediction for weather tomorrow is: it’ll be exact the same as today. see?</p>
<div class="reply">
<a aria-label="Reply to Shu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376228#respond" onclick='return addComment.moveForm( "comment-376228", "376228", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-372560">
<div class="comment-container" id="li-comment-372560">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/236a49e0b91ead97e45054264dd38e80?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/236a49e0b91ead97e45054264dd38e80?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Prakash</span>
<span class="date">November 27, 2016 at 1:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372560" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see many factors for your handling this time series prediction:</p>
<p>-Number of LSTM blocks<br/>
-Lookback number<br/>
-Epochs<br/>
-Activation<br/>
-Optimizer</p>
<p>Can you show the order of importance for these in creating a prediction model? Also, you have chosen 4 LSTM blocks, any reason for this?</p>
<div class="reply">
<a aria-label="Reply to Prakash" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372560#respond" onclick='return addComment.moveForm( "comment-372560", "372560", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-372663">
<div class="comment-container" id="li-comment-372663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2016 at 8:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Prakash. I would say framing of the problem and network topology as the biggest levers.</p>
<p>I have more info on improving performance in deep learning here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<p>I chose 4 neurons (memory modules) with a little trial and error.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372663#respond" onclick='return addComment.moveForm( "comment-372663", "372663", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-372909">
<div class="comment-container" id="li-comment-372909">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3840fa4131978d58ac34a406583e6ec2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3840fa4131978d58ac34a406583e6ec2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">C</span>
<span class="date">November 30, 2016 at 12:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-372909" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
When I try your “Stacked LSTMs with Memory Between Batches” example as it is, I found the following error. I wonder if you could help to explain what went wrong and how to rectify it please?<br/>
Thank you.</p>
<p>ValueError                                Traceback (most recent call last)<br/>
 in ()<br/>
     41 model = Sequential()<br/>
     42 model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True, return_sequences=True))<br/>
—&gt; 43 model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True))<br/>
     44 model.add(Dense(1))<br/>
     45 model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/models.py in add(self, layer)<br/>
    322                  output_shapes=[self.outputs[0]._keras_shape])<br/>
    323         else:<br/>
–&gt; 324             output_tensor = layer(self.outputs[0])<br/>
    325             if type(output_tensor) is list:<br/>
    326                 raise Exception(‘All layers in a Sequential model ‘</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/engine/topology.py in __call__(self, x, mask)<br/>
    515         if inbound_layers:<br/>
    516             # This will call layer.build() if necessary.<br/>
–&gt; 517             self.add_inbound_node(inbound_layers, node_indices, tensor_indices)<br/>
    518             # Outputs were already computed when calling self.add_inbound_node.<br/>
    519             outputs = self.inbound_nodes[-1].output_tensors</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/engine/topology.py in add_inbound_node(self, inbound_layers, node_indices, tensor_indices)<br/>
    569         # creating the node automatically updates self.inbound_nodes<br/>
    570         # as well as outbound_nodes on inbound layers.<br/>
–&gt; 571         Node.create_node(self, inbound_layers, node_indices, tensor_indices)<br/>
    572<br/>
    573     def get_output_shape_for(self, input_shape):</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/engine/topology.py in create_node(cls, outbound_layer, inbound_layers, node_indices, tensor_indices)<br/>
    153<br/>
    154         if len(input_tensors) == 1:<br/>
–&gt; 155             output_tensors = to_list(outbound_layer.call(input_tensors[0], mask=input_masks[0]))<br/>
    156             output_masks = to_list(outbound_layer.compute_mask(input_tensors[0], input_masks[0]))<br/>
    157             # TODO: try to auto-infer shape if exception is raised by get_output_shape_for.</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/layers/recurrent.py in call(self, x, mask)<br/>
    225                                              constants=constants,<br/>
    226                                              unroll=self.unroll,<br/>
–&gt; 227                                              input_length=input_shape[1])<br/>
    228         if self.stateful:<br/>
    229             updates = []</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/keras/backend/tensorflow_backend.py in rnn(step_function, inputs, initial_states, go_backwards, mask, constants, unroll, input_length)<br/>
   1304             loop_vars=(time, output_ta) + states,<br/>
   1305             parallel_iterations=32,<br/>
-&gt; 1306             swap_memory=True)<br/>
   1307         last_time = final_outputs[0]<br/>
   1308         output_ta = final_outputs[1]</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py in while_loop(cond, body, loop_vars, shape_invariants, parallel_iterations, back_prop, swap_memory, name)<br/>
   2634     context = WhileContext(parallel_iterations, back_prop, swap_memory, name)<br/>
   2635     ops.add_to_collection(ops.GraphKeys.WHILE_CONTEXT, context)<br/>
-&gt; 2636     result = context.BuildLoop(cond, body, loop_vars, shape_invariants)<br/>
   2637     return result<br/>
   2638 </p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py in BuildLoop(self, pred, body, loop_vars, shape_invariants)<br/>
   2467       self.Enter()<br/>
   2468       original_body_result, exit_vars = self._BuildLoop(<br/>
-&gt; 2469           pred, body, original_loop_vars, loop_vars, shape_invariants)<br/>
   2470     finally:<br/>
   2471       self.Exit()</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py in _BuildLoop(self, pred, body, original_loop_vars, loop_vars, shape_invariants)<br/>
   2448     for m_var, n_var in zip(merge_vars, next_vars):<br/>
   2449       if isinstance(m_var, ops.Tensor):<br/>
-&gt; 2450         _EnforceShapeInvariant(m_var, n_var)<br/>
   2451<br/>
   2452     # Exit the loop.</p>
<p>/home/nbuser/anaconda3_410/lib/python3.5/site-packages/tensorflow/python/ops/control_flow_ops.py in _EnforceShapeInvariant(merge_var, next_var)<br/>
    584           “Provide shape invariants using either the <code>shape_invariants</code> ”<br/>
    585           “argument of tf.while_loop or set_shape() on the loop variables.”<br/>
–&gt; 586           % (merge_var.name, m_shape, n_shape))<br/>
    587   else:<br/>
    588     if not isinstance(var, (ops.IndexedSlices, sparse_tensor.SparseTensor)):</p>
<p>ValueError: The shape for while_2/Merge_2:0 is not an invariant for the loop. It enters the loop with shape (1, 4), but has shape (?, 4) after one iteration. Provide shape invariants using either the <code>shape_invariants</code> argument of tf.while_loop or set_shape() on the loop variables.</p>
<div class="reply">
<a aria-label="Reply to C" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=372909#respond" onclick='return addComment.moveForm( "comment-372909", "372909", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-373249">
<div class="comment-container" id="li-comment-373249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b3b7d4552ec1688ae90202d77b70d16d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b3b7d4552ec1688ae90202d77b70d16d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 1, 2016 at 8:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-373249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason.<br/>
Thank you for your LSTM tutorial! I would like to use it to do some predictions, however, the input_dim is two variables, and the output_dim is one, just like:  input: x(t) y(t) output: y(t+1) .I have known that you answered it with the window method. I still have no idea, any suggestions?</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=373249#respond" onclick='return addComment.moveForm( "comment-373249", "373249", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-373327">
<div class="comment-container" id="li-comment-373327">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b869c1376d634924b0173dc4e355a9a9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b869c1376d634924b0173dc4e355a9a9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Benjamin S. Skrainka</span>
<span class="date">December 2, 2016 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-373327" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is an informative and fun article.  Thanks!</p>
<p>However, for this application, ARIMA and exponential smoothing perform better out of the box without any tuning.</p>
<p><code></code><code><br/>
# Compare ARIMA vs. NN</code></p>
<p>library(forecast)<br/>
library(ModelMetrics)</p>
<p>df.raw &lt;- read.csv('international-airline-passengers.csv', stringsAsFactors=FALSE)<br/>
df &lt;- ts(df.raw[,2], start=c(1949,1), end=c(1960,12), frequency=12)</p>
<p># Same train/test split as example<br/>
train.size &lt;- floor(length(df) * 0.67)<br/>
ts.train &lt;- ts(df[1:train.size], start=c(1949,1), frequency=12)<br/>
ts.test &lt;- ts(df[(train.size+1):length(df)], end=c(1960,12), frequency=12)</p>
<p>ts.fit &lt;- auto.arima(ts.train)<br/>
ets.fit &lt;- ets(ts.train)</p>
<p>fcast &lt;- forecast(ts.fit, 4*12)<br/>
y_hat &lt;- fcast$mean</p>
<p># Simple ARIMA vs. NN has RMSE = 8.83/26.47 vs. 22.61/51.58 for train/test<br/>
ModelMetrics::rmse(ts.train, fcast$fitted)<br/>
ModelMetrics::rmse(ts.test, y_hat)</p>
<p># ETS is even better ... RMSE 7.25/23.05<br/>
ets.fcast &lt;- forecast(ets.fit, 4*12)<br/>
ModelMetrics::rmse(ts.train, ets.fcast$fitted)<br/>
ModelMetrics::rmse(ts.test, ets.fcast$mean)<br/>
`</p>
<div class="reply">
<a aria-label="Reply to Benjamin S. Skrainka" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=373327#respond" onclick='return addComment.moveForm( "comment-373327", "373327", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-373351">
<div class="comment-container" id="li-comment-373351">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2016 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-373351" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Agreed Benjamin. The post does show how LSTMs can be used, just not a very good use on this dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=373351#respond" onclick='return addComment.moveForm( "comment-373351", "373351", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-397512">
<div class="comment-container" id="li-comment-397512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is this Python too?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397512#respond" onclick='return addComment.moveForm( "comment-397512", "397512", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-374689">
<div class="comment-container" id="li-comment-374689">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c437f87dd8b09472b623c0abfa233c97?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c437f87dd8b09472b623c0abfa233c97?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">libra</span>
<span class="date">December 10, 2016 at 8:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-374689" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question is how to predict the data outside the dataset</p>
<div class="reply">
<a aria-label="Reply to libra" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=374689#respond" onclick='return addComment.moveForm( "comment-374689", "374689", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-374750">
<div class="comment-container" id="li-comment-374750">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 11, 2016 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-374750" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi libra, train your model your training data and make predictions by calling model.predict(). </p>
<p>The batch size/pattern dimensions must match what was used to train the network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=374750#respond" onclick='return addComment.moveForm( "comment-374750", "374750", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-375218">
<div class="comment-container" id="li-comment-375218">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fdb65a8627cb74436f847a9e6a1edf36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fdb65a8627cb74436f847a9e6a1edf36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nilavra Pathak</span>
<span class="date">December 15, 2016 at 1:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375218" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, does the dataset need to be continuous … if i have intermittent missing data then is it supposed to work ?</p>
<div class="reply">
<a aria-label="Reply to Nilavra Pathak" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375218#respond" onclick='return addComment.moveForm( "comment-375218", "375218", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-375251">
<div class="comment-container" id="li-comment-375251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2016 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use 0 to pad and to mark missing values Nilavra.</p>
<p>Also, try consider imputing and see how that affects performance.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375251#respond" onclick='return addComment.moveForm( "comment-375251", "375251", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-375429">
<div class="comment-container" id="li-comment-375429">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/078db419de97817bc2c8e6eb73e24ae5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/078db419de97817bc2c8e6eb73e24ae5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aubrey Li</span>
<span class="date">December 16, 2016 at 6:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375429" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>This is a wonderful tutorial. As a beginner, just wondering, how do I know when I should add a layer and when I should add more neurons in a layer?</p>
<div class="reply">
<a aria-label="Reply to Aubrey Li" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375429#respond" onclick='return addComment.moveForm( "comment-375429", "375429", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-375502">
<div class="comment-container" id="li-comment-375502">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 17, 2016 at 11:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375502" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>More layers offer more “levels of abstraction” or indirection, depending on how you want to conceptualize.</p>
<p>More nodes/modules in a layer offers more “capacity” at one level of abstraction.</p>
<p>Increasing the capacity of the network in terms of layers or neurons in a layer will both require more learning (epochs) or faster learning (learning rate).</p>
<p>What is the magic bullet for a given problem? There’s none. Find a big computer with lots of CPU/RAM and grind away a suite of ideas on a sample of the dataset to see what works well.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375502#respond" onclick='return addComment.moveForm( "comment-375502", "375502", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-375591">
<div class="comment-container" id="li-comment-375591">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/078db419de97817bc2c8e6eb73e24ae5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/078db419de97817bc2c8e6eb73e24ae5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aubrey Li</span>
<span class="date">December 17, 2016 at 10:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375591" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the reply, another question is, is there a typical scenario we should use stacked LSTM instead of the normal one?</p>
<div class="reply">
<a aria-label="Reply to Aubrey Li" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375591#respond" onclick='return addComment.moveForm( "comment-375591", "375591", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-375643">
<div class="comment-container" id="li-comment-375643">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2016 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-375643" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When you need more representation capacity.</p>
<p>It’s a vague answer , because it’s a hard question to answer objectively, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=375643#respond" onclick='return addComment.moveForm( "comment-375643", "375643", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-376253">
<div class="comment-container" id="li-comment-376253">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 20, 2016 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376253" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
 Many thanks for the tutorial. Very useful indeed. </p>
<p> Following up the question from Aubrey Li and your response to that, does it mean that if I double the number of LSTM nodes (from four to eight), it will perform better?. In other words, how did you decide that number of LSTM nodes to be of 4 and not 6 or 8?</p>
<p>Thanks 🙂</p>
<p>Regards</p>
<p>Je</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376253#respond" onclick='return addComment.moveForm( "comment-376253", "376253", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-376278">
<div class="comment-container" id="li-comment-376278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2016 at 7:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may perform better but may require a lot more training.</p>
<p>It may also not converge or it may overfit the problem.</p>
<p>Sadly, there is no magic bullet, just a ton of trial and error. This is why we must develop a strong test harness for a given problem and a strong baseline performance for models to out-perform.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376278#respond" onclick='return addComment.moveForm( "comment-376278", "376278", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-376564">
<div class="comment-container" id="li-comment-376564">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 21, 2016 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376564" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason. Please keep throwing all these nice and very informative blogs / tutorials. </p>
<p>Je</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376564#respond" onclick='return addComment.moveForm( "comment-376564", "376564", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-376593">
<div class="comment-container" id="li-comment-376593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2016 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Je.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376593#respond" onclick='return addComment.moveForm( "comment-376593", "376593", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-376447">
<div class="comment-container" id="li-comment-376447">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nrcjea001</span>
<span class="date">December 20, 2016 at 6:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376447" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>I’ve been struggling with a particular problem and I am hoping you can assist. Basically, I’m running a stateful LSTM following the same logic and code as you’ve discussed above and in addition I’ve played around a bit by adding for example a convolutional layer. My issue is with the mean squared error given at the last epoch (where verbose=2 in model.fit) compared to the mean squared error calculated from trainPredict as in the formula you provide above. Please correct me if I am wrong, but my intuition tells me that these two mean square errors should be the same or at least approximately equal because we are predicting on the training set. However, in my case the mean square error calculated from trainPredict is nearly 50% larger than the mean square error at the last epoch of model.fit. Initially, I thought this had something to do with the resetting of states, but this seems not to be the case with only small differences noticed through my investigation. Does anything come to mind of why this may be? I feel like there is something obvious I’m missing here.</p>
<p>model.compile(loss=’mean_squared_error’, optimizer=ada)<br/>
for i in range(500):<br/>
    XXm = model.fit(trainX, trainY, nb_epoch=1, batch_size=bats, verbose=0,<br/>
    shuffle=False)<br/>
    model.reset_states()<br/>
    print(XXm.history)</p>
<p>at epoch 500: {‘loss’: [0.004482088498778204]}</p>
<p>trainPredict = model.predict(trainX, batch_size=bats)<br/>
mean_squared_error(trainY, trainPredict[:,0])<br/>
Out[68]: 0.0064886363673947768</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to nrcjea001" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376447#respond" onclick='return addComment.moveForm( "comment-376447", "376447", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-376583">
<div class="comment-container" id="li-comment-376583">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2016 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376583" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree with your intuition, I would expect the last reported MSE to match a manually calculated MSE. Also, it is not obvious from a quick scan where you might be going wrong.</p>
<p>Start off by confirming this expectation on a standalone small network with a contrived or well understand dataset. Say one hidden layer MLP on the normalized boston house price dataset.</p>
<p>This is a valuable exercise because it cuts out all of the problem specific and technique specific code and concerns and gets right to the heart of the matter.</p>
<p>Once achieved, now come back to your project and cut it back to the bone until it achieves the same outcome. </p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376583#respond" onclick='return addComment.moveForm( "comment-376583", "376583", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-376881">
<div class="comment-container" id="li-comment-376881">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nrcjea001</span>
<span class="date">December 22, 2016 at 11:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376881" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thanks for getting back to me. </p>
<p>I followed your suggestion by running a simple MLP using the housing dataset but I’m still seeing differences. Here is my code as well as the output:</p>
<p>%reset -f<br/>
import numpy<br/>
seed = 50<br/>
numpy.random.seed(seed)<br/>
import pandas<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from sklearn.metrics import mean_squared_error</p>
<p>dataframe = pandas.read_csv(“housing.csv”, delim_whitespace=True,<br/>
                            header=None)<br/>
dataset = dataframe.values</p>
<p>X = dataset[:,0:13]<br/>
Y = dataset[:,13]</p>
<p>model = Sequential()<br/>
model.add(Dense(13, input_dim=13, init=’normal’, activation=’relu’))<br/>
model.add(Dense(1, init=’normal’))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>nep=100<br/>
mhist = model.fit(X, Y, nb_epoch=nep, batch_size=3, verbose=0)<br/>
print ‘MSE on last epoch:’, mhist.history[“loss”][nep-1]</p>
<p>PX=model.predict(X)<br/>
print ‘Calculated MSE:’, mean_squared_error(Y, PX)</p>
<p>MSE on last epoch: 30.7131816067<br/>
Calculated MSE: 28.8423397398</p>
<p>Please advise. Thanks</p>
<div class="reply">
<a aria-label="Reply to nrcjea001" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376881#respond" onclick='return addComment.moveForm( "comment-376881", "376881", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-376894">
<div class="comment-container" id="li-comment-376894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9dc1076c8831ea242ddd4edd4448b8db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nrcjea001</span>
<span class="date">December 23, 2016 at 12:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Apologies. I forgot to scale. Used a MinMaxScaler</p>
<p>scalerX = MinMaxScaler(feature_range=(0, 1))<br/>
scalerY = MinMaxScaler(feature_range=(0, 1))<br/>
X = scalerX.fit_transform(dataset[:,0:13])<br/>
Y = scalerY.fit_transform(dataset[:,13])</p>
<p>MSE on last epoch: 0.00589414117318<br/>
Calculated MSE: 0.00565485540125</p>
<p>The difference is about 4%. Perhaps this is negligible?</p>
<div class="reply">
<a aria-label="Reply to nrcjea001" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376894#respond" onclick='return addComment.moveForm( "comment-376894", "376894", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-376946">
<div class="comment-container" id="li-comment-376946">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 23, 2016 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376946" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Might be small differences due to random number generators and platform differences.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376946#respond" onclick='return addComment.moveForm( "comment-376946", "376946", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-376751">
<div class="comment-container" id="li-comment-376751">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be6265c0bfa631867842fe70ec265f68?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be6265c0bfa631867842fe70ec265f68?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David Holmgren</span>
<span class="date">December 22, 2016 at 10:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-376751" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for an excellent introduction to using LSTM networks for time series prediction; I learned a great deal from this article. One question I did have: if I wanted to plot the difference between the data and prediction, would it be correct to use something like (in the case of the training data):</p>
<p>plt.plot(trainY[0]-trainPredict[:,0]),plt.show()</p>
<p>Once again, many thanks.</p>
<p>Regards,<br/>
David</p>
<div class="reply">
<a aria-label="Reply to David Holmgren" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=376751#respond" onclick='return addComment.moveForm( "comment-376751", "376751", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-377030">
<div class="comment-container" id="li-comment-377030">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7182f74bb2b2ad405cf188e1408bf998?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7182f74bb2b2ad405cf188e1408bf998?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">unknnw0afa</span>
<span class="date">December 23, 2016 at 1:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377030" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For the codes with stacked ltsm, I’m getting the following error. Copy paste the whole thing doesn’t work either. Any help?</p>
<p>The shape for while_1/Merge_2:0 is not an invariant for the loop. It enters the loop with shape (1, 4), but has shape (?, 4) after one iteration. Provide shape invariants using either the <code>shape_invariants</code> argument of tf.while_loop or set_shape() on the loop variables.</p>
<div class="reply">
<a aria-label="Reply to unknnw0afa" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377030#respond" onclick='return addComment.moveForm( "comment-377030", "377030", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-377207">
<div class="comment-container" id="li-comment-377207">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 24, 2016 at 4:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377207" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ouch, I’ve not seen that before.</p>
<p>Perhaps try StackOverflow or the google group for the backend that you’re using?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377207#respond" onclick='return addComment.moveForm( "comment-377207", "377207", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-377532">
<div class="comment-container" id="li-comment-377532">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffa50b2ca24453993f3a1aaefc6db603?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffa50b2ca24453993f3a1aaefc6db603?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Søren Pallesen</span>
<span class="date">December 25, 2016 at 9:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377532" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.</p>
<p>Thanks for all you valuable advice here.</p>
<p>I have trained a model for time series prediction on a quite big data set, which took 12 hours for 100 epochs.</p>
<p>The results (validation accuracy) stayed flat for the first 90 epochs and then began to move up.</p>
<p>Now wonder how to add more training on top of a trained model in Keras without loosing the training gained from the first 100 epochs?</p>
<p>Best regards<br/>
Søren</p>
<div class="reply">
<a aria-label="Reply to Søren Pallesen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377532#respond" onclick='return addComment.moveForm( "comment-377532", "377532", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-377651">
<div class="comment-container" id="li-comment-377651">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 26, 2016 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377651" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Søren,</p>
<p>You can save the weights of your network. Then later load them and continue training / refining weights.</p>
<p>See here for more info on saving and loading a network:<br/>
<a href="http://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">http://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377651#respond" onclick='return addComment.moveForm( "comment-377651", "377651", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-377884">
<div class="comment-container" id="li-comment-377884">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 27, 2016 at 10:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-377884" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
 Another question towards the normalisation. Here, we are lucky to have all the data for training and testing. And this has enabled us to normalise the data (MinMaxScaler).  However, in real-life, we may not have all the data in one go and in fact it is very likely the case that we will be receiving data from streams. In such cases, we will never has the max or min or even the sum. How do we handle this case (so that we can feed the RNN with the normalised values?). </p>
<p>One obvious  solution, perhaps, is calculating this over the running data. But that will be an expensive approach. Or something to do with stochastic  sampling strategy ? Any help Jason?</p>
<p>Thanks in advance </p>
<p>Kind Regards</p>
<p>Je</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=377884#respond" onclick='return addComment.moveForm( "comment-377884", "377884", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-378034">
<div class="comment-container" id="li-comment-378034">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2016 at 7:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-378034" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Je.</p>
<p>For normalization we need to estimate the expected extremes of the data (min/max). For standardization we need to estimate the expected mean and standard deviation. These can be stored and used any time to validate and prepare data.</p>
<p>For more on normalizing and standardizing time series data, see this post:<br/>
<a href="http://machinelearningmastery.com/normalize-standardize-time-series-data-python/" rel="nofollow">http://machinelearningmastery.com/normalize-standardize-time-series-data-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=378034#respond" onclick='return addComment.moveForm( "comment-378034", "378034", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-378164">
<div class="comment-container" id="li-comment-378164">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 28, 2016 at 11:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-378164" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
 Thanks for the response and for the pointer. Useful  – I have to say. 🙂</p>
<p>Kind Regards</p>
<p>Je</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=378164#respond" onclick='return addComment.moveForm( "comment-378164", "378164", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-378284">
<div class="comment-container" id="li-comment-378284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 29, 2016 at 7:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-378284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=378284#respond" onclick='return addComment.moveForm( "comment-378284", "378284", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-378165">
<div class="comment-container" id="li-comment-378165">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/adece7ae7d5afd1d2137058749de3acf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Je</span>
<span class="date">December 28, 2016 at 11:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-378165" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason  for the response and for the pointer. Useful  – I have to say. 🙂</p>
<div class="reply">
<a aria-label="Reply to Je" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=378165#respond" onclick='return addComment.moveForm( "comment-378165", "378165", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-380154">
<div class="comment-container" id="li-comment-380154">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f61a374094ff3ba065754b857667718e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f61a374094ff3ba065754b857667718e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shaun L</span>
<span class="date">January 5, 2017 at 2:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-380154" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Great article! I got a lot of benefits from your work.</p>
<p>One question here, lots of LSTM code like yours use such</p>
<p>trainX[1,2,3,4] to target trainY[5]<br/>
trainX[2,3,4,5] to target trainY[6]<br/>
…</p>
<p>It is possible to make trainY also be time series? like</p>
<p>trainX[1,2,3,4] to target trainY[5,6]<br/>
trainX[2,3,4,5] to target trainY[6,7]<br/>
…<br/>
So the prediction will be done at once rather than 5 and then 6.</p>
<p>Best regards,</p>
<div class="reply">
<a aria-label="Reply to Shaun L" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=380154#respond" onclick='return addComment.moveForm( "comment-380154", "380154", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-380256">
<div class="comment-container" id="li-comment-380256">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 5, 2017 at 9:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-380256" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, Shaun.</p>
<p>Reform the dataset with two output variables. Then change the number of neurons in the output layer to 2.</p>
<p>I will have an example of this on the blog in coming weeks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=380256#respond" onclick='return addComment.moveForm( "comment-380256", "380256", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-380674">
<div class="comment-container" id="li-comment-380674">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2490869d5983b66d9554fd9ad2f3de8c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2490869d5983b66d9554fd9ad2f3de8c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shaun L</span>
<span class="date">January 7, 2017 at 1:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-380674" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I look forward to your example! I really wonder the advantages and disadvantages in doing so.</p>
<div class="reply">
<a aria-label="Reply to Shaun L" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=380674#respond" onclick='return addComment.moveForm( "comment-380674", "380674", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-381198">
<div class="comment-container" id="li-comment-381198">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cec9a1fb9da33ddc3027589735867b43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cec9a1fb9da33ddc3027589735867b43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Joaco</span>
<span class="date">January 9, 2017 at 6:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381198" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I am here again. I have achieved my goal to predict more than one day in this period of time. But now I have another question. I make X=[x1,x2…x30] and Y=[y1,y2…y7], which means I use 30 days to predict 7 days. When predicting y2, actually I used the real value. So here is the question. How can I put my predicted number,like y2,to the X sequence to predict y3? I am looking forward to your answer.<br/>
Thank you very much</p>
<div class="reply">
<a aria-label="Reply to Joaco" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381198#respond" onclick='return addComment.moveForm( "comment-381198", "381198", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-381367">
<div class="comment-container" id="li-comment-381367">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4a0714b13c18cad59f44f7717ce255f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4a0714b13c18cad59f44f7717ce255f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kavitha</span>
<span class="date">January 11, 2017 at 12:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381367" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, a great tutorial.  I’m a newbie, and trying to understand this code.  My understanding of Keras is that time steps refers to the number of hidden nodes that the system back propagates to through time, and input dimensions refers to the number of ‘features’ for a given input datum (e.g. if we had 2 categorical values, the input dimensions would be 2). So what confuses me about the code is that it tries to model past values (look back) as the number of input dimensions.  Timesteps is always set to 1.  In that case isn’t the system not behaving like a recurrent network at all but more like an MLP?  Thanks!</p>
<div class="reply">
<a aria-label="Reply to Kavitha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381367#respond" onclick='return addComment.moveForm( "comment-381367", "381367", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-381423">
<div class="comment-container" id="li-comment-381423">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 11, 2017 at 9:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381423" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Kavitha,</p>
<p>The tutorial demonstrates a number of ways that you can use LSTMs, including using lag variables as input features and lag variables as time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381423#respond" onclick='return addComment.moveForm( "comment-381423", "381423", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-382370">
<div class="comment-container" id="li-comment-382370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4a0714b13c18cad59f44f7717ce255f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4a0714b13c18cad59f44f7717ce255f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kavitha</span>
<span class="date">January 16, 2017 at 10:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-382370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Got it, thank you!</p>
<div class="reply">
<a aria-label="Reply to Kavitha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=382370#respond" onclick='return addComment.moveForm( "comment-382370", "382370", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-405548">
<div class="comment-container" id="li-comment-405548">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">amal</span>
<span class="date">July 11, 2017 at 11:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405548" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi jason,<br/>
thank you for this great Tuto</p>
<p>with one timestep what is the difference between an MLP and lstm</p>
<div class="reply">
<a aria-label="Reply to amal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=405548#respond" onclick='return addComment.moveForm( "comment-405548", "405548", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-405600">
<div class="comment-container" id="li-comment-405600">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2017 at 9:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405600" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs are a very different architecture to MLP. The internal state and gates will result in a different mapping function being learned. </p>
<p>Using a single time step input would not be a good use for an LSTM.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=405600#respond" onclick='return addComment.moveForm( "comment-405600", "405600", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-381656">
<div class="comment-container" id="li-comment-381656">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7037ad0dee4d261fb5f70ebd661ce68f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7037ad0dee4d261fb5f70ebd661ce68f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nishat</span>
<span class="date">January 12, 2017 at 2:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381656" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I am looking for a machine learning algorithm that can learn the timing issues like debounce and flip flops in logic circuits and predict an output.</p>
<div class="reply">
<a aria-label="Reply to Nishat" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381656#respond" onclick='return addComment.moveForm( "comment-381656", "381656", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-381802">
<div class="comment-container" id="li-comment-381802">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2017 at 9:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381802" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds like an interesting problem Nishat.</p>
<p>This post might help you frame your problem for predictive modeling:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381802#respond" onclick='return addComment.moveForm( "comment-381802", "381802", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-381871">
<div class="comment-container" id="li-comment-381871">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ad09ebe1207b6885ae4ffb1f3599a9f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ad09ebe1207b6885ae4ffb1f3599a9f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sss</span>
<span class="date">January 13, 2017 at 5:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-381871" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think this is wrong :len(dataset)-look_back-1<br/>
it should be len(dataset)-look_back</p>
<div class="reply">
<a aria-label="Reply to sss" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=381871#respond" onclick='return addComment.moveForm( "comment-381871", "381871", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-382635">
<div class="comment-container" id="li-comment-382635">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21a2e054a47029615da747a31e7cf72e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21a2e054a47029615da747a31e7cf72e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jakub</span>
<span class="date">January 17, 2017 at 9:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-382635" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p> I would like to point out that the graphics</p>
<p>LSTM Trained on Regression Formulation of Passenger Prediction Problem</p>
<p>is the most confusing part of the article.</p>
<p>The red line is NOT the actual prediction for 1,2,3, etc. steps ahead. As we can see from the data, you need to know the REAL value just at the time T to predict T+1, it is not based on your prediction in this setup.</p>
<p>If you need to do a prediction for more steps ahead a different approach is needed.</p>
<p>I am still grateful for the parts of the code you have provided, but this part led me way away from my goal.</p>
<div class="reply">
<a aria-label="Reply to Jakub" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=382635#respond" onclick='return addComment.moveForm( "comment-382635", "382635", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-383715">
<div class="comment-container" id="li-comment-383715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aaa2c26ecafd7e384c264a422588526e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aaa2c26ecafd7e384c264a422588526e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Faezeh</span>
<span class="date">January 24, 2017 at 3:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jakub, do you have any idea on what approach to take for multi-step ahead prediction?</p>
<div class="reply">
<a aria-label="Reply to Faezeh" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383715#respond" onclick='return addComment.moveForm( "comment-383715", "383715", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-382996">
<div class="comment-container" id="li-comment-382996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8f4c09f62c81a948a954a563642fe2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8f4c09f62c81a948a954a563642fe2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Salvo</span>
<span class="date">January 19, 2017 at 11:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-382996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
I would control the input of the internal gate of the cell memory. is it a possible thing to do?<br/>
In case of yes, what are the function that allow it? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Salvo" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=382996#respond" onclick='return addComment.moveForm( "comment-382996", "382996", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-383068">
<div class="comment-container" id="li-comment-383068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2017 at 10:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t believe this is the case in Keras Salvo. I’m happy to be corrected though.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383068#respond" onclick='return addComment.moveForm( "comment-383068", "383068", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-383188">
<div class="comment-container" id="li-comment-383188">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8f4c09f62c81a948a954a563642fe2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8f4c09f62c81a948a954a563642fe2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Salvo</span>
<span class="date">January 21, 2017 at 2:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383188" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your help! These articles are very useful for my studies!</p>
<div class="reply">
<a aria-label="Reply to Salvo" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383188#respond" onclick='return addComment.moveForm( "comment-383188", "383188", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-383251">
<div class="comment-container" id="li-comment-383251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2017 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that Salvo.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383251#respond" onclick='return addComment.moveForm( "comment-383251", "383251", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-383024">
<div class="comment-container" id="li-comment-383024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">January 20, 2017 at 4:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>in the “LSTM for Regression with Time Steps”<br/>
how can we add more layers to the model ?</p>
<p>model = Sequential()<br/>
model.add(LSTM(4, input_dim=1))<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
model.fit(trainX, trainY, nb_epoch=100, batch_size=1, verbose=2)</p>
<p>How can I add another Layer or more Layers ?</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383024#respond" onclick='return addComment.moveForm( "comment-383024", "383024", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-383073">
<div class="comment-container" id="li-comment-383073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2017 at 10:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Nader,</p>
<p>Set the batch_input_shape on each layer and set the return_sequences argument on all layers except the output layer.</p>
<p>I’d recommend carefully re-reading the words and code in the section titled “Stacked LSTMs with Memory Between Batches”.</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383073#respond" onclick='return addComment.moveForm( "comment-383073", "383073", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-383182">
<div class="comment-container" id="li-comment-383182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/862ef7ab4dc40a72de4e86393e144083?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/862ef7ab4dc40a72de4e86393e144083?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anthony</span>
<span class="date">January 21, 2017 at 1:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,<br/>
Thanks for the nice blog. What Hardware configurations are required for running this program?</p>
<div class="reply">
<a aria-label="Reply to Anthony" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383182#respond" onclick='return addComment.moveForm( "comment-383182", "383182", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-383250">
<div class="comment-container" id="li-comment-383250">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2017 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383250" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Anthony, you’re welcome.</p>
<p>A normal PC without a GPU is just fine for running small LSTMs like those in this tutorial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383250#respond" onclick='return addComment.moveForm( "comment-383250", "383250", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-383316">
<div class="comment-container" id="li-comment-383316">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b9e1e62eb28c414051c7bd7e5f36169e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b9e1e62eb28c414051c7bd7e5f36169e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nikola Tanković</span>
<span class="date">January 21, 2017 at 9:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383316" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a small question. I dont see how look_back feature is relevant. If I put look_back to zero or one but increase memory units to lets say 20, I get much better results because the network itself “learns” to look back as much as its needed. Can you replicate that? Isn’t that the whole point of LSTM?</p>
<div class="reply">
<a aria-label="Reply to Nikola Tanković" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383316#respond" onclick='return addComment.moveForm( "comment-383316", "383316", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-383563">
<div class="comment-container" id="li-comment-383563">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">January 23, 2017 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383563" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How do you recommend we include additional features, such as<br/>
moving averages, standard deviation,etc.. ?</p>
<p>Also, how would we tune the Stacked LSTMs with Memory Between Batches<br/>
to achieve better accuracy ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383563#respond" onclick='return addComment.moveForm( "comment-383563", "383563", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-383628">
<div class="comment-container" id="li-comment-383628">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f24339ae06ca3fce7fd89e57541752f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f24339ae06ca3fce7fd89e57541752f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anthony</span>
<span class="date">January 23, 2017 at 4:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383628" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason for a wonderful post. Your code uses keras which has tensorflow working in the background. Tensorflow is not available under Windows platform. Is there any way one could run this code in windows?<br/>
I am using Anaconda.</p>
<div class="reply">
<a aria-label="Reply to Anthony" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383628#respond" onclick='return addComment.moveForm( "comment-383628", "383628", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-383790">
<div class="comment-container" id="li-comment-383790">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2017 at 11:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383790" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Anthony, absolutely. Use the Theano backend instead:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6592a0070c3350219944" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
pip install theano</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6592a0070c3350219944-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6592a0070c3350219944-1"><span class="crayon-e">pip </span><span class="crayon-e">install </span><span class="crayon-v">theano</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383790#respond" onclick='return addComment.moveForm( "comment-383790", "383790", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-397513">
<div class="comment-container" id="li-comment-397513">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 6:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397513" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correction 04.2017: Its available on Windows/Anaconda</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397513#respond" onclick='return addComment.moveForm( "comment-397513", "397513", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-383656">
<div class="comment-container" id="li-comment-383656">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4607ce1a117f3d82a5a64651729bf772?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4607ce1a117f3d82a5a64651729bf772?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akhilesh Kumar</span>
<span class="date">January 23, 2017 at 7:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383656" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the way data is normalized in this tutorial is not correct. The shows hetroskadicity and hence needs advanced method of normalization.</p>
<div class="reply">
<a aria-label="Reply to Akhilesh Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383656#respond" onclick='return addComment.moveForm( "comment-383656", "383656", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-383792">
<div class="comment-container" id="li-comment-383792">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2017 at 11:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383792" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree Akhilesh.</p>
<p>The series really should have been made stationary first. A log or box-cox transform and then differenced.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383792#respond" onclick='return addComment.moveForm( "comment-383792", "383792", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-383708">
<div class="comment-container" id="li-comment-383708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">S Wollner</span>
<span class="date">January 24, 2017 at 2:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m sorry to tell you that this is no prediction.<br/>
Your LSTM network learned to save the value from t-1 and  retrieve it at time t.</p>
<p>Try one thing… train this model on that dataset… and test this on a hole different Timeseries. E.g. a sincurve.</p>
<p>You will get the inputted sincurve with an offset of 1 timestep out. Maybe with some distortion in it.</p>
<p>I can get the same results with an stupid arima model…</p>
<p>This is no prediction at all. It just a stupid system.</p>
<p>Kind Regards,<br/>
S. Wollner</p>
<div class="reply">
<a aria-label="Reply to S Wollner" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383708#respond" onclick='return addComment.moveForm( "comment-383708", "383708", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-383797">
<div class="comment-container" id="li-comment-383797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 24, 2017 at 11:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-383797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks S. Wollner,</p>
<p>It is a trivial perhaps even terrible prediction example, but it does show how to use the LSTM features of Keras.</p>
<p>I hope to provide some updated examples soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=383797#respond" onclick='return addComment.moveForm( "comment-383797", "383797", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-397563">
<div class="comment-container" id="li-comment-397563">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 4:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397563" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If the example is not predicting anything, is this article somehow misleading for those trying to predict with this code?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397563#respond" onclick='return addComment.moveForm( "comment-397563", "397563", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-397564">
<div class="comment-container" id="li-comment-397564">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 5:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397564" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Now I have two adapted versions of the example, feeded with own data.</p>
<p>One from Wollner and one from Jason. Both are running and plotting.</p>
<p>With some additions, I’m even able to forecast unseen data- BUT…</p>
<p>As beginner, how can I decide whether I’m dealing with real predictions or not?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397564#respond" onclick='return addComment.moveForm( "comment-397564", "397564", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-397627">
<div class="comment-container" id="li-comment-397627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 26, 2017 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Compare to a persistence model:<br/>
<a href="http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-397664">
<div class="comment-container" id="li-comment-397664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 26, 2017 at 3:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-384245">
<div class="comment-container" id="li-comment-384245">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">S. Wollner</span>
<span class="date">January 26, 2017 at 8:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384245" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi again,</p>
<p>I’ve updated your example so that a real prediction is possible.</p>
<p>What I did:<br/>
set look_back to 25<br/>
add a linear activation to the Dense layer<br/>
and changed trainings settings like batch size</p>
<p>optionally I added detrending and stationarity of signal (Currently it’s commented out)</p>
<p>Here is the code:</p>
<p>import numpy<br/>
import math<br/>
import matplotlib.pyplot as plt<br/>
import pandas<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM<br/>
from keras.layers import Activation<br/>
from sklearn.preprocessing import MinMaxScaler<br/>
from sklearn.metrics import mean_squared_error</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)</p>
<p># load the dataset<br/>
dataframe = pandas.read_csv(‘international-airline-passengers.csv’, usecols=[1], engine=’python’, skipfooter=3)<br/>
dataset = dataframe.values<br/>
dataset = dataset.astype(‘float32′)</p>
<p>#plt.plot(dataset);<br/>
#plt.show();</p>
<p># normalize the dataset<br/>
#dataset = numpy.log10(dataset) # stationary signal<br/>
#dataset = numpy.diff(dataset, n=1, axis=0) # detrended signal<br/>
dataset = (dataset – numpy.min(dataset)) / (numpy.max(dataset) – numpy.min(dataset))  # normalized signal</p>
<p>#plt.plot(dataset);<br/>
#plt.show();</p>
<p># split into train and test sets<br/>
train_size = int(len(dataset) * 0.67)<br/>
test_size = len(dataset) – train_size<br/>
train, test = dataset[:train_size,:], dataset[train_size:len(dataset),:]<br/>
print(len(train), len(test))</p>
<p># convert an array of values into a dataset matrix<br/>
def create_dataset(dataset, look_back=1):<br/>
	dataX, dataY = [], []<br/>
	for i in range(len(dataset)-look_back-1):<br/>
		a = dataset[i:(i+look_back), 0]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back, 0])<br/>
	return numpy.array(dataX), numpy.array(dataY)</p>
<p># reshape into X=t and Y=t+1<br/>
look_back = 25<br/>
trainX, trainY = create_dataset(train, look_back)<br/>
testX, testY = create_dataset(test, look_back)</p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</p>
<p># create and fit the LSTM network<br/>
model = Sequential()<br/>
model.add(LSTM(100, input_dim = look_back))<br/>
model.add(Dense(1))<br/>
model.add(Activation(“linear”))</p>
<p>model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
#model.compile(loss=”mean_squared_error”, optimizer=”rmsprop”)<br/>
model.fit(trainX, trainY, nb_epoch=100, batch_size=25, validation_data=(testX, testY), verbose=1)<br/>
score = model.evaluate(testX, testY, verbose=0)<br/>
print(‘Test score:’, score)</p>
<p># make predictions<br/>
trainPredict = model.predict(trainX, verbose=0)<br/>
testPredict = model.predict(testX, verbose=0)</p>
<p># shift train predictions for plotting<br/>
trainPredictPlot = numpy.empty_like(dataset)<br/>
trainPredictPlot[:, :] = numpy.nan<br/>
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict</p>
<p># shift test predictions for plotting<br/>
testPredictPlot = numpy.empty_like(dataset)<br/>
testPredictPlot[:, :] = numpy.nan<br/>
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict</p>
<p># plot baseline and predictions<br/>
plt.plot(dataset)<br/>
plt.plot(trainPredictPlot)<br/>
plt.plot(testPredictPlot)<br/>
plt.show()</p>
<p>Kind regards<br/>
S. Wollner</p>
<div class="reply">
<a aria-label="Reply to S. Wollner" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384245#respond" onclick='return addComment.moveForm( "comment-384245", "384245", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-385611">
<div class="comment-container" id="li-comment-385611">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7bbfeda73caaf00b021b3516639e2422?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7bbfeda73caaf00b021b3516639e2422?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kay</span>
<span class="date">February 2, 2017 at 10:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385611" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Wollner,<br/>
I tried to follow your code, however i got the prediction as a straight line. Where do you think i went wrong.<br/>
Thank you.</p>
<div class="reply">
<a aria-label="Reply to Kay" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385611#respond" onclick='return addComment.moveForm( "comment-385611", "385611", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-384354">
<div class="comment-container" id="li-comment-384354">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/81165f2b9d49b613759b6e35663a212a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/81165f2b9d49b613759b6e35663a212a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luis</span>
<span class="date">January 27, 2017 at 1:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384354" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, </p>
<p>Thank you for this excellent post. I have reproduce the example and also used a real time-series data set successfully. But I have a simple question:</p>
<p>How I can generate a sequence of predict new values? I mean future values (no the test values), for example, the six first months of the year 1961; values for 1961-01, 1961-02,…1961-06. </p>
<p>Luis</p>
<div class="reply">
<a aria-label="Reply to Luis" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384354#respond" onclick='return addComment.moveForm( "comment-384354", "384354", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-384496">
<div class="comment-container" id="li-comment-384496">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 27, 2017 at 12:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384496" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Luis, you can make predictions on new data by calling y = model.predict(X)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384496#respond" onclick='return addComment.moveForm( "comment-384496", "384496", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-384423">
<div class="comment-container" id="li-comment-384423">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/198775272650dd7bef414f45532c0b87?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/198775272650dd7bef414f45532c0b87?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shazz</span>
<span class="date">January 27, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384423" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I hope I don’t ask for something already in the comments, but at least I did not see it. All my apologizes else.</p>
<p>Based on your dataset, let’s assume that we have more features than only the number of passengers per unit of time, for example the “current” weather, fuel price,… whatever.<br/>
If I want to use them in the training, the idea is the same, for each one I “copy” the n loopback values for each sample ?</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to shazz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384423#respond" onclick='return addComment.moveForm( "comment-384423", "384423", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-384505">
<div class="comment-container" id="li-comment-384505">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 27, 2017 at 12:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384505" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Shazz,</p>
<p>I would recommend creating a new dataset using DataFrame.shift() rather than the crude loop back function in this example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384505#respond" onclick='return addComment.moveForm( "comment-384505", "384505", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-384426">
<div class="comment-container" id="li-comment-384426">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">January 27, 2017 at 6:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384426" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello S. Wollner:</p>
<p>I too notice the predictions to be simply mimicking the last known value.<br/>
Thanks for posting your code.</p>
<p>I had a couple questions on your post:</p>
<p>1. How did you set the batch_size ? It appears that matches the lookback.<br/>
Is that intentional ?</p>
<p>2. Similarly, how did you know how to set the number of neurons to 100 via this line:<br/>
model.add(LSTM(100, input_dim = look_back)) ?<br/>
That appears to be 4*look_back ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384426#respond" onclick='return addComment.moveForm( "comment-384426", "384426", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-384589">
<div class="comment-container" id="li-comment-384589">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84dd416fba7e63dc0620b2ed320d7bd1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">S. Wollner</span>
<span class="date">January 27, 2017 at 11:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384589" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sam,</p>
<p>To 1.:<br/>
No it doesn’t have to match the look_back amount.<br/>
Here is a similar question and a good answer<br/>
<a href="http://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network" rel="nofollow">http://stats.stackexchange.com/questions/153531/what-is-batch-size-in-neural-network</a></p>
<p>Short, you devide your time series into pieces for training. In this case:<br/>
Training_set_size = (data_size * train_size – forecast_amount) / look_back<br/>
That is the set for training your network. Now you devide it by the batch_size.<br/>
Each batch should have more or less the same size.<br/>
In the link above you will see pros and cons about the size of each batch. </p>
<p>To 2.:<br/>
Try and error, like almost everything with neuronal networks. That’s parameter optimization. There is no true config for all problems. The more neurons you have, the more powerful your network can be. The problem is you also need a larger trainingset.</p>
<p>Normally you iterate through the number of neurons. E.g. you start at 2 and go up till 100 in a step size of 2 neurons. For each step you calculate  at least 35 networks (statistical expression) and calculate the mean and variance over the error of train- and testset.<br/>
Plot all the results in a graph and take the network with less complexity and best TEST rate (not train!). Consider variance and mean!!!</p>
<p>That’s a paper from our research group. In this paper you’ll see such a graphic for lvq networks (Figure 4).<br/>
<a href="http://isommer.informatik.fh-schmalkalden.de/publications/2002_Sci_doc.pdf" rel="nofollow">http://isommer.informatik.fh-schmalkalden.de/publications/2002_Sci_doc.pdf</a></p>
<p>Kind regards,<br/>
S. Wollner</p>
<div class="reply">
<a aria-label="Reply to S. Wollner" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384589#respond" onclick='return addComment.moveForm( "comment-384589", "384589", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-384825">
<div class="comment-container" id="li-comment-384825">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9bd571b865e88d016f24499710a40403?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">January 29, 2017 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384825" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks S. Wollner for the guidance.</p>
<p>I’m currently trying to use this LSTM RNN to predict monthly stock returns.<br/>
Again though I cannot beat the naive benchmark of simply predicting<br/>
t+1 = t or predicting the future return is simply the last known/given return at time t.</p>
<p>I’m wondering what else I can tune /change in the LSTM RNN to remove<br/>
the” mimicking” effect ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384825#respond" onclick='return addComment.moveForm( "comment-384825", "384825", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-384931">
<div class="comment-container" id="li-comment-384931">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21b73b533faf33f148201dbaa646d7b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21b73b533faf33f148201dbaa646d7b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">berkmeister</span>
<span class="date">January 29, 2017 at 11:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-384931" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The major difficulty here is that the time series is non stationary – it is both mean trending and the variance is exploding as well. It is very hard to forecast using this time series. </p>
<p>You get around this by scaling using the entire dataset, therefore violating the in-sample out-of-sample separation. In other words, you are looking into the future, i.e. your test set, for scaling – which unfortunately is not possible in real life.</p>
<div class="reply">
<a aria-label="Reply to berkmeister" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=384931#respond" onclick='return addComment.moveForm( "comment-384931", "384931", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-385392">
<div class="comment-container" id="li-comment-385392">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2017 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385392" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi berkmeister,</p>
<p>The level can be made stationary with order one differencing.</p>
<p>The variance can be made stationary with log or box-cox transforms.</p>
<p>Both methods can be used on test and training data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385392#respond" onclick='return addComment.moveForm( "comment-385392", "385392", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-385154">
<div class="comment-container" id="li-comment-385154">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4926b322d2b4e04f0b40f93fd1b206bc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4926b322d2b4e04f0b40f93fd1b206bc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdulaziz Almalaq</span>
<span class="date">January 31, 2017 at 10:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385154" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Many thanks to your post and tutorial. I really got the most beneficial of ideas to apply the LSTM to my problem.</p>
<div class="reply">
<a aria-label="Reply to Abdulaziz Almalaq" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385154#respond" onclick='return addComment.moveForm( "comment-385154", "385154", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-385406">
<div class="comment-container" id="li-comment-385406">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 1, 2017 at 10:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385406" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385406#respond" onclick='return addComment.moveForm( "comment-385406", "385406", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-385583">
<div class="comment-container" id="li-comment-385583">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/95358e17f0ce5d43d24408a2e76fa2d8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/95358e17f0ce5d43d24408a2e76fa2d8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 2, 2017 at 6:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385583" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe I have made the stock data in my dataset stationary by taking the first difference of the log of the prices.</p>
<p>However, if I want to include additional features such as<br/>
volatility,  a moving average, etc… would those be computed<br/>
 on the ORIGINAL stock prices or on the newly calculated<br/>
log differences, which are stationary ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385583#respond" onclick='return addComment.moveForm( "comment-385583", "385583", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-385643">
<div class="comment-container" id="li-comment-385643">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 2, 2017 at 2:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-385643" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question Sam.</p>
<p>I don’t work with security prices myself, but I expect you will want those measures on the original data.</p>
<p>From a feature engineering perspective, I’d recommend testing alternatives and use what results in the most accurate predictive models.</p>
<p>Regarding predicting security prices in the short term, consider using a persistence model:<br/>
<a href="http://machinelearningmastery.com/gentle-introduction-random-walk-times-series-forecasting-python/" rel="nofollow">http://machinelearningmastery.com/gentle-introduction-random-walk-times-series-forecasting-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=385643#respond" onclick='return addComment.moveForm( "comment-385643", "385643", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-386377">
<div class="comment-container" id="li-comment-386377">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/639a47495050bbd5f4f0acc38e9ec371?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/639a47495050bbd5f4f0acc38e9ec371?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 7, 2017 at 10:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386377" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Another question I had was on performing 2 or more day ahead forecasts on a stationary time series<br/>
with first differences.<br/>
For example, if we want to forecast 5 days ahead of day (instead of 1 day), would we instead use<br/>
the differences between t and t-5  ?</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=386377#respond" onclick='return addComment.moveForm( "comment-386377", "386377", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-386526">
<div class="comment-container" id="li-comment-386526">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 8, 2017 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386526" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sam,</p>
<p>Forecasts would be made one time step at a time. The differences can then be inverted from the last known observation across each of the predicted time steps.</p>
<p>I hope that answers your question.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=386526#respond" onclick='return addComment.moveForm( "comment-386526", "386526", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-386696">
<div class="comment-container" id="li-comment-386696">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/47018df53972150d37a4ca086469bd66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/47018df53972150d37a4ca086469bd66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 9, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386696" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Unfortunately I’m not able to follow.</p>
<p>Suppose we have the following stock price history</p>
<p>Date 	Price	Difference<br/>
1/2/2017	100<br/>
1/3/2017	102	           2<br/>
1/4/2017	104	           2<br/>
1/5/2017	105	           1<br/>
1/6/2017	106		   1<br/>
1/7/2017	107		   1<br/>
1/8/2017	108		   1</p>
<p>If we want to forecast what the price will be on January 8th STARTING from January 3rd (a 5 day horizon),<br/>
how would build the differences to make the series stationary? If we continue with first differences, then I believe we would only be forecasting the change from Jan 7th to Jan 8, which is still<br/>
a 1 day change, not a 5 day ?</p>
<p>Thanks again.</p>
<div class="reply">
<a aria-label="Reply to Sam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=386696#respond" onclick='return addComment.moveForm( "comment-386696", "386696", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-386721">
<div class="comment-container" id="li-comment-386721">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 9, 2017 at 7:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386721" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sam,</p>
<p>Off the cuff: The LSTM can forecast a 5-day horizon by having 5 neurons in the output layer and learn from differenced data. The difference inverse can be applied from the last know observation and propagated along the forecast to get back to domain values.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=386721#respond" onclick='return addComment.moveForm( "comment-386721", "386721", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-386875">
<div class="comment-container" id="li-comment-386875">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 10, 2017 at 4:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386875" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Alright, so if I understand correctly, the 5 outputs from the output layer<br/>
would correspond to the differences between days 0-1,1 -2, 2-3,3-4, 4-5 respectively?</p>
<p>Thanks for your patience.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-386904">
<div class="comment-container" id="li-comment-386904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 10, 2017 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct Sam.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-387092">
<div class="comment-container" id="li-comment-387092">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d26ec2a1e7b8eac98179518360b88f43?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sam</span>
<span class="date">February 11, 2017 at 3:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387092" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One more question on that:<br/>
Would I also need to modify the target values (trainY) so they<br/>
contained 5 targets per sample, instead of just one  ? That is to match up the<br/>
5 RNN outputs ?</p>
<p>Thanks,</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-387114">
<div class="comment-container" id="li-comment-387114">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 11, 2017 at 5:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387114" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-386484">
<div class="comment-container" id="li-comment-386484">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/589a7d258cc382ca718790a7c85c79dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/589a7d258cc382ca718790a7c85c79dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim</span>
<span class="date">February 8, 2017 at 3:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-386484" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason<br/>
I have some question about using multivariable.</p>
<p>Did I understand correctly?<br/>
for example, if i have three variables and one window (just one day, continuous data)<br/>
data structure is In this way,</p>
<p>variable1 variable2 variable3 output1<br/>
(input_shape=(1, 3))</p>
<p>and, if i have three variables and two windows (two day, continuous data)<br/>
data structure is In this way,</p>
<p>variable1(t-1) variable2(t-1) variable3(t-1) output1(t-1)<br/>
variable1        variable2       variable3        output1<br/>
(input_shape=(2, 3))</p>
<p>is it right way? thank in advance</p>
<div class="reply">
<a aria-label="Reply to Kim" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=386484#respond" onclick='return addComment.moveForm( "comment-386484", "386484", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-387068">
<div class="comment-container" id="li-comment-387068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9e46b5217e312a32f9361172db1bf576?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9e46b5217e312a32f9361172db1bf576?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">YS_XIE</span>
<span class="date">February 11, 2017 at 1:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Many thanks to your post and tutorial. I really got the most beneficial of ideas to apply the LSTM to my problem.</p>
<p>I have some questions:<br/>
1): How to save the test data and predict dat to a text file?<br/>
2): How to save the output image ?</p>
<p>Thanks a lot.</p>
<div class="reply">
<a aria-label="Reply to YS_XIE" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=387068#respond" onclick='return addComment.moveForm( "comment-387068", "387068", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-387112">
<div class="comment-container" id="li-comment-387112">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 11, 2017 at 5:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387112" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can save data to a file using Python IO functions, npy functions for saving the matrix, or wrap it in a dataframe and save that.</p>
<p>You can save a plot using the matplotlib function savefig().</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=387112#respond" onclick='return addComment.moveForm( "comment-387112", "387112", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-387166">
<div class="comment-container" id="li-comment-387166">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d219af79b45e5891507fda4c4c2139a0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d219af79b45e5891507fda4c4c2139a0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">YS_XIE</span>
<span class="date">February 11, 2017 at 11:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387166" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your quickly reply. I have resolved the problem.</p>
<div class="reply">
<a aria-label="Reply to YS_XIE" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=387166#respond" onclick='return addComment.moveForm( "comment-387166", "387166", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-387339">
<div class="comment-container" id="li-comment-387339">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 12, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-387339" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=387339#respond" onclick='return addComment.moveForm( "comment-387339", "387339", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-388017">
<div class="comment-container" id="li-comment-388017">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony Zhang</span>
<span class="date">February 15, 2017 at 12:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388017" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason<br/>
It’s a great tutorial. I have learnt a lot from it. Thank you very much.<br/>
By the way, is it possible to use the LSTM-RNN to obtain the predictions with a probability distribution?  I think it will be even better if LSTM-RNN can do this.<br/>
Please let me know if I have the wrong thinking.</p>
<div class="reply">
<a aria-label="Reply to Tony Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388017#respond" onclick='return addComment.moveForm( "comment-388017", "388017", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-388119">
<div class="comment-container" id="li-comment-388119">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 15, 2017 at 11:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388119" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure Tony, you could use a sigmoid on the output layer and interpret it as a probability distribution.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388119#respond" onclick='return addComment.moveForm( "comment-388119", "388119", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-388138">
<div class="comment-container" id="li-comment-388138">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6f3e72c301df099f2b54b74bfb3b58?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony Zhang</span>
<span class="date">February 15, 2017 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388138" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your quickly reply.<br/>
Maybe I have asked in a wrong way. I mean like the example above, is it possible we get the probability distributions of the  predicted future passengers at the same time? In other words, how confident we are sure about the prediction accuracies.</p>
<div class="reply">
<a aria-label="Reply to Tony Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388138#respond" onclick='return addComment.moveForm( "comment-388138", "388138", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-388330">
<div class="comment-container" id="li-comment-388330">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 16, 2017 at 11:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388330" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not directly Tony.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388330#respond" onclick='return addComment.moveForm( "comment-388330", "388330", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-388068">
<div class="comment-container" id="li-comment-388068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c1f56505915b6e945224f40186b4bce4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c1f56505915b6e945224f40186b4bce4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amw 5G</span>
<span class="date">February 15, 2017 at 6:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this, it has been a great help in debugging my own keras RNN code.  A suggestion for your root LSTM for Regression with Time Steps model, as examples of what else you could do:</p>
<p>First, incorporate the month number as a predictor.  This helps with the obvious seasonality in the time series.  You can do this by creating an N-by-lookback shaped matrix where the value equals the month number (0 for January, …, 11 for December).  I did it by adjusting the create_dataset function to look like<br/>
def create_dataset(dataset, look_back=1):<br/>
	dataX, dataY, dataT = [], [], []<br/>
	for i in range(len(dataset)-look_back-1):<br/>
		a = dataset[i:(i+look_back), 0]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back, 0])<br/>
		b = [x % (12) for x in range(i, i+(look_back))] #12 because that’s how many months are in a year<br/>
		dataT.append(b)<br/>
	return numpy.array(dataX), numpy.array(dataY), numpy.array(dataT)</p>
<p>Then, feed this into an embedding layer to create a one-hot vector of 12 dimensions.  Your model will now have two branches (one for the time series and one for the vector of month indicators), that merge into a single model containing the RNN.  F. Chollet has some examples at <a href="https://keras.io/getting-started/sequential-model-guide/" rel="nofollow">https://keras.io/getting-started/sequential-model-guide/</a>.  I did it with<br/>
month_model = Sequential()<br/>
month_model.add(Embedding(12, 12, input_length=look_back))<br/>
month_model.add(GRU(output_dim=4, return_sequences=True))<br/>
month_model.add(TimeDistributed(Dense(look_back)))</p>
<p>series_model = Sequential()<br/>
series_model.add(Dense(look_back, input_shape=(look_back,1)))<br/>
model = Sequential()<br/>
model.add(Merge([month_model, series_model], mode=’concat’, concat_axis=-1))<br/>
model.add(GRU(4, return_sequences=False))<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>Lastly, I used a callback to ensure that the model didn’t overfit during the 100 epochs.  Specifically, if the loss on the validation set stopped decreasing, the model would early terminate.  I found I didn’t really need even half of the epochs, thus saving some time.  E.g.,<br/>
early_stopping = EarlyStopping(monitor=’val_loss’, patience=3)<br/>
model.fit([np.array(trainT.squeeze()),trainX], trainY.squeeze(), validation_data=([np.array(testT.squeeze()),testX],testY.squeeze()), nb_epoch=100, batch_size=1, verbose=2, callbacks=[early_stopping]) </p>
<p>Using a lookback of 3, my training set had a RMSE of 7.38, and 17.69 for the validation set.  Which I think is a pretty decent improvement with minimal additional work.</p>
<div class="reply">
<a aria-label="Reply to Amw 5G" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388068#respond" onclick='return addComment.moveForm( "comment-388068", "388068", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-388123">
<div class="comment-container" id="li-comment-388123">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 15, 2017 at 11:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388123" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very nice Amw, thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388123#respond" onclick='return addComment.moveForm( "comment-388123", "388123", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-389427">
<div class="comment-container" id="li-comment-389427">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DAN</span>
<span class="date">February 21, 2017 at 11:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389427" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, I was testing your code, when you run the function create_dataset, it gives an error:<br/>
trainX, trainY = create_dataset(train, look_back)</p>
<p>ValueError: too many values to unpack (expected 2)</p>
<div class="reply">
<a aria-label="Reply to DAN" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389427#respond" onclick='return addComment.moveForm( "comment-389427", "389427", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-389470">
<div class="comment-container" id="li-comment-389470">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 22, 2017 at 10:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389470" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dan,</p>
<p>Perhaps check that you do not have any extra white space and that you have not modified the example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389470#respond" onclick='return addComment.moveForm( "comment-389470", "389470", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-389649">
<div class="comment-container" id="li-comment-389649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">KJ</span>
<span class="date">February 23, 2017 at 9:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think you are missing some Keras dependencies.  Make sure you have:</p>
<p>from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import Embedding<br/>
from keras.layers import GRU<br/>
from keras.layers import Merge<br/>
from keras.layers import TimeDistributed<br/>
from keras.callbacks import EarlyStopping</p>
<div class="reply">
<a aria-label="Reply to KJ" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389649#respond" onclick='return addComment.moveForm( "comment-389649", "389649", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-390449">
<div class="comment-container" id="li-comment-390449">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DAN</span>
<span class="date">February 28, 2017 at 1:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390449" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The error comes from: trainX,trainY = create_dataset(train, look_back), If I remove trainY, it works…wtf</p>
<div class="reply">
<a aria-label="Reply to DAN" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390449#respond" onclick='return addComment.moveForm( "comment-390449", "390449", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-389648">
<div class="comment-container" id="li-comment-389648">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">KJ</span>
<span class="date">February 23, 2017 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389648" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice idea.</p>
<p>What do you feed into trainPredict and testPredict?</p>
<p>trainPredict = model.predict(numpy.array(trainT.squeeze()),trainX], batch_size=batch_size)<br/>
gives me an invalid syntax error.</p>
<div class="reply">
<a aria-label="Reply to KJ" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389648#respond" onclick='return addComment.moveForm( "comment-389648", "389648", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-404024">
<div class="comment-container" id="li-comment-404024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0aa0656f582943b2d0877c83c5cbb73?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0aa0656f582943b2d0877c83c5cbb73?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">IO</span>
<span class="date">June 28, 2017 at 2:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi KJ,</p>
<p>For me it worked with the following syntax:</p>
<p>trainPredict = model.predict([numpy.array(trainT.squeeze()),trainX])<br/>
testPredict = model.predict([numpy.array(testT.squeeze()),testX])</p>
<div class="reply">
<a aria-label="Reply to IO" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404024#respond" onclick='return addComment.moveForm( "comment-404024", "404024", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-404057">
<div class="comment-container" id="li-comment-404057">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2017 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404057" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it, thanks for the tip.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404057#respond" onclick='return addComment.moveForm( "comment-404057", "404057", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-402000">
<div class="comment-container" id="li-comment-402000">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/90115f82d3bcd375b5804f1a970c3678?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/90115f82d3bcd375b5804f1a970c3678?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brz</span>
<span class="date">June 9, 2017 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-402000" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Amw and Jason, </p>
<p>I have a lot of measurements of solar pannels’ production sampled every 10 minutes. </p>
<p>I would like to use these samples to predict the production for the next timestep. </p>
<p>Since the pannels are in different places, I am confident I can use the past measurements to predict a pannels future production. </p>
<p>I have used your tutorial so far, so use a few pannels’ production at T-1 to predict one pannel’s production at T. </p>
<p>Time would also be a very valuabe information to add to my model, since I have daytime related periodicity.<br/>
I am glad I found Amw’s post to handle this problem. </p>
<p>I am not really sure I fully understand how you use time in this model. Can you explain a little further what is happenning here when merging the two models ? </p>
<p>I also have a problem wih dimension. Do I need to provide a ‘time’ feature at each step that has the same length as my productions ?<br/>
Since I use several pannels’ productions at T-1, do I need to provide the model a vector with n_features times the same hour of the day ? </p>
<p>Thank you in advance for your help</p>
<div class="reply">
<a aria-label="Reply to Brz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=402000#respond" onclick='return addComment.moveForm( "comment-402000", "402000", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-403005">
<div class="comment-container" id="li-comment-403005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0aa0656f582943b2d0877c83c5cbb73?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0aa0656f582943b2d0877c83c5cbb73?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">IO</span>
<span class="date">June 19, 2017 at 2:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Amw,</p>
<p>I very much like your idea of improving this solution, but I cannot make it work. I got the same error as Dan, but instead of removing trainY I added also trainT.</p>
<p>But then I got another error: The model expects 2 arrays, but only received one array.</p>
<p>Is there any change you could upload the entire code, please?</p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to IO" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403005#respond" onclick='return addComment.moveForm( "comment-403005", "403005", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-425740">
<div class="comment-container" id="li-comment-425740">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/999db3b51c385d9af8e14bd130858968?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/999db3b51c385d9af8e14bd130858968?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carolyn</span>
<span class="date">January 6, 2018 at 3:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-425740" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Amw,</p>
<p>Great illustration of merging! As a note to future readers, the Merge layer is deprecated and was scheduled to be removed in August 2017. Recommended usage is now through keras.layers.merge.</p>
<div class="reply">
<a aria-label="Reply to Carolyn" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=425740#respond" onclick='return addComment.moveForm( "comment-425740", "425740", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-425754">
<div class="comment-container" id="li-comment-425754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 6, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-425754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some examples here:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=425754#respond" onclick='return addComment.moveForm( "comment-425754", "425754", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-388722">
<div class="comment-container" id="li-comment-388722">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HD</span>
<span class="date">February 18, 2017 at 2:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388722" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Sir,</p>
<p>This guide is amazing, but how can we use that to predict out of sample ?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to HD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388722#respond" onclick='return addComment.moveForm( "comment-388722", "388722", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-388797">
<div class="comment-container" id="li-comment-388797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 18, 2017 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-388797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Train your model on all your historical data then call model.predict().</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=388797#respond" onclick='return addComment.moveForm( "comment-388797", "388797", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-389258">
<div class="comment-container" id="li-comment-389258">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0317b0ff1dcc70bd66acde87bc50bba3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HD</span>
<span class="date">February 20, 2017 at 9:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389258" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It didn’t work for me. I’ve done: train_size = int(len(dataset) * 1)<br/>
and removed all the test data but still it does predict inside the samples.<br/>
Is there a function that I should add ?</p>
<div class="reply">
<a aria-label="Reply to HD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389258#respond" onclick='return addComment.moveForm( "comment-389258", "389258", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-389606">
<div class="comment-container" id="li-comment-389606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9bc96a84df63105e3d98f3802214cddb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9bc96a84df63105e3d98f3802214cddb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">February 23, 2017 at 4:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this great post.<br/>
I just have two questions:</p>
<p>1) What would be the code to add to show the accuracy in percentage?<br/>
2) How can I code the red line to show the next prediction at the end of the chart?</p>
<p>Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389606#respond" onclick='return addComment.moveForm( "comment-389606", "389606", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-389643">
<div class="comment-container" id="li-comment-389643">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 23, 2017 at 8:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389643" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Chris,</p>
<p>It is a regression problem so accuracy does not make sense. If it were a classification problem, the activation function in the output layer would have to be changed to sigmoid or similar. </p>
<p>You can predict the next out of sample value by training the model on all available data and calling model.predict()</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389643#respond" onclick='return addComment.moveForm( "comment-389643", "389643", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-389770">
<div class="comment-container" id="li-comment-389770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9bc96a84df63105e3d98f3802214cddb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9bc96a84df63105e3d98f3802214cddb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">February 24, 2017 at 2:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ok, I will try.<br/>
Thank you Jason 😉</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389770#respond" onclick='return addComment.moveForm( "comment-389770", "389770", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-389698">
<div class="comment-container" id="li-comment-389698">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">KJ</span>
<span class="date">February 23, 2017 at 3:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389698" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I really appreciate the time you put into this very detailed explanation of time series prediction. I think there are a couple of errors in your code, which appear to be confusing a lot of people:</p>
<p>1. When you read the file, skipfooter should = 2, not 3, as there are only two lines of data after the last value.  The existing code prevents the last value from being added to dataset.</p>
<p>2. Similarly, in create_dataset, you should not subtract 1 in the range of the for loop.  Again, this prevents the last value from being added to dataX and dataY.</p>
<p>3. Finally, you should not use the the shift train prediction, and the shift test prediction is incorrect.  This has the effect of making it appear that the prediction at t=0 instead of t+1.  I think this is why many people have been asking how to predict the last value.</p>
<p>Here is my code which both demonstrates and fixes these issues.  Please feel free to tell me I’m wrong.</p>
<p># Stacked LSTM for international airline passengers problem with memory<br/>
import numpy<br/>
import matplotlib.pyplot as plt<br/>
import pandas<br/>
import math<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM<br/>
from sklearn.preprocessing import MinMaxScaler<br/>
from sklearn.metrics import mean_squared_error</p>
<p># convert an array of values into a dataset matrix<br/>
def create_dataset(dataset, look_back=1):<br/>
	dataX, dataY = [], []<br/>
	for i in range(len(dataset)-look_back):  # – 1 IS WRONG.  IT PREVENTS LAST VALUE OF DATASET FROM BEING USED FOR dataX AND dataY<br/>
		a = dataset[i:(i+look_back), 0]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back, 0])<br/>
	return numpy.array(dataX), numpy.array(dataY)</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)</p>
<p># load the dataset<br/>
# No header on data<br/>
dataframe = pandas.read_csv(‘international-airline-passengers.csv’, usecols=[1], engine=’python’, skipfooter=2) # 3 IS WRONG AS THERE ARE ONLY TWO LINES IN THE FOOTER.  THIS PREVENTS THE LAST VALUE FROM BEING READ.<br/>
dataset = dataframe.values<br/>
dataset = dataset.astype(‘float32’)</p>
<p>print()<br/>
print(‘Last 5 values from dataset’)<br/>
print(dataset[dataset.shape[0] – 5])<br/>
print(dataset[dataset.shape[0] – 4])<br/>
print(dataset[dataset.shape[0] – 3])<br/>
print(dataset[dataset.shape[0] – 2])<br/>
print(dataset[dataset.shape[0] – 1])<br/>
print()</p>
<p># normalize the dataset<br/>
scaler = MinMaxScaler(feature_range=(0, 1))<br/>
dataset = scaler.fit_transform(dataset)</p>
<p># split into train and test sets<br/>
train_size = int(len(dataset) * 0.67)<br/>
test_size = len(dataset) – train_size<br/>
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]</p>
<p># reshape into X=t and Y=t+1<br/>
look_back = 1<br/>
trainX, trainY = create_dataset(train, look_back)<br/>
testX, testY = create_dataset(test, look_back)</p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))<br/>
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))</p>
<p># create and fit the LSTM network<br/>
batch_size = 1<br/>
model = Sequential()<br/>
model.add(LSTM(12, batch_input_shape=(batch_size, look_back, 1), stateful=True, return_sequences=True))<br/>
model.add(LSTM(12, stateful=True))<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>for i in range(1):<br/>
	model.fit(trainX, trainY, nb_epoch=1, batch_size=batch_size, verbose=0, shuffle=False) # I JUST SET VERBOSE=0 SO IT IS EASIER TO SEE THE PRINTED DATA<br/>
	model.reset_states()</p>
<p># make predictions<br/>
trainPredict = model.predict(trainX, batch_size=batch_size)<br/>
model.reset_states()<br/>
testPredict = model.predict(testX, batch_size=batch_size)</p>
<p># invert predictions<br/>
trainPredict = scaler.inverse_transform(trainPredict)<br/>
trainY = scaler.inverse_transform([trainY])<br/>
testPredict = scaler.inverse_transform(testPredict)<br/>
testY = scaler.inverse_transform([testY])</p>
<p># print the data<br/>
testX = scaler.inverse_transform(testX[:,0,0])<br/>
print()<br/>
print(‘testX’,’testY’, ‘testPredict’)<br/>
print(testX[testX.shape[0] – 5], round(testY[0, testY.shape[1] – 5]), round(testPredict[testPredict.shape[0] – 5, 0]))<br/>
print(testX[testX.shape[0] – 4], round(testY[0, testY.shape[1] – 4]), round(testPredict[testPredict.shape[0] – 4, 0]))<br/>
print(testX[testX.shape[0] – 3], round(testY[0, testY.shape[1] – 3]), round(testPredict[testPredict.shape[0] – 3, 0]))<br/>
print(testX[testX.shape[0] – 2], round(testY[0, testY.shape[1] – 2]), round(testPredict[testPredict.shape[0] – 2, 0]))<br/>
print(testX[testX.shape[0] – 1], round(testY[0, testY.shape[1] – 1]), round(testPredict[testPredict.shape[0] – 1, 0]))<br/>
print()</p>
<p># calculate root mean squared error<br/>
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))<br/>
print(‘Train Score: %.2f RMSE’ % (trainScore))<br/>
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))<br/>
print(‘Test Score: %.2f RMSE’ % (testScore))</p>
<p># shift train predictions for plotting THIS IS ALSO WRONG<br/>
#trainPredictPlot = numpy.empty_like(dataset)<br/>
#trainPredictPlot[:, :] = numpy.nan<br/>
#trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict</p>
<p>trainPredictPlot = trainPredict<br/>
testPredictPlot = testPredict</p>
<p># plot last 25 predictions<br/>
plt.figure(figsize=(10,4))<br/>
plt.title(‘Last 25 Predictions’)<br/>
datasetPlot = dataset[len(dataset) – 25:len(dataset),:]<br/>
plt.plot(scaler.inverse_transform(datasetPlot), color=’b’, label=’Actual’)<br/>
testPredictPlot = testPredictPlot[len(testPredictPlot) – 25:len(testPredictPlot),:]<br/>
plt.plot(testPredictPlot, color=’r’, label=’Prediction’)<br/>
plt.grid(True)<br/>
plt.legend()<br/>
plt.show()</p>
<p># shift test predictions for plotting THIS IS ALSO WRONG<br/>
testPredictPlot = numpy.empty_like(dataset)<br/>
testPredictPlot[:, :] = numpy.nan<br/>
testPredictPlot[len(trainPredict) + (look_back):len(dataset) – 1, :] = testPredict</p>
<p># plot baseline and predictions<br/>
plt.figure(figsize=(10,4))<br/>
plt.title(‘All Data’)<br/>
plt.plot(scaler.inverse_transform(dataset), color=’b’, label=’Actual’)<br/>
plt.plot(trainPredictPlot, color=’g’, label=’Training’)<br/>
plt.plot(testPredictPlot, color=’r’, label=’Prediction’)<br/>
plt.grid(True)<br/>
plt.legend()<br/>
plt.show()</p>
<div class="reply">
<a aria-label="Reply to KJ" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389698#respond" onclick='return addComment.moveForm( "comment-389698", "389698", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-389843">
<div class="comment-container" id="li-comment-389843">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d3e7082aadb8dccd03594f295dddd6be?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d3e7082aadb8dccd03594f295dddd6be?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.superpumpup.com" rel="external nofollow">Justin</a></span>
<span class="date">February 24, 2017 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389843" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,<br/>
I have looked through most of the comments, and not seen this pointed out, but in the “Memory Between Batches” examples, you should not do the <code>reset_state()</code> in between doing <code>predict</code> on the <code>training</code> and <code>test</code> sets.  The beginning of your test set should know that it is at the “end” of the training set, rather than at null.  </p>
<p>Thank you very much for all this, by the way, it’s been super helpful.</p>
<div class="reply">
<a aria-label="Reply to Justin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389843#respond" onclick='return addComment.moveForm( "comment-389843", "389843", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-389920">
<div class="comment-container" id="li-comment-389920">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7cd61db55208d4d73bce17c84245fcea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7cd61db55208d4d73bce17c84245fcea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">m0rtal</span>
<span class="date">February 24, 2017 at 9:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389920" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are you sure?</p>
<p>Quote:<br/>
It requires that the training data not be shuffled when fitting the network. It also requires explicit resetting of the network state after each exposure to the training data (epoch) by calls to model.reset_states(). This means that we must create our own outer loop of epochs and within each epoch call model.fit() and model.reset_states().</p>
<div class="reply">
<a aria-label="Reply to m0rtal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389920#respond" onclick='return addComment.moveForm( "comment-389920", "389920", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-389918">
<div class="comment-container" id="li-comment-389918">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7cd61db55208d4d73bce17c84245fcea?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7cd61db55208d4d73bce17c84245fcea?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">m0rtal</span>
<span class="date">February 24, 2017 at 9:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389918" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If this is a prediction, should’n plot be continued like this?<br/>
<a href="http://i90.fastpic.ru/big/2017/0224/31/9aa244bfcaebaa4cc8255d858e12d731.png" rel="nofollow">http://i90.fastpic.ru/big/2017/0224/31/9aa244bfcaebaa4cc8255d858e12d731.png</a></p>
<p>Please correct me if I’m wrong, we are predicting for look_back periods? Or just t+1?</p>
<div class="reply">
<a aria-label="Reply to m0rtal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389918#respond" onclick='return addComment.moveForm( "comment-389918", "389918", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-390090">
<div class="comment-container" id="li-comment-390090">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">KJ</span>
<span class="date">February 26, 2017 at 1:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390090" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is prediction, but the code as written doesn’t predict anything into the future.  My updated code <a href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389969" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389969</a> predicts one value into the future based on the existing data.</p>
<p>You would have to add to either code if you want to predict more than one value into the future.</p>
<div class="reply">
<a aria-label="Reply to KJ" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390090#respond" onclick='return addComment.moveForm( "comment-390090", "390090", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-389969">
<div class="comment-container" id="li-comment-389969">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/69ce35b0ed7805bdd0a5c35a3d078f02?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">KJ</span>
<span class="date">February 25, 2017 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-389969" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d appreciate it if you would delete the code from my post on February 23, 2017 at 3:29 pm.  I’ve made a couple of improvements to it, so it will make your comments section a lot shorter if people don’t have to read through all that old code.</p>
<p>The improvements are:</p>
<p>look_back = look_back + 1, ie. if the look_back is set to 1, each X will contain t-1 &amp; t, rather than just the current value (t).  If you just want one value, set look_back = 0.</p>
<p>The look_back is added to x before it is split into trainX and trainY.  This allows predictions to be made on testX[0], instead of testX[look_back].  One might argue that this is letting the model use data in the training set to make predictions, but since that is only time series data, I don’t see that as a problem.</p>
<p>The final value in the dataset is added to testX, so the model makes a prediction for 1961-01.</p>
<p>There are a lot of commented out print statements to allow people to see exactly what the data looks like.</p>
<p>Here is the updated code:</p>
<p># Stacked LSTM for international airline passengers problem with memory<br/>
import numpy<br/>
import matplotlib.pyplot as plt<br/>
import pandas<br/>
import math<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM<br/>
from sklearn.preprocessing import MinMaxScaler<br/>
from sklearn.metrics import mean_squared_error</p>
<p># convert an array of values into a dataset matrix<br/>
def create_dataset(dataset, look_back):<br/>
    dataX, dataY = [], []<br/>
    for i in range(len(dataset)- look_back):<br/>
        dataX.append(dataset[i:(i + look_back), 0])<br/>
        dataY.append(dataset[i + look_back, 0])<br/>
    return numpy.array(dataX), numpy.array(dataY)</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)</p>
<p># load the dataset<br/>
# <a href="https://datamarket.com/data/set/22u3/international-airline-passengers-monthly-totals-in-thousands-jan-49-dec-60#!ds=22u3&amp;display=line" rel="nofollow">https://datamarket.com/data/set/22u3/international-airline-passengers-monthly-totals-in-thousands-jan-49-dec-60#!ds=22u3&amp;display=line</a><br/>
 # if using a different dataset, skipfooter=2 may need to have a different value<br/>
 # and if the csv file does not have a header, add header=None<br/>
dataframe = pandas.read_csv(‘international-airline-passengers.csv’, usecols=[1], engine=’python’, skipfooter=2)<br/>
dataset = dataframe.values<br/>
dataset = dataset.astype(‘float32′)</p>
<p>”’<br/>
# this can be deleted<br/>
# print first and last values from dataset to verify data<br/>
print()<br/>
print(‘First 15 values from dataset:’)<br/>
for i in range(15):<br/>
    print(dataset[i])<br/>
print()<br/>
print(‘Last 15 values from dataset:’)<br/>
for i in range(dataset.shape[0] – 15, dataset.shape[0]):<br/>
    print(dataset[i])<br/>
”’</p>
<p># normalize the dataset<br/>
scaler = MinMaxScaler(feature_range=(0, 1))<br/>
dataset = scaler.fit_transform(dataset)</p>
<p># reshape into X=t and Y=t+1<br/>
look_back = 10<br/>
look_back += 1<br/>
trainX, trainY = create_dataset(dataset, look_back)</p>
<p># split into train and test sets<br/>
train_size = int(len(dataset) * 0.67)<br/>
test_size = len(dataset) – train_size<br/>
trainX, testX = trainX[0:train_size,:], trainX[train_size:len(trainX),:]<br/>
trainY, testY = trainY[0:train_size], trainY[train_size:len(trainY)]</p>
<p>”’<br/>
# this can be deleted<br/>
# print trainX and trainY to verify data<br/>
print()<br/>
print(‘trainX + trainY’)<br/>
for i in range(trainX.shape[0]):<br/>
    print(i + look_back, end=’ ‘)<br/>
    for c in range(look_back):<br/>
        print(trainX[i,c], end=’ ‘)<br/>
    print(trainY[i],” “)</p>
<p>print()<br/>
print(‘testX + testY’)<br/>
for i in range(testX.shape[0]):<br/>
    print(i+ look_back + trainX.shape[0], end=’ ‘)<br/>
    for c in range(look_back):<br/>
        print(testX[i,c], end=’ ‘)<br/>
    print(testY[i],” “)<br/>
”’   </p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))<br/>
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))</p>
<p># create and fit the LSTM network<br/>
batch_size = 1<br/>
model = Sequential()<br/>
model.add(LSTM(4, batch_input_shape=(batch_size, look_back, 1), stateful=True, return_sequences=True))<br/>
model.add(LSTM(4, stateful=True)) # There is no need for an batch_input_shape in the second layer<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>for i in range(100):<br/>
	model.fit(trainX, trainY, nb_epoch=1, batch_size=batch_size, verbose=0, shuffle=False) # I JUST SET VERBOSE=0 SO IT IS EASIER TO SEE THE PRINTED DATA<br/>
	model.reset_states()</p>
<p># make predictions<br/>
trainPredict = model.predict(trainX, batch_size=batch_size)<br/>
model.reset_states()</p>
<p># add last entry from dataset to be able to predict unknown testY<br/>
a = dataset[len(dataset) – look_back:len(dataset), 0]<br/>
a = numpy.reshape(a, (1, a.shape[0]))<br/>
a = numpy.reshape(a, (a.shape[0], a.shape[1], 1))<br/>
testX = numpy.append(testX, a, 0)</p>
<p>testPredict = model.predict(testX, batch_size=batch_size)</p>
<p># invert predictions<br/>
trainPredict = scaler.inverse_transform(trainPredict)<br/>
trainY = scaler.inverse_transform([trainY])<br/>
testPredict = scaler.inverse_transform(testPredict)<br/>
testY = scaler.inverse_transform([testY])</p>
<p># print next predicted value<br/>
print()<br/>
print(‘Prediction for 1961-01:’, round(testPredict[len(testPredict) – 1, 0]))</p>
<p>”’<br/>
# this can be deleted<br/>
# print testX, testY and testPredict to confirm code is working<br/>
train = scaler.inverse_transform(trainX[:,0,0])<br/>
train = numpy.reshape(train, (len(train), 1))<br/>
test = scaler.inverse_transform(testX[:,0,0])<br/>
test = numpy.reshape(test, (len(test), 1))<br/>
for c in range(1, look_back):<br/>
    train1 = scaler.inverse_transform(trainX[:,c,0])<br/>
    train1 = numpy.reshape(train1, (len(train1), 1))<br/>
    train = numpy.append(train, train1, axis = 1)<br/>
    test1 = scaler.inverse_transform(testX[:,c,0])<br/>
    test1 = numpy.reshape(test1, (len(test1), 1))<br/>
    test = numpy.append(test, test1, axis = 1)<br/>
trainX = train<br/>
testX = test<br/>
# print number of rows in data<br/>
print()<br/>
print(‘Number of values in:’)<br/>
print(‘trainX’,’trainY’, ‘trainPredict’)<br/>
print(trainX.shape[0], ‘  ‘, trainY.shape[1], ‘  ‘, trainPredict.shape[0])<br/>
print(‘testX’,’testY’, ‘testPredict’)<br/>
print(testX.shape[0], ‘  ‘, testY.shape[1], ‘  ‘, testPredict.shape[0])<br/>
# print trainX, trainY and trainPredict to verify data<br/>
print()<br/>
print(‘trainX’ , ‘          trainY’,  ‘trainPredict’)<br/>
for i in range(trainX.shape[0]):<br/>
    print(i + look_back, end=’ ‘)<br/>
    for c in range(look_back):<br/>
        print(trainX[i, c], end=’ ‘)<br/>
    print(round(trainY[0,i]), end=’ ‘)<br/>
    print(round(trainPredict[i,0]), ‘ ‘)<br/>
# print testX, testY and testPredict to verify data<br/>
print()<br/>
print(‘testX’ , ‘          testY’,  ‘testPredict’)<br/>
for i in range(testX.shape[0]):<br/>
    print(i + look_back + trainX.shape[0], end=’ ‘)<br/>
    for c in range(look_back):<br/>
        print(testX[i, c], end=’ ‘)<br/>
    if(i &lt; testX.shape[0] – 1):<br/>
        print(round(testY[0,i]), end=' ')<br/>
    else:<br/>
        print('     ', end=' ')<br/>
    print(round(testPredict[i,0]), " ")<br/>
'''</p>
<p># calculate root mean squared error<br/>
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))<br/>
print()<br/>
print('Train Score: %.2f RMSE' % (trainScore))<br/>
print()</p>
<p># THIS HAS BEEN REMOVED, BECAUSE WHEN THE LAST ENTRY IS ADDED TO testX,<br/>
# testPredict HAS MORE VALUES THAN testY, WHICH WILL THROW AN EXCEPTION<br/>
#testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))<br/>
#print('Test Score: %.2f RMSE' % (testScore))</p>
<p># shift train predictions for plotting<br/>
trainPredictPlot = numpy.empty_like(dataset) # create array with same shape as dataset<br/>
trainPredictPlot[:, :] = numpy.nan # fill with nan<br/>
trainPredictPlot[look_back:len(trainPredict) + look_back, :] = trainPredict</p>
<p># shift test predictions for plotting<br/>
testPredictPlot = numpy.empty_like(dataset) # create array with same shape as dataset<br/>
testPredictPlot[:, :] = numpy.nan # fill with nan<br/>
test = ['nan']<br/>
test = numpy.reshape(test, (len(test), 1))<br/>
testPredictPlot = numpy.append(testPredictPlot, test, 0)<br/>
testPredictPlot[len(trainPredict) + look_back:len(dataset) + 1, :] = testPredict</p>
<p># plot baseline and predictions<br/>
plt.figure(figsize=(10,4))<br/>
plt.title('All Data')<br/>
plt.plot(scaler.inverse_transform(dataset), color='b', label='Actual')<br/>
plt.plot(trainPredictPlot, color='g', label='Training')<br/>
plt.plot(testPredictPlot, color='r', label='Prediction')<br/>
plt.grid(True)<br/>
plt.grid(b=True, which='minor', axis='both')<br/>
plt.minorticks_on()<br/>
plt.legend()<br/>
plt.show()</p>
<p># zoom in on the test predictions<br/>
plt.figure(figsize=(10,4))<br/>
plt.title('Test Predictions')<br/>
'''<br/>
# the next two lines plot the data set to confirm that testY is the same as the dataset<br/>
# this can be deleted<br/>
datasetPlot = dataset[len(dataset) – len(testPredict) + 1:len(dataset),:] # subtract 24, because dataset has one less value than testPredict<br/>
plt.plot(scaler.inverse_transform(datasetPlot), color='y', label='dataset')<br/>
'''<br/>
testYPlot = numpy.reshape(testY, [testY.shape[1], 1]) # testY is [0, 47] need to change shape to [47, 0] to plot it<br/>
testYPlot = testYPlot[testYPlot.shape[0] – len(testPredict) + 1:testYPlot.shape[0]] # subtract 24, because testY has one less value than testPredict<br/>
plt.plot(testYPlot, color='b', label='testY')<br/>
testPredictPlot = testPredict[len(testPredict) – len(testPredict):len(testPredict), :]<br/>
plt.plot(testPredictPlot, color='r', label='Prediction')<br/>
plt.grid(True)<br/>
plt.grid(b=True, which='minor', axis='both')<br/>
plt.minorticks_on()<br/>
plt.legend()<br/>
plt.show()</p>
<div class="reply">
<a aria-label="Reply to KJ" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=389969#respond" onclick='return addComment.moveForm( "comment-389969", "389969", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-397538">
<div class="comment-container" id="li-comment-397538">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 9:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397538" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is nearly impossible to reproduce the original formatting of this code.<br/>
Could you provide it formatted or on Github?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397538#respond" onclick='return addComment.moveForm( "comment-397538", "397538", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-390208">
<div class="comment-container" id="li-comment-390208">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3911d0b9a21385fb2fff1adb68e2a8a5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3911d0b9a21385fb2fff1adb68e2a8a5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Robert</span>
<span class="date">February 26, 2017 at 3:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390208" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the awesome tutorial, Jason, and for being so helpful in the comments!</p>
<p>I’d like to predict into the future using time series data that has multiple observations from each date (and goes beyond a single year), and that also has multiple other features besides just the date and the label. I would also like to predict more than 1 step into the future, and to predict multiple dependent variables simultaneously if possible. I saw how to use additional features from other comments.  I also think I saw how to predict more than 1 step into the future.</p>
<p>Could you explain how I can use data with multiple observations from the same date? I’m really stuck on understanding that. If you have the time, could you also explain how to simultaneously predict multiple dependent variables? </p>
<p>One other thing…how do I normalize the data when I have multiple variables, not all of which are numbers?</p>
<div class="reply">
<a aria-label="Reply to Robert" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390208#respond" onclick='return addComment.moveForm( "comment-390208", "390208", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-390312">
<div class="comment-container" id="li-comment-390312">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">February 27, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390312" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Robert,</p>
<p>Great question. I’m working on more examples like this at the moment.</p>
<p>Generally, multiple input features is multiple multivariate time series forecasting. You can structure you data so that each column is a new feature in the LSTM format of [samples, timesteps, features].</p>
<p>A time-horizon of more than one timestep is called multi-step time series forecasting. Again, you can structure your data so that the output has multiple columns and then specify the output layer of your network with that many neurons.</p>
<p>This post might help with restructuring your data:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-supervised-learning/</a></p>
<p>This post might help with scaling your data:<br/>
<a href="http://machinelearningmastery.com/normalize-standardize-time-series-data-python/" rel="nofollow">http://machinelearningmastery.com/normalize-standardize-time-series-data-python/</a></p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390312#respond" onclick='return addComment.moveForm( "comment-390312", "390312", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-417496">
<div class="comment-container" id="li-comment-417496">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7db579d9b1650c32f387a73cb3c1fe32?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7db579d9b1650c32f387a73cb3c1fe32?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nrithya Muniswamy</span>
<span class="date">October 22, 2017 at 11:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417496" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey ,</p>
<p>Could you provide a github link to this code.</p>
<p>Regards,<br/>
Nrithya</p>
<div class="reply">
<a aria-label="Reply to Nrithya Muniswamy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417496#respond" onclick='return addComment.moveForm( "comment-417496", "417496", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-390596">
<div class="comment-container" id="li-comment-390596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b017e81052156dc8759e076b9dcf8b3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b017e81052156dc8759e076b9dcf8b3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Donald</span>
<span class="date">February 28, 2017 at 6:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>If my input file have multiple columns “open, high, low, close, volume”, how can I adapt the script to use all columns for training and then make prediction for “close” column?</p>
<div class="reply">
<a aria-label="Reply to Donald" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390596#respond" onclick='return addComment.moveForm( "comment-390596", "390596", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-390706">
<div class="comment-container" id="li-comment-390706">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 1, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-390706" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry Donald, I do not have a good tutorial for multivariate time series for you to work from. Not yet anyway.</p>
<p>Generally, the principles are the same as the univariate case. See this post on how to structure your data:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-supervised-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=390706#respond" onclick='return addComment.moveForm( "comment-390706", "390706", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-391475">
<div class="comment-container" id="li-comment-391475">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fdb65a8627cb74436f847a9e6a1edf36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fdb65a8627cb74436f847a9e6a1edf36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nilavra Pathak</span>
<span class="date">March 6, 2017 at 11:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-391475" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Nice tutorial. I recently used an LSTM forecasting. </p>
<p>I have a couple of questions. </p>
<p>1. When we are providing the training set is the LSTM which is being trained equal to the length of the training data size. For example if the training data is a sequence of 10000 values then is the LSTM equal to a 10000 length unrolled recurrent net like in this blog <a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="nofollow">http://colah.github.io/posts/2015-08-Understanding-LSTMs/</a></p>
<p>If so then shouldn’t we part up the data of sequences of smaller length like your tutorial in <a href="http://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">http://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/</a> </p>
<p>2. I see that you are normalizing the entire dataset, and the data seems to be a monotonically increasing one. So any future data may not be scaled within that range .<br/>
How will you deal with such a case, where future data value is not within the range of observed data.</p>
<div class="reply">
<a aria-label="Reply to Nilavra Pathak" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=391475#respond" onclick='return addComment.moveForm( "comment-391475", "391475", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-391609">
<div class="comment-container" id="li-comment-391609">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 7, 2017 at 9:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-391609" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Nilavra,</p>
<p>I’d recommend trying many different representations for a given perdiction problem. Try breaking it into sub-sequences, try using lag obs as features and time steps, see what works best for your problem.</p>
<p>It is a good idea to difference a dataset with a trend (changing level). Also, it is a good idea to power transform a dataset with an increasing variance (e.g. ideally boxcox or log). The dataset in this example could use both transforms.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=391609#respond" onclick='return addComment.moveForm( "comment-391609", "391609", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-391598">
<div class="comment-container" id="li-comment-391598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/52ebf7d6ff2c031a05c442928739edcb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/52ebf7d6ff2c031a05c442928739edcb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Viral Mehta</span>
<span class="date">March 7, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-391598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why do we see a discontinuity between train prediction (green) and test prediction (red)?</p>
<div class="reply">
<a aria-label="Reply to Viral Mehta" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=391598#respond" onclick='return addComment.moveForm( "comment-391598", "391598", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-391859">
<div class="comment-container" id="li-comment-391859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a380f7ad6d42f4c9fca28d2228f68c5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a380f7ad6d42f4c9fca28d2228f68c5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">anthony</span>
<span class="date">March 8, 2017 at 10:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-391859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is your lstm code performing forecasts for multiple time steps?</p>
<div class="reply">
<a aria-label="Reply to anthony" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=391859#respond" onclick='return addComment.moveForm( "comment-391859", "391859", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-392363">
<div class="comment-container" id="li-comment-392363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bd1cb326dc88e2eed6446ea74ee906ac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bd1cb326dc88e2eed6446ea74ee906ac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://arslan.tech" rel="external nofollow">Arslan</a></span>
<span class="date">March 12, 2017 at 5:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a multivariate time series in which I have fields such as business days, holidays, product launch data etc. in addition to the Y (variable to forecast). How can I implement this model using a LSTM?</p>
<p>I tried to modify the data such that my Nxm training set (trainX) contains m lags for N rows (using ‘create_dataset’ method from the code), and then concatenated the additional information ( business days, holidays, product launch data etc.) as columns. However, I realize that , it does not make sense. I will somehow have to pass a data vector in place of every Y value and its m lags ( containing the additional information: holidays, product launch data and other info). If this makes sense to you, please advise how to go about with this. Thanks</p>
<div class="reply">
<a aria-label="Reply to Arslan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392363#respond" onclick='return addComment.moveForm( "comment-392363", "392363", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-392424">
<div class="comment-container" id="li-comment-392424">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 13, 2017 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392424" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Arslan, see this post on how to structure your data as supervised learning for multivariate time series:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-supervised-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392424#respond" onclick='return addComment.moveForm( "comment-392424", "392424", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-392690">
<div class="comment-container" id="li-comment-392690">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/818deaab3fbdb485abdb8b9dc883e44b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/818deaab3fbdb485abdb8b9dc883e44b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lotusirous</span>
<span class="date">March 15, 2017 at 3:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392690" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your great article.</p>
<p>However, in your example. Why don’t you consider preprocessing methods such as: log and difference dataset? Most of research papers showed that preprocessing data can improve prediction performance.</p>
<div class="reply">
<a aria-label="Reply to lotusirous" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392690#respond" onclick='return addComment.moveForm( "comment-392690", "392690", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-392727">
<div class="comment-container" id="li-comment-392727">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 15, 2017 at 8:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392727" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree, the example would be better if the data was made stationary first (log transform and differenced). I hope to cover this with fuller examples in upcoming blog posts.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392727#respond" onclick='return addComment.moveForm( "comment-392727", "392727", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-392820">
<div class="comment-container" id="li-comment-392820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d55095b90ece809f99251a2893c2ae4f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d55095b90ece809f99251a2893c2ae4f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hobart</span>
<span class="date">March 16, 2017 at 1:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for great article!!!! I now probably can practice LSTM in code! 🙂</p>
<p>I got one question when I try to define my LSTM network. Say if I have some different datas, dataX, dataY, dataZ and try to predict/mimic dataA. Shall I use different batches or different features? (I know feature is designed for this, but it seems batch can also do the samething, am I right?)</p>
<p>dataX, dataY, dataZ, dataA all hold scalar value. </p>
<p>Another question is practical (basically python related). Say I have dataX and try to predcit dataA. dataX = [1,2,3,…n], is there any efficient way to build training dataset like [3,2,  ]. </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Hobart" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392820#respond" onclick='return addComment.moveForm( "comment-392820", "392820", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-392856">
<div class="comment-container" id="li-comment-392856">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 16, 2017 at 8:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-392856" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are many ways to represent time series data with LSTMs.</p>
<p>I’d recommend using a stateful LSTM with 1 lag variable as input and let it learn the sequence. Then try all other structures (timesteps/features) you can think of to see if you can out-perform your baseline.</p>
<p>Yes, consider using the Pandas shift() function. I offer examples in my recent time series blog posts.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=392856#respond" onclick='return addComment.moveForm( "comment-392856", "392856", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-393073">
<div class="comment-container" id="li-comment-393073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/57a8209a2a2cae41cb1041086aec60c6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/57a8209a2a2cae41cb1041086aec60c6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stefan</span>
<span class="date">March 18, 2017 at 1:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome post and simple (as it should be)!</p>
<p>What I’d like to know from this is if one could try to predict *one* signal given *n* other signals?</p>
<p>That would mean that the network learns about non-linear correlations between multiple signals and outputs a desired target signal. Can this be done using LSTM networks?</p>
<div class="reply">
<a aria-label="Reply to Stefan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393073#respond" onclick='return addComment.moveForm( "comment-393073", "393073", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-393122">
<div class="comment-container" id="li-comment-393122">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 18, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393122" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t see why not, as long is the signals are correlated.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393122#respond" onclick='return addComment.moveForm( "comment-393122", "393122", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-393225">
<div class="comment-container" id="li-comment-393225">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">klaas</span>
<span class="date">March 19, 2017 at 12:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393225" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a similar dataset. However when trying to reshape the X array into the LSTM required format i receive an error : “lstm tuple index out of range”. Searched on Google but can’t find the solution that works. Any suggestions?</p>
<div class="reply">
<a aria-label="Reply to klaas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393225#respond" onclick='return addComment.moveForm( "comment-393225", "393225", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-393256">
<div class="comment-container" id="li-comment-393256">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 19, 2017 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393256" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Check your data carefully ensure the shape you are requesting makes sense.</p>
<p>Remember, LSTMs require data in [samples, timesteps, features] format.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393256#respond" onclick='return addComment.moveForm( "comment-393256", "393256", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-393329">
<div class="comment-container" id="li-comment-393329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/43fbde48763450a6fb17ae0c25443199?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/43fbde48763450a6fb17ae0c25443199?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Apurv Verma</span>
<span class="date">March 19, 2017 at 9:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I feel like there is a delay effect happening. The shifted predicted values are closer to the value at current timestamp. Do you think there is an explanation of why that particular effect is being observed?</p>
<div class="reply">
<a aria-label="Reply to Apurv Verma" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393329#respond" onclick='return addComment.moveForm( "comment-393329", "393329", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-393471">
<div class="comment-container" id="li-comment-393471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6868885d43b2805f5b5750b58e3ea35f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6868885d43b2805f5b5750b58e3ea35f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">linamede</span>
<span class="date">March 21, 2017 at 2:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Would it be possible to learn to predict more than one steps ahead at once? For example, instead for giving past 3  data, learn to predict the future 3 data. (instead of only one future datum, as in your example)</p>
<div class="reply">
<a aria-label="Reply to linamede" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393471#respond" onclick='return addComment.moveForm( "comment-393471", "393471", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-393521">
<div class="comment-container" id="li-comment-393521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 21, 2017 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you will need to reframe your problem and specify 3 neurons in the output layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393521#respond" onclick='return addComment.moveForm( "comment-393521", "393521", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-393884">
<div class="comment-container" id="li-comment-393884">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/467d433d06b0d32d1c335b37a409099a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/467d433d06b0d32d1c335b37a409099a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sandi</span>
<span class="date">March 23, 2017 at 3:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393884" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice blog Jason!</p>
<p>In this tutorial you always give 4 output dimensions<br/>
model.add(LSTM(4, input_dim=look_back))</p>
<p>When I set the output dimension = 1, like:</p>
<p>model.add(LSTM(1, input_dim=look_back))</p>
<p>it returned error maessage:<br/>
TypeError: Cannot convert Type TensorType(float32, 3D) (of Variable Subtensor{:int64:}.0) into Type TensorType(float32, (False, False, True)). You can try to manually convert Subtensor{:int64:}.0 into a TensorType(float32, (False, False, True)).</p>
<p>Any suggestions?</p>
<div class="reply">
<a aria-label="Reply to Sandi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393884#respond" onclick='return addComment.moveForm( "comment-393884", "393884", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-393966">
<div class="comment-container" id="li-comment-393966">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 24, 2017 at 7:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-393966" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not seen this fault.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=393966#respond" onclick='return addComment.moveForm( "comment-393966", "393966", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-394012">
<div class="comment-container" id="li-comment-394012">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8bb39f4ad2d406604a8fd18e21d0c97?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8bb39f4ad2d406604a8fd18e21d0c97?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pablo Estrada</span>
<span class="date">March 24, 2017 at 12:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394012" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello! Thanks a lot for your post! I have a small question? How do I modify the network in order to predict more than one day? For example, getting the next week of the passengers What are the specific parameters I should modify to make the prediction longer?</p>
<div class="reply">
<a aria-label="Reply to Pablo Estrada" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394012#respond" onclick='return addComment.moveForm( "comment-394012", "394012", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-394094">
<div class="comment-container" id="li-comment-394094">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 25, 2017 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394094" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can reframe the problem to predict multiple days.</p>
<p>You can also call the model again and again and use predictions as input observations.</p>
<p>This post will give you some ideas:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394094#respond" onclick='return addComment.moveForm( "comment-394094", "394094", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-394083">
<div class="comment-container" id="li-comment-394083">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89652bfa48444c2907d0547a9153be91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89652bfa48444c2907d0547a9153be91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mete YALCİNER</span>
<span class="date">March 25, 2017 at 4:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394083" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you jason good article</p>
<p>But code alittle bit incorrect , if we use the network in time series problems tests array must start end of train array in first example test array starts end of train array+1 in anothers exaples test array stars end of train array+3 …. etc if our inputs  is small like 1 and 3 no problem but if our inputs big  like 170 ,200 it is big problem…… Think please we predict stocks prices our tests stars 150 days later and will give incorrect results, coz market is changable…………</p>
<p>than<br/>
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]</p>
<p>must change like this </p>
<p>train, test = dataset[0:train_size,:], dataset[train_size-look_back-1:len(dataset),:]</p>
<p>and<br/>
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict</p>
<p>must change like this</p>
<p>testPredictPlot[len(trainPredict)+look_back:len(dataset)-1, :] = testPredict</p>
<div class="reply">
<a aria-label="Reply to Mete YALCİNER" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394083#respond" onclick='return addComment.moveForm( "comment-394083", "394083", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-394084">
<div class="comment-container" id="li-comment-394084">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/89652bfa48444c2907d0547a9153be91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/89652bfa48444c2907d0547a9153be91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mete YALCİNER</span>
<span class="date">March 25, 2017 at 5:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394084" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>so sorry i must add so that 🙂 i have a predict problem i tryed last tree mounts with ANN but i did not find answer and my best MSE was e-3  , when i see your article i decided try DeepLearning  with keras now i cannot belive my eyes , my MSE has e-12 , Than Jason Tank you very much……</p>
<div class="reply">
<a aria-label="Reply to Mete YALCİNER" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394084#respond" onclick='return addComment.moveForm( "comment-394084", "394084", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-394086">
<div class="comment-container" id="li-comment-394086">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0de1d868ba90cdf0eb7d081565abbdf8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0de1d868ba90cdf0eb7d081565abbdf8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shailen</span>
<span class="date">March 25, 2017 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394086" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Can this technique work for dynamical problems as well, where the time-varying response is a function of time-varying inputs? Ultimately the model should be able to provide/predict time-varying response for any arbitrary time-varying inputs. Thanks</p>
<div class="reply">
<a aria-label="Reply to Shailen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394086#respond" onclick='return addComment.moveForm( "comment-394086", "394086", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-394234">
<div class="comment-container" id="li-comment-394234">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d78a1b61ad3016747e2a52a21c1e9ed5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d78a1b61ad3016747e2a52a21c1e9ed5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Freddie</span>
<span class="date">March 26, 2017 at 5:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394234" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi!</p>
<p>I’m trying to create a curve predictive model to generate new curves (for example, sinusoidal curves), but the problem is that when I train my model with curves with different periods, the model can only generate curves with the same period (like an average of the periods of the training set) which could be the problem?</p>
<p>thanks</p>
<div class="reply">
<a aria-label="Reply to Freddie" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394234#respond" onclick='return addComment.moveForm( "comment-394234", "394234", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-394288">
<div class="comment-container" id="li-comment-394288">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 27, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394288" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is hard to know.</p>
<p>Perhaps the problem requires a more sophisticated model or a simpler representation, or perhaps the problem is too difficult.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394288#respond" onclick='return addComment.moveForm( "comment-394288", "394288", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-394283">
<div class="comment-container" id="li-comment-394283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/86541a57000e86b5153ba12968f1ac9c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/86541a57000e86b5153ba12968f1ac9c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">George</span>
<span class="date">March 27, 2017 at 7:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason and thanks for your very nice tutorials.</p>
<p>I have this kind of problem and I wanted to ask you in which category it fits.</p>
<p>Let’s say I have a device which measures temperatures.The temperatures will have a “specific” range (I mean the source of the temprerature will be a steady source).</p>
<p>Now, I will take some thousands of temperatures vaues in the beginning and then, I want to be able to train my network , and when it sees a temperature which is not a good fit in the preious values, to reject them.</p>
<p>What kind of problem is this?Time series? Kernel density?Unsupervised cluster?</p>
<p>Thank you very much!</p>
<div class="reply">
<a aria-label="Reply to George" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394283#respond" onclick='return addComment.moveForm( "comment-394283", "394283", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-394297">
<div class="comment-container" id="li-comment-394297">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 27, 2017 at 7:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394297" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This sounds like “anomaly detection” or “change detection”, even “outlier detection”.</p>
<p>These terms will help you find good algorithms to try.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394297#respond" onclick='return addComment.moveForm( "comment-394297", "394297", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-394301">
<div class="comment-container" id="li-comment-394301">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/86541a57000e86b5153ba12968f1ac9c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/86541a57000e86b5153ba12968f1ac9c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">George</span>
<span class="date">March 27, 2017 at 8:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394301" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great!Thanks a lot!</p>
<div class="reply">
<a aria-label="Reply to George" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394301#respond" onclick='return addComment.moveForm( "comment-394301", "394301", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-394400">
<div class="comment-container" id="li-comment-394400">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 28, 2017 at 8:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394400" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome George.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394400#respond" onclick='return addComment.moveForm( "comment-394400", "394400", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-394517">
<div class="comment-container" id="li-comment-394517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">March 29, 2017 at 2:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
thank you very much for your great post.<br/>
I have a naive confusion regarding the ‘Test Score’ part.<br/>
Why we use<br/>
‘testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:, 0]))’ instead of<br/>
‘testScore = math.sqrt(mean_squared_error(test[:286], testPredict))’ ?<br/>
What’s the difference between the two?<br/>
And also I am aware that you use ‘testScore = model.evaluate(testX, testY, verbose=0)’ to trigger the ‘testScore’.<br/>
Which one is the best to evaluate our model? Could you give me some advice?<br/>
Thank you for your work. I appreciate it a lot.<br/>
Best regards.</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394517#respond" onclick='return addComment.moveForm( "comment-394517", "394517", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-394689">
<div class="comment-container" id="li-comment-394689">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e57a4b9e692c37dc1813096aaf180a67?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e57a4b9e692c37dc1813096aaf180a67?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">marm</span>
<span class="date">March 30, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394689" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, That is really  helpful post. I have a question about random walk data, Can we predict random walk data by using LSTM? I have also read your post about prediction of random walk but still believe LSTM is much better than other methods. Can you give me some advice?</p>
<div class="reply">
<a aria-label="Reply to marm" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394689#respond" onclick='return addComment.moveForm( "comment-394689", "394689", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-394710">
<div class="comment-container" id="li-comment-394710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 30, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, but I doubt you will do better than a persistence model. </p>
<p>In fact, if the data is a true random walk, then you will not do better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394710#respond" onclick='return addComment.moveForm( "comment-394710", "394710", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-394720">
<div class="comment-container" id="li-comment-394720">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cf7967d77e714e23567c82f35be9ae60?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cf7967d77e714e23567c82f35be9ae60?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fisher</span>
<span class="date">March 30, 2017 at 10:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394720" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Nice talk!  Very clear and useful, being my first guide to implement LSTM in time series prediction. I’ve followed many of your articles, thx for your sharing!</p>
<p>Only one different opinion, it seems that you do Min-Max firstly on the whole dataset before training and prediction, which I think may be improper. Because “test set” should be treated like “online” data in real world, i.e. we never know what’s coming next into our model when we do prediction. If you scale test set first, then you are actually putting information of test set into training process, this will improve model performance on test set, but obviously, it’s improper. So I think the correct pipeline should be:</p>
<p>Step 1. Split dataset into train set and test set<br/>
Step 2. Train Scaler on train set and convert train set.   i.e. trainSet_convert = scaler.fit_transform(train set)<br/>
Step 3. Train LSTM on trainSet_convert .<br/>
Step 4. Use scaler to transforms test set,   i.e.  testSet_transformed = scaler.transform(test set)<br/>
Step 5. Use LSTM to do prediction and evaluation on testSet_transformed</p>
<p>Here Step 1.~3. are training stage, Step 4.~5. are prediction stage. The main difference compared with your pipeline is that, scaler transforms test set on prediction stage, not training stage.</p>
<div class="reply">
<a aria-label="Reply to Fisher" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394720#respond" onclick='return addComment.moveForm( "comment-394720", "394720", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-394829">
<div class="comment-container" id="li-comment-394829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">March 31, 2017 at 5:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, ideally you would perform scaling on the training dataset and use the coefficients from training to scale test (e.g. min/max or stdev/mean).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394829#respond" onclick='return addComment.moveForm( "comment-394829", "394829", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-394917">
<div class="comment-container" id="li-comment-394917">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d676f5c47c4e90c67c035289ae766761?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d676f5c47c4e90c67c035289ae766761?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andrea</span>
<span class="date">March 31, 2017 at 8:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394917" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks a lot for the useful articles, really good job!</p>
<p>I just have one question: also if I’ve already seen “4 Strategies for Multi-Step Time Series Forecasting” I still can’t get how to predict more future values than my initial dataset.</p>
<p>For example: If my dataset is composed by 100 values, how I can predict the next 10 values and display it in the same way you have done in this example?</p>
<p>Thank you in advance!</p>
<div class="reply">
<a aria-label="Reply to Andrea" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394917#respond" onclick='return addComment.moveForm( "comment-394917", "394917", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-394977">
<div class="comment-container" id="li-comment-394977">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 1, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-394977" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can configure the LSTM to have 10 units in the output layer.</p>
<p>You can treat it as a many-to-one RNN or a many-to-many and use a seq2seq paradigm. </p>
<p>I have tutorials covering this scheduled for the blog.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=394977#respond" onclick='return addComment.moveForm( "comment-394977", "394977", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-395556">
<div class="comment-container" id="li-comment-395556">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ab940cb3cfc071915e1f036b645370b5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ab940cb3cfc071915e1f036b645370b5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mike Williamson</span>
<span class="date">April 7, 2017 at 1:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395556" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I went through this example, but I feel like there is something I am not understanding:  the predictions are only being provided one day in advance.</p>
<p>E.g., if we look at the generated test data (testPredict from the line</p>
<p>testPredict = model.predict(testX, batch_size=batch_size)</p>
<p>), we see that we are using testX to generate predictions.  Well, testX is merely a feature containing all the time series data, excluding the particular day we’re next trying to predict.</p>
<p>Then, once a prediction is made, that prediction is actually *ignored* when doing to subsequent prediction, and instead we use the actual data from testX.</p>
<p>So, is this model really only predicting one day in advance?  If so, how is it useful?  What am I missing  here?  I know that LSTM RNN’s are very powerful, but this example is not convincing me.</p>
<p>(FWIW, I reproduced this example by correcting it and truly using the predictions to feed the subsequent predictions, and the predictive capablility falls apart.  After a few days, it just “stabilizes” and stops moving altogether.)</p>
<div class="reply">
<a aria-label="Reply to Mike Williamson" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395556#respond" onclick='return addComment.moveForm( "comment-395556", "395556", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-395723">
<div class="comment-container" id="li-comment-395723">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pawan</span>
<span class="date">April 9, 2017 at 4:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395723" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree with you! I have raised same question in my comment below. Almost all tutorial on using ML for time series forecasting is doing this type of mistake</p>
<div class="reply">
<a aria-label="Reply to pawan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395723#respond" onclick='return addComment.moveForm( "comment-395723", "395723", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-395805">
<div class="comment-container" id="li-comment-395805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is called walk forward validation and assumes new data is available each day, at least in this domain.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395805#respond" onclick='return addComment.moveForm( "comment-395805", "395805", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-395626">
<div class="comment-container" id="li-comment-395626">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anis</span>
<span class="date">April 7, 2017 at 11:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395626" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this tuto.<br/>
There is one thing that I didn’t understand.<br/>
I want to interpret the performance of my algo using the RMSE score.<br/>
But I was always working with scores in the range of 0 and 1 which is not the case in the first example(LSTM for regression).<br/>
So please , I want some details of the score of RMSE and its significance.</p>
<p>Thank you !!!</p>
<div class="reply">
<a aria-label="Reply to Anis" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395626#respond" onclick='return addComment.moveForm( "comment-395626", "395626", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-395720">
<div class="comment-container" id="li-comment-395720">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pawan</span>
<span class="date">April 9, 2017 at 4:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395720" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>RMSE may or may not be between 0 to 1, depending upon the scale of target variable. RMSE mathematically is sum of sqaure of residuals, which in a way tells how much of variance model is not able to explain. </p>
<p>Since, we know the variance in original data we can use it to divide the RMSE, which gives Normalized RMSE or NRMSE, for a good model this quantity should always be less than 1, the closer it is to 0 the better it is. If it’s value is more than, it means that our model is introducing more variance than actually present in data, which is not the goal of any modeling exercise.</p>
<p>In statistics, 1- NRMSE is R-square, which is used to assess the goodness of a model. if R-square is closer to 1, model almost explains all the variance observed, if it is closer to 0, model does not explain any variance and in this case ‘mean’ of target variable would be much better predictor the than model itself.</p>
<p>Hope this helps!</p>
<div class="reply">
<a aria-label="Reply to pawan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395720#respond" onclick='return addComment.moveForm( "comment-395720", "395720", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395819">
<div class="comment-container" id="li-comment-395819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post shows how to implement RMSE from scratch and other performance measures:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-performance-measures-with-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-performance-measures-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395819#respond" onclick='return addComment.moveForm( "comment-395819", "395819", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-395718">
<div class="comment-container" id="li-comment-395718">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0f3a29d3a19d8b9f10dea2d66b19f9e7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">pawan</span>
<span class="date">April 9, 2017 at 3:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395718" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When forecasting for test data, I think we should not assume that lagged data is available for all testing period. By assuming it to be available, i think we are over-stating the power of LSTM for time series forecasting. </p>
<p>As per me, right method to test would be –<br/>
1. When forecasting for time t + 1, we can take t and t – 1 values from train data. Here, t being final time of train data<br/>
2. But when forecasting for t + 2, t + 1 and t has to be used, in reality we don’t know t + 1, as we have data till time ‘t’. So, forecast value of t + 1 should be used instead.<br/>
3. Step 2 will have to be repeated for time t + 3, t + 4, …..<br/>
4. Once we have forecast using steps 2 and 3 for test period, we should compare it with the actual test data to get the error</p>
<p>If above is followed, we will get much higher error than we are currently getting by assuming the availability of lagged values.</p>
<p>It would be good to know your thought on this</p>
<div class="reply">
<a aria-label="Reply to pawan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395718#respond" onclick='return addComment.moveForm( "comment-395718", "395718", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395826">
<div class="comment-container" id="li-comment-395826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree in the case when we remaking a multi-step forecast.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395826#respond" onclick='return addComment.moveForm( "comment-395826", "395826", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-395991">
<div class="comment-container" id="li-comment-395991">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anis</span>
<span class="date">April 10, 2017 at 10:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-395991" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for yours responses.<br/>
I asked this question because I follow the course Algo LSTM with Keras but using another dataset.<br/>
And I get as result RMSE= 0.01 but when  I plot the result  i found that the prediction graph are not really fiiting with our dataset.</p>
<div class="reply">
<a aria-label="Reply to Anis" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=395991#respond" onclick='return addComment.moveForm( "comment-395991", "395991", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-396203">
<div class="comment-container" id="li-comment-396203">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4c62e327109719abda35679f55d44eac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4c62e327109719abda35679f55d44eac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://freelancermap.com" rel="external nofollow">Yasmin</a></span>
<span class="date">April 12, 2017 at 4:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396203" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, thanks for such a detailed post. I thought you might like to check out a guest post we recently had on using LTSM RNNs in Keras Tendorflow for trend prediction using just 3 steps – let us know what you think…</p>
<p><a href="https://www.freelancermap.com/freelancer-tips/11865-trend-prediction-with-lstm-rnns-using-keras-tensorflow-in-3-steps" rel="nofollow">https://www.freelancermap.com/freelancer-tips/11865-trend-prediction-with-lstm-rnns-using-keras-tensorflow-in-3-steps</a></p>
<div class="reply">
<a aria-label="Reply to Yasmin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396203#respond" onclick='return addComment.moveForm( "comment-396203", "396203", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396279">
<div class="comment-container" id="li-comment-396279">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396279" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the link.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396279#respond" onclick='return addComment.moveForm( "comment-396279", "396279", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-396352">
<div class="comment-container" id="li-comment-396352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/94958954e92089b994a3fd1bb05c4c27?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/94958954e92089b994a3fd1bb05c4c27?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JD</span>
<span class="date">April 13, 2017 at 10:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial! Thank you for your effort and time Sir. </p>
<p>I think this is the one of few tutorials that actually talk about how to manage data matrix.</p>
<div class="reply">
<a aria-label="Reply to JD" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396352#respond" onclick='return addComment.moveForm( "comment-396352", "396352", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396390">
<div class="comment-container" id="li-comment-396390">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 14, 2017 at 8:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396390" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks JD.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396390#respond" onclick='return addComment.moveForm( "comment-396390", "396390", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-396467">
<div class="comment-container" id="li-comment-396467">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85ca9e2714f69ee9a4b01678d1025f61?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85ca9e2714f69ee9a4b01678d1025f61?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Srinivas</span>
<span class="date">April 15, 2017 at 2:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396467" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks a lot for the great tutorial Jason. This is super helpful. </p>
<p>However, I have one question. For the stateful LSTM when we are running the epochs manually, I understand why you are doing the <code>model.reset_states()</code> after each epoch.</p>
<p>But when we are finally doing the prediction, we run a predict on the train data and then do a reset_states() before doing a predict on the test data. </p>
<p>I think we do not need this as the test data is right after the train data temporally. So, I think we can use the previous state of the internal memory of the LSTM layer. What do you think?</p>
<p>Thanks,<br/>
Srinivas</p>
<div class="reply">
<a aria-label="Reply to Srinivas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396467#respond" onclick='return addComment.moveForm( "comment-396467", "396467", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396508">
<div class="comment-container" id="li-comment-396508">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 15, 2017 at 9:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396508" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We may.</p>
<p>See this post on seeding state in LSTMs:<br/>
<a href="http://machinelearningmastery.com/seed-state-lstms-time-series-forecasting-python/" rel="nofollow">http://machinelearningmastery.com/seed-state-lstms-time-series-forecasting-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396508#respond" onclick='return addComment.moveForm( "comment-396508", "396508", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-396664">
<div class="comment-container" id="li-comment-396664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fe5552c5ba4d2c3d69230b79c40bedb6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fe5552c5ba4d2c3d69230b79c40bedb6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dan</span>
<span class="date">April 17, 2017 at 6:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I updated to the latest version of keras and tensorflow and get extremly bad results. Any suggestions for that Jason? Did you use the latest version of tensorflow?</p>
<div class="reply">
<a aria-label="Reply to Dan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396664#respond" onclick='return addComment.moveForm( "comment-396664", "396664", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396770">
<div class="comment-container" id="li-comment-396770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 18, 2017 at 8:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-396770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider increasing the number of training epochs.</p>
<p>Consider running the example multiple times and take the average of results.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=396770#respond" onclick='return addComment.moveForm( "comment-396770", "396770", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397437">
<div class="comment-container" id="li-comment-397437">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Moha</span>
<span class="date">April 24, 2017 at 3:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397437" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, The way this post wrote very well summarise.Thanks. I’m a beginner to ML student in campus in SL. I would like to understand the code snippet what each line does, where can I get the clear idea on that ?</p>
<div class="reply">
<a aria-label="Reply to Moha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397437#respond" onclick='return addComment.moveForm( "comment-397437", "397437", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397521">
<div class="comment-container" id="li-comment-397521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This might be a good place to start:<br/>
<a href="http://machinelearningmastery.com/5-step-life-cycle-neural-network-models-keras/" rel="nofollow">http://machinelearningmastery.com/5-step-life-cycle-neural-network-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397521#respond" onclick='return addComment.moveForm( "comment-397521", "397521", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397438">
<div class="comment-container" id="li-comment-397438">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b30cd85d8f8195df03b58b16b5ec2713?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b30cd85d8f8195df03b58b16b5ec2713?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://medium.com/@prdeepak.babu/deep-learning-gender-from-name-lstm-recurrent-neural-networks-448d64553044" rel="external nofollow">Deepak</a></span>
<span class="date">April 24, 2017 at 3:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397438" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the detailed blog. this helped me apply this to predicting gender using name with minor modification to accomodate many-to-one architecture. the link can be found here<br/>
<a href="https://medium.com/@prdeepak.babu/deep-learning-gender-from-name-lstm-recurrent-neural-networks-448d64553044" rel="nofollow">https://medium.com/@prdeepak.babu/deep-learning-gender-from-name-lstm-recurrent-neural-networks-448d64553044</a></p>
<p>Thanks again! keep writing !!</p>
<div class="reply">
<a aria-label="Reply to Deepak" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397438#respond" onclick='return addComment.moveForm( "comment-397438", "397438", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397522">
<div class="comment-container" id="li-comment-397522">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397522" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done!</p>
<p>Thanks for sharing the link.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397522#respond" onclick='return addComment.moveForm( "comment-397522", "397522", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397533">
<div class="comment-container" id="li-comment-397533">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 7:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397533" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What about the so called mimicking effect described in several comments here Jason?</p>
<p>I’m new to this topic and slightly concerned.</p>
<p>Could you provide an elaborated statement in regard to this ‘critic’ (t+1 etc.)?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397533#respond" onclick='return addComment.moveForm( "comment-397533", "397533", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397625">
<div class="comment-container" id="li-comment-397625">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 26, 2017 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397625" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I refer you to this updated tutorial and compare skill to a persistence model:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397625#respond" onclick='return addComment.moveForm( "comment-397625", "397625", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-397666">
<div class="comment-container" id="li-comment-397666">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 26, 2017 at 4:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397666" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397666#respond" onclick='return addComment.moveForm( "comment-397666", "397666", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-397796">
<div class="comment-container" id="li-comment-397796">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 28, 2017 at 12:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397796" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have compared the performance, running the code on </p>
<p><a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<p>..with the performance of the recommended baseline model, consisting a persistence forecast.</p>
<p>A) Feeded with the shampoo example data  </p>
<p>The results are:</p>
<p>baseline score:  133.16 RMSE</p>
<p>LSTM simple example score: 142.44 RMSE &gt; 133.16 RMSE</p>
<p>LSTM complete example score: 107.214 RMSE &lt; 133.16 RMSE</p>
<p>B) Feeded with airline data the results are:</p>
<p>baseline score:  47.81 RMSE</p>
<p>LSTM simple example score: 44.87 RMSE  47.81 RMSE</p>
<p>What does this mean in regard to the so called mimicking effect?<br/>
And the criticism that there is actually no prediction involved.<br/>
I’ve got different results and multiple options to interpret them.<br/>
I’m a little bit confused now.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397796#respond" onclick='return addComment.moveForm( "comment-397796", "397796", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-397798">
<div class="comment-container" id="li-comment-397798">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 28, 2017 at 12:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397798" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, the parser of the forum has stripped out some of my code.</p>
<p>B) Fed with airline data the results are:</p>
<p>baseline score:  47.81 RMSE</p>
<p>LSTM simple example score: 44.87 RMSE, is less then baseline  47.81 RMSE</p>
<p>LSTM complete example score: 61.369 RMSE, is greater then baseline 47.81 RMSE</p>
<p>What does this mean in regard to the so called mimicking effect?<br/>
And the criticism that there is actually no prediction involved.<br/>
I’ve got different results and multiple options to interpret them.<br/>
I’m a little bit confused now.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397798#respond" onclick='return addComment.moveForm( "comment-397798", "397798", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-397849">
<div class="comment-container" id="li-comment-397849">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 28, 2017 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397849" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may suggest the LSTM is more skillful than persistence.</p>
<p>Neural networks will give different results each time they are run. I recommend re-running an experiment many times (30) and taking the average performance.</p>
<p>More on the stochastic nature of neural nets here:<br/>
<a href="http://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">http://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<p>I also recommend tuning the LSTM to the problem, this post may help:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397849#respond" onclick='return addComment.moveForm( "comment-397849", "397849", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397565">
<div class="comment-container" id="li-comment-397565">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 25, 2017 at 5:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397565" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Trying to adapt some versions from the user comments I get the error message:</p>
<p>“TypeError: (‘Keyword argument not understood:’, ‘input_dim’)”</p>
<p>If I try instead “input_shape” it says “int object is not iterateable”</p>
<p>Does somebody has a solution for this?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397565#respond" onclick='return addComment.moveForm( "comment-397565", "397565", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-397665">
<div class="comment-container" id="li-comment-397665">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 26, 2017 at 4:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397665" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Update: </p>
<p>There seems to be an undocumented change in the Keras-API.<br/>
Got very few infos out of the web.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397665#respond" onclick='return addComment.moveForm( "comment-397665", "397665", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397818">
<div class="comment-container" id="li-comment-397818">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">April 28, 2017 at 3:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397818" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>This a good tutorial.<br/>
The only thing which is not clear is how to predict a value that we don’t know it.In this exemple we can predict only the value in our data set and we are not able to predict futur values !!!!!!!!!!!!</p>
<p>Please I want some clarifications</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397818#respond" onclick='return addComment.moveForm( "comment-397818", "397818", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397859">
<div class="comment-container" id="li-comment-397859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 28, 2017 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can predict a future value by feeding in the last observations as input (X) to the function:</p>
<p>yhat = model.predict(X)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397859#respond" onclick='return addComment.moveForm( "comment-397859", "397859", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-397882">
<div class="comment-container" id="li-comment-397882">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 28, 2017 at 12:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397882" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I created a ‘Jason-checked’ example here…</p>
<p><a href="http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/#comment-397444" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-with-deep-learning-in-python-with-keras/#comment-397444</a></p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397882#respond" onclick='return addComment.moveForm( "comment-397882", "397882", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-397904">
<div class="comment-container" id="li-comment-397904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8eb40c4635baa6b9ad4f744084ac78fe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8eb40c4635baa6b9ad4f744084ac78fe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kaoutar</span>
<span class="date">April 28, 2017 at 6:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Thanks for sharing this great tutorial! Can you please also suggest the way to get the  forecast For example, if we want to forecast the value of the series for the next few years (ahead of current time–As we usually do for the any time series data), i have a data from 2000 to 2016 ,and i want to have the forecast for the 4 next years . Thanks</p>
<div class="reply">
<a aria-label="Reply to Kaoutar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397904#respond" onclick='return addComment.moveForm( "comment-397904", "397904", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397963">
<div class="comment-container" id="li-comment-397963">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 29, 2017 at 7:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-397963" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=397963#respond" onclick='return addComment.moveForm( "comment-397963", "397963", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-398030">
<div class="comment-container" id="li-comment-398030">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/50231b94272b720e68374bf3b5647bc6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/50231b94272b720e68374bf3b5647bc6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Luque</span>
<span class="date">April 30, 2017 at 4:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398030" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!, first your work is awesome 🙂 and I want to thank you for sharing your knowledge, I have a question, how the model can predict future valued that are not in the data set?. All the examples I have seen in the internet just mimic the last part of the data set but not predict anything. I want to predict future movements but unless I know it can be done I have not find any way to do it.<br/>
Hope you can help me to do this.<br/>
Thanks so much!.</p>
<div class="reply">
<a aria-label="Reply to Daniel Luque" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398030#respond" onclick='return addComment.moveForm( "comment-398030", "398030", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-398042">
<div class="comment-container" id="li-comment-398042">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 30, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398042" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fit the model on all available data and then call model.predict(X) where X are the last few observations.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398042#respond" onclick='return addComment.moveForm( "comment-398042", "398042", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-409449">
<div class="comment-container" id="li-comment-409449">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/547c0da3215cc244be40dd9add99567a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/547c0da3215cc244be40dd9add99567a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">James Stanford</span>
<span class="date">August 13, 2017 at 5:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409449" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Could you please give a coding example of the suggestion you made to Daniel Luque.<br/>
Thank you so much for your contributions, this is definitely the best examples I have seen on this subject.</p>
<div class="reply">
<a aria-label="Reply to James Stanford" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409449#respond" onclick='return addComment.moveForm( "comment-409449", "409449", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-409470">
<div class="comment-container" id="li-comment-409470">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 13, 2017 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409470" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For more on finalizing models, see this post:<br/>
<a href="http://machinelearningmastery.com/train-final-machine-learning-model/" rel="nofollow">http://machinelearningmastery.com/train-final-machine-learning-model/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409470#respond" onclick='return addComment.moveForm( "comment-409470", "409470", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-398115">
<div class="comment-container" id="li-comment-398115">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e436fc2e00c098237d0b2ea0e374a5cf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e436fc2e00c098237d0b2ea0e374a5cf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">cdsj</span>
<span class="date">May 1, 2017 at 2:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398115" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi jason，i follow your tutorial,program can run ,but when i change little ,the result is not my expect.<br/>
i add the “metrics=[‘accuracy’]”:<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’,metrics=[‘accuracy’])<br/>
when running,loss is down,but acc not change.why?thank you !</p>
<div class="reply">
<a aria-label="Reply to cdsj" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398115#respond" onclick='return addComment.moveForm( "comment-398115", "398115", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-398139">
<div class="comment-container" id="li-comment-398139">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 1, 2017 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398139" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is the challenge of applied machine learning.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398139#respond" onclick='return addComment.moveForm( "comment-398139", "398139", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-398185">
<div class="comment-container" id="li-comment-398185">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">May 1, 2017 at 7:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398185" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello again , </p>
<p>When I set look_back=50 and I want to predict the 51 value , I found that I must provid 52 value and no 50 values to predict the futur.</p>
<p>It is supposed to work like that ???</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398185#respond" onclick='return addComment.moveForm( "comment-398185", "398185", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-398425">
<div class="comment-container" id="li-comment-398425">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">May 3, 2017 at 7:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398425" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think that my question is important. I am confusing with this algorithme.<br/>
When we set look_back = 50 and I provide a dataset with 50 measure to predict the 51 measure, I get an error.<br/>
I only can make prediction of the 53th value using 52th measure in dataset and look_back = 50 </p>
<p>This is normal ????</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398425#respond" onclick='return addComment.moveForm( "comment-398425", "398425", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-398547">
<div class="comment-container" id="li-comment-398547">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07062bee713abad7dba252417d1306d2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">May 4, 2017 at 11:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398547" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If we add the metrics accuracy<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’ ,metrics=[‘accuracy’])<br/>
we will ntice that the accuracy is not good</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398547#respond" onclick='return addComment.moveForm( "comment-398547", "398547", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-398904">
<div class="comment-container" id="li-comment-398904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0579f02f74a31277c247d0674652b5d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0579f02f74a31277c247d0674652b5d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Edward</span>
<span class="date">May 7, 2017 at 3:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, I have been reading a lot on your blog, very helpful indeed. So first my thanks, I’m fairly new to python and machine/deep learning, but with your examples I got a good starting point. </p>
<p>I have taken one of your lstm examples and adapted it , also changing to GRU and got decent results, however I would like to improve them.<br/>
Unfortunately I couldn’t find anything on the internet which would fit what I need. </p>
<p>So my hope is that you could point me in the right direction or help…I am trying to model a time series , now my problem is that it behaves differently on different days of the week and also on bank holidays. </p>
<p>I would like to “add”information to any time series step such as Day of week , week , distance to next bank holiday and which bank holiday is the next one. I have found tf. sequence example but not sure if that is what I am looking for.<br/>
Thanks in advance and Best Regards<br/>
Ed</p>
<div class="reply">
<a aria-label="Reply to Edward" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398904#respond" onclick='return addComment.moveForm( "comment-398904", "398904", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398959">
<div class="comment-container" id="li-comment-398959">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2017 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-398959" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend providing this additional context (day or type of day) as a separate input variable.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=398959#respond" onclick='return addComment.moveForm( "comment-398959", "398959", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-399414">
<div class="comment-container" id="li-comment-399414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0579f02f74a31277c247d0674652b5d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0579f02f74a31277c247d0674652b5d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Edward</span>
<span class="date">May 12, 2017 at 1:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason, thanks for the reply.I have done exactly that now, still fiddling abit to see the effects, but I hope that ultimately with the rihgt “tuning” that this will improve the results.<br/>
Best Regards<br/>
Ed</p>
<div class="reply">
<a aria-label="Reply to Edward" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399414#respond" onclick='return addComment.moveForm( "comment-399414", "399414", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-399445">
<div class="comment-container" id="li-comment-399445">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 12, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399445" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hang in there Ed!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399445#respond" onclick='return addComment.moveForm( "comment-399445", "399445", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399406">
<div class="comment-container" id="li-comment-399406">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/96914334ff2e8fd90e898baede3d9d96?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/96914334ff2e8fd90e898baede3d9d96?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shiva</span>
<span class="date">May 11, 2017 at 10:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399406" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
When it comes to displaying the predictions in the plot, my testpredict has fewer values than test. How to fix this bug? what modifications you need to make in the code for text predict to predict the values for 1/31/1961, if the dataset ends at 12/31/1960?</p>
<div class="reply">
<a aria-label="Reply to Shiva" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399406#respond" onclick='return addComment.moveForm( "comment-399406", "399406", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399442">
<div class="comment-container" id="li-comment-399442">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 12, 2017 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399442" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could trim off the test data for which you did not make predictions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399442#respond" onclick='return addComment.moveForm( "comment-399442", "399442", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399589">
<div class="comment-container" id="li-comment-399589">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">May 14, 2017 at 12:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399589" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, excellent example.</p>
<p>I think there is a terrible mistake when you divide the dataset between training and test. I rather split that samples randomly (but sequentially). Just give it a try and check the mse:</p>
<p>60% – train set, 20% – validation set, 20% – test set:<br/>
train, validate, test = np.split(df.sample(frac=1), [int(.6*len(df)), int(.8*len(df))])</p>
<p>or</p>
<p>70% – train set, 30% – test set:<br/>
train, test = train_test_split(df, test_size=0, random_state=42)</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399589#respond" onclick='return addComment.moveForm( "comment-399589", "399589", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-399590">
<div class="comment-container" id="li-comment-399590">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">May 14, 2017 at 12:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399590" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just be sure they get sorted:</p>
<p>train.sort_index(inplace=True)<br/>
test.sort_index(inplace=True)</p>
<p>#optional<br/>
validate.sort_index(inplace=True)</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399590#respond" onclick='return addComment.moveForm( "comment-399590", "399590", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-399626">
<div class="comment-container" id="li-comment-399626">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 14, 2017 at 7:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399626" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tip! Thanks for sharing Antonio.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399626#respond" onclick='return addComment.moveForm( "comment-399626", "399626", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-399664">
<div class="comment-container" id="li-comment-399664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d98203b4067754299cf8e5b00a57a498?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">May 14, 2017 at 10:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think that it’s better if you try with more data. I don’t beleive 141 samples are good enoght to train a model… I just tried with another dataset with +3K samples and it worked really good (small RMSE) without overfitting the NN. Anyhow, these are really good posts, it helped to to get started with keras and LSTM from zero to hero in in few mintues. Just wonder if you have another post describing in details how to build the keras model…</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399664#respond" onclick='return addComment.moveForm( "comment-399664", "399664", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-399684">
<div class="comment-container" id="li-comment-399684">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 15, 2017 at 5:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399684" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Antonio, I’m really glad to hear that.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399625">
<div class="comment-container" id="li-comment-399625">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 14, 2017 at 7:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399625" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can see more about testing strategies for time series / sequence prediction here:<br/>
<a href="http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399625#respond" onclick='return addComment.moveForm( "comment-399625", "399625", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399596">
<div class="comment-container" id="li-comment-399596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a3794db73b04bdb0e768f2f64c63369?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a3794db73b04bdb0e768f2f64c63369?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://blog.andersen.im" rel="external nofollow">André C. Andersen</a></span>
<span class="date">May 14, 2017 at 1:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for you contribution. However, I’m sorry to say it, but this post doesn’t seem to show a successful LSTM model. A RMSE of 56.35 is worse than if you simply pick the input value as your prediction, which gives you a RMSE of 48.66. You can check it by running:</p>
<p>testX_ = scaler.inverse_transform(testX.reshape(1,-1))<br/>
print(“Untrained:”, numpy.sqrt(mean_squared_error(testX_.flatten(), testY.flatten())))<br/>
print(“Trained:”, numpy.sqrt(mean_squared_error(testPredict.flatten(), testY.flatten())))</p>
<p>This is hinted at in the graphs as well, where you can see your predictions goes in one-lag lockstep with the inputs, they should overlap exactly. Remember, a good time series prediction has the ability to predict change.</p>
<div class="reply">
<a aria-label="Reply to André C. Andersen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399596#respond" onclick='return addComment.moveForm( "comment-399596", "399596", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399629">
<div class="comment-container" id="li-comment-399629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 14, 2017 at 7:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree, see this post for a better approach:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399629#respond" onclick='return addComment.moveForm( "comment-399629", "399629", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399702">
<div class="comment-container" id="li-comment-399702">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ade7c783638d8f41385787801fb96a36?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ade7c783638d8f41385787801fb96a36?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Xiangpeng Wan</span>
<span class="date">May 15, 2017 at 12:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399702" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thanks for you Blog, that help me a lot in my project and understanding LSTM, by the way, I notice that in creat_dataset function, there is no need to minus one in i’s range. Or you will loose one element.</p>
<div class="reply">
<a aria-label="Reply to Xiangpeng Wan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399702#respond" onclick='return addComment.moveForm( "comment-399702", "399702", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399763">
<div class="comment-container" id="li-comment-399763">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 16, 2017 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-399763" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=399763#respond" onclick='return addComment.moveForm( "comment-399763", "399763", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400062">
<div class="comment-container" id="li-comment-400062">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4353a1c5a6642f2889846dc340b0c879?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4353a1c5a6642f2889846dc340b0c879?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Justin Jones</span>
<span class="date">May 20, 2017 at 1:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400062" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason:<br/>
Thank you so much for the great tutorial. Your blog has really taken my skills to the next level as working with Theano was very challenging in the past.</p>
<p>Quick question:<br/>
How can I modify you code to take in sequences of 2 real valued numbers (x, y coordinates) and with a look_back window of 3 to predict the time at t+1. The output should be x, y coordinates.</p>
<p>Here is the code I am using, though I am getting an error:<br/>
Error when checking model input: expected simple_rnn_1_input to have shape (None, None, 3) but got array with shape (1470, 3, 2)</p>
<p>Here is the main areas I have changed:<br/>
-pandas.read_csv reads in 2 columns of data<br/>
-Create dataset creates sets that are num_samples x time_steps x features.<br/>
-I am using the regression with time steps sample.<br/>
-Change Dense(1) to Dense(2) since expecting 2 outputs. </p>
<p>Jason:<br/>
Thank you so much for the great tutorial. Your blog has really taken my skills to the next level as working with Theano was very challenging in the past.</p>
<p>Quick question:<br/>
How can I modify you code to take in sequences of 2 real valued numbers (x, y coordinates) and with a look_back window of 3 to predict the time at t+1. The output should be length 2 for the regression of x, y coordinates of the prediction.</p>
<p>Here is the code I am using, though I am getting an error:<br/>
Error when checking model input: expected simple_rnn_1_input to have shape (None, None, 3) but got array with shape (1470, 3, 2)</p>
<p>Here is the main areas I have changed:<br/>
-pandas.read_csv reads in 2 columns of data<br/>
-Create dataset creates sets that are num_samples x time_steps x features.<br/>
-I am using the regression with time steps sample.</p>
<p># SimpleRNN that learns on a x, y<br/>
import numpy<br/>
import matplotlib.pyplot as plt<br/>
import pandas<br/>
import math<br/>
from keras.models import Sequential<br/>
from keras.layers import Dense<br/>
from keras.layers import LSTM, SimpleRNN<br/>
from sklearn.preprocessing import MinMaxScaler<br/>
from sklearn.metrics import mean_squared_error<br/>
# convert an array of values into a dataset matrix<br/>
def create_dataset(dataset, look_back=1):<br/>
	dataX, dataY = [], []<br/>
	for i in range(len(dataset)-look_back-1):<br/>
		a = dataset[i:(i+look_back), 0]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back, 0])<br/>
	return numpy.array(dataX), numpy.array(dataY)</p>
<p>def create_dataset2(dataset, look_back=1):<br/>
    dataX, dataY = [], []<br/>
    for i in range(len(dataset)-look_back-1): # go from 0 to dataset length – lookback +1<br/>
        features=[]<br/>
        set_of_features=[]<br/>
        a = dataset[i:(i+look_back), 0] # slice dataset from i to i+ lookback, column 0 (which is x)<br/>
        b = dataset[i:(i+look_back), 1] # slice dataset from i to i+ lookback, column 1 (which is y)<br/>
        for X1, X2 in zip(a, b): # create tuples, the list will be tuples of length lookback<br/>
            features=[X1,X2]<br/>
            set_of_features.append(features)    </p>
<p>        dataX.append(set_of_features)<br/>
        # now do the target (should be a tuple right after the lookback)<br/>
        dataY.append([dataset[i + look_back, 0], dataset[i + look_back, 1]])<br/>
    return numpy.array(dataX), numpy.array(dataY)</p>
<p># fix random seed for reproducibility<br/>
numpy.random.seed(7)<br/>
# load the dataset<br/>
dataframe = pandas.read_csv(‘spiral.csv’, usecols=[1,2], engine=’python’, skiprows=0, delimiter=’\t’) # tab delimited here, use the 2 columns<br/>
dataset = dataframe.values<br/>
dataset = dataset.astype(‘float32′)<br/>
# normalize the dataset<br/>
scaler = MinMaxScaler(feature_range=(0, 1))<br/>
dataset = scaler.fit_transform(dataset)<br/>
# split into train and test sets<br/>
train_size = int(len(dataset) * 0.67)<br/>
test_size = len(dataset) – train_size<br/>
train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]<br/>
# reshape into X=t and Y=t+1<br/>
look_back = 3<br/>
trainX, trainY = create_dataset2(train, look_back)<br/>
testX, testY = create_dataset2(test, look_back)<br/>
# reshape input to be [samples, time steps, features]<br/>
#trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
#testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1],  trainX.shape[2]))<br/>
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1],  testX.shape[2]))</p>
<p># create and fit the RNN network<br/>
model = Sequential()<br/>
model.add(SimpleRNN(4, input_dim=look_back))<br/>
model.add(Dense(2)) # was 1<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
model.fit(trainX, trainY, nb_epoch=100, batch_size=1, verbose=2)<br/>
# make predictions<br/>
trainPredict = model.predict(trainX)<br/>
testPredict = model.predict(testX)<br/>
# invert predictions<br/>
trainPredict = scaler.inverse_transform(trainPredict)<br/>
trainY = scaler.inverse_transform([trainY])<br/>
testPredict = scaler.inverse_transform(testPredict)<br/>
testY = scaler.inverse_transform([testY])<br/>
# calculate root mean squared error<br/>
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:,0]))<br/>
print(‘Train Score: %.2f RMSE’ % (trainScore))<br/>
testScore = math.sqrt(mean_squared_error(testY[0], testPredict[:,0]))<br/>
print(‘Test Score: %.2f RMSE’ % (testScore))<br/>
# shift train predictions for plotting<br/>
trainPredictPlot = numpy.empty_like(dataset)<br/>
trainPredictPlot[:, :] = numpy.nan<br/>
trainPredictPlot[look_back:len(trainPredict)+look_back, :] = trainPredict<br/>
# shift test predictions for plotting<br/>
testPredictPlot = numpy.empty_like(dataset)<br/>
testPredictPlot[:, :] = numpy.nan<br/>
testPredictPlot[len(trainPredict)+(look_back*2)+1:len(dataset)-1, :] = testPredict<br/>
# plot baseline and predictions<br/>
plt.plot(scaler.inverse_transform(dataset))<br/>
plt.plot(trainPredictPlot)<br/>
plt.plot(testPredictPlot)<br/>
plt.show()</p>
<div class="reply">
<a aria-label="Reply to Justin Jones" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400062#respond" onclick='return addComment.moveForm( "comment-400062", "400062", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400095">
<div class="comment-container" id="li-comment-400095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 20, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a post on multivariate forecasting with LSTMs scheduled on the blog for a few weeks time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400095#respond" onclick='return addComment.moveForm( "comment-400095", "400095", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400064">
<div class="comment-container" id="li-comment-400064">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/17be8f0538cfbb22981b5d956631571a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/17be8f0538cfbb22981b5d956631571a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Justin Jones</span>
<span class="date">May 20, 2017 at 2:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400064" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason:<br/>
Can you tell me how to modify the code to take in sequences of x,y coordinates (real values) and output the x, y coordinate at t+1?</p>
<p>Thank you for your time.</p>
<div class="reply">
<a aria-label="Reply to Justin Jones" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400064#respond" onclick='return addComment.moveForm( "comment-400064", "400064", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400096">
<div class="comment-container" id="li-comment-400096">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 20, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400096" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Frame the problem:<br/>
<a href="http://MachineLearningMastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">http://MachineLearningMastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<p>Then ensure you define your LSTM with 2 inputs on the input layer and 2 outputs on the output layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400096#respond" onclick='return addComment.moveForm( "comment-400096", "400096", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400173">
<div class="comment-container" id="li-comment-400173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f97e3d8a331d7be541e186b6bee89f94?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f97e3d8a331d7be541e186b6bee89f94?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">View</span>
<span class="date">May 21, 2017 at 7:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi. Great tutorial. Need help in adapting this to my specific problem. I have 2d data set of the dimension 100*30. where 100 is number of different company stocks and 30 is the stock price of each company for 30 consecutive days. Please help in understaning the input dimension of the LSTM in keras for predicting the stock price of 100 different companies in next 10 days.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to View" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400173#respond" onclick='return addComment.moveForm( "comment-400173", "400173", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400234">
<div class="comment-container" id="li-comment-400234">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 22, 2017 at 7:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400234" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The expected input structure is [samples, timesteps, features]. </p>
<p>Each series is a different feature. Time steps are the ticks or movements. You may need to split each series into sub-sequences, e.g. 200-400 timesteps long. In that case, each sub-sequence will be a sample.</p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400234#respond" onclick='return addComment.moveForm( "comment-400234", "400234", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400380">
<div class="comment-container" id="li-comment-400380">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5316804f3c832fbfb66f8b57ab43e8c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5316804f3c832fbfb66f8b57ab43e8c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ethels</span>
<span class="date">May 23, 2017 at 9:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400380" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>I discovered that in <a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a> there is no implementation of differencing, yet the example has seasonal and trend variations. Is it ok to just model your LSTM and predict as you have done in this example without differencing, what is the implications?</p>
<p>Thank you very much</p>
<div class="reply">
<a aria-label="Reply to Ethels" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400380#respond" onclick='return addComment.moveForm( "comment-400380", "400380", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400403">
<div class="comment-container" id="li-comment-400403">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 24, 2017 at 4:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400403" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, it is best to difference the data and in this case also use a log transform.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400403#respond" onclick='return addComment.moveForm( "comment-400403", "400403", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400603">
<div class="comment-container" id="li-comment-400603">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dab32353bb8297ce62a4305877d54538?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dab32353bb8297ce62a4305877d54538?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ismail</span>
<span class="date">May 27, 2017 at 2:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400603" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>That is really amazing work, but is all the cases you showed, the data is always numeric. I have regression problem (label is a float) but I have multi type data (strings and numerics). How can I use string properly instead of mapping them a random integer ?<br/>
Thank you</p>
<div class="reply">
<a aria-label="Reply to ismail" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400603#respond" onclick='return addComment.moveForm( "comment-400603", "400603", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401145">
<div class="comment-container" id="li-comment-401145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 11:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Strings will have to be mapped to integers (chars or words), sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401145#respond" onclick='return addComment.moveForm( "comment-401145", "401145", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400652">
<div class="comment-container" id="li-comment-400652">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e19c32269d6c7a24a9ddfdeb518ac544?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e19c32269d6c7a24a9ddfdeb518ac544?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luis</span>
<span class="date">May 28, 2017 at 12:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400652" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason.</p>
<p>I see that LSTM is a powerful model which can get better results than classic time series models like ARIMA in some circumstances, but… is it possible to have something similar to confidence intervals for the predictions? is only possible to obtain point forecasts?</p>
<div class="reply">
<a aria-label="Reply to Luis" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400652#respond" onclick='return addComment.moveForm( "comment-400652", "400652", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401154">
<div class="comment-container" id="li-comment-401154">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401154" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, I’m not sure off hand. </p>
<p>Perhaps you could use the bootstrap method with multiple repeats of fitting the model and making predictions?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401154#respond" onclick='return addComment.moveForm( "comment-401154", "401154", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400777">
<div class="comment-container" id="li-comment-400777">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5b8f108e7589f142f513e1ea322a244e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5b8f108e7589f142f513e1ea322a244e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chester</span>
<span class="date">May 30, 2017 at 2:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400777" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr.Brownlee, </p>
<p>Thanks for the tutorial!</p>
<p>I am struggling to understand the shifting done on the predicted data, namely why do we shift by that particular amount? </p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Chester" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400777#respond" onclick='return addComment.moveForm( "comment-400777", "400777", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-400791">
<div class="comment-container" id="li-comment-400791">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/38093ffc752654a3e2174ac3b0a2d7f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/38093ffc752654a3e2174ac3b0a2d7f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hutauf</span>
<span class="date">May 30, 2017 at 7:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400791" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your plot looks like your prediction for both test and train data is lacking 1 datapoint behind – which is exactly what is known to the network. A “predictor” that would just return the input, so lets assume this function:<br/>
def predict(x):<br/>
    return x<br/>
would also “follow” the curve, but is not very intelligent. A better prediction would be to use the prediction of t=t0 as an input to the prediction at t=t0+1, then use this output as input for t=t0+2 and so on. Just like what you did here:<br/>
<a href="http://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">http://machinelearningmastery.com/text-generation-lstm-recurrent-neural-networks-python-keras/</a></p>
<p>I hope you could grasp what I mean. Thanks for your thoughts.</p>
<div class="reply">
<a aria-label="Reply to hutauf" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400791#respond" onclick='return addComment.moveForm( "comment-400791", "400791", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400857">
<div class="comment-container" id="li-comment-400857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87f39acf7ecdbf7885e323592c3acade?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87f39acf7ecdbf7885e323592c3acade?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Roshan Silva</span>
<span class="date">May 31, 2017 at 4:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome post!!!!</p>
<p>I’m trying to apply this for a dengue prediction system. The problem is to determine number of dengue patients in a given week (time series prediction), given the attributes (humidity, temperature for that week).<br/>
I set trainX to input features and trainY to number of dengue patients.<br/>
So the trainX has the format (attribute1, attribute2, .. attributen) whereas trainY is a  vector containing number of patients.<br/>
The model predicts some output, but the mean square error is very high.<br/>
Is there any way to improve? </p>
<p>and in dengue prediction, we should relay on time steps since number of dengue patients in a given week depends on number dengue patients in the previous week. But the problem is unlike the problem in this post, I don’t have the actual number of patients for a given week for the test data set. In this case, how can I use “LSTM for Regression with Time Steps” for my problem?</p>
<p>Thanks in advance</p>
<div class="reply">
<a aria-label="Reply to Roshan Silva" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400857#respond" onclick='return addComment.moveForm( "comment-400857", "400857", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401209">
<div class="comment-container" id="li-comment-401209">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401209" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post may give you some ideas:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401209#respond" onclick='return addComment.moveForm( "comment-401209", "401209", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400915">
<div class="comment-container" id="li-comment-400915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eafb21e1826da4acb4d6401d97cf954f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eafb21e1826da4acb4d6401d97cf954f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ammar Sohail</span>
<span class="date">May 31, 2017 at 4:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-400915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>You are amazing. </p>
<p>I am very new to machine learning and Keras. I have one task to be completed. In it, my input is vector of size 19 (features) and I have 2000 samples (rows of data) and I would want to predict single output value. I am little bit confused in how to create and fit LSTM network that is suitable for this scenario.<br/>
What would be the parameters to the LSTM layer while adding it to the model like, units, input_shape?<br/>
Basically its a time series regression analysis using LSTMs.</p>
<p>Can you please provide me with some help.</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Ammar Sohail" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=400915#respond" onclick='return addComment.moveForm( "comment-400915", "400915", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401216">
<div class="comment-container" id="li-comment-401216">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401216" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The input shape is [samples, timesteps, features], your number of features is 19.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401216#respond" onclick='return addComment.moveForm( "comment-401216", "401216", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-401857">
<div class="comment-container" id="li-comment-401857">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fc890d9acb48193b81ba844183a84c72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fc890d9acb48193b81ba844183a84c72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sara</span>
<span class="date">June 8, 2017 at 12:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401857" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thanks for your beautiful article.I tried this with some other data set(it has some negative values too), the result was excellent but the only problem was in predicting negative part!I mean in some place at future the line is going below x-axis(negative part) in actual graphs but when the algorithm tries to predict that it goes until x=0 and then return to the positive area of the y-axis.Could you help me why this happens?</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Sara" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401857#respond" onclick='return addComment.moveForm( "comment-401857", "401857", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-401925">
<div class="comment-container" id="li-comment-401925">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fc890d9acb48193b81ba844183a84c72?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fc890d9acb48193b81ba844183a84c72?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sara</span>
<span class="date">June 9, 2017 at 4:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401925" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>And also I saw this question (a lot of time) above in the article but I could not find any answer for that.What should we do if we want to predict more step in the future like future 2-month prediction?If there is any other tutorial about this, please let me know.</p>
<div class="reply">
<a aria-label="Reply to sara" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401925#respond" onclick='return addComment.moveForm( "comment-401925", "401925", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-401948">
<div class="comment-container" id="li-comment-401948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Call model.predict()</p>
<p>You can better understand how to make predictions with LSTMs here:<br/>
<a href="http://machinelearningmastery.com/5-step-life-cycle-long-short-term-memory-models-keras/" rel="nofollow">http://machinelearningmastery.com/5-step-life-cycle-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401948#respond" onclick='return addComment.moveForm( "comment-401948", "401948", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401932">
<div class="comment-container" id="li-comment-401932">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401932" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider scaling your data first to the range 0-1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401932#respond" onclick='return addComment.moveForm( "comment-401932", "401932", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-401914">
<div class="comment-container" id="li-comment-401914">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab864b1ee594617b17b345865e7bff9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab864b1ee594617b17b345865e7bff9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Goran Alioz</span>
<span class="date">June 9, 2017 at 2:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401914" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason and All,<br/>
Sorry if my question is too basic, how can I separate the training from the test please? I need to run them separately but failed to understand what output comes out of the training and what I need to feed in to the predict function in another file? Any Clues? I mean if it’s possible in the first place of course.<br/>
Many thanks,<br/>
Goran</p>
<div class="reply">
<a aria-label="Reply to Goran Alioz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401914#respond" onclick='return addComment.moveForm( "comment-401914", "401914", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401945">
<div class="comment-container" id="li-comment-401945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-401945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for a tutorial:<br/>
<a href="http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=401945#respond" onclick='return addComment.moveForm( "comment-401945", "401945", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-402053">
<div class="comment-container" id="li-comment-402053">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/82fbbafe36e0c25746940254bc81a070?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/82fbbafe36e0c25746940254bc81a070?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sara</span>
<span class="date">June 10, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-402053" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Thanks for your interesting tutorial.<br/>
I have a question ,I’m thinking about some interesting project but I’m not sure if it is possible by using LSTM model in Keras or not,could you help me please.<br/>
I have some noisy signal and then by using some filtering method I make it smooth to get information from pure noise,right now the method which I’m using is so time consuming.<br/>
So I want to try it like your method here,the only thing is that I should give noisy signal as an input to my NN and then it should train himself by whatever I had in smooth information(which I got from filtering method)then it should predict future smoothing part base of raw signal.Do you have any idea about?</p>
<p>Thank you so much</p>
<div class="reply">
<a aria-label="Reply to Sara" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=402053#respond" onclick='return addComment.moveForm( "comment-402053", "402053", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402084">
<div class="comment-container" id="li-comment-402084">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 10, 2017 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-402084" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try it and see. Neural networks are generally good at handling noisy inputs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=402084#respond" onclick='return addComment.moveForm( "comment-402084", "402084", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-402635">
<div class="comment-container" id="li-comment-402635">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3b1e64d9d45d736ad1b59931721782ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3b1e64d9d45d736ad1b59931721782ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hugo</span>
<span class="date">June 15, 2017 at 10:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-402635" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the great post. Can you help understand a few doubts?<br/>
1 – Why choose the mean-max scaler from 0 to 1? Why not use the standardization instead? Does this have to do with sigmoid? What would be the optimal choice for Relu or Tanh?<br/>
2 – By scaling the entire dataset, are not we incurring in lookahead bias? Should not the fit be done on train dataset and use this fit to transform the test dataset?<br/>
3 – In the statefull example you mention “need to be trained for more epochs to internalize the structure of the problem.”. Does not this usually lead to overfitting instead?<br/>
4 – Is it possible to query the state of the lstm in keras/tensorflow?</p>
<p>Once again thanks for making ltsm and keras easier to understand and experiment.</p>
<div class="reply">
<a aria-label="Reply to Hugo" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=402635#respond" onclick='return addComment.moveForm( "comment-402635", "402635", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402695">
<div class="comment-container" id="li-comment-402695">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 7:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-402695" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Hugo,</p>
<p>I find the 0-1 scaling works well. Try standardizing and let me know how you go. Test everything!</p>
<p>Correct. I scaled all at once for simplicity of the example. Develop transforms on train data and apply to all test/validation/new data.</p>
<p>Yes, it can.</p>
<p>Not sure, I expect you can. See here:<br/>
<a href="https://github.com/fchollet/keras/issues/2593" rel="nofollow">https://github.com/fchollet/keras/issues/2593</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=402695#respond" onclick='return addComment.moveForm( "comment-402695", "402695", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-403049">
<div class="comment-container" id="li-comment-403049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ec8c1b92009e57f3c9dd4071bafba885?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ec8c1b92009e57f3c9dd4071bafba885?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mateus</span>
<span class="date">June 19, 2017 at 2:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the tutorial, but to get the real RMSE, shouldn’t you shift the predicted values 1 step back to compare with the actual values?<br/>
Putting in the code, will be:<br/>
trainScore = math.sqrt(mean_squared_error(trainY[0][:-1], trainPredict[1:,0]))<br/>
testScore = math.sqrt(mean_squared_error(testY[0][:-1], testPredict[1:,0]))<br/>
I’m getting values below 10 RMSE with this fix</p>
<div class="reply">
<a aria-label="Reply to Mateus" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403049#respond" onclick='return addComment.moveForm( "comment-403049", "403049", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-403078">
<div class="comment-container" id="li-comment-403078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/20646ac7b44735c884d4c1a276e799d1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/20646ac7b44735c884d4c1a276e799d1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Juan</span>
<span class="date">June 20, 2017 at 1:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It was great help for me!! But I have some problems. After using MinMaxScaler, I got some </p>
<p>trouble in scaling part. How to deal with this problem?</p>
<p>&gt;&gt;&gt; dataset = scaler.fit_transform(dataset)<br/>
Traceback (most recent call last):<br/>
  File “”, line 1, in<br/>
  File “C:\Users\01029\Anaconda3\envs\tensorflow\lib\site-packages\sklearn\base.py”, line 494, in fit_transform<br/>
    return self.fit(X, **fit_params).transform(X)<br/>
  File “C:\Users\01029\Anaconda3\envs\tensorflow\lib\site-packages\sklearn\preprocessing\data.py”, line 292, in fit<br/>
    return self.partial_fit(X, y)<br/>
  File “C:\Users\01029\Anaconda3\envs\tensorflow\lib\site-packages\sklearn\preprocessing\data.py”, line 318, in partial_fit<br/>
    estimator=self, dtype=FLOAT_DTYPES)<br/>
  File “C:\Users\01029\Anaconda3\envs\tensorflow\lib\site-packages\sklearn\utils\validation.py”, line 416, in check_array<br/>
    context))<br/>
ValueError: Found array with 0 sample(s) (shape=(0, 0)) while a minimum of 1 is required by MinMaxScaler.</p>
<div class="reply">
<a aria-label="Reply to Juan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403078#respond" onclick='return addComment.moveForm( "comment-403078", "403078", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403127">
<div class="comment-container" id="li-comment-403127">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 20, 2017 at 6:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403127" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Confirm your data was loaded correctly.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403127#respond" onclick='return addComment.moveForm( "comment-403127", "403127", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403355">
<div class="comment-container" id="li-comment-403355">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87ae5721fe27abd8d578d261977bb6f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87ae5721fe27abd8d578d261977bb6f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HERVE NSANGU</span>
<span class="date">June 22, 2017 at 4:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403355" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, thank you very much for your rich tutorial. In fact, I am a student of Master 2 in Intelligent System and Multimedia in Vietnam at the Institut Francophone International. I have a concern! I am working on a project to find a causal relationship between climatic factors (I have 7 input climatic factors) and the epidemic of dengue (which will be out) in Southeast Asia for a period Of 1994 – 2010 using Deep Learning! But, I’m not sure what Deep Learning approach to use! I have documented a little, many books say that “the causal relationship Deep learning uses unsupervised learning”. I would like you to help me by pointing out which Deep learning approach used especially as these are very complex approaches! Thank you…</p>
<div class="reply">
<a aria-label="Reply to HERVE NSANGU" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403355#respond" onclick='return addComment.moveForm( "comment-403355", "403355", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403374">
<div class="comment-container" id="li-comment-403374">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2017 at 6:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-403374" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I am not aware of work using deep learning for causal models.</p>
<p>Supervised learning solves the problem of induction (e.g. think correlation, not causation).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=403374#respond" onclick='return addComment.moveForm( "comment-403374", "403374", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-406542">
<div class="comment-container" id="li-comment-406542">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87ae5721fe27abd8d578d261977bb6f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87ae5721fe27abd8d578d261977bb6f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HERVE NSANGU</span>
<span class="date">July 20, 2017 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-406542" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excuse me for the derangement again, so, if I understand correctly, the causality of time series is not feasible in supervised learning as unsupervised for deep learning?<br/>
For example, I used the granger causality method for the same subject and I would like to use deep learning to solve problems!</p>
<p>It is not possible!?</p>
<div class="reply">
<a aria-label="Reply to HERVE NSANGU" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=406542#respond" onclick='return addComment.moveForm( "comment-406542", "406542", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-404036">
<div class="comment-container" id="li-comment-404036">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/608de44a6fcfe9b8727ccc70c9f2c90f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/608de44a6fcfe9b8727ccc70c9f2c90f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Roman</span>
<span class="date">June 28, 2017 at 5:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404036" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are we leaking data here when we’re normalizing the entire dataset with MinMaxScaler? Thanks</p>
<div class="reply">
<a aria-label="Reply to Roman" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404036#respond" onclick='return addComment.moveForm( "comment-404036", "404036", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-404058">
<div class="comment-container" id="li-comment-404058">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2017 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404058" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is a limitation of the tutorial – a tradeoff for brevity.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404058#respond" onclick='return addComment.moveForm( "comment-404058", "404058", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-404117">
<div class="comment-container" id="li-comment-404117">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c2e2ea0289be01ae44af29096d1e7ca1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c2e2ea0289be01ae44af29096d1e7ca1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">June 28, 2017 at 9:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404117" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, thank you for this great tutorial. I am using the above LSTM code to try to predict the next day’s change in a stock value (I made it a classification problem where I assign different classes to specific ranges of values). I am using multiple features and some of them have large values.</p>
<p>I tried running the algorithm normally and got terrible results. However, when I stopped normalizing my dataset, my accuracy improved a lot.</p>
<p>What do you think might be the reason behind that? Is it the normalization technique that might not be right? I would like to hear your input! </p>
<p>Again, thank you so much!</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404117#respond" onclick='return addComment.moveForm( "comment-404117", "404117", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-404177">
<div class="comment-container" id="li-comment-404177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 29, 2017 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done.</p>
<p>I have no idea, it depends on the data and on the network config.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404177#respond" onclick='return addComment.moveForm( "comment-404177", "404177", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-417065">
<div class="comment-container" id="li-comment-417065">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2fc3af3b73422e6df5e4048a4acdc7a5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2fc3af3b73422e6df5e4048a4acdc7a5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vedant</span>
<span class="date">October 18, 2017 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417065" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Michael, can you please send me the code on how you’re doing the next day’s prediction? </p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Vedant" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417065#respond" onclick='return addComment.moveForm( "comment-417065", "417065", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-404741">
<div class="comment-container" id="li-comment-404741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c77f39b13286ee07f7a12e25f0517a09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c77f39b13286ee07f7a12e25f0517a09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Cristine</span>
<span class="date">July 5, 2017 at 12:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, very nice lesson!</p>
<p>My questions is: when the LSTM does the next prediction, does it look at the actual test values? or it looks at the previous predicted value? Because I guess the error is higher when the prediction is made on previous predicted values (because they will be a little different than the actual test values each time)</p>
<div class="reply">
<a aria-label="Reply to Cristine" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404741#respond" onclick='return addComment.moveForm( "comment-404741", "404741", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404891">
<div class="comment-container" id="li-comment-404891">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 6, 2017 at 10:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-404891" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model approximates a function with inputs (lag obs) and an output (prediction). You can define what the model takes as input (input_shape and data preparatation).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=404891#respond" onclick='return addComment.moveForm( "comment-404891", "404891", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-405036">
<div class="comment-container" id="li-comment-405036">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">amal</span>
<span class="date">July 7, 2017 at 9:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405036" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In lstm using windows methode netwrok how the weighs are adjusted in the hidden layers because in the other architectures we have: </p>
<p>w_(ht) = the weights between the hidden layers of each time step and the input how we can do it for one to many architecture here we have one time step im confused</p>
<p>this method can be considered as one to many architecture</p>
<p>thank you</p>
<div class="reply">
<a aria-label="Reply to amal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=405036#respond" onclick='return addComment.moveForm( "comment-405036", "405036", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-405141">
<div class="comment-container" id="li-comment-405141">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5157ac41fed8b81fe74fa4931ec5c27f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amal</span>
<span class="date">July 8, 2017 at 7:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405141" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi , thank you for this tuto.</p>
<p>My question is a bit theoric.</p>
<p>How the activationq of hidden neurones are calculated. in lstm with windows</p>
<p>In lstm with time steps.</p>
<p>H(t) = x-t × whx + whh × h(t-1), in this case what is our h(t-1)</p>
<p>It can be a one to many architecture ?</p>
<div class="reply">
<a aria-label="Reply to Amal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=405141#respond" onclick='return addComment.moveForm( "comment-405141", "405141", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-405562">
<div class="comment-container" id="li-comment-405562">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maryam Rad</span>
<span class="date">July 12, 2017 at 3:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-405562" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there any explanation for the gap that is in diagrams in predictions parts?<br/>
I mean in green and red lines there is a gap in start and end…</p>
<div class="reply">
<a aria-label="Reply to Maryam Rad" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=405562#respond" onclick='return addComment.moveForm( "comment-405562", "405562", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-407246">
<div class="comment-container" id="li-comment-407246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fd9a318c3bd3641ab6473ea7da9eb790?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fd9a318c3bd3641ab6473ea7da9eb790?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nirav Dalal</span>
<span class="date">July 25, 2017 at 2:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason – Thanks for the post.<br/>
My question is at a more macro level. I am trying to create a ensemble system of forecasting which will use both traditional ARIMA/ARIMAX and the NeuralNet models. But from what I have read in the literature is that the NNs only perform marginally better than traditional ARIMA, while in some cases ARIMA is better. Now given that NNs need a lot of set up and training time, is there really a benefit in using NNs for Forecasting problems ? Can you guide me to resources/URLs where they have shown the advantages of NNs over ARIMA?</p>
<p>Thanks,<br/>
Nirav.</p>
<div class="reply">
<a aria-label="Reply to Nirav Dalal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407246#respond" onclick='return addComment.moveForm( "comment-407246", "407246", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407313">
<div class="comment-container" id="li-comment-407313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2017 at 7:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post (and the refs/links it contains):<br/>
<a href="http://machinelearningmastery.com/promise-recurrent-neural-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/promise-recurrent-neural-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407313#respond" onclick='return addComment.moveForm( "comment-407313", "407313", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407366">
<div class="comment-container" id="li-comment-407366">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">July 26, 2017 at 1:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407366" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I have a question about time-series.<br/>
If I have time series data like in every 1 minute, can my data be implemented like above code to predict values?</p>
<p>Also, I have one more question that is time series prediction with LSTM and RNN playing only<br/>
with just one column of input data??</p>
<p>Thank you for helping and posting blogs for us.</p>
<p>Best,<br/>
Paul</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407366#respond" onclick='return addComment.moveForm( "comment-407366", "407366", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407389">
<div class="comment-container" id="li-comment-407389">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2017 at 4:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407389" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, LSTMs could be used.<br/>
Yes, LSTMs can be used with multiple input or output features.</p>
<p>I caution you to develop a baseline with a linear model and an MLP to see if in fact the LSTM will add value on your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407389#respond" onclick='return addComment.moveForm( "comment-407389", "407389", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-407412">
<div class="comment-container" id="li-comment-407412">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">July 26, 2017 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407412" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for replying me back Jason! 🙂 It helps me a lot! 🙂<br/>
Do you know why my error appears like that?</p>
<p>Thank you so much for helping! 🙂</p>
<p>Best,<br/>
Paul</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407412#respond" onclick='return addComment.moveForm( "comment-407412", "407412", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-407404">
<div class="comment-container" id="li-comment-407404">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">July 26, 2017 at 6:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407404" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Also when I applied your example to mine,  </p>
<p>trainX = np.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
testX = np.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</p>
<p>it gives me an error as follows,</p>
<p>ValueError: Error when checking : expected lstm_6_input to have 3 dimensions, but got array with shape (1, 1)</p>
<p>what is the problem..?</p>
<p>Best,<br/>
Paul</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407404#respond" onclick='return addComment.moveForm( "comment-407404", "407404", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-407475">
<div class="comment-container" id="li-comment-407475">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407475" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Confirm the same of your training data is 3d [samples, timesteps, features].</p>
<p>Confirm the input layer (input_shape) of your model specifies the same number of time steps and features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407475#respond" onclick='return addComment.moveForm( "comment-407475", "407475", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-408144">
<div class="comment-container" id="li-comment-408144">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">August 1, 2017 at 5:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408144" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason! 🙂 It helps me a lot.<br/>
I have one more question. (Sorry for bothering..)<br/>
If I want to add more hidden layer from </p>
<p>    model.add(LSTM(4, input_shape=(1, look_back)))<br/>
    model.add(Dense(1))<br/>
    model.compile(loss=’mean_squared_error’, optimizer=’adam’)</p>
<p>Then should I just add model.add(Dense(150), activation = ‘sigmoid’) between LSTM block line and Dense(1) line if want to add hidden layer?</p>
<p>What if I want to add one more LSTM block before output? Can I do that?</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408144#respond" onclick='return addComment.moveForm( "comment-408144", "408144", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-408215">
<div class="comment-container" id="li-comment-408215">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408215" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend adding more LSTMs not more Dense.</p>
<p>LSTMs need a 3D input, which means that the prior LSTM layer will need to return a sequence (3D) rather than a final state vector  (2D) as output. You can do this by setting return_states=True in the previous layer.</p>
<p>I hope that helps.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-408284">
<div class="comment-container" id="li-comment-408284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d0dc4739fd3aa8cbd25fe69a64426e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">August 2, 2017 at 6:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for replying me back! 🙂 Ah ha I see.</p>
<p>Thanks so much for helping me out! 🙂</p>
<p>Best,<br/>
Paul</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408284#respond" onclick='return addComment.moveForm( "comment-408284", "408284", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-408349">
<div class="comment-container" id="li-comment-408349">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2017 at 6:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408349" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome Paul.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-407409">
<div class="comment-container" id="li-comment-407409">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akshay kulkarni</span>
<span class="date">July 26, 2017 at 6:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407409" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, Thanks for the wonderful tutorial.<br/>
wondering how to forecast for the future dates after creating the model.</p>
<p>Say for example: now we have air passengers  till some dates and i want to forecast for next 10 years.</p>
<p>How do i do it?</p>
<p>Explanation is much appreciated</p>
<div class="reply">
<a aria-label="Reply to Akshay kulkarni" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407409#respond" onclick='return addComment.moveForm( "comment-407409", "407409", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-407477">
<div class="comment-container" id="li-comment-407477">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2017 at 7:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407477" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post on training a final model:<br/>
<a href="http://machinelearningmastery.com/train-final-machine-learning-model/" rel="nofollow">http://machinelearningmastery.com/train-final-machine-learning-model/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407477#respond" onclick='return addComment.moveForm( "comment-407477", "407477", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-410450">
<div class="comment-container" id="li-comment-410450">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akshay kulkarni</span>
<span class="date">August 21, 2017 at 9:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410450" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Thanks for your reply.</p>
<p>Wondering how that link is helpful for our case.</p>
<p>To make it more clear: In the above example there is no forecasting for future dates(unavailable data). but i would like to forecast for next 10 years or so.</p>
<p>how would i do that once i build our LSTM model?</p>
<p>I understand we use predict function and predicted on the test data,but again our input was same dataset(x_test). we cannot get this data for future dates right?</p>
<p>response me much appreciated.</p>
<p>Thanks in advance:-)</p>
<div class="reply">
<a aria-label="Reply to Akshay kulkarni" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410450#respond" onclick='return addComment.moveForm( "comment-410450", "410450", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-410504">
<div class="comment-container" id="li-comment-410504">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 22, 2017 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410504" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For different strategies for multi-step forecasting, see this post:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>For an example of multi-step forecasts in the future, see this post:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410504#respond" onclick='return addComment.moveForm( "comment-410504", "410504", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-410776">
<div class="comment-container" id="li-comment-410776">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bac04d666f9b98dc4a4d6787c9363dc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Akshay kulkarni</span>
<span class="date">August 24, 2017 at 3:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410776" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Really helps! Thanks alot</p>
<div class="reply">
<a aria-label="Reply to Akshay kulkarni" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410776#respond" onclick='return addComment.moveForm( "comment-410776", "410776", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407590">
<div class="comment-container" id="li-comment-407590">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/25569e34560a1ff4a9e68d88577eb511?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/25569e34560a1ff4a9e68d88577eb511?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Grant</span>
<span class="date">July 28, 2017 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407590" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial! </p>
<p>Are there examples of LSTMs applied to panel data? So for example each person has their own sequence, and we want to make a prediction about the next value in each person’s sequence without losing information learned from other people’s sequences? </p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Grant" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407590#respond" onclick='return addComment.moveForm( "comment-407590", "407590", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407626">
<div class="comment-container" id="li-comment-407626">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2017 at 8:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407626" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There may be Grant, I have not come across them.</p>
<p>Perhaps search on google scholar?</p>
<p>Like other ML methods, I expect the benefit comes from generalizing across cases.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407626#respond" onclick='return addComment.moveForm( "comment-407626", "407626", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-407831">
<div class="comment-container" id="li-comment-407831">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6989c0c7a48ea3884d07a4ba6dd8f1a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6989c0c7a48ea3884d07a4ba6dd8f1a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">casey</span>
<span class="date">July 30, 2017 at 1:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407831" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>Wonderful post. I was wondering which activation function is used from the hidden layer to the output layer. Is this just a linear activation function? I read in the keras documentation that the linear activation function is used when you don’t spedify it explicitly. Is this correct? Thanks!</p>
<div class="reply">
<a aria-label="Reply to casey" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407831#respond" onclick='return addComment.moveForm( "comment-407831", "407831", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407869">
<div class="comment-container" id="li-comment-407869">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 30, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407869" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs use tanh by default. Dense use linear by default. We are using linear in the output layer here – good for regression problems.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407869#respond" onclick='return addComment.moveForm( "comment-407869", "407869", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407899">
<div class="comment-container" id="li-comment-407899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4e7687090278d32912ea8126691dac9f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">TimeSerial</span>
<span class="date">July 30, 2017 at 3:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-407899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, great post. If I recall from the comments, you may have a multivariate example of the above soon/already?</p>
<div class="reply">
<a aria-label="Reply to TimeSerial" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=407899#respond" onclick='return addComment.moveForm( "comment-407899", "407899", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-408131">
<div class="comment-container" id="li-comment-408131">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Ruiz</span>
<span class="date">August 1, 2017 at 3:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408131" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this article.<br/>
Will LTSM predictions always lag the actual test data by 1?  I see this in your plot and the same happens with my dataset.</p>
<p>Regards,</p>
<p>Daniel</p>
<div class="reply">
<a aria-label="Reply to Daniel Ruiz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408131#respond" onclick='return addComment.moveForm( "comment-408131", "408131", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408210">
<div class="comment-container" id="li-comment-408210">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408210" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, I recommend reading this post instead:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408210#respond" onclick='return addComment.moveForm( "comment-408210", "408210", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-408145">
<div class="comment-container" id="li-comment-408145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9156fa2799b8c79ee4565d013591afd5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9156fa2799b8c79ee4565d013591afd5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ari</span>
<span class="date">August 1, 2017 at 5:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I’d like to ditto all the comments above in that these are very well explained tutorials. Thanks for them. In your examples you’re making a prediction for the next time step only, have you found that modelling such that you predict the next, say 10 or 20 time steps is inherently less accurate? IS it trivial to make this change? </p>
<p>Thanks again</p>
<p>Ari</p>
<div class="reply">
<a aria-label="Reply to Ari" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408145#respond" onclick='return addComment.moveForm( "comment-408145", "408145", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408216">
<div class="comment-container" id="li-comment-408216">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408216" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example of multi-step forecast with LSTMs:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408216#respond" onclick='return addComment.moveForm( "comment-408216", "408216", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-408650">
<div class="comment-container" id="li-comment-408650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d9c1bb214415f313edf97d441468440?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d9c1bb214415f313edf97d441468440?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Albert</span>
<span class="date">August 5, 2017 at 10:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Isn’t there a mistake in the way you compare and plot the predicted data?</p>
<p>It seems shifted to the right by 1 (in the plots).</p>
<p>Here is what i did:</p>
<p>…<br/>
# align the predicted Ys and original Ys<br/>
trainY = numpy.delete(trainY, trainY.shape[1]-1, axis=1);<br/>
trainPredict = numpy.delete(trainPredict, 0, axis=0);</p>
<p>testY = numpy.delete(testY, testY.shape[1]-1, axis=1);<br/>
testPredict = numpy.delete(testPredict, 0, axis=0);</p>
<p># calculate root mean squared error<br/>
trainScore = math.sqrt(mean_squared_error(trainY[0], trainPredict[:, 0]))<br/>
…</p>
<p>…<br/>
# adjust the plot for the new shape of testPredict<br/>
testPredictPlot[len(trainPredict)+(look_back*2)+2:len(dataset)-2, :] = testPredict<br/>
…</p>
<p>My results with look_back = 1 and LSTM(4) are:</p>
<p>Train Score: 6.08 RMSE<br/>
Test Score: 15.53 RMSE</p>
<p>Am i missing something here? Or were the data offset for real?</p>
<div class="reply">
<a aria-label="Reply to Albert" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408650#respond" onclick='return addComment.moveForm( "comment-408650", "408650", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408694">
<div class="comment-container" id="li-comment-408694">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 6, 2017 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408694" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend following this tutorial instead:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408694#respond" onclick='return addComment.moveForm( "comment-408694", "408694", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-408846">
<div class="comment-container" id="li-comment-408846">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sayed Gouda</span>
<span class="date">August 7, 2017 at 8:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408846" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason<br/>
Thank you for this great tutorial<br/>
I am using anaconda 3 (64 bit) with python 3.6.1<br/>
The dataset length  is (5 * 65000)<br/>
I reduce epoch to 10 (for time saving while trying)<br/>
can you help with this error which I got while implementing the above code?<br/>
Traceback (most recent call last):<br/>
  File “C:/Users/Sayed Gouda/PycharmProjects/training/ds.py”, line 64, in<br/>
    trainPredict = scaler.inverse_transform(trainPredict)<br/>
  File “C:\Users\Sayed Gouda\Anaconda3\lib\site-packages\sklearn\preprocessing\data.py”, line 376, in inverse_transform<br/>
    X -= self.min_<br/>
ValueError: non-broadcastable output operand with shape (43547,1) doesn’t match the broadcast shape (43547,5)</p>
<div class="reply">
<a aria-label="Reply to Sayed Gouda" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408846#respond" onclick='return addComment.moveForm( "comment-408846", "408846", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408901">
<div class="comment-container" id="li-comment-408901">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 7:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408901" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks like your data has 5 features, is that right? If so, your network will need to be configured to expect 5 inputs (input_shape argument).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408901#respond" onclick='return addComment.moveForm( "comment-408901", "408901", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-408923">
<div class="comment-container" id="li-comment-408923">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sayed Gouda</span>
<span class="date">August 8, 2017 at 9:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408923" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason</p>
<p>i did what you just say but i got another error<br/>
ValueError: Error when checking input: expected lstm_1_input to have shape (None, 5, 1) but got array with shape (43547, 1, 1)</p>
<div class="reply">
<a aria-label="Reply to Sayed Gouda" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408923#respond" onclick='return addComment.moveForm( "comment-408923", "408923", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-408953">
<div class="comment-container" id="li-comment-408953">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 5:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-408953" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks like the input shape for your network does not match your data. Change the shape of the network or the data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=408953#respond" onclick='return addComment.moveForm( "comment-408953", "408953", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-409338">
<div class="comment-container" id="li-comment-409338">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://am.me" rel="external nofollow">Firnas</a></span>
<span class="date">August 12, 2017 at 12:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409338" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>could RNN use to learn categorical data in dataset lets say for the api logs which has the features timestamp(with15min gap),req_method(GET/POST/PUT or any)/response_time/NoOfRequests and train RNN timeseries and build to predict the number of requests (feature number 4) by giving remaining variables as test data ?</p>
<div class="reply">
<a aria-label="Reply to Firnas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409338#respond" onclick='return addComment.moveForm( "comment-409338", "409338", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409366">
<div class="comment-container" id="li-comment-409366">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 12, 2017 at 6:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409366" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409366#respond" onclick='return addComment.moveForm( "comment-409366", "409366", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-413019">
<div class="comment-container" id="li-comment-413019">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://amfirnas" rel="external nofollow">Firnas</a></span>
<span class="date">September 7, 2017 at 8:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413019" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, so I converted those categorical features using the one-hot encoding (0 or 1 matrixes) method.Now the data set (first 2 rows) is [1]; having 8099 data points actually.</p>
<p>since in code [2]</p>
<p>it could able to use only one column (column number 14), so how can I change this to use multiple variables (numerical and categorical)?</p>
<p>[1] <a href="https://paste.ofcode.org/R6WPQ2ymznnJKFNhysj9Ad" rel="nofollow">https://paste.ofcode.org/R6WPQ2ymznnJKFNhysj9Ad</a><br/>
[2] <a href="https://paste.ofcode.org/38Z89HXqJsyeTXUhLMRMCLT" rel="nofollow">https://paste.ofcode.org/38Z89HXqJsyeTXUhLMRMCLT</a></p>
<p>Thanks…</p>
<div class="reply">
<a aria-label="Reply to Firnas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413019#respond" onclick='return addComment.moveForm( "comment-413019", "413019", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-414451">
<div class="comment-container" id="li-comment-414451">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://amfirnas.me" rel="external nofollow">Firnas</a></span>
<span class="date">September 21, 2017 at 6:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414451" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>May I have any reply on this please? I’m struggling with the fourth year degree research project , any simple information would so much helpful.</p>
<div class="reply">
<a aria-label="Reply to Firnas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414451#respond" onclick='return addComment.moveForm( "comment-414451", "414451", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-414487">
<div class="comment-container" id="li-comment-414487">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 22, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414487" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I do not have the capacity to review your code.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409494">
<div class="comment-container" id="li-comment-409494">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c30616f0831363db7fc79fa9a97d7404?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c30616f0831363db7fc79fa9a97d7404?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ladjailia</span>
<span class="date">August 13, 2017 at 6:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409494" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks lot of</p>
<p>I found the following problem:</p>
<p>pandas.errors.ParserError: ‘,’ expected after ‘”‘. Error could possibly be due to parsing errors in the skipped footer rows (the skipfooter keyword is only applied after Python’s csv library has parsed all rows).</p>
<p>I used :<br/>
python 3.6 with anaconda 64 bit</p>
<div class="reply">
<a aria-label="Reply to ladjailia" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409494#respond" onclick='return addComment.moveForm( "comment-409494", "409494", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409533">
<div class="comment-container" id="li-comment-409533">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 14, 2017 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409533" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider opening the text file in a text editor and deleting the footer lines from the file.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409533#respond" onclick='return addComment.moveForm( "comment-409533", "409533", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409524">
<div class="comment-container" id="li-comment-409524">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6740fe9cb0ca896520ecca1a2caf0004?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6740fe9cb0ca896520ecca1a2caf0004?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leopard</span>
<span class="date">August 14, 2017 at 2:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409524" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason. when I run the first script, I got such error. Can you help me fix this? </p>
<p>Using TensorFlow backend.<br/>
Traceback (most recent call last):<br/>
  File “predic_ltsm.py”, line 40, in<br/>
    model.add(LSTM(4, input_shape=(1, look_back)))<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/models.py”, line 436, in add<br/>
    layer(x)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/layers/recurrent.py”, line 262, in __call__<br/>
    return super(Recurrent, self).__call__(inputs, **kwargs)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/engine/topology.py”, line 569, in __call__<br/>
    self.build(input_shapes[0])<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/layers/recurrent.py”, line 1043, in build<br/>
    constraint=self.bias_constraint)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/legacy/interfaces.py”, line 87, in wrapper<br/>
    return func(*args, **kwargs)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/engine/topology.py”, line 391, in add_weight<br/>
    weight = K.variable(initializer(shape), dtype=dtype, name=name)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/layers/recurrent.py”, line 1035, in bias_initializer<br/>
    self.bias_initializer((self.units * 2,), *args, **kwargs),<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/keras/backend/tensorflow_backend.py”, line 1723, in concatenate<br/>
    return tf.concat([to_dense(x) for x in tensors], axis)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/ops/array_ops.py”, line 1000, in concat<br/>
    dtype=dtypes.int32).get_shape(<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/framework/ops.py”, line 669, in convert_to_tensor<br/>
    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py”, line 176, in _constant_tensor_conversion_function<br/>
    return constant(v, dtype=dtype, name=name)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/framework/constant_op.py”, line 165, in constant<br/>
    tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py”, line 367, in make_tensor_proto<br/>
    _AssertCompatible(values, dtype)<br/>
  File “/home/leopard/workspace/dl/keras/venv2.7/local/lib/python2.7/site-packages/tensorflow/python/framework/tensor_util.py”, line 302, in _AssertCompatible<br/>
    (dtype.name, repr(mismatch), type(mismatch).__name__))<br/>
TypeError: Expected int32, got list containing Tensors of type ‘_Message’ instead.</p>
<div class="reply">
<a aria-label="Reply to Leopard" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409524#respond" onclick='return addComment.moveForm( "comment-409524", "409524", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409535">
<div class="comment-container" id="li-comment-409535">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 14, 2017 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409535" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not clear on what the fault is.</p>
<p>Perhaps start with this tutorial:<br/>
<a href="http://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" rel="nofollow">http://machinelearningmastery.com/tutorial-first-neural-network-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409535#respond" onclick='return addComment.moveForm( "comment-409535", "409535", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-409562">
<div class="comment-container" id="li-comment-409562">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6740fe9cb0ca896520ecca1a2caf0004?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6740fe9cb0ca896520ecca1a2caf0004?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leopard</span>
<span class="date">August 14, 2017 at 12:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409562" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason. I just find what’s wrong.<br/>
I just use the old version of TensorFlow-0.12. After I update tensorflow version to 1.2.1.<br/>
It run successfully.  Thus I think maybe the python APIs change for the new version.</p>
<p>Anyway. I’am so excited. Thanks for the nice tutorial !</p>
<div class="reply">
<a aria-label="Reply to Leopard" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409562#respond" onclick='return addComment.moveForm( "comment-409562", "409562", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-409628">
<div class="comment-container" id="li-comment-409628">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409628" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that Leopard.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409628#respond" onclick='return addComment.moveForm( "comment-409628", "409628", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409704">
<div class="comment-container" id="li-comment-409704">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf4938b00bbbbb1ba66b4af9064ab28a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf4938b00bbbbb1ba66b4af9064ab28a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hailing WU</span>
<span class="date">August 15, 2017 at 8:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409704" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great post! I am just a little bit confused about the use of reset states on stateful lstm RNN, cf. ‘Stacked LSTMs with Memory Between Batches, code line 50,51,52 in the post’.  Say we have a well trained stateful LSTM RNN model, then we want to make predictions on testX, so first we make predictions on trainX to get the state of last time step, then use the state of last time step as the initial state of the test set, do testPredict = model.predict(testX, batch_size=batch_size), question is why model.reset_states() is in between?</p>
<div class="reply">
<a aria-label="Reply to hailing WU" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409704#respond" onclick='return addComment.moveForm( "comment-409704", "409704", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409754">
<div class="comment-container" id="li-comment-409754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>To clear the internal state of the network.</p>
<p>I recommend testing with and without and see if it makes a difference, see this post:<br/>
<a href="http://machinelearningmastery.com/get-the-most-out-of-lstms/" rel="nofollow">http://machinelearningmastery.com/get-the-most-out-of-lstms/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409754#respond" onclick='return addComment.moveForm( "comment-409754", "409754", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409945">
<div class="comment-container" id="li-comment-409945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/93d7b030b3e7bb0c49b37375dca72f45?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/93d7b030b3e7bb0c49b37375dca72f45?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">HyunChul Jung</span>
<span class="date">August 17, 2017 at 3:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good site to learn LSTM and Keras, thanks to all your effort</p>
<div class="reply">
<a aria-label="Reply to HyunChul Jung" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409945#respond" onclick='return addComment.moveForm( "comment-409945", "409945", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409954">
<div class="comment-container" id="li-comment-409954">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 4:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409954" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409954#respond" onclick='return addComment.moveForm( "comment-409954", "409954", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409969">
<div class="comment-container" id="li-comment-409969">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79206687f103a9157090f1b3638bf506?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79206687f103a9157090f1b3638bf506?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shiv Onkar Deepak Kumar</span>
<span class="date">August 17, 2017 at 9:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-409969" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In Time series prediction happen for next few time periods. How can you do prediction for next 12 time periods</p>
<div class="reply">
<a aria-label="Reply to Shiv Onkar Deepak Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=409969#respond" onclick='return addComment.moveForm( "comment-409969", "409969", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410010">
<div class="comment-container" id="li-comment-410010">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410010" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this example:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410010#respond" onclick='return addComment.moveForm( "comment-410010", "410010", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410114">
<div class="comment-container" id="li-comment-410114">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">August 18, 2017 at 7:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410114" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please can you explain how we can do LSTM for regression problem,how it is differ from classification ,how it is works for continuous output?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410114#respond" onclick='return addComment.moveForm( "comment-410114", "410114", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410178">
<div class="comment-container" id="li-comment-410178">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410178" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this tutorial for LSTM on regression:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410178#respond" onclick='return addComment.moveForm( "comment-410178", "410178", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410129">
<div class="comment-container" id="li-comment-410129">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">August 18, 2017 at 10:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410129" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I  am trying to implement the RNN regression with dataset having 4 samples and 1 features columns,the shape of dataset is (9567,5),here 9567 rows ,5 columns ,how to reshape the this data set for RNN.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410129#respond" onclick='return addComment.moveForm( "comment-410129", "410129", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410185">
<div class="comment-container" id="li-comment-410185">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2017 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410185" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6592a0035a2205615821" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
data = data.reshape((9567, 1, 5))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6592a0035a2205615821-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6592a0035a2205615821-1"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">9567</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410185#respond" onclick='return addComment.moveForm( "comment-410185", "410185", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410420">
<div class="comment-container" id="li-comment-410420">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">August 21, 2017 at 3:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410420" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for prompt reply.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410420#respond" onclick='return addComment.moveForm( "comment-410420", "410420", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410564">
<div class="comment-container" id="li-comment-410564">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">August 22, 2017 at 4:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410564" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why we have to reshape the inputs in RNN and CNN for neural networks,we can’t read without reshaping of inputs in RNN and CNN.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410564#respond" onclick='return addComment.moveForm( "comment-410564", "410564", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410644">
<div class="comment-container" id="li-comment-410644">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410644" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is a requirement of the Keras library that inputs have a specific dimensionality.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410644#respond" onclick='return addComment.moveForm( "comment-410644", "410644", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410585">
<div class="comment-container" id="li-comment-410585">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">August 22, 2017 at 8:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410585" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i am trying to train the RNN Regression  model with optimizer adam and loss function mean_sqaured_error,but i am getting too much loss value,even though i have increased the no of epochs and node list also,please give any suggestions to decrease the loss value in RNN Regression</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410585#respond" onclick='return addComment.moveForm( "comment-410585", "410585", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410653">
<div class="comment-container" id="li-comment-410653">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410653" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here are my best suggestions for tuning neural nets:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410653#respond" onclick='return addComment.moveForm( "comment-410653", "410653", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410612">
<div class="comment-container" id="li-comment-410612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5238f7d02eddbc30a9208eb907ec7f2a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5238f7d02eddbc30a9208eb907ec7f2a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Philip</span>
<span class="date">August 22, 2017 at 11:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for writing a nice blog.Iam using daily level data for forecasting .If i would need a 90 days ahead forecasting what i need to do .This example is for one step ahead forecasting .</p>
<div class="reply">
<a aria-label="Reply to Philip" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410612#respond" onclick='return addComment.moveForm( "comment-410612", "410612", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410661">
<div class="comment-container" id="li-comment-410661">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-410661" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post on multi-step forecasting strategies:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>See this post on LSTMs for multi-step forecasting:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<p>Results will probably be poor regardless of method, it’s a hard problem to predict that far in advance unless your domain is trivial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=410661#respond" onclick='return addComment.moveForm( "comment-410661", "410661", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-411152">
<div class="comment-container" id="li-comment-411152">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b749980bd536b67b71a5defaf1d25eee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b749980bd536b67b71a5defaf1d25eee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jespev</span>
<span class="date">August 26, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411152" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you very much for your post!</p>
<p>Unfortunately the fitting of the two series in the plot is just an illusion. Here is why:</p>
<p>The output of your network is a 1 step delayed version of the input. </p>
<p>In other words, the network learns that outputting something similar to the input will minimize the mse. That is sometimes called a “trivial predictor” and has very poor predictive performance.</p>
<p>If you do not believe me go ahead and calculate the mse between X(t) and X(t-1) (no neural network required). Is your prediction much better than this?</p>
<p>Alternatively you can plot your output Y(t) together with X(t-1). That does not fit perfectly?</p>
<div class="reply">
<a aria-label="Reply to Jespev" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411152#respond" onclick='return addComment.moveForm( "comment-411152", "411152", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411505">
<div class="comment-container" id="li-comment-411505">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">August 28, 2017 at 10:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411505" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model = Sequential()<br/>
model.add(LSTM(1,unroll=True,batch_input_shape=trainX.shape, return_sequences=False))<br/>
model.add(Dense(300))<br/>
model.add(Dense(1,activation=’linear’))</p>
<p>#model compilation<br/>
model.compile(loss=’mean_squared_error’, optimizer=’rmsprop’, metrics=[“mse”])<br/>
print “it is going to train the model”<br/>
#train the model<br/>
model.fit(trainX,Ytrain,batch_size=2,nb_epoch=100,verbose=2)</p>
<p>#predict the outputs<br/>
predictions=model.predict(trainX)<br/>
score=model.evaluate(trainX,Ytrain,batch_size=32)</p>
<p>this is my code RNN Regression.<br/>
i am getting too much loss values ,while training the model.please give me suggestions for to improve my model performance.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411505#respond" onclick='return addComment.moveForm( "comment-411505", "411505", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411610">
<div class="comment-container" id="li-comment-411610">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2017 at 5:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411610" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a ton of ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411610#respond" onclick='return addComment.moveForm( "comment-411610", "411610", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411593">
<div class="comment-container" id="li-comment-411593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/859a9b2cc7ecd0c14a88e1695b41542d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/859a9b2cc7ecd0c14a88e1695b41542d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://nesreenahmed.com/" rel="external nofollow">Nesreen</a></span>
<span class="date">August 29, 2017 at 2:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice and useful blog, thanks for sharing! </p>
<p>Here is another reference on time-series prediction with neural networks and gaussian processes, which includes various feature pre-processing techniques.</p>
<p><a href="http://www.tandfonline.com/doi/abs/10.1080/07474938.2010.481556" rel="nofollow">http://www.tandfonline.com/doi/abs/10.1080/07474938.2010.481556</a></p>
<div class="reply">
<a aria-label="Reply to Nesreen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411593#respond" onclick='return addComment.moveForm( "comment-411593", "411593", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411620">
<div class="comment-container" id="li-comment-411620">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2017 at 5:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411620" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing Nesreen.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411620#respond" onclick='return addComment.moveForm( "comment-411620", "411620", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411650">
<div class="comment-container" id="li-comment-411650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">August 29, 2017 at 9:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>on what basis we can select no of hidden layers for RNN networks?any formula is there for this.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411650#respond" onclick='return addComment.moveForm( "comment-411650", "411650", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411700">
<div class="comment-container" id="li-comment-411700">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2017 at 6:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411700" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, there is no reliable analytical way to configure neural networks.</p>
<p>The best we can do is to use experimentation (recommended) or copy designs from other people (common in computer vision).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411700#respond" onclick='return addComment.moveForm( "comment-411700", "411700", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411686">
<div class="comment-container" id="li-comment-411686">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9feaca69d922a7e54eea179ea5a2f861?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9feaca69d922a7e54eea179ea5a2f861?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vipul</span>
<span class="date">August 30, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411686" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Thanks for the wonderful explanation. I am working on my master thesis and my task is to perform predictive analysis (time series data) using neural networks. In statistical theory, it can be called as multivariate time series regression. I have N features for the sales prediction.  My question is, how feature selection method works in LSTM? Do I need to find the best features (srongly correlated) prior to feeding the data in LSTM or model will learn on its own?</p>
<div class="reply">
<a aria-label="Reply to Vipul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411686#respond" onclick='return addComment.moveForm( "comment-411686", "411686", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411704">
<div class="comment-container" id="li-comment-411704">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2017 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411704" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend performing feature selection before applying the LSTM.</p>
<p>Or you can apply the LSTM and hope that it can down-weight features that are not predictive.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411704#respond" onclick='return addComment.moveForm( "comment-411704", "411704", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411768">
<div class="comment-container" id="li-comment-411768">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">August 30, 2017 at 5:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411768" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how the LSTM is differ from GRU in Recurrent neural networks?please can you explain it.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411768#respond" onclick='return addComment.moveForm( "comment-411768", "411768", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411842">
<div class="comment-container" id="li-comment-411842">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-411842" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, the LSTM unit is more complex – has more gates.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=411842#respond" onclick='return addComment.moveForm( "comment-411842", "411842", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-412246">
<div class="comment-container" id="li-comment-412246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/029d4ac64563bd9db1b8caa4eacbe3ab?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/029d4ac64563bd9db1b8caa4eacbe3ab?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shubham Kumar</span>
<span class="date">September 2, 2017 at 11:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-412246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.<br/>
Love your blogs and the content you create. Extremely helpful.<br/>
I am currently working on a problem where I have to do text classification, or basically review classification.<br/>
I used your code  template for CNN-LSTM classifier, and even included dropout.<br/>
Can you suggest other techniques that couuld be useful to get better accuracy. I got 70% accuracy on training-test data , but on new data, the model didn’t perform so well and only got 64%.<br/>
I used CountVectorizer to convert the text to array, and chose max features up to 1500<br/>
Does this hyper parameter have significant effect on the accuracy?</p>
<div class="reply">
<a aria-label="Reply to Shubham Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=412246#respond" onclick='return addComment.moveForm( "comment-412246", "412246", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412341">
<div class="comment-container" id="li-comment-412341">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 3, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-412341" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Two ideas would be to:</p>
<p>1. Focus on your text data and clean it well and reduce the size of the vocabulary to essential words.<br/>
2. Consider a multi-headed CNN with each head reading text with differently sized n-grams (e.g. kernel size).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=412341#respond" onclick='return addComment.moveForm( "comment-412341", "412341", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412792">
<div class="comment-container" id="li-comment-412792">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3fba201f8c895f7084305e28055e1fe5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3fba201f8c895f7084305e28055e1fe5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mounir</span>
<span class="date">September 6, 2017 at 4:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-412792" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for the blog it’s so helpful.<br/>
Actually, I am working on time series data which is close to this example. When I build the model, it doesn’t memorize the high picks. Also, I want to predict future data based on my known data then I try to shift my sequence step by step to predict future values, the problem is that it get worse and worse when I add forecasted data.<br/>
I tried to increase the timestep but the result didn’t get better. I tried also to increase the number of epoch and the number of layers but still the same thing.<br/>
What do you recommend in this case?</p>
<div class="reply">
<a aria-label="Reply to Mounir" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=412792#respond" onclick='return addComment.moveForm( "comment-412792", "412792", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412958">
<div class="comment-container" id="li-comment-412958">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-412958" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Predicting the future is hard 🙂</p>
<p>The further out you go, the worse it will become.</p>
<p>I have a list of general things to try here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=412958#respond" onclick='return addComment.moveForm( "comment-412958", "412958", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-412997">
<div class="comment-container" id="li-comment-412997">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">September 7, 2017 at 4:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-412997" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>what is hyper parameter in machine learning jason?how it is differ from normal parameters?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=412997#respond" onclick='return addComment.moveForm( "comment-412997", "412997", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413197">
<div class="comment-container" id="li-comment-413197">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413197" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question, see this post on the topic:<br/>
<a href="https://machinelearningmastery.com/difference-between-a-parameter-and-a-hyperparameter/" rel="nofollow">https://machinelearningmastery.com/difference-between-a-parameter-and-a-hyperparameter/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413197#respond" onclick='return addComment.moveForm( "comment-413197", "413197", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413025">
<div class="comment-container" id="li-comment-413025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">September 7, 2017 at 10:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>#model creation<br/>
model = Sequential()<br/>
#model.add(LSTM(4,unroll=True,batch_input_shape=trainX.shape, return_sequences=False))<br/>
#model.add(SimpleRNN(4,unroll=True,batch_input_shape=trainX.shape))<br/>
model.add(GRU(4,unroll=True,batch_input_shape=trainX.shape))<br/>
#model.add(Dense(500,activation=”relu”))<br/>
model.add(Dense(200,activation=”relu”))<br/>
model.add(Dense(80,activation=”relu”))<br/>
model.add(Dense(1,activation=”linear”))</p>
<p>#model compilation<br/>
model.compile(loss=’mean_absolute_error’, optimizer=’adam’, metrics=[“mae”])<br/>
print “Training the model”<br/>
#train the model<br/>
batchSize = 16<br/>
print type(trainX)<br/>
print type(Ytrain)<br/>
model.fit(trainX,Ytrain,batch_size=batchSize,nb_epoch=20,verbose=2)</p>
<p>#predict the outputs<br/>
predictions=model.predict(trainX)<br/>
score=model.evaluate(trainX,Ytrain,batch_size=batchSize)<br/>
print(“score value”,score)<br/>
RegScoreFun = r2_score(Ytrain,predictions)<br/>
meanSquareError = mean_squared_error(Ytrain,predictions)<br/>
print(“RegScoreFun”,RegScoreFun)<br/>
print model.metrics_names<br/>
print model.summary()<br/>
meanAbsoluteError=mean_absolute_error(Ytrain,predictions,multioutput=’raw_values’)<br/>
print meanAbsoluteError<br/>
print meanSquareError</p>
<p>this is my RNN regression code,when i will call model.predict(Xtrainvalues) , i am getting same values as predictions, it has to be different,</p>
<p>Please where i am doing wrong in this code.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413025#respond" onclick='return addComment.moveForm( "comment-413025", "413025", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413205">
<div class="comment-container" id="li-comment-413205">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413205" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps your model needs to be tuned for your problem.</p>
<p>Here are some ideas:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413205#respond" onclick='return addComment.moveForm( "comment-413205", "413205", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413670">
<div class="comment-container" id="li-comment-413670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">September 13, 2017 at 4:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>when ever i am doing model.predict(xtrain_values),i am getting all predict values as same ,that is  why i am not getting good loss values,how to resolve this issue .<br/>
Please help me in this scenario.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413670#respond" onclick='return addComment.moveForm( "comment-413670", "413670", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413870">
<div class="comment-container" id="li-comment-413870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 11:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some ideas here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413870#respond" onclick='return addComment.moveForm( "comment-413870", "413870", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413677">
<div class="comment-container" id="li-comment-413677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">September 13, 2017 at 5:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model.predict() gives same output for all inputs in regression,any solution for this problem.<br/>
my configuration,<br/>
3 hidden layers with relu activation functions.<br/>
output layer is linear,batch size :24 and no of epochs is 60.<br/>
nodes are :200,100,50.<br/>
inputs nodes :4<br/>
loss function : mean squared error<br/>
optimizer : adam.</p>
<p>Please do any suggestion for this problem.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413677#respond" onclick='return addComment.moveForm( "comment-413677", "413677", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413876">
<div class="comment-container" id="li-comment-413876">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413876" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you need to prepare your date or tune your model, here are a suite of ideas to try:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413876#respond" onclick='return addComment.moveForm( "comment-413876", "413876", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413729">
<div class="comment-container" id="li-comment-413729">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c04c78312d7b20b65b45d405b7c14eca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c04c78312d7b20b65b45d405b7c14eca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adriano</span>
<span class="date">September 14, 2017 at 4:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413729" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think there is a error: A few data points in train and test data seems to be missing, as you can see on the graph (green line finishes before the blue line).</p>
<p>Here are the steps to fix it:<br/>
First you are removing 2 points from the train and test data here:<br/>
“for i in range(len(dataset)-look_back-1):” it should be: “for i in range(len(dataset)):”<br/>
After this change, inside the loop we are tyring to acess a element outside the dataset (the next prediction), since we are not using then dataY it in the test dataset. we can just set it to 0:<br/>
“if i + look_back &lt; len(dataset):<br/>
			dataY.append(dataset[i + look_back, 0])<br/>
else: dataY.append(0) #This is the last value, no prediction necessary."</p>
<p>After this, both the training and test set will have all the data (and not 2 less data points as before).<br/>
Now we just need to plot it.<br/>
Not sure why the train "prediction" array shift that was used (probably to mask the missing of data points), it can just be ploted like this:<br/>
"plt.plot(trainPredict)"</p>
<p>And finally since the test data now has the right dimension  it can be shifted just next to the train prediction:<br/>
testPredictPlot[len(trainPredict):len(dataset) :,] = testPredict</p>
<p>And you get a nice graph with the train and test data matching the original data (without any shift) and the test data prediction to every data point until the end :<br/>
<a href="https://www.dropbox.com/s/x128njdu8dfhufb/airplane_graph.png?dl=0" rel="nofollow">https://www.dropbox.com/s/x128njdu8dfhufb/airplane_graph.png?dl=0</a></p>
<div class="reply">
<a aria-label="Reply to Adriano" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413729#respond" onclick='return addComment.moveForm( "comment-413729", "413729", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-413798">
<div class="comment-container" id="li-comment-413798">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">September 14, 2017 at 7:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413798" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p># create and fit the LSTM network<br/>
model = Sequential()<br/>
model.add(LSTM(4, input_shape=(1, look_back)))<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
model.fit(trainX, trainY, epochs=100, batch_size=1, verbose=2)</p>
<p>in this model , why we have to specify the hidden first layer neurons number in the First layer itself,why don’t we specify this number of neurons in second layers .</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413798#respond" onclick='return addComment.moveForm( "comment-413798", "413798", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-413897">
<div class="comment-container" id="li-comment-413897">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-413897" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We specify the number of neurons in each layer, the first hidden layer must also specify the number of inputs (e.g. the input layer or visible layer).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=413897#respond" onclick='return addComment.moveForm( "comment-413897", "413897", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414105">
<div class="comment-container" id="li-comment-414105">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6d845e5a35977d4250d24b074d16154e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6d845e5a35977d4250d24b074d16154e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sourabh</span>
<span class="date">September 17, 2017 at 4:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414105" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial Jason!</p>
<p>Consider I measure something 3 times a month for few years.</p>
<p>In 2014, I’ve measured it on “2014-02-01, 2014-02-05, 2014-02-13 ” in  (YYYY-MM-DD)  format.</p>
<p>In 2015, I’ve measured it in the same month, but on different dates “2015-02-11, 2015-02-16, 2015-02-21 “.</p>
<p>Is it advisable to assign monthly values to average of that particular month of the year by grouping it? or Is it okay to use the same data-set without processing it?</p>
<div class="reply">
<a aria-label="Reply to Sourabh" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414105#respond" onclick='return addComment.moveForm( "comment-414105", "414105", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414153">
<div class="comment-container" id="li-comment-414153">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 18, 2017 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414153" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try both framings of the problem and see what works best when making predictions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414153#respond" onclick='return addComment.moveForm( "comment-414153", "414153", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414276">
<div class="comment-container" id="li-comment-414276">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">September 19, 2017 at 4:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414276" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can We write CNN regression usign keras,is it possible?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414276#respond" onclick='return addComment.moveForm( "comment-414276", "414276", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414321">
<div class="comment-container" id="li-comment-414321">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414321" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t see why not.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414321#respond" onclick='return addComment.moveForm( "comment-414321", "414321", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414363">
<div class="comment-container" id="li-comment-414363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">September 20, 2017 at 3:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>CNN is mainly used for image processing,but i didn’t find any examples for CNN so far.<br/>
how i can write this cnn Regression ,please give me any suggestions for it.</p>
<p>it will helpful for my task ?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414363#respond" onclick='return addComment.moveForm( "comment-414363", "414363", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414404">
<div class="comment-container" id="li-comment-414404">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414404" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I am only familiar with the use of CNN on image and text data. I have not used it on regression problems.</p>
<p>I do not expect CNN to be useful for regression unless your obs are ordered, e.g. time series.</p>
<p>I expect you can model your problem using a window method and a 1-D CNN. Some of my examples of working with text and a CNN may be helpful to you for a starting point.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414404#respond" onclick='return addComment.moveForm( "comment-414404", "414404", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414573">
<div class="comment-container" id="li-comment-414573">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">September 22, 2017 at 11:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414573" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, hi!<br/>
Is there a case when we predict the same thing but for several airlines<br/>
In this case, we can increase the dimension<br/>
look_back = number of companies<br/>
but what if we want to add another variable, for example, the budget for advertising</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414573#respond" onclick='return addComment.moveForm( "comment-414573", "414573", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414605">
<div class="comment-container" id="li-comment-414605">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2017 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414605" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, this is multivariate time series. I have an example here:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414605#respond" onclick='return addComment.moveForm( "comment-414605", "414605", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-414615">
<div class="comment-container" id="li-comment-414615">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">September 23, 2017 at 6:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414615" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, Jason!</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414615#respond" onclick='return addComment.moveForm( "comment-414615", "414615", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-414616">
<div class="comment-container" id="li-comment-414616">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">September 23, 2017 at 7:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414616" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, this post is for just one object – Beijing<br/>
Can we use LSTM for several objects?</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414616#respond" onclick='return addComment.moveForm( "comment-414616", "414616", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-414677">
<div class="comment-container" id="li-comment-414677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 24, 2017 at 5:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I recommend trying it for your problem and see how it impacts the skill of the predictions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414677#respond" onclick='return addComment.moveForm( "comment-414677", "414677", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414622">
<div class="comment-container" id="li-comment-414622">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/289585330ce1f0e5ff7c392c45e4b666?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/289585330ce1f0e5ff7c392c45e4b666?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Manoj Agrawal</span>
<span class="date">September 23, 2017 at 9:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414622" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the tutorial it was really helpful like always. </p>
<p>However, I am having kind of an existential crisis. Lets say we have a series 2, 4, 8, 16, 32. We get the difference and get the following (lets forget scaling for now)</p>
<p>X = 2, 4, 8<br/>
y = 4, 8, 16</p>
<p>we use X_train = 2, 4 and y_train = 4, 8 to train the model to predict y = 16 if X = 8. How does this help unless we can predict the next number in the series (64). How do we do that because we do not have difference (X value) for that?</p>
<p>I know others have asked the same question and I checked all the links but all examples are just train, test split of the data without actual forecasting of unknown values. Could you please extend this tutorial to include forecasting of next values in the series because that will give more meaning to this exercise.</p>
<p>thanks,</p>
<div class="reply">
<a aria-label="Reply to Manoj Agrawal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414622#respond" onclick='return addComment.moveForm( "comment-414622", "414622", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414678">
<div class="comment-container" id="li-comment-414678">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 24, 2017 at 5:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-414678" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I follow, what is the problem exactly?</p>
<p>Machine learning is really a mapping problem from X to y, e,g, y = f(X).</p>
<p>You must have input to predict an output.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=414678#respond" onclick='return addComment.moveForm( "comment-414678", "414678", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-415129">
<div class="comment-container" id="li-comment-415129">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7c3e1d04b25a2b95b538911c0c9bc56c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7c3e1d04b25a2b95b538911c0c9bc56c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rainy</span>
<span class="date">September 30, 2017 at 4:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415129" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason,</p>
<p>Thanks for your great tutorial. I have a question regarding to the input shape, the time steps and the number of features, when the value of look_back is more than 1.</p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], 1, trainX.shape[1]))<br/>
testX = numpy.reshape(testX, (testX.shape[0], 1, testX.shape[1]))</p>
<p># create and fit the LSTM network<br/>
model = Sequential()<br/>
model.add(LSTM(4, input_shape=(1, look_back)))</p>
<p>In your code, the original trainX is a 2D matrix with dimension [samples, look_back], and it looks like you are using the value of look_back as the number of features.</p>
<p>Alternatively, it might be more intuitive to treat the value of look_back as timesteps, then the code will be changed to</p>
<p># reshape input to be [samples, time steps, features]<br/>
trainX = numpy.reshape(trainX, (trainX.shape[0], trainX.shape[1], 1))<br/>
testX = numpy.reshape(testX, (testX.shape[0], testX.shape[1], 1))</p>
<p># create and fit the LSTM network<br/>
model = Sequential()<br/>
model.add(LSTM(4, input_shape=(look_back, 1)))</p>
<p>The value of features is 1 as we are doing uni-variate LSTM.</p>
<p>Am I understanding the meaning of look_back and input_shape correctly?<br/>
Do you think there is any difference by treating look_back == timesteps and look_back == features?</p>
<div class="reply">
<a aria-label="Reply to Rainy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415129#respond" onclick='return addComment.moveForm( "comment-415129", "415129", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415172">
<div class="comment-container" id="li-comment-415172">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415172" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, this post provides help on how to reshape input data for LSTMs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415172#respond" onclick='return addComment.moveForm( "comment-415172", "415172", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-415187">
<div class="comment-container" id="li-comment-415187">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dffb490febf85825bd9f4399e1c79673?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dffb490febf85825bd9f4399e1c79673?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yuanliang</span>
<span class="date">September 30, 2017 at 12:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415187" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question about bidirectional LSTM.<br/>
Keras provides a wrapper so we can do something like<br/>
model.add(Bidirectional(LSTM(10, return_sequences=True)))</p>
<p>In this case, however, do we have 10 units for forward processing and 10 units for backward processing? Or 5 each?<br/>
I took a quick look at the source code and it seems to be 10/10. (And the number is not required to be even.)</p>
<div class="reply">
<a aria-label="Reply to Yuanliang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415187#respond" onclick='return addComment.moveForm( "comment-415187", "415187", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415250">
<div class="comment-container" id="li-comment-415250">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 1, 2017 at 9:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415250" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, 10 forward and 10 backward. See this post for an example:<br/>
<a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415250#respond" onclick='return addComment.moveForm( "comment-415250", "415250", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-415594">
<div class="comment-container" id="li-comment-415594">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c1151a18fc47a005f4d8eb7c04ba3a38?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c1151a18fc47a005f4d8eb7c04ba3a38?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lee Xiang Wei</span>
<span class="date">October 4, 2017 at 7:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415594" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a question. For the current code it is predicting only t+1.</p>
<p> Where should i change the code to predict 5days ahead? Is it possible??</p>
<p>Sorry I’m total new to python and LSTM and i’m trying to understand the coding.</p>
<div class="reply">
<a aria-label="Reply to Lee Xiang Wei" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415594#respond" onclick='return addComment.moveForm( "comment-415594", "415594", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415651">
<div class="comment-container" id="li-comment-415651">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415651" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have an example of predicting multiple days ahead here:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415651#respond" onclick='return addComment.moveForm( "comment-415651", "415651", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-415688">
<div class="comment-container" id="li-comment-415688">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21a07a3334eea7930fd59daf1b221609?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21a07a3334eea7930fd59daf1b221609?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rowena Khan</span>
<span class="date">October 5, 2017 at 1:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415688" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason,your tutorials help me a lot! I recommended these to my classmates also.</p>
<div class="reply">
<a aria-label="Reply to Rowena Khan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415688#respond" onclick='return addComment.moveForm( "comment-415688", "415688", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415719">
<div class="comment-container" id="li-comment-415719">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2017 at 5:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415719" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Rowena!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415719#respond" onclick='return addComment.moveForm( "comment-415719", "415719", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-415940">
<div class="comment-container" id="li-comment-415940">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21a07a3334eea7930fd59daf1b221609?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21a07a3334eea7930fd59daf1b221609?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rowena Khan</span>
<span class="date">October 7, 2017 at 8:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415940" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason I have a question. Can we apply multi-threads on this program? If the size of the training dataset is big it can take a long time to train the LSTM network. Can we separate the dataset or the epoches?</p>
<div class="reply">
<a aria-label="Reply to Rowena Khan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415940#respond" onclick='return addComment.moveForm( "comment-415940", "415940", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415972">
<div class="comment-container" id="li-comment-415972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 8, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-415972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Keras is built on top of math libraries like TensorFlow and Theano. These underlying libraries will allow you to run code on multiple cores automatically or GPU cores if configured.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=415972#respond" onclick='return addComment.moveForm( "comment-415972", "415972", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416103">
<div class="comment-container" id="li-comment-416103">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">October 9, 2017 at 5:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416103" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can we develop text processing using neural networks,Please provide any guidance for this task?</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416103#respond" onclick='return addComment.moveForm( "comment-416103", "416103", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416172">
<div class="comment-container" id="li-comment-416172">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 10, 2017 at 7:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416172" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, perhaps start with this post:<br/>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416172#respond" onclick='return addComment.moveForm( "comment-416172", "416172", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416193">
<div class="comment-container" id="li-comment-416193">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/26bca63b89e2ac08766214a9d501e580?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/26bca63b89e2ac08766214a9d501e580?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alfredo Quintana</span>
<span class="date">October 10, 2017 at 9:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416193" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, this is an awesome tutorial, it has been very helpful for me to understand the way LSTMs work. There is something I don’t have clear at all, it is possible to configure a LSTM network with more than one hidden layer? and how does this influence the behavior of the network? Sorry if it is obvious, Thanks</p>
<div class="reply">
<a aria-label="Reply to Alfredo Quintana" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416193#respond" onclick='return addComment.moveForm( "comment-416193", "416193", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416231">
<div class="comment-container" id="li-comment-416231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 10, 2017 at 4:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is called a stacked LSTM, see more about it here:<br/>
<a href="https://machinelearningmastery.com/stacked-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/stacked-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416231#respond" onclick='return addComment.moveForm( "comment-416231", "416231", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416240">
<div class="comment-container" id="li-comment-416240">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3e156aefbd03f56728243d8f79a59d38?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3e156aefbd03f56728243d8f79a59d38?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kevin</span>
<span class="date">October 10, 2017 at 5:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416240" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I am in the Udacity Nanodegree program.  I am working on a project using RNN-LSTM.  But I am having a difficult time understanding the input shape.  I don’t know if I missed something but I am not getting it.  Are there any resources you could point me to?  So I can understand how it works a little better.</p>
<div class="reply">
<a aria-label="Reply to Kevin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416240#respond" onclick='return addComment.moveForm( "comment-416240", "416240", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416291">
<div class="comment-container" id="li-comment-416291">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 11, 2017 at 7:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416291" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, take a look at this post on how to reshape data for LSTMs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416291#respond" onclick='return addComment.moveForm( "comment-416291", "416291", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416604">
<div class="comment-container" id="li-comment-416604">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87aaad4bb460520c7b93c0e87c7f4b3c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87aaad4bb460520c7b93c0e87c7f4b3c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thiago B Soares</span>
<span class="date">October 14, 2017 at 3:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416604" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!</p>
<p>First of all, thank you for that great post.</p>
<p>Using your post as study, I did some custom testing, one of them, I used the months as feature and look_back equals 5. </p>
<p>The new dataset:<br/>
Shape trainX  (90, 5, 13)<br/>
Shape trainY  (90,)<br/>
Shape testX  (42, 5, 13)<br/>
Shape testY  (42,)</p>
<p>Each month is a column (0 or 1). </p>
<p>I obtained the following results:</p>
<p>Train Score: 8.48 RMSE<br/>
Test Score: 24.26 RMSE</p>
<p>My question is, do you consider this approach of using the months interesting?</p>
<p>Thank you so much for the help.</p>
<div class="reply">
<a aria-label="Reply to Thiago B Soares" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416604#respond" onclick='return addComment.moveForm( "comment-416604", "416604", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416627">
<div class="comment-container" id="li-comment-416627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 14, 2017 at 5:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416627#respond" onclick='return addComment.moveForm( "comment-416627", "416627", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416608">
<div class="comment-container" id="li-comment-416608">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c83a273c95f67cffbe26a5780a84f1fb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c83a273c95f67cffbe26a5780a84f1fb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">October 14, 2017 at 4:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416608" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all ,thanks a lot for the great tutorial Jason.</p>
<p>I just have one question regarding the achieved predictions using the LSTM network.</p>
<p>I just don’t understand why are you making  “trainPredict = model.predict(trainX)” . </p>
<p>I get the predict method using the testset testX, but using this method for trainX is not like if you were in some way cheating? I say this because we train the network using the trainX and trainY and trainY corresponds to the labels you are trying to predict in the predict method using trainX.</p>
<p>Is it performed for validation purposes only?</p>
<p>I’m still learning to work with the Keras API so I might be confused with the syntax of it </p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416608#respond" onclick='return addComment.moveForm( "comment-416608", "416608", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416628">
<div class="comment-container" id="li-comment-416628">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 14, 2017 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-416628" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is a validation to see if the model can predict the data it was trained on. If it cannot, it is a sign of a poor model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=416628#respond" onclick='return addComment.moveForm( "comment-416628", "416628", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417040">
<div class="comment-container" id="li-comment-417040">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e699401e560a63dca4b942a0981b292b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e699401e560a63dca4b942a0981b292b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bernhard</span>
<span class="date">October 17, 2017 at 10:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417040" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
thank you so much for those tutorials, they are a great resource.<br/>
I have one quick question though: How can we use peephole connections?<br/>
I want to compare the performance of LSTMs using/not using them.</p>
<p>Thanks in advance and have a nice day!</p>
<div class="reply">
<a aria-label="Reply to Bernhard" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417040#respond" onclick='return addComment.moveForm( "comment-417040", "417040", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417061">
<div class="comment-container" id="li-comment-417061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 18, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I found this on google, perhaps it will help you get started:<br/>
<a href="https://github.com/fchollet/keras/issues/1717" rel="nofollow">https://github.com/fchollet/keras/issues/1717</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417061#respond" onclick='return addComment.moveForm( "comment-417061", "417061", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417515">
<div class="comment-container" id="li-comment-417515">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e5cddf7b4f2eea21c26f50c6ce4e71c7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e5cddf7b4f2eea21c26f50c6ce4e71c7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Long</span>
<span class="date">October 22, 2017 at 5:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417515" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I do not quite understand the meanings of LSTM blocks/neuron in keras or unit number in Tensorflow. Could you help me explain these terms with a graph? </p>
<p>I found some graphs in ttps://github.com/fchollet/keras/issues/2654 or <a href="https://stackoverflow.com/questions/43034960/many-to-one-and-many-to-many-lstm-examples-in-keras" rel="nofollow">https://stackoverflow.com/questions/43034960/many-to-one-and-many-to-many-lstm-examples-in-keras</a>.  In the many to many model of LSTMs, Do the green rectangles represent the STM blocks/neuron in keras or unit number in Tensorflow? However if the input sequence is smaller than the number of blocks/neuron, does it mean that some neurons have not input series, just pass states to the next neurons? For example, the input sequence is 30, while the number of neurons is 128.</p>
<p>Thank you very much. </p>
<p>If</p>
<div class="reply">
<a aria-label="Reply to Long" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417515#respond" onclick='return addComment.moveForm( "comment-417515", "417515", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417566">
<div class="comment-container" id="li-comment-417566">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417566" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a gentle introduction to LSTM here that may help:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417566#respond" onclick='return addComment.moveForm( "comment-417566", "417566", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417659">
<div class="comment-container" id="li-comment-417659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f5d03289a17e3a4635ab35e7aacbfe7f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f5d03289a17e3a4635ab35e7aacbfe7f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sabanam</span>
<span class="date">October 24, 2017 at 12:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am a beginner in the field of Handwriting Recognition Problem. I have gone through your article and I found 4 categories for sequence prediction problem:  Sequence Prediction, Sequence Classification,  Sequence Generation, Sequence-to-Sequence Prediction. So, which category belongs to Handwriting Recognition? </p>
<p>By Reading this blog, I got the idea how LSTM works but I am not getting about Multi-dimensional LSTM(MDLSTM). How can we incorporate it for Handwriting recognition Problem?<br/>
I found a paper which is working on MDLSTM for handwritten text.<br/>
<a href="https://arxiv.org/pdf/1604.03286.pdf" rel="nofollow">https://arxiv.org/pdf/1604.03286.pdf</a><br/>
Can you help me to figure out it?</p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to sabanam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417659#respond" onclick='return addComment.moveForm( "comment-417659", "417659", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417687">
<div class="comment-container" id="li-comment-417687">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417687" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps one to many, one image to many chars or many words.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417687#respond" onclick='return addComment.moveForm( "comment-417687", "417687", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-417888">
<div class="comment-container" id="li-comment-417888">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f5d03289a17e3a4635ab35e7aacbfe7f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f5d03289a17e3a4635ab35e7aacbfe7f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sabanam</span>
<span class="date">October 25, 2017 at 5:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417888" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What about MDLSTM? This paper (<a href="https://arxiv.org/pdf/1604.03286.pdf" rel="nofollow">https://arxiv.org/pdf/1604.03286.pdf</a>) is talking about scanning image in 4 directions for Handwriting recognition. But I have gone through many papers where CNN is used first to extract features followed by LSTM. Can you help me to figure out the things?</p>
<div class="reply">
<a aria-label="Reply to sabanam" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417888#respond" onclick='return addComment.moveForm( "comment-417888", "417888", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-417954">
<div class="comment-container" id="li-comment-417954">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417954" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this will help as a start:<br/>
<a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/cnn-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417954#respond" onclick='return addComment.moveForm( "comment-417954", "417954", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417933">
<div class="comment-container" id="li-comment-417933">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yuval</span>
<span class="date">October 26, 2017 at 12:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417933" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks so much for such great tutorials. I have gone thru all of them and find them very useful. I am trying to predict time series having a lot of surges.<br/>
So far I managed to get reasonable prediction however in all models I have tried I am having delayed output by single time unit (similar to what you are having in this tutorial).<br/>
I have also managed to get rid of the delyed output in this tutorial by increasing the timesteps to 12  and so the number of nurons to 12 in order to include the yearly seasonality.</p>
<p>My question is, is this the reason for the delyed output? if so, i dont see how i get rid of my model’s delayed output since it is a very difficult task to train a surgey signal.</p>
<p>many thanks</p>
<div class="reply">
<a aria-label="Reply to Yuval" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417933#respond" onclick='return addComment.moveForm( "comment-417933", "417933", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417969">
<div class="comment-container" id="li-comment-417969">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-417969" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It means your model is predicting the input as the output and has no skill (e.g. persistence).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=417969#respond" onclick='return addComment.moveForm( "comment-417969", "417969", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-418018">
<div class="comment-container" id="li-comment-418018">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6c04345e968695d1f5d2ca6414867538?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yuval</span>
<span class="date">October 26, 2017 at 5:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418018" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your reply.<br/>
I am aware of that.<br/>
Again, this happens in your example also. Do you know what causes this to happen?<br/>
I have train the model with var t-2 only and got delayed output of 2 units.</p>
<div class="reply">
<a aria-label="Reply to Yuval" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418018#respond" onclick='return addComment.moveForm( "comment-418018", "418018", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-418048">
<div class="comment-container" id="li-comment-418048">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 27, 2017 at 5:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418048" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, generally, LSTMs are not suited to autoregression type problems:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418048#respond" onclick='return addComment.moveForm( "comment-418048", "418048", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418474">
<div class="comment-container" id="li-comment-418474">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bd51af34bb6606b3cf5a71771f1b9d51?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bd51af34bb6606b3cf5a71771f1b9d51?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JIN</span>
<span class="date">October 30, 2017 at 6:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418474" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial thanks<br/>
I just compared my RNNs, one with only one time step and another with 60 time steps which means it’s trained with 60 previous days(i-60) to predict the next day (i+1 or i depending on how  you define). Both are good enough, but one thing I cannot understand is the RNN with only one time step shows a better prediction than the one with 60. I’m just vaguely getting my head around it thinking since there are more data it should calculate, it’s showing a bit more inaccurate results than the one with one time step.<br/>
But I ask myself again that “than, what’s the point of feeding it with more data? if it gives me worse predictions” </p>
<p>Can you explain to me why it’s happening please?</p>
<div class="reply">
<a aria-label="Reply to JIN" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418474#respond" onclick='return addComment.moveForm( "comment-418474", "418474", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-418475">
<div class="comment-container" id="li-comment-418475">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bd51af34bb6606b3cf5a71771f1b9d51?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bd51af34bb6606b3cf5a71771f1b9d51?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JIN</span>
<span class="date">October 30, 2017 at 6:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418475" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>/Users/DylanPark/Desktop/Screen Shot 2017-10-30 at 2.26.22 AM.png</p>
<p>RNN with 60 time steps</p>
<p>/Users/DylanPark/Desktop/Screen Shot 2017-10-26 at 8.56.27 PM.png</p>
<p>RNN with one time step</p>
<div class="reply">
<a aria-label="Reply to JIN" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418475#respond" onclick='return addComment.moveForm( "comment-418475", "418475", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418525">
<div class="comment-container" id="li-comment-418525">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418525" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Indeed, more time steps should be a better model. </p>
<p>The answer is, LSTMs are just not great at autoregression (e.g. local dependence):<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418525#respond" onclick='return addComment.moveForm( "comment-418525", "418525", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418610">
<div class="comment-container" id="li-comment-418610">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/132f6f7105dadc1585ffa2a74c5cfd15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/132f6f7105dadc1585ffa2a74c5cfd15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wasabi</span>
<span class="date">October 31, 2017 at 10:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418610" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason</p>
<p>First of all thanks for the tutorial. An excellent one at that.<br/>
However, when I run your first source code is always wrong, as follows:<br/>
Traceback (most recent call last):<br/>
  File “D:/Deep Learning/Examples/LSTM/11/hbckyc.py”, line 59, in<br/>
    model.add(LSTM(4, input_shape=(1, look_back)))<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\models.py”, line 443, in add<br/>
    layer(x)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\layers\recurrent.py”, line 262, in __call__<br/>
    return super(Recurrent, self).__call__(inputs, **kwargs)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\engine\topology.py”, line 569, in __call__<br/>
    self.build(input_shapes[0])<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\layers\recurrent.py”, line 1021, in build<br/>
    constraint=self.kernel_constraint)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\legacy\interfaces.py”, line 88, in wrapper<br/>
    return func(*args, **kwargs)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\engine\topology.py”, line 391, in add_weight<br/>
    weight = K.variable(initializer(shape), dtype=dtype, name=name)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\initializers.py”, line 208, in __call__<br/>
    dtype=dtype, seed=self.seed)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\keras\backend\theano_backend.py”, line 2123, in random_uniform<br/>
    return rng.uniform(shape, low=minval, high=maxval, dtype=dtype)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\sandbox\rng_mrg.py”, line 1354, in uniform<br/>
    rstates = self.get_substream_rstates(nstreams, dtype)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\configparser.py”, line 117, in res<br/>
    return f(*args, **kwargs)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\sandbox\rng_mrg.py”, line 1256, in get_substream_rstates<br/>
    multMatVect(rval[0], A1p72, M1, A2p72, M2)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\sandbox\rng_mrg.py”, line 66, in multMatVect<br/>
    [A_sym, s_sym, m_sym, A2_sym, s2_sym, m2_sym], o, profile=False)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\compile\function.py”, line 326, in function<br/>
    output_keys=output_keys)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\compile\pfunc.py”, line 486, in pfunc<br/>
    output_keys=output_keys)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\compile\function_module.py”, line 1795, in orig_function<br/>
    defaults)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\compile\function_module.py”, line 1661, in create<br/>
    input_storage=input_storage_lists, storage_map=storage_map)<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\gof\link.py”, line 699, in make_thunk<br/>
    storage_map=storage_map)[:3]<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\gof\vm.py”, line 1098, in make_all<br/>
    self.updated_vars,<br/>
  File “E:\anaconda3-4.4.0\envs\dlwin36\lib\site-packages\theano\gof\vm.py”, line 952, in make_vm<br/>
    vm = CVM(<br/>
NameError: name ‘CVM’ is not defined</p>
<p>I hope you can help, thank you!</p>
<div class="reply">
<a aria-label="Reply to Wasabi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418610#respond" onclick='return addComment.moveForm( "comment-418610", "418610", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418632">
<div class="comment-container" id="li-comment-418632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not seen this error before, perhaps try posting it to one of the Keras support locations:<br/>
<a href="https://machinelearningmastery.com/get-help-with-keras/" rel="nofollow">https://machinelearningmastery.com/get-help-with-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418632#respond" onclick='return addComment.moveForm( "comment-418632", "418632", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-418782">
<div class="comment-container" id="li-comment-418782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/132f6f7105dadc1585ffa2a74c5cfd15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/132f6f7105dadc1585ffa2a74c5cfd15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wasabi</span>
<span class="date">November 2, 2017 at 2:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank very much for your reply.<br/>
I try do according to your method, find a solution,thank you Dr.J ！</p>
<div class="reply">
<a aria-label="Reply to Wasabi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418782#respond" onclick='return addComment.moveForm( "comment-418782", "418782", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418872">
<div class="comment-container" id="li-comment-418872">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d0f9dc9b6aa020b6323ac732dac30838?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d0f9dc9b6aa020b6323ac732dac30838?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gary</span>
<span class="date">November 3, 2017 at 1:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418872" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks. Great tutorial. I have a question of LSTM.<br/>
The feature number of each sample is different, and I want to use these samples to train for a  regression. Can this problem be solved by LSTM?</p>
<div class="reply">
<a aria-label="Reply to Gary" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418872#respond" onclick='return addComment.moveForm( "comment-418872", "418872", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418882">
<div class="comment-container" id="li-comment-418882">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 2:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-418882" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure. This post will help you configure your input:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=418882#respond" onclick='return addComment.moveForm( "comment-418882", "418882", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-419426">
<div class="comment-container" id="li-comment-419426">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/85bc05cf73587d27d27191efb78720a6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/85bc05cf73587d27d27191efb78720a6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anjol</span>
<span class="date">November 8, 2017 at 10:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-419426" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could someone explain me what this line this does in code?</p>
<p>train, test = dataset[0:train_size,:], dataset[train_size:len(dataset),:]</p>
<div class="reply">
<a aria-label="Reply to Anjol" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=419426#respond" onclick='return addComment.moveForm( "comment-419426", "419426", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419489">
<div class="comment-container" id="li-comment-419489">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 9, 2017 at 9:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-419489" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for more on array slicing:<br/>
<a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=419489#respond" onclick='return addComment.moveForm( "comment-419489", "419489", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420014">
<div class="comment-container" id="li-comment-420014">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8b6bb469ee658de4bb4c8a8f0a48042?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8b6bb469ee658de4bb4c8a8f0a48042?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tolu Ogunseye</span>
<span class="date">November 15, 2017 at 4:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420014" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>This is great tutorial, it’s been really informative!</p>
<p>Forgive my ignorance as I’m relatively new to RNNs, but I’ve recently been using a similar set-up for time-series regression modelling. Similarly, the results were remarkably accurate. However, one thing struck me as odd: the predicted values (model.predict(X_test)) appeared merely offset from the test set (Y_test) by one. I then noticed the same trends in the plots in this tutorial. That is, simply offsetting the predicted values by one will get the traces almost perfectly aligned. I retrained models setting the target variable (y_train) two steps ahead instead of just one. This time the predicted values were offset by 2, I repeated for 3 and so on. Eventually you look ahead far enough that model no longer works. It feels like the neural net is just learning to return the last entry in each input vector. Such an explanation would fit the observed trend. But, like I said, I’m fairly new to this. What is it that I’m missing?</p>
<p>Kind regards</p>
<p>Tolu</p>
<div class="reply">
<a aria-label="Reply to Tolu Ogunseye" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420014#respond" onclick='return addComment.moveForm( "comment-420014", "420014", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420047">
<div class="comment-container" id="li-comment-420047">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420047" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This might be a sign of the model acting like a persistence model (unskillful). See this post for a good baseline model to use as reference:<br/>
<a href="https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420047#respond" onclick='return addComment.moveForm( "comment-420047", "420047", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-420147">
<div class="comment-container" id="li-comment-420147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8b6bb469ee658de4bb4c8a8f0a48042?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8b6bb469ee658de4bb4c8a8f0a48042?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tolu Ogunseye</span>
<span class="date">November 16, 2017 at 5:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you very much! I’ll look into this.</p>
<p>Tolu</p>
<div class="reply">
<a aria-label="Reply to Tolu Ogunseye" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420147#respond" onclick='return addComment.moveForm( "comment-420147", "420147", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420904">
<div class="comment-container" id="li-comment-420904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/30bc41dbe0cfeb1cd31dc2f0528ea063?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/30bc41dbe0cfeb1cd31dc2f0528ea063?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexey</span>
<span class="date">November 23, 2017 at 4:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>“We are going to keep things simple and work with the data as-is.</p>
<p>Normally, it is a good idea to investigate various data preparation techniques to rescale the data and to make it stationary.”</p>
<p>“We can see that the model did an excellent job of fitting both the training and the test datasets.”</p>
<p>These parts made me puzzled. How can one expect to get a good model using raw non-stationary data, and, even worse, say the model has got a good quality. It is great foolishness. Too dummy for a Dr. I would say. </p>
<p>All of your “wonderful” forecasts replicate previous data with minor variations, thus making the model almost completely useless. The values of the forecasts are just shifted values of the previous time-series points.</p>
<div class="reply">
<a aria-label="Reply to Alexey" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420904#respond" onclick='return addComment.moveForm( "comment-420904", "420904", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420951">
<div class="comment-container" id="li-comment-420951">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420951" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the feedback.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420951#respond" onclick='return addComment.moveForm( "comment-420951", "420951", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-420926">
<div class="comment-container" id="li-comment-420926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aeca4e009d194fe77392c875b4fd1dc6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aeca4e009d194fe77392c875b4fd1dc6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Madhu</span>
<span class="date">November 23, 2017 at 8:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I loved your tutorial. As always, they are extremely insightful and refreshingly easy to understand.<br/>
I have a question for you: I’m currently involved in a nonlinear optimization project and I’m looking into LSTMs (specifically their applications in reinforcement learning). In theory, would an LSTM perform well with stochastic input? For example, what if I wanted to train a model for a smart thermostat that uses the weather forecast (along with real-time state variables such as current room temperature) to predict when to start heating or cooling a building? Or does this go against what an LSTM is fundamentally designed to do?</p>
<p>Let me know what you think!</p>
<div class="reply">
<a aria-label="Reply to Madhu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420926#respond" onclick='return addComment.moveForm( "comment-420926", "420926", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420957">
<div class="comment-container" id="li-comment-420957">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-420957" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is hard to say, try it and see! Compare to an MLP baseline.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=420957#respond" onclick='return addComment.moveForm( "comment-420957", "420957", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421111">
<div class="comment-container" id="li-comment-421111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a7fbe53506bead80a21a60c3a8b82e3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a7fbe53506bead80a21a60c3a8b82e3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Toby</span>
<span class="date">November 25, 2017 at 1:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason. This is very helpful.<br/>
Just curious though, even though the out of sample test data set seems to fit well when you plot it, isn’t the case that there might be some overfitting going on since the MSE error of the test set is more than double what the error is for the training MSE error? Is there a statistical threshold test to allow one to identify if overfitting is occurring?</p>
<div class="reply">
<a aria-label="Reply to Toby" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421111#respond" onclick='return addComment.moveForm( "comment-421111", "421111", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421144">
<div class="comment-container" id="li-comment-421144">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 25, 2017 at 10:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421144" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps.</p>
<p>No, generally it is a matter of model selection – whatever you are willing to tolerate for your predictive modeling problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421144#respond" onclick='return addComment.moveForm( "comment-421144", "421144", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421482">
<div class="comment-container" id="li-comment-421482">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/91eea5a33b411b420948f3230071e5fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/91eea5a33b411b420948f3230071e5fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anita</span>
<span class="date">November 28, 2017 at 8:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421482" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>This is really insightful, thank you. I was wondering how I would achieve the same but with categorical data predictions. Steps such as the differenced series will not work the same. I have considered one hot encoding my data set but still do not understand how statistical analysis will be possible on these.</p>
<div class="reply">
<a aria-label="Reply to Anita" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421482#respond" onclick='return addComment.moveForm( "comment-421482", "421482", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421542">
<div class="comment-container" id="li-comment-421542">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2017 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421542" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Indeed, ideas of trend and seasonality do not make sense with a sequence of labels.</p>
<p>Perhaps try projections of the labels, as we do with sequences of words in NLP?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421542#respond" onclick='return addComment.moveForm( "comment-421542", "421542", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421728">
<div class="comment-container" id="li-comment-421728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c1381e1ea7be9149ed6fd0cdc0c784b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c1381e1ea7be9149ed6fd0cdc0c784b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dash</span>
<span class="date">November 30, 2017 at 6:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for the tutorial!</p>
<p>I notice you have used batch size of 32 (or 64) many times for training.<br/>
Any reason for that? Is that another hyperparameter that we might have to play around with?<br/>
I’ve seen 128 being used quite a lot more.</p>
<p>I was just wondering about the reason (if any)!</p>
<div class="reply">
<a aria-label="Reply to Dash" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421728#respond" onclick='return addComment.moveForm( "comment-421728", "421728", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421795">
<div class="comment-container" id="li-comment-421795">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 1, 2017 at 7:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-421795" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct, tune for your problem.</p>
<p>See this post for some advice on tuning batch size:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=421795#respond" onclick='return addComment.moveForm( "comment-421795", "421795", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-422025">
<div class="comment-container" id="li-comment-422025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">December 3, 2017 at 1:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello jason,<br/>
                  for a scenario of real-time forecasting where our input will be updated regularly, in such cases what should be done about input data shape or length?<br/>
                  for example, we want to use 25 data points as a training data to predict the next 5 data points. we want our training data points should be always 25 but updated. how the new data will replace the old data in the training dataset to provide the updated dataset which should have a length of 25 data points.</p>
<p>do you have any blog or example of such issues? </p>
<p>any guideline along with code would be really helpful for me?</p>
<div class="reply">
<a aria-label="Reply to masum" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422025#respond" onclick='return addComment.moveForm( "comment-422025", "422025", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422095">
<div class="comment-container" id="li-comment-422095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2017 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422095#respond" onclick='return addComment.moveForm( "comment-422095", "422095", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-422231">
<div class="comment-container" id="li-comment-422231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f9be99bb3d4ea0adf98243a2dfb198fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f9be99bb3d4ea0adf98243a2dfb198fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Francisco</span>
<span class="date">December 6, 2017 at 2:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! Thank for all your great tutorials!</p>
<p>I have a question, in the stateful LSTM (with Memory Between Batches), the batch_size should be always 1? or could be other value, for example, the gcd of train size and test size?</p>
<p>Thank you a lot!</p>
<div class="reply">
<a aria-label="Reply to Francisco" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422231#respond" onclick='return addComment.moveForm( "comment-422231", "422231", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422255">
<div class="comment-container" id="li-comment-422255">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 6, 2017 at 9:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422255" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can change the batch size.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422255#respond" onclick='return addComment.moveForm( "comment-422255", "422255", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-422374">
<div class="comment-container" id="li-comment-422374">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c8bc9c98d8c75a89f70cf5765e6db0dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c8bc9c98d8c75a89f70cf5765e6db0dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ying-Chuan Liao</span>
<span class="date">December 7, 2017 at 9:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422374" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for sharing this wonderful tutorial. However the more advanced approached you propose, the worse result you get. How can you explain it? Or simply because data is not applicable for this case? I expect to see the better result but feel a bit upset lol</p>
<div class="reply">
<a aria-label="Reply to Ying-Chuan Liao" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422374#respond" onclick='return addComment.moveForm( "comment-422374", "422374", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422395">
<div class="comment-container" id="li-comment-422395">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 3:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422395" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs are not good at straight autoregression:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422395#respond" onclick='return addComment.moveForm( "comment-422395", "422395", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-422819">
<div class="comment-container" id="li-comment-422819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 12, 2017 at 5:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your great post! If my features include both sequence (t-n) values, and current (t) values (such as whether there is a promotion today) as input, how can I build the LSTM model? Thx!</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422819#respond" onclick='return addComment.moveForm( "comment-422819", "422819", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422834">
<div class="comment-container" id="li-comment-422834">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 12, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422834" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will give you ideas:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422834#respond" onclick='return addComment.moveForm( "comment-422834", "422834", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-422902">
<div class="comment-container" id="li-comment-422902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 12, 2017 at 7:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason. I checked that post. It seems talking about how to reshape multiple sequence features. But my question include non-sequence features.</p>
<p>For example: to predict the sales at time t, we need t-n sales and also whether the product is on promotion at time t. How can we model the promotion effect? thx!</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422902#respond" onclick='return addComment.moveForm( "comment-422902", "422902", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-422942">
<div class="comment-container" id="li-comment-422942">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422942" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For non-sequence features, I would recommend a multiple-input model. I have some examples here:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422942#respond" onclick='return addComment.moveForm( "comment-422942", "422942", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-422908">
<div class="comment-container" id="li-comment-422908">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/61519e7070393b2987fb8008e42a472c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/61519e7070393b2987fb8008e42a472c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fathi</span>
<span class="date">December 12, 2017 at 9:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422908" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Dears</p>
<p>i need to analysis my data using ANN ,anyone can do it contact me ,i will pay for him </p>
<p><a href="mailto:fathi_nias@yahoo.com">fathi_nias@yahoo.com</a><br/>
thanks</p>
<div class="reply">
<a aria-label="Reply to Fathi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422908#respond" onclick='return addComment.moveForm( "comment-422908", "422908", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422946">
<div class="comment-container" id="li-comment-422946">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-422946" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps hire someone on upwork?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=422946#respond" onclick='return addComment.moveForm( "comment-422946", "422946", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423894">
<div class="comment-container" id="li-comment-423894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9565f7d1329357f3dbf5c3fd0800bc7c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9565f7d1329357f3dbf5c3fd0800bc7c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.mrlee.website" rel="external nofollow">Michael</a></span>
<span class="date">December 19, 2017 at 11:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-423894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Greetings Jason,</p>
<p>I am a self-learner who has spent the last week breaking down different code to learn machine learning and I must say that your walk-through is very well put together.  I was wondering how do I maintain the date and/or time information in the output of the graph? I am using the first column as an index for the second columns. The plot shows the temperatures on the y-axis without issue however the x-axis seems to just be a count rather than dates.</p>
<p>‘DateTime’ ‘WeatherLow’ are my headers</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=423894#respond" onclick='return addComment.moveForm( "comment-423894", "423894", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423928">
<div class="comment-container" id="li-comment-423928">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 19, 2017 at 4:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-423928" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, you can use use the count of time steps and the time stamps from the origional dataset. With this you can tie predictions back to time stamps, but its a bit of custom code for sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=423928#respond" onclick='return addComment.moveForm( "comment-423928", "423928", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424026">
<div class="comment-container" id="li-comment-424026">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d95bc3b9eb4fd3a4520aab0837c2d0ef?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d95bc3b9eb4fd3a4520aab0837c2d0ef?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Clement</span>
<span class="date">December 20, 2017 at 3:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424026" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I tried to predict these data with more classical Machine Learning methods (such as Bayesian Linear Regression or Decision Trees).<br/>
I tried with both non-stationary data and stationary (made by log + differencing).<br/>
For methods like Decision Trees, the results were better with stationary data but for Bayesian Linear Regression they were far better with non-stationary data.<br/>
Do you have any explanation ?</p>
<p>Thanks,<br/>
Clement</p>
<div class="reply">
<a aria-label="Reply to Clement" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424026#respond" onclick='return addComment.moveForm( "comment-424026", "424026", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424061">
<div class="comment-container" id="li-comment-424061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work.</p>
<p>Problems vary. It is always a good idea to test a suite of methods and method configurations. Picking methods analytically will not give good results unless your problem is trivial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424061#respond" onclick='return addComment.moveForm( "comment-424061", "424061", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424077">
<div class="comment-container" id="li-comment-424077">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 20, 2017 at 7:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424077" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>As your tutorial, for the input_data we prepared, the rows are how many observations, columns are look_back data (t-1, t-2, t-3…). </p>
<p>My training dataset includes 1M different store-item pairs, for each of the pair, there are 3 year time series sales data. I need to forecast sales for certain store-item pair. How can I prepare the input_data? I am thinking rows are 1M pairs, columns are look-back (t-1,t-2,t-3…), but can I differentiate certain store-item pairs, so that given a certain pair, I can make better forecast? Do I need an embedding layer?</p>
<p>Also, I can I define the look-back length? Does it make sense use 3 year as the look-back?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424077#respond" onclick='return addComment.moveForm( "comment-424077", "424077", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-424078">
<div class="comment-container" id="li-comment-424078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 20, 2017 at 7:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, typo: “How can I differentiate certain store-item pairs?”</p>
<p>“How can I define the look-back length?”</p>
<p>thx!</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424078#respond" onclick='return addComment.moveForm( "comment-424078", "424078", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424171">
<div class="comment-container" id="li-comment-424171">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 3:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424171" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are many ways to frame your problem, I’d encourage you to brainstorm then test each to see what works best for your specific data.</p>
<p>Perhaps per-store or per-item models would be a good (easy) place to start?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424171#respond" onclick='return addComment.moveForm( "comment-424171", "424171", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-424207">
<div class="comment-container" id="li-comment-424207">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 20, 2017 at 7:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424207" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thx for your reply! I tried per-store and per-item, there are only 4000 values. My prediction looks bad, and I think it is probably because the data is too small for the LSTM model. </p>
<p>Then I tried to add embedding layers, but I am not sure when it goes to model.fit(x_train, y_train), what is the shape of the dataset should be. Do you have any tutorial about how to add the embedding layers? or hints about other ways to achieve this? thx!</p>
<div class="reply">
<a aria-label="Reply to Icy" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424207#respond" onclick='return addComment.moveForm( "comment-424207", "424207", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-424246">
<div class="comment-container" id="li-comment-424246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have many posts on embedding layers for text data, you can use the blog search.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424246#respond" onclick='return addComment.moveForm( "comment-424246", "424246", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-424283">
<div class="comment-container" id="li-comment-424283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8283ec6e7dd6e25a712f850f7fe17401?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Icy</span>
<span class="date">December 21, 2017 at 12:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thx! That helps a lot!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-424296">
<div class="comment-container" id="li-comment-424296">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 3:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424296" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-424088">
<div class="comment-container" id="li-comment-424088">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4ebfe51da51807eadddbeac6a00ff8c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4ebfe51da51807eadddbeac6a00ff8c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Volodymyr</span>
<span class="date">December 20, 2017 at 9:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424088" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr. Jason<br/>
thx for great topic, but i cant find a t+1 value, how can I print(t+1) value</p>
<div class="reply">
<a aria-label="Reply to Volodymyr" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424088#respond" onclick='return addComment.moveForm( "comment-424088", "424088", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424170">
<div class="comment-container" id="li-comment-424170">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 3:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424170" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>t+1 is the next observation in your data from the current time step t.</p>
<p>If this is a new concept, perhaps you would be better to start here:<br/>
<a href="https://machinelearningmastery.com/start-here/#timeseries" rel="nofollow">https://machinelearningmastery.com/start-here/#timeseries</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424170#respond" onclick='return addComment.moveForm( "comment-424170", "424170", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-424178">
<div class="comment-container" id="li-comment-424178">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b5c0da1b04c7e05757ab2173ab0f2eaf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b5c0da1b04c7e05757ab2173ab0f2eaf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">chanchal suman</span>
<span class="date">December 20, 2017 at 4:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424178" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello sir,<br/>
I want to implement LSTM network for classification. I have 41 features and 5 class. I don’t know how to use look-back for classification. I have read 1 paper ” Kim, Jihyun, and Howon Kim. “An Effective Intrusion Detection Classifier Using Long Short-Term Memory with Gradient Descent Optimization.” Platform Technology and Service (PlatCon), 2017 International Conference on. IEEE, 2017.” They have not mentioned look back. I have to implement the paper as assignment. please help me.</p>
<div class="reply">
<a aria-label="Reply to chanchal suman" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424178#respond" onclick='return addComment.moveForm( "comment-424178", "424178", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424244">
<div class="comment-container" id="li-comment-424244">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424244" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424244#respond" onclick='return addComment.moveForm( "comment-424244", "424244", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-424280">
<div class="comment-container" id="li-comment-424280">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c6497d950ce9a82ff88b3ffb43ea35e5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c6497d950ce9a82ff88b3ffb43ea35e5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Juan Cruz</span>
<span class="date">December 21, 2017 at 11:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424280" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Brownlee,</p>
<p>Congratulations for your excelent guide. I was wondering if it was possible to feed the output of the model and see how it works with that instead.</p>
<p>Thank ou!</p>
<div class="reply">
<a aria-label="Reply to Juan Cruz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424280#respond" onclick='return addComment.moveForm( "comment-424280", "424280", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424295">
<div class="comment-container" id="li-comment-424295">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 3:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424295" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean by feed the output of the model?</p>
<p>You can make predictions as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6592a0016aa796057321" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X = ...
yhat = model.predict(X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6592a0016aa796057321-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6592a0016aa796057321-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6592a0016aa796057321-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6592a0016aa796057321-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424295#respond" onclick='return addComment.moveForm( "comment-424295", "424295", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-424587">
<div class="comment-container" id="li-comment-424587">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tom</span>
<span class="date">December 23, 2017 at 10:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424587" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for this awesome tutorial and did implement it and it works fine, however I tried to implement it in another data set which contains 5 features not just one. So I got this error<br/>
(Traceback (most recent call last): File “E:/Tutorial/pan.py”, line 68, in trainPredict = scaler.inverse_transform(trainPredict) File “C:\Users\sydgo\Anaconda3\lib\site-packages\sklearn\preprocessing\data.py”, line 385, in inverse_transform X -= self.min_ ValueError: non-broadcastable output operand with shape (45498,1) doesn’t match the broadcast shape (45498,5))<br/>
So I don’t know what to do.</p>
<div class="reply">
<a aria-label="Reply to tom" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424587#respond" onclick='return addComment.moveForm( "comment-424587", "424587", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424619">
<div class="comment-container" id="li-comment-424619">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 24, 2017 at 4:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424619" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Tom, this post will show you how to model multiple input features:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424619#respond" onclick='return addComment.moveForm( "comment-424619", "424619", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-424789">
<div class="comment-container" id="li-comment-424789">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a6db74597369f1241ca26c7d6145888?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a6db74597369f1241ca26c7d6145888?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.rooking.co.jp" rel="external nofollow">phuong phan</a></span>
<span class="date">December 26, 2017 at 4:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424789" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Dr. Jason Brownlee, Thank you so so so much for your wonderful tutorials.</p>
<div class="reply">
<a aria-label="Reply to phuong phan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424789#respond" onclick='return addComment.moveForm( "comment-424789", "424789", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424819">
<div class="comment-container" id="li-comment-424819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 27, 2017 at 5:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-424819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=424819#respond" onclick='return addComment.moveForm( "comment-424819", "424819", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425974">
<div class="comment-container" id="li-comment-425974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e51fe8b7253165eeadfa41b4702c380f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e51fe8b7253165eeadfa41b4702c380f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shud</span>
<span class="date">January 9, 2018 at 6:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-425974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>My data have weekly seasonality. Then what do you suggest as good look_back? Having look_back as 7 obviously gives good result compared to other look_back(3,4,5) because of weekly seasonality. Is it good to use 7? Using linear regression with 7 day lag variable gave me very good result. I don’t see the need of going to LSTM to achieve good result. So what would you do in this scenario.Thanks!</p>
<div class="reply">
<a aria-label="Reply to Shud" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=425974#respond" onclick='return addComment.moveForm( "comment-425974", "425974", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426053">
<div class="comment-container" id="li-comment-426053">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-426053" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Experiments and see what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=426053#respond" onclick='return addComment.moveForm( "comment-426053", "426053", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426765">
<div class="comment-container" id="li-comment-426765">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hellome</span>
<span class="date">January 18, 2018 at 2:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-426765" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I am working on a prediction model that learns with each data point. Could you give any suggestions how this could be modified to suit the purpose. Also rather than retraining the complete LSTM model is it possible to just refit the LSTM network according to the new data point as well.</p>
<div class="reply">
<a aria-label="Reply to Hellome" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=426765#respond" onclick='return addComment.moveForm( "comment-426765", "426765", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426805">
<div class="comment-container" id="li-comment-426805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2018 at 10:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#comment-426805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is called model updating, see here:<br/>
<a href="https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/?replytocom=426805#respond" onclick='return addComment.moveForm( "comment-426805", "426805", "respond", "2929" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/time-series-prediction-lstm-recurrent-neural-networks-python-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="2929"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="7263a54b00"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="67"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>