<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Implement Stacked Generalization From Scratch With Python - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/implementing-stacking-scratch-python/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Implement Stacked Generalization From Scratch With Python - Machine Learning Mastery" property="og:title"/>
<meta content="Code a Stacking Ensemble From Scratch in Python, Step-by-Step. Ensemble methods are an excellent way to improve predictive performance on your machine learning problems. Stacked Generalization or stacking is an ensemble technique that uses a new model to learn how to best combine the predictions from two or more models trained on your dataset. In …" property="og:description"/>
<meta content="https://machinelearningmastery.com/implementing-stacking-scratch-python/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Algorithms From Scratch" property="article:section"/>
<meta content="2016-11-16T05:00:13+11:00" property="article:published_time"/>
<meta content="2017-01-13T09:54:15+11:00" property="article:modified_time"/>
<meta content="2017-01-13T09:54:15+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/11/How-to-Implementing-Stacking-From-Scratch-With-Python.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/11/How-to-Implementing-Stacking-From-Scratch-With-Python.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="426" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/implementing-stacking-scratch-python\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/implementing-stacking-scratch-python/feed/" rel="alternate" title="Machine Learning Mastery » How to Implement Stacked Generalization From Scratch With Python Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3367" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fimplementing-stacking-scratch-python%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fimplementing-stacking-scratch-python%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3367 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-18"> <div class="textwidget"><p>Need help with machine learning? <a href="https://machinelearningmastery.leadpages.co/machine-learning-resource-guide/">Take the FREE Crash-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3367 post type-post status-publish format-standard has-post-thumbnail hentry category-algorithms-from-scratch">
<header>
<h1 class="title entry-title">How to Implement Stacked Generalization From Scratch With Python</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2016-11-16T05:00:13+1100">November 16, 2016</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/" title="View all items in Algorithms From Scratch">Algorithms From Scratch</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fimplementing-stacking-scratch-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/implementing-stacking-scratch-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/implementing-stacking-scratch-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https://machinelearningmastery.com/implementing-stacking-scratch-python/&amp;summary=Code+a+Stacking+Ensemble+From+Scratch+in+Python%2C+Step-by-Step.%0D%0AEnsemble+methods+are+an+excellent+wa..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https://machinelearningmastery.com/implementing-stacking-scratch-python/&amp;summary=Code+a+Stacking+Ensemble+From+Scratch+in+Python%2C+Step-by-Step.%0D%0AEnsemble+methods+are+an+excellent+wa...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/implementing-stacking-scratch-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/implementing-stacking-scratch-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><h3 style="text-align: center;">Code a Stacking Ensemble From Scratch in Python, Step-by-Step.</h3>
<p>Ensemble methods are an excellent way to improve predictive performance on your machine learning problems.</p>
<p>Stacked Generalization or stacking is an ensemble technique that uses a new model to learn how to best combine the predictions from two or more models trained on your dataset.</p>
<p>In this tutorial, you will discover how to implement stacking from scratch in Python.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to learn to combine the predictions from multiple models on a dataset.</li>
<li>How to apply stacked generalization to a real-world predictive modeling problem.</li>
</ul>
<p>Let’s get started.</p>
<p><strong>Update Jan/2017</strong>: Changed the calculation of fold_size in cross_validation_split() to always be an integer. Fixes issues with Python 3.</p>
<div class="wp-caption aligncenter" id="attachment_3368" style="max-width: 650px"><img alt="How to Implementing Stacking From Scratch With Python" class="size-full wp-image-3368" height="426" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/11/How-to-Implementing-Stacking-From-Scratch-With-Python.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/11/How-to-Implementing-Stacking-From-Scratch-With-Python.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/11/How-to-Implementing-Stacking-From-Scratch-With-Python-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Implementing Stacking From Scratch With Python<br/>Photo by <a href="https://www.flickr.com/photos/rueful/7885846128/">Kiran Foster</a>, some rights reserved.</p></div>
<h2>Description</h2>
<p>This section provides a brief overview of the Stacked Generalization algorithm and the Sonar dataset used in this tutorial.</p>
<h3>Stacked Generalization Algorithm</h3>
<p>Stacked Generalization or stacking is an ensemble algorithm where a new model is trained to combine the predictions from two or more models already trained or your dataset.</p>
<p>The predictions from the existing models or submodels are combined using a new model, and as such stacking is often referred to as blending, as the predictions from sub-models are blended together.</p>
<p>It is typical to use a simple linear method to combine the predictions for submodels such as simple averaging or voting, to a weighted sum using linear regression or logistic regression.</p>
<p>Models that have their predictions combined must have skill on the problem, but do not need to be the best possible models. This means that you do not need to tune the submodels intently, as long as the model shows some advantage over a baseline prediction.</p>
<p>It is important that sub-models produce different predictions, so-called uncorrelated predictions. Stacking works best when the predictions that are combined are all skillful, but skillful in different ways. This may be achieved by using algorithms that use very different internal representations (trees compared to instances) and/or models trained on different representations or projections of the training data.</p>
<p>In this tutorial, we will look at taking two very different and untuned sub-models and combining their predictions with a simple logistic regression algorithm.</p>
<h3>Sonar Dataset</h3>
<p>The dataset we will use in this tutorial is the Sonar dataset.</p>
<p>This is a dataset that describes sonar chirp returns bouncing off different surfaces. The 60 input variables are the strength of the returns at different angles. It is a binary classification problem that requires a model to differentiate rocks from metal cylinders. There are 208 observations.</p>
<p>It is a well-understood dataset. All of the variables are continuous and generally in the range of 0 to 1. The output variable is a string “M” for mine and “R” for rock, which will need to be converted to integers 1 and 0.</p>
<p>By predicting the class with the most observations in the dataset (M or mines) the Zero Rule Algorithm can achieve an accuracy of about 53%.</p>
<p>You can learn more about this dataset at the <a href="https://archive.ics.uci.edu/ml/datasets/Connectionist+Bench+(Sonar,+Mines+vs.+Rocks)">UCI Machine Learning repository</a>.</p>
<p>Download the dataset for free and place it in your working directory with the filename <strong>sonar.all-data.csv</strong>.</p>
<h2>Tutorial</h2>
<p>This tutorial is broken down into 3 steps:</p>
<ol>
<li>Sub-models and Aggregator.</li>
<li>Combining Predictions.</li>
<li>Sonar Dataset Case Study.</li>
</ol>
<p>These steps provide the foundation that you need to understand and implement stacking on your own predictive modeling problems.</p>
<h3>1. Sub-models and Aggregator</h3>
<p>We are going to use two models as submodels for stacking and a linear model as the aggregator model.</p>
<p>This part is divided into 3 sections:</p>
<ol>
<li>Sub-model #1: k-Nearest Neighbors.</li>
<li>Sub-model #2: Perceptron.</li>
<li>Aggregator Model: Logistic Regression.</li>
</ol>
<p>Each model will be described in terms of the functions used train the model and a function used to make predictions.</p>
<h4>1.1 Sub-model #1: k-Nearest Neighbors</h4>
<p>The k-Nearest Neighbors algorithm or kNN uses the entire training dataset as the model.</p>
<p>Therefore training the model involves retaining the training dataset. Below is a function named <strong>knn_model()</strong> that does just this.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e818233801353" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Prepare the kNN model
def knn_model(train):
	return train</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e818233801353-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e818233801353-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e818233801353-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e818233801353-1"><span class="crayon-p"># Prepare the kNN model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e818233801353-2"><span class="crayon-e">def </span><span class="crayon-e">knn_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e818233801353-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Making predictions involves finding the k most similar records in the training dataset and selecting the most common class values. The Euclidean distance function is used to calculate the similarity between new rows of data and rows in the training dataset.</p>
<p>Below are these helper functions that involve making predictions for a kNN model. The function <strong>euclidean_distance()</strong> calculates the distance between two rows of data, <strong>get_neighbors()</strong> locates all neighbors for in the training dataset for a new row of data and <strong>knn_predict()</strong> makes a prediction from the neighbors for a new row of data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e827725168609" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Calculate the Euclidean distance between two vectors
def euclidean_distance(row1, row2):
	distance = 0.0
	for i in range(len(row1)-1):
		distance += (row1[i] - row2[i])**2
	return sqrt(distance)

# Locate neighbors for a new row
def get_neighbors(train, test_row, num_neighbors):
	distances = list()
	for train_row in train:
		dist = euclidean_distance(test_row, train_row)
		distances.append((train_row, dist))
	distances.sort(key=lambda tup: tup[1])
	neighbors = list()
	for i in range(num_neighbors):
		neighbors.append(distances[i][0])
	return neighbors

# Make a prediction with kNN
def knn_predict(model, test_row, num_neighbors=2):
	neighbors = get_neighbors(model, test_row, num_neighbors)
	output_values = [row[-1] for row in neighbors]
	prediction = max(set(output_values), key=output_values.count)
	return prediction</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-8">8</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-10">10</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-12">12</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-14">14</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-16">16</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-18">18</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-20">20</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-22">22</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e827725168609-24">24</div><div class="crayon-num" data-line="crayon-5a65920c7e827725168609-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e827725168609-1"><span class="crayon-p"># Calculate the Euclidean distance between two vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-2"><span class="crayon-e">def </span><span class="crayon-e">euclidean_distance</span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-3"><span class="crayon-h"> </span><span class="crayon-v">distance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-5"><span class="crayon-h"> </span><span class="crayon-v">distance</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">row2</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">distance</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-8"><span class="crayon-p"># Locate neighbors for a new row</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-9"><span class="crayon-e">def </span><span class="crayon-e">get_neighbors</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-10"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">train_row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-12"><span class="crayon-h"> </span><span class="crayon-v">dist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">euclidean_distance</span><span class="crayon-sy">(</span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-13"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dist</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-14"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-15"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-17"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">distances</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">neighbors</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-19"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-20"><span class="crayon-p"># Make a prediction with kNN</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-21"><span class="crayon-e">def </span><span class="crayon-e">knn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-22"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_neighbors</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-23"><span class="crayon-h"> </span><span class="crayon-v">output_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e827725168609-24"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">output_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-v">output_values</span><span class="crayon-sy">.</span><span class="crayon-v">count</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e827725168609-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>You can see that the number of neighbors (k) is set to 2 as a default parameter on the <strong>knn_predict()</strong> function. This number was chosen with a little trial and error and was not tuned.</p>
<p>Now that we have the building blocks for a kNN model, let’s look at the Perceptron algorithm.</p>
<h4>1.2 Sub-model #2: Perceptron</h4>
<p>The model for the Perceptron algorithm is a set of weights learned from the training data.</p>
<p>In order to train the weights, many predictions need to be made on the training data in order to calculate error values. Therefore, both model training and prediction require a function for prediction.</p>
<p>Below are the helper functions for implementing the Perceptron algorithm. The <strong>perceptron_model()</strong> function trains the Perceptron model on the training dataset and <strong>perceptron_predict()</strong> is used to make a prediction for a row of data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e82d855103586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Make a prediction with weights
def perceptron_predict(model, row):
	activation = model[0]
	for i in range(len(row)-1):
		activation += model[i + 1] * row[i]
	return 1.0 if activation &gt;= 0.0 else 0.0

# Estimate Perceptron weights using stochastic gradient descent
def perceptron_model(train, l_rate=0.01, n_epoch=5000):
	weights = [0.0 for i in range(len(train[0]))]
	for epoch in range(n_epoch):
		for row in train:
			prediction = perceptron_predict(weights, row)
			error = row[-1] - prediction
			weights[0] = weights[0] + l_rate * error
			for i in range(len(row)-1):
				weights[i + 1] = weights[i + 1] + l_rate * error * row[i]
	return weights</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-8">8</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-10">10</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-12">12</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-14">14</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-16">16</div><div class="crayon-num" data-line="crayon-5a65920c7e82d855103586-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e82d855103586-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e82d855103586-1"><span class="crayon-p"># Make a prediction with weights</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-2"><span class="crayon-e">def </span><span class="crayon-e">perceptron_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-3"><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-5"><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-8"><span class="crayon-p"># Estimate Perceptron weights using stochastic gradient descent</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-9"><span class="crayon-e">def </span><span class="crayon-e">perceptron_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l_rate</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epoch</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-10"><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-13"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">perceptron_predict</span><span class="crayon-sy">(</span><span class="crayon-v">weights</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-14"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">prediction</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-15"><span class="crayon-e"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-16"><span class="crayon-e"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e82d855103586-17"><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e82d855103586-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weights</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>The <strong>perceptron_model()</strong> model specifies both a learning rate and number of training epochs as default parameters. Again, these parameters were chosen with a little bit of trial and error, but were not tuned on the dataset.</p>
<p>We now have implementations for both sub-models, let’s look at implementing the aggregator model.</p>
<h4>1.3 Aggregator Model: Logistic Regression</h4>
<p>Like the Perceptron algorithm, Logistic Regression uses a set of weights, called coefficients, as the representation of the model.</p>
<p>And like the Perceptron algorithm, the coefficients are learned by iteratively making predictions on the training data and updating them.</p>
<p>Below are the helper functions for implementing the logistic regression algorithm. The <strong>logistic_regression_model()</strong> function is used to train the coefficients on the training dataset and <strong>logistic_regression_predict()</strong> is used to make a prediction for a row of data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e833950408902" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Make a prediction with coefficients
def logistic_regression_predict(model, row):
	yhat = model[0]
	for i in range(len(row)-1):
		yhat += model[i + 1] * row[i]
	return 1.0 / (1.0 + exp(-yhat))

# Estimate logistic regression coefficients using stochastic gradient descent
def logistic_regression_model(train, l_rate=0.01, n_epoch=5000):
	coef = [0.0 for i in range(len(train[0]))]
	for epoch in range(n_epoch):
		for row in train:
			yhat = logistic_regression_predict(coef, row)
			error = row[-1] - yhat
			coef[0] = coef[0] + l_rate * error * yhat * (1.0 - yhat)
			for i in range(len(row)-1):
				coef[i + 1] = coef[i + 1] + l_rate * error * yhat * (1.0 - yhat) * row[i]
	return coef</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-8">8</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-10">10</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-12">12</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-14">14</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-16">16</div><div class="crayon-num" data-line="crayon-5a65920c7e833950408902-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e833950408902-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e833950408902-1"><span class="crayon-p"># Make a prediction with coefficients</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-2"><span class="crayon-e">def </span><span class="crayon-e">logistic_regression_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-3"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-5"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-8"><span class="crayon-p"># Estimate logistic regression coefficients using stochastic gradient descent</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-9"><span class="crayon-e">def </span><span class="crayon-e">logistic_regression_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l_rate</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epoch</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-10"><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-13"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">logistic_regression_predict</span><span class="crayon-sy">(</span><span class="crayon-v">coef</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-14"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-15"><span class="crayon-e"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-e ">yhat *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e833950408902-17"><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-e ">yhat *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e833950408902-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">coef</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>The <strong>logistic_regression_model()</strong> defines a learning rate and number of epochs as default parameters, and as with the other algorithms, these parameters were found with a little trial and error and were not optimized.</p>
<p>Now that we have implementations of sub-models and the aggregator model, let’s see how we can combine the predictions from multiple models.</p>
<h3>2. Combining Predictions</h3>
<p>For a machine learning algorithm, learning how to combine predictions is much the same as learning from a training dataset.</p>
<p>A new training dataset can be constructed from the predictions of the sub-models, as follows:</p>
<ul>
<li>Each row represents one row in the training dataset.</li>
<li>The first column contains predictions for each row in the training dataset made by the first sub-model, such as k-Nearest Neighbors.</li>
<li>The second column contains predictions for each row in the training dataset made by the second sub-model, such as the Perceptron algorithm.</li>
<li>The third column contains the expected output value for the row in the training dataset.</li>
</ul>
<p>Below is a contrived example of what a constructed stacking dataset may look like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e839931513699" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
kNN,	Per,	Y
0,	0	0
1,	0	1
0,	1	0
1,	1	1
0,	1	0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e839931513699-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e839931513699-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e839931513699-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e839931513699-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e839931513699-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e839931513699-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e839931513699-1">kNN,	Per,	Y</div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e839931513699-2">0,	0	0</div><div class="crayon-line" id="crayon-5a65920c7e839931513699-3">1,	0	1</div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e839931513699-4">0,	1	0</div><div class="crayon-line" id="crayon-5a65920c7e839931513699-5">1,	1	1</div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e839931513699-6">0,	1	0</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A machine learning algorithm, such as logistic regression can then be trained on this new dataset. In essence, this new meta-algorithm learns how to best combine the prediction from multiple submodels.</p>
<p>Below is a function named <strong>to_stacked_row()</strong> that implements this procedure for creating new rows for this stacked dataset.</p>
<p>The function takes a list of models as input, these are used to make predictions. The function also takes a list of functions as input, one function used to make a prediction for each model. Finally, a single row from the training dataset is included.</p>
<p>A new row is constructed one column at a time. Predictions are calculated using each model and the row of training data. The expected output value from the training dataset row is then added as the last column to the row.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e83e215542255" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Make predictions with sub-models and construct a new stacked row
def to_stacked_row(models, predict_list, row):
	stacked_row = list()
	for i in range(len(models)):
		prediction = predict_list[i](models[i], row)
		stacked_row.append(prediction)
	stacked_row.append(row[-1])
	return stacked_row</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e83e215542255-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e83e215542255-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e83e215542255-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e83e215542255-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e83e215542255-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e83e215542255-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e83e215542255-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e83e215542255-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e83e215542255-1"><span class="crayon-p"># Make predictions with sub-models and construct a new stacked row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e83e215542255-2"><span class="crayon-e">def </span><span class="crayon-e">to_stacked_row</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e83e215542255-3"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e83e215542255-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e83e215542255-5"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e83e215542255-6"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e83e215542255-7"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e83e215542255-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>On some predictive modeling problems, it is possible to get an even larger boost by training the aggregated model on both the training row and the predictions made by sub-models.</p>
<p>This improvement gives the aggregator model both the context of all the data in the training row to help determine how and when to best combine the predictions of the sub-models.</p>
<p>We can update our <strong>to_stacked_row()</strong> function to include this by aggregating the training row (minus the final column) and the stacked row as created above.</p>
<p>Below is an updated version of the <strong>to_stacked_row()</strong> function that implements this improvement.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e843550254623" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Make predictions with sub-models and construct a new stacked row
def to_stacked_row(models, predict_list, row):
	stacked_row = list()
	for i in range(len(models)):
		prediction = predict_list[i](models[i], row)
		stacked_row.append(prediction)
	stacked_row.append(row[-1])
	return row[0:len(row)-1] + stacked_row</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e843550254623-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e843550254623-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e843550254623-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e843550254623-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e843550254623-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e843550254623-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e843550254623-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e843550254623-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e843550254623-1"><span class="crayon-p"># Make predictions with sub-models and construct a new stacked row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e843550254623-2"><span class="crayon-e">def </span><span class="crayon-e">to_stacked_row</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e843550254623-3"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e843550254623-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e843550254623-5"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e843550254623-6"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e843550254623-7"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e843550254623-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>It is a good idea to try both approaches on your problem to see which works best.</p>
<p>Now that we have all of the pieces for stacked generalization, we can apply it to a real-world problem.</p>
<h3>3. Sonar Dataset Case Study</h3>
<p>In this section, we will apply the Stacking algorithm to the Sonar dataset.</p>
<p>The example assumes that a CSV copy of the dataset is in the current working directory with the filename <strong>sonar.all-data.csv</strong>.</p>
<p>The dataset is first loaded, the string values converted to numeric and the output column is converted from strings to the integer values of 0 to 1. This is achieved with helper functions <strong>load_csv()</strong>, <strong>str_column_to_float()</strong> and <strong>str_column_to_int()</strong> to load and prepare the dataset.</p>
<p>We will use k-fold cross validation to estimate the performance of the learned model on unseen data. This means that we will construct and evaluate k models and estimate the performance as the mean model error. Classification accuracy will be used to evaluate the model. These behaviors are provided in the <strong>cross_validation_split()</strong>, <strong>accuracy_metric()</strong> and <strong>evaluate_algorithm()</strong> helper functions.</p>
<p>We will use the k-Nearest Neighbors, Perceptron and Logistic Regression algorithms implemented above. We will also use our technique for creating the new stacked dataset defined in the previous step.</p>
<p>A new function name <strong>stacking()</strong> is developed. This function does 4 things:</p>
<ol>
<li>It first trains a list of models (kNN and Perceptron).</li>
<li>It then uses the models to make predictions and create a new stacked dataset.</li>
<li>It then trains an aggregator model (logistic regression) on the stacked dataset.</li>
<li>It then uses the sub-models and aggregator model to make predictions on the test dataset.</li>
</ol>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e84a200611237" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Test stacking on the sonar dataset
from random import seed
from random import randrange
from csv import reader
from math import sqrt
from math import exp

# Load a CSV file
def load_csv(filename):
	dataset = list()
	with open(filename, 'r') as file:
		csv_reader = reader(file)
		for row in csv_reader:
			if not row:
				continue
			dataset.append(row)
	return dataset

# Convert string column to float
def str_column_to_float(dataset, column):
	for row in dataset:
		row[column] = float(row[column].strip())

# Convert string column to integer
def str_column_to_int(dataset, column):
	class_values = [row[column] for row in dataset]
	unique = set(class_values)
	lookup = dict()
	for i, value in enumerate(unique):
		lookup[value] = i
	for row in dataset:
		row[column] = lookup[row[column]]
	return lookup

# Split a dataset into k folds
def cross_validation_split(dataset, n_folds):
	dataset_split = list()
	dataset_copy = list(dataset)
	fold_size = int(len(dataset) / n_folds)
	for i in range(n_folds):
		fold = list()
		while len(fold) &lt; fold_size:
			index = randrange(len(dataset_copy))
			fold.append(dataset_copy.pop(index))
		dataset_split.append(fold)
	return dataset_split

# Calculate accuracy percentage
def accuracy_metric(actual, predicted):
	correct = 0
	for i in range(len(actual)):
		if actual[i] == predicted[i]:
			correct += 1
	return correct / float(len(actual)) * 100.0

# Evaluate an algorithm using a cross validation split
def evaluate_algorithm(dataset, algorithm, n_folds, *args):
	folds = cross_validation_split(dataset, n_folds)
	scores = list()
	for fold in folds:
		train_set = list(folds)
		train_set.remove(fold)
		train_set = sum(train_set, [])
		test_set = list()
		for row in fold:
			row_copy = list(row)
			test_set.append(row_copy)
			row_copy[-1] = None
		predicted = algorithm(train_set, test_set, *args)
		actual = [row[-1] for row in fold]
		accuracy = accuracy_metric(actual, predicted)
		scores.append(accuracy)
	return scores

# Calculate the Euclidean distance between two vectors
def euclidean_distance(row1, row2):
	distance = 0.0
	for i in range(len(row1)-1):
		distance += (row1[i] - row2[i])**2
	return sqrt(distance)

# Locate neighbors for a new row
def get_neighbors(train, test_row, num_neighbors):
	distances = list()
	for train_row in train:
		dist = euclidean_distance(test_row, train_row)
		distances.append((train_row, dist))
	distances.sort(key=lambda tup: tup[1])
	neighbors = list()
	for i in range(num_neighbors):
		neighbors.append(distances[i][0])
	return neighbors

# Make a prediction with kNN
def knn_predict(model, test_row, num_neighbors=2):
	neighbors = get_neighbors(model, test_row, num_neighbors)
	output_values = [row[-1] for row in neighbors]
	prediction = max(set(output_values), key=output_values.count)
	return prediction

# Prepare the kNN model
def knn_model(train):
	return train

# Make a prediction with weights
def perceptron_predict(model, row):
	activation = model[0]
	for i in range(len(row)-1):
		activation += model[i + 1] * row[i]
	return 1.0 if activation &gt;= 0.0 else 0.0

# Estimate Perceptron weights using stochastic gradient descent
def perceptron_model(train, l_rate=0.01, n_epoch=5000):
	weights = [0.0 for i in range(len(train[0]))]
	for epoch in range(n_epoch):
		for row in train:
			prediction = perceptron_predict(weights, row)
			error = row[-1] - prediction
			weights[0] = weights[0] + l_rate * error
			for i in range(len(row)-1):
				weights[i + 1] = weights[i + 1] + l_rate * error * row[i]
	return weights

# Make a prediction with coefficients
def logistic_regression_predict(model, row):
	yhat = model[0]
	for i in range(len(row)-1):
		yhat += model[i + 1] * row[i]
	return 1.0 / (1.0 + exp(-yhat))

# Estimate logistic regression coefficients using stochastic gradient descent
def logistic_regression_model(train, l_rate=0.01, n_epoch=5000):
	coef = [0.0 for i in range(len(train[0]))]
	for epoch in range(n_epoch):
		for row in train:
			yhat = logistic_regression_predict(coef, row)
			error = row[-1] - yhat
			coef[0] = coef[0] + l_rate * error * yhat * (1.0 - yhat)
			for i in range(len(row)-1):
				coef[i + 1] = coef[i + 1] + l_rate * error * yhat * (1.0 - yhat) * row[i]
	return coef

# Make predictions with sub-models and construct a new stacked row
def to_stacked_row(models, predict_list, row):
	stacked_row = list()
	for i in range(len(models)):
		prediction = predict_list[i](models[i], row)
		stacked_row.append(prediction)
	stacked_row.append(row[-1])
	return row[0:len(row)-1] + stacked_row

# Stacked Generalization Algorithm
def stacking(train, test):
	model_list = [knn_model, perceptron_model]
	predict_list = [knn_predict, perceptron_predict]
	models = list()
	for i in range(len(model_list)):
		model = model_list[i](train)
		models.append(model)
	stacked_dataset = list()
	for row in train:
		stacked_row = to_stacked_row(models, predict_list, row)
		stacked_dataset.append(stacked_row)
	stacked_model = logistic_regression_model(stacked_dataset)
	predictions = list()
	for row in test:
		stacked_row = to_stacked_row(models, predict_list, row)
		stacked_dataset.append(stacked_row)
		prediction = logistic_regression_predict(stacked_model, stacked_row)
		prediction = round(prediction)
		predictions.append(prediction)
	return predictions

# Test stacking on the sonar dataset
seed(1)
# load and prepare data
filename = 'sonar.all-data.csv'
dataset = load_csv(filename)
# convert string attributes to integers
for i in range(len(dataset[0])-1):
	str_column_to_float(dataset, i)
# convert class column to integers
str_column_to_int(dataset, len(dataset[0])-1)
n_folds = 3
scores = evaluate_algorithm(dataset, stacking, n_folds)
print('Scores: %s' % scores)
print('Mean Accuracy: %.3f%%' % (sum(scores)/float(len(scores))))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-2">2</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-4">4</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-6">6</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-8">8</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-10">10</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-12">12</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-14">14</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-16">16</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-18">18</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-20">20</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-22">22</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-24">24</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-26">26</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-28">28</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-30">30</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-32">32</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-34">34</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-36">36</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-38">38</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-40">40</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-42">42</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-44">44</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-46">46</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-48">48</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-50">50</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-52">52</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-54">54</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-56">56</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-58">58</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-60">60</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-62">62</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-64">64</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-66">66</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-68">68</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-70">70</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-72">72</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-74">74</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-76">76</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-78">78</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-80">80</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-82">82</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-84">84</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-86">86</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-88">88</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-90">90</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-92">92</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-94">94</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-96">96</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-98">98</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-100">100</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-102">102</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-104">104</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-106">106</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-108">108</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-110">110</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-112">112</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-114">114</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-116">116</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-118">118</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-120">120</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-122">122</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-124">124</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-126">126</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-128">128</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-130">130</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-132">132</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-134">134</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-136">136</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-138">138</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-140">140</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-142">142</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-144">144</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-146">146</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-148">148</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-150">150</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-152">152</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-154">154</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-156">156</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-158">158</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-160">160</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-162">162</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-164">164</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-166">166</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-168">168</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-170">170</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-172">172</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-174">174</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-176">176</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-178">178</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-180">180</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-182">182</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-184">184</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e84a200611237-186">186</div><div class="crayon-num" data-line="crayon-5a65920c7e84a200611237-187">187</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e84a200611237-1"><span class="crayon-p"># Test stacking on the sonar dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-3"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randrange</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-4"><span class="crayon-e">from </span><span class="crayon-e">csv </span><span class="crayon-e">import </span><span class="crayon-e">reader</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-5"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-6"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-v">exp</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-8"><span class="crayon-p"># Load a CSV file</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-9"><span class="crayon-e">def </span><span class="crayon-e">load_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-10"><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-11"><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-12"><span class="crayon-h"> </span><span class="crayon-v">csv_reader</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">reader</span><span class="crayon-sy">(</span><span class="crayon-v">file</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">csv_reader</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-14"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-15"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-16"><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-18"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-19"><span class="crayon-p"># Convert string column to float</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-20"><span class="crayon-e">def </span><span class="crayon-e">str_column_to_float</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">column</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-21"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-22"><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">column</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">column</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-23"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-24"><span class="crayon-p"># Convert string column to integer</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-25"><span class="crayon-e">def </span><span class="crayon-e">str_column_to_int</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">column</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-26"><span class="crayon-h"> </span><span class="crayon-v">class_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">column</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-27"><span class="crayon-h"> </span><span class="crayon-v">unique</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">class_values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-28"><span class="crayon-h"> </span><span class="crayon-v">lookup</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-29"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-30"><span class="crayon-h"> </span><span class="crayon-v">lookup</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-31"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-32"><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">column</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lookup</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">column</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lookup</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-34"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-35"><span class="crayon-p"># Split a dataset into k folds</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-36"><span class="crayon-e">def </span><span class="crayon-e">cross_validation_split</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_folds</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-37"><span class="crayon-h"> </span><span class="crayon-v">dataset_split</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-38"><span class="crayon-h"> </span><span class="crayon-v">dataset_copy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-39"><span class="crayon-h"> </span><span class="crayon-v">fold_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">n_folds</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_folds</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-41"><span class="crayon-h"> </span><span class="crayon-v">fold</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-42"><span class="crayon-h"> </span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">fold</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">fold_size</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-43"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">randrange</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset_copy</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-44"><span class="crayon-h"> </span><span class="crayon-v">fold</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">dataset_copy</span><span class="crayon-sy">.</span><span class="crayon-e">pop</span><span class="crayon-sy">(</span><span class="crayon-v">index</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-45"><span class="crayon-h"> </span><span class="crayon-v">dataset_split</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">fold</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-46"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dataset_split</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-47"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-48"><span class="crayon-p"># Calculate accuracy percentage</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-49"><span class="crayon-e">def </span><span class="crayon-e">accuracy_metric</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-50"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-51"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-52"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-53"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-54"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">100.0</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-56"><span class="crayon-p"># Evaluate an algorithm using a cross validation split</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-57"><span class="crayon-e">def </span><span class="crayon-e">evaluate_algorithm</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">algorithm</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_folds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-58"><span class="crayon-h"> </span><span class="crayon-v">folds</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cross_validation_split</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_folds</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-59"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-60"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">fold </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">folds</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-61"><span class="crayon-h"> </span><span class="crayon-v">train_set</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">folds</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-62"><span class="crayon-h"> </span><span class="crayon-v">train_set</span><span class="crayon-sy">.</span><span class="crayon-e">remove</span><span class="crayon-sy">(</span><span class="crayon-v">fold</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-63"><span class="crayon-h"> </span><span class="crayon-v">train_set</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">train_set</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-64"><span class="crayon-h"> </span><span class="crayon-v">test_set</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-65"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fold</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-66"><span class="crayon-h"> </span><span class="crayon-v">row_copy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-67"><span class="crayon-h"> </span><span class="crayon-v">test_set</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row_copy</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-68"><span class="crayon-h"> </span><span class="crayon-v">row_copy</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-69"><span class="crayon-e"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">algorithm</span><span class="crayon-sy">(</span><span class="crayon-v">train_set</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_set</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">args</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-70"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">fold</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-71"><span class="crayon-h"> </span><span class="crayon-v">accuracy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">accuracy_metric</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-72"><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">accuracy</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-73"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-74"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-75"><span class="crayon-p"># Calculate the Euclidean distance between two vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-76"><span class="crayon-e">def </span><span class="crayon-e">euclidean_distance</span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-77"><span class="crayon-h"> </span><span class="crayon-v">distance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-78"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-79"><span class="crayon-h"> </span><span class="crayon-v">distance</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">row1</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">row2</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">distance</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-82"><span class="crayon-p"># Locate neighbors for a new row</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-83"><span class="crayon-e">def </span><span class="crayon-e">get_neighbors</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-84"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-85"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">train_row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-86"><span class="crayon-h"> </span><span class="crayon-v">dist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">euclidean_distance</span><span class="crayon-sy">(</span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-87"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dist</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-88"><span class="crayon-h"> </span><span class="crayon-v">distances</span><span class="crayon-sy">.</span><span class="crayon-e">sort</span><span class="crayon-sy">(</span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-e">lambda </span><span class="crayon-v">tup</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">tup</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-89"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-90"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-91"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">distances</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-92"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">neighbors</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-93"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-94"><span class="crayon-p"># Make a prediction with kNN</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-95"><span class="crayon-e">def </span><span class="crayon-e">knn_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-96"><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_neighbors</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_neighbors</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-97"><span class="crayon-h"> </span><span class="crayon-v">output_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">neighbors</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-98"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">output_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-o">=</span><span class="crayon-v">output_values</span><span class="crayon-sy">.</span><span class="crayon-v">count</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-99"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-100"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-101"><span class="crayon-p"># Prepare the kNN model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-102"><span class="crayon-e">def </span><span class="crayon-e">knn_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-103"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-104"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-105"><span class="crayon-p"># Make a prediction with weights</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-106"><span class="crayon-e">def </span><span class="crayon-e">perceptron_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-107"><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-109"><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-110"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-cn">0.0</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-111"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-112"><span class="crayon-p"># Estimate Perceptron weights using stochastic gradient descent</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-113"><span class="crayon-e">def </span><span class="crayon-e">perceptron_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l_rate</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epoch</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-114"><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-115"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-116"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-117"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">perceptron_predict</span><span class="crayon-sy">(</span><span class="crayon-v">weights</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-118"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">prediction</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-119"><span class="crayon-e"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e">error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-120"><span class="crayon-e"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-121"><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-122"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weights</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-123"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-124"><span class="crayon-p"># Make a prediction with coefficients</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-125"><span class="crayon-e">def </span><span class="crayon-e">logistic_regression_predict</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-126"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-127"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-128"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-129"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-130"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-131"><span class="crayon-p"># Estimate logistic regression coefficients using stochastic gradient descent</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-132"><span class="crayon-e">def </span><span class="crayon-e">logistic_regression_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l_rate</span><span class="crayon-o">=</span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epoch</span><span class="crayon-o">=</span><span class="crayon-cn">5000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-133"><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-134"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-135"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-136"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">logistic_regression_predict</span><span class="crayon-sy">(</span><span class="crayon-v">coef</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-137"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-138"><span class="crayon-e"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-e ">yhat *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-139"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-140"><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">coef</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e ">l_rate *</span><span class="crayon-h"> </span><span class="crayon-e ">error *</span><span class="crayon-h"> </span><span class="crayon-e ">yhat *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-141"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">coef</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-142"> </div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-143"><span class="crayon-p"># Make predictions with sub-models and construct a new stacked row</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-144"><span class="crayon-e">def </span><span class="crayon-e">to_stacked_row</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-145"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-146"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-147"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-148"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-149"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-150"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-151"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-152"><span class="crayon-p"># Stacked Generalization Algorithm</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-153"><span class="crayon-e">def </span><span class="crayon-e">stacking</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-154"><span class="crayon-h"> </span><span class="crayon-v">model_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">knn_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">perceptron_model</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-155"><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">knn_predict</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">perceptron_predict</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-156"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-157"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">model_list</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-158"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model_list</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-159"><span class="crayon-h"> </span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-160"><span class="crayon-h"> </span><span class="crayon-v">stacked_dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-161"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-162"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_stacked_row</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-163"><span class="crayon-h"> </span><span class="crayon-v">stacked_dataset</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">stacked_row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-164"><span class="crayon-h"> </span><span class="crayon-v">stacked_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">logistic_regression_model</span><span class="crayon-sy">(</span><span class="crayon-v">stacked_dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-165"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-166"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-167"><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_stacked_row</span><span class="crayon-sy">(</span><span class="crayon-v">models</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predict_list</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-168"><span class="crayon-h"> </span><span class="crayon-v">stacked_dataset</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">stacked_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-169"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">logistic_regression_predict</span><span class="crayon-sy">(</span><span class="crayon-v">stacked_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stacked_row</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-170"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-171"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">prediction</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-172"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-173"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-174"><span class="crayon-p"># Test stacking on the sonar dataset</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-175"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-176"><span class="crayon-p"># load and prepare data</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-177"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'sonar.all-data.csv'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-178"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_csv</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-179"><span class="crayon-p"># convert string attributes to integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-180"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-181"><span class="crayon-h"> </span><span class="crayon-e">str_column_to_float</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-182"><span class="crayon-p"># convert class column to integers</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-183"><span class="crayon-e">str_column_to_int</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-184"><span class="crayon-v">n_folds</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-185"><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_algorithm</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stacking</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_folds</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e84a200611237-186"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Scores: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65920c7e84a200611237-187"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Mean Accuracy: %.3f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0165 seconds] -->
<p>A k value of 3 was used for cross-validation, giving each fold 208/3 = 69.3 or just under 70 records to be evaluated upon each iteration.</p>
<p>I evaluated each submodel separately on the training dataset and achieved 74.879% for kNN and 72.464% for the Perceptron algorithm, both algorithms are better than the baseline accuracy of 53%.</p>
<p>Training logistic regression on the stacked dataset without the training rows for context achieves an accuracy of 75.845%. Including the training rows in the stacked dataset gives a further bump to 76.329%.</p>
<p>Running the example prints the scores and mean of the scores for the final configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65920c7e856895496176" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Scores: [78.26086956521739, 78.26086956521739, 72.46376811594203]
Mean Accuracy: 76.329%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65920c7e856895496176-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65920c7e856895496176-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65920c7e856895496176-1">Scores: [78.26086956521739, 78.26086956521739, 72.46376811594203]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65920c7e856895496176-2">Mean Accuracy: 76.329%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists extensions to this tutorial that you may be interested in exploring.</p>
<ul>
<li><strong>Tune Algorithms</strong>. The algorithms used for the submodels and the aggregate model in this tutorial were not tuned. Explore alternate configurations and see if you can further lift performance.</li>
<li><strong>Prediction Correlations</strong>. Stacking works better if the predictions of submodels are weakly correlated. Implement calculations to estimate the correlation between the predictions of submodels.</li>
<li><strong>Different Sub-models</strong>. Implement more and different sub-models to be combined using the stacking procedure.</li>
<li><strong>Different Aggregating Model</strong>. Experiment with simpler models (like averaging and voting) and more complex aggregation models to see if you can boost performance.</li>
<li><strong>More Datasets</strong>. Apply stacking to more datasets on the UCI Machine Learning Repository.</li>
</ul>
<p style="text-align: center;"><strong>Did you explore any of these extensions?</strong><br/>
Share your experiences in the comments below.</p>
<h2>Review</h2>
<p>In this tutorial, you discovered how to implement the stacking algorithm from scratch in Python.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to combine the predictions from multiple models.</li>
<li>How to apply stacking to a real-world predictive modeling problem.</li>
</ul>
<p style="text-align: center;"><strong>Do you have any questions?</strong><br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<p style="text-align: left;"><!-- Shortcoder conditions not met --></p>
<div class="awac-wrapper"><div class="awac widget text-37"> <div class="textwidget"><p></p><div class="woo-sc-hr"></div><br/>
<center>
<h2 style="text-align: center;">Want to Code Algorithms in Python Without Math?</h2>
<p><a href="/machine-learning-algorithms-from-scratch/"><img align="left" alt="Machine Learning Algorithms From Scratch" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningAlgorithmsFromScratch-220.png" style="border: 0;"/></a></p>
<h4>Code Your First Algorithm in Minutes</h4>
<p style="text-align: center;">…with step-by-step tutorials on real-world datasets</p>
<p style="text-align: center;">Discover how in my new Ebook:<br/>
<a href="https://machinelearningmastery.com/machine-learning-algorithms-from-scratch/">Machine Learning Algorithms From Scratch</a></p>
<p style="text-align: center;">It covers <strong>18 tutorials</strong> with all the code for <strong>12 top algorithms</strong>, like:<br/>Linear Regression, k-Nearest Neighbors, Stochastic Gradient Descent and much more…</p>
<h4>Finally, Pull Back the Curtain on <br/>Machine Learning Algorithms</h4>
<p style="text-align: center;">Skip the Academics. Just Results.</p>
<p style="text-align: center;"><a href="https://machinelearningmastery.com/machine-learning-algorithms-from-scratch/">Click to learn more</a>.</p>
<p></p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fimplementing-stacking-scratch-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/implementing-stacking-scratch-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/implementing-stacking-scratch-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https://machinelearningmastery.com/implementing-stacking-scratch-python/&amp;summary=Code+a+Stacking+Ensemble+From+Scratch+in+Python%2C+Step-by-Step.%0D%0AEnsemble+methods+are+an+excellent+wa..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Implement%20Stacked%20Generalization%20From%20Scratch%20With%20Python&amp;url=https://machinelearningmastery.com/implementing-stacking-scratch-python/&amp;summary=Code+a+Stacking+Ensemble+From+Scratch+in+Python%2C+Step-by-Step.%0D%0AEnsemble+methods+are+an+excellent+wa...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/implementing-stacking-scratch-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/implementing-stacking-scratch-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/implement-random-forest-scratch-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Implement Random Forest From Scratch in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/confusion-matrix-machine-learning/" rel="next">What is a Confusion Matrix in Machine Learning <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">22 Responses to <em>How to Implement Stacked Generalization From Scratch With Python</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-371071">
<div class="comment-container" id="li-comment-371071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c29d9a13369eb6c88cee57448fb639ad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c29d9a13369eb6c88cee57448fb639ad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">George Liu</span>
<span class="date">November 18, 2016 at 1:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-371071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Always great contents! Thanks Jason!</p>
<div class="reply">
<a aria-label="Reply to George Liu" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=371071#respond" onclick='return addComment.moveForm( "comment-371071", "371071", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-371187">
<div class="comment-container" id="li-comment-371187">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 19, 2016 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-371187" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks George.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=371187#respond" onclick='return addComment.moveForm( "comment-371187", "371187", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-376217">
<div class="comment-container" id="li-comment-376217">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffbc4d982f87466443f71b8a0c0f22b5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffbc4d982f87466443f71b8a0c0f22b5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kevin Tian</span>
<span class="date">December 20, 2016 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-376217" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for this really helpful tutorial! </p>
<p>I just have a question regarding how to create the stacked_row; in this tutorial it seems we train the sub-models on the train set and use their predictions on the same train set to build stacked_rows, on which the aggregator is trained and then directly used for the test set. </p>
<p>However I have seen some people doing this in a different way. They split the train set in parts, say A and B; train sub-models on A/B respectively and then use their predictions on B/A as input for the second layer aggregator. I just wonder which one is the proper approach and why? </p>
<p>Thank you !</p>
<div class="reply">
<a aria-label="Reply to Kevin Tian" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=376217#respond" onclick='return addComment.moveForm( "comment-376217", "376217", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-376280">
<div class="comment-container" id="li-comment-376280">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2016 at 7:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-376280" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Kevin,</p>
<p>There are many ways to build an ensemble. What you describe sounds like a form of the random subspace method.</p>
<p>Nevertheless, I would suggest you to try a suite of methods for a problem and see what works best. There is no “one best way”, and it is our job as practitioners to narrow down the options fast and zoom in on what works.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=376280#respond" onclick='return addComment.moveForm( "comment-376280", "376280", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-395436">
<div class="comment-container" id="li-comment-395436">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f974b94adf21719695f3981d38fada1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f974b94adf21719695f3981d38fada1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Reza</span>
<span class="date">April 5, 2017 at 6:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-395436" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your good post, as always it was great.<br/>
Could you propose me a solution for imbalanced dataset stacking?</p>
<div class="reply">
<a aria-label="Reply to Reza" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=395436#respond" onclick='return addComment.moveForm( "comment-395436", "395436", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395782">
<div class="comment-container" id="li-comment-395782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-395782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry I don’t understand, perhaps you can rephrase your question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=395782#respond" onclick='return addComment.moveForm( "comment-395782", "395782", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-404244">
<div class="comment-container" id="li-comment-404244">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0e752d626e8eb9e83737007bdd1a4337?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0e752d626e8eb9e83737007bdd1a4337?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tim</span>
<span class="date">June 29, 2017 at 4:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-404244" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason great work. Anw I see you have not use out-of-sample data to train the first level models to create the meta features for second level aggregator model. wouldn’t this cause a information leakage problem? Could you pls clarify on this thanks</p>
<div class="reply">
<a aria-label="Reply to Tim" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=404244#respond" onclick='return addComment.moveForm( "comment-404244", "404244", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404303">
<div class="comment-container" id="li-comment-404303">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 30, 2017 at 8:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-404303" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>As long as test data is left out. I expect your suggestion would lead to more robust results though.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=404303#respond" onclick='return addComment.moveForm( "comment-404303", "404303", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-411839">
<div class="comment-container" id="li-comment-411839">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/797a6e98d9e489c72171374fd40bf235?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/797a6e98d9e489c72171374fd40bf235?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nehasharma</span>
<span class="date">August 31, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-411839" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have a query for line number 168: stacked_dataset.append(stacked_row)<br/>
in test set.where have u used this?</p>
<div class="reply">
<a aria-label="Reply to nehasharma" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=411839#respond" onclick='return addComment.moveForm( "comment-411839", "411839", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-411860">
<div class="comment-container" id="li-comment-411860">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-411860" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The stacking() function is the “algorithm” that makes a prediction.</p>
<p>The stacked_dataset list contains the predictions from the sub models that is fed into logistic regression to make the final outcome prediction.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=411860#respond" onclick='return addComment.moveForm( "comment-411860", "411860", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414364">
<div class="comment-container" id="li-comment-414364">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">September 20, 2017 at 4:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-414364" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason. Beautiful work.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=414364#respond" onclick='return addComment.moveForm( "comment-414364", "414364", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414405">
<div class="comment-container" id="li-comment-414405">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-414405" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Alexander.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=414405#respond" onclick='return addComment.moveForm( "comment-414405", "414405", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417412">
<div class="comment-container" id="li-comment-417412">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 21, 2017 at 6:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417412" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, help me please.<br/>
This is question about pipeline.<br/>
Imagine, that we decide to use unsupervised learning algorithm at first for search of clusters. After that we develop Neural network. Maybe you know how can we configure network to emphasis that observation are from different clusters? (we don’t want to construct many networks, but want to configure one)</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417412#respond" onclick='return addComment.moveForm( "comment-417412", "417412", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417472">
<div class="comment-container" id="li-comment-417472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 22, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the goal of this approach?</p>
<p>If you want to split the data into clusters to develop specialized models, then you will need to develop separate models.</p>
<p>You could build one model and use the cluster id as another input feature.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417472#respond" onclick='return addComment.moveForm( "comment-417472", "417472", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417528">
<div class="comment-container" id="li-comment-417528">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 22, 2017 at 10:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417528" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason.</p>
<p>I want to find a way how can I transfer my knowledges about sample (in our example knowledges about clusters) to network.<br/>
It is possible to widen possible understanding of learning task?<br/>
Imagine the Network which has many inputs, we have features space at right hand and additional information which characterize these features at left hand. And we don’t want to use our knowledges about features like additional standard feature, but find new opportunities.</p>
<p>If the question is not clear, please don’t worry. I have many thoughts in my head, thoughts which are very interest for me. But, sometimes I can’t clear explain what I want to people around me.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417528#respond" onclick='return addComment.moveForm( "comment-417528", "417528", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417569">
<div class="comment-container" id="li-comment-417569">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417569" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help you define your problem Alexander:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417569#respond" onclick='return addComment.moveForm( "comment-417569", "417569", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417620">
<div class="comment-container" id="li-comment-417620">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 23, 2017 at 5:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417620" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417620#respond" onclick='return addComment.moveForm( "comment-417620", "417620", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417677">
<div class="comment-container" id="li-comment-417677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2017 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-417677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=417677#respond" onclick='return addComment.moveForm( "comment-417677", "417677", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426632">
<div class="comment-container" id="li-comment-426632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/119436e38c5b2786a1515f9b6a29af48?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/119436e38c5b2786a1515f9b6a29af48?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">January 16, 2018 at 2:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-426632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason, I have a question. When differentiating for instance, AdaBoostClassifier with Stacking could it be that AdaBoostClassifier uses only one model while Stacking used several machine learning algorithm to combine them to make a prediction. Also, AdaBoostClassifier uses hard voting which basically means that it takes the mode of each model (the prediction). The thing is I thought before AdaBoostClassifiers where able to hold different machine learning algorithms, but now I realize that AdaBoostClassifiers can only have one type of machine learning algorithms that dosent mean that you could have 5 DecisionTreeClassifiers in an AdaBoostClassifier algorithm which is controlled by the hyperparameter “n_estimators”. I just want to know the main difference between these two ensembles, its a bit confusing. Thanks for the help.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=426632#respond" onclick='return addComment.moveForm( "comment-426632", "426632", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426658">
<div class="comment-container" id="li-comment-426658">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-426658" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Internally adaboost uses many trees where subsequent trees correct predictions of prior trees.</p>
<p>Stacking just lets multiple different models votes on an outcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=426658#respond" onclick='return addComment.moveForm( "comment-426658", "426658", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426740">
<div class="comment-container" id="li-comment-426740">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/95a0db9cd97b379a71a4b5b2e4dc02e7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/95a0db9cd97b379a71a4b5b2e4dc02e7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nitin</span>
<span class="date">January 17, 2018 at 2:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-426740" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great post as always!!</p>
<p>I have a question if i have a data set where<br/>
train.shape,           test.shape<br/>
((1458, 301),         (1459, 301))</p>
<p>and i train 7 models with the train dataset and create a new dataset with these 7 models prediction (new_dataset.shape = (1458, 7))</p>
<p>I fit a new model with this new dataset and Y from  train.</p>
<p>Now, if i use this new model to predict for test, i am getting the error:<br/>
ValueError: feature_names mismatch, </p>
<p>its because the new_dataset has 7 columns and the test has 301 columns.</p>
<p>not sure, what i am doing wrong. Kindly suggest.</p>
<div class="reply">
<a aria-label="Reply to Nitin" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=426740#respond" onclick='return addComment.moveForm( "comment-426740", "426740", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426790">
<div class="comment-container" id="li-comment-426790">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2018 at 10:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/implementing-stacking-scratch-python/#comment-426790" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t follow.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/implementing-stacking-scratch-python/?replytocom=426790#respond" onclick='return addComment.moveForm( "comment-426790", "426790", "respond", "3367" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/implementing-stacking-scratch-python/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3367"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="a38c8365b7"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="128"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-19"> <div class="textwidget"><p></p><center>
<h3>Code Algorithms From Scratch in Python</h3>
<p>Discover how to code top machine learning algorithms from first principles with Python.</p>
<p><a href="https://machinelearningmastery.com/machine-learning-algorithms-from-scratch/">Code Machine Learning Algorithms From Scratch Today!</a></p>
<p><a href="https://machinelearningmastery.com/machine-learning-algorithms-from-scratch/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningAlgorithmsFromScratch-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>