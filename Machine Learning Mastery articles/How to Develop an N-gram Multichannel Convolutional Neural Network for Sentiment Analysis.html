<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis - Machine Learning Mastery" property="og:title"/>
<meta content="A standard deep learning model for text classification and sentiment analysis uses a word embedding layer and one-dimensional convolutional neural network. The model can be expanded by using multiple parallel convolutional neural networks that read the source document using different kernel sizes. This, in effect, creates a multichannel convolutional neural network for text that reads …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Natural Language Processing" property="article:section"/>
<meta content="2018-01-12T05:00:36+11:00" property="article:published_time"/>
<meta content="2018-01-14T06:39:52+11:00" property="article:modified_time"/>
<meta content="2018-01-14T06:39:52+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" property="og:image:secure_url"/>
<meta content="1579" property="og:image:width"/>
<meta content="959" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4586" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4586 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Need help with Deep Learning for Text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4586 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-01-12T05:00:36+1100">January 12, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Natural Language Processing">Natural Language Processing</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/&amp;summary=A+standard+deep+learning+model+for+text+classification+and+sentiment+analysis+uses+a+word+embedding+..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/&amp;summary=A+standard+deep+learning+model+for+text+classification+and+sentiment+analysis+uses+a+word+embedding+...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>A standard deep learning model for text classification and sentiment analysis uses a word embedding layer and one-dimensional convolutional neural network.</p>
<p>The model can be expanded by using multiple parallel convolutional neural networks that read the source document using different kernel sizes. This, in effect, creates a multichannel convolutional neural network for text that reads text with different n-gram sizes (groups of words).</p>
<p>In this tutorial, you will discover how to develop a multichannel convolutional neural network for sentiment prediction on text movie review data.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to prepare movie review text data for modeling.</li>
<li>How to develop a multichannel convolutional neural network for text in Keras.</li>
<li>How to evaluate a fit model on unseen movie review data.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4591" style="max-width: 650px"><img alt="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" class="size-full wp-image-4591" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-an-N-gram-Multichannel-Convolutional-Neural-Network-for-Sentiment-Analysis-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis<br/>Photo by <a href="https://www.flickr.com/photos/blachswan/32732882104/">Ed Dunens</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 4 parts; they are:</p>
<ol>
<li>Movie Review Dataset</li>
<li>Data Preparation</li>
<li>Develop Multichannel Model</li>
<li>Evaluate Model</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python 3 SciPy environment installed.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<!-- Start shortcoder --><p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Movie Review Dataset</h2>
<p>The Movie Review Data is a collection of movie reviews retrieved from the imdb.com website in the early 2000s by Bo Pang and Lillian Lee. The reviews were collected and made available as part of their research on natural language processing.</p>
<p>The reviews were originally released in 2002, but an updated and cleaned up version was released in 2004, referred to as “v2.0”.</p>
<p>The dataset is comprised of 1,000 positive and 1,000 negative movie reviews drawn from an archive of the rec.arts.movies.reviews newsgroup hosted at imdb.com. The authors refer to this dataset as the “polarity dataset.”</p>
<blockquote><p>Our data contains 1000 positive and 1000 negative reviews all written before 2002, with a cap of 20 reviews per author (312 authors total) per category. We refer to this corpus as the polarity dataset.</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>The data has been cleaned up somewhat; for example:</p>
<ul>
<li>The dataset is comprised of only English reviews.</li>
<li>All text has been converted to lowercase.</li>
<li>There is white space around punctuation like periods, commas, and brackets.</li>
<li>Text has been split into one sentence per line.</li>
</ul>
<p>The data has been used for a few related natural language processing tasks. For classification, the performance of machine learning models (such as Support Vector Machines) on the data is in the range of high 70% to low 80% (e.g. 78%-82%).</p>
<p>More sophisticated data preparation may see results as high as 86% with 10-fold cross-validation. This gives us a ballpark of low-to-mid 80s if we were looking to use this dataset in experiments of modern methods.</p>
<blockquote><p>… depending on choice of downstream polarity classifier, we can achieve highly statistically significant improvement (from 82.8% to 86.4%)</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>You can download the dataset from here:</p>
<ul>
<li><a href="https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (review_polarity.tar.gz, 3MB)</li>
</ul>
<p>After unzipping the file, you will have a directory called “<em>txt_sentoken</em>” with two sub-directories containing the text “<em>neg</em>” and “<em>pos</em>” for negative and positive reviews. Reviews are stored one per file with a naming convention <em>cv000</em> to <em>cv999</em> for each neg and pos.</p>
<p>Next, let’s look at loading and preparing the text data.</p>
<h2>Data Preparation</h2>
<p>In this section, we will look at 3 things:</p>
<ol>
<li>Separation of data into training and test sets.</li>
<li>Loading and cleaning the data to remove punctuation and numbers.</li>
<li>Prepare all reviews and save to file.</li>
</ol>
<h3>Split into Train and Test Sets</h3>
<p>We are pretending that we are developing a system that can predict the sentiment of a textual movie review as either positive or negative.</p>
<p>This means that after the model is developed, we will need to make predictions on new textual reviews. This will require all of the same data preparation to be performed on those new reviews as is performed on the training data for the model.</p>
<p>We will ensure that this constraint is built into the evaluation of our models by splitting the training and test datasets prior to any data preparation. This means that any knowledge in the data in the test set that could help us better prepare the data (e.g. the words used) is unavailable in the preparation of data used for training the model.</p>
<p>That being said, we will use the last 100 positive reviews and the last 100 negative reviews as a test set (100 reviews) and the remaining 1,800 reviews as the training dataset.</p>
<p>This is a 90% train, 10% split of the data.</p>
<p>The split can be imposed easily by using the filenames of the reviews where reviews named 000 to 899 are for training data and reviews named 900 onwards are for test.</p>
<h3>Loading and Cleaning Reviews</h3>
<p>The text data is already pretty clean; not much preparation is required.</p>
<p>Without getting bogged down too much by the details, we will prepare the data in the following way:</p>
<ul>
<li>Split tokens on white space.</li>
<li>Remove all punctuation from words.</li>
<li>Remove all words that are not purely comprised of alphabetical characters.</li>
<li>Remove all words that are known stop words.</li>
<li>Remove all words that have a length &lt;= 1 character.</li>
</ul>
<p>We can put all of these steps into a function called <em>clean_doc()</em> that takes as an argument the raw text loaded from a file and returns a list of cleaned tokens. We can also define a function <em>load_doc()</em> that loads a document from file ready for use with the <em>clean_doc()</em> function. An example of cleaning the first positive review is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167726568141064" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from nltk.corpus import stopwords
import string

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', string.punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load the document
filename = 'txt_sentoken/pos/cv000_29590.txt'
text = load_doc(filename)
tokens = clean_doc(text)
print(tokens)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167726568141064-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-12">12</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-14">14</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-16">16</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-18">18</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-20">20</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-22">22</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-24">24</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-26">26</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-28">28</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-30">30</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-32">32</div><div class="crayon-num" data-line="crayon-5a658f6167726568141064-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167726568141064-34">34</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167726568141064-1"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-2"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-4"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-5"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-6"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-7"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-8"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-9"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-10"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-11"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-14"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-15"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-16"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-17"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-19"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-20"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-21"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-23"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-24"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-25"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-26"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-30"><span class="crayon-p"># load the document</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-31"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'txt_sentoken/pos/cv000_29590.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-32"><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167726568141064-33"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167726568141064-34"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0027 seconds] -->
<p>Running the example loads and cleans one movie review.</p>
<p>The tokens from the clean review are printed for review.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167731353567942" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167731353567942-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167731353567942-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167731353567942-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167731353567942-2">'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Clean All Reviews and Save</h3>
<p>We can now use the function to clean reviews and apply it to all reviews.</p>
<p>To do this, we will develop a new function named <em>process_docs()</em> below that will walk through all reviews in a directory, clean them, and return them as a list.</p>
<p>We will also add an argument to the function to indicate whether the function is processing train or test reviews, that way the filenames can be filtered (as described above) and only those train or test reviews requested will be cleaned and returned.</p>
<p>The full function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167734589973956" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc)
		# add to list
		documents.append(tokens)
	return documents</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167734589973956-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-12">12</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-14">14</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-16">16</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167734589973956-18">18</div><div class="crayon-num" data-line="crayon-5a658f6167734589973956-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167734589973956-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-3"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-13"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-15"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-16"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-17"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167734589973956-18"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167734589973956-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>We can call this function with negative training reviews as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167737540204101" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
negative_docs = process_docs('txt_sentoken/neg', True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167737540204101-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167737540204101-1"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we need labels for the train and test documents. We know that we have 900 training documents and 100 test documents. We can use a Python list comprehension to create the labels for the negative (0) and positive (1) reviews for both train and test sets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616773a700836069" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
trainy = [0 for _ in range(900)] + [1 for _ in range(900)]
testY = [0 for _ in range(100)] + [1 for _ in range(100)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616773a700836069-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773a700836069-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616773a700836069-1"><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773a700836069-2"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Finally, we want to save the prepared train and test sets to file so that we can load them later for modeling and model evaluation.</p>
<p>The function below-named <em>save_dataset()</em> will save a given prepared dataset (X and y elements) to a file using the pickle API.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616773c075132305" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# save a dataset to file
def save_dataset(dataset, filename):
	dump(dataset, open(filename, 'wb'))
	print('Saved: %s' % filename)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616773c075132305-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773c075132305-2">2</div><div class="crayon-num" data-line="crayon-5a658f616773c075132305-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773c075132305-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616773c075132305-1"><span class="crayon-p"># save a dataset to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773c075132305-2"><span class="crayon-e">def </span><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f616773c075132305-3"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773c075132305-4"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can tie all of these data preparation steps together.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616773f649374065" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from nltk.corpus import stopwords
from pickle import dump

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc)
		# add to list
		documents.append(tokens)
	return documents

# save a dataset to file
def save_dataset(dataset, filename):
	dump(dataset, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load all training reviews
negative_docs = process_docs('txt_sentoken/neg', True)
positive_docs = process_docs('txt_sentoken/pos', True)
trainX = negative_docs + positive_docs
trainy = [0 for _ in range(900)] + [1 for _ in range(900)]
save_dataset([trainX,trainy], 'train.pkl')

# load all test reviews
negative_docs = process_docs('txt_sentoken/neg', False)
positive_docs = process_docs('txt_sentoken/pos', False)
testX = negative_docs + positive_docs
testY = [0 for _ in range(100)] + [1 for _ in range(100)]
save_dataset([testX,testY], 'test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616773f649374065-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-2">2</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-4">4</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-6">6</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-8">8</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-10">10</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-12">12</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-14">14</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-16">16</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-18">18</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-20">20</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-22">22</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-24">24</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-26">26</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-28">28</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-30">30</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-32">32</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-34">34</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-36">36</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-38">38</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-40">40</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-42">42</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-44">44</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-46">46</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-48">48</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-50">50</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-52">52</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-54">54</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-56">56</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-58">58</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-60">60</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-62">62</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-64">64</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-66">66</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-68">68</div><div class="crayon-num" data-line="crayon-5a658f616773f649374065-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616773f649374065-70">70</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616773f649374065-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-3"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-4"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-v">dump</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-6"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-7"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-8"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-9"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-10"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-11"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-12"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-13"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-16"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-17"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-18"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-19"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-20"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-21"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-23"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-26"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-28"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-30"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-31"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-32"> </div><div class="crayon-line" id="crayon-5a658f616773f649374065-33"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-34"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-35"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-36"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-37"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-38"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-39"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-40"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-41"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-42"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-43"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-44"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-45"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-46"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-47"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-48"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-49"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-50"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-52"> </div><div class="crayon-line" id="crayon-5a658f616773f649374065-53"><span class="crayon-p"># save a dataset to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-54"><span class="crayon-e">def </span><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-55"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-56"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-57"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-58"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-59"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-60"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-61"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-62"><span class="crayon-v">trainy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-63"><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainy</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-64"> </div><div class="crayon-line" id="crayon-5a658f616773f649374065-65"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-66"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-67"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-68"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5a658f616773f649374065-69"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616773f649374065-70"><span class="crayon-e">save_dataset</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testY</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0052 seconds] -->
<p>Running the example cleans the text movie review documents, creates labels, and saves the prepared data for both train and test datasets in <em>train.pkl</em> and <em>test.pkl</em> respectively.</p>
<p>Now we are ready to develop our model.</p>
<h2>Develop Multichannel Model</h2>
<p>In this section, we will develop a multichannel convolutional neural network for the sentiment analysis prediction problem.</p>
<p>This section is divided into 3 parts:</p>
<ol>
<li>Encode Data</li>
<li>Define Model.</li>
<li>Complete Example.</li>
</ol>
<h3>Encode Data</h3>
<p>The first step is to load the cleaned training dataset.</p>
<p>The function below-named <em>load_dataset()</em> can be called to load the pickled training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167743358905985" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

trainLines, trainLabels = load_dataset('train.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167743358905985-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167743358905985-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167743358905985-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167743358905985-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167743358905985-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167743358905985-1"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167743358905985-2"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167743358905985-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167743358905985-4"> </div><div class="crayon-line" id="crayon-5a658f6167743358905985-5"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we must fit a Keras Tokenizer on the training dataset. We will use this tokenizer to both define the vocabulary for the Embedding layer and encode the review documents as integers.</p>
<p>The function <em>create_tokenizer()</em> below will create a Tokenizer given a list of documents.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167745294326081" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167745294326081-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167745294326081-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167745294326081-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167745294326081-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167745294326081-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167745294326081-1"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167745294326081-2"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167745294326081-3"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167745294326081-4"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167745294326081-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We also need to know the maximum length of input sequences as input for the model and to pad all sequences to the fixed length.</p>
<p>The function <em>max_length()</em> below will calculate the maximum length (number of words) for all reviews in the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616774b316572610" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616774b316572610-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616774b316572610-2">2</div><div class="crayon-num" data-line="crayon-5a658f616774b316572610-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616774b316572610-1"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616774b316572610-2"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f616774b316572610-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We also need to know the size of the vocabulary for the Embedding layer.</p>
<p>This can be calculated from the prepared Tokenizer, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616774d175705750" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616774d175705750-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616774d175705750-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616774d175705750-1"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616774d175705750-2"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Finally, we can integer encode and pad the clean movie review text.</p>
<p>The function below named <em>encode_text()</em> will both encode and pad text data to the maximum review length.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167750728167890" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167750728167890-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167750728167890-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167750728167890-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167750728167890-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167750728167890-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167750728167890-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167750728167890-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167750728167890-1"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167750728167890-2"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167750728167890-3"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167750728167890-4"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167750728167890-5"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167750728167890-6"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167750728167890-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3>Define Model</h3>
<p>A standard model for document classification is to use an Embedding layer as input, followed by a one-dimensional convolutional neural network, pooling layer, and then a prediction output layer.</p>
<p>The kernel size in the convolutional layer defines the number of words to consider as the convolution is passed across the input text document, providing a grouping parameter.</p>
<p>A multi-channel convolutional neural network for document classification involves using multiple versions of the standard model with different sized kernels. This allows the document to be processed at different resolutions or different n-grams (groups of words) at a time, whilst the model learns how to best integrate these interpretations.</p>
<p>This approach was first described by Yoon Kim in his 2014 paper titled “<a href="https://arxiv.org/abs/1408.5882">Convolutional Neural Networks for Sentence Classification</a>.”</p>
<p>In the paper, Kim experimented with static and dynamic (updated) embedding layers, we can simplify the approach and instead focus only on the use of different kernel sizes.</p>
<p>This approach is best understood with a diagram taken from Kim’s paper:</p>
<div class="wp-caption aligncenter" id="attachment_4587" style="max-width: 1692px"><img alt="Depiction of the multiple-channel convolutional neural network for text" class="size-full wp-image-4587" height="672" sizes="(max-width: 1682px) 100vw, 1682px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text.png 1682w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-300x120.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-768x307.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Depiction-of-the-multiple-channel-convolutional-neural-network-for-text-1024x409.png 1024w" width="1682"/><p class="wp-caption-text">Depiction of the multiple-channel convolutional neural network for text.<br/>Taken from “Convolutional Neural Networks for Sentence Classification.”</p></div>
<p>In Keras, a multiple-input model can be defined using the <a href="https://keras.io/getting-started/functional-api-guide/">functional API</a>.</p>
<p>We will define a model with three input channels for processing 4-grams, 6-grams, and 8-grams of movie review text.</p>
<p>Each channel is comprised of the following elements:</p>
<ul>
<li>Input layer that defines the length of input sequences.</li>
<li>Embedding layer set to the size of the vocabulary and 100-dimensional real-valued representations.</li>
<li>One-dimensional convolutional layer with 32 filters and a kernel size set to the number of words to read at once.</li>
<li>Max Pooling layer to consolidate the output from the convolutional layer.</li>
<li>Flatten layer to reduce the three-dimensional output to two dimensional for concatenation.</li>
</ul>
<p>The output from the three channels are concatenated into a single vector and process by a Dense layer and an output layer.</p>
<p>The function below defines and returns the model. As part of defining the model, a summary of the defined model is printed and a plot of the model graph is created and saved to file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167754584551261" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define the model
def define_model(length, vocab_size):
	# channel 1
	inputs1 = Input(shape=(length,))
	embedding1 = Embedding(vocab_size, 100)(inputs1)
	conv1 = Conv1D(filters=32, kernel_size=4, activation='relu')(embedding1)
	drop1 = Dropout(0.5)(conv1)
	pool1 = MaxPooling1D(pool_size=2)(drop1)
	flat1 = Flatten()(pool1)
	# channel 2
	inputs2 = Input(shape=(length,))
	embedding2 = Embedding(vocab_size, 100)(inputs2)
	conv2 = Conv1D(filters=32, kernel_size=6, activation='relu')(embedding2)
	drop2 = Dropout(0.5)(conv2)
	pool2 = MaxPooling1D(pool_size=2)(drop2)
	flat2 = Flatten()(pool2)
	# channel 3
	inputs3 = Input(shape=(length,))
	embedding3 = Embedding(vocab_size, 100)(inputs3)
	conv3 = Conv1D(filters=32, kernel_size=8, activation='relu')(embedding3)
	drop3 = Dropout(0.5)(conv3)
	pool3 = MaxPooling1D(pool_size=2)(drop3)
	flat3 = Flatten()(pool3)
	# merge
	merged = concatenate([flat1, flat2, flat3])
	# interpretation
	dense1 = Dense(10, activation='relu')(merged)
	outputs = Dense(1, activation='sigmoid')(dense1)
	model = Model(inputs=[inputs1, inputs2, inputs3], outputs=outputs)
	# compile
	model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
	# summarize
	print(model.summary())
	plot_model(model, show_shapes=True, to_file='multichannel.png')
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167754584551261-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-12">12</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-14">14</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-16">16</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-18">18</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-20">20</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-22">22</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-24">24</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-26">26</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-28">28</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-30">30</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-32">32</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167754584551261-34">34</div><div class="crayon-num" data-line="crayon-5a658f6167754584551261-35">35</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167754584551261-1"><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-2"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-3"><span class="crayon-h"> </span><span class="crayon-p"># channel 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-4"><span class="crayon-h"> </span><span class="crayon-v">inputs1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-5"><span class="crayon-h"> </span><span class="crayon-v">embedding1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-6"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-7"><span class="crayon-h"> </span><span class="crayon-v">drop1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-8"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-9"><span class="crayon-h"> </span><span class="crayon-v">flat1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-10"><span class="crayon-h"> </span><span class="crayon-p"># channel 2</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-11"><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-12"><span class="crayon-h"> </span><span class="crayon-v">embedding2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-13"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-14"><span class="crayon-h"> </span><span class="crayon-v">drop2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-15"><span class="crayon-h"> </span><span class="crayon-v">pool2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-16"><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-17"><span class="crayon-h"> </span><span class="crayon-p"># channel 3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-18"><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-19"><span class="crayon-h"> </span><span class="crayon-v">embedding3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-20"><span class="crayon-h"> </span><span class="crayon-v">conv3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-21"><span class="crayon-h"> </span><span class="crayon-v">drop3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-22"><span class="crayon-h"> </span><span class="crayon-v">pool3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-23"><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-24"><span class="crayon-h"> </span><span class="crayon-p"># merge</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-25"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">flat1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-26"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-27"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-28"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-29"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">inputs1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-30"><span class="crayon-h"> </span><span class="crayon-p"># compile</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-31"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-32"><span class="crayon-h"> </span><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-33"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167754584551261-34"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multichannel.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167754584551261-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0039 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>Pulling all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167757123601960" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.utils.vis_utils import plot_model
from keras.models import Model
from keras.layers import Input
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Dropout
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D
from keras.layers.merge import concatenate

# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])

# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded

# define the model
def define_model(length, vocab_size):
	# channel 1
	inputs1 = Input(shape=(length,))
	embedding1 = Embedding(vocab_size, 100)(inputs1)
	conv1 = Conv1D(filters=32, kernel_size=4, activation='relu')(embedding1)
	drop1 = Dropout(0.5)(conv1)
	pool1 = MaxPooling1D(pool_size=2)(drop1)
	flat1 = Flatten()(pool1)
	# channel 2
	inputs2 = Input(shape=(length,))
	embedding2 = Embedding(vocab_size, 100)(inputs2)
	conv2 = Conv1D(filters=32, kernel_size=6, activation='relu')(embedding2)
	drop2 = Dropout(0.5)(conv2)
	pool2 = MaxPooling1D(pool_size=2)(drop2)
	flat2 = Flatten()(pool2)
	# channel 3
	inputs3 = Input(shape=(length,))
	embedding3 = Embedding(vocab_size, 100)(inputs3)
	conv3 = Conv1D(filters=32, kernel_size=8, activation='relu')(embedding3)
	drop3 = Dropout(0.5)(conv3)
	pool3 = MaxPooling1D(pool_size=2)(drop3)
	flat3 = Flatten()(pool3)
	# merge
	merged = concatenate([flat1, flat2, flat3])
	# interpretation
	dense1 = Dense(10, activation='relu')(merged)
	outputs = Dense(1, activation='sigmoid')(dense1)
	model = Model(inputs=[inputs1, inputs2, inputs3], outputs=outputs)
	# compile
	model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
	# summarize
	print(model.summary())
	plot_model(model, show_shapes=True, to_file='multichannel.png')
	return model

# load training dataset
trainLines, trainLabels = load_dataset('train.pkl')
# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
print(trainX.shape)

# define model
model = define_model(length, vocab_size)
# fit model
model.fit([trainX,trainX,trainX], trainLabels, epochs=10, batch_size=16)
# save the model
model.save('model.h5')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167757123601960-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-12">12</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-14">14</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-16">16</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-18">18</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-20">20</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-22">22</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-24">24</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-26">26</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-28">28</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-30">30</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-32">32</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-34">34</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-36">36</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-38">38</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-40">40</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-42">42</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-44">44</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-46">46</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-48">48</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-50">50</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-52">52</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-54">54</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-56">56</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-58">58</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-60">60</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-62">62</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-64">64</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-66">66</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-68">68</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-70">70</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-72">72</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-74">74</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-76">76</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-78">78</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-80">80</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-82">82</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-84">84</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-86">86</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-88">88</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-90">90</div><div class="crayon-num" data-line="crayon-5a658f6167757123601960-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167757123601960-92">92</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167757123601960-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-e">plot_model</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dropout</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">MaxPooling1D</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">merge </span><span class="crayon-e">import </span><span class="crayon-v">concatenate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-14"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-15"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-16"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-18"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-19"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-20"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-21"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-22"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-24"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-25"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-26"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-28"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-29"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-30"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-31"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-32"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-33"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-34"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-36"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-37"><span class="crayon-p"># define the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-38"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-39"><span class="crayon-h"> </span><span class="crayon-p"># channel 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-40"><span class="crayon-h"> </span><span class="crayon-v">inputs1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-41"><span class="crayon-h"> </span><span class="crayon-v">embedding1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-42"><span class="crayon-h"> </span><span class="crayon-v">conv1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-43"><span class="crayon-h"> </span><span class="crayon-v">drop1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-44"><span class="crayon-h"> </span><span class="crayon-v">pool1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-45"><span class="crayon-h"> </span><span class="crayon-v">flat1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-46"><span class="crayon-h"> </span><span class="crayon-p"># channel 2</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-47"><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-48"><span class="crayon-h"> </span><span class="crayon-v">embedding2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-49"><span class="crayon-h"> </span><span class="crayon-v">conv2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-50"><span class="crayon-h"> </span><span class="crayon-v">drop2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-51"><span class="crayon-h"> </span><span class="crayon-v">pool2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-52"><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-53"><span class="crayon-h"> </span><span class="crayon-p"># channel 3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-54"><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-55"><span class="crayon-h"> </span><span class="crayon-v">embedding3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">inputs3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-56"><span class="crayon-h"> </span><span class="crayon-v">conv3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">embedding3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-57"><span class="crayon-h"> </span><span class="crayon-v">drop3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dropout</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">conv3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-58"><span class="crayon-h"> </span><span class="crayon-v">pool3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">drop3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-59"><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">pool3</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-60"><span class="crayon-h"> </span><span class="crayon-p"># merge</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-61"><span class="crayon-h"> </span><span class="crayon-v">merged</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">flat1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">flat3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-62"><span class="crayon-h"> </span><span class="crayon-p"># interpretation</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-63"><span class="crayon-h"> </span><span class="crayon-v">dense1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">merged</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-64"><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">(</span><span class="crayon-v">dense1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-65"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">inputs1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inputs3</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-o">=</span><span class="crayon-v">outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-66"><span class="crayon-h"> </span><span class="crayon-p"># compile</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-68"><span class="crayon-h"> </span><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-69"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-70"><span class="crayon-h"> </span><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'multichannel.png'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-71"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-72"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-73"><span class="crayon-p"># load training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-74"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-75"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-76"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-77"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-78"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-79"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-80"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-81"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-82"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-83"><span class="crayon-p"># encode data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-84"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-85"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-86"> </div><div class="crayon-line" id="crayon-5a658f6167757123601960-87"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-88"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-89"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-90"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">16</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167757123601960-91"><span class="crayon-p"># save the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167757123601960-92"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">save</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0075 seconds] -->
<p>Running the example first prints a summary of the prepared training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616775c601210446" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Max document length: 1380
Vocabulary size: 44277
(1800, 1380)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616775c601210446-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775c601210446-2">2</div><div class="crayon-num" data-line="crayon-5a658f616775c601210446-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616775c601210446-1">Max document length: 1380</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775c601210446-2">Vocabulary size: 44277</div><div class="crayon-line" id="crayon-5a658f616775c601210446-3">(1800, 1380)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, a summary of the defined model is printed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616775f758699929" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
____________________________________________________________________________________________________
Layer (type)                     Output Shape          Param #     Connected to
====================================================================================================
input_1 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
input_2 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
input_3 (InputLayer)             (None, 1380)          0
____________________________________________________________________________________________________
embedding_1 (Embedding)          (None, 1380, 100)     4427700     input_1[0][0]
____________________________________________________________________________________________________
embedding_2 (Embedding)          (None, 1380, 100)     4427700     input_2[0][0]
____________________________________________________________________________________________________
embedding_3 (Embedding)          (None, 1380, 100)     4427700     input_3[0][0]
____________________________________________________________________________________________________
conv1d_1 (Conv1D)                (None, 1377, 32)      12832       embedding_1[0][0]
____________________________________________________________________________________________________
conv1d_2 (Conv1D)                (None, 1375, 32)      19232       embedding_2[0][0]
____________________________________________________________________________________________________
conv1d_3 (Conv1D)                (None, 1373, 32)      25632       embedding_3[0][0]
____________________________________________________________________________________________________
dropout_1 (Dropout)              (None, 1377, 32)      0           conv1d_1[0][0]
____________________________________________________________________________________________________
dropout_2 (Dropout)              (None, 1375, 32)      0           conv1d_2[0][0]
____________________________________________________________________________________________________
dropout_3 (Dropout)              (None, 1373, 32)      0           conv1d_3[0][0]
____________________________________________________________________________________________________
max_pooling1d_1 (MaxPooling1D)   (None, 688, 32)       0           dropout_1[0][0]
____________________________________________________________________________________________________
max_pooling1d_2 (MaxPooling1D)   (None, 687, 32)       0           dropout_2[0][0]
____________________________________________________________________________________________________
max_pooling1d_3 (MaxPooling1D)   (None, 686, 32)       0           dropout_3[0][0]
____________________________________________________________________________________________________
flatten_1 (Flatten)              (None, 22016)         0           max_pooling1d_1[0][0]
____________________________________________________________________________________________________
flatten_2 (Flatten)              (None, 21984)         0           max_pooling1d_2[0][0]
____________________________________________________________________________________________________
flatten_3 (Flatten)              (None, 21952)         0           max_pooling1d_3[0][0]
____________________________________________________________________________________________________
concatenate_1 (Concatenate)      (None, 65952)         0           flatten_1[0][0]
                                                                   flatten_2[0][0]
                                                                   flatten_3[0][0]
____________________________________________________________________________________________________
dense_1 (Dense)                  (None, 10)            659530      concatenate_1[0][0]
____________________________________________________________________________________________________
dense_2 (Dense)                  (None, 1)             11          dense_1[0][0]
====================================================================================================
Total params: 14,000,337
Trainable params: 14,000,337
Non-trainable params: 0
____________________________________________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616775f758699929-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-2">2</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-4">4</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-6">6</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-8">8</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-10">10</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-12">12</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-14">14</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-16">16</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-18">18</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-20">20</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-22">22</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-24">24</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-26">26</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-28">28</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-30">30</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-32">32</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-34">34</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-36">36</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-38">38</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-40">40</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-42">42</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-44">44</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-46">46</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-48">48</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616775f758699929-50">50</div><div class="crayon-num" data-line="crayon-5a658f616775f758699929-51">51</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616775f758699929-1">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-2">Layer (type)                     Output Shape          Param #     Connected to</div><div class="crayon-line" id="crayon-5a658f616775f758699929-3">====================================================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-4">input_1 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5a658f616775f758699929-5">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-6">input_2 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5a658f616775f758699929-7">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-8">input_3 (InputLayer)             (None, 1380)          0</div><div class="crayon-line" id="crayon-5a658f616775f758699929-9">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-10">embedding_1 (Embedding)          (None, 1380, 100)     4427700     input_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-11">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-12">embedding_2 (Embedding)          (None, 1380, 100)     4427700     input_2[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-13">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-14">embedding_3 (Embedding)          (None, 1380, 100)     4427700     input_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-15">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-16">conv1d_1 (Conv1D)                (None, 1377, 32)      12832       embedding_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-17">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-18">conv1d_2 (Conv1D)                (None, 1375, 32)      19232       embedding_2[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-19">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-20">conv1d_3 (Conv1D)                (None, 1373, 32)      25632       embedding_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-21">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-22">dropout_1 (Dropout)              (None, 1377, 32)      0           conv1d_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-23">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-24">dropout_2 (Dropout)              (None, 1375, 32)      0           conv1d_2[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-25">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-26">dropout_3 (Dropout)              (None, 1373, 32)      0           conv1d_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-27">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-28">max_pooling1d_1 (MaxPooling1D)   (None, 688, 32)       0           dropout_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-29">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-30">max_pooling1d_2 (MaxPooling1D)   (None, 687, 32)       0           dropout_2[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-31">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-32">max_pooling1d_3 (MaxPooling1D)   (None, 686, 32)       0           dropout_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-33">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-34">flatten_1 (Flatten)              (None, 22016)         0           max_pooling1d_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-35">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-36">flatten_2 (Flatten)              (None, 21984)         0           max_pooling1d_2[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-37">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-38">flatten_3 (Flatten)              (None, 21952)         0           max_pooling1d_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-39">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-40">concatenate_1 (Concatenate)      (None, 65952)         0           flatten_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-41">                                                                   flatten_2[0][0]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-42">                                                                   flatten_3[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-43">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-44">dense_1 (Dense)                  (None, 10)            659530      concatenate_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-45">____________________________________________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-46">dense_2 (Dense)                  (None, 1)             11          dense_1[0][0]</div><div class="crayon-line" id="crayon-5a658f616775f758699929-47">====================================================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-48">Total params: 14,000,337</div><div class="crayon-line" id="crayon-5a658f616775f758699929-49">Trainable params: 14,000,337</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616775f758699929-50">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5a658f616775f758699929-51">____________________________________________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The model is fit relatively quickly and appears to show good skill on the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167764706477950" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
1800/1800 [==============================] - 30s - loss: 9.9093e-04 - acc: 1.0000
Epoch 7/10
1800/1800 [==============================] - 29s - loss: 5.1899e-04 - acc: 1.0000
Epoch 8/10
1800/1800 [==============================] - 28s - loss: 3.7958e-04 - acc: 1.0000
Epoch 9/10
1800/1800 [==============================] - 29s - loss: 3.0534e-04 - acc: 1.0000
Epoch 10/10
1800/1800 [==============================] - 29s - loss: 2.6234e-04 - acc: 1.0000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167764706477950-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167764706477950-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167764706477950-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167764706477950-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167764706477950-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167764706477950-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167764706477950-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167764706477950-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167764706477950-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167764706477950-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167764706477950-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167764706477950-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167764706477950-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5a658f6167764706477950-3">1800/1800 [==============================] - 30s - loss: 9.9093e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167764706477950-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5a658f6167764706477950-5">1800/1800 [==============================] - 29s - loss: 5.1899e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167764706477950-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5a658f6167764706477950-7">1800/1800 [==============================] - 28s - loss: 3.7958e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167764706477950-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5a658f6167764706477950-9">1800/1800 [==============================] - 29s - loss: 3.0534e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167764706477950-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5a658f6167764706477950-11">1800/1800 [==============================] - 29s - loss: 2.6234e-04 - acc: 1.0000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A plot of the defined model is saved to file, clearly showing the three input channels for the model.</p>
<div class="wp-caption aligncenter" id="attachment_4588" style="max-width: 1589px"><img alt="Plot of the Multichannel Convolutional Neural Network For Text" class="size-full wp-image-4588" height="959" sizes="(max-width: 1579px) 100vw, 1579px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text.png 1579w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-300x182.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-768x466.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Text-1024x622.png 1024w" width="1579"/><p class="wp-caption-text">Plot of the Multichannel Convolutional Neural Network For Text</p></div>
<p>The model is fit for a number of epochs and saved to the file <em>model.h5</em> for later evaluation.</p>
<h2>Evaluate Model</h2>
<p>In this section, we can evaluate the fit model by predicting the sentiment on all reviews in the unseen test dataset.</p>
<p>Using the data loading functions developed in the previous section, we can load and encode both the training and test datasets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f6167768008926284" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load datasets
trainLines, trainLabels = load_dataset('train.pkl')
testLines, testLabels = load_dataset('test.pkl')

# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
testX = encode_text(tokenizer, testLines, length)
print(trainX.shape, testX.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f6167768008926284-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-2">2</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-4">4</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-6">6</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-8">8</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-10">10</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-12">12</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-14">14</div><div class="crayon-num" data-line="crayon-5a658f6167768008926284-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f6167768008926284-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f6167768008926284-1"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-2"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-3"><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-4"> </div><div class="crayon-line" id="crayon-5a658f6167768008926284-5"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-6"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-7"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-8"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-9"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-10"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-12"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-13"><span class="crayon-p"># encode data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-14"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f6167768008926284-15"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f6167768008926284-16"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We can load the saved model and evaluate it on both the training and test datasets.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616776b706568897" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import load_model

# load a clean dataset
def load_dataset(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# calculate the maximum document length
def max_length(lines):
	return max([len(s.split()) for s in lines])

# encode a list of lines
def encode_text(tokenizer, lines, length):
	# integer encode
	encoded = tokenizer.texts_to_sequences(lines)
	# pad encoded sequences
	padded = pad_sequences(encoded, maxlen=length, padding='post')
	return padded

# load datasets
trainLines, trainLabels = load_dataset('train.pkl')
testLines, testLabels = load_dataset('test.pkl')

# create tokenizer
tokenizer = create_tokenizer(trainLines)
# calculate max document length
length = max_length(trainLines)
# calculate vocabulary size
vocab_size = len(tokenizer.word_index) + 1
print('Max document length: %d' % length)
print('Vocabulary size: %d' % vocab_size)
# encode data
trainX = encode_text(tokenizer, trainLines, length)
testX = encode_text(tokenizer, testLines, length)
print(trainX.shape, testX.shape)

# load the model
model = load_model('model.h5')

# evaluate model on training dataset
loss, acc = model.evaluate([trainX,trainX,trainX], trainLabels, verbose=0)
print('Train Accuracy: %f' % (acc*100))

# evaluate model on test dataset dataset
loss, acc = model.evaluate([testX,testX,testX], testLabels, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616776b706568897-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-2">2</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-4">4</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-6">6</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-8">8</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-10">10</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-12">12</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-14">14</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-16">16</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-18">18</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-20">20</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-22">22</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-24">24</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-26">26</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-28">28</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-30">30</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-32">32</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-34">34</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-36">36</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-38">38</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-40">40</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-42">42</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-44">44</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-46">46</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-48">48</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-50">50</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-52">52</div><div class="crayon-num" data-line="crayon-5a658f616776b706568897-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776b706568897-54">54</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616776b706568897-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-v">load_model</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-6"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-7"><span class="crayon-e">def </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-10"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-11"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-12"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-13"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-16"><span class="crayon-p"># calculate the maximum document length</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-17"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-19"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-20"><span class="crayon-p"># encode a list of lines</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-21"><span class="crayon-e">def </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-22"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-23"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-24"><span class="crayon-h"> </span><span class="crayon-p"># pad encoded sequences</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-25"><span class="crayon-h"> </span><span class="crayon-v">padded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">padded</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-28"><span class="crayon-p"># load datasets</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-29"><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-30"><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLabels</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_dataset</span><span class="crayon-sy">(</span><span class="crayon-s">'test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-32"><span class="crayon-p"># create tokenizer</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-33"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-34"><span class="crayon-p"># calculate max document length</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-35"><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">trainLines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-36"><span class="crayon-p"># calculate vocabulary size</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-37"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Max document length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-39"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-40"><span class="crayon-p"># encode data</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-41"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-42"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_text</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-43"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-44"> </div><div class="crayon-line" id="crayon-5a658f616776b706568897-45"><span class="crayon-p"># load the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-46"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-47"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-48"><span class="crayon-p"># evaluate model on training dataset</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-49"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-v">trainX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainLabels</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-50"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-51"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-52"><span class="crayon-p"># evaluate model on test dataset dataset</span></div><div class="crayon-line" id="crayon-5a658f616776b706568897-53"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-v">testX</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testLabels</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776b706568897-54"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0052 seconds] -->
<p>Running the example prints the skill of the model on both the training and test datasets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658f616776e045942954" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Max document length: 1380
Vocabulary size: 44277
(1800, 1380) (200, 1380)

Train Accuracy: 100.000000
Test Accuracy: 87.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658f616776e045942954-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776e045942954-2">2</div><div class="crayon-num" data-line="crayon-5a658f616776e045942954-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776e045942954-4">4</div><div class="crayon-num" data-line="crayon-5a658f616776e045942954-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658f616776e045942954-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658f616776e045942954-1">Max document length: 1380</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776e045942954-2">Vocabulary size: 44277</div><div class="crayon-line" id="crayon-5a658f616776e045942954-3">(1800, 1380) (200, 1380)</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776e045942954-4"> </div><div class="crayon-line" id="crayon-5a658f616776e045942954-5">Train Accuracy: 100.000000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658f616776e045942954-6">Test Accuracy: 87.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see that, as expected, the skill on the training dataset is excellent, here at 100% accuracy.</p>
<p>We can also see that the skill of the model on the unseen test dataset is also very impressive, achieving 87.5%, which is above the skill of the model reported in the 2014 paper (although not a direct apples-to-apples comparison).</p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Different n-grams</strong>. Explore the model by changing the kernel size (number of n-grams) used by the channels in the model to see how it impacts model skill.</li>
<li><strong>More or Fewer Channels</strong>. Explore using more or fewer channels in the model and see how it impacts model skill.</li>
<li><strong>Deeper Network</strong>. Convolutional neural networks perform better in computer vision when they are deeper. Explore using deeper models here and see how it impacts model skill.</li>
</ul>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://arxiv.org/abs/1408.5882">Convolutional Neural Networks for Sentence Classification</a>, 2014.</li>
<li><a href="https://github.com/yoonkim/CNN_sentence">Convolutional Neural Networks for Sentence Classification (code)</a>.</li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a multichannel convolutional neural network for sentiment prediction on text movie review data.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to prepare movie review text data for modeling.</li>
<li>How to develop a multichannel convolutional neural network for text in Keras.</li>
<li>How to evaluate a fit model on unseen movie review data.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/&amp;summary=A+standard+deep+learning+model+for+text+classification+and+sentiment+analysis+uses+a+word+embedding+..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20N-gram%20Multichannel%20Convolutional%20Neural%20Network%20for%20Sentiment%20Analysis&amp;url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/&amp;summary=A+standard+deep+learning+model+for+text+classification+and+sentiment+analysis+uses+a+word+embedding+...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop a Neural Machine Translation System in Keras from Scratch</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/generate-test-datasets-python-scikit-learn/" rel="next">How to Generate Test Datasets in Python with scikit-learn <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">24 Responses to <em>How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-426313">
<div class="comment-container" id="li-comment-426313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b9b1cfed1408b16d19c2e4f1a8c29a8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b9b1cfed1408b16d19c2e4f1a8c29a8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hitkul</span>
<span class="date">January 12, 2018 at 5:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi<br/>
Great article<br/>
I think there is a small error, According to this code trainLines would be a list of list, where each list holds tokens for one review. But all the functions to which trainLines is passed(i.e texts_to_sequences, fit_on_texts, max_length) takes a list of strings as input. I think all the lists in trainX and testX should be converted to strings before dumping them into a file.</p>
<div class="reply">
<a aria-label="Reply to Hitkul" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426313#respond" onclick='return addComment.moveForm( "comment-426313", "426313", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426361">
<div class="comment-container" id="li-comment-426361">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426361" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The list of tokens is turned back into a string:</p>
<pre>
tokens = ' '.join(tokens)
</pre>
<pre></pre>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426361#respond" onclick='return addComment.moveForm( "comment-426361", "426361", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426320">
<div class="comment-container" id="li-comment-426320">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a7f62cd07e0e6772893ea43d2ce91cfc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a7f62cd07e0e6772893ea43d2ce91cfc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://virostatiq.com" rel="external nofollow">Marko Plahuta</a></span>
<span class="date">January 12, 2018 at 6:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426320" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
thanks for the article. Would it be possible to use only one input and one embedding layer, and branch into convolutions after that?</p>
<div class="reply">
<a aria-label="Reply to Marko Plahuta" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426320#respond" onclick='return addComment.moveForm( "comment-426320", "426320", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426364">
<div class="comment-container" id="li-comment-426364">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426364" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How would that work?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426364#respond" onclick='return addComment.moveForm( "comment-426364", "426364", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426332">
<div class="comment-container" id="li-comment-426332">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ecbb83d7b327d05417eca640b27d9192?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ecbb83d7b327d05417eca640b27d9192?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adnan ÖNCEVARLIK</span>
<span class="date">January 13, 2018 at 12:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426332" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
Thank you for your effort and good clean article.</p>
<div class="reply">
<a aria-label="Reply to Adnan ÖNCEVARLIK" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426332#respond" onclick='return addComment.moveForm( "comment-426332", "426332", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426370">
<div class="comment-container" id="li-comment-426370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426370#respond" onclick='return addComment.moveForm( "comment-426370", "426370", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426452">
<div class="comment-container" id="li-comment-426452">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/505e29b02a2e4cc905ab2e901e6057f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/505e29b02a2e4cc905ab2e901e6057f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sébastien</span>
<span class="date">January 14, 2018 at 3:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426452" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>FYI, the link to the review polarity dataset is wrong. The correct one is: <a href="https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz" rel="nofollow">https://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz</a></p>
<div class="reply">
<a aria-label="Reply to Sébastien" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426452#respond" onclick='return addComment.moveForm( "comment-426452", "426452", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426480">
<div class="comment-container" id="li-comment-426480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fixed, thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426480#respond" onclick='return addComment.moveForm( "comment-426480", "426480", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426454">
<div class="comment-container" id="li-comment-426454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.phexum.com" rel="external nofollow">Ahmet</a></span>
<span class="date">January 14, 2018 at 3:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your this beautiful work. I want to ask you that we are able to evaluate the accuracy of the model but how can we predict the classes of tested documents to analyze results in detail. In a Sequential model we can perform it like model.predict_classes(x_test). However for the Model(inputs=…) object predict_classes feature is not supported. Do you have a suggestion?<br/>
Thanks.</p>
<div class="reply">
<a aria-label="Reply to Ahmet" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426454#respond" onclick='return addComment.moveForm( "comment-426454", "426454", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426481">
<div class="comment-container" id="li-comment-426481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the document must be provided in an array 3 times.</p>
<p>yhat = model.predict([doc, doc, doc])</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426481#respond" onclick='return addComment.moveForm( "comment-426481", "426481", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426495">
<div class="comment-container" id="li-comment-426495">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ahmet</span>
<span class="date">January 14, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426495" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes I also tried like that but I am not sure how to interpret the probabilities for multiclass classification.</p>
<div class="reply">
<a aria-label="Reply to ahmet" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426495#respond" onclick='return addComment.moveForm( "comment-426495", "426495", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426578">
<div class="comment-container" id="li-comment-426578">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426578" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426578#respond" onclick='return addComment.moveForm( "comment-426578", "426578", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-426615">
<div class="comment-container" id="li-comment-426615">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3cb7e06bab63a87bfa470332b305fc8a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmet</span>
<span class="date">January 15, 2018 at 7:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426615" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for interest, Jason.<br/>
I am actually trying to apply your post for a multiclass case (0:negative,1:neutral,2:positive). After training part I want to compare the accuracy rates for each class to measure the how model is accurate in detail. Then I want to calculate the Precision and Recall. However, I can not use predict_classes() function in Model() object it is just allowed for Sequential() object. When I prefer the fuction model.predict([test_doc, test_doc, test_doc]) it gives me some probabilities below but I am not sure how to map them to class labels (0,1,2).</p>
<p>[0.03045881]<br/>
 [0.39043367]<br/>
 [0.01636862]<br/>
 …<br/>
 [0.7408592 ]<br/>
 [0.17758404]<br/>
 [0.21271853]</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-426650">
<div class="comment-container" id="li-comment-426650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can use argmax on the result from predict() to get a class index.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426459">
<div class="comment-container" id="li-comment-426459">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">January 14, 2018 at 4:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426459" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have tried similar architectures and came to the conclusion that this type of architecture (with parallel paths) are not good because when the error is back propagated  one of the good paths ,that would be learning in the right way, will be affected by a bad path that will increase tha global error. So one good path would be in the right way but it will think it is a bad learning because the global error will increase . (is this ideia right ? ) </p>
<p>whe I have “parallel layers” I have to find a way to pretrain before … and the freeze the values and add this layers to the model.</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426459#respond" onclick='return addComment.moveForm( "comment-426459", "426459", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426483">
<div class="comment-container" id="li-comment-426483">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426483" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps it depends on the dataset and models involved.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426483#respond" onclick='return addComment.moveForm( "comment-426483", "426483", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426487">
<div class="comment-container" id="li-comment-426487">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">January 14, 2018 at 6:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426487" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are some types of backprop that work with different learning rates for each connection and with this mitigate better the error on each connection … maybe this can help on “concurrent paths” during learning .  here is one type of bprop like this : <a href="https://en.wikipedia.org/wiki/Rprop" rel="nofollow">https://en.wikipedia.org/wiki/Rprop</a></p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426487#respond" onclick='return addComment.moveForm( "comment-426487", "426487", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426574">
<div class="comment-container" id="li-comment-426574">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426574" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I recommend Adam:<br/>
<a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/" rel="nofollow">https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426574#respond" onclick='return addComment.moveForm( "comment-426574", "426574", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426524">
<div class="comment-container" id="li-comment-426524">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/405ca9f94a2b3ee2ad49a79479aebd26?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/405ca9f94a2b3ee2ad49a79479aebd26?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JP Raymond</span>
<span class="date">January 14, 2018 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426524" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The architecture described in Yoon Kim’s paper:<br/>
– has one embedding layer (not one for each branch),<br/>
– uses global (max-over-time) pooling (not with a pool of size 2),<br/>
– applies dropout once, on the concatenation of the max features (not in each branch before the pooling operation).</p>
<p>Do the changes proposed here yield a better predictive performance?</p>
<div class="reply">
<a aria-label="Reply to JP Raymond" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426524#respond" onclick='return addComment.moveForm( "comment-426524", "426524", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426582">
<div class="comment-container" id="li-comment-426582">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426582" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice!</p>
<p>No idea, why not compare?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426582#respond" onclick='return addComment.moveForm( "comment-426582", "426582", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426769">
<div class="comment-container" id="li-comment-426769">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ad8be962bb1b656bcc1439c3a8157de4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ad8be962bb1b656bcc1439c3a8157de4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dev</span>
<span class="date">January 18, 2018 at 3:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426769" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this article. Very helpful.</p>
<p>I am facing an issue with the output, like getting different results everytime when I run the same model. The loss and accuracy are also changing all the time. </p>
<p>Any thoughts on this ?</p>
<div class="reply">
<a aria-label="Reply to Dev" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426769#respond" onclick='return addComment.moveForm( "comment-426769", "426769", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426809">
<div class="comment-container" id="li-comment-426809">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2018 at 10:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-426809" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Machine learning algorithms are stochastic by design. This is a feature, not a bug. Learn more here:<br/>
<a href="https://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=426809#respond" onclick='return addComment.moveForm( "comment-426809", "426809", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427041">
<div class="comment-container" id="li-comment-427041">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63c15cacf138927083b3ced57fcd061c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ramzy</span>
<span class="date">January 21, 2018 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427041" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the great tutorial, I performed all the steps and in the last step when I tried to evaluate the model, I got the below results!</p>
<p>Train Accuracy: 50.000000<br/>
Test Accuracy: 50.000000<br/>
What does this mean! I think this is not logical.</p>
<p>Also I got some warning like the below while running the evaluation code.</p>
<p>2018-01-20 22:21:41.333198: W c:\tf_jenkins\home\workspace\release-win\m\windows<br/>
\py\36\tensorflow\core\platform\cpu_feature_guard.cc:45] The TensorFlow library<br/>
wasn’t compiled to use AVX2 instructions, but these are available on your machin<br/>
e and could speed up CPU computations.<br/>
2018-01-20 22:21:41.333808: W c:\tf_jenkins\home\workspace\release-win\m\windows<br/>
\py\36\tensorflow\core\platform\cpu_feature_guard.cc:45] The TensorFlow library<br/>
wasn’t compiled to use FMA instructions, but these are available on your machine<br/>
 and could speed up CPU computations.</p>
<p>I’ll appreciate your reply. Thanks in advance</p>
<div class="reply">
<a aria-label="Reply to Ramzy" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=427041#respond" onclick='return addComment.moveForm( "comment-427041", "427041", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427059">
<div class="comment-container" id="li-comment-427059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2018 at 9:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#comment-427059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ignore those warnings.</p>
<p>Perhaps try running the code a second time given the stochastic nature of the algorithm.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/?replytocom=427059#respond" onclick='return addComment.moveForm( "comment-427059", "427059", "respond", "4586" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4586"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="d330414f70"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="116"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Text Data</h3>
<p>Cut through the math and research papers.<br/>
Discover Word Embeddings, Text Translation and more.</p>
<p><a href="/deep-learning-for-nlp/">Get Started With Deep Learning for NLP Today!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>