<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python - Machine Learning Mastery" property="og:title"/>
<meta content="The Long Short-Term Memory network or LSTM is a recurrent neural network that can learn and forecast long sequences. A benefit of LSTMs in addition to learning long sequences is that they can learn to make a one-shot multi-step forecast which may be useful for time series forecasting. A difficulty with LSTMs is that they …" property="og:description"/>
<meta content="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-05-10T05:00:29+11:00" property="article:published_time"/>
<meta content="2017-07-20T08:54:48+11:00" property="article:modified_time"/>
<meta content="2017-07-20T08:54:48+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Multi-step-Time-Series-Forecasting-with-Long-Short-Term-Memory-Networks-in-Python.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Multi-step-Time-Series-Forecasting-with-Long-Short-Term-Memory-Networks-in-Python.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="424" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/multi-step-time-series-forecasting-long-short-term-memory-networks-python\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/feed/" rel="alternate" title="Machine Learning Mastery » Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3987" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-long-short-term-memory-networks-python%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-long-short-term-memory-networks-python%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3987 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3987 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-05-10T05:00:29+1100">May 10, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-long-short-term-memory-networks-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/&amp;summary=The+Long+Short-Term+Memory+network+or+LSTM+is+a+recurrent+neural+network+that+can+learn+and+forecast..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/&amp;summary=The+Long+Short-Term+Memory+network+or+LSTM+is+a+recurrent+neural+network+that+can+learn+and+forecast...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>The Long Short-Term Memory network or LSTM is a recurrent neural network that can learn and forecast long sequences.</p>
<p>A benefit of LSTMs in addition to learning long sequences is that they can learn to make a one-shot multi-step forecast which may be useful for time series forecasting.</p>
<p>A difficulty with LSTMs is that they can be tricky to configure and it can require a lot of preparation to get the data in the right format for learning.</p>
<p>In this tutorial, you will discover how you can develop an LSTM for multi-step time series forecasting in Python with Keras.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to prepare data for multi-step time series forecasting.</li>
<li>How to develop an LSTM model for multi-step time series forecasting.</li>
<li>How to evaluate a multi-step time series forecast.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_3991" style="max-width: 650px"><img alt="Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python" class="size-full wp-image-3991" height="424" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Multi-step-Time-Series-Forecasting-with-Long-Short-Term-Memory-Networks-in-Python.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Multi-step-Time-Series-Forecasting-with-Long-Short-Term-Memory-Networks-in-Python.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/Multi-step-Time-Series-Forecasting-with-Long-Short-Term-Memory-Networks-in-Python-300x199.jpg 300w" width="640"/><p class="wp-caption-text">Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python<br/>Photo by <a href="https://www.flickr.com/photos/100308777@N07/10345460005/">Tom Babich</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is broken down into 4 parts; they are:</p>
<ol>
<li>Shampoo Sales Dataset</li>
<li>Data Preparation and Model Evaluation</li>
<li>Persistence Model</li>
<li>Multi-Step LSTM</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this example.</p>
<p>This tutorial assumes you have Keras v2.0 or higher installed with either the TensorFlow or Theano backend.</p>
<p>This tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help setting up your Python environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<p>Next, let’s take a look at a standard time series forecasting problem that we can use as context for this experiment.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Shampoo Sales Dataset</h2>
<p>This dataset describes the monthly number of sales of shampoo over a 3-year period.</p>
<p>The units are a sales count and there are 36 observations. The original dataset is credited to Makridakis, Wheelwright, and Hyndman (1998).</p>
<p><a href="https://datamarket.com/data/set/22r0/sales-of-shampoo-over-a-three-year-period">You can download and learn more about the dataset here</a>.</p>
<p>The example below loads and creates a plot of the loaded dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5a7144881954" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from pandas import datetime
from matplotlib import pyplot
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# summarize first few rows
print(series.head())
# line plot
series.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5a7144881954-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5a7144881954-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5a7144881954-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-4"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-6"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-8"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-9"><span class="crayon-p"># summarize first few rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-11"><span class="crayon-p"># line plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5a7144881954-12"><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5a7144881954-13"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Running the example loads the dataset as a Pandas Series and prints the first 5 rows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5b1941784399" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01    266.0
1901-02-01    145.9
1901-03-01    183.1
1901-04-01    119.3
1901-05-01    180.3
Name: Sales, dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5b1941784399-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b1941784399-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5b1941784399-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b1941784399-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5b1941784399-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b1941784399-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5b1941784399-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5b1941784399-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b1941784399-2">1901-01-01    266.0</div><div class="crayon-line" id="crayon-5a659102ab5b1941784399-3">1901-02-01    145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b1941784399-4">1901-03-01    183.1</div><div class="crayon-line" id="crayon-5a659102ab5b1941784399-5">1901-04-01    119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b1941784399-6">1901-05-01    180.3</div><div class="crayon-line" id="crayon-5a659102ab5b1941784399-7">Name: Sales, dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the series is then created showing a clear increasing trend.</p>
<div class="wp-caption aligncenter" id="attachment_3901" style="max-width: 650px"><img alt="Line Plot of Shampoo Sales Dataset" class="size-full wp-image-3901" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-1-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Shampoo Sales Dataset</p></div>
<p>Next, we will take a look at the model configuration and test harness used in the experiment.</p>
<h2>Data Preparation and Model Evaluation</h2>
<p>This section describes data preparation and model evaluation used in this tutorial</p>
<h3>Data Split</h3>
<p>We will split the Shampoo Sales dataset into two parts: a training and a test set.</p>
<p>The first two years of data will be taken for the training dataset and the remaining one year of data will be used for the test set.</p>
<p>Models will be developed using the training dataset and will make predictions on the test dataset.</p>
<p>For reference, the last 12 months of observations are as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5b4191257484" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
"3-01",339.7
"3-02",440.4
"3-03",315.9
"3-04",439.3
"3-05",401.3
"3-06",437.4
"3-07",575.5
"3-08",407.6
"3-09",682.0
"3-10",475.3
"3-11",581.3
"3-12",646.9</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5b4191257484-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b4191257484-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5b4191257484-1">"3-01",339.7</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-2">"3-02",440.4</div><div class="crayon-line" id="crayon-5a659102ab5b4191257484-3">"3-03",315.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-4">"3-04",439.3</div><div class="crayon-line" id="crayon-5a659102ab5b4191257484-5">"3-05",401.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-6">"3-06",437.4</div><div class="crayon-line" id="crayon-5a659102ab5b4191257484-7">"3-07",575.5</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-8">"3-08",407.6</div><div class="crayon-line" id="crayon-5a659102ab5b4191257484-9">"3-09",682.0</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-10">"3-10",475.3</div><div class="crayon-line" id="crayon-5a659102ab5b4191257484-11">"3-11",581.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b4191257484-12">"3-12",646.9</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Multi-Step Forecast</h3>
<p>We will contrive a multi-step forecast.</p>
<p>For a given month in the final 12 months of the dataset, we will be required to make a 3-month forecast.</p>
<p>That is given historical observations (t-1, t-2, … t-n) forecast t, t+1 and t+2.</p>
<p>Specifically, from December in year 2, we must forecast January, February and March. From January, we must forecast February, March and April. All the way to an October, November, December forecast from September in year 3.</p>
<p>A total of 10 3-month forecasts are required, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5b7326449922" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Dec,	Jan, Feb, Mar
Jan,	Feb, Mar, Apr
Feb,	Mar, Apr, May
Mar,	Apr, May, Jun
Apr, 	May, Jun, Jul
May,	Jun, Jul, Aug
Jun,	Jul, Aug, Sep
Jul,	Aug, Sep, Oct
Aug,	Sep, Oct, Nov
Sep,	Oct, Nov, Dec</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5b7326449922-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b7326449922-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5b7326449922-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b7326449922-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5b7326449922-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b7326449922-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5b7326449922-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b7326449922-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5b7326449922-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5b7326449922-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5b7326449922-1">Dec,	Jan, Feb, Mar</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b7326449922-2">Jan,	Feb, Mar, Apr</div><div class="crayon-line" id="crayon-5a659102ab5b7326449922-3">Feb,	Mar, Apr, May</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b7326449922-4">Mar,	Apr, May, Jun</div><div class="crayon-line" id="crayon-5a659102ab5b7326449922-5">Apr, 	May, Jun, Jul</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b7326449922-6">May,	Jun, Jul, Aug</div><div class="crayon-line" id="crayon-5a659102ab5b7326449922-7">Jun,	Jul, Aug, Sep</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b7326449922-8">Jul,	Aug, Sep, Oct</div><div class="crayon-line" id="crayon-5a659102ab5b7326449922-9">Aug,	Sep, Oct, Nov</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5b7326449922-10">Sep,	Oct, Nov, Dec</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Model Evaluation</h3>
<p>A rolling-forecast scenario will be used, also called walk-forward model validation.</p>
<p>Each time step of the test dataset will be walked one at a time. A model will be used to make a forecast for the time step, then the actual expected value for the next month from the test set will be taken and made available to the model for the forecast on the next time step.</p>
<p>This mimics a real-world scenario where new Shampoo Sales observations would be available each month and used in the forecasting of the following month.</p>
<p>This will be simulated by the structure of the train and test datasets.</p>
<p>All forecasts on the test dataset will be collected and an error score calculated to summarize the skill of the model for each of the forecast time steps. The root mean squared error (RMSE) will be used as it punishes large errors and results in a score that is in the same units as the forecast data, namely monthly shampoo sales.</p>
<h2>Persistence Model</h2>
<p>A good baseline for time series forecasting is the persistence model.</p>
<p>This is a forecasting model where the last observation is persisted forward. Because of its simplicity, it is often called the naive forecast.</p>
<p>You can learn more about the persistence model for time series forecasting in the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/">How to Make Baseline Predictions for Time Series Forecasting with Python</a></li>
</ul>
<h3>Prepare Data</h3>
<p>The first step is to transform the data from a series into a supervised learning problem.</p>
<p>That is to go from a list of numbers to a list of input and output patterns. We can achieve this using a pre-prepared function called <em>series_to_supervised()</em>.</p>
<p>For more on this function, see the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python">How to Convert a Time Series to a Supervised Learning Problem in Python</a></li>
</ul>
<p>The function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5bb662740893" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert time series into supervised learning problem
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-18">18</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-20">20</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5bb662740893-22">22</div><div class="crayon-num" data-line="crayon-5a659102ab5bb662740893-23">23</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5bb662740893-1"><span class="crayon-p"># convert time series into supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-2"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-3"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-4"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-5"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-6"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-8"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-9"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-10"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-12"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-13"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-14"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-15"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-16"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-17"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-18"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-19"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-20"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-21"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5bb662740893-22"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5bb662740893-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0026 seconds] -->
<p>The function can be called by passing in the loaded series values an <em>n_in</em> value of 1 and an n_out value of 3; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5be061527860" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
supervised = series_to_supervised(raw_values, 1, 3)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5be061527860-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5be061527860-1"><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Next, we can split the supervised learning dataset into training and test sets.</p>
<p>We know that in this form, the last 10 rows contain data for the final year. These rows comprise the test set and the rest of the data makes up the training dataset.</p>
<p>We can put all of this together in a new function that takes the loaded series and some parameters and returns a train and test set ready for modeling.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5c0932367081" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# transform series into train and test sets for supervised learning
def prepare_data(series, n_test, n_lag, n_seq):
	# extract raw values
	raw_values = series.values
	raw_values = raw_values.reshape(len(raw_values), 1)
	# transform into supervised learning problem X, y
	supervised = series_to_supervised(raw_values, n_lag, n_seq)
	supervised_values = supervised.values
	# split into train and test sets
	train, test = supervised_values[0:-n_test], supervised_values[-n_test:]
	return train, test</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c0932367081-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c0932367081-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c0932367081-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c0932367081-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c0932367081-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5c0932367081-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5c0932367081-1"><span class="crayon-p"># transform series into train and test sets for supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c0932367081-2"><span class="crayon-e">def </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c0932367081-3"><span class="crayon-h"> </span><span class="crayon-p"># extract raw values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c0932367081-4"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a659102ab5c0932367081-5"><span class="crayon-e"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c0932367081-6"><span class="crayon-h"> </span><span class="crayon-p"># transform into supervised learning problem X, y</span></div><div class="crayon-line" id="crayon-5a659102ab5c0932367081-7"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c0932367081-8"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659102ab5c0932367081-9"><span class="crayon-h"> </span><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c0932367081-10"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5c0932367081-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can test this with the Shampoo dataset. The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5c3815765144" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from pandas import datetime

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# convert time series into supervised learning problem
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg

# transform series into train and test sets for supervised learning
def prepare_data(series, n_test, n_lag, n_seq):
	# extract raw values
	raw_values = series.values
	raw_values = raw_values.reshape(len(raw_values), 1)
	# transform into supervised learning problem X, y
	supervised = series_to_supervised(raw_values, n_lag, n_seq)
	supervised_values = supervised.values
	# split into train and test sets
	train, test = supervised_values[0:-n_test], supervised_values[-n_test:]
	return train, test

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# configure
n_lag = 1
n_seq = 3
n_test = 10
# prepare data
train, test = prepare_data(series, n_test, n_lag, n_seq)
print(test)
print('Train: %s, Test: %s' % (train.shape, test.shape))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-18">18</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-20">20</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-22">22</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-24">24</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-26">26</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-28">28</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-30">30</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-32">32</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-34">34</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-36">36</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-38">38</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-40">40</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-42">42</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-44">44</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-46">46</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-48">48</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-50">50</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-52">52</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c3815765144-54">54</div><div class="crayon-num" data-line="crayon-5a659102ab5c3815765144-55">55</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5c3815765144-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">datetime</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-6"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-7"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-10"><span class="crayon-p"># convert time series into supervised learning problem</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-11"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-12"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-13"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-14"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-15"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-16"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-17"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-18"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-19"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-21"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-22"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-23"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-24"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-25"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-26"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-27"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-28"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-29"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-30"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-32"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-33"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-34"><span class="crayon-p"># transform series into train and test sets for supervised learning</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-35"><span class="crayon-e">def </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-36"><span class="crayon-h"> </span><span class="crayon-p"># extract raw values</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-37"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-38"><span class="crayon-e"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-39"><span class="crayon-h"> </span><span class="crayon-p"># transform into supervised learning problem X, y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-40"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-41"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-42"><span class="crayon-h"> </span><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-43"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-44"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-45"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-46"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-47"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-48"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-49"><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-50"><span class="crayon-v">n_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-51"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-52"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-53"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c3815765144-54"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5c3815765144-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Train: %s, Test: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0054 seconds] -->
<p>Running the example first prints the entire test dataset, which is the last 10 rows. The shape and size of the train test datasets is also printed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5c6148682438" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[[ 342.3  339.7  440.4  315.9]
 [ 339.7  440.4  315.9  439.3]
 [ 440.4  315.9  439.3  401.3]
 [ 315.9  439.3  401.3  437.4]
 [ 439.3  401.3  437.4  575.5]
 [ 401.3  437.4  575.5  407.6]
 [ 437.4  575.5  407.6  682. ]
 [ 575.5  407.6  682.   475.3]
 [ 407.6  682.   475.3  581.3]
 [ 682.   475.3  581.3  646.9]]
Train: (23, 4), Test: (10, 4)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c6148682438-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c6148682438-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c6148682438-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c6148682438-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5c6148682438-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5c6148682438-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5c6148682438-1">[[ 342.3  339.7  440.4  315.9]</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c6148682438-2"> [ 339.7  440.4  315.9  439.3]</div><div class="crayon-line" id="crayon-5a659102ab5c6148682438-3"> [ 440.4  315.9  439.3  401.3]</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c6148682438-4"> [ 315.9  439.3  401.3  437.4]</div><div class="crayon-line" id="crayon-5a659102ab5c6148682438-5"> [ 439.3  401.3  437.4  575.5]</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c6148682438-6"> [ 401.3  437.4  575.5  407.6]</div><div class="crayon-line" id="crayon-5a659102ab5c6148682438-7"> [ 437.4  575.5  407.6  682. ]</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c6148682438-8"> [ 575.5  407.6  682.   475.3]</div><div class="crayon-line" id="crayon-5a659102ab5c6148682438-9"> [ 407.6  682.   475.3  581.3]</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5c6148682438-10"> [ 682.   475.3  581.3  646.9]]</div><div class="crayon-line" id="crayon-5a659102ab5c6148682438-11">Train: (23, 4), Test: (10, 4)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can see the single input value (first column) on the first row of the test dataset matches the observation in the shampoo-sales for December in the 2nd year:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5c9850926067" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
"2-12",342.3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5c9850926067-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5c9850926067-1">"2-12",342.3</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can also see that each row contains 4 columns for the 1 input and 3 output values in each observation.</p>
<h3>Make Forecasts</h3>
<p>The next step is to make persistence forecasts.</p>
<p>We can implement the persistence forecast easily in a function named <em>persistence()</em> that takes the last observation and the number of forecast steps to persist. This function returns an array containing the forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5cb832416887" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make a persistence forecast
def persistence(last_ob, n_seq):
	return [last_ob for i in range(n_seq)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5cb832416887-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5cb832416887-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5cb832416887-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5cb832416887-1"><span class="crayon-p"># make a persistence forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5cb832416887-2"><span class="crayon-e">def </span><span class="crayon-e">persistence</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5cb832416887-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">last_ob </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can then call this function for each time step in the test dataset from December in year 2 to September in year 3.</p>
<p>Below is a function <em>make_forecasts()</em> that does this and takes the train, test, and configuration for the dataset as arguments and returns a list of forecasts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5ce441196673" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate the persistence model
def make_forecasts(train, test, n_lag, n_seq):
	forecasts = list()
	for i in range(len(test)):
		X, y = test[i, 0:n_lag], test[i, n_lag:]
		# make forecast
		forecast = persistence(X[-1], n_seq)
		# store the forecast
		forecasts.append(forecast)
	return forecasts</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5ce441196673-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ce441196673-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5ce441196673-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ce441196673-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5ce441196673-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ce441196673-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5ce441196673-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ce441196673-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5ce441196673-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ce441196673-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5ce441196673-1"><span class="crayon-p"># evaluate the persistence model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ce441196673-2"><span class="crayon-e">def </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5ce441196673-3"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ce441196673-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5ce441196673-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ce441196673-6"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5ce441196673-7"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">persistence</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ce441196673-8"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5ce441196673-9"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ce441196673-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We can call this function as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5d0397419705" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
forecasts = make_forecasts(train, test, 1, 3)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5d0397419705-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5d0397419705-1"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h3>Evaluate Forecasts</h3>
<p>The final step is to evaluate the forecasts.</p>
<p>We can do that by calculating the RMSE for each time step of the multi-step forecast, in this case giving us 3 RMSE scores. The function below, <em>evaluate_forecasts()</em>, calculates and prints the RMSE for each forecasted time step.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5d2165102663" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate the RMSE for each forecast time step
def evaluate_forecasts(test, forecasts, n_lag, n_seq):
	for i in range(n_seq):
		actual = test[:,(n_lag+i)]
		predicted = [forecast[i] for forecast in forecasts]
		rmse = sqrt(mean_squared_error(actual, predicted))
		print('t+%d RMSE: %f' % ((i+1), rmse))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5d2165102663-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d2165102663-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5d2165102663-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d2165102663-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5d2165102663-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d2165102663-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5d2165102663-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5d2165102663-1"><span class="crayon-p"># evaluate the RMSE for each forecast time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d2165102663-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5d2165102663-3"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d2165102663-4"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-o">+</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5d2165102663-5"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">forecast </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d2165102663-6"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5d2165102663-7"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'t+%d RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can call it as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5d5050001735" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
evaluate_forecasts(test, forecasts, 1, 3)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5d5050001735-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5d5050001735-1"><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>It is also helpful to plot the forecasts in the context of the original dataset to get an idea of how the RMSE scores relate to the problem in context.</p>
<p>We can first plot the entire Shampoo dataset, then plot each forecast as a red line. The function <em>plot_forecasts()</em> below will create and show this plot.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5d7844860113" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot the forecasts in the context of the original dataset
def plot_forecasts(series, forecasts, n_test):
	# plot the entire dataset in blue
	pyplot.plot(series.values)
	# plot the forecasts in red
	for i in range(len(forecasts)):
		off_s = len(series) - n_test + i
		off_e = off_s + len(forecasts[i])
		xaxis = [x for x in range(off_s, off_e)]
		pyplot.plot(xaxis, forecasts[i], color='red')
	# show the plot
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5d7844860113-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5d7844860113-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5d7844860113-1"><span class="crayon-p"># plot the forecasts in the context of the original dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-2"><span class="crayon-e">def </span><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5d7844860113-3"><span class="crayon-h"> </span><span class="crayon-p"># plot the entire dataset in blue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-4"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5d7844860113-5"><span class="crayon-h"> </span><span class="crayon-p"># plot the forecasts in red</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5d7844860113-7"><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">i</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-8"><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5d7844860113-9"><span class="crayon-h"> </span><span class="crayon-v">xaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">off_s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-10"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">xaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'red'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5d7844860113-11"><span class="crayon-h"> </span><span class="crayon-p"># show the plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5d7844860113-12"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We can call the function as follows. Note that the number of observations held back on the test set is 12 for the 12 months, as opposed to 10 for the 10 supervised learning input/output patterns as was used above.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5da804915889" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot forecasts
plot_forecasts(series, forecasts, 12)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5da804915889-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5da804915889-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5da804915889-1"><span class="crayon-p"># plot forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5da804915889-2"><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can make the plot better by connecting the persisted forecast to the actual persisted value in the original dataset.</p>
<p>This will require adding the last observed value to the front of the forecast. Below is an updated version of the <em>plot_forecasts()</em> function with this improvement.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5dc121128017" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# plot the forecasts in the context of the original dataset
def plot_forecasts(series, forecasts, n_test):
	# plot the entire dataset in blue
	pyplot.plot(series.values)
	# plot the forecasts in red
	for i in range(len(forecasts)):
		off_s = len(series) - 12 + i - 1
		off_e = off_s + len(forecasts[i]) + 1
		xaxis = [x for x in range(off_s, off_e)]
		yaxis = [series.values[off_s]] + forecasts[i]
		pyplot.plot(xaxis, yaxis, color='red')
	# show the plot
	pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5dc121128017-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5dc121128017-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5dc121128017-1"><span class="crayon-p"># plot the forecasts in the context of the original dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-2"><span class="crayon-e">def </span><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-3"><span class="crayon-h"> </span><span class="crayon-p"># plot the entire dataset in blue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-4"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-5"><span class="crayon-h"> </span><span class="crayon-p"># plot the forecasts in red</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-7"><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">12</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-8"><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-9"><span class="crayon-h"> </span><span class="crayon-v">xaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">off_s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-10"><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">off_s</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-11"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">xaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'red'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5dc121128017-12"><span class="crayon-h"> </span><span class="crayon-p"># show the plot</span></div><div class="crayon-line" id="crayon-5a659102ab5dc121128017-13"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can put all of these pieces together.</p>
<p>The complete code example for the multi-step persistence forecast is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5de673061250" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from math import sqrt
from matplotlib import pyplot

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# convert time series into supervised learning problem
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg

# transform series into train and test sets for supervised learning
def prepare_data(series, n_test, n_lag, n_seq):
	# extract raw values
	raw_values = series.values
	raw_values = raw_values.reshape(len(raw_values), 1)
	# transform into supervised learning problem X, y
	supervised = series_to_supervised(raw_values, n_lag, n_seq)
	supervised_values = supervised.values
	# split into train and test sets
	train, test = supervised_values[0:-n_test], supervised_values[-n_test:]
	return train, test

# make a persistence forecast
def persistence(last_ob, n_seq):
	return [last_ob for i in range(n_seq)]

# evaluate the persistence model
def make_forecasts(train, test, n_lag, n_seq):
	forecasts = list()
	for i in range(len(test)):
		X, y = test[i, 0:n_lag], test[i, n_lag:]
		# make forecast
		forecast = persistence(X[-1], n_seq)
		# store the forecast
		forecasts.append(forecast)
	return forecasts

# evaluate the RMSE for each forecast time step
def evaluate_forecasts(test, forecasts, n_lag, n_seq):
	for i in range(n_seq):
		actual = test[:,(n_lag+i)]
		predicted = [forecast[i] for forecast in forecasts]
		rmse = sqrt(mean_squared_error(actual, predicted))
		print('t+%d RMSE: %f' % ((i+1), rmse))

# plot the forecasts in the context of the original dataset
def plot_forecasts(series, forecasts, n_test):
	# plot the entire dataset in blue
	pyplot.plot(series.values)
	# plot the forecasts in red
	for i in range(len(forecasts)):
		off_s = len(series) - n_test + i - 1
		off_e = off_s + len(forecasts[i]) + 1
		xaxis = [x for x in range(off_s, off_e)]
		yaxis = [series.values[off_s]] + forecasts[i]
		pyplot.plot(xaxis, yaxis, color='red')
	# show the plot
	pyplot.show()

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# configure
n_lag = 1
n_seq = 3
n_test = 10
# prepare data
train, test = prepare_data(series, n_test, n_lag, n_seq)
# make forecasts
forecasts = make_forecasts(train, test, n_lag, n_seq)
# evaluate forecasts
evaluate_forecasts(test, forecasts, n_lag, n_seq)
# plot forecasts
plot_forecasts(series, forecasts, n_test+2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-18">18</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-20">20</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-22">22</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-24">24</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-26">26</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-28">28</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-30">30</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-32">32</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-34">34</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-36">36</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-38">38</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-40">40</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-42">42</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-44">44</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-46">46</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-48">48</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-50">50</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-52">52</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-54">54</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-56">56</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-58">58</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-60">60</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-62">62</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-64">64</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-66">66</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-68">68</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-70">70</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-72">72</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-74">74</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-76">76</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-78">78</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-80">80</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-82">82</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-84">84</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-86">86</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-88">88</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-90">90</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-92">92</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-94">94</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-96">96</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5de673061250-98">98</div><div class="crayon-num" data-line="crayon-5a659102ab5de673061250-99">99</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5de673061250-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-5"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-6"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-8"> </div><div class="crayon-line" id="crayon-5a659102ab5de673061250-9"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-10"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-12"> </div><div class="crayon-line" id="crayon-5a659102ab5de673061250-13"><span class="crayon-p"># convert time series into supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-14"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-15"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-16"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-17"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-18"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-20"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-21"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-22"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-23"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-24"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-25"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-26"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-27"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-28"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-29"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-30"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-32"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-33"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-34"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-36"> </div><div class="crayon-line" id="crayon-5a659102ab5de673061250-37"><span class="crayon-p"># transform series into train and test sets for supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-38"><span class="crayon-e">def </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-39"><span class="crayon-h"> </span><span class="crayon-p"># extract raw values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-40"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-41"><span class="crayon-e"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-42"><span class="crayon-h"> </span><span class="crayon-p"># transform into supervised learning problem X, y</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-43"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-44"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-45"><span class="crayon-h"> </span><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-46"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-47"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-48"> </div><div class="crayon-line" id="crayon-5a659102ab5de673061250-49"><span class="crayon-p"># make a persistence forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-50"><span class="crayon-e">def </span><span class="crayon-e">persistence</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">last_ob </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-52"> </div><div class="crayon-line" id="crayon-5a659102ab5de673061250-53"><span class="crayon-p"># evaluate the persistence model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-54"><span class="crayon-e">def </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-55"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-56"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-57"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-58"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-59"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">persistence</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-60"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-61"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-63"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-64"><span class="crayon-p"># evaluate the RMSE for each forecast time step</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-65"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-66"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-67"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-sy">(</span><span class="crayon-v">n_lag</span><span class="crayon-o">+</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-68"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">forecast </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-69"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-70"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'t+%d RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-71"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-72"><span class="crayon-p"># plot the forecasts in the context of the original dataset</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-73"><span class="crayon-e">def </span><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-74"><span class="crayon-h"> </span><span class="crayon-p"># plot the entire dataset in blue</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-75"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-76"><span class="crayon-h"> </span><span class="crayon-p"># plot the forecasts in red</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-77"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-78"><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-79"><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-80"><span class="crayon-h"> </span><span class="crayon-v">xaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">off_s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-81"><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">off_s</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-82"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">xaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'red'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-83"><span class="crayon-h"> </span><span class="crayon-p"># show the plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-84"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-85"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-86"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-87"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-88"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-89"><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-90"><span class="crayon-v">n_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-91"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-92"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-93"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-94"><span class="crayon-p"># make forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-95"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-96"><span class="crayon-p"># evaluate forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-97"><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5de673061250-98"><span class="crayon-p"># plot forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab5de673061250-99"><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0084 seconds] -->
<p>Running the example first prints the RMSE for each of the forecasted time steps.</p>
<p>This gives us a baseline of performance on each time step that we would expect the LSTM to outperform.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5e3363731352" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
t+1 RMSE: 144.535304
t+2 RMSE: 86.479905
t+3 RMSE: 121.149168</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5e3363731352-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5e3363731352-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5e3363731352-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5e3363731352-1">t+1 RMSE: 144.535304</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5e3363731352-2">t+2 RMSE: 86.479905</div><div class="crayon-line" id="crayon-5a659102ab5e3363731352-3">t+3 RMSE: 121.149168</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The plot of the original time series with the multi-step persistence forecasts is also created. The lines connect to the appropriate input value for each forecast.</p>
<p>This context shows how naive the persistence forecasts actually are.</p>
<div class="wp-caption aligncenter" id="attachment_3988" style="max-width: 650px"><img alt="Line Plot of Shampoo Sales Dataset with Multi-Step Persistence Forecasts" class="size-full wp-image-3988" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-Persistence-Forecasts.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-Persistence-Forecasts.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-Persistence-Forecasts-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Shampoo Sales Dataset with Multi-Step Persistence Forecasts</p></div>
<h2>Multi-Step LSTM Network</h2>
<p>In this section, we will use the persistence example as a starting point and look at the changes needed to fit an LSTM to the training data and make multi-step forecasts for the test dataset.</p>
<h3>Prepare Data</h3>
<p>The data must be prepared before we can use it to train an LSTM.</p>
<p>Specifically, two additional changes are required:</p>
<ol>
<li><strong>Stationary</strong>. The data shows an increasing trend that must be removed by differencing.</li>
<li><strong>Scale</strong>. The scale of the data must be reduced to values between -1 and 1, the activation function of the LSTM units.</li>
</ol>
<p>We can introduce a function to make the data stationary called <em>difference()</em>. This will transform the series of values into a series of differences, a simpler representation to work with.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5e6612799360" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5e6612799360-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5e6612799360-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5e6612799360-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5e6612799360-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5e6612799360-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5e6612799360-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5e6612799360-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5e6612799360-1"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5e6612799360-2"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5e6612799360-3"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5e6612799360-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5e6612799360-5"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5e6612799360-6"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5e6612799360-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We can use the <em>MinMaxScaler</em> from the sklearn library to scale the data.</p>
<p>Putting this together, we can update the <em>prepare_data()</em> function to first difference the data and rescale it, then perform the transform into a supervised learning problem and train test sets as we did before with the persistence example.</p>
<p>The function now returns a scaler in addition to the train and test datasets.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5ed490370753" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# transform series into train and test sets for supervised learning
def prepare_data(series, n_test, n_lag, n_seq):
	# extract raw values
	raw_values = series.values
	# transform data to be stationary
	diff_series = difference(raw_values, 1)
	diff_values = diff_series.values
	diff_values = diff_values.reshape(len(diff_values), 1)
	# rescale values to -1, 1
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaled_values = scaler.fit_transform(diff_values)
	scaled_values = scaled_values.reshape(len(scaled_values), 1)
	# transform into supervised learning problem X, y
	supervised = series_to_supervised(scaled_values, n_lag, n_seq)
	supervised_values = supervised.values
	# split into train and test sets
	train, test = supervised_values[0:-n_test], supervised_values[-n_test:]
	return scaler, train, test</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab5ed490370753-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5ed490370753-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5ed490370753-1"><span class="crayon-p"># transform series into train and test sets for supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-2"><span class="crayon-e">def </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-3"><span class="crayon-h"> </span><span class="crayon-p"># extract raw values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-4"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-5"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-6"><span class="crayon-h"> </span><span class="crayon-v">diff_series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-7"><span class="crayon-h"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diff_series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-8"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diff_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-9"><span class="crayon-h"> </span><span class="crayon-p"># rescale values to -1, 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-10"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-11"><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-12"><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-13"><span class="crayon-h"> </span><span class="crayon-p"># transform into supervised learning problem X, y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-14"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-15"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-16"><span class="crayon-h"> </span><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a659102ab5ed490370753-17"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5ed490370753-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>We can call this function as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5f0859778164" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data
scaler, train, test = prepare_data(series, n_test, n_lag, n_seq)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5f0859778164-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f0859778164-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5f0859778164-1"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f0859778164-2"><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<h3>Fit LSTM Network</h3>
<p>Next, we need to fit an LSTM network model to the training data.</p>
<p>This first requires that the training dataset be transformed from a 2D array [<em>samples, features</em>] to a 3D array [<em>samples, timesteps, features</em>]. We will fix time steps at 1, so this change is straightforward.</p>
<p>Next, we need to design an LSTM network. We will use a simple structure with 1 hidden layer with 1 LSTM unit, then an output layer with linear activation and 3 output values. The network will use a mean squared error loss function and the efficient ADAM optimization algorithm.</p>
<p>The LSTM is stateful; this means that we have to manually reset the state of the network at the end of each training epoch. The network will be fit for 1500 epochs.</p>
<p>The same batch size must be used for training and prediction, and we require predictions to be made at each time step of the test dataset. This means that a batch size of 1 must be used. A batch size of 1 is also called online learning as the network weights will be updated during training after each training pattern (as opposed to mini batch or batch updates).</p>
<p>We can put all of this together in a function called <em>fit_lstm()</em>. The function takes a number of key parameters that can be used to tune the network later and the function returns a fit LSTM model ready for forecasting.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5f3955455712" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit an LSTM network to training data
def fit_lstm(train, n_lag, n_seq, n_batch, nb_epoch, n_neurons):
	# reshape training into [samples, timesteps, features]
	X, y = train[:, 0:n_lag], train[:, n_lag:]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# design network
	model = Sequential()
	model.add(LSTM(n_neurons, batch_input_shape=(n_batch, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(y.shape[1]))
	model.compile(loss='mean_squared_error', optimizer='adam')
	# fit network
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=n_batch, verbose=0, shuffle=False)
		model.reset_states()
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f3955455712-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab5f3955455712-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5f3955455712-1"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-2"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-3"><span class="crayon-h"> </span><span class="crayon-p"># reshape training into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-6"><span class="crayon-h"> </span><span class="crayon-p"># design network</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-11"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-13"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f3955455712-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5f3955455712-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>The function can be called as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5f6147923677" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit model
model = fit_lstm(train, 1, 3, 1, 1500, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5f6147923677-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f6147923677-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5f6147923677-1"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f6147923677-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1500</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The configuration of the network was not tuned; try different parameters if you like.</p>
<p>Report your findings in the comments below. I’d love to see what you can get.</p>
<h3>Make LSTM Forecasts</h3>
<p>The next step is to use the fit LSTM network to make forecasts.</p>
<p>A single forecast can be made with the fit LSTM network by calling <em>model.predict()</em>. Again, the data must be formatted into a 3D array with the format [<em>samples, timesteps, features</em>].</p>
<p>We can wrap this up into a function called <em>forecast_lstm()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5f8546650224" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make one forecast with an LSTM,
def forecast_lstm(model, X, n_batch):
	# reshape input pattern to [samples, timesteps, features]
	X = X.reshape(1, 1, len(X))
	# make forecast
	forecast = model.predict(X, batch_size=n_batch)
	# convert to array
	return [x for x in forecast[0, :]]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5f8546650224-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f8546650224-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5f8546650224-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f8546650224-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5f8546650224-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f8546650224-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5f8546650224-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5f8546650224-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5f8546650224-1"><span class="crayon-p"># make one forecast with an LSTM,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f8546650224-2"><span class="crayon-e">def </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5f8546650224-3"><span class="crayon-h"> </span><span class="crayon-p"># reshape input pattern to [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f8546650224-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5f8546650224-5"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f8546650224-6"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab5f8546650224-7"><span class="crayon-h"> </span><span class="crayon-p"># convert to array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5f8546650224-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We can call this function from the <em>make_forecasts()</em> function and update it to accept the model as an argument. The updated version is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5fb960750068" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate the persistence model
def make_forecasts(model, n_batch, train, test, n_lag, n_seq):
	forecasts = list()
	for i in range(len(test)):
		X, y = test[i, 0:n_lag], test[i, n_lag:]
		# make forecast
		forecast = forecast_lstm(model, X, n_batch)
		# store the forecast
		forecasts.append(forecast)
	return forecasts</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5fb960750068-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fb960750068-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab5fb960750068-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fb960750068-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab5fb960750068-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fb960750068-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab5fb960750068-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fb960750068-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab5fb960750068-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fb960750068-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5fb960750068-1"><span class="crayon-p"># evaluate the persistence model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fb960750068-2"><span class="crayon-e">def </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5fb960750068-3"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fb960750068-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab5fb960750068-5"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fb960750068-6"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5fb960750068-7"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fb960750068-8"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast</span></div><div class="crayon-line" id="crayon-5a659102ab5fb960750068-9"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fb960750068-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>This updated version of the <em>make_forecasts()</em> function can be called as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab5fd461799762" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make forecasts
forecasts = make_forecasts(model, 1, train, test, 1, 3)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab5fd461799762-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab5fd461799762-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab5fd461799762-1"><span class="crayon-p"># make forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab5fd461799762-2"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p></p>
<h3>Invert Transforms</h3>
<p>After the forecasts have been made, we need to invert the transforms to return the values back into the original scale.</p>
<p>This is needed so that we can calculate error scores and plots that are comparable with other models, like the persistence forecast above.</p>
<p>We can invert the scale of the forecasts directly using the <em>MinMaxScaler</em> object that offers an <em>inverse_transform()</em> function.</p>
<p>We can invert the differencing by adding the value of the last observation (prior months’ shampoo sales) to the first forecasted value, then propagating the value down the forecast.</p>
<p>This is a little fiddly; we can wrap up the behavior in a function name <em>inverse_difference()</em> that takes the last observed value prior to the forecast and the forecast as arguments and returns the inverted forecast.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab600000533989" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert differenced forecast
def inverse_difference(last_ob, forecast):
	# invert first forecast
	inverted = list()
	inverted.append(forecast[0] + last_ob)
	# propagate difference forecast using inverted first value
	for i in range(1, len(forecast)):
		inverted.append(forecast[i] + inverted[i-1])
	return inverted</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab600000533989-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab600000533989-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab600000533989-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab600000533989-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab600000533989-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab600000533989-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab600000533989-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab600000533989-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab600000533989-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab600000533989-1"><span class="crayon-p"># invert differenced forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab600000533989-2"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab600000533989-3"><span class="crayon-h"> </span><span class="crayon-p"># invert first forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab600000533989-4"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab600000533989-5"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">last_ob</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab600000533989-6"><span class="crayon-h"> </span><span class="crayon-p"># propagate difference forecast using inverted first value</span></div><div class="crayon-line" id="crayon-5a659102ab600000533989-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab600000533989-8"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab600000533989-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Putting this together, we can create an <em>inverse_transform()</em> function that works through each forecast, first inverting the scale and then inverting the differences, returning forecasts to their original scale.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab602340344754" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# inverse data transform on forecasts
def inverse_transform(series, forecasts, scaler, n_test):
	inverted = list()
	for i in range(len(forecasts)):
		# create array from forecast
		forecast = array(forecasts[i])
		forecast = forecast.reshape(1, len(forecast))
		# invert scaling
		inv_scale = scaler.inverse_transform(forecast)
		inv_scale = inv_scale[0, :]
		# invert differencing
		index = len(series) - n_test + i - 1
		last_ob = series.values[index]
		inv_diff = inverse_difference(last_ob, inv_scale)
		# store
		inverted.append(inv_diff)
	return inverted</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab602340344754-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab602340344754-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab602340344754-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab602340344754-1"><span class="crayon-p"># inverse data transform on forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-2"><span class="crayon-e">def </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-3"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-5"><span class="crayon-h"> </span><span class="crayon-p"># create array from forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-6"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-7"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-8"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-9"><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-10"><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-11"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-12"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-13"><span class="crayon-h"> </span><span class="crayon-v">last_ob</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-14"><span class="crayon-h"> </span><span class="crayon-v">inv_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-15"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab602340344754-16"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">inv_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab602340344754-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>We can call this function with the forecasts as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab605280820516" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# inverse transform forecasts and test
forecasts = inverse_transform(series, forecasts, scaler, n_test+2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab605280820516-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab605280820516-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab605280820516-1"><span class="crayon-p"># inverse transform forecasts and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab605280820516-2"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can also invert the transforms on the output part test dataset so that we can correctly calculate the RMSE scores, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab607356870499" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
actual = [row[n_lag:] for row in test]
actual = inverse_transform(series, actual, scaler, n_test+2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab607356870499-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab607356870499-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab607356870499-1"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab607356870499-2"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can also simplify the calculation of RMSE scores to expect the test data to only contain the output values, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab609996858595" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def evaluate_forecasts(test, forecasts, n_lag, n_seq):
	for i in range(n_seq):
		actual = [row[i] for row in test]
		predicted = [forecast[i] for forecast in forecasts]
		rmse = sqrt(mean_squared_error(actual, predicted))
		print('t+%d RMSE: %f' % ((i+1), rmse))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab609996858595-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab609996858595-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab609996858595-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab609996858595-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab609996858595-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab609996858595-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab609996858595-1"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab609996858595-2"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab609996858595-3"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab609996858595-4"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">forecast </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab609996858595-5"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab609996858595-6"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'t+%d RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can tie all of these pieces together and fit an LSTM network to the multi-step time series forecasting problem.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab60c927220912" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
from matplotlib import pyplot
from numpy import array

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# convert time series into supervised learning problem
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# transform series into train and test sets for supervised learning
def prepare_data(series, n_test, n_lag, n_seq):
	# extract raw values
	raw_values = series.values
	# transform data to be stationary
	diff_series = difference(raw_values, 1)
	diff_values = diff_series.values
	diff_values = diff_values.reshape(len(diff_values), 1)
	# rescale values to -1, 1
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaled_values = scaler.fit_transform(diff_values)
	scaled_values = scaled_values.reshape(len(scaled_values), 1)
	# transform into supervised learning problem X, y
	supervised = series_to_supervised(scaled_values, n_lag, n_seq)
	supervised_values = supervised.values
	# split into train and test sets
	train, test = supervised_values[0:-n_test], supervised_values[-n_test:]
	return scaler, train, test

# fit an LSTM network to training data
def fit_lstm(train, n_lag, n_seq, n_batch, nb_epoch, n_neurons):
	# reshape training into [samples, timesteps, features]
	X, y = train[:, 0:n_lag], train[:, n_lag:]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# design network
	model = Sequential()
	model.add(LSTM(n_neurons, batch_input_shape=(n_batch, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(y.shape[1]))
	model.compile(loss='mean_squared_error', optimizer='adam')
	# fit network
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=n_batch, verbose=0, shuffle=False)
		model.reset_states()
	return model

# make one forecast with an LSTM,
def forecast_lstm(model, X, n_batch):
	# reshape input pattern to [samples, timesteps, features]
	X = X.reshape(1, 1, len(X))
	# make forecast
	forecast = model.predict(X, batch_size=n_batch)
	# convert to array
	return [x for x in forecast[0, :]]

# evaluate the persistence model
def make_forecasts(model, n_batch, train, test, n_lag, n_seq):
	forecasts = list()
	for i in range(len(test)):
		X, y = test[i, 0:n_lag], test[i, n_lag:]
		# make forecast
		forecast = forecast_lstm(model, X, n_batch)
		# store the forecast
		forecasts.append(forecast)
	return forecasts

# invert differenced forecast
def inverse_difference(last_ob, forecast):
	# invert first forecast
	inverted = list()
	inverted.append(forecast[0] + last_ob)
	# propagate difference forecast using inverted first value
	for i in range(1, len(forecast)):
		inverted.append(forecast[i] + inverted[i-1])
	return inverted

# inverse data transform on forecasts
def inverse_transform(series, forecasts, scaler, n_test):
	inverted = list()
	for i in range(len(forecasts)):
		# create array from forecast
		forecast = array(forecasts[i])
		forecast = forecast.reshape(1, len(forecast))
		# invert scaling
		inv_scale = scaler.inverse_transform(forecast)
		inv_scale = inv_scale[0, :]
		# invert differencing
		index = len(series) - n_test + i - 1
		last_ob = series.values[index]
		inv_diff = inverse_difference(last_ob, inv_scale)
		# store
		inverted.append(inv_diff)
	return inverted

# evaluate the RMSE for each forecast time step
def evaluate_forecasts(test, forecasts, n_lag, n_seq):
	for i in range(n_seq):
		actual = [row[i] for row in test]
		predicted = [forecast[i] for forecast in forecasts]
		rmse = sqrt(mean_squared_error(actual, predicted))
		print('t+%d RMSE: %f' % ((i+1), rmse))

# plot the forecasts in the context of the original dataset
def plot_forecasts(series, forecasts, n_test):
	# plot the entire dataset in blue
	pyplot.plot(series.values)
	# plot the forecasts in red
	for i in range(len(forecasts)):
		off_s = len(series) - n_test + i - 1
		off_e = off_s + len(forecasts[i]) + 1
		xaxis = [x for x in range(off_s, off_e)]
		yaxis = [series.values[off_s]] + forecasts[i]
		pyplot.plot(xaxis, yaxis, color='red')
	# show the plot
	pyplot.show()

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# configure
n_lag = 1
n_seq = 3
n_test = 10
n_epochs = 1500
n_batch = 1
n_neurons = 1
# prepare data
scaler, train, test = prepare_data(series, n_test, n_lag, n_seq)
# fit model
model = fit_lstm(train, n_lag, n_seq, n_batch, n_epochs, n_neurons)
# make forecasts
forecasts = make_forecasts(model, n_batch, train, test, n_lag, n_seq)
# inverse transform forecasts and test
forecasts = inverse_transform(series, forecasts, scaler, n_test+2)
actual = [row[n_lag:] for row in test]
actual = inverse_transform(series, actual, scaler, n_test+2)
# evaluate forecasts
evaluate_forecasts(actual, forecasts, n_lag, n_seq)
# plot forecasts
plot_forecasts(series, forecasts, n_test+2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-4">4</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-6">6</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-8">8</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-10">10</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-12">12</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-14">14</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-16">16</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-18">18</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-20">20</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-22">22</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-24">24</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-26">26</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-28">28</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-30">30</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-32">32</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-34">34</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-36">36</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-38">38</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-40">40</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-42">42</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-44">44</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-46">46</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-48">48</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-50">50</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-52">52</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-54">54</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-56">56</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-58">58</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-60">60</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-62">62</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-64">64</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-66">66</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-68">68</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-70">70</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-72">72</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-74">74</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-76">76</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-78">78</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-80">80</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-82">82</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-84">84</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-86">86</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-88">88</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-90">90</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-92">92</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-94">94</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-96">96</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-98">98</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-100">100</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-102">102</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-104">104</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-106">106</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-108">108</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-110">110</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-112">112</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-114">114</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-116">116</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-118">118</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-120">120</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-122">122</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-124">124</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-126">126</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-128">128</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-130">130</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-132">132</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-134">134</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-136">136</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-138">138</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-140">140</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-142">142</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-144">144</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-146">146</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-148">148</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-150">150</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-152">152</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-154">154</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-156">156</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-158">158</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-160">160</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-162">162</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-164">164</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-166">166</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-168">168</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-170">170</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-172">172</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-174">174</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-176">176</div><div class="crayon-num" data-line="crayon-5a659102ab60c927220912-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab60c927220912-178">178</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab60c927220912-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-11"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-12"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-13"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-14"> </div><div class="crayon-line" id="crayon-5a659102ab60c927220912-15"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-16"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-18"> </div><div class="crayon-line" id="crayon-5a659102ab60c927220912-19"><span class="crayon-p"># convert time series into supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-20"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-21"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-22"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-23"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-24"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-25"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-26"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-27"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-28"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-29"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-30"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-31"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-32"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-33"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-34"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-35"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-36"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-37"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-38"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-39"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-40"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-41"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-42"> </div><div class="crayon-line" id="crayon-5a659102ab60c927220912-43"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-44"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-45"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-46"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-47"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-48"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-49"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-50"> </div><div class="crayon-line" id="crayon-5a659102ab60c927220912-51"><span class="crayon-p"># transform series into train and test sets for supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-52"><span class="crayon-e">def </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-53"><span class="crayon-h"> </span><span class="crayon-p"># extract raw values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-54"><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-55"><span class="crayon-h"> </span><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-56"><span class="crayon-h"> </span><span class="crayon-v">diff_series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-57"><span class="crayon-h"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diff_series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-58"><span class="crayon-e"> </span><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diff_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-59"><span class="crayon-h"> </span><span class="crayon-p"># rescale values to -1, 1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-60"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-61"><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-62"><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaled_values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-63"><span class="crayon-h"> </span><span class="crayon-p"># transform into supervised learning problem X, y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-64"><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-65"><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-66"><span class="crayon-h"> </span><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-67"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_test</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-68"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-69"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-70"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-71"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-72"><span class="crayon-h"> </span><span class="crayon-p"># reshape training into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-73"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-74"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-75"><span class="crayon-h"> </span><span class="crayon-p"># design network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-76"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-77"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-78"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-79"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-80"><span class="crayon-h"> </span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-81"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-82"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-83"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-84"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-85"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-86"><span class="crayon-p"># make one forecast with an LSTM,</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-87"><span class="crayon-e">def </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-88"><span class="crayon-h"> </span><span class="crayon-p"># reshape input pattern to [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-89"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-90"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-91"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-92"><span class="crayon-h"> </span><span class="crayon-p"># convert to array</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-93"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-94"> </div><div class="crayon-line" id="crayon-5a659102ab60c927220912-95"><span class="crayon-p"># evaluate the persistence model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-96"><span class="crayon-e">def </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-97"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-98"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-99"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_lag</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-100"><span class="crayon-h"> </span><span class="crayon-p"># make forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-101"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-102"><span class="crayon-h"> </span><span class="crayon-p"># store the forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-103"><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-104"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-105"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-106"><span class="crayon-p"># invert differenced forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-107"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-108"><span class="crayon-h"> </span><span class="crayon-p"># invert first forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-109"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-110"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">last_ob</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-111"><span class="crayon-h"> </span><span class="crayon-p"># propagate difference forecast using inverted first value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-112"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-113"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-114"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-115"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-116"><span class="crayon-p"># inverse data transform on forecasts</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-117"><span class="crayon-e">def </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-118"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-119"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-120"><span class="crayon-h"> </span><span class="crayon-p"># create array from forecast</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-121"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-122"><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">forecast</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-123"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-124"><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">forecast</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-125"><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-126"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-127"><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-128"><span class="crayon-h"> </span><span class="crayon-v">last_ob</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-129"><span class="crayon-h"> </span><span class="crayon-v">inv_diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">last_ob</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inv_scale</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-130"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-131"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">inv_diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-132"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-133"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-134"><span class="crayon-p"># evaluate the RMSE for each forecast time step</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-135"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-136"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-137"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-138"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">forecast</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">forecast </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-139"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-140"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'t+%d RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-141"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-142"><span class="crayon-p"># plot the forecasts in the context of the original dataset</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-143"><span class="crayon-e">def </span><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-144"><span class="crayon-h"> </span><span class="crayon-p"># plot the entire dataset in blue</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-145"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-146"><span class="crayon-h"> </span><span class="crayon-p"># plot the forecasts in red</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-147"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-148"><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-149"><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">off_s</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-150"><span class="crayon-h"> </span><span class="crayon-v">xaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">off_s</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">off_e</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-151"><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">off_s</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-152"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">xaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yaxis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'red'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-153"><span class="crayon-h"> </span><span class="crayon-p"># show the plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-154"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-155"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-156"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-157"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-158"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-159"><span class="crayon-v">n_lag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-160"><span class="crayon-v">n_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-161"><span class="crayon-v">n_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-162"><span class="crayon-v">n_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1500</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-163"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-164"><span class="crayon-v">n_neurons</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-165"><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-166"><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">prepare_data</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-167"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-168"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_neurons</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-169"><span class="crayon-p"># make forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-170"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">make_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-171"><span class="crayon-p"># inverse transform forecasts and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-172"><span class="crayon-v">forecasts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-173"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-v">n_lag</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-174"><span class="crayon-v">actual</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-175"><span class="crayon-p"># evaluate forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-176"><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_lag</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_seq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659102ab60c927220912-177"><span class="crayon-p"># plot forecasts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab60c927220912-178"><span class="crayon-e">plot_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">forecasts</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_test</span><span class="crayon-o">+</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0147 seconds] -->
<p>Running the example first prints the RMSE for each of the forecasted time steps.</p>
<p>We can see that the scores at each forecasted time step are better, in some cases much better, than the persistence forecast.</p>
<p>This shows that the configured LSTM does have skill on the problem.</p>
<p>It is interesting to note that the RMSE does not become progressively worse with the length of the forecast horizon, as would be expected. This is marked by the fact that the t+2 appears easier to forecast than t+1. This may be because the downward tick is easier to predict than the upward tick noted in the series (this could be confirmed with more in-depth analysis of the results).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102ab612031326108" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
t+1 RMSE: 95.973221
t+2 RMSE: 78.872348
t+3 RMSE: 105.613951</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102ab612031326108-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102ab612031326108-2">2</div><div class="crayon-num" data-line="crayon-5a659102ab612031326108-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102ab612031326108-1">t+1 RMSE: 95.973221</div><div class="crayon-line crayon-striped-line" id="crayon-5a659102ab612031326108-2">t+2 RMSE: 78.872348</div><div class="crayon-line" id="crayon-5a659102ab612031326108-3">t+3 RMSE: 105.613951</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the series (blue) with the forecasts (red) is also created.</p>
<p>The plot shows that although the skill of the model is better, some of the forecasts are not very good and that there is plenty of room for improvement.</p>
<div class="wp-caption aligncenter" id="attachment_3989" style="max-width: 650px"><img alt="Line Plot of Shampoo Sales Dataset with Multi-Step LSTM Forecasts" class="size-full wp-image-3989" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-LSTM-Forecasts.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-LSTM-Forecasts.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Shampoo-Sales-Dataset-with-Multi-Step-LSTM-Forecasts-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Shampoo Sales Dataset with Multi-Step LSTM Forecasts</p></div>
<h2>Extensions</h2>
<p>There are some extensions you may consider if you are looking to push beyond this tutorial.</p>
<ul>
<li><strong>Update LSTM</strong>. Change the example to refit or update the LSTM as new data is made available. A 10s of training epochs should be sufficient to retrain with a new observation.</li>
<li><strong>Tune the LSTM</strong>. Grid search some of the LSTM parameters used in the tutorial, such as number of epochs, number of neurons, and number of layers to see if you can further lift performance.</li>
<li><strong>Seq2Seq</strong>. Use the encoder-decoder paradigm for LSTMs to forecast each sequence to see if this offers any benefit.</li>
<li><strong>Time Horizon</strong>. Experiment with forecasting different time horizons and see how the behavior of the network varies at different lead times.</li>
</ul>
<p>Did you try any of these extensions?<br/>
Share your results in the comments; I’d love to hear about it.</p>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop LSTM networks for multi-step time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop a persistence model for multi-step time series forecasting.</li>
<li>How to develop an LSTM network for multi-step time series forecasting.</li>
<li>How to evaluate and plot the results from multi-step time series forecasting.</li>
</ul>
<p>Do you have any questions about multi-step time series forecasting with LSTMs?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fmulti-step-time-series-forecasting-long-short-term-memory-networks-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/&amp;summary=The+Long+Short-Term+Memory+network+or+LSTM+is+a+recurrent+neural+network+that+can+learn+and+forecast..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Multi-step%20Time%20Series%20Forecasting%20with%20Long%20Short-Term%20Memory%20Networks%20in%20Python&amp;url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/&amp;summary=The+Long+Short-Term+Memory+network+or+LSTM+is+a+recurrent+neural+network+that+can+learn+and+forecast...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Convert a Time Series to a Supervised Learning Problem in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/" rel="next">Demonstration of Memory with a Long Short-Term Memory Network in Python <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">165 Responses to <em>Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-399242">
<div class="comment-container" id="li-comment-399242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Masum</span>
<span class="date">May 10, 2017 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks </p>
<p>you are the best </p>
<p>Did not had to wait for long. Asked for it in different blog  few days back</p>
<div class="reply">
<a aria-label="Reply to Masum" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399242#respond" onclick='return addComment.moveForm( "comment-399242", "399242", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-399261">
<div class="comment-container" id="li-comment-399261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2017 at 8:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I hope you find the post useful!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399261#respond" onclick='return addComment.moveForm( "comment-399261", "399261", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-399264">
<div class="comment-container" id="li-comment-399264">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Masum</span>
<span class="date">May 10, 2017 at 9:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399264" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe so. Things are getting deeper here.</p>
<p>Will we get recursive LSTM MODEL for multi step forecasting soon?</p>
<p>Will eagerly wait for that blog. </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Masum" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399264#respond" onclick='return addComment.moveForm( "comment-399264", "399264", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-399346">
<div class="comment-container" id="li-comment-399346">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 11, 2017 at 8:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399346" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399346#respond" onclick='return addComment.moveForm( "comment-399346", "399346", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-399363">
<div class="comment-container" id="li-comment-399363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Masum</span>
<span class="date">May 11, 2017 at 8:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir, </p>
<p>Hope to see that soon.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-4" id="comment-418087">
<div class="comment-container" id="li-comment-418087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/877c4d76e64eae9a13c746d5c0f17186?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/877c4d76e64eae9a13c746d5c0f17186?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="external nofollow">Xingying</a></span>
<span class="date">October 27, 2017 at 10:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-418087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Masum,<br/>
I’m studying LSTM on website( <a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a> )and found you on message board. Do you have any idea about Muti-step forecast? I run the code of the tutorial, but always got a over-fitting results using the history data.</p>
<p>Thank you and looking forward for your reply.</p>
<div class="reply">
<a aria-label="Reply to Xingying" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=418087#respond" onclick='return addComment.moveForm( "comment-418087", "418087", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-399827">
<div class="comment-container" id="li-comment-399827">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">May 17, 2017 at 1:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399827" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks a lot for this post. I was trying to make this for my thesis since september, with no well results. But I’m having trouble: I’m not able to compile. Maybe you or someone who reads this is able to tell me why this happens: I’m getting the following error when running the code:</p>
<p>The TensorFlow library wasn’t compiled to use SSE instructions, but these are available on your machine and could speed up CPU computations.</p>
<p>The TensorFlow library wasn’t compiled to use SSE2 instructions, but these are available on your machine and could speed up CPU computations.</p>
<p>The TensorFlow library wasn’t compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.<br/>
.<br/>
The TensorFlow library wasn’t compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.</p>
<p>The TensorFlow library wasn’t compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.</p>
<p>The TensorFlow library wasn’t compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.</p>
<p>Obviously it has something to do with Tensorflow (I have read about this problem and I think its becase is not installed on source, but have no idea about how to fix it).</p>
<p>Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399827#respond" onclick='return addComment.moveForm( "comment-399827", "399827", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-399859">
<div class="comment-container" id="li-comment-399859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 17, 2017 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>These are warnings that you can ignore.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399859#respond" onclick='return addComment.moveForm( "comment-399859", "399859", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-399898">
<div class="comment-container" id="li-comment-399898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shamsul</span>
<span class="date">May 17, 2017 at 9:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir,</p>
<p>Can we say that multiple output strategy ( avoiding 1.direct, 2. Recursive, 3.direct recursive hybrid strategies) have been used here ?</p>
<p>Am I right ?</p>
<div class="reply">
<a aria-label="Reply to Shamsul" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399898#respond" onclick='return addComment.moveForm( "comment-399898", "399898", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-399933">
<div class="comment-container" id="li-comment-399933">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 18, 2017 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399933" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the LSTM has implemented a direct strategy.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399933#respond" onclick='return addComment.moveForm( "comment-399933", "399933", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426433">
<div class="comment-container" id="li-comment-426433">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shamsul</span>
<span class="date">January 14, 2018 at 12:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-426433" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir,<br/>
     what can be done to make it iterative strategy? any example of code would be great.</p>
<div class="reply">
<a aria-label="Reply to shamsul" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=426433#respond" onclick='return addComment.moveForm( "comment-426433", "426433", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399944">
<div class="comment-container" id="li-comment-399944">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0f3c9fc72f05ff6b758a35aa93460b1a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0f3c9fc72f05ff6b758a35aa93460b1a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jinhua zhang</span>
<span class="date">May 18, 2017 at 11:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399944" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,Jason,<br/>
 Your article is very useful! I have a problem, if the  data series are three-dimensional data, the 2th  line is the put -in data,and the 3th line is the forecasting data(all include the train and test data ),Do they can run the” difference”and “tansform”?<br/>
 Thank you very much!</p>
<div class="reply">
<a aria-label="Reply to jinhua zhang" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399944#respond" onclick='return addComment.moveForm( "comment-399944", "399944", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400004">
<div class="comment-container" id="li-comment-400004">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2017 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400004" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>You may want to only make the prediction variable stationary. Consider perform three tests:</p>
<p>– Model as-is<br/>
– Model with output variable stationary<br/>
– Model with all variables stationary (if others are non-stationary)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400004#respond" onclick='return addComment.moveForm( "comment-400004", "400004", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-400212">
<div class="comment-container" id="li-comment-400212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">May 21, 2017 at 10:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have discovered how to do it by asking some people. The object series is actually a Pandas Series. It’s a vector of information, with a named index. Your dataset, however, contains two fields of information, in addition to the time series index, which makes it a DataFrame. This is the reason why the tutorial code breaks with your data.</p>
<p>To pass your entire dataset to MinMaxScaler, just run difference() on both columns and pass in the transformed vectors for scaling.  MinMaxScaler accepts an n-dimensional DataFrame object:</p>
<p>ncol = 2<br/>
diff_df = pd.concat([difference(df[i], 1) for i in range(1,ncol+1)], axis=1)<br/>
scaler = MinMaxScaler(feature_range=(0, 1))<br/>
scaled_values = scaler.fit_transform(diff_df)</p>
<p>So, with this, we can use as many variables as we want. But now I have a big doubt.</p>
<p>When the transform or dataset into a supervised learning problem, we have a distribution in columns as shown in <a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<p>I mean, for a 2 variables dataset as yours, we can set, for example, this values:</p>
<p>n_lags=1<br/>
n_seq=2</p>
<p>so we will have a supervised dataset like this:</p>
<p>var1(t-1) var2(t-1) var1(t) var2 (t) var1(t+1) var2 (t+1)</p>
<p>so, if we want to train the ANN to forecast var2 (which is the target we want to predict) with the var1 as input and the previous values of var2 also as input, we have to separate them and here is where my doubt begins.</p>
<p>In the part of the code:</p>
<p>def fit_lstm(train, n_lag, n_seq, n_batch, nb_epoch, n_neurons):<br/>
    # reshape training into [samples, timesteps, features]<br/>
    X, y = train[:, 0:n_lag], train[:, n_lag:]<br/>
    X = X.reshape(X.shape[0], 1, X.shape[1])</p>
<p>I think that if we want to define X, we should use:</p>
<p>X=train[:,0:n_lag*n_vars]</p>
<p>this means we are selecting this as X from the previous example:</p>
<p>var1(t-1) var2(t-1)</p>
<p>(number of lags*number of variables), so: X=train[:,0:1*2]=train[:,0:2]</p>
<p>but…</p>
<p>Y=train[:,n_lag*n_vars:] is the vector of ¿targets?</p>
<p>the problem is that, on this way, we are selecting this as targets:</p>
<p>var1(t) var2(t) var1(t+1) var2(t+1) </p>
<p> so we are including var1 (which we don’t have the aim to forecast, just use as input).</p>
<p>I would like to know if there is any solution to solve this in order to use the variable 1,2…n-1 just as input but not forecasting it.</p>
<p>Hope this is clear :/</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400212#respond" onclick='return addComment.moveForm( "comment-400212", "400212", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-399987">
<div class="comment-container" id="li-comment-399987">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">May 19, 2017 at 3:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399987" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the previous clarification. I have a dubt in relation to the section “fit network” in the code. I’m having some trouble trying to plot the training graph (validation vs training) in order to see if the network is or not overfitted, but due to the “model.reset_states()” sentence, i can only save the last loss and val_loss from de history sentence. Is there any way to solve this?</p>
<p>thank you in advance 🙂</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399987#respond" onclick='return addComment.moveForm( "comment-399987", "399987", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-399988">
<div class="comment-container" id="li-comment-399988">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">May 19, 2017 at 3:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-399988" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I reply to myself, if someone is also interested.</p>
<p>Just creating 2 list (or 1, but i see it more clear on this way) and returning then on the function. Then, outside, just plot them. I’m sorry for the question, maybe the answer is obvious,  but I’m starting on python and I’m not a programmer.</p>
<p># fit network<br/>
    loss=list()<br/>
    val_loss=list()<br/>
    for i in range(nb_epoch):<br/>
        history=model.fit(X, y, epochs=1, batch_size=n_batch,shuffle=True, validation_split=val_split)<br/>
        eqm=history.history[‘loss’]<br/>
        eqm_val=history.history[‘val_loss’]<br/>
        loss.append(eqm)<br/>
        val_loss.append(eqm_val)<br/>
        model.reset_states()</p>
<p>    return model,loss,val_loss</p>
<p># fit model<br/>
model,loss,val_loss=fit_lstm(train, n_lag, n_seq, n_batch, n_epochs, n_neurons)</p>
<p>pyplot.figure()<br/>
pyplot.plot(loss)<br/>
pyplot.plot(val_loss)<br/>
pyplot.title(‘cross validation’)<br/>
pyplot.ylabel(‘MSE’)<br/>
pyplot.xlabel(‘epoch’)<br/>
pyplot.legend([‘training’, ‘test’], loc=’upper left’)<br/>
pyplot.show()</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=399988#respond" onclick='return addComment.moveForm( "comment-399988", "399988", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-400016">
<div class="comment-container" id="li-comment-400016">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2017 at 8:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400016" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice to see you got there jvr, well done.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400016#respond" onclick='return addComment.moveForm( "comment-400016", "400016", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400015">
<div class="comment-container" id="li-comment-400015">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2017 at 8:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400015" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>History is returned when calling model.fit(). </p>
<p>We are only fitting one epoch at a time, so you can retrieve and accumulate performance each epoch in the epoch loop then do something with the data (save/graph/return it) at the end of the loop.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400015#respond" onclick='return addComment.moveForm( "comment-400015", "400015", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-400054">
<div class="comment-container" id="li-comment-400054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">May 19, 2017 at 9:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It does help, thank you.</p>
<p>Now I’m trying to find a way to make the training process faster and reduce RMSE, but it’s pretty dificult (the idea is to make results better than in the NARx model implemented in the Matlab Neural Toolbox, but results and computational time are hard to overcome).</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400054#respond" onclick='return addComment.moveForm( "comment-400054", "400054", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-400092">
<div class="comment-container" id="li-comment-400092">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 20, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-400092" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs often need to be trained longer than you think and can greatly benefit from regularization.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=400092#respond" onclick='return addComment.moveForm( "comment-400092", "400092", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-401071">
<div class="comment-container" id="li-comment-401071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d9fe9d6b16b02e331ee6f85cfcf0628f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d9fe9d6b16b02e331ee6f85cfcf0628f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DJ</span>
<span class="date">June 2, 2017 at 1:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Thanks for the great tutorial, I’m wondering if you can help me clarify the reason you have<br/>
<code></code><code><br/>
model.reset_states()<br/>
</code><code></code><br/>
(line 83)<br/>
when fitting the model, I was able to achieve similar results without the line as well.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to DJ" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401071#respond" onclick='return addComment.moveForm( "comment-401071", "401071", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401239">
<div class="comment-container" id="li-comment-401239">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 1:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401239" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It clears the internal state of the LSTM.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401239#respond" onclick='return addComment.moveForm( "comment-401239", "401239", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-411754">
<div class="comment-container" id="li-comment-411754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">anurag</span>
<span class="date">August 30, 2017 at 3:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have tried experimenting with and without mode.reset_states(), using some other dataset.<br/>
I am doing multistep prediction for 6-10 steps, I am able to get better results without model.reset_states().</p>
<p>Am i doing something wrong, or it completely depends on dataset to dataset.</p>
<p>Thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to anurag" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411754#respond" onclick='return addComment.moveForm( "comment-411754", "411754", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-411764">
<div class="comment-container" id="li-comment-411764">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2017 at 4:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411764" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It completely depends on the dataset and the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411764#respond" onclick='return addComment.moveForm( "comment-411764", "411764", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-411919">
<div class="comment-container" id="li-comment-411919">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">anurag</span>
<span class="date">August 31, 2017 at 6:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411919" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you so much. 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-401259">
<div class="comment-container" id="li-comment-401259">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d9fe9d6b16b02e331ee6f85cfcf0628f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d9fe9d6b16b02e331ee6f85cfcf0628f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DJ</span>
<span class="date">June 2, 2017 at 4:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401259" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the quick reply Jason :-). I’ve seen other places where reset is done by using callbacks parameter in model.fit.</p>
<p><code></code><code><br/>
class ResetStatesCallback(Callback):<br/>
    def __init__(self):<br/>
        self.counter = 0</code></p>
<p>    def on_batch_begin(self, batch, logs={}):<br/>
        if self.counter % max_len == 0:<br/>
            self.model.reset_states()<br/>
        self.counter += 1<br/>
<code></code></p>
<p>Then the callback is used by as follows:</p>
<p><code></code><code><br/>
model.fit(X, y, epochs=1, batch_size=1, verbose=2,<br/>
                    shuffle=False, callbacks=[ResetStatesCallback()])<br/>
</code><code></code></p>
<p>The ResetStatesCallback snippet was obtained from:<br/>
<a href="http://philipperemy.github.io/keras-stateful-lstm/" rel="nofollow">http://philipperemy.github.io/keras-stateful-lstm/</a></p>
<p>Please let me know what you think.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to DJ" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401259#respond" onclick='return addComment.moveForm( "comment-401259", "401259", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401310">
<div class="comment-container" id="li-comment-401310">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 3, 2017 at 7:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401310" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, there are many ways to implement the reset. Use what works best for your application.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401310#respond" onclick='return addComment.moveForm( "comment-401310", "401310", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-401264">
<div class="comment-container" id="li-comment-401264">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ea52c32c2cc14ed65e920d81a644514f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ea52c32c2cc14ed65e920d81a644514f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">QQ</span>
<span class="date">June 2, 2017 at 5:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401264" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, greate post, and I have some questions:</p>
<p>1. in your fit_lstm function, you reset each epoch state, why?<br/>
2. why you iterate each epoch by yourself, instead of using model.fit(X, y, epochs)</p>
<p>thx Jason</p>
<p># fit an LSTM network to training data<br/>
def fit_lstm(train, n_lag, n_seq, n_batch, nb_epoch, n_neurons):<br/>
	# reshape training into [samples, timesteps, features]<br/>
	X, y = train[:, 0:n_lag], train[:, n_lag:]<br/>
	X = X.reshape(X.shape[0], 1, X.shape[1])<br/>
	# design network<br/>
	model = Sequential()<br/>
	model.add(LSTM(n_neurons, batch_input_shape=(n_batch, X.shape[1], X.shape[2]), stateful=True))<br/>
	model.add(Dense(y.shape[1]))<br/>
	model.compile(loss=’mean_squared_error’, optimizer=’adam’)<br/>
	# fit network<br/>
	for i in range(nb_epoch):<br/>
		model.fit(X, y, epochs=1, batch_size=n_batch, verbose=0, shuffle=False)<br/>
		model.reset_states()<br/>
	return model</p>
<div class="reply">
<a aria-label="Reply to QQ" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401264#respond" onclick='return addComment.moveForm( "comment-401264", "401264", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401313">
<div class="comment-container" id="li-comment-401313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 3, 2017 at 7:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The end of the epoch is the end of the sequence and the internal state should not carry over to the start of the sequence on the next epoch.</p>
<p>I run the epochs manually to give fine grained control over when resets occur (by default they occur at the end of each batch).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401313#respond" onclick='return addComment.moveForm( "comment-401313", "401313", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-401697">
<div class="comment-container" id="li-comment-401697">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8ed1371b478ebe7d2d0defb6a2a615d1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8ed1371b478ebe7d2d0defb6a2a615d1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">J</span>
<span class="date">June 7, 2017 at 12:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-401697" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d like to clarify line 99 in the LSTM example:</p>
<p>—– plot_forecasts(series, forecasts, n_test+2)</p>
<p>Is the n_test + 2 == n_test + n_lag – n_seq?</p>
<p>Thanks,<br/>
J</p>
<div class="reply">
<a aria-label="Reply to J" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=401697#respond" onclick='return addComment.moveForm( "comment-401697", "401697", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-402644">
<div class="comment-container" id="li-comment-402644">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7fc0968b4908cfb745ef0c6c2252c5d9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jvr</span>
<span class="date">June 15, 2017 at 11:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402644" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d also like to know why using n_test + 2</p>
<div class="reply">
<a aria-label="Reply to jvr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402644#respond" onclick='return addComment.moveForm( "comment-402644", "402644", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408874">
<div class="comment-container" id="li-comment-408874">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d97aa3312c990e9d435c2dd708819a67?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d97aa3312c990e9d435c2dd708819a67?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">M</span>
<span class="date">August 8, 2017 at 3:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408874" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I thought it should be n_test + 2 ==  n_test+n_seq-1 (regardless of n_seq). It would be great if someone could clarify that.</p>
<div class="reply">
<a aria-label="Reply to M" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408874#respond" onclick='return addComment.moveForm( "comment-408874", "408874", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-415600">
<div class="comment-container" id="li-comment-415600">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7ed058d424bedbfdc4eab4743ad6f604?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7ed058d424bedbfdc4eab4743ad6f604?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mrtn</span>
<span class="date">October 4, 2017 at 8:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415600" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>M, you are right. Otherwise the RMS is incorrectly calculated and plotting is not aligned.</p>
<div class="reply">
<a aria-label="Reply to Mrtn" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415600#respond" onclick='return addComment.moveForm( "comment-415600", "415600", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-402118">
<div class="comment-container" id="li-comment-402118">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kao</span>
<span class="date">June 10, 2017 at 5:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402118" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,<br/>
    When I applied your code into a 22-year daily time series, I find out that the LSTM forecast result is similar to persistence one, i.e. the red line is just a horizontal bar. I’m sure I did not mess those two methods, I wonder what cause this?</p>
<p>My key configure as follows:<br/>
n_lag = 1<br/>
n_seq = 3<br/>
n_test = 365*3</p>
<p>and my series length is 8035.</p>
<div class="reply">
<a aria-label="Reply to Kao" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402118#respond" onclick='return addComment.moveForm( "comment-402118", "402118", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402174">
<div class="comment-container" id="li-comment-402174">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 11, 2017 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402174" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to tune the model to your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402174#respond" onclick='return addComment.moveForm( "comment-402174", "402174", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-403765">
<div class="comment-container" id="li-comment-403765">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kao</span>
<span class="date">June 25, 2017 at 6:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403765" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks to your tutorial, I’ve been tuning the parameters such as numbers of epochs and neurons these days. However, I noticed that  you mentioned the grid search method to get appropriate parameters, could you please explain how to implement it into LSTM? I’m confused about your examples on some other tutorial which has a model class, seems unfamiliar to me.</p>
<div class="reply">
<a aria-label="Reply to Kao" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403765#respond" onclick='return addComment.moveForm( "comment-403765", "403765", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-403810">
<div class="comment-container" id="li-comment-403810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2017 at 6:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this example on how to grid search with LSTMs manually:<br/>
<a href="http://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403810#respond" onclick='return addComment.moveForm( "comment-403810", "403810", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-404018">
<div class="comment-container" id="li-comment-404018">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/606eddd4f2ccf66bdaa8d0560336cb0d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kao</span>
<span class="date">June 28, 2017 at 1:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-404018" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’ve just finished one test. What does it mean if error oscillates violently with epochs increasing instead of steady diminishing? Can I tune the model better, or LSTM is incapable of this time series?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-404054">
<div class="comment-container" id="li-comment-404054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 28, 2017 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-404054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You may need a larger model (more layers and or more neurons).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-402332">
<div class="comment-container" id="li-comment-402332">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">MM</span>
<span class="date">June 13, 2017 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402332" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,</p>
<p>Thank you for these tutorials. These are the best tutorials on the web. One question: what is the best way to forecast the last two values?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to MM" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402332#respond" onclick='return addComment.moveForm( "comment-402332", "402332", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402358">
<div class="comment-container" id="li-comment-402358">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 13, 2017 at 8:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402358" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks MM.</p>
<p>No one can tell you the “best” way to do anything in applied machine learning, you must discover it through trial and error on your specific problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402358#respond" onclick='return addComment.moveForm( "comment-402358", "402358", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-402361">
<div class="comment-container" id="li-comment-402361">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">MM</span>
<span class="date">June 13, 2017 at 9:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402361" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,</p>
<p>Understood. Let me re-phrase the question. In a practical application, one would be interested in forecasting the last data point, i.e. in the shampoo dataset, “3-12”. How would you suggest doing that?</p>
<div class="reply">
<a aria-label="Reply to MM" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402361#respond" onclick='return addComment.moveForm( "comment-402361", "402361", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-402457">
<div class="comment-container" id="li-comment-402457">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 14, 2017 at 8:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402457" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fit your model to all of the data then call predict() passing whatever lag inputs your model requires.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402457#respond" onclick='return addComment.moveForm( "comment-402457", "402457", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-402367">
<div class="comment-container" id="li-comment-402367">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/40b6d08ddc7b70fe05998a33e30f4921?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">MM</span>
<span class="date">June 13, 2017 at 10:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-402367" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason,</p>
<p>Should the line that starts the offset point in plot_forecasts() be </p>
<p>off_s = len(series) – n_test + i + 1</p>
<p>not</p>
<p>off_s = len(series) – n_test + i – 1</p>
<div class="reply">
<a aria-label="Reply to MM" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=402367#respond" onclick='return addComment.moveForm( "comment-402367", "402367", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403240">
<div class="comment-container" id="li-comment-403240">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">June 21, 2017 at 4:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403240" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for your excellent tutorials! </p>
<p>I have followed a couple of your articles about LSTM and did learn a lot, but here is a question in my mind: can I introduce some interference elements in the model? For example for shampoo sale problem, there may be some data about holiday sales, or sales data after an incident happens. If I want to make prediction for sales after those incidents, what can I do?</p>
<p>What’s more, I noticed that you will parse date/time with a parser, but you did not really introduce time feature into the model. For example I want to make prediction for next Monday or next January, how can I feed time feature?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403240#respond" onclick='return addComment.moveForm( "comment-403240", "403240", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403268">
<div class="comment-container" id="li-comment-403268">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2017 at 8:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403268" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, see this post for ideas on adding additional features:<br/>
<a href="http://machinelearningmastery.com/basic-feature-engineering-time-series-data-python/" rel="nofollow">http://machinelearningmastery.com/basic-feature-engineering-time-series-data-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403268#respond" onclick='return addComment.moveForm( "comment-403268", "403268", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-403437">
<div class="comment-container" id="li-comment-403437">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">June 22, 2017 at 5:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403437" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for clarification.</p>
<p>I have two more specific questions:<br/>
1) In inverse_transform, why index = len(series) – n_test + i – 1?</p>
<p>2) In fit_lstm, you said “reshape training into [samples, timesteps, features]”, but I think the code in line 74 is a little different from your format:</p>
<p>73	X, y = train[:, 0:n_lag], train[:, n_lag:]<br/>
74	X = X.reshape(X.shape[0], 1, X.shape[1]) </p>
<p>In line 74, I think it should be X = X.reshape(X.shape[0], X.shape[1], 1)</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403437#respond" onclick='return addComment.moveForm( "comment-403437", "403437", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-403506">
<div class="comment-container" id="li-comment-403506">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 23, 2017 at 6:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403506" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Michael,</p>
<p>Yes, the offset finds one step prior to the forecast in the original time series. I use this motif throughout the tutorial.</p>
<p>In the very next line I say: “We will fix time steps at 1, so this change is straightforward.”</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403506#respond" onclick='return addComment.moveForm( "comment-403506", "403506", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-403438">
<div class="comment-container" id="li-comment-403438">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">June 22, 2017 at 6:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403438" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I would like to know how to do short term and long term prediction with minimum number of models?</p>
<p>For example, I have a 12-step input and 12-step output model A, and a 12-step input and 1-step output model B, would model A gives better prediction for next first time step than model B?</p>
<p>What’s more, if we have 1-step input and 1-step output model, it is more error prone to long term prediction.<br/>
if we have multi-step input and 1-step output mode it is still more more error prone long term. So how to regard the long term and short term prediction?</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403438#respond" onclick='return addComment.moveForm( "comment-403438", "403438", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403507">
<div class="comment-container" id="li-comment-403507">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 23, 2017 at 6:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403507" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend developing and evaluating each model for the different uses cases. LSTMs are quite resistant to assumptions and rules of thumb I find in practice.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403507#respond" onclick='return addComment.moveForm( "comment-403507", "403507", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403744">
<div class="comment-container" id="li-comment-403744">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d8caa6d1b47c6722a15352484fcaa4de?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d8caa6d1b47c6722a15352484fcaa4de?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jzx</span>
<span class="date">June 25, 2017 at 1:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403744" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, thanks for your tutorial<br/>
If my prediction model is three time series a, b, c, I would like to use a, b, c to predict the future a, how can I build my LSTM model.<br/>
thank you very much!</p>
<div class="reply">
<a aria-label="Reply to jzx" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403744#respond" onclick='return addComment.moveForm( "comment-403744", "403744", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403806">
<div class="comment-container" id="li-comment-403806">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2017 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403806" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Each of a, b, and c would be input features. Remember, the shape or dimensions of input data is [samples, timesteps, features].</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403806#respond" onclick='return addComment.moveForm( "comment-403806", "403806", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-403860">
<div class="comment-container" id="li-comment-403860">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2fae07666502ea3a71e4a38e49246f6f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2fae07666502ea3a71e4a38e49246f6f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kedar</span>
<span class="date">June 26, 2017 at 6:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403860" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does stationarizing data really help the LSTM? If so, what is the intuition behind that? I mean, I can understand that for ARIMA-like methods, but why for LSTM’s?</p>
<div class="reply">
<a aria-label="Reply to Kedar" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403860#respond" onclick='return addComment.moveForm( "comment-403860", "403860", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403939">
<div class="comment-container" id="li-comment-403939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 27, 2017 at 8:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-403939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes in my experience, namely because it is a simpler prediction problem.</p>
<p>I would suggest trying a few different “views” of your sequence and see what is easiest to model / gets the best model skill.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=403939#respond" onclick='return addComment.moveForm( "comment-403939", "403939", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-404098">
<div class="comment-container" id="li-comment-404098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/03423046990ce7c3c13e0f833ad65517?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">June 28, 2017 at 5:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-404098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I want to train a model with the following input size: [6000, 4, 2] ([samples, timestamps, features])</p>
<p>For example, I want to predict shampoo’s sale in next two years. If I have other feature like economy index of every year, can I concatenate sale data and index data in the above format? So my input will be a 3d vector. How should I modify the model to train?</p>
<p>I always get such error: ValueError: Error when checking target: expected dense_1 to have 2 dimensions, but got array with shape (6000, 2, 2).</p>
<p>The error comes from this line: model.fit(X, y, epochs=1, batch_size=n_batch, verbose=0, shuffle=False). Can you provide some advices? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=404098#respond" onclick='return addComment.moveForm( "comment-404098", "404098", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404172">
<div class="comment-container" id="li-comment-404172">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 29, 2017 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-404172" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Reshape your data to be [6000, 4, 2]</p>
<p>Update the input shape of the network to be (4,2)</p>
<p>Adjust the length of the output sequence you want to predict.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=404172#respond" onclick='return addComment.moveForm( "comment-404172", "404172", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-405498">
<div class="comment-container" id="li-comment-405498">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">shamsul</span>
<span class="date">July 11, 2017 at 11:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405498" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir, </p>
<p>To make one forecast with an LSTM, if we write</p>
<p>oneforecast = forecast_lstm(model, X, n_batch)</p>
<p>it says: undefined X</p>
<p>what should be the value of X? we know the model and n_batch value?</p>
<p>would you help?</p>
<div class="reply">
<a aria-label="Reply to shamsul" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405498#respond" onclick='return addComment.moveForm( "comment-405498", "405498", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405590">
<div class="comment-container" id="li-comment-405590">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2017 at 9:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405590" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>X would be the input sequence required to make a prediction, e.g. lag obs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405590#respond" onclick='return addComment.moveForm( "comment-405590", "405590", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-405583">
<div class="comment-container" id="li-comment-405583">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">July 12, 2017 at 8:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405583" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir,</p>
<p>what if I want to tell the model to learn from train data (23 samples here) and want to forecast only 3 steps forward (Jan, Feb, Mar). I want to avoid persistence model in this case and only require 3 step direct strategy. hope you got that.</p>
<p>any help would be grateful.</p>
<p>tarin (past data)= forecast (Jan, Feb, Mar)</p>
<div class="reply">
<a aria-label="Reply to masum" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405583#respond" onclick='return addComment.moveForm( "comment-405583", "405583", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405612">
<div class="comment-container" id="li-comment-405612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 12, 2017 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps I misunderstand, but this is the model presented in the tutorial. It predicts 3 time steps ahead.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405612#respond" onclick='return addComment.moveForm( "comment-405612", "405612", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-405619">
<div class="comment-container" id="li-comment-405619">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">July 12, 2017 at 11:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405619" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p># evaluate the persistence model<br/>
def make_forecasts(model, n_batch, train, test, n_lag, n_seq):<br/>
	forecasts = list()<br/>
	for i in range(len(test)):<br/>
		X, y = test[i, 0:n_lag], test[i, n_lag:]<br/>
		# make forecast<br/>
		forecast = forecast_lstm(model, X, n_batch)<br/>
		# store the forecast<br/>
		forecasts.append(forecast)<br/>
	return forecasts</p>
<p>here if i would like to make only one forecast for 3 steps (jan,feb,march) what i have to change. i do not need the rest of the month(april, may, june, july,aug,……dec). one predictions or forecast for 3 steps.</p>
<p>hope you got me</p>
<div class="reply">
<a aria-label="Reply to masum" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405619#respond" onclick='return addComment.moveForm( "comment-405619", "405619", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-405714">
<div class="comment-container" id="li-comment-405714">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405714" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Pass in only what is required to make the prediction for those 3 months.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=405714#respond" onclick='return addComment.moveForm( "comment-405714", "405714", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-405733">
<div class="comment-container" id="li-comment-405733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84905e579844e37349b4a0951642b6b7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">July 13, 2017 at 10:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-405733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sir,</p>
<p>will be kind enough to simplify a little bit more.</p>
<p>I did not get it.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-407068">
<div class="comment-container" id="li-comment-407068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Devakar Kumar Verma</span>
<span class="date">July 24, 2017 at 4:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am getting an error while parsing the date at time of loading the data from csv file.<br/>
The error is:<br/>
 ValueError: time data ‘1901-Jan’ does not match format ‘%Y-%m’</p>
<p>Anyone please help me to resolve this issue.</p>
<div class="reply">
<a aria-label="Reply to Devakar Kumar Verma" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407068#respond" onclick='return addComment.moveForm( "comment-407068", "407068", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407085">
<div class="comment-container" id="li-comment-407085">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 24, 2017 at 6:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407085" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m sorry to hear that. Confirm you have copied the code exactly and the data file does not have any extra footer information.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407085#respond" onclick='return addComment.moveForm( "comment-407085", "407085", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-407915">
<div class="comment-container" id="li-comment-407915">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6992ecb6af250d66d322de9c21c0fa84?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6992ecb6af250d66d322de9c21c0fa84?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">p</span>
<span class="date">July 30, 2017 at 8:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407915" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi<br/>
I have so this problem<br/>
i have downloaded the dataset from the link in the text<br/>
i think this error has occured because the data of our csv file is not in correct format!<br/>
can anyone give us the dataset plz???</p>
<div class="reply">
<a aria-label="Reply to p" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407915#respond" onclick='return addComment.moveForm( "comment-407915", "407915", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-407957">
<div class="comment-container" id="li-comment-407957">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 31, 2017 at 8:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407957" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is the raw data ready to go:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659102afcca753034426" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
"Month","Sales"
"1-01",266.0
"1-02",145.9
"1-03",183.1
"1-04",119.3
"1-05",180.3
"1-06",168.5
"1-07",231.8
"1-08",224.5
"1-09",192.8
"1-10",122.9
"1-11",336.5
"1-12",185.9
"2-01",194.3
"2-02",149.5
"2-03",210.1
"2-04",273.3
"2-05",191.4
"2-06",287.0
"2-07",226.0
"2-08",303.6
"2-09",289.9
"2-10",421.6
"2-11",264.5
"2-12",342.3
"3-01",339.7
"3-02",440.4
"3-03",315.9
"3-04",439.3
"3-05",401.3
"3-06",437.4
"3-07",575.5
"3-08",407.6
"3-09",682.0
"3-10",475.3
"3-11",581.3
"3-12",646.9</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659102afcca753034426-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-2">2</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-4">4</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-6">6</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-8">8</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-10">10</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-12">12</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-14">14</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-16">16</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-18">18</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-20">20</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-22">22</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-24">24</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-26">26</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-28">28</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-30">30</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-32">32</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-34">34</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659102afcca753034426-36">36</div><div class="crayon-num" data-line="crayon-5a659102afcca753034426-37">37</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659102afcca753034426-1"><span class="crayon-s">"Month"</span><span class="crayon-sy">,</span><span class="crayon-s">"Sales"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-2"><span class="crayon-s">"1-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">266.0</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-3"><span class="crayon-s">"1-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">145.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-4"><span class="crayon-s">"1-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">183.1</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-5"><span class="crayon-s">"1-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">119.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-6"><span class="crayon-s">"1-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">180.3</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-7"><span class="crayon-s">"1-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">168.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-8"><span class="crayon-s">"1-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">231.8</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-9"><span class="crayon-s">"1-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">224.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-10"><span class="crayon-s">"1-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">192.8</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-11"><span class="crayon-s">"1-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">122.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-12"><span class="crayon-s">"1-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">336.5</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-13"><span class="crayon-s">"1-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">185.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-14"><span class="crayon-s">"2-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">194.3</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-15"><span class="crayon-s">"2-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">149.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-16"><span class="crayon-s">"2-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">210.1</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-17"><span class="crayon-s">"2-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">273.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-18"><span class="crayon-s">"2-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">191.4</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-19"><span class="crayon-s">"2-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">287.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-20"><span class="crayon-s">"2-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">226.0</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-21"><span class="crayon-s">"2-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">303.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-22"><span class="crayon-s">"2-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">289.9</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-23"><span class="crayon-s">"2-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">421.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-24"><span class="crayon-s">"2-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">264.5</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-25"><span class="crayon-s">"2-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">342.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-26"><span class="crayon-s">"3-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">339.7</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-27"><span class="crayon-s">"3-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">440.4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-28"><span class="crayon-s">"3-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">315.9</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-29"><span class="crayon-s">"3-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">439.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-30"><span class="crayon-s">"3-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">401.3</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-31"><span class="crayon-s">"3-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">437.4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-32"><span class="crayon-s">"3-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">575.5</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-33"><span class="crayon-s">"3-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">407.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-34"><span class="crayon-s">"3-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">682.0</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-35"><span class="crayon-s">"3-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">475.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659102afcca753034426-36"><span class="crayon-s">"3-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">581.3</span></div><div class="crayon-line" id="crayon-5a659102afcca753034426-37"><span class="crayon-s">"3-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">646.9</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407957#respond" onclick='return addComment.moveForm( "comment-407957", "407957", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-416059">
<div class="comment-container" id="li-comment-416059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aef9a7f4dd03e08964bb8bdd283f692d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aef9a7f4dd03e08964bb8bdd283f692d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dongchan</span>
<span class="date">October 9, 2017 at 9:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-416059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sir,</p>
<p>I have the same issue. How can I fix the parser to resolve this error?</p>
<div class="reply">
<a aria-label="Reply to Dongchan" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=416059#respond" onclick='return addComment.moveForm( "comment-416059", "416059", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-421777">
<div class="comment-container" id="li-comment-421777">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9f55df6183ee59ccfad286ed50f4cb56?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9f55df6183ee59ccfad286ed50f4cb56?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://suricatagrafica.cl" rel="external nofollow">manuel</a></span>
<span class="date">December 1, 2017 at 5:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-421777" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>you have choose data csv separate with “,”, if is “;” will not work</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407123">
<div class="comment-container" id="li-comment-407123">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Devakar Kumar Verma</span>
<span class="date">July 24, 2017 at 2:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407123" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>@Jason,<br/>
Data file doesn’t have any footer and i had simply copy paste the code but dateparser throwing the error. I have no idea why it is behaving strange.</p>
<div class="reply">
<a aria-label="Reply to Devakar Kumar Verma" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407123#respond" onclick='return addComment.moveForm( "comment-407123", "407123", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407211">
<div class="comment-container" id="li-comment-407211">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 25, 2017 at 9:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-407211" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have any good ideas. It may be a Python environment issue?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=407211#respond" onclick='return addComment.moveForm( "comment-407211", "407211", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-408027">
<div class="comment-container" id="li-comment-408027">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Josep</span>
<span class="date">July 31, 2017 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408027" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Great explanation again. I have a doubt about this piece of code:</p>
<p># evaluate the persistence model<br/>
def make_forecasts(model, n_batch, train, test, n_lag, n_seq):<br/>
	forecasts = list()<br/>
	for i in range(len(test)):<br/>
		X, y = test[i, 0:n_lag], test[i, n_lag:]<br/>
		# make forecast<br/>
		forecast = forecast_lstm(model, X, n_batch)<br/>
		# store the forecast<br/>
		forecasts.append(forecast)<br/>
	return forecasts</p>
<p>Why do you pass the parameter “n_seq” to the function if it has no use inside the function?</p>
<div class="reply">
<a aria-label="Reply to Josep" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408027#respond" onclick='return addComment.moveForm( "comment-408027", "408027", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408087">
<div class="comment-container" id="li-comment-408087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 1, 2017 at 7:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good point, thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408087#respond" onclick='return addComment.moveForm( "comment-408087", "408087", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-408161">
<div class="comment-container" id="li-comment-408161">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nara</span>
<span class="date">August 1, 2017 at 10:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408161" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
How would I go about forecasting for a complete month. (Assuming I have daily data).<br/>
Assuming I have around 5 years data 1.8k data points to train.</p>
<p>I would like to use one year old data to forecast for the whole of next month?</p>
<p>To do this should I change the way this model is trained?<br/>
Is my understanding correct that this model tries to predict the next value by only using current value?</p>
<div class="reply">
<a aria-label="Reply to Nara" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408161#respond" onclick='return addComment.moveForm( "comment-408161", "408161", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408219">
<div class="comment-container" id="li-comment-408219">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408219" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, frame the data so that it predicts a month, then train the model.</p>
<p>The model can take as input whatever you wish, e.g. a sequence of the last month or year.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408219#respond" onclick='return addComment.moveForm( "comment-408219", "408219", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408326">
<div class="comment-container" id="li-comment-408326">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nara</span>
<span class="date">August 3, 2017 at 3:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408326" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, thanks for the reply.</p>
<p>This post really helped me.<br/>
Now the next question is how do we enhance this to consider exogenous variables while forecasting?<br/>
If I simply add exogenous variable values at this step:<br/>
train, test = supervised_values[0:-n_test], supervised_values[-n_test:], (and obviously make  appropriately changes to batch_input_shape in model fit.)<br/>
Would it help improve predictions?<br/>
What is the correct way of adding independent variables. </p>
<p>I have gone through this post of yours.<br/>
<a href="http://machinelearningmastery.com/basic-feature-engineering-time-series-data-python/" rel="nofollow">http://machinelearningmastery.com/basic-feature-engineering-time-series-data-python/</a><br/>
It was helful but how to do this using neural networks that has LSTM?<br/>
Can you please point me in the right direction?</p>
<div class="reply">
<a aria-label="Reply to Nara" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408326#respond" onclick='return addComment.moveForm( "comment-408326", "408326", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-408358">
<div class="comment-container" id="li-comment-408358">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 3, 2017 at 6:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408358" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Additional features can be provided directly to the model as new features.</p>
<p>See this post on framing the problem, then reshape the results:<br/>
<a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408358#respond" onclick='return addComment.moveForm( "comment-408358", "408358", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-408499">
<div class="comment-container" id="li-comment-408499">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kiran</span>
<span class="date">August 4, 2017 at 2:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408499" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for writing up such detailed explanations.<br/>
I am using an LSTM layer for a time series prediction problem.<br/>
Everything works fine except for when I try to use the inverse_transform to undo the scaling of my data. I get the following error: </p>
<p>ValueError: Input contains NaN, infinity or a value too large for dtype(‘float64’).</p>
<p>Not really sure how I can get past this problem. Could you please help me with this ?</p>
<div class="reply">
<a aria-label="Reply to Kiran" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408499#respond" onclick='return addComment.moveForm( "comment-408499", "408499", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408509">
<div class="comment-container" id="li-comment-408509">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 4, 2017 at 3:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408509" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks like you are tring to perform an inverse transform on NaN values.</p>
<p>Perhaps try some print statements to help track down where the NaN values are coming from.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408509#respond" onclick='return addComment.moveForm( "comment-408509", "408509", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408597">
<div class="comment-container" id="li-comment-408597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kiran</span>
<span class="date">August 5, 2017 at 12:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for the reply. Yes, there are some NaN values in my predictions. Does that indicate a badly trained model ?</p>
<div class="reply">
<a aria-label="Reply to Kiran" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408597#respond" onclick='return addComment.moveForm( "comment-408597", "408597", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-408688">
<div class="comment-container" id="li-comment-408688">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 6, 2017 at 7:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408688" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your model might be receiving NaN as input, check that. </p>
<p>It may be making NaN predictions with good input, in which case it might have had trouble during training. There are methods like gradient clipping that can address this.<br/>
<a href="https://keras.io/optimizers/" rel="nofollow">https://keras.io/optimizers/</a></p>
<p>Figure out which case it is first though.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408688#respond" onclick='return addComment.moveForm( "comment-408688", "408688", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-409594">
<div class="comment-container" id="li-comment-409594">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/507b64911f748cab508e056a66387998?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kiran</span>
<span class="date">August 14, 2017 at 11:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409594" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks ! My inputs do not have any NaN. Will check out gradient clipping.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-409635">
<div class="comment-container" id="li-comment-409635">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409635" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Let me know how you go Kiran.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-408982">
<div class="comment-container" id="li-comment-408982">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nara</span>
<span class="date">August 8, 2017 at 9:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-408982" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>When I try step by step forecast. i.e. forecast 1 point and then use this back as data and forecast the next point, my predictions become constant after just 2 steps, sometimes from the beginning itself. </p>
<p><a href="https://datascience.stackexchange.com/questions/22047/time-series-forecasting-with-rnnstateful-lstm-produces-constant-values" rel="nofollow">https://datascience.stackexchange.com/questions/22047/time-series-forecasting-with-rnnstateful-lstm-produces-constant-values</a><br/>
In detail there. Can you say why this is happening? And which forecast method is usually better. Step by step or window type forecasts?</p>
<p>Also can you comment on when can ARIMA/ linear models perform better than netowrks/RNN?</p>
<div class="reply">
<a aria-label="Reply to Nara" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=408982#respond" onclick='return addComment.moveForm( "comment-408982", "408982", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409038">
<div class="comment-container" id="li-comment-409038">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 9, 2017 at 6:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409038" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Using predictions as input is bad as the errors will compound. Only do this if you cannot get access to the real observations.</p>
<p>If your model has a linear relationship it will be better to model it with a linear model with ARIMA, the model will train faster and be simpler.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409038#respond" onclick='return addComment.moveForm( "comment-409038", "409038", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-409326">
<div class="comment-container" id="li-comment-409326">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nara</span>
<span class="date">August 11, 2017 at 10:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409326" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But that is how ARIMA models predict right?<br/>
They do point by point forecast. And from my results ARIMA(or STL ARIMA or even XGBOOST) is doing pretty well when compared to RNN. 🙁</p>
<p>But i haven’t considered stationarity and outlier treatment and I see that RNN performs pathetically when the data is non stationary/has outliers.</p>
<p>Is this expected? I have read that RNN should take care of stationarity automatically?</p>
<p>Also, will our results be bad if we do first order differencing even when there is no stationarity in the data?</p>
<p>And as for normalization, is it possible that for some cases RNN does well without normalizing?<br/>
When is normalization usually recommended? When standard deviation is huge?</p>
<div class="reply">
<a aria-label="Reply to Nara" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409326#respond" onclick='return addComment.moveForm( "comment-409326", "409326", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-409364">
<div class="comment-container" id="li-comment-409364">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 12, 2017 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409364" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have found RNNs to not perform well on autoregression problems, and they do better with more data prep (e.g. removing anything systematic). See this post:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Generally, don’t difference if you don’t need to, but test everything to be sure.</p>
<p>Standardization if the distribution is Gaussian, normalization otherwise. RNNs like LSTMs need good data scaling, MLPs less so in this age of relu.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409364#respond" onclick='return addComment.moveForm( "comment-409364", "409364", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-409434">
<div class="comment-container" id="li-comment-409434">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33206e1778ee47830dd58ea3de78c03?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nara</span>
<span class="date">August 13, 2017 at 1:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409434" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Oh then a hybrid model using residuals from ARIMA for RNN should work well 🙂 ?<br/>
The residuals will not have any seasonal components.(even scaling should be well taken care of)<br/>
Or here also do you expect MLPs to work better?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-409469">
<div class="comment-container" id="li-comment-409469">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 13, 2017 at 9:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409469" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is hard to know for sure, I recommend using experiments to collect data to know for sure, rather than guessing.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409450">
<div class="comment-container" id="li-comment-409450">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07f6a00bb20bad2674775f4325f097bf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07f6a00bb20bad2674775f4325f097bf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nights</span>
<span class="date">August 13, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409450" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think there is an issue with inverse differencing while forecasting for multistep.(to deal with non stationary data)<br/>
This example is adding previously forecasted(and inverse differenced) value to the currently forecasted value.Isn’t this method wrong when we have 30 points to forecast as it keeps adding up the results  and hence the output will continuously increase.</p>
<p>Below is the output I got.<br/>
<a href="https://ibb.co/d1oyNF" rel="nofollow">https://ibb.co/d1oyNF</a></p>
<p>Instead should I just add the last known real observation  to all the forecasted values? I dont suppose that would work either.</p>
<div class="reply">
<a aria-label="Reply to Nights" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409450#respond" onclick='return addComment.moveForm( "comment-409450", "409450", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409471">
<div class="comment-container" id="li-comment-409471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 13, 2017 at 9:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It could be an issue for long lead times, as the errors will compound.</p>
<p>If real obs are available to use for inverse differencing, you won’t need to make a forecast for such a long lead time and the issue is moot.</p>
<p>Consider contrasting model skill with and without differencing, at least as a starting point.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409471#respond" onclick='return addComment.moveForm( "comment-409471", "409471", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409575">
<div class="comment-container" id="li-comment-409575">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/23109ac0cc1caa1244c82a92e7d5b0ef?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/23109ac0cc1caa1244c82a92e7d5b0ef?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sandra</span>
<span class="date">August 14, 2017 at 5:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409575" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, thank you for your helpful tutorial. </p>
<p>I have a question regarding a seq to seq timeseries forcasting problem with multi-step lstm. </p>
<p>I have created a supervised dataset of (t-1), (t-2), (t-3)…, (t-look_back) and (t+1), (t+2), (t+3)…, (t+look_ahead) and our goal is to forcast look_ahead timesteps. </p>
<p>We have tried your complete example code of doing a dense(look_ahead) last layer but received not so good results. This was done using both a stateful and non-stateful network. </p>
<p>We then tried using Dense(1) and then repeatvector(look_ahead), and we get the same (around average) value for all the look_ahead timesteps. This was done using a non-stateful network. </p>
<p>Then I created a stepwise prediction where look_ahead = 1 always. The prediction for t+2 is then based on the history of (t+1)(t)(t-1)… This has given me better results, but only tried for non-stateful network.</p>
<p>My questions are:<br/>
– Is it possible to use repeatvector with non-stateful networks? Or must network be stateful? Do you have any idea why my predictions are all the same value?<br/>
– What do network you recommend for this type or problem? Stateful or non stateful, seq to seq or stepwise prediction? </p>
<p>Thanks in advance!<br/>
Sandra</p>
<div class="reply">
<a aria-label="Reply to Sandra" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409575#respond" onclick='return addComment.moveForm( "comment-409575", "409575", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409629">
<div class="comment-container" id="li-comment-409629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very nice work Sandra, thanks for sharing.</p>
<p>The RepeatVector is only for the Encoder-Decoder architecture to ensure that each time step in the output sequence has access the entire fixed-width encoding vector from the Encoder. It is not related to stateful or stateless models.</p>
<p>I would develop a simple MLP baseline with a vector output and challenge all LSTM architectures to beat it. I would look at a vector output on a simple LSTM and a seq2seq model. I would also try the recursive model (feed outputs as inputs for repeating a one step forecast). </p>
<p>It sounds like you’re trying all the right things.</p>
<p>Now, with all of that being said, LSTMs may not be very good at simple autoregression problems. I often find MLPs out perform LSTMs on autoregression. See this post:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>I hope that helps, let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409629#respond" onclick='return addComment.moveForm( "comment-409629", "409629", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409730">
<div class="comment-container" id="li-comment-409730">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75ec9344bf9da26d9978d65165624378?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75ec9344bf9da26d9978d65165624378?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Oscar</span>
<span class="date">August 16, 2017 at 1:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409730" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for your tutorials. I’m trying to learn ML and your webpage is very useful!</p>
<p>I’m a bit confuse with the inverse_difference function. Specifically with the last_ob that I need to pass.</p>
<p>Let’s say I have the following:</p>
<p>Raw Data           difference   scaled     Forecasted values<br/>
raw_val1=.4<br/>
raw_val2=.35        -.05          -.045       [0.80048585, 0.59788215, -0.13518856]<br/>
raw_val3=.29        -.06          -.054       [0.65341175, 0.37566081, -0.14706305]<br/>
raw_val4=.28        -.01          -.009       [[0.563694, -0.09381149, 0.03976132]</p>
<p>When passing the last_ob to the inverse_difference function which observation do I need to pass to the function, raw_val2 or raw_val1?</p>
<p>My hunch is that I need to pass raw_val2. Is that correct?</p>
<p>Also, in your example, in the line:</p>
<p>forecasts = inverse_transform(series, forecasts, scaler, n_test+2)</p>
<p>What’s the reason of this  n_test+2?</p>
<p>Thanks in advance!<br/>
Oscar</p>
<div class="reply">
<a aria-label="Reply to Oscar" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409730#respond" onclick='return addComment.moveForm( "comment-409730", "409730", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-409926">
<div class="comment-container" id="li-comment-409926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jaskaran</span>
<span class="date">August 17, 2017 at 10:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Great work. </p>
<p>I had a question. When reshaping X for lstm (samples,timesteps,features) why did you model the problem as timesteps=1 and features=X.shape[1]. Shouldn’t it be timesteps = lag window size<br/>
and the output dense layer have the size of horizon_window. This will give much better results in my opinion.</p>
<p>Here is a link which will make my question more clear:<br/>
<a href="https://stackoverflow.com/questions/42585356/how-to-construct-input-data-to-lstm-for-time-series-multi-step-horizon-with-exte" rel="nofollow">https://stackoverflow.com/questions/42585356/how-to-construct-input-data-to-lstm-for-time-series-multi-step-horizon-with-exte</a></p>
<div class="reply">
<a aria-label="Reply to Jaskaran" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409926#respond" onclick='return addComment.moveForm( "comment-409926", "409926", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409951">
<div class="comment-container" id="li-comment-409951">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 4:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-409951" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I model the problem with no timesteps and lots of features (multiple obs at the same time).</p>
<p>I found that if you frame the problem with multiple time steps for multiple features, performance was worse. Basically, we are using the LSTM as an MLP type network here. </p>
<p>LSTMs are not great at autoregression, but this post was the most requested I’ve ever had.</p>
<p>More on LSTM suitability here:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=409951#respond" onclick='return addComment.moveForm( "comment-409951", "409951", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-410008">
<div class="comment-container" id="li-comment-410008">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jaskaran</span>
<span class="date">August 18, 2017 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410008" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So Jason,</p>
<p>Correct me if I am wrong but the whole point of RNN+LSTM learning over time(hidden states depending on past values) goes moot here. </p>
<p>Essentially, this is just an autoregressive neural network. There is no storage of states over time.</p>
<div class="reply">
<a aria-label="Reply to Jaskaran" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410008#respond" onclick='return addComment.moveForm( "comment-410008", "410008", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-410027">
<div class="comment-container" id="li-comment-410027">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410027" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, there is no BPTT because we are only feeding in one time step.</p>
<p>You can add more history, but results will be worse. It turns out that LSTMs are poor at autoregression:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Nevertheless, I get a lot of people asking how to do it, so here it is.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410027#respond" onclick='return addComment.moveForm( "comment-410027", "410027", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410059">
<div class="comment-container" id="li-comment-410059">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1bed92367e213800ccc10a43fd822c01?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1bed92367e213800ccc10a43fd822c01?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hanoun</span>
<span class="date">August 18, 2017 at 11:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410059" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I try to use this example to identify the shape switch an angle , its useful to use this tutorial and how I can test the model I train it,<br/>
Regards,<br/>
Hanen</p>
<div class="reply">
<a aria-label="Reply to hanoun" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410059#respond" onclick='return addComment.moveForm( "comment-410059", "410059", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410198">
<div class="comment-container" id="li-comment-410198">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2a0b1946b7187295ed810d6121cebf2f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2a0b1946b7187295ed810d6121cebf2f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">A</span>
<span class="date">August 19, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410198" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi there – I love your blog and these tutorials! They’re really helpful.</p>
<p>I have been studying both this tutorial and this one: <a href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/</a>.<br/>
I have applied both codes to a simple dataset I’m working with (date, ROI%). Both codes run fine with my data, but I’m having a problem that has me completely stumped:</p>
<p>With this code, I’m able to actually forecast the future ROI%. With the other, it does a lot better at modeling the past data, but I can’t figure out how to get it to forecast the future. Both codes have elements I need, but I can’t seem to figure out how to bring them together.</p>
<p>Any insight would be awesome! Thank you!</p>
<div class="reply">
<a aria-label="Reply to A" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410198#respond" onclick='return addComment.moveForm( "comment-410198", "410198", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410298">
<div class="comment-container" id="li-comment-410298">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2017 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410298" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410298#respond" onclick='return addComment.moveForm( "comment-410298", "410298", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410606">
<div class="comment-container" id="li-comment-410606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f1c51aa0deaf32e66cd9754654e93351?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f1c51aa0deaf32e66cd9754654e93351?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ankit</span>
<span class="date">August 22, 2017 at 11:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, first of all, I would like to thank you for the work you’ve done. It has been tremendously helpful.</p>
<p>I have a question and seeking your expert opinion.</p>
<p>How to handle a time series data set with multiple and variable granularity input of each time step. for instance, consider the dataset like below:</p>
<p>Date | Area | Product category | Orders | Revenue | Cost </p>
<p>so, in this case, there would be multiple records for a single day aggregated on date and this is the granularity I want.</p>
<p>How should this kind of data be handled, since these features will contribute to the Revenue and Orders?</p>
<div class="reply">
<a aria-label="Reply to Ankit" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410606#respond" onclick='return addComment.moveForm( "comment-410606", "410606", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410660">
<div class="comment-container" id="li-comment-410660">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410660" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could standardize the data and feed it into one model or build separate models and combine their predictions.</p>
<p>Try a few methods and see what works best for your problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410660#respond" onclick='return addComment.moveForm( "comment-410660", "410660", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410770">
<div class="comment-container" id="li-comment-410770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">August 24, 2017 at 2:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am using this framework for my first shot at an LSTM network for monitoring network response times. The data I’m working with currently is randomly generated by simulating API calls. What I’m seeing is the LSTM seems to always predict a return to what looks like the mean of the data. Is this a function of the data being stochastic?</p>
<p>Separate question: since LSTM’s have a memory component built into the neurons, what are the advantages/disadvantages of using a larger n_in/n_lag than 1?</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410770#respond" onclick='return addComment.moveForm( "comment-410770", "410770", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410817">
<div class="comment-container" id="li-comment-410817">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-410817" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>THe problem might be too hard for your model, perhaps tune the LSTM or try another algorithm?</p>
<p>A key benefit of LSTMs is that they the lag can extend much longer than other methods, e.g. hundreds of time steps. This means you are modeling something like:</p>
<p>yhat = f(t-1, …, t-500)</p>
<p>And the model can reproduce something it saw 500 time steps ago if needed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=410817#respond" onclick='return addComment.moveForm( "comment-410817", "410817", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-411136">
<div class="comment-container" id="li-comment-411136">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">August 26, 2017 at 3:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411136" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks. I am playing with some toy data now just to make sure I’m understanding how this works.</p>
<p>I am able to model a cosine wave very nicely with a 5 neuron, 100 epoch training run against np.cos(range(100)) split into 80/20 training set. This is with the scaling, but without the difference. I feed in 10 inputs, and get 30 outputs.</p>
<p>Does calling model.predict change the model? I am calling repeatedly with the same 10 inputs and am seeing a different result each time. It looks like the predicted wave cycles through different amplitudes.</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411136#respond" onclick='return addComment.moveForm( "comment-411136", "411136", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-4" id="comment-411145">
<div class="comment-container" id="li-comment-411145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">August 26, 2017 at 4:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ah ok, I got it. Since stateful is on, I would need to do an explicit reset_states between predictions. Makes sense, I think! Stateful was useful for training, but since I won’t be “online learning” and since I feed the network lag in the features, I should not rely on state for predictions.</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411145#respond" onclick='return addComment.moveForm( "comment-411145", "411145", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-411169">
<div class="comment-container" id="li-comment-411169">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 26, 2017 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411169" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work!</p>
<p>Yes, generally scaling is important, but if your cosine wave values are in [0,1] then you’re good.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411169#respond" onclick='return addComment.moveForm( "comment-411169", "411169", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-411157">
<div class="comment-container" id="li-comment-411157">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">August 26, 2017 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411157" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a simple question. Trying to set up an a different toy problem, with data generated as y=x over 800 points (holding out the next 200 as validation). No matter how many layers, neurons, epochs that I train over, the results tend to be a that predictions start out fairly close to the line for lower values, but it diverges quickly and and approaches some fixed y=400 for higher values.</p>
<p>Do you have any ideas why this would happen?</p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411157#respond" onclick='return addComment.moveForm( "comment-411157", "411157", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-411171">
<div class="comment-container" id="li-comment-411171">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 26, 2017 at 6:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411171" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>May be error accumulating. You’re giving the LSTM a hard time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411171#respond" onclick='return addComment.moveForm( "comment-411171", "411171", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-411959">
<div class="comment-container" id="li-comment-411959">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61b233068aa86840c0dc8f64541a261?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel</span>
<span class="date">September 1, 2017 at 2:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-411959" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can I get your input on this issue I’m having? I would really like to make sure that I’m not implementing incorrectly. If there are network parameters I need to do, I can go through that exercise. But, I am not feeling confident about what I am on the right path with this problem. <a href="https://stackoverflow.com/questions/45982445/keras-lstm-time-series-multi-step-predictions-has-same-output-for-any-input" rel="nofollow">https://stackoverflow.com/questions/45982445/keras-lstm-time-series-multi-step-predictions-has-same-output-for-any-input</a></p>
<div class="reply">
<a aria-label="Reply to Daniel" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=411959#respond" onclick='return addComment.moveForm( "comment-411959", "411959", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412057">
<div class="comment-container" id="li-comment-412057">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1b14022bbc7bd33e9db1c7bbd17a272e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1b14022bbc7bd33e9db1c7bbd17a272e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lucius</span>
<span class="date">September 1, 2017 at 6:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-412057" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, there is a problem with the code. when doing data processing, i.e. calculate difference and min max scale. you should not use all data. in more real situation, you can only do this to train data. since you have no idea about test data. </p>
<p>So I changed the code, cut the last 12 month as test. then only use 24 months data for difference, min max scale, fit the model and predict for month 25, 26, 27. </p>
<p>Then I continue to use 25 months data for difference, min max scale, fit the model and predict for month 26, 27, 28.<br/>
…</p>
<p>The final result is worse than baseline.!</p>
<div class="reply">
<a aria-label="Reply to lucius" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=412057#respond" onclick='return addComment.moveForm( "comment-412057", "412057", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412111">
<div class="comment-container" id="li-comment-412111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-412111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct, this is a simplification I implemented to keep the tutorial short and understandable.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=412111#respond" onclick='return addComment.moveForm( "comment-412111", "412111", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414052">
<div class="comment-container" id="li-comment-414052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bc889007e6e9189126206d30e2955460?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bc889007e6e9189126206d30e2955460?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eldar M.</span>
<span class="date">September 17, 2017 at 1:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I was able to get slightly better results with a custom loss function (weighted mse)</p>
<p>def weighted_mse(yTrue,yPred):</p>
<p>    ones = K.ones_like(yTrue[0,:])<br/>
    idx = K.cumsum(ones)<br/>
    return K.mean((1/idx)*K.square(yTrue-yPred))</p>
<p>credit goes to Daniel Möller on Stack Overflow as I was not able to figure out the tensor modification steps on my own and he responded to my question there</p>
<div class="reply">
<a aria-label="Reply to Eldar M." class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414052#respond" onclick='return addComment.moveForm( "comment-414052", "414052", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414072">
<div class="comment-container" id="li-comment-414072">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 17, 2017 at 5:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414072" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice one! Thanks for sharing.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414072#respond" onclick='return addComment.moveForm( "comment-414072", "414072", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414580">
<div class="comment-container" id="li-comment-414580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8dcca9a5d59391a86f19aaf43aa1c4b6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8dcca9a5d59391a86f19aaf43aa1c4b6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">September 23, 2017 at 1:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>def make_forecasts(model, n_batch, train, test, n_lag, n_seq):<br/>
	forecasts = list()<br/>
	for i in range(len(test)):<br/>
		X, y = test[i, 0:n_lag], test[i, n_lag:]<br/>
		# make forecast<br/>
		forecast = forecast_lstm(model, X, n_batch)<br/>
		# store the forecast<br/>
		forecasts.append(forecast)<br/>
	return forecasts</p>
<p>What is the point of the “train” data set as parameter in this function if it is not used?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414580#respond" onclick='return addComment.moveForm( "comment-414580", "414580", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414607">
<div class="comment-container" id="li-comment-414607">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414607" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yep, looks like its not used. You can probably remove it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414607#respond" onclick='return addComment.moveForm( "comment-414607", "414607", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414663">
<div class="comment-container" id="li-comment-414663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fei</span>
<span class="date">September 24, 2017 at 1:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, It is very useful tutorial. I am starter for the python and programming. May I convert input of model into 4 or more than one variable? and change the n_batch into other number not 1?</p>
<div class="reply">
<a aria-label="Reply to Fei" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414663#respond" onclick='return addComment.moveForm( "comment-414663", "414663", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414688">
<div class="comment-container" id="li-comment-414688">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 24, 2017 at 5:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414688" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414688#respond" onclick='return addComment.moveForm( "comment-414688", "414688", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414805">
<div class="comment-container" id="li-comment-414805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/240f2281a33bd28e5baf9c98610ef0ee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fei</span>
<span class="date">September 26, 2017 at 4:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-414805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But ,When I change the n_batch size, the model does not work. By the way, you said manually to epoch of model, would you tell me the how to do it?</p>
<div class="reply">
<a aria-label="Reply to Fei" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=414805#respond" onclick='return addComment.moveForm( "comment-414805", "414805", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415099">
<div class="comment-container" id="li-comment-415099">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3a996a2b7dbd9ff2ae5b0d613af9d5f9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3a996a2b7dbd9ff2ae5b0d613af9d5f9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fabian</span>
<span class="date">September 29, 2017 at 7:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415099" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
thanks a lot for your tutorials on LSTMs.<br/>
Do you have a suggestion how to model the network for a multivariate multi-step forecast? I read your articles about multivariate and multi-step forecast, but combining both seems to be more tricky as the output of the dense layer gets a higher dimension.</p>
<p>In words of your example here: if I want to forecast not only shampoo but also toothpaste sales T time steps ahead, how can I achieve the forecast to have the dimension 2xT? Is there an alternative to the dense layer?</p>
<div class="reply">
<a aria-label="Reply to Fabian" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415099#respond" onclick='return addComment.moveForm( "comment-415099", "415099", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415160">
<div class="comment-container" id="li-comment-415160">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415160" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see. You could have two neurons in the output layer of your network, as easy as that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415160#respond" onclick='return addComment.moveForm( "comment-415160", "415160", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415176">
<div class="comment-container" id="li-comment-415176">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/72fbd8523a7607193793c77408f912b5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/72fbd8523a7607193793c77408f912b5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Camille</span>
<span class="date">September 30, 2017 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415176" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this great tutorial. Do you think this technique is applicable on the case of a many-to-many prediction?</p>
<p>A toy scenario: Imagine a machine with has 5 tuning knobs [x1, x2, x3, x4, x5] and as a result we can read 2 values [y, z] as a response to a change of any of the knobs. </p>
<p>I am wondering if I can use LSTM to predict y and z at with a single model instead of building one model for y and another for z? I am planning to follow this tutorial but I will love to hear what you think about it.</p>
<div class="reply">
<a aria-label="Reply to Camille" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415176#respond" onclick='return addComment.moveForm( "comment-415176", "415176", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415246">
<div class="comment-container" id="li-comment-415246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 1, 2017 at 9:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, LSTMs can easily be configured to support multiple input series and output a vector or parallel series.</p>
<p>For example of taking multiple series as input, see this post:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415246#respond" onclick='return addComment.moveForm( "comment-415246", "415246", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415185">
<div class="comment-container" id="li-comment-415185">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5aa0133b3aa44d5b3a335c8dc13bcab5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5aa0133b3aa44d5b3a335c8dc13bcab5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jean-Marc</span>
<span class="date">September 30, 2017 at 12:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415185" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you very much for this tutorial. I am just starting with LSTM and your series on LSTM is greatly valuable.<br/>
A question about multi-output forecasting: how to deal with a multi-output when plotting the true data versus the predicted data.<br/>
Let’s say I have a model to forecast the next 10 steps (t, t+1…,t+9).<br/>
Using the observation at time:<br/>
 –&gt; t=0, the model will give a forecast for t =1,2,3,4,5,6,7,8,9,10<br/>
and similarly, at<br/>
–&gt; t=1, a forecast will be outpout for t=2,3,4,5,6,7,8,9,10,11<br/>
etc…<br/>
There is overlap in the timestep for the forecast from t=0 and from t=1. For example, if I want to know the value at t=2, should I use the forecast from t=1 or from t=0, or a weighted average of the forecast?</p>
<p>May be using only the forecast from t=1 enough, because it already includes the history of the time series (i.e it already includes the observation at t=0).</p>
<div class="reply">
<a aria-label="Reply to Jean-Marc" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415185#respond" onclick='return addComment.moveForm( "comment-415185", "415185", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415249">
<div class="comment-container" id="li-comment-415249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 1, 2017 at 9:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure I follow. Perhaps you might be better off starting with linear models then move to an LSTM to lift skill on a framing/problem that is already working:<br/>
<a href="https://machinelearningmastery.com/start-here/#timeseries" rel="nofollow">https://machinelearningmastery.com/start-here/#timeseries</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415249#respond" onclick='return addComment.moveForm( "comment-415249", "415249", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415272">
<div class="comment-container" id="li-comment-415272">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/343fcc8e8ee10e57b6db5fc6477b6c1d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/343fcc8e8ee10e57b6db5fc6477b6c1d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mr</span>
<span class="date">October 1, 2017 at 9:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415272" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The:<br/>
return datetime.strptime(‘190’+x, ‘%Y-%m’)</p>
<p>gives me:</p>
<p>ValueError: time data ‘1901/1’ does not match format ‘%Y-%m’</p>
<p>Thanks in advance</p>
<div class="reply">
<a aria-label="Reply to mr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415272#respond" onclick='return addComment.moveForm( "comment-415272", "415272", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415305">
<div class="comment-container" id="li-comment-415305">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 2, 2017 at 9:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415305" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps confirm that you downloaded the dataset in CSV format.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415305#respond" onclick='return addComment.moveForm( "comment-415305", "415305", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415611">
<div class="comment-container" id="li-comment-415611">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a612b0984d26f0f82f8094382f1c8492?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a612b0984d26f0f82f8094382f1c8492?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">wmbm</span>
<span class="date">October 4, 2017 at 10:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415611" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So you don’t actually need to split the data into test and training sets because you don’t use the training set in this code. So this then becomes an unsupervised problem?</p>
<div class="reply">
<a aria-label="Reply to wmbm" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415611#respond" onclick='return addComment.moveForm( "comment-415611", "415611", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415652">
<div class="comment-container" id="li-comment-415652">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415652" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, it is a supervised learning model.</p>
<p>We use walk-forward validation. Learn more about it here:<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415652#respond" onclick='return addComment.moveForm( "comment-415652", "415652", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-415663">
<div class="comment-container" id="li-comment-415663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/94b87f99da014d9b8c962e2c6733798c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/94b87f99da014d9b8c962e2c6733798c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">wmbm</span>
<span class="date">October 5, 2017 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>my mistake, I was look at just the multi-step persistence model. Thanks!</p>
<div class="reply">
<a aria-label="Reply to wmbm" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415663#respond" onclick='return addComment.moveForm( "comment-415663", "415663", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-415708">
<div class="comment-container" id="li-comment-415708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2017 at 5:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-415708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=415708#respond" onclick='return addComment.moveForm( "comment-415708", "415708", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-416874">
<div class="comment-container" id="li-comment-416874">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/17e0e7dd169815d81e5e7939d1cdca34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/17e0e7dd169815d81e5e7939d1cdca34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Noah yao</span>
<span class="date">October 16, 2017 at 2:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-416874" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sorry i am confuse about the function  inverse_transform  why you use n_test+2 in the function but not n_test?</p>
<div class="reply">
<a aria-label="Reply to Noah yao" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=416874#respond" onclick='return addComment.moveForm( "comment-416874", "416874", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417278">
<div class="comment-container" id="li-comment-417278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8b49537eb0980ab5b9551b99ff0f5ce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8b49537eb0980ab5b9551b99ff0f5ce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://rrighart.github.io" rel="external nofollow">RRighart</a></span>
<span class="date">October 20, 2017 at 9:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you very much for a very nice post!</p>
<p>You explained that “A rolling-forecast scenario” will be used, also called walk-forward model validation. You said “Each time step of the test dataset will be walked one at a time. A model will be used to make a forecast for the time step, then the actual expected value for the next month from the test set will be taken and made available to the model for the forecast on the next time step”.</p>
<p>What method / algorithm would you suggest doing in the scenario there are no such test/validation data available? In other words, I have a collection of time-series data that stops at a certain point, and I need to forecast the next points.</p>
<p>Thank you very much in advance for your advice!</p>
<div class="reply">
<a aria-label="Reply to RRighart" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417278#respond" onclick='return addComment.moveForm( "comment-417278", "417278", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417333">
<div class="comment-container" id="li-comment-417333">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417333" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Above, I am describing how to evaluate a model during training. You are describing how to use a final model to make predictions on new data – after the model has been evaluated and chosen.</p>
<p>They are different activities.</p>
<p>See this post to make things clear:<br/>
<a href="https://machinelearningmastery.com/train-final-machine-learning-model/" rel="nofollow">https://machinelearningmastery.com/train-final-machine-learning-model/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417333#respond" onclick='return addComment.moveForm( "comment-417333", "417333", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417438">
<div class="comment-container" id="li-comment-417438">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6788484cf9225e1b8f685b7a704ba204?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6788484cf9225e1b8f685b7a704ba204?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Prakash Anand</span>
<span class="date">October 21, 2017 at 10:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417438" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thanks for this wonderful tutorial. I’m trying to solve a problem and wanted your input, which is something like this.  I have 2 years of sales data on daily basis with some other predictor variables as holiday, promotion etc. lets say jan 2015 to jan 2017. and i wanted to forecast for month of Feb. i was thinking in something like data preparation would be take last 60 days data as input sequence and predict next 30 time steps. Since the dataset is very small. do you think it will work?. Whats you suggestion on this. ?</p>
<div class="reply">
<a aria-label="Reply to Prakash Anand" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417438#respond" onclick='return addComment.moveForm( "comment-417438", "417438", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417477">
<div class="comment-container" id="li-comment-417477">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 22, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417477" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>TRy it.</p>
<p>Generally, predicting 30 days ahead is very hard unless you have a ton of data or the problem is relatively simple.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417477#respond" onclick='return addComment.moveForm( "comment-417477", "417477", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-417486">
<div class="comment-container" id="li-comment-417486">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6788484cf9225e1b8f685b7a704ba204?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6788484cf9225e1b8f685b7a704ba204?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Prakash Anand</span>
<span class="date">October 22, 2017 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417486" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>yeah. that’s my concern too. because the dataset is very small.</p>
<div class="reply">
<a aria-label="Reply to Prakash Anand" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417486#respond" onclick='return addComment.moveForm( "comment-417486", "417486", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417764">
<div class="comment-container" id="li-comment-417764">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7718805e142ba5221dc812ef9bbf66cf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7718805e142ba5221dc812ef9bbf66cf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bryant</span>
<span class="date">October 24, 2017 at 8:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417764" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Mr Jason<br/>
I have two questions：<br/>
1. In this example, three rmses are exported. What should I do if I want to output the three predictions for each time step and integrate all the output into a data box（Easy to observe）?<br/>
2. What if I need to do 6- months, 12-month predictions? How do I change it?<br/>
I’m sorry that my python is not very good.<br/>
thank you so much！</p>
<div class="reply">
<a aria-label="Reply to Bryant" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417764#respond" onclick='return addComment.moveForm( "comment-417764", "417764", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417826">
<div class="comment-container" id="li-comment-417826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you better understand how to make predictions with LSTMs:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417826#respond" onclick='return addComment.moveForm( "comment-417826", "417826", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417797">
<div class="comment-container" id="li-comment-417797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/960c5ddcccb0192a40571e5cb2cbe573?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/960c5ddcccb0192a40571e5cb2cbe573?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Derrick</span>
<span class="date">October 25, 2017 at 1:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I’m working through your tutorial but I’m running into an issue during the reshape in the ‘prepare_data’ function.</p>
<p>My current shape of the data that I use is as follows:<br/>
(156960, 3)</p>
<p>But the reshape in the prepare_data function tells me this:</p>
<p>ValueError                                Traceback (most recent call last)<br/>
 in ()<br/>
—-&gt; 1 train, test = prepare_data(X, 15696, 2, 4)</p>
<p> in prepare_data(series, n_test, n_lag, n_seq)<br/>
      3     # extract raw values<br/>
      4     raw_values = series.values<br/>
—-&gt; 5     raw_values = raw_values.reshape(len(raw_values), 1)<br/>
      6     # transform into supervised learning problem X, y<br/>
      7     supervised = series_to_supervised(raw_values, n_lag, n_seq)</p>
<p>ValueError: cannot reshape array of size 470880 into shape (156960,1)</p>
<p>This array size of 470880 is three times 156960, which is the len(size of my data).</p>
<p>Would you have advise how I could solve this issue?</p>
<div class="reply">
<a aria-label="Reply to Derrick" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417797#respond" onclick='return addComment.moveForm( "comment-417797", "417797", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417833">
<div class="comment-container" id="li-comment-417833">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-417833" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you understand how to reshape data for LSTMs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=417833#respond" onclick='return addComment.moveForm( "comment-417833", "417833", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419745">
<div class="comment-container" id="li-comment-419745">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kishore Kumar</span>
<span class="date">November 11, 2017 at 8:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419745" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am a beginner in machine learning. These tutorials are helping me so much to learn and improve. Thanks a ton for posting all your explorations. </p>
<p>Now I have a question to ask you,</p>
<p>We can 36 months data in this example. Now I require knowing the 37th-month forecast. How would I predict in this model?</p>
<p>Should I reshape the new value before I predict or direct inject the new data into predict model?</p>
<p>eg.<br/>
new_data = 145<br/>
predicted_output = model.predict(new_data, verbose = 0)</p>
<p>(or)</p>
<p>new_data = 145<br/>
x = x.reshape(1,1,1)<br/>
predicted_output = model.predict(x, verbose = 0)</p>
<p>(or)</p>
<p>Do we need have any other method to do so?</p>
<p>Note: Based on your answer, I would like to predict the 4 month predict.</p>
<p>Thanks in advance for your time and help</p>
<div class="reply">
<a aria-label="Reply to Kishore Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419745#respond" onclick='return addComment.moveForm( "comment-419745", "419745", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419791">
<div class="comment-container" id="li-comment-419791">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 12, 2017 at 9:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419791" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post has more advice on how to reshape input data:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<p>This post shows how to make predictions for final LSTM models:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419791#respond" onclick='return addComment.moveForm( "comment-419791", "419791", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-419828">
<div class="comment-container" id="li-comment-419828">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kishore Kumar</span>
<span class="date">November 12, 2017 at 8:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419828" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your reply. </p>
<p>I see two different prediction results when I save the model and try to predict the model which is loaded. </p>
<p>But the forecast/predictions results are same when I run the model infinite times before saving the model.</p>
<p>With the model that is saved and loaded, results the same prediction output everytime I run with that loaded model. </p>
<p>The problem is, results given before saving the model is not matching/ same with the model that is loaded.</p>
<p>Looks like something gets changed inside the trained model when saving it.<br/>
Before saving the model, it provides 98% accuracy. While after saving the model, when we try to predict it give 90% accuracy.</p>
<p>Can you help me to clarify this doubt. I have provided the code snippet with the output below. This code snippet of saving the model and loading it again is from one single python program only. not multiple python scripts.</p>
<p>Note: I am experimenting with a different dataset, that contains prices in decimals and similar to this tutorial dataset.</p>
<p>Program Code:<br/>
#########################################<br/>
value = [ 0.0568]<br/>
value = array(value)<br/>
value = value.reshape(1, 1, len(value))<br/>
predicted_example = model.predict(value, batch_size=1, verbose = 0)<br/>
print (“predicted example %s” % predicted_example)</p>
<p>model.save(‘saved_keras_model_1.h5’)</p>
<p>model_storage_1 = load_model(‘saved_keras_model_1.h5’)</p>
<p>predicted_example_1 = model_storage_1.predict(value, batch_size=1, verbose = 0)</p>
<p>print (“predicted example_1 %s” % predicted_example_1)</p>
<p>#######################################################</p>
<p>output recieved:</p>
<p>predicted example [[-0.0193442   0.01113211 -0.00196517  0.00191608 -0.00315076  0.0080449]]</p>
<p>predicted example_1 [[-0.02511037  0.01445036 -0.00255096  0.00248715 -0.00408998  0.0104428]]</p>
<div class="reply">
<a aria-label="Reply to Kishore Kumar" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419828#respond" onclick='return addComment.moveForm( "comment-419828", "419828", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-419872">
<div class="comment-container" id="li-comment-419872">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 13, 2017 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419872" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is very interesting. </p>
<p>I don’t have any good ideas. If it is mission critical, I would suggest designing experiments to further tease out the cause and limits of the effect.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419872#respond" onclick='return addComment.moveForm( "comment-419872", "419872", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-419908">
<div class="comment-container" id="li-comment-419908">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e8cceff6298e9a87ec6ed6665fa0c0a9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kishore Kumar</span>
<span class="date">November 13, 2017 at 9:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419908" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That’s fine. Between Why are these predicted values are in negative and positive. What does it mean. Do we need to further transform into any other function or do any operation.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-419902">
<div class="comment-container" id="li-comment-419902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e4234305b4bbac26c8539ab97e051a94?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e4234305b4bbac26c8539ab97e051a94?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jiawenqi</span>
<span class="date">November 13, 2017 at 7:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model.add(LSTM(n_neurons, batch_input_shape=(n_batch, X.shape[1], X.shape[2]), stateful=True))<br/>
When X.shape[1] =1,so step=1 . Lstm can lose its meaning,because it will become a regression model.</p>
<div class="reply">
<a aria-label="Reply to jiawenqi" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419902#respond" onclick='return addComment.moveForm( "comment-419902", "419902", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419942">
<div class="comment-container" id="li-comment-419942">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2017 at 10:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-419942" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=419942#respond" onclick='return addComment.moveForm( "comment-419942", "419942", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421829">
<div class="comment-container" id="li-comment-421829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 1, 2017 at 11:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-421829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Your blogs are really great. I have a learned and still learning a lot from them.</p>
<p>I am trying to apply tweet sentiments to LSTM along with some numeric features (e.g price, volume) but still I did not succeed. I have read some blogs and papers but everywhere tweets and numeric features are feed separately but I want to feed both of them as my feature vector.<br/>
Any good suggestions ?</p>
<p>Best Regards,</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=421829#respond" onclick='return addComment.moveForm( "comment-421829", "421829", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421902">
<div class="comment-container" id="li-comment-421902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 8:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-421902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend using an Embedding layer followed by an LSTM, see this post:<br/>
<a href="https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/" rel="nofollow">https://machinelearningmastery.com/use-word-embedding-layers-deep-learning-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=421902#respond" onclick='return addComment.moveForm( "comment-421902", "421902", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421870">
<div class="comment-container" id="li-comment-421870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/01c1ff7a294d1ac3e6dbb8d7a62ee4df?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/01c1ff7a294d1ac3e6dbb8d7a62ee4df?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ktr</span>
<span class="date">December 1, 2017 at 9:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-421870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason<br/>
I’ve been working though your tutorials which are quite useful and<br/>
clear – even to a non-Python programmer In this one though I lost the thread around<br/>
“Fit LSTM Network. I’m concerned about “fix time steps at 1”. </p>
<p>What about when the timesteps are not a constant size? A specific example: I am<br/>
driving, recording my position, acceleration, direction and time every five minutes.<br/>
For various reasons the five minutes is approximate. Also, sometimes I lose the<br/>
GPS, so I miss one or several records.</p>
<p>Obviously position depends on time. Should I resample all my records so the time periods are equil? Should I interpolate to provide the missing ones? What if I stop overnight. Can I somehow stitch the two days data together?</p>
<p>Second question: where in this tutorial are you providing the punishmenty feedback to the model? I want to use an asymmetric function. (If I want to drive up to the edge of a precipice, it is much worse to go too far than not quite far enough.) </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to ktr" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=421870#respond" onclick='return addComment.moveForm( "comment-421870", "421870", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421913">
<div class="comment-container" id="li-comment-421913">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-421913" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can pad the time steps to the same length?</p>
<p>You can define models to take arbitrary numbers of input time steps, for example:<br/>
<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/</a></p>
<p>You have a lot of options, see here:<br/>
<a href="https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/" rel="nofollow">https://machinelearningmastery.com/data-preparation-variable-length-input-sequences-sequence-prediction/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=421913#respond" onclick='return addComment.moveForm( "comment-421913", "421913", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422155">
<div class="comment-container" id="li-comment-422155">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vino Jose</span>
<span class="date">December 5, 2017 at 1:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422155" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason for the wonderful blog post. Could you please give a hint about how to predict multi-steps for this multivariate input?</p>
<div class="reply">
<a aria-label="Reply to Vino Jose" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422155#respond" onclick='return addComment.moveForm( "comment-422155", "422155", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422169">
<div class="comment-container" id="li-comment-422169">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 5, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422169" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I have an example here:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422169#respond" onclick='return addComment.moveForm( "comment-422169", "422169", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-422293">
<div class="comment-container" id="li-comment-422293">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vino Jose</span>
<span class="date">December 6, 2017 at 8:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422293" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have tried out above blog post. I’m able to understand how to pass multivariate input. But still couldn’t do multi-step prediction. Could you please help?</p>
<div class="reply">
<a aria-label="Reply to Vino Jose" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422293#respond" onclick='return addComment.moveForm( "comment-422293", "422293", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-422349">
<div class="comment-container" id="li-comment-422349">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422349" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422349#respond" onclick='return addComment.moveForm( "comment-422349", "422349", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422658">
<div class="comment-container" id="li-comment-422658">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vino Jose</span>
<span class="date">December 10, 2017 at 5:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422658" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have to predict the performance of an application. The inputs will be time series of past performance data of the application, CPU usage data of the server where application is hosted, the Memory usage data, network bandwidth usage etc. I’m trying to build a solution using LSTM which will take these input data and predict the performance of the application for next one week. I have followed your blog ‘https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/’ and understood how to work with multivariate data. I’m currently stumbled at the part where predicting multiple steps to the future, ie, next one week performance of the application. Even though multi-steps prediction is working for me with univariate time series examples, here it is not working. Not sure what I’m missing. Could you please give me some guidance in doing that?</p>
<div class="reply">
<a aria-label="Reply to Vino Jose" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422658#respond" onclick='return addComment.moveForm( "comment-422658", "422658", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422710">
<div class="comment-container" id="li-comment-422710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 11, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly? Where are you getting stuck?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422710#respond" onclick='return addComment.moveForm( "comment-422710", "422710", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-422910">
<div class="comment-container" id="li-comment-422910">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a21a0b5a39f08321c65d3d3dedfd1d24?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vino Jose</span>
<span class="date">December 12, 2017 at 9:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422910" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m getting only one data point in the predicted result, while I’m expecting one weeks data points.</p>
<div class="reply">
<a aria-label="Reply to Vino Jose" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422910#respond" onclick='return addComment.moveForm( "comment-422910", "422910", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-422904">
<div class="comment-container" id="li-comment-422904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/09d2e7e0c2a1e408fcb891a346a8f28c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/09d2e7e0c2a1e408fcb891a346a8f28c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">G Flash</span>
<span class="date">December 12, 2017 at 7:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thanks for that great blog! I have a general question about multi-step predictions. Your prediction of t+3 is – as I understand it – independent from the prediction of t+2, which itself is independent of t+1. </p>
<p>Is it meaningful to consider to feedback the former predictions into the network? If yes, how is such a model called?</p>
<div class="reply">
<a aria-label="Reply to G Flash" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422904#respond" onclick='return addComment.moveForm( "comment-422904", "422904", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422944">
<div class="comment-container" id="li-comment-422944">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-422944" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can organize the model that way, it is called a recursive forecast:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>In this post we are predicting multiple time steps directly.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=422944#respond" onclick='return addComment.moveForm( "comment-422944", "422944", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424974">
<div class="comment-container" id="li-comment-424974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/37f62244c7799c1b56b5cda12af69650?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/37f62244c7799c1b56b5cda12af69650?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Yang</span>
<span class="date">December 27, 2017 at 6:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-424974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for the great tutorial! I have several questions about the predictions. If I try to deal with a dataset which contains about 6000 observations, is it meaningful to make predictions from t+1 to t+500 (if n_test=1)?<br/>
By the way, when plotting the predictions, there is a small shift from the last data point. Is it the result of the transform from series to supervised? Maybe I mistook something.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Yang" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=424974#respond" onclick='return addComment.moveForm( "comment-424974", "424974", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426642">
<div class="comment-container" id="li-comment-426642">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1ebff318e4e25a01aedce9f4ade7c03c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1ebff318e4e25a01aedce9f4ade7c03c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andreas</span>
<span class="date">January 16, 2018 at 6:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-426642" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>Would it be beneficial to also use which time step (t+k) we are predicting on as input to the model? Since right now we are considering all data points in the the span specified by n_seq as “the same time step away from where we are predicting from”.</p>
<p>Best Regards &amp; Thanks,<br/>
Andreas</p>
<div class="reply">
<a aria-label="Reply to Andreas" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=426642#respond" onclick='return addComment.moveForm( "comment-426642", "426642", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426661">
<div class="comment-container" id="li-comment-426661">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#comment-426661" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps. Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/?replytocom=426661#respond" onclick='return addComment.moveForm( "comment-426661", "426661", "respond", "3987" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/multi-step-time-series-forecasting-long-short-term-memory-networks-python/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3987"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="25ddaa985d"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="212"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>