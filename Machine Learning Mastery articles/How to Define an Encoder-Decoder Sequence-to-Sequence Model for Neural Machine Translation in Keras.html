<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras - Machine Learning Mastery" property="og:title"/>
<meta content="The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems, such as machine translation. Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample …" property="og:description"/>
<meta content="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Natural Language Processing" property="article:section"/>
<meta content="2017-10-26T05:00:36+11:00" property="article:published_time"/>
<meta content="2017-11-21T11:03:58+11:00" property="article:modified_time"/>
<meta content="2017-11-21T11:03:58+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4563" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4563 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Need help with Deep Learning for Text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4563 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-10-26T05:00:36+1100">October 26, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Natural Language Processing">Natural Language Processing</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems, such as machine translation.</p>
<p>Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample code distributed with the Keras project.</p>
<p>In this post, you will discover how to define an encoder-decoder sequence-to-sequence prediction model for machine translation, as described by the author of the Keras deep learning library.</p>
<p>After reading this post, you will know:</p>
<ul>
<li>The neural machine translation example provided with Keras and described on the Keras blog.</li>
<li>How to correctly define an encoder-decoder LSTM for training a neural machine translation model.</li>
<li>How to correctly define an inference model for using a trained encoder-decoder model to translate new sequences.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4567" style="max-width: 650px"><img alt="How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras" class="size-full wp-image-4567" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Define-an-Encoder-Decoder-Sequence-to-Sequence-Model-for-Neural-Machine-Translation-in-Keras-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras<br/>Photo by <a href="https://www.flickr.com/photos/68942208@N02/16012752622/">Tom Lee</a>, some rights reserved.</p></div>
<h2>Sequence-to-Sequence Prediction in Keras</h2>
<p><a href="https://twitter.com/fchollet">Francois Chollet</a>, the author of the Keras deep learning library, recently released a blog post that steps through a code example for developing an encoder-decoder LSTM for sequence-to-sequence prediction titled “<a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a>“.</p>
<p>The code developed in the blog post has also been added to Keras as an example in the file <a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">lstm_seq2seq.py</a>.</p>
<p>The post develops a sophisticated implementation of the encoder-decoder LSTM as described in the canonical papers on the topic:</p>
<ul>
<li><a href="https://arxiv.org/abs/1409.3215">Sequence to Sequence Learning with Neural Networks</a>, 2014.</li>
<li><a href="https://arxiv.org/abs/1406.1078">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a>, 2014.</li>
</ul>
<p>The model is applied to the problem of machine translation, the same as the source papers in which the approach was first described. Technically, the model is a neural machine translation model.</p>
<p>Francois’ implementation provides a template for how sequence-to-sequence prediction can be implemented (correctly) in the Keras deep learning library at the time of writing.</p>
<p>In this post, will take a closer look at exactly how the training and inference models were designed and how they work.</p>
<p>You will be able to use this understanding to develop similar models for your own sequence-to-sequence prediction problems.</p>
<!-- Start shortcoder --><p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Machine Translation Data</h2>
<p>The dataset used in the example involves short French and English sentence pairs used in the flash card software <a href="https://apps.ankiweb.net/">Anki</a>.</p>
<p>The dataset is called “<a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a>” and is part of the <a href="http://tatoeba.org/home">Tatoeba Project</a> and listed on the <a href="http://www.manythings.org/">ManyThings.org</a> site for helping English as a Second Language students.</p>
<p>The dataset used in the tutorial can be downloaded from here:</p>
<ul>
<li><a href="http://www.manythings.org/anki/fra-eng.zip">French – English fra-eng.zip</a></li>
</ul>
<p>Below is a sample of the first 10 rows from the <em>fra.txt</em> data file you will see after you unzip the downloaded archive.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a2f1098899202" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Go.		Va !
Run!	Cours !
Run!	Courez !
Wow!	Ça alors !
Fire!	Au feu !
Help!	À l'aide !
Jump.	Saute.
Stop!	Ça suffit !
Stop!	Stop !
Stop!	Arrête-toi !</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a2f1098899202-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2f1098899202-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a2f1098899202-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2f1098899202-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69a2f1098899202-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2f1098899202-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69a2f1098899202-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2f1098899202-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69a2f1098899202-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2f1098899202-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a2f1098899202-1">Go.		Va !</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2f1098899202-2">Run!	Cours !</div><div class="crayon-line" id="crayon-5a6591c69a2f1098899202-3">Run!	Courez !</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2f1098899202-4">Wow!	Ça alors !</div><div class="crayon-line" id="crayon-5a6591c69a2f1098899202-5">Fire!	Au feu !</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2f1098899202-6">Help!	À l'aide !</div><div class="crayon-line" id="crayon-5a6591c69a2f1098899202-7">Jump.	Saute.</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2f1098899202-8">Stop!	Ça suffit !</div><div class="crayon-line" id="crayon-5a6591c69a2f1098899202-9">Stop!	Stop !</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2f1098899202-10">Stop!	Arrête-toi !</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The problem is framed as a sequence prediction problem where input sequences of characters are in English and output sequences of characters are in French.</p>
<p>A total of 10,000 of the nearly 150,000 examples in the data file are used in the dataset. Some technical details of the prepared data are as follows:</p>
<ul>
<li><strong>Input Sequences</strong>: Padded to a maximum length of 16 characters with a vocabulary of 71 different characters (10000, 16, 71).</li>
<li><strong>Output Sequences</strong>: Padded to a maximum length of 59 characters with a vocabulary of 93 different characters (10000, 59, 93).</li>
</ul>
<p>The training data is framed such that the input for the model is comprised of one whole input sequence of English characters and the whole output sequence of French characters. The output of the model is the whole sequence of French characters, but offset forward by one time step.</p>
<p>For example (with minimal padding and without one-hot encoding):</p>
<ul>
<li>Input1: [‘G’, ‘o’, ‘.’, ”]</li>
<li>Input2: [ ”, ‘V’, ‘a’, ‘ ‘]</li>
<li>Output: [‘V’, ‘a’, ‘ ‘, ‘!’]</li>
</ul>
<h2>Machine Translation Model</h2>
<p>The neural translation model is an encoder-decoder recurrent neural network.</p>
<p>It is comprised of an encoder that reads a variable length input sequence and a decoder that predicts a variable length output sequence.</p>
<p>In this section, we will step through each element of the model’s definition, with code taken directly from the post and the code example in the Keras project (at the time of writing).</p>
<p>The model is divided into two sub-models: the encoder responsible for outputting a fixed-length encoding of the input English sequence, and the decoder responsible for predicting the output sequence, one character per output time step.</p>
<p>The first step is to define the encoder.</p>
<p>The input to the encoder is a sequence of characters, each encoded as one-hot vectors with length of <em>num_encoder_tokens</em>.</p>
<p>The LSTM layer in the encoder is defined with the <em>return_state</em> argument set to <em>True</em>. This returns the hidden state output returned by LSTM layers generally, as well as the hidden and cell state for all cells in the layer. These are used when defining the decoder.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a2ff786375477" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a2ff786375477-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2ff786375477-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a2ff786375477-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2ff786375477-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69a2ff786375477-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a2ff786375477-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a2ff786375477-1"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2ff786375477-2"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a2ff786375477-3"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2ff786375477-4"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a2ff786375477-5"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a2ff786375477-6"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Next, we define the decoder.</p>
<p>The decoder input is defined as a sequence of French character one-hot encoded to binary vectors with a length of <em>num_decoder_tokens</em>.</p>
<p>The LSTM layer is defined to both return sequences and state. The final hidden and cell states are ignored and only the output sequence of hidden states is referenced.</p>
<p>Importantly, the final hidden and cell state from the encoder is used to initialize the state of the decoder. This means every time that the encoder model encodes an input sequence, the final internal states of the encoder model are used as the starting point for outputting the first character in the output sequence. This also means that the encoder and decoder LSTM layers must have the same number of cells, in this case, 256.</p>
<p>A <em>Dense</em> output layer is used to predict each character. This <em>Dense</em> is used to produce each character in the output sequence in a one-shot manner, rather than recursively, at least during training. This is because the entire target sequence required for input to the model is known during training.</p>
<p>The Dense does not need to be wrapped in a <em>TimeDistributed</em> layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a303455705878" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a303455705878-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a303455705878-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a303455705878-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a303455705878-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69a303455705878-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a303455705878-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69a303455705878-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a303455705878-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69a303455705878-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a303455705878-1"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a303455705878-2"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a303455705878-3"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a303455705878-4"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line" id="crayon-5a6591c69a303455705878-5"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a303455705878-6"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a303455705878-7"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a303455705878-8"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a303455705878-9"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Finally, the model is defined with inputs for the encoder and the decoder and the output target sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a307021681022" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a307021681022-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a307021681022-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a307021681022-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a307021681022-1"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a307021681022-2"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5a6591c69a307021681022-3"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can tie all of this together in a standalone example and fix the configuration and print a graph of the model. The complete code example for defining the model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a30a575239649" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense
from keras.utils.vis_utils import plot_model
# configure
num_encoder_tokens = 71
num_decoder_tokens = 93
latent_dim = 256
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
# plot the model
plot_model(model, to_file='model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-10">10</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-12">12</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-14">14</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-16">16</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-18">18</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-20">20</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-22">22</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-24">24</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-26">26</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30a575239649-28">28</div><div class="crayon-num" data-line="crayon-5a6591c69a30a575239649-29">29</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a30a575239649-1"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-v">plot_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-6"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-7"><span class="crayon-v">num_encoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-8"><span class="crayon-v">num_decoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-9"><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-10"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-11"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-12"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-13"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-14"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-15"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-16"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-17"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-18"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-19"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-20"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-21"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-22"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-23"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-24"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-25"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-26"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-27"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30a575239649-28"><span class="crayon-p"># plot the model</span></div><div class="crayon-line" id="crayon-5a6591c69a30a575239649-29"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>Running the example creates a plot of the defined model that may help you better understand how everything hangs together.</p>
<p>Note that the encoder LSTM does not directly pass its outputs as inputs to the decoder LSTM; as noted above, the decoder uses the final hidden and cell states as the initial state for the decoder.</p>
<p>Also note that the decoder LSTM only passes the sequence of hidden states to the Dense for output, not the final hidden and cell states as suggested by the output shape information.</p>
<div class="wp-caption aligncenter" id="attachment_4564" style="max-width: 975px"><img alt="Graph of Encoder-Decoder Model For Training" class="size-full wp-image-4564" height="405" sizes="(max-width: 965px) 100vw, 965px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training.png 965w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training-300x126.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Decoder-Model-For-Training-768x322.png 768w" width="965"/><p class="wp-caption-text">Graph of Encoder-Decoder Model For Training</p></div>
<h2>Neural Machine Translation Inference</h2>
<p>Once the defined model is fit, it can be used to make predictions. Specifically, output a French translation for an English source text.</p>
<p>The model defined for training has learned weights for this operation, but the structure of the model is not designed to be called recursively to generate one character at a time.</p>
<p>Instead, new models are required for the prediction step, specifically a model for encoding English input sequences of characters and a model that takes the sequence of French characters generated so far and the encoding as input and predicts the next character in the sequence.</p>
<p>Defining the inference models requires reference to elements of the model used for training in the example. Alternately, one could define a new model with the same shapes and load the weights from file.</p>
<p>The encoder model is defined as taking the input layer from the encoder in the trained model (<em>encoder_inputs</em>) and outputting the hidden and cell state tensors (<em>encoder_states</em>).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a30e135789347" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define encoder inference model
encoder_model = Model(encoder_inputs, encoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a30e135789347-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a30e135789347-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a30e135789347-1"><span class="crayon-p"># define encoder inference model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a30e135789347-2"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The decoder is more elaborate.</p>
<p>The decoder requires the hidden and cell states from the encoder as the initial state of the newly defined encoder model. Because the decoder is a separate standalone model, these states will be provided as input to the model, and therefore must first be defined as inputs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a311535581792" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a311535581792-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a311535581792-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a311535581792-1"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a311535581792-2"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>They can then be specified for use as the initial state of the decoder LSTM layer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a313715859765" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a313715859765-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a313715859765-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a313715859765-1"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a313715859765-2"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Both the encoder and decoder will be called recursively for each character that is to be generated in the translated sequence.</p>
<p>On the first call, the hidden and cell states from the encoder will be used to initialize the decoder LSTM layer, provided as input to the model directly.</p>
<p>On subsequent recursive calls to the decoder, the last hidden and cell state must be provided to the model. These state values are already within the decoder; nevertheless, we must re-initialize the state on each call given the way that the model was defined in order to take the final states from the encoder on the first call.</p>
<p>Therefore, the decoder must output the hidden and cell states along with the predicted character on each call, so that these states can be assigned to a variable and used on each subsequent recursive call for a given input sequence of English text to be translated.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a316131861703" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a316131861703-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a316131861703-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a316131861703-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a316131861703-1"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a316131861703-2"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a316131861703-3"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can tie all of this together into a standalone code example combined with the definition of the training model of the previous section, given the reuse of some elements. The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69a319139806199" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense
from keras.utils.vis_utils import plot_model
# configure
num_encoder_tokens = 71
num_decoder_tokens = 93
latent_dim = 256
# Define an input sequence and process it.
encoder_inputs = Input(shape=(None, num_encoder_tokens))
encoder = LSTM(latent_dim, return_state=True)
encoder_outputs, state_h, state_c = encoder(encoder_inputs)
# We discard `encoder_outputs` and only keep the states.
encoder_states = [state_h, state_c]
# Set up the decoder, using `encoder_states` as initial state.
decoder_inputs = Input(shape=(None, num_decoder_tokens))
# We set up our decoder to return full output sequences,
# and to return internal states as well. We don't use the
# return states in the training model, but we will use them in inference.
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)
decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
decoder_dense = Dense(num_decoder_tokens, activation='softmax')
decoder_outputs = decoder_dense(decoder_outputs)
# Define the model that will turn
# `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`
model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
# plot the model
plot_model(model, to_file='model.png', show_shapes=True)
# define encoder inference model
encoder_model = Model(encoder_inputs, encoder_states)
# define decoder inference model
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
# summarize model
plot_model(encoder_model, to_file='encoder_model.png', show_shapes=True)
plot_model(decoder_model, to_file='decoder_model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-10">10</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-12">12</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-14">14</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-16">16</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-18">18</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-20">20</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-22">22</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-24">24</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-26">26</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-28">28</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-30">30</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-32">32</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-34">34</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-36">36</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-38">38</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-40">40</div><div class="crayon-num" data-line="crayon-5a6591c69a319139806199-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69a319139806199-42">42</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69a319139806199-1"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-2"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-v">plot_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-6"><span class="crayon-p"># configure</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-7"><span class="crayon-v">num_encoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">71</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-8"><span class="crayon-v">num_decoder_tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">93</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-9"><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">256</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-10"><span class="crayon-p"># Define an input sequence and process it.</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-11"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_encoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-12"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-13"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-14"><span class="crayon-p"># We discard `encoder_outputs` and only keep the states.</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-15"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-16"><span class="crayon-p"># Set up the decoder, using `encoder_states` as initial state.</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-17"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-18"><span class="crayon-p"># We set up our decoder to return full output sequences,</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-19"><span class="crayon-p"># and to return internal states as well. We don't use the</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-20"><span class="crayon-p"># return states in the training model, but we will use them in inference.</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-21"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-22"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-23"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">num_decoder_tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-24"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-25"><span class="crayon-p"># Define the model that will turn</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-26"><span class="crayon-p"># `encoder_input_data` &amp; `decoder_input_data` into `decoder_target_data`</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-27"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-28"><span class="crayon-p"># plot the model</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-29"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-30"><span class="crayon-p"># define encoder inference model</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-31"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-32"><span class="crayon-p"># define decoder inference model</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-33"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-34"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-35"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-36"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-37"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-38"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-39"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-40"><span class="crayon-p"># summarize model</span></div><div class="crayon-line" id="crayon-5a6591c69a319139806199-41"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'encoder_model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69a319139806199-42"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'decoder_model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>Running the example defines the training model, inference encoder, and inference decoder.</p>
<p>Plots of all three models are then created.</p>
<div class="wp-caption aligncenter" id="attachment_4565" style="max-width: 551px"><img alt="Graph of Encoder Model For Inference" class="size-full wp-image-4565" height="184" sizes="(max-width: 541px) 100vw, 541px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference.png 541w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Encoder-Model-For-Inference-300x102.png 300w" width="541"/><p class="wp-caption-text">Graph of Encoder Model For Inference</p></div>
<p>The plot of the encoder is straightforward.</p>
<p>The decoder shows the three inputs required to decode a single character in the translated sequence, the encoded translation output so far, and the hidden and cell states provided first from the encoder and then from the output of the decoder as the model is called recursively for a given translation.</p>
<div class="wp-caption aligncenter" id="attachment_4566" style="max-width: 1185px"><img alt="Graph of Decoder Model For Inference" class="size-full wp-image-4566" height="295" sizes="(max-width: 1175px) 100vw, 1175px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference.png 1175w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-300x75.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-768x193.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Graph-of-Decoder-Model-For-Inference-1024x257.png 1024w" width="1175"/><p class="wp-caption-text">Graph of Decoder Model For Inference</p></div>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://twitter.com/fchollet">Francois Chollet on Twitter</a></li>
<li><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a></li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">Keras seq2seq Code Example (lstm_seq2seq)</a></li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
<li><a href="https://keras.io/layers/recurrent/#lstm">LSTM API in Keras</a></li>
<li><a href="http://www.bioinf.jku.at/publications/older/2604.pdf">Long Short-Term Memory</a>, 1997.</li>
<li><a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/">Understanding LSTM Networks</a>, 2015.</li>
<li><a href="https://arxiv.org/abs/1409.3215">Sequence to Sequence Learning with Neural Networks</a>, 2014.</li>
<li><a href="https://arxiv.org/abs/1406.1078">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a>, 2014.</li>
</ul>
<h2>Summary</h2>
<p>In this post, you discovered how to define an encoder-decoder sequence-to-sequence prediction model for machine translation, as described by the author of the Keras deep learning library.</p>
<p>Specifically, you learned:</p>
<ul>
<li>The neural machine translation example provided with Keras and described on the Keras blog.</li>
<li>How to correctly define an encoder-decoder LSTM for training a neural machine translation model.</li>
<li>How to correctly define an inference model for using a trained encoder-decoder model to translate new sequences.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdefine-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Define%20an%20Encoder-Decoder%20Sequence-to-Sequence%20Model%20for%20Neural%20Machine%20Translation%20in%20Keras&amp;url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Index, Slice and Reshape NumPy Arrays for Machine Learning in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="next">How to Use the Keras Functional API for Deep Learning <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">67 Responses to <em>How to Define an Encoder-Decoder Sequence-to-Sequence Model for Neural Machine Translation in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418093">
<div class="comment-container" id="li-comment-418093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6e53cd310d401852858089d556ce04a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6e53cd310d401852858089d556ce04a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tom</span>
<span class="date">October 27, 2017 at 11:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason – Which book has this article?  I did not see this in LSTM, if I am not mistaken.</p>
<div class="reply">
<a aria-label="Reply to Tom" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418093#respond" onclick='return addComment.moveForm( "comment-418093", "418093", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418606">
<div class="comment-container" id="li-comment-418606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">October 31, 2017 at 10:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i have referenced lstm_seq2seq.py code for requirement,i had executed correctly i got the correct results.<br/>
my requirement is that i  have to inputs from user and it has to encode to state vectors ,give to decoder ,generate results for given inputs. I have written a  logic for it.but i am not able to generate the correct results.</p>
<p>userInput=”<br/>
count=0<br/>
while(userInput!=’quit’):<br/>
     userInput = input(‘enter the english sentences or want to stop (enter quote with quotes)’);<br/>
     userInput=str(userInput)<br/>
     f = open(‘testone.txt’, ‘a’ )<br/>
     if userInput==’quit’:<br/>
          f.close()<br/>
     else:<br/>
        f.write( userInput + ‘\n’ )<br/>
        count=count+1<br/>
print(“count”,count)</p>
<p># taking inputs from user </p>
<p>#saving in testone.txt file</p>
<p>test_path=’testone.txt’<br/>
test_texts = []<br/>
#target_texts = []<br/>
test_characters = set()<br/>
#target_characters = set()<br/>
lines = open(test_path).read().split(‘\n’)<br/>
for line in lines[: min(30, len(lines) – 1)]:<br/>
    test_text = line</p>
<p>    test_texts.append(test_text)<br/>
    #target_texts.append(target_text)<br/>
    for char in test_text:<br/>
        if char not in test_characters:<br/>
            test_characters.add(char)</p>
<p>test_characters = sorted(list(test_characters))<br/>
num_testencoder_tokens = len(test_characters)<br/>
max_testencoder_seq_length = max([len(txt) for txt in test_texts])</p>
<p>print(‘Number of samples:’, len(test_texts))<br/>
#print(‘Number of unique input tokens:’, num_encoder_tokens)<br/>
print(“max test encoder seq length”,max_testencoder_seq_length)<br/>
print(“num_testencoder_tokens”,num_testencoder_tokens)<br/>
test_token_index = dict(<br/>
    [(char, i) for i, char in enumerate(test_characters)])<br/>
print(“test_token_index”,test_token_index)<br/>
encoder_test_data = np.zeros(<br/>
    (len(test_texts), max_testencoder_seq_length,num_testencoder_tokens),<br/>
    dtype=’float32′)<br/>
print(“encoder_test_data”,encoder_test_data.shape)</p>
<p>for i,test_text in enumerate(test_texts):<br/>
    for t, char in enumerate(test_text):<br/>
        encoder_test_data[i, t,test_token_index[char]] = 1.<br/>
print(“encoder_test_data”,encoder_test_data.shape)</p>
<p>encoder_test_inputs = Input(shape=(None,num_testencoder_tokens))<br/>
print(“encoder_inputs”,encoder_test_inputs.shape)</p>
<p>encoder_test_inputs = Input(shape=(None, num_testencoder_tokens))<br/>
print(“—————-“,encoder_test_inputs.shape)</p>
<p>encoder = LSTM(latent_dim, return_state=True)<br/>
encoder_outputs, state_h, state_c = encoder(encoder_test_inputs)<br/>
print(“encoder_outputs”,encoder_outputs)</p>
<p># We discard <code>encoder_outputs</code> and only keep the states.<br/>
encoder_test_states = [state_h, state_c]</p>
<p>print(“encoder_test_states”,encoder_test_states)<br/>
decoder_lstm = LSTM(latent_dim, return_sequences=True, return_state=True)<br/>
decoder_outputs, _, _ = decoder_lstm(decoder_inputs,<br/>
                                     initial_state=encoder_test_states)<br/>
print(‘encoder_test_inputs.shape’,encoder_test_inputs.shape)<br/>
print(‘encoder_test_states’,encoder_test_states)</p>
<p>encoder_test_model = Model(encoder_test_inputs, encoder_test_states)</p>
<p>print(encoder_test_model.summary)</p>
<p>decoder_state_input_h = Input(shape=(latent_dim,))<br/>
decoder_state_input_c = Input(shape=(latent_dim,))<br/>
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
decoder_outputs, state_h, state_c = decoder_lstm(<br/>
    decoder_inputs, initial_state=decoder_states_inputs)<br/>
decoder_states = [state_h, state_c]<br/>
decoder_outputs = decoder_dense(decoder_outputs)</p>
<p>decoder_model = Model(<br/>
    [decoder_inputs] + decoder_states_inputs,<br/>
    [decoder_outputs] + decoder_states)</p>
<p># Reverse-lookup token index to decode sequences back to<br/>
# something readable.<br/>
reverse_input_char_index = dict(<br/>
    (i, char) for char, i in test_token_index.items())<br/>
reverse_testtarget_char_index=dict(<br/>
    (i, char) for char, i in target_token_index.items())</p>
<p>def decode_sequence(input_seq):<br/>
    # Encode the input as state vectors.<br/>
    #print(input_seq)<br/>
    states_value = encoder_test_model.predict(input_seq)</p>
<p>    # Generate empty target sequence of length 1.<br/>
    target_seq = np.zeros((1, 1, num_decoder_tokens))<br/>
   # print(“target_seq”,target_seq)<br/>
    # Populate the first character of target sequence with the start character.<br/>
    target_seq[0, 0, target_token_index[‘\t’]] = 1.</p>
<p>    # Sampling loop for a batch of sequences<br/>
    # (to simplify, here we assume a batch of size 1).<br/>
    stop_condition = False<br/>
    decoded_sentence = ”<br/>
    while not stop_condition:<br/>
        output_tokens, h, c = decoder_model.predict(<br/>
            [target_seq] + states_value)<br/>
        #print(“output_tokens”,output_tokens)<br/>
        # Sample a token<br/>
        sampled_token_index = np.argmax(output_tokens[0, -1, :])<br/>
        print(‘sampled_token_index’, sampled_token_index)<br/>
        #sampled_char = reverse_target_char_index[sampled_token_index]<br/>
        sampled_char = reverse_testtarget_char_index[sampled_token_index]<br/>
        print(“sampled_char”,sampled_char)<br/>
        decoded_sentence += sampled_char</p>
<p>        # Exit condition: either hit max length<br/>
        # or find stop character.<br/>
        if (sampled_char == ‘\n’ or<br/>
           len(decoded_sentence) &gt; max_decoder_seq_length):<br/>
            stop_condition = True</p>
<p>        # Update the target sequence (of length 1).<br/>
        target_seq = np.zeros((1, 1, num_decoder_tokens))<br/>
        #print(“target_seq legnth”,len(target_seq))<br/>
        target_seq[0, 0, sampled_token_index] = 1.</p>
<p>        # Update states<br/>
        states_value = [h, c]</p>
<p>    return decoded_sentence</p>
<p>for seq_index in range(count):<br/>
    #print(encoder_test_data[0:1])<br/>
    input_seq = encoder_test_data[seq_index: seq_index + 1]<br/>
    print(“input_seq”,input_seq.shape)<br/>
    decoded_sentence = decode_sequence(input_seq)<br/>
    print(‘-‘)<br/>
    print(‘Input sentence:’, test_texts[seq_index])<br/>
    print(‘Decoded sentence:’, decoded_sentence)</p>
<p>Above is my code ,please suggest where i am going wrong.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418606#respond" onclick='return addComment.moveForm( "comment-418606", "418606", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418629">
<div class="comment-container" id="li-comment-418629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot debug your code for you. </p>
<p>What is the problem exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418629#respond" onclick='return addComment.moveForm( "comment-418629", "418629", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418670">
<div class="comment-container" id="li-comment-418670">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 1, 2017 at 3:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418670" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually in original code ,they are testing on  already trained code,in my code what i am doing is ,i  am giving inputs from console and stored in a file,this inputs i am giving to encoder_model, for console inputs i am not getting proper outputs like we got i n trained data.</p>
<p>Suppose i have given same words from console to encoder model also i am getting wrong results.</p>
<p>Please tell me where i am going wrong.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418670#respond" onclick='return addComment.moveForm( "comment-418670", "418670", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418678">
<div class="comment-container" id="li-comment-418678">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 4:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418678" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can debug your example with static data?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418678#respond" onclick='return addComment.moveForm( "comment-418678", "418678", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418685">
<div class="comment-container" id="li-comment-418685">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 1, 2017 at 5:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418685" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>for static data it is working, but when i am taking inputs from users i am not getting proper results.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418685#respond" onclick='return addComment.moveForm( "comment-418685", "418685", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418728">
<div class="comment-container" id="li-comment-418728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It might be related to how you are reading the input and preparing it for the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418728#respond" onclick='return addComment.moveForm( "comment-418728", "418728", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418804">
<div class="comment-container" id="li-comment-418804">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ambika</span>
<span class="date">November 2, 2017 at 6:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418804" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to do predictions for sequence to sequence model using keras,why we are not using train model directly,why we are creating inference model in this scenario ,Please can you explain.</p>
<p>i would like to know,how to predict the model outputs for model unknown inputs in sequence to sequence model using keras.</p>
<div class="reply">
<a aria-label="Reply to Ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418804#respond" onclick='return addComment.moveForm( "comment-418804", "418804", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418833">
<div class="comment-container" id="li-comment-418833">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418833" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a sophisticated seq2seq model. For a much simpler architecture see here:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418833#respond" onclick='return addComment.moveForm( "comment-418833", "418833", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418810">
<div class="comment-container" id="li-comment-418810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandu</span>
<span class="date">November 2, 2017 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have unknown inputs in eng, i want to translate these inputs to french.So i converted these textst inputs into vectors,like in seq2sq model they have encoded as  constant length vector.<br/>
I have given these inputs to inference encoder_model,along with these inputs states(hidden,cell states) like encoder_model = Model(encoder_test_inputs, encoder_test_states)<br/>
from these i am extracting state value from encoder_model(),this state value i am passing to decoder model,like that decoder_model.predict(<br/>
[target_seq] + states_value),but i am getting scarmbled outputs if i will give unknown inputs to encoder_model.</p>
<p>is there any difference procedure available to predict target sequnce for given unknwon inputs sequnce,Please suggest me for this problem.<br/>
I am able to decode the already trained data,if is not trained  data i am not able to decode.</p>
<div class="reply">
<a aria-label="Reply to Nandu" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418810#respond" onclick='return addComment.moveForm( "comment-418810", "418810", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418837">
<div class="comment-container" id="li-comment-418837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Once the model is trained, you must encode new data using the same procedure as you used for the training data then call model.predict()</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418837#respond" onclick='return addComment.moveForm( "comment-418837", "418837", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418892">
<div class="comment-container" id="li-comment-418892">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">November 3, 2017 at 4:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418892" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>in that they are not doing model.predict,they are doing encoder_model.predict and decoder_model.predict() seperately.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418892#respond" onclick='return addComment.moveForm( "comment-418892", "418892", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418946">
<div class="comment-container" id="li-comment-418946">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 4, 2017 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-418946" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=418946#respond" onclick='return addComment.moveForm( "comment-418946", "418946", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-419138">
<div class="comment-container" id="li-comment-419138">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 6, 2017 at 5:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419138" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How to predict unknown target sequence for unknown inputs using keras? for unknown inputs again i need to create input layer and encoder states  and encoder model or else or i need to use same encoder_model its taking parameters as  encoder_inputs and encoders_states.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=419138#respond" onclick='return addComment.moveForm( "comment-419138", "419138", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419193">
<div class="comment-container" id="li-comment-419193">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2017 at 9:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419193" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The inference models could be saved, loaded and used to make predictions as in the above examples.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=419193#respond" onclick='return addComment.moveForm( "comment-419193", "419193", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-419996">
<div class="comment-container" id="li-comment-419996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandu</span>
<span class="date">November 14, 2017 at 11:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-419996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please can you explain how this inference decoder_model will work in this examples,i  am ok with training of the encoder and decoder model ,inference encoder_model,I didn’t understnd the inference decoder_model in this example.</p>
<p># define decoder inference model<br/>
decoder_state_input_h = Input(shape=(latent_dim,))<br/>
decoder_state_input_c = Input(shape=(latent_dim,))<br/>
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]<br/>
in training model we are passing decoder_inputs and intial state as encoder states,but in inference something it is differnent things we are passing ,why what is the reason.</p>
<p>decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)</p>
<p>decoder_states = [state_h, state_c]</p>
<p>decoder_outputs = decoder_dense(decoder_outputs)<br/>
decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs]</p>
<div class="reply">
<a aria-label="Reply to Nandu" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=419996#respond" onclick='return addComment.moveForm( "comment-419996", "419996", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420043">
<div class="comment-container" id="li-comment-420043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The key difference is that we recursively pass in the last state as input, starting with the encoder state for the first pass.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420043#respond" onclick='return addComment.moveForm( "comment-420043", "420043", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420022">
<div class="comment-container" id="li-comment-420022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/765ff36ce7382543fbf0cf1e3d3b44ed?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/765ff36ce7382543fbf0cf1e3d3b44ed?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jonas</span>
<span class="date">November 15, 2017 at 6:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you please elaborate more on why TimeDistributed is not need here? The Dense layer in Decoder must output one character for each character in the input sequence, so how is it different here from the case where TimeDistributed must be aplied?</p>
<div class="reply">
<a aria-label="Reply to Jonas" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420022#respond" onclick='return addComment.moveForm( "comment-420022", "420022", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420050">
<div class="comment-container" id="li-comment-420050">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420050" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question. Dense can now support time steps! </p>
<p>You can add a TimeDistribted wrapper and it will have the same effect.</p>
<p>I know… Keras is getting a little confusing.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420050#respond" onclick='return addComment.moveForm( "comment-420050", "420050", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420073">
<div class="comment-container" id="li-comment-420073">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 15, 2017 at 6:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420073" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason,</p>
<p>currently i am working on seq2seq model using keras.</p>
<p>my requirement: they will test case in english like (adding two numbers).<br/>
output: source has to generate for that particular test case in python .</p>
<p>this requirement is quietly different from language translation tool.</p>
<p>Please do any suggestions for it,how to proceed further.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420073#respond" onclick='return addComment.moveForm( "comment-420073", "420073", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420173">
<div class="comment-container" id="li-comment-420173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for almost exactly this problem:<br/>
<a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420173#respond" onclick='return addComment.moveForm( "comment-420173", "420173", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420098">
<div class="comment-container" id="li-comment-420098">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 15, 2017 at 9:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420098" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>while predicting target character .</p>
<p>output_tokens, h, c = decoder_test_model.predict(<br/>
            [target_seq] + states_value)</p>
<p>        # Sample a token<br/>
        sampled_token_index = np.argmax(output_tokens[0, -1, :])<br/>
they are using np.argmax(output_tokesn) ,Could you explain how does it works inorder to predict the target character.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420098#respond" onclick='return addComment.moveForm( "comment-420098", "420098", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420177">
<div class="comment-container" id="li-comment-420177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What is the problem exactly?</p>
<p>argmax? See here:<br/>
<a href="https://en.wikipedia.org/wiki/Arg_max" rel="nofollow">https://en.wikipedia.org/wiki/Arg_max</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420177#respond" onclick='return addComment.moveForm( "comment-420177", "420177", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420733">
<div class="comment-container" id="li-comment-420733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f66d349d54d2934cca64266c4a40a5dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f66d349d54d2934cca64266c4a40a5dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Krtk</span>
<span class="date">November 21, 2017 at 1:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for making a detailed blog.</p>
<p>Did you try saving and restoring the model for inference later?<br/>
I’m following the lstm_seq2seq example where the model.save stored the HDF5 file but when I try restoring the model just for inference, the output is all garbage despite the model providing good test responses when train is followed by inference.</p>
<div class="reply">
<a aria-label="Reply to Krtk" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420733#respond" onclick='return addComment.moveForm( "comment-420733", "420733", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420810">
<div class="comment-container" id="li-comment-420810">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 10:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420810" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not tried that, sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420810#respond" onclick='return addComment.moveForm( "comment-420810", "420810", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420859">
<div class="comment-container" id="li-comment-420859">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">November 22, 2017 at 6:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420859" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Can we identify the grammer  using keras,like what is noun and pronoun ,</p>
<p>Please suggest any procedure is there to identify thr grammer using keras.</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420859#respond" onclick='return addComment.moveForm( "comment-420859", "420859", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420943">
<div class="comment-container" id="li-comment-420943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure. It could be framed as word classification.</p>
<p>You must prepare a dataset of examples then fit your model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420943#respond" onclick='return addComment.moveForm( "comment-420943", "420943", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420867">
<div class="comment-container" id="li-comment-420867">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 22, 2017 at 9:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420867" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,</p>
<p>do you have any example of word level encoding for language translation ,above examples is for character level encoding rigjt.<br/>
if you have example please share the link.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420867#respond" onclick='return addComment.moveForm( "comment-420867", "420867", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420945">
<div class="comment-container" id="li-comment-420945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-420945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I have an example in my book:<br/>
<a href="https://machinelearningmastery.com/deep-learning-for-nlp/" rel="nofollow">https://machinelearningmastery.com/deep-learning-for-nlp/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=420945#respond" onclick='return addComment.moveForm( "comment-420945", "420945", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421000">
<div class="comment-container" id="li-comment-421000">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">November 24, 2017 at 12:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421000" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here provided example ,they are doing character level encoding for encoder and decoder,Same model i would like to work on word level encoding for encoder and decoder?<br/>
is word level encoding will better than character level encoding?</p>
<p>in order to word level encoding ,which method i need to follow,please suggest me before going to start.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421000#respond" onclick='return addComment.moveForm( "comment-421000", "421000", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421044">
<div class="comment-container" id="li-comment-421044">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421044" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on the problem whether word or char level will be better. Char may be more flexible but be slower to train, Word may require larger vocab/memory but train sooner.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421044#respond" onclick='return addComment.moveForm( "comment-421044", "421044", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt thread-even depth-1" id="comment-421039">
<div class="comment-container" id="li-comment-421039">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421039" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow, can you please restate the question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421039#respond" onclick='return addComment.moveForm( "comment-421039", "421039", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421185">
<div class="comment-container" id="li-comment-421185">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 26, 2017 at 2:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421185" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well explained article! I wonder if these sequence-to-sequence can be applied to images, for example to handle different size images, and apply encoder-decoder for segmentation?</p>
<div class="reply">
<a aria-label="Reply to Baptiste Amato" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421185#respond" onclick='return addComment.moveForm( "comment-421185", "421185", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421202">
<div class="comment-container" id="li-comment-421202">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 26, 2017 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421202" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps, I’m not sure I follow sorry. Do you have an example?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421202#respond" onclick='return addComment.moveForm( "comment-421202", "421202", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421213">
<div class="comment-container" id="li-comment-421213">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 26, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421213" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Let’s say I want to develop a Neural Network that returns, given an image, a sort of contour map (like the cars in blue, the people in green), but my data set has various images from different size, making them impossible to stack in an array and put them directly in a CNN. Would it be possible to apply the sequence-to-sequence idea to these images, as we want an image as result and we don’t have a uniform size for the input data?</p>
<div class="reply">
<a aria-label="Reply to Baptiste Amato" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421213#respond" onclick='return addComment.moveForm( "comment-421213", "421213", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-421278">
<div class="comment-container" id="li-comment-421278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting challenge.</p>
<p>I don’t think seq2seq is the right framing, but I could be wrong.</p>
<p>There are many ways to frame this type of problem and I’d encourage you to explore a few. Perhaps a network that outputs a red and a green image that you combine downstream, or perhaps the network outputs one image with all pixels colored.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421278#respond" onclick='return addComment.moveForm( "comment-421278", "421278", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-421310">
<div class="comment-container" id="li-comment-421310">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6822e30d9ddea92e569450bf8b4a8fa7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Baptiste Amato</span>
<span class="date">November 27, 2017 at 10:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421310" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>“a network that outputs a red and a green image that you combine downstream”: it’s pretty simple but I did not think about it… Thank you for your comment 🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-421421">
<div class="comment-container" id="li-comment-421421">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2017 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421421" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem, let me know how you go.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421472">
<div class="comment-container" id="li-comment-421472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 28, 2017 at 5:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>can we store model states and use it further for testing,<br/>
Please suggest me the way to store the states in file ,use it further.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421472#respond" onclick='return addComment.moveForm( "comment-421472", "421472", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421541">
<div class="comment-container" id="li-comment-421541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2017 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can, e.g. pickle the state LSTM variable.</p>
<p>Why do you want to save the state?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421541#respond" onclick='return addComment.moveForm( "comment-421541", "421541", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421596">
<div class="comment-container" id="li-comment-421596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 29, 2017 at 5:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am writting the training model and testing model seperately thats why i want to  feed encoder_inputs and encoder states to inference model,thats why i would like to store the states.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421596#respond" onclick='return addComment.moveForm( "comment-421596", "421596", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-421659">
<div class="comment-container" id="li-comment-421659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’d recommend using one model to keep things simple.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421659#respond" onclick='return addComment.moveForm( "comment-421659", "421659", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421597">
<div class="comment-container" id="li-comment-421597">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">November 29, 2017 at 5:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-421597" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>model = Model([encoder_inputs, decoder_inputs], decoder_outputs)</p>
<p>model.save(“seq2seq.h5”)<br/>
here i am loading the model from h5 file<br/>
model=model.load(seq2seq.h5)<br/>
after that i have stored encoder_inputs,encoders_states of trained model using pickling .<br/>
next i am trying to create the inference model using encoder_inputs and encoder_states<br/>
but i am not able to create the inference model correctly, i am getting the issue like graph disconnected with input layer 1 .<br/>
encoder_model = Model(encoder_inputs, encoder_states</p>
<p>Please suggest why i am getting like this issue.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=421597#respond" onclick='return addComment.moveForm( "comment-421597", "421597", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-423283">
<div class="comment-container" id="li-comment-423283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 16, 2017 at 1:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey , I had the same issue ( I have implemented a seq 2 seq model with R but I had the same problem) and I solved this with a trick.<br/>
So after training your model you can save it using keras function save model. Then I defined a function to build the encoder model and another one to build the decoder model from the model I have trained. Here is my code :</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69c842081935613" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
get_encoder_model &lt;- function(model) {
  encoder_inputs = get_output_at(get_layer(model,'encoder_inputs'),0)
  encoder_lstm = get_output_at(get_layer(model,'encoder_lstm'),0)
  state_h &lt;- encoder_lstm[[2]]
  state_c &lt;- encoder_lstm[[3]]
  encoder_states = list(state_h,state_c)
  encoder_model = keras_model(encoder_inputs, encoder_states)
  return(encoder_model)
}

get_decoder_model &lt;- function(model) {
  latent_dim = get_output_shape_at(get_layer(model,'decoder_lstm'),0)[[1]][[3]]
  decoder_inputs = get_output_at(get_layer(model,'decoder_inputs'),0)
  decoder_state_input_h = layer_input(c(latent_dim))
  decoder_state_input_c = layer_input(c(latent_dim))
  decoder_states_inputs = list(decoder_state_input_h, decoder_state_input_c)
  decoder = layer_lstm(units = latent_dim,return_sequences = T,return_state=T,name = 'decoder_lstm')
  decoder_inf_lstm = decoder(get_output_at(get_layer(model,'decoder_inputs'),0), initial_state = decoder_states_inputs)
  
  set_weights(decoder,keras::get_weights(get_layer(model,'decoder_lstm')))
  decoder_outputs &lt;- decoder_inf_lstm[[1]]
  state_h &lt;- decoder_inf_lstm[[2]]
  state_c &lt;- decoder_inf_lstm[[3]]
  decoder_states = list(state_h,state_c)
  decoder_dense = layer_dense(units = n_features,activation='linear',name = 'decoder_dense')
  decoder_outputs &lt;- decoder_dense(decoder_outputs)
  set_weights(decoder_dense,keras::get_weights(get_layer(model,'decoder_dense')))
  decoder_model = keras_model(inputs = c(decoder_inputs,decoder_states_inputs), outputs = c(decoder_outputs,decoder_states))
  return(decoder_model)
}</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-10">10</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-12">12</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-14">14</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-16">16</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-18">18</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-20">20</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-22">22</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-24">24</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-26">26</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-28">28</div><div class="crayon-num" data-line="crayon-5a6591c69c842081935613-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c842081935613-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69c842081935613-1"><span class="crayon-v">get_encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-2"><span class="crayon-h">  </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'encoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-3"><span class="crayon-h">  </span><span class="crayon-v">encoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'encoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-4"><span class="crayon-h">  </span><span class="crayon-v">state_h</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">encoder_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-5"><span class="crayon-h">  </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">encoder_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-6"><span class="crayon-h">  </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-v">state_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-7"><span class="crayon-h">  </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">keras_model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-8"><span class="crayon-h">  </span><span class="crayon-st">return</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_model</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-9"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-10"> </div><div class="crayon-line" id="crayon-5a6591c69c842081935613-11"><span class="crayon-v">get_decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-t">function</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-12"><span class="crayon-h">  </span><span class="crayon-v">latent_dim</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_shape_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-13"><span class="crayon-h">  </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-14"><span class="crayon-h">  </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_input</span><span class="crayon-sy">(</span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-15"><span class="crayon-h">  </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_input</span><span class="crayon-sy">(</span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-16"><span class="crayon-h">  </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-17"><span class="crayon-h">  </span><span class="crayon-v">decoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-v">return_sequences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-18"><span class="crayon-h">  </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder</span><span class="crayon-sy">(</span><span class="crayon-e">get_output_at</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_inputs'</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-19"><span class="crayon-h">  </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-20"><span class="crayon-h">  </span><span class="crayon-e">set_weights</span><span class="crayon-sy">(</span><span class="crayon-v">decoder</span><span class="crayon-sy">,</span><span class="crayon-v">keras</span><span class="crayon-o">::</span><span class="crayon-e">get_weights</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_lstm'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-21"><span class="crayon-h">  </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-22"><span class="crayon-h">  </span><span class="crayon-v">state_h</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-23"><span class="crayon-h">  </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inf_lstm</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-24"><span class="crayon-h">  </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-v">state_c</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-25"><span class="crayon-h">  </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">layer_dense</span><span class="crayon-sy">(</span><span class="crayon-v">units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'linear'</span><span class="crayon-sy">,</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'decoder_dense'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-26"><span class="crayon-h">  </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-27"><span class="crayon-h">  </span><span class="crayon-e">set_weights</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_dense</span><span class="crayon-sy">,</span><span class="crayon-v">keras</span><span class="crayon-o">::</span><span class="crayon-e">get_weights</span><span class="crayon-sy">(</span><span class="crayon-e">get_layer</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-s">'decoder_dense'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-28"><span class="crayon-h">  </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">keras_model</span><span class="crayon-sy">(</span><span class="crayon-v">inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">c</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c842081935613-29"><span class="crayon-h">  </span><span class="crayon-st">return</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_model</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c842081935613-30"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0036 seconds] -->
<p>It is R code but you can adapt it to python. The trick was mainly to create new layers and set weight with those trained by your model.</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423283#respond" onclick='return addComment.moveForm( "comment-423283", "423283", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-423340">
<div class="comment-container" id="li-comment-423340">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423340" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing, I added some formatting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423340#respond" onclick='return addComment.moveForm( "comment-423340", "423340", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-423948">
<div class="comment-container" id="li-comment-423948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for your suggestion 🙂</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423948#respond" onclick='return addComment.moveForm( "comment-423948", "423948", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-424976">
<div class="comment-container" id="li-comment-424976">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/92b33c92fca7076989a72401afb63ec0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/92b33c92fca7076989a72401afb63ec0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.digitalnk.com/blog" rel="external nofollow">Benoit</a></span>
<span class="date">December 27, 2017 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424976" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This should do the trick for Python:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c69c45e426046704" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = load_model('s2s.h5')

encoder = model.layers[2]
encoder_inputs = model.layers[0].input
encoder_outputs, state_h, state_c = model.layers[2].output
encoder_states = [state_h, state_c]
encoder_model = Model(encoder_inputs, encoder_states)

decoder_inputs = model.layers[1].input
decoder_lstm = model.layers[3]
decoder_dense = model.layers[-1]
decoder_state_input_h = Input(shape=(latent_dim,))
decoder_state_input_c = Input(shape=(latent_dim,))
decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
decoder_outputs, state_h, state_c = decoder_lstm(
    decoder_inputs, initial_state=decoder_states_inputs)
decoder_states = [state_h, state_c]
decoder_outputs = decoder_dense(decoder_outputs)
decoder_model = Model(
    [decoder_inputs] + decoder_states_inputs,
    [decoder_outputs] + decoder_states)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-2">2</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-4">4</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-6">6</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-8">8</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-10">10</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-12">12</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-14">14</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-16">16</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-18">18</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c69c45e426046704-20">20</div><div class="crayon-num" data-line="crayon-5a6591c69c45e426046704-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c69c45e426046704-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'s2s.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-2"> </div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-3"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-4"><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">input</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-5"><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-6"><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-7"><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-8"> </div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-9"><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-10"><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-11"><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-12"><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-13"><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">latent_dim</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-14"><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-15"><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-16"><span class="crayon-h">    </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-17"><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-18"><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-19"><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c69c45e426046704-20"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5a6591c69c45e426046704-21"><span class="crayon-h">    </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Benoit" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424976#respond" onclick='return addComment.moveForm( "comment-424976", "424976", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-425005">
<div class="comment-container" id="li-comment-425005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=425005#respond" onclick='return addComment.moveForm( "comment-425005", "425005", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423249">
<div class="comment-container" id="li-comment-423249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3f168e506cefb78f3fc2b0a56ab9e7c9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3f168e506cefb78f3fc2b0a56ab9e7c9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.data-blogger.com/" rel="external nofollow">Kevin</a></span>
<span class="date">December 15, 2017 at 8:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for this great article! I created a Tensorflow implementation. This gives another perspective on the implementation side of the seq2seq model. The blog post about the Tensorflow implementation is found on Data Blogger: <a href="https://www.data-blogger.com/2017/12/14/create-a-character-based-seq2seq-using-python-and-tensorflow/" rel="nofollow">https://www.data-blogger.com/2017/12/14/create-a-character-based-seq2seq-using-python-and-tensorflow/</a>.</p>
<div class="reply">
<a aria-label="Reply to Kevin" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423249#respond" onclick='return addComment.moveForm( "comment-423249", "423249", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423330">
<div class="comment-container" id="li-comment-423330">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423330" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing Kevin.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423330#respond" onclick='return addComment.moveForm( "comment-423330", "423330", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-423951">
<div class="comment-container" id="li-comment-423951">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423951" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can we add more lstm layres in encoder and decoder inorder to predict the results correctly,<br/>
is it a good approach to add more layers in encoder and decoder using keras.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423951#respond" onclick='return addComment.moveForm( "comment-423951", "423951", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424043">
<div class="comment-container" id="li-comment-424043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It can help. Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424043#respond" onclick='return addComment.moveForm( "comment-424043", "424043", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423952">
<div class="comment-container" id="li-comment-423952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">ambika</span>
<span class="date">December 19, 2017 at 6:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-423952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>encoder and decoder model is good approach to implement a model ,for algorithm as input to model,output is source code generation for specified language .</p>
<p>i am trying to this problem statement using encoder and decoder model using keras,is this good  idea to implement,or is there any apporach  is there for this problem statement.</p>
<p>Please do suggest  for it.</p>
<div class="reply">
<a aria-label="Reply to ambika" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=423952#respond" onclick='return addComment.moveForm( "comment-423952", "423952", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424044">
<div class="comment-container" id="li-comment-424044">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424044" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think it is a good place to start.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424044#respond" onclick='return addComment.moveForm( "comment-424044", "424044", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424212">
<div class="comment-container" id="li-comment-424212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 20, 2017 at 9:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, First thank you for your article. I’ve managed to set up a model with only 1 layer for the enoder and 1 layer for the decoder ( both LSTM) . I would like to train my model with more than 1 LSTM layer. </p>
<p>I have added 1 more LSTM to my decoder and set states for both of them with the encoder states. However when I want to predict a new sequence the ouput is very bad. Have you tried to add more than 1 LSTM with keras ?</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424212#respond" onclick='return addComment.moveForm( "comment-424212", "424212", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-424215">
<div class="comment-container" id="li-comment-424215">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6617b43bc3ee16544f6612a7f024d1c1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">December 20, 2017 at 9:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424215" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>why are you not adding more lstm layers to encoder,can i know reason.<br/>
Actually i am also trying for the issue,let me why are you not adding more lstm layers to encoder rather than decoder?</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424215#respond" onclick='return addComment.moveForm( "comment-424215", "424215", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-424228">
<div class="comment-container" id="li-comment-424228">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb1f127e5acf462d0d6f623242831e0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Etienne</span>
<span class="date">December 21, 2017 at 1:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424228" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I try to create sophisticated model I start with basic model and then i try to improve it.<br/>
Sure you can add 8 layers for the encoder and 8 for the decoder. But I prefer build it step by ste. I w’ll try to add layers for the encoder for sure but i don’t think that it will solve my problem… The training part is Ok with 2 lstm for the decoder but thr problem comes when i try to predict something with my inference model</p>
<div class="reply">
<a aria-label="Reply to Etienne" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424228#respond" onclick='return addComment.moveForm( "comment-424228", "424228", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-424290">
<div class="comment-container" id="li-comment-424290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 21, 2017 at 3:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how can share code of 2 lstm layers ,how you have implemented,same i have tried with 3 lstm layers encoder, and 3 lstm layers with decoder.but while creating inference decoder model , i am getting shaping issue.</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424290#respond" onclick='return addComment.moveForm( "comment-424290", "424290", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-424308">
<div class="comment-container" id="li-comment-424308">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">December 21, 2017 at 5:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424308" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how can share code of 2 lstm layers decoder,how you have implemented,same i have tried with 3 lstm layers encoder, and 3 lstm layers with decoder.but while creating inference decoder model , i am getting shaping issue.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-424249">
<div class="comment-container" id="li-comment-424249">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424249" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I use a single layer for the encoder and decoder to keep things simple in the example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424249#respond" onclick='return addComment.moveForm( "comment-424249", "424249", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424248">
<div class="comment-container" id="li-comment-424248">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-424248" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to tune the model, perhaps longer training, a new batch size and other config changes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=424248#respond" onclick='return addComment.moveForm( "comment-424248", "424248", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425515">
<div class="comment-container" id="li-comment-425515">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandin</span>
<span class="date">January 3, 2018 at 4:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425515" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>given test case i need to generate a script file for it,i am able to generate results some how ok.<br/>
but i would to recognize in my test case what are the variables they has to be same in script file also,Please give any suggestion for it.</p>
<p>how to recognize variable as per the input.<br/>
ex: Define a integer variable a  : int a</p>
<p>Define a integer variable add : int add.</p>
<p>how model can recognize a and add variable in test case.<br/>
please do any suggestions for it.</p>
<div class="reply">
<a aria-label="Reply to nandin" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=425515#respond" onclick='return addComment.moveForm( "comment-425515", "425515", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425568">
<div class="comment-container" id="li-comment-425568">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-425568" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow.</p>
<p>If you are having trouble defining your machine learning problem, maybe this post will help:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=425568#respond" onclick='return addComment.moveForm( "comment-425568", "425568", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426004">
<div class="comment-container" id="li-comment-426004">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nandini</span>
<span class="date">January 9, 2018 at 11:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426004" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>is it good approach to increase accuracy of encoder and decoder model to adding more lstm layers ?</p>
<div class="reply">
<a aria-label="Reply to Nandini" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=426004#respond" onclick='return addComment.moveForm( "comment-426004", "426004", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426064">
<div class="comment-container" id="li-comment-426064">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426064" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It can be, depends on the dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=426064#respond" onclick='return addComment.moveForm( "comment-426064", "426064", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426323">
<div class="comment-container" id="li-comment-426323">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/365e77129a1e4670f8cf335c30e7a544?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/365e77129a1e4670f8cf335c30e7a544?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hardik Khandelwal</span>
<span class="date">January 12, 2018 at 8:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426323" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the post. It’s really helpful.<br/>
Why are we using only 10,000 samples out of 150,000. Is it because of huge memory requirements or is there some other reason.</p>
<div class="reply">
<a aria-label="Reply to Hardik Khandelwal" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=426323#respond" onclick='return addComment.moveForm( "comment-426323", "426323", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426366">
<div class="comment-container" id="li-comment-426366">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#comment-426366" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, because of the large space and time complexity.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/?replytocom=426366#respond" onclick='return addComment.moveForm( "comment-426366", "426366", "respond", "4563" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/define-encoder-decoder-sequence-sequence-model-neural-machine-translation-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4563"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="7964050983"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="70"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Text Data</h3>
<p>Cut through the math and research papers.<br/>
Discover Word Embeddings, Text Translation and more.</p>
<p><a href="/deep-learning-for-nlp/">Get Started With Deep Learning for NLP Today!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>