<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks - Machine Learning Mastery" property="og:title"/>
<meta content="Long Short-Term Memory (LSTM) Recurrent Neural Networks are able to learn the order dependence in long sequence data. They are a fundamental technique used in a range of state-of-the-art results, such as image captioning and machine translation. They can also be difficult to understand, specifically how to frame a problem to get the most out …" property="og:description"/>
<meta content="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-06-09T05:00:46+11:00" property="article:published_time"/>
<meta content="2017-07-20T08:51:54+11:00" property="article:modified_time"/>
<meta content="2017-07-20T08:51:54+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Learn-to-Echo-Random-Integers-with-Long-Short-Term-Memory-Recurrent-Neural-Networks.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Learn-to-Echo-Random-Integers-with-Long-Short-Term-Memory-Recurrent-Neural-Networks.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="427" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/feed/" rel="alternate" title="Machine Learning Mastery » How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4072" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-echo-random-integers-long-short-term-memory-recurrent-neural-networks%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-echo-random-integers-long-short-term-memory-recurrent-neural-networks%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4072 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4072 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-06-09T05:00:46+1100">June 9, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-echo-random-integers-long-short-term-memory-recurrent-neural-networks%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+Recurrent+Neural+Networks+are+able+to+learn+the+order+dependence+in+lo..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+Recurrent+Neural+Networks+are+able+to+learn+the+order+dependence+in+lo...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Long Short-Term Memory (LSTM) Recurrent Neural Networks are able to learn the order dependence in long sequence data.</p>
<p>They are a fundamental technique used in a range of state-of-the-art results, such as image captioning and machine translation.</p>
<p>They can also be difficult to understand, specifically how to frame a problem to get the most out of this type of network.</p>
<p>In this tutorial, you will discover how to develop a simple LSTM recurrent neural network to learn how to echo back the number in an ad hoc sequence of random integers. Although a trivial problem, developing this network will provide the skills needed to apply LSTM on a range of sequence prediction problems.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a LSTM for the simpler problem of echoing any given input.</li>
<li>How to avoid the beginner’s mistake when applying LSTMs to sequence problems like echoing integers.</li>
<li>How to develop a robust LSTM to echo the last observation from ad hoc sequences of random integers.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4074" style="max-width: 650px"><img alt="How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks" class="size-full wp-image-4074" height="427" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Learn-to-Echo-Random-Integers-with-Long-Short-Term-Memory-Recurrent-Neural-Networks.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Learn-to-Echo-Random-Integers-with-Long-Short-Term-Memory-Recurrent-Neural-Networks.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/How-to-Learn-to-Echo-Random-Integers-with-Long-Short-Term-Memory-Recurrent-Neural-Networks-300x200.jpg 300w" width="640"/><p class="wp-caption-text">How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks<br/>Photo by <a href="https://www.flickr.com/photos/franckmichel/14942703299/">Franck Michel</a>, some rights reserved.</p></div>
<h2>Overview</h2>
<p>This tutorial is divided into 4 parts; they are:</p>
<ol>
<li>Generate and Encode Random Sequences</li>
<li>Echo Current Observation</li>
<li>Echo Lag Observation Without Context (Beginners Mistake)</li>
<li>Echo Lag Observation</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this example.</p>
<p>This tutorial assumes you have Keras v2.0 or higher installed with either the TensorFlow or Theano backend. You do not need a GPU for this tutorial, all code will easily run in a CPU.</p>
<p>This tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help setting up your Python environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Generate and Encode Random Sequences</h2>
<p>The first step is to write some code to generate a random sequence of integers and encode them for the network.</p>
<h3>Generate Random Sequence</h3>
<p>We can generate random integers in Python using the randint() function that takes two parameters indicating the range of integers from which to draw values.</p>
<p>In this tutorial, we will define the problem as having integer values between 0 and 99 with 100 unique values.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac668325139658" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
randint(0, 99)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac668325139658-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac668325139658-1"><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can put this in a function called generate_sequence() that will generate a sequence of random integers of the desired length, with the default length set to 25 elements.</p>
<p>This function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac678486468740" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac678486468740-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac678486468740-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac678486468740-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac678486468740-1"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac678486468740-2"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac678486468740-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p></p>
<h3>One Hot Encode Random Sequence</h3>
<p>Once we have generated sequences of random integers, we need to transform them into a format that is suitable for training an LSTM network.</p>
<p>One option would be to rescale the integer to the range [0,1]. This would work and would require that the problem be phrased as regression.</p>
<p>I am interested in predicting the right number, not a number close to the expected value. This means I would prefer to frame the problem as classification rather than regression, where the expected output is a class and there are 100 possible class values.</p>
<p>In this case, we can use a one hot encoding of the integer values where each value is represented by a 100 elements binary vector that is all “0” values except the index of the integer, which is marked 1.</p>
<p>The function below called one_hot_encode() defines how to iterate over a sequence of integers and create a binary vector representation for each and returns the result as a 2-dimensional array.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac67c267310160" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac67c267310160-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac67c267310160-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac67c267310160-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac67c267310160-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac67c267310160-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac67c267310160-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac67c267310160-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac67c267310160-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac67c267310160-1"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac67c267310160-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac67c267310160-3"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac67c267310160-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac67c267310160-5"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac67c267310160-6"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586deac67c267310160-7"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac67c267310160-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We also need to decode the encoded values so that we can make use of the predictions, in this case, just review them.</p>
<p>The one hot encoding can be inverted by using the argmax() NumPy function that returns the index of the value in the vector with the largest value.</p>
<p>The function below, named one_hot_decode(), will decode an encoded sequence and can be used to later decode predictions from our network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac67f580622318" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac67f580622318-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac67f580622318-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac67f580622318-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac67f580622318-1"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac67f580622318-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac67f580622318-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>We can tie all of this together.</p>
<p>Below is the complete code listing for generating a sequence of 25 random integers and encoding each integer as a binary vector.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac682549943931" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate random sequence
sequence = generate_sequence()
print(sequence)
# one hot encode
encoded = one_hot_encode(sequence)
print(encoded)
# one hot decode
decoded = one_hot_decode(encoded)
print(decoded)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac682549943931-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac682549943931-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac682549943931-30">30</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac682549943931-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-v">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-4"> </div><div class="crayon-line" id="crayon-5a6586deac682549943931-5"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-6"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-8"> </div><div class="crayon-line" id="crayon-5a6586deac682549943931-9"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-10"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-11"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-13"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-14"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-15"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-16"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-18"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-19"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-21"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-22"><span class="crayon-p"># generate random sequence</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-23"><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-24"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-25"><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-26"><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-27"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-28"><span class="crayon-p"># one hot decode</span></div><div class="crayon-line" id="crayon-5a6586deac682549943931-29"><span class="crayon-v">decoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac682549943931-30"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">decoded</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>Running the example first prints the list of 25 random integers, followed by a truncated view of the binary representations of all integers in the sequence, one vector per line, then the decoded sequence again.</p>
<p>You may get different results as different random integers are generated each time the code is run.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac685696480784" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[37, 99, 40, 98, 44, 27, 99, 18, 52, 97, 46, 39, 60, 13, 66, 29, 26, 4, 65, 85, 29, 88, 8, 23, 61]
[[0 0 0 ..., 0 0 0]
[0 0 0 ..., 0 0 1]
[0 0 0 ..., 0 0 0]
...,
[0 0 0 ..., 0 0 0]
[0 0 0 ..., 0 0 0]
[0 0 0 ..., 0 0 0]]
[37, 99, 40, 98, 44, 27, 99, 18, 52, 97, 46, 39, 60, 13, 66, 29, 26, 4, 65, 85, 29, 88, 8, 23, 61]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac685696480784-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac685696480784-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac685696480784-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac685696480784-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac685696480784-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac685696480784-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac685696480784-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac685696480784-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac685696480784-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac685696480784-1">[37, 99, 40, 98, 44, 27, 99, 18, 52, 97, 46, 39, 60, 13, 66, 29, 26, 4, 65, 85, 29, 88, 8, 23, 61]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac685696480784-2">[[0 0 0 ..., 0 0 0]</div><div class="crayon-line" id="crayon-5a6586deac685696480784-3">[0 0 0 ..., 0 0 1]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac685696480784-4">[0 0 0 ..., 0 0 0]</div><div class="crayon-line" id="crayon-5a6586deac685696480784-5">...,</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac685696480784-6">[0 0 0 ..., 0 0 0]</div><div class="crayon-line" id="crayon-5a6586deac685696480784-7">[0 0 0 ..., 0 0 0]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac685696480784-8">[0 0 0 ..., 0 0 0]]</div><div class="crayon-line" id="crayon-5a6586deac685696480784-9">[37, 99, 40, 98, 44, 27, 99, 18, 52, 97, 46, 39, 60, 13, 66, 29, 26, 4, 65, 85, 29, 88, 8, 23, 61]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now that we know how to prepare and represent random sequences of integers, we can look at using LSTMs to learn them.</p>
<h2>Echo Current Observation</h2>
<p>Let’s start out by looking at a simpler echo problem.</p>
<p>In this section, we will develop an LSTM to echo the current observation. That is given a random integer as input, return the same integer as output.</p>
<p>Or slightly more formally stated as:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac688403301356" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat(t) = f(X(t))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac688403301356-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac688403301356-1">yhat(t) = f(X(t))</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>That is, the model is to predict the value at the current time (yhat(t)) as a function (f()) of the observed value at the current time (X(t)).</p>
<p>It is a simple problem because no memory is required, just a function to map an input to an identical output.</p>
<p>It is a trivial problem and will demonstrate a few useful things:</p>
<ul>
<li>How to use the problem representation machinery above.</li>
<li>How to use LSTMs in Keras.</li>
<li>The capacity of an LSTM required to learn such a trivial problem.</li>
</ul>
<p>This will lay the foundation for the echo of lag observations next.</p>
<p>First, we will develop a function to prepare a random sequence ready to train or evaluate an LSTM. This function must first generate a random sequence of integers, use a one hot encoding, then transform the input data to be a 3-dimensional array.</p>
<p>LSTMs require a 3D input comprised of the dimensions [samples, timesteps, features]. Our problem will be comprised of 25 examples per sequence, 1 time step, and 100 features for the one hot encoding.</p>
<p>This function is listed below, named generate_data().</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac68a316515298" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# convert to 3d for input
	X = encoded.reshape(encoded.shape[0], 1, encoded.shape[1])
	return X, encoded</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac68a316515298-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68a316515298-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac68a316515298-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68a316515298-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac68a316515298-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68a316515298-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac68a316515298-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68a316515298-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac68a316515298-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac68a316515298-1"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68a316515298-2"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac68a316515298-3"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68a316515298-4"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac68a316515298-5"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68a316515298-6"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac68a316515298-7"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68a316515298-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac68a316515298-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Next, we can define our LSTM model.</p>
<p>The model must specify the expected dimensionality of the input data. In this case, in terms of timesteps (1) and features (100). We will use a single hidden layer LSTM with 15 memory units.</p>
<p>The output layer is a fully connected layer (Dense) with 100 neurons for the 100 possible integers that may be output. A softmax activation function is used on the output layer to allow the network to learn and output the distribution over the possible output values.</p>
<p>The network will use the log loss function while training, suitable for multi-class classification problems, and the efficient ADAM optimization algorithm. The accuracy metric will be reported each training epoch to give an idea of the skill of the model in addition to the loss.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac68d646408197" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(LSTM(15, input_shape=(1, 100)))
model.add(Dense(100, activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac68d646408197-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68d646408197-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac68d646408197-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac68d646408197-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac68d646408197-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac68d646408197-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68d646408197-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac68d646408197-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac68d646408197-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac68d646408197-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We will fit the model manually by running each epoch by hand with a new generated sequence. The model will be fit for 500 epochs, or stated another way, trained on 500 randomly generated sequences.</p>
<p>This will encourage the network to learn to reproduce the actual input rather than memorizing a fixed training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac690932312466" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit model
for i in range(500):
	X, y = generate_data()
	model.fit(X, y, epochs=1, batch_size=1, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac690932312466-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac690932312466-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac690932312466-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac690932312466-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac690932312466-1"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac690932312466-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">500</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac690932312466-3"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac690932312466-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Once the model is fit, we will make a prediction on a new sequence and compare the predicted output to the expected output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac692817520495" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate model on new data
X, y = generate_data()
yhat = model.predict(X)
print('Expected:  %s' % one_hot_decode(y))
print('Predicted: %s' % one_hot_decode(yhat))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac692817520495-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac692817520495-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac692817520495-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac692817520495-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac692817520495-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac692817520495-1"><span class="crayon-p"># evaluate model on new data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac692817520495-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac692817520495-3"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac692817520495-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:  %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac692817520495-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Predicted: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac694947283266" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# convert to 3d for input
	X = encoded.reshape(encoded.shape[0], 1, encoded.shape[1])
	return X, encoded

# define model
model = Sequential()
model.add(LSTM(15, input_shape=(1, 100)))
model.add(Dense(100, activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
# fit model
for i in range(500):
	X, y = generate_data()
	model.fit(X, y, epochs=1, batch_size=1, verbose=2)
# evaluate model on new data
X, y = generate_data()
yhat = model.predict(X)
print('Expected:  %s' % one_hot_decode(y))
print('Predicted: %s' % one_hot_decode(yhat))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac694947283266-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-30">30</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-32">32</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-34">34</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-36">36</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-38">38</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-40">40</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-42">42</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-44">44</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-46">46</div><div class="crayon-num" data-line="crayon-5a6586deac694947283266-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac694947283266-48">48</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac694947283266-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-8"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-9"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-12"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-13"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-14"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-16"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-17"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-18"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-20"> </div><div class="crayon-line" id="crayon-5a6586deac694947283266-21"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-22"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-24"> </div><div class="crayon-line" id="crayon-5a6586deac694947283266-25"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-26"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-27"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-28"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-29"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-30"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-31"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-34"> </div><div class="crayon-line" id="crayon-5a6586deac694947283266-35"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-36"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-37"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-38"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-39"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-40"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-41"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">500</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-42"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-43"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-44"><span class="crayon-p"># evaluate model on new data</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-45"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-46"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac694947283266-47"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:  %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac694947283266-48"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Predicted: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0057 seconds] -->
<p>Running the example prints the log loss and accuracy each epoch.</p>
<p>The network is a little over-prescribed, having more memory units and training epochs than is required for such a simple problem, and you can see this by the fact that the network quickly achieves 100% accuracy.</p>
<p>At the end of the run, the predicted sequence is compared to a randomly generated sequence and the two look identical.</p>
<p>Your specific results may vary, but your network should converge to 100% accuracy because the network was larger and trained longer than the problem requires.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac698736228273" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
0s - loss: 0.0895 - acc: 1.0000
Epoch 1/1
0s - loss: 0.0785 - acc: 1.0000
Epoch 1/1
0s - loss: 0.0789 - acc: 1.0000
Epoch 1/1
0s - loss: 0.0832 - acc: 1.0000
Epoch 1/1
0s - loss: 0.0927 - acc: 1.0000
Expected: [18, 41, 49, 56, 86, 25, 96, 3, 75, 24, 57, 95, 81, 44, 2, 22, 76, 34, 41, 4, 69, 47, 1, 97, 57]
Predicted: [18, 41, 49, 56, 86, 25, 96, 3, 75, 24, 57, 95, 81, 44, 2, 22, 76, 34, 41, 4, 69, 47, 1, 97, 57]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac698736228273-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac698736228273-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac698736228273-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac698736228273-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac698736228273-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac698736228273-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac698736228273-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac698736228273-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-2">0s - loss: 0.0895 - acc: 1.0000</div><div class="crayon-line" id="crayon-5a6586deac698736228273-3">Epoch 1/1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-4">0s - loss: 0.0785 - acc: 1.0000</div><div class="crayon-line" id="crayon-5a6586deac698736228273-5">Epoch 1/1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-6">0s - loss: 0.0789 - acc: 1.0000</div><div class="crayon-line" id="crayon-5a6586deac698736228273-7">Epoch 1/1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-8">0s - loss: 0.0832 - acc: 1.0000</div><div class="crayon-line" id="crayon-5a6586deac698736228273-9">Epoch 1/1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-10">0s - loss: 0.0927 - acc: 1.0000</div><div class="crayon-line" id="crayon-5a6586deac698736228273-11">Expected: [18, 41, 49, 56, 86, 25, 96, 3, 75, 24, 57, 95, 81, 44, 2, 22, 76, 34, 41, 4, 69, 47, 1, 97, 57]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac698736228273-12">Predicted: [18, 41, 49, 56, 86, 25, 96, 3, 75, 24, 57, 95, 81, 44, 2, 22, 76, 34, 41, 4, 69, 47, 1, 97, 57]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now that we know how to use the tools to create and represent random sequences and to fit an LSTM to learn to echo the current sequence, let’s look at how we can use LSTMs to learn how to echo a past observation.</p>
<h2>Echo Lag Observation Without Context<br/>
(<em>The Beginners Mistake</em>)</h2>
<p>The problem of predicting a lag observation can be more formally defined as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac69a974213085" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat(t) = f(X(t-n))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac69a974213085-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac69a974213085-1">yhat(t) = f(X(t-n))</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Where the expected output for the current time step yhat(t) is defined as a function (f()) of a specific previous observation (X(t-n)).</p>
<p>The promise of LSTMs suggests that you can show examples to the network one at a time and that the network will use internal state to learn and to sufficiently remember prior observations in order to solve this problem.</p>
<p>Let’s try this out.</p>
<p>First, we must update the generate_data() function and re-define the problem.</p>
<p>Rather than using the same sequence for input and output, we will use a shifted version of the encoded sequence as input and a truncated version of the encoded sequence as output.</p>
<p>These changes are required in order to take a sequence of numbers, such as [1, 2, 3, 4], and turn them into a supervised learning problem with input (X) and output (y) components, such as:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac69d009233831" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X y
1, NaN
2, 1
3, 2
4, 3
NaN, 4</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac69d009233831-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac69d009233831-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac69d009233831-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac69d009233831-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac69d009233831-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac69d009233831-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac69d009233831-1">X y</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac69d009233831-2">1, NaN</div><div class="crayon-line" id="crayon-5a6586deac69d009233831-3">2, 1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac69d009233831-4">3, 2</div><div class="crayon-line" id="crayon-5a6586deac69d009233831-5">4, 3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac69d009233831-6">NaN, 4</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>In this example, you can see that the first and last rows do not contain sufficient data for the network to learn. This could be marked as a “no data” value and masked, but a simpler solution is to simply remove it from the dataset.</p>
<p>The updated generate_data() function is listed below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6a0548739800" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# drop first value from X
	X = encoded[1:, :]
	# convert to 3d for input
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# drop last value from y
	y = encoded[:-1, :]
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a0548739800-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6a0548739800-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6a0548739800-1"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-2"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-3"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-4"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-5"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-6"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-7"><span class="crayon-h"> </span><span class="crayon-p"># drop first value from X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-9"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-11"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a0548739800-12"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a0548739800-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We must test out this updated representation of the data to confirm it does what we expect. To do this, we can generate a sequence and review the decoded X and y values over the sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6a2599988239" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, y = generate_data()
for i in range(len(X)):
	a, b = argmax(X[i,0]), argmax(y[i])
	print(a, b)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6a2599988239-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a2599988239-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6a2599988239-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a2599988239-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6a2599988239-1"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a2599988239-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6a2599988239-3"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a2599988239-4"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The complete code listing for this sanity check is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6a4225403929" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# drop first value from X
	X = encoded[1:, :]
	# convert to 3d for input
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# drop last value from y
	y = encoded[:-1, :]
	return X, y

# test data generator
X, y = generate_data()
for i in range(len(X)):
	a, b = argmax(X[i,0]), argmax(y[i])
	print(a, b)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-30">30</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-32">32</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-34">34</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-36">36</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-38">38</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-40">40</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a4225403929-42">42</div><div class="crayon-num" data-line="crayon-5a6586deac6a4225403929-43">43</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6a4225403929-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-8"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-9"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-12"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-13"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-14"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-16"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-17"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-18"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-20"> </div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-21"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-22"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-24"> </div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-25"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-26"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-27"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-28"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-29"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-30"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-31"><span class="crayon-h"> </span><span class="crayon-p"># drop first value from X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-33"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-34"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-35"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-36"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-38"> </div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-39"><span class="crayon-p"># test data generator</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-40"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-41"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a4225403929-42"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6a4225403929-43"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0030 seconds] -->
<p>Running the example prints the X and y components of the problem framing.</p>
<p>We can see that the first pattern will be hard (impossible) for the network to learn given the cold start. We can see that the expected pattern of yhat(t) == X(t-1) down through the data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6a8427950986" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
78 65
7 78
16 7
11 16
23 11
99 23
39 99
53 39
82 53
6 82
18 6
17 18
49 17
4 49
34 4
77 34
46 77
22 46
40 22
76 40
85 76
87 85
17 87
75 17</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac6a8427950986-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6a8427950986-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6a8427950986-1">78 65</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-2">7 78</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-3">16 7</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-4">11 16</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-5">23 11</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-6">99 23</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-7">39 99</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-8">53 39</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-9">82 53</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-10">6 82</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-11">18 6</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-12">17 18</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-13">49 17</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-14">4 49</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-15">34 4</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-16">77 34</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-17">46 77</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-18">22 46</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-19">40 22</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-20">76 40</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-21">85 76</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-22">87 85</div><div class="crayon-line" id="crayon-5a6586deac6a8427950986-23">17 87</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6a8427950986-24">75 17</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The network design is similar, but with one small change.</p>
<p>Observations are shown to the network one at a time and a weight update is performed. Because we expect the state between observations to carry the information required to learn the prior observation, we need to ensure that this state is not reset after each batch (in this case, one batch is one training observation). We can do this by making the LSTM layer stateful and manually managing when the state is reset.</p>
<p>This involves setting the stateful argument to True on the LSTM layer and defining the input shape using the batch_input_shape argument that includes the dimensions [batchsize, timesteps, features].</p>
<p>There are 24 X,y pairs for a given random sequence, therefore a batch size of 6 was used (4 batches of 6 samples = 24 samples). Remember, a sequence is broken down into samples, and samples can be shown to the network in batches before an update to the network weights is performed. A large network size of 50 memory units is used, again to over-prescribe the capacity needed for the problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6ab104618704" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(50, batch_input_shape=(6, 1, 100), stateful=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6ab104618704-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6ab104618704-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, after each epoch (one iteration of a randomly generated sequence), the internal state of the network can be manually reset. The model is fit for 2,000 training epochs and care is made to not shuffle the samples within a sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6ad210680048" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit model
for i in range(2000):
	X, y = generate_data()
	model.fit(X, y, epochs=1, batch_size=6, verbose=2, shuffle=False)
	model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6ad210680048-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ad210680048-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6ad210680048-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ad210680048-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6ad210680048-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6ad210680048-1"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ad210680048-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">2000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6ad210680048-3"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ad210680048-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ad210680048-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Putting this all together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6af201517701" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# drop first value from X
	X = encoded[1:, :]
	# convert to 3d for input
	X = X.reshape(X.shape[0], 1, X.shape[1])
	# drop last value from y
	y = encoded[:-1, :]
	return X, y

# define model
model = Sequential()
model.add(LSTM(50, batch_input_shape=(6, 1, 100), stateful=True))
model.add(Dense(100, activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
# fit model
for i in range(2000):
	X, y = generate_data()
	model.fit(X, y, epochs=1, batch_size=6, verbose=2, shuffle=False)
	model.reset_states()
# evaluate model on new data
X, y = generate_data()
yhat = model.predict(X, batch_size=6)
print('Expected:  %s' % one_hot_decode(y))
print('Predicted: %s' % one_hot_decode(yhat))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-30">30</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-32">32</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-34">34</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-36">36</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-38">38</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-40">40</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-42">42</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-44">44</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-46">46</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-48">48</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-50">50</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6af201517701-52">52</div><div class="crayon-num" data-line="crayon-5a6586deac6af201517701-53">53</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6af201517701-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-8"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-9"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-12"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-13"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-14"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-15"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-16"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-17"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-18"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-20"> </div><div class="crayon-line" id="crayon-5a6586deac6af201517701-21"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-22"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-24"> </div><div class="crayon-line" id="crayon-5a6586deac6af201517701-25"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-26"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-27"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-28"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-29"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-30"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-31"><span class="crayon-h"> </span><span class="crayon-p"># drop first value from X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-33"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-34"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-35"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-36"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-37"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-38"> </div><div class="crayon-line" id="crayon-5a6586deac6af201517701-39"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-40"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-43"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-44"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-45"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">2000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-46"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-47"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-48"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-49"><span class="crayon-p"># evaluate model on new data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-50"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-51"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">6</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6af201517701-52"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:  %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6af201517701-53"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Predicted: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0036 seconds] -->
<p>Running the example gives a surprising result.</p>
<p>The problem cannot be learned and training ends with a model with 0% accuracy of echoing the last observation in the sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6b2243889448" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
0s - loss: 4.6042 - acc: 0.0417
Epoch 1/1
0s - loss: 4.6215 - acc: 0.0000e+00
Epoch 1/1
0s - loss: 4.5802 - acc: 0.0000e+00
Epoch 1/1
0s - loss: 4.6023 - acc: 0.0000e+00
Epoch 1/1
0s - loss: 4.6071 - acc: 0.0000e+00
Expected: [71, 44, 6, 11, 91, 23, 55, 37, 53, 4, 42, 15, 81, 6, 57, 97, 49, 69, 56, 86, 70, 12, 61, 48]
Predicted: [49, 49, 49, 87, 49, 96, 96, 96, 96, 96, 85, 96, 96, 96, 96, 96, 96, 96, 49, 49, 87, 96, 49, 49]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6b2243889448-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6b2243889448-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6b2243889448-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-3">0s - loss: 4.6042 - acc: 0.0417</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-5">0s - loss: 4.6215 - acc: 0.0000e+00</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-7">0s - loss: 4.5802 - acc: 0.0000e+00</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-9">0s - loss: 4.6023 - acc: 0.0000e+00</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-11">0s - loss: 4.6071 - acc: 0.0000e+00</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6b2243889448-12">Expected: [71, 44, 6, 11, 91, 23, 55, 37, 53, 4, 42, 15, 81, 6, 57, 97, 49, 69, 56, 86, 70, 12, 61, 48]</div><div class="crayon-line" id="crayon-5a6586deac6b2243889448-13">Predicted: [49, 49, 49, 87, 49, 96, 96, 96, 96, 96, 85, 96, 96, 96, 96, 96, 96, 96, 49, 49, 87, 96, 49, 49]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>How can this be?</p>
<h3>The Beginner’s Mistake</h3>
<p>This is a common mistake made by beginners, and if you have been around the block with RNNs or LSTMs, then you would have spotted this error above.</p>
<p>Specifically, the power of LSTMs does come from the learned internal state maintained, but this state is only powerful if it is trained as a function over past observations.</p>
<p>Stated another way, you must provide the network the context for the prediction (e.g. the observations that may contain the temporal dependence) as time steps on the input.</p>
<p>The above formulation trained the network to learn the output as a function only of the current input value, as in the first example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6b9762346145" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat(t) = f(X(t))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6b9762346145-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6b9762346145-1">yhat(t) = f(X(t))</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Not as a function of the last n observations, or even just the previous observation, as we require:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6bc336577272" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat(t) = f(X(t-1))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6bc336577272-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6bc336577272-1">yhat(t) = f(X(t-1))</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The LSTM does only need one input at a time in order to learn this unknown temporal dependence, but it must perform backpropagation over the sequence in order to learn this dependence. You must provide the past observations of the sequence as context.</p>
<p>You are not defining a window (as in the case of Multilayer Perceptron where each past observation is a weighted input); instead, you are defining an extent of historical observations from which the LSTM will attempt to learn the temporal dependence (f(X(t-1), … X(t-n))).</p>
<p>To be clear, this is the beginner’s mistake when using LSTMs in Keras, and not necessarily in general.</p>
<h2>Echo Lag Observation</h2>
<p>Now that we have navigated around a common pitfall for beginners, we can develop an LSTM to echo the previous observation.</p>
<p>The first step is to reformulate the definition of the problem, again.</p>
<p>We know that the network only requires the last observation as input in order to make correct predictions. But we want the network to learn which of the past observations to echo in order to correctly solve this problem. Therefore, we will provide a subsequence of the last 5 observation as context.</p>
<p>Specifically, if our sequence contains: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], the X,y pairs would look as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6bf490236981" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, 							y
NaN, NaN, NaN, NaN, NaN, 	NaN
NaN, NaN, NaN, NaN, 1, 		NaN
NaN, NaN, NaN, 1, 2, 		1
NaN, NaN, 1, 2, 3, 			2
NaN, 1, 2, 3, 4, 			3
1, 2, 3, 4, 5, 				4
2, 3, 4, 5, 6, 				5
3, 4, 5, 6, 7, 				6
4, 5, 6, 7, 8, 				7
5, 6, 7, 8, 9, 				8
6, 7, 8, 9, 10, 			9
7, 8, 9, 10, NaN, 			10</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6bf490236981-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6bf490236981-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6bf490236981-1">X, 							y</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-2">NaN, NaN, NaN, NaN, NaN, 	NaN</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-3">NaN, NaN, NaN, NaN, 1, 		NaN</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-4">NaN, NaN, NaN, 1, 2, 		1</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-5">NaN, NaN, 1, 2, 3, 			2</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-6">NaN, 1, 2, 3, 4, 			3</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-7">1, 2, 3, 4, 5, 				4</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-8">2, 3, 4, 5, 6, 				5</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-9">3, 4, 5, 6, 7, 				6</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-10">4, 5, 6, 7, 8, 				7</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-11">5, 6, 7, 8, 9, 				8</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6bf490236981-12">6, 7, 8, 9, 10, 			9</div><div class="crayon-line" id="crayon-5a6586deac6bf490236981-13">7, 8, 9, 10, NaN, 			10</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>In this case, you can see that the first 5 rows and the last 1 row do not contain enough data, so in this case, we will remove them.</p>
<p>We will use the Pandas shift() function to create shifted versions of the sequence and the Pandas concat() function to recombine the shifted sequences back together. We will then manually exclude the rows that are not viable.</p>
<p>The updated generate_data() function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6c1041299875" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# create lag inputs
	df = DataFrame(encoded)
	df = concat([df.shift(4), df.shift(3), df.shift(2), df.shift(1), df], axis=1)
	# remove non-viable rows
	values = df.values
	values = values[5:,:]
	# convert to 3d for input
	X = values.reshape(len(values), 5, 100)
	# drop last value from y
	y = encoded[4:-1,:]
	print(X.shape, y.shape)
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6c1041299875-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c1041299875-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6c1041299875-1"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-2"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-3"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-4"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-5"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-6"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-7"><span class="crayon-h"> </span><span class="crayon-p"># create lag inputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-8"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-9"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-10"><span class="crayon-h"> </span><span class="crayon-p"># remove non-viable rows</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-11"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-12"><span class="crayon-e"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-cn">5</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-13"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-14"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-15"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-16"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c1041299875-17"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c1041299875-18"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>Again, we can sanity check this updated function by generating a sequence and comparing the decoded X,y pairs. The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6c4182000228" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from pandas import concat
from pandas import DataFrame
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# create lag inputs
	df = DataFrame(encoded)
	df = concat([df.shift(4), df.shift(3), df.shift(2), df.shift(1), df], axis=1)
	# remove non-viable rows
	values = df.values
	values = values[5:,:]
	# convert to 3d for input
	X = values.reshape(len(values), 5, 100)
	# drop last value from y
	y = encoded[4:-1,:]
	return X, y

# test data generator
X, y = generate_data()
for i in range(len(X)):
	a, b, c, d, e, f = argmax(X[i,0]), argmax(X[i,1]), argmax(X[i,2]), argmax(X[i,3]), argmax(X[i,4]), argmax(y[i])
	print(a, b, c, d, e, f)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-30">30</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-32">32</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-34">34</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-36">36</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-38">38</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-40">40</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-42">42</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-44">44</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-46">46</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c4182000228-48">48</div><div class="crayon-num" data-line="crayon-5a6586deac6c4182000228-49">49</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6c4182000228-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-10"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-11"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-14"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-15"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-16"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-18"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-19"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-20"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-22"> </div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-23"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-24"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-26"> </div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-27"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-28"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-29"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-30"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-31"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-32"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-33"><span class="crayon-h"> </span><span class="crayon-p"># create lag inputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-34"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-35"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-36"><span class="crayon-h"> </span><span class="crayon-p"># remove non-viable rows</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-37"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-38"><span class="crayon-e"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-cn">5</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-39"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-40"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-41"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-42"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-44"> </div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-45"><span class="crayon-p"># test data generator</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-46"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-47"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c4182000228-48"><span class="crayon-h"> </span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6c4182000228-49"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">a</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">d</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0044 seconds] -->
<p>Running the example shows the context of the last 5 values as input and the last prior observation (X(t-1)) as output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6c7329173235" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
57 96 99 77 44 77
96 99 77 44 45 44
99 77 44 45 28 45
77 44 45 28 70 28
44 45 28 70 73 70
45 28 70 73 74 73
28 70 73 74 73 74
70 73 74 73 64 73
73 74 73 64 29 64
74 73 64 29 15 29
73 64 29 15 94 15
64 29 15 94 98 94
29 15 94 98 89 98
15 94 98 89 52 89
94 98 89 52 96 52
98 89 52 96 46 96
89 52 96 46 46 46
52 96 46 46 85 46
96 46 46 85 49 85
46 46 85 49 59 49</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6c7329173235-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6c7329173235-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6c7329173235-1">57 96 99 77 44 77</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-2">96 99 77 44 45 44</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-3">99 77 44 45 28 45</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-4">77 44 45 28 70 28</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-5">44 45 28 70 73 70</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-6">45 28 70 73 74 73</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-7">28 70 73 74 73 74</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-8">70 73 74 73 64 73</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-9">73 74 73 64 29 64</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-10">74 73 64 29 15 29</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-11">73 64 29 15 94 15</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-12">64 29 15 94 98 94</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-13">29 15 94 98 89 98</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-14">15 94 98 89 52 89</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-15">94 98 89 52 96 52</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-16">98 89 52 96 46 96</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-17">89 52 96 46 46 46</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-18">52 96 46 46 85 46</div><div class="crayon-line" id="crayon-5a6586deac6c7329173235-19">96 46 46 85 49 85</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6c7329173235-20">46 46 85 49 59 49</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can now develop an LSTM to learn this problem.</p>
<p>There are 20 X,y pairs for a given sequence; therefore, a batch size of 5 was chosen (4 batches of 5 examples = 20 samples).</p>
<p>The same structure was used with 50 memory units in the LSTM hidden layer and 100 neurons in the output layer. The network was fit for 2,000 epochs with internal state reset after each epoch.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6ca938432225" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from pandas import concat
from pandas import DataFrame
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random numbers in [0, 99]
def generate_sequence(length=25):
	return [randint(0, 99) for _ in range(length)]

# one hot encode sequence
def one_hot_encode(sequence, n_unique=100):
	encoding = list()
	for value in sequence:
		vector = [0 for _ in range(n_unique)]
		vector[value] = 1
		encoding.append(vector)
	return array(encoding)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# generate data for the lstm
def generate_data():
	# generate sequence
	sequence = generate_sequence()
	# one hot encode
	encoded = one_hot_encode(sequence)
	# create lag inputs
	df = DataFrame(encoded)
	df = concat([df.shift(4), df.shift(3), df.shift(2), df.shift(1), df], axis=1)
	# remove non-viable rows
	values = df.values
	values = values[5:,:]
	# convert to 3d for input
	X = values.reshape(len(values), 5, 100)
	# drop last value from y
	y = encoded[4:-1,:]
	return X, y

# define model
model = Sequential()
model.add(LSTM(50, batch_input_shape=(5, 5, 100), stateful=True))
model.add(Dense(100, activation='softmax'))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])
# fit model
for i in range(2000):
	X, y = generate_data()
	model.fit(X, y, epochs=1, batch_size=5, verbose=2, shuffle=False)
	model.reset_states()
# evaluate model on new data
X, y = generate_data()
yhat = model.predict(X, batch_size=5)
print('Expected:  %s' % one_hot_decode(y))
print('Predicted: %s' % one_hot_decode(yhat))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-14">14</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-16">16</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-18">18</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-20">20</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-22">22</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-24">24</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-26">26</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-28">28</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-30">30</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-32">32</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-34">34</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-36">36</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-38">38</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-40">40</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-42">42</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-44">44</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-46">46</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-48">48</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-50">50</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-52">52</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-54">54</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-56">56</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6ca938432225-58">58</div><div class="crayon-num" data-line="crayon-5a6586deac6ca938432225-59">59</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6ca938432225-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-10"><span class="crayon-p"># generate a sequence of random numbers in [0, 99]</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-11"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-o">=</span><span class="crayon-cn">25</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">99</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-14"><span class="crayon-p"># one hot encode sequence</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-15"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-16"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">value </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-18"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-19"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-20"><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">encoding</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-22"> </div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-23"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-24"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-25"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-26"> </div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-27"><span class="crayon-p"># generate data for the lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-28"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-29"><span class="crayon-h"> </span><span class="crayon-p"># generate sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-30"><span class="crayon-h"> </span><span class="crayon-v">sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-31"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-32"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-33"><span class="crayon-h"> </span><span class="crayon-p"># create lag inputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-34"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-35"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-36"><span class="crayon-h"> </span><span class="crayon-p"># remove non-viable rows</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-37"><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-38"><span class="crayon-e"> </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-cn">5</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-39"><span class="crayon-h"> </span><span class="crayon-p"># convert to 3d for input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-40"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-41"><span class="crayon-h"> </span><span class="crayon-p"># drop last value from y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-42"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-sy">[</span><span class="crayon-cn">4</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-44"> </div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-45"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-46"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-47"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-48"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-49"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-50"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-51"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">2000</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-52"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-55"><span class="crayon-p"># evaluate model on new data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-56"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-57"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6ca938432225-58"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected:  %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586deac6ca938432225-59"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Predicted: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0048 seconds] -->
<p>Running the example shows that the network can fit the problem and correctly learn to return the X(t-1) observation as prediction within the context of 5 prior observations.</p>
<p>Example output is provided below; your specific outputs may differ given different random sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586deac6cd452168707" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
0s - loss: 0.1763 - acc: 1.0000
Epoch 1/1
0s - loss: 0.2393 - acc: 0.9500
Epoch 1/1
0s - loss: 0.1674 - acc: 1.0000
Epoch 1/1
0s - loss: 0.1256 - acc: 1.0000
Epoch 1/1
0s - loss: 0.1539 - acc: 1.0000
Expected: [24, 49, 86, 73, 51, 6, 6, 52, 34, 32, 0, 14, 83, 16, 37, 75, 41, 40, 80, 33]
Predicted: [24, 49, 86, 73, 51, 6, 6, 52, 34, 32, 0, 14, 83, 16, 37, 75, 41, 40, 80, 33]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-2">2</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-4">4</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-6">6</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-8">8</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-10">10</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586deac6cd452168707-12">12</div><div class="crayon-num" data-line="crayon-5a6586deac6cd452168707-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586deac6cd452168707-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-3">0s - loss: 0.1763 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-4">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-5">0s - loss: 0.2393 - acc: 0.9500</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-6">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-7">0s - loss: 0.1674 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-8">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-9">0s - loss: 0.1256 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-10">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-11">0s - loss: 0.1539 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586deac6cd452168707-12">Expected: [24, 49, 86, 73, 51, 6, 6, 52, 34, 32, 0, 14, 83, 16, 37, 75, 41, 40, 80, 33]</div><div class="crayon-line" id="crayon-5a6586deac6cd452168707-13">Predicted: [24, 49, 86, 73, 51, 6, 6, 52, 34, 32, 0, 14, 83, 16, 37, 75, 41, 40, 80, 33]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some extensions to the experiments in this tutorial.</p>
<ul>
<li><strong>Ignore Internal State</strong>. Care was taken to preserve internal state of the LSTMs across samples within a sequence by manually resetting state at the end of the epoch. We know that the network already has all the context and state required within each sample via timesteps. Explore whether the additional cross-sample state adds any benefit to the skill of the model.</li>
<li><strong>Mask Missing Data</strong>. During data preparation, rows with missing data were removed. Explore the use of marking missing values with a special value (e.g. -1) and seeing whether the LSTM can learn from these examples. Also explore the use of a Masking layer as input and explore masking out missing values.</li>
<li><strong>Entire Sequence as Timesteps</strong>. A context of only the last 5 observations were provided as context from which to learn to echo. Explore using the entire random sequence as context for each sample, built-up as the sequence unfolds. This may require padding and even masking of missing values to meet the expectation of fixed-sized inputs to the LSTM.</li>
<li><strong>Echo Different Lag Value</strong>. A specific lag value (t-1) was used in the echo example. Explore using a different lag value in the echo and how this affects properties such as model skill, training time, and LSTM layer size. I would expect that each lag could be learned using the same model structure.</li>
<li><strong>Echo Lag Sequence</strong>. The network was trained to echo a specific lag observation. Explore variations where a lag sequence is echoed. This may require the use of the TimeDistributed layer on the output of the network to achieve sequence to sequence prediction.</li>
</ul>
<p>Did you explore any of these extensions?<br/>
Share your findings in the comments below.</p>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an LSTM to address the problem of echoing a lag observation from a random sequence of integers.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to generate and encode test data for the problem.</li>
<li>How to avoid the beginner’s mistake when attempting to address this and similar problems with LSTMs.</li>
<li>How to develop a robust LSTM to echo integers in an ad hoc sequence of random integers.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-echo-random-integers-long-short-term-memory-recurrent-neural-networks%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+Recurrent+Neural+Networks+are+able+to+learn+the+order+dependence+in+lo..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Learn%20to%20Echo%20Random%20Integers%20with%20Long%20Short-Term%20Memory%20Recurrent%20Neural%20Networks&amp;url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+Recurrent+Neural+Networks+are+able+to+learn+the+order+dependence+in+lo...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/5-step-life-cycle-long-short-term-memory-models-keras/" rel="prev"><i class="fa fa-angle-left"></i> The 5 Step Life-Cycle for Long Short-Term Memory Models in Keras</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-use-an-encoder-decoder-lstm-to-echo-sequences-of-random-integers/" rel="next">How to use an Encoder-Decoder LSTM to Echo Sequences of Random Integers <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">6 Responses to <em>How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-401975">
<div class="comment-container" id="li-comment-401975">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ea5cdfb7c748f441f792fb4847bdf728?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ea5cdfb7c748f441f792fb4847bdf728?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.integritt-e.com" rel="external nofollow">Shirish Ranade</a></span>
<span class="date">June 9, 2017 at 12:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-401975" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Wow,</p>
<p>That is neat. 100% accuracy !!</p>
<p>Will this work with binomial classification problem as well?</p>
<div class="reply">
<a aria-label="Reply to Shirish Ranade" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=401975#respond" onclick='return addComment.moveForm( "comment-401975", "401975", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-402068">
<div class="comment-container" id="li-comment-402068">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 10, 2017 at 8:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-402068" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a special case of a well defined small problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=402068#respond" onclick='return addComment.moveForm( "comment-402068", "402068", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415561">
<div class="comment-container" id="li-comment-415561">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f4c9f4bd06336f31d7773dc610a47185?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f4c9f4bd06336f31d7773dc610a47185?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">MOHD SAIFUL BAHRI IBRAHIM</span>
<span class="date">October 4, 2017 at 12:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-415561" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very good …thank u</p>
<div class="reply">
<a aria-label="Reply to MOHD SAIFUL BAHRI IBRAHIM" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=415561#respond" onclick='return addComment.moveForm( "comment-415561", "415561", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415580">
<div class="comment-container" id="li-comment-415580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 4, 2017 at 3:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-415580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=415580#respond" onclick='return addComment.moveForm( "comment-415580", "415580", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419182">
<div class="comment-container" id="li-comment-419182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8fa687c58de58b5f27a5077c6f9be7cb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8fa687c58de58b5f27a5077c6f9be7cb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Scott</span>
<span class="date">November 7, 2017 at 8:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-419182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, would you clarify the remark, “You are not defining a window (as in the case of Multilayer Perceptron where each past observation is a weighted input); instead, you are defining an extent of historical observations”?  It seems that defining a window of weighted inputs is exactly what we are doing:  We are feeding in a series of windows, and the LSTM is learning to pick out one element from that window.</p>
<div class="reply">
<a aria-label="Reply to Scott" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=419182#respond" onclick='return addComment.moveForm( "comment-419182", "419182", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419210">
<div class="comment-container" id="li-comment-419210">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2017 at 9:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#comment-419210" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not quite, the LSTM processes time steps one at a time, not a weighting of all lag obs as in an MLP with a window.</p>
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/?replytocom=419210#respond" onclick='return addComment.moveForm( "comment-419210", "419210", "respond", "4072" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4072"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="88d060c08f"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="118"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>