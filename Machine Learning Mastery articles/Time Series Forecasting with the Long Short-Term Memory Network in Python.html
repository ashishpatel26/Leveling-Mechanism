<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Time Series Forecasting with the Long Short-Term Memory Network in Python - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Time Series Forecasting with the Long Short-Term Memory Network in Python - Machine Learning Mastery" property="og:title"/>
<meta content="The Long Short-Term Memory recurrent neural network has the promise of learning long sequences of observations. It seems a perfect match for time series forecasting, and in fact, it may be. In this tutorial, you will discover how to develop an LSTM forecast model for a one-step univariate time series forecasting problem. After completing this …" property="og:description"/>
<meta content="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-04-07T05:00:50+11:00" property="article:published_time"/>
<meta content="2017-07-20T08:57:40+11:00" property="article:modified_time"/>
<meta content="2017-07-20T08:57:40+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="480" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/time-series-forecasting-long-short-term-memory-network-python\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/feed/" rel="alternate" title="Machine Learning Mastery » Time Series Forecasting with the Long Short-Term Memory Network in Python Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=3882" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-forecasting-long-short-term-memory-network-python%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-forecasting-long-short-term-memory-network-python%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-3882 single-format-standard gecko alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-3882 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">Time Series Forecasting with the Long Short-Term Memory Network in Python</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-04-07T05:00:50+1100">April 7, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-forecasting-long-short-term-memory-network-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/&amp;summary=The+Long+Short-Term+Memory+recurrent+neural+network+has+the+promise+of+learning+long+sequences+of+ob..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/&amp;summary=The+Long+Short-Term+Memory+recurrent+neural+network+has+the+promise+of+learning+long+sequences+of+ob...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>The Long Short-Term Memory recurrent neural network has the promise of learning long sequences of observations.</p>
<p>It seems a perfect match for time series forecasting, and in fact, it may be.</p>
<p>In this tutorial, you will discover how to develop an LSTM forecast model for a one-step univariate time series forecasting problem.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop a baseline of performance for a forecast problem.</li>
<li>How to design a robust test harness for one-step time series forecasting.</li>
<li>How to prepare data, develop, and evaluate an LSTM recurrent neural network for time series forecasting.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Update May/2017</strong>: Fixed bug in invert_scale() function, thanks Max.</li>
</ul>
<div class="wp-caption aligncenter" id="attachment_3886" style="max-width: 650px"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="size-full wp-image-3886" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-300x225.jpg 300w" width="640"/><p class="wp-caption-text">Time Series Forecasting with the Long Short-Term Memory Network in Python<br/>Photo by <a href="https://www.flickr.com/photos/qmnonic/179791867/">Matt MacGillivray</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This is a big topic and we are going to cover a lot of ground. Strap in.</p>
<p>This tutorial is broken down into 9 parts; they are:</p>
<ol>
<li>Shampoo Sales Dataset</li>
<li>Test Setup</li>
<li>Persistence Model Forecast</li>
<li>LSTM Data Preparation</li>
<li>LSTM Model Development</li>
<li>LSTM Forecast</li>
<li>Complete LSTM Example</li>
<li>Develop a Robust Result</li>
<li>Tutorial Extensions</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this tutorial.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Shampoo Sales Dataset</h2>
<p>This dataset describes the monthly number of sales of shampoo over a 3-year period.</p>
<p>The units are a sales count and there are 36 observations. The original dataset is credited to Makridakis, Wheelwright, and Hyndman (1998).</p>
<p><a href="https://datamarket.com/data/set/22r0/sales-of-shampoo-over-a-three-year-period">You can download and learn more about the dataset here</a>.</p>
<p>Download the dataset to your current working directory with the name “<em>shampoo-sales.csv</em>“. Note that you may need to delete the footer information added by DataMarket.</p>
<p>The example below loads and creates a plot of the loaded dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de569513262586" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load and plot dataset
from pandas import read_csv
from pandas import datetime
from matplotlib import pyplot
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# summarize first few rows
print(series.head())
# line plot
series.plot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de569513262586-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de569513262586-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de569513262586-1"><span class="crayon-p"># load and plot dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-4"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-6"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-8"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-9"><span class="crayon-p"># summarize first few rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-11"><span class="crayon-p"># line plot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de569513262586-12"><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de569513262586-13"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Running the example loads the dataset as a Pandas Series and prints the first 5 rows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de573063478977" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01 266.0
1901-02-01 145.9
1901-03-01 183.1
1901-04-01 119.3
1901-05-01 180.3
Name: Sales, dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de573063478977-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de573063478977-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de573063478977-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de573063478977-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de573063478977-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de573063478977-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de573063478977-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de573063478977-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de573063478977-2">1901-01-01 266.0</div><div class="crayon-line" id="crayon-5a6591c7de573063478977-3">1901-02-01 145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de573063478977-4">1901-03-01 183.1</div><div class="crayon-line" id="crayon-5a6591c7de573063478977-5">1901-04-01 119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de573063478977-6">1901-05-01 180.3</div><div class="crayon-line" id="crayon-5a6591c7de573063478977-7">Name: Sales, dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the series is then created showing a clear increasing trend.</p>
<div class="wp-caption aligncenter" id="attachment_3867" style="max-width: 650px"><img alt="Line Plot of Monthly Shampoo Sales Dataset" class="size-full wp-image-3867" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Monthly-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Monthly-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-Monthly-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of Monthly Shampoo Sales Dataset</p></div>
<h2>Experimental Test Setup</h2>
<p>We will split the Shampoo Sales dataset into two parts: a training and a test set.</p>
<p>The first two years of data will be taken for the training dataset and the remaining one year of data will be used for the test set.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de576394274432" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split data into train and test
X = series.values
train, test = X[0:-12], X[-12:]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de576394274432-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de576394274432-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de576394274432-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de576394274432-1"><span class="crayon-p"># split data into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de576394274432-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a6591c7de576394274432-3"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Models will be developed using the training dataset and will make predictions on the test dataset.</p>
<p>A rolling forecast scenario will be used, also called walk-forward model validation.</p>
<p>Each time step of the test dataset will be walked one at a time. A model will be used to make a forecast for the time step, then the actual expected value from the test set will be taken and made available to the model for the forecast on the next time step.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de579102076655" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# walk-forward validation
history = [x for x in train]
predictions = list()
for i in range(len(test)):
	# make prediction...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de579102076655-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de579102076655-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de579102076655-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de579102076655-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de579102076655-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de579102076655-1"><span class="crayon-p"># walk-forward validation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de579102076655-2"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de579102076655-3"><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de579102076655-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de579102076655-5"><span class="crayon-h"> </span><span class="crayon-p"># make prediction...</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>This mimics a real-world scenario where new Shampoo Sales observations would be available each month and used in the forecasting of the following month.</p>
<p>Finally, all forecasts on the test dataset will be collected and an error score calculated to summarize the skill of the model. The root mean squared error (RMSE) will be used as it punishes large errors and results in a score that is in the same units as the forecast data, namely monthly shampoo sales.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de57c947572869" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from sklearn.metrics import mean_squared_error
rmse = sqrt(mean_squared_error(test, predictions))
print('RMSE: %.3f' % rmse)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de57c947572869-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de57c947572869-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de57c947572869-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de57c947572869-1"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de57c947572869-2"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de57c947572869-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h2>Persistence Model Forecast</h2>
<p>A good baseline forecast for a time series with a linear increasing trend is a persistence forecast.</p>
<p>The persistence forecast is where the observation from the prior time step (t-1) is used to predict the observation at the current time step (t).</p>
<p>We can implement this by taking the last observation from the training data and history accumulated by walk-forward validation and using that to predict the current time step.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de57e964674918" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make prediction
yhat = history[-1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de57e964674918-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de57e964674918-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de57e964674918-1"><span class="crayon-p"># make prediction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de57e964674918-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We will accumulate all predictions in an array so that they can be directly compared to the test dataset.</p>
<p>The complete example of the persistence forecast model on the Shampoo Sales dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de581409717072" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from math import sqrt
from matplotlib import pyplot
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# split data into train and test
X = series.values
train, test = X[0:-12], X[-12:]
# walk-forward validation
history = [x for x in train]
predictions = list()
for i in range(len(test)):
	# make prediction
	predictions.append(history[-1])
	# observation
	history.append(test[i])
# report performance
rmse = sqrt(mean_squared_error(test, predictions))
print('RMSE: %.3f' % rmse)
# line plot of observed vs predicted
pyplot.plot(test)
pyplot.plot(predictions)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de581409717072-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7de581409717072-27">27</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de581409717072-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-3"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-4"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-5"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-6"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-7"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-9"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-10"><span class="crayon-p"># split data into train and test</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-11"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-12"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-13"><span class="crayon-p"># walk-forward validation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-14"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-15"><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-16"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-17"><span class="crayon-h"> </span><span class="crayon-p"># make prediction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-18"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-19"><span class="crayon-h"> </span><span class="crayon-p"># observation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-20"><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-21"><span class="crayon-p"># report performance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-22"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-23"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-24"><span class="crayon-p"># line plot of observed vs predicted</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-25"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de581409717072-26"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de581409717072-27"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>Running the example prints the RMSE of about 136 monthly shampoo sales for the forecasts on the test dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de584940568397" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
RMSE: 136.761</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de584940568397-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de584940568397-1">RMSE: 136.761</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test dataset (blue) compared to the predicted values (orange) is also created showing the persistence model forecast in context.</p>
<div class="wp-caption aligncenter" id="attachment_3883" style="max-width: 650px"><img alt="Persistence Forecast of Observed vs Predicted for Shampoo Sales Dataset" class="size-full wp-image-3883" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Persistence-Forecast-of-Observed-vs-Predicted-for-Shampoo-Sales-Dataset.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Persistence-Forecast-of-Observed-vs-Predicted-for-Shampoo-Sales-Dataset.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Persistence-Forecast-of-Observed-vs-Predicted-for-Shampoo-Sales-Dataset-300x225.png 300w" width="640"/><p class="wp-caption-text">Persistence Forecast of Observed vs Predicted for Shampoo Sales Dataset</p></div>
<p>For more on the persistence model for time series forecasting, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/persistence-time-series-forecasting-with-python/">How to Make Baseline Predictions for Time Series Forecasting with Python</a></li>
</ul>
<p>Now that we have a baseline of performance on the dataset, we can get started developing an LSTM model for the data.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>LSTM Data Preparation</h2>
<p>Before we can fit an LSTM model to the dataset, we must transform the data.</p>
<p>This section is broken down into three steps:</p>
<ol>
<li>Transform the time series into a supervised learning problem</li>
<li>Transform the time series data so that it is stationary.</li>
<li>Transform the observations to have a specific scale.</li>
</ol>
<h3>Transform Time Series to Supervised Learning</h3>
<p>The LSTM model in Keras assumes that your data is divided into input (X) and output (y) components.</p>
<p>For a time series problem, we can achieve this by using the observation from the last time step (t-1) as the input and the observation at the current time step (t) as the output.</p>
<p>We can achieve this using the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.shift.html">shift()</a> function in Pandas that will push all values in a series down by a specified number places. We require a shift of 1 place, which will become the input variables. The time series as it stands will be the output variables.</p>
<p>We can then concatenate these two series together to create a DataFrame ready for supervised learning. The pushed-down series will have a new position at the top with no value. A NaN (not a number) value will be used in this position. We will replace these NaN values with 0 values, which the LSTM model will have to learn as “the start of the series” or “I have no data here,” as a month with zero sales on this dataset has not been observed.</p>
<p>The code below defines a helper function to do this called <em>timeseries_to_supervised()</em>. It takes a NumPy array of the raw time series data and a lag or number of shifted series to create and use as inputs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de587951650781" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df.fillna(0, inplace=True)
	return df</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de587951650781-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de587951650781-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de587951650781-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de587951650781-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de587951650781-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de587951650781-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de587951650781-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de587951650781-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de587951650781-1"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de587951650781-2"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de587951650781-3"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de587951650781-4"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de587951650781-5"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de587951650781-6"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de587951650781-7"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">fillna</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de587951650781-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We can test this function with our loaded Shampoo Sales dataset and convert it into a supervised learning problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de58a767460377" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from pandas import datetime
from pandas import DataFrame
from pandas import concat

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df.fillna(0, inplace=True)
	return df

# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
# transform to supervised learning
X = series.values
supervised = timeseries_to_supervised(X, 1)
print(supervised.head())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de58a767460377-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58a767460377-22">22</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de58a767460377-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">concat</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-6"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-7"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-8"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-9"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-10"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-11"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-12"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">fillna</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-14"> </div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-15"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-16"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-18"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-19"><span class="crayon-p"># transform to supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-20"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a6591c7de58a767460377-21"><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58a767460377-22"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>Running the example prints the first 5 rows of the new supervised learning problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de58c073717291" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
            0           0
0    0.000000  266.000000
1  266.000000  145.899994
2  145.899994  183.100006
3  183.100006  119.300003
4  119.300003  180.300003</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de58c073717291-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58c073717291-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de58c073717291-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58c073717291-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de58c073717291-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de58c073717291-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de58c073717291-1">            0           0</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58c073717291-2">0    0.000000  266.000000</div><div class="crayon-line" id="crayon-5a6591c7de58c073717291-3">1  266.000000  145.899994</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58c073717291-4">2  145.899994  183.100006</div><div class="crayon-line" id="crayon-5a6591c7de58c073717291-5">3  183.100006  119.300003</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de58c073717291-6">4  119.300003  180.300003</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>For more information on transforming a time series problem into a supervised learning problem, see the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/">Time Series Forecasting as Supervised Learning</a></li>
</ul>
<h3>Transform Time Series to Stationary</h3>
<p>The Shampoo Sales dataset is not stationary.</p>
<p>This means that there is a structure in the data that is dependent on the time. Specifically, there is an increasing trend in the data.</p>
<p>Stationary data is easier to model and will very likely result in more skillful forecasts.</p>
<p>The trend can be removed from the observations, then added back to forecasts later to return the prediction to the original scale and calculate a comparable error score.</p>
<p>A standard way to remove a trend is by differencing the data. That is the observation from the previous time step (t-1) is subtracted from the current observation (t). This removes the trend and we are left with a difference series, or the changes to the observations from one time step to the next.</p>
<p>We can achieve this automatically using the <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.diff.html">diff() function</a> in pandas. Alternatively, we can get finer grained control and write our own function to do this, which is preferred for its flexibility in this case.</p>
<p>Below is a function called <em>difference()</em> that calculates a differenced series. Note that the first observation in the series is skipped as there is no prior observation with which to calculate a differenced value.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de590031147869" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de590031147869-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de590031147869-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de590031147869-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de590031147869-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de590031147869-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de590031147869-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de590031147869-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de590031147869-1"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de590031147869-2"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de590031147869-3"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de590031147869-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de590031147869-5"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de590031147869-6"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de590031147869-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>We also need to invert this process in order to take forecasts made on the differenced series back into their original scale.</p>
<p>The function below, called <em>inverse_difference()</em>, inverts this operation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de592154314657" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de592154314657-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de592154314657-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de592154314657-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de592154314657-1"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de592154314657-2"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de592154314657-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can test out these functions by differencing the whole series, then returning it to the original scale, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de594852128058" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from pandas import datetime
from pandas import Series

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]

# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
print(series.head())
# transform to be stationary
differenced = difference(series, 1)
print(differenced.head())
# invert transform
inverted = list()
for i in range(len(differenced)):
	value = inverse_difference(series, differenced[i], len(series)-i)
	inverted.append(value)
inverted = Series(inverted)
print(inverted.head())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-28">28</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de594852128058-30">30</div><div class="crayon-num" data-line="crayon-5a6591c7de594852128058-31">31</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de594852128058-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">Series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-4"> </div><div class="crayon-line" id="crayon-5a6591c7de594852128058-5"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-6"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-7"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-9"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-10"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-12"> </div><div class="crayon-line" id="crayon-5a6591c7de594852128058-13"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-14"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-16"> </div><div class="crayon-line" id="crayon-5a6591c7de594852128058-17"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-18"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-20"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-21"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-22"><span class="crayon-p"># transform to be stationary</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-23"><span class="crayon-v">differenced</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-24"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">differenced</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-25"><span class="crayon-p"># invert transform</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-26"><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-27"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">differenced</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-28"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">differenced</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">)</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-29"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de594852128058-30"><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">inverted</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de594852128058-31"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">inverted</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>Running the example prints the first 5 rows of the loaded data, then the first 5 rows of the differenced series, then finally the first 5 rows with the difference operation inverted.</p>
<p>Note that the first observation in the original dataset was removed from the inverted difference data. Besides that, the last set of data matches the first as expected.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de597799153701" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01    266.0
1901-02-01    145.9
1901-03-01    183.1
1901-04-01    119.3
1901-05-01    180.3

Name: Sales, dtype: float64
0   -120.1
1     37.2
2    -63.8
3     61.0
4    -11.8
dtype: float64

0    145.9
1    183.1
2    119.3
3    180.3
4    168.5
dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de597799153701-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de597799153701-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de597799153701-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-2">1901-01-01    266.0</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-3">1901-02-01    145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-4">1901-03-01    183.1</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-5">1901-04-01    119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-6">1901-05-01    180.3</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-8">Name: Sales, dtype: float64</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-9">0   -120.1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-10">1     37.2</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-11">2    -63.8</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-12">3     61.0</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-13">4    -11.8</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-14">dtype: float64</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-16">0    145.9</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-17">1    183.1</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-18">2    119.3</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-19">3    180.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de597799153701-20">4    168.5</div><div class="crayon-line" id="crayon-5a6591c7de597799153701-21">dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>For more information on making the time series stationary and differencing, see the posts:</p>
<ul>
<li><a href="http://machinelearningmastery.com/time-series-data-stationary-python/">How to Check if Time Series Data is Stationary with Python</a></li>
<li><a href="http://machinelearningmastery.com/difference-time-series-dataset-python/">How to Difference a Time Series Dataset with Python</a></li>
</ul>
<h3>Transform Time Series to Scale</h3>
<p>Like other neural networks, LSTMs expect data to be within the scale of the activation function used by the network.</p>
<p>The default activation function for LSTMs is the hyperbolic tangent (<em>tanh</em>), which outputs values between -1 and 1. This is the preferred range for the time series data.</p>
<p>To make the experiment fair, the scaling coefficients (min and max) values must be calculated on the training dataset and applied to scale the test dataset and any forecasts. This is to avoid contaminating the experiment with knowledge from the test dataset, which might give the model a small edge.</p>
<p>We can transform the dataset to the range [-1, 1] using the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">MinMaxScaler class</a>. Like other scikit-learn transform classes, it requires data provided in a matrix format with rows and columns. Therefore, we must reshape our NumPy arrays before transforming.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de59a908921641" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# transform scale
X = series.values
X = X.reshape(len(X), 1)
scaler = MinMaxScaler(feature_range=(-1, 1))
scaler = scaler.fit(X)
scaled_X = scaler.transform(X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de59a908921641-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59a908921641-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de59a908921641-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59a908921641-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de59a908921641-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59a908921641-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de59a908921641-1"><span class="crayon-p"># transform scale</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59a908921641-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-i">values</span></div><div class="crayon-line" id="crayon-5a6591c7de59a908921641-3"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59a908921641-4"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59a908921641-5"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59a908921641-6"><span class="crayon-v">scaled_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Again, we must invert the scale on forecasts to return the values back to the original scale so that the results can be interpreted and a comparable error score can be calculated.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de59d706327328" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert transform
inverted_X = scaler.inverse_transform(scaled_X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de59d706327328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59d706327328-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de59d706327328-1"><span class="crayon-p"># invert transform</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59d706327328-2"><span class="crayon-v">inverted_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Putting all of this together, the example below transforms the scale of the Shampoo Sales data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de59f699003844" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from pandas import datetime
from pandas import Series
from sklearn.preprocessing import MinMaxScaler
# load dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)
print(series.head())
# transform scale
X = series.values
X = X.reshape(len(X), 1)
scaler = MinMaxScaler(feature_range=(-1, 1))
scaler = scaler.fit(X)
scaled_X = scaler.transform(X)
scaled_series = Series(scaled_X[:, 0])
print(scaled_series.head())
# invert transform
inverted_X = scaler.inverse_transform(scaled_X)
inverted_series = Series(inverted_X[:, 0])
print(inverted_series.head())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de59f699003844-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de59f699003844-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de59f699003844-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-4"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-v">MinMaxScaler</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-5"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-6"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-8"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-10"><span class="crayon-p"># transform scale</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-11"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-i">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-12"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-13"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-14"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-15"><span class="crayon-v">scaled_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-16"><span class="crayon-v">scaled_series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-17"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-18"><span class="crayon-p"># invert transform</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-19"><span class="crayon-v">inverted_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">scaled_X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de59f699003844-20"><span class="crayon-v">inverted_series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">inverted_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de59f699003844-21"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">inverted_series</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>Running the example first prints the first 5 rows of the loaded data, then the first 5 rows of the scaled data, then the first 5 rows with the scale transform inverted, matching the original data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5a2397675536" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month
1901-01-01    266.0
1901-02-01    145.9
1901-03-01    183.1
1901-04-01    119.3
1901-05-01    180.3

Name: Sales, dtype: float64
0   -0.478585
1   -0.905456
2   -0.773236
3   -1.000000
4   -0.783188
dtype: float64

0    266.0
1    145.9
2    183.1
3    119.3
4    180.3
dtype: float64</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a2397675536-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de5a2397675536-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-1">Month</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-2">1901-01-01    266.0</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-3">1901-02-01    145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-4">1901-03-01    183.1</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-5">1901-04-01    119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-6">1901-05-01    180.3</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-8">Name: Sales, dtype: float64</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-9">0   -0.478585</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-10">1   -0.905456</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-11">2   -0.773236</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-12">3   -1.000000</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-13">4   -0.783188</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-14">dtype: float64</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-16">0    266.0</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-17">1    145.9</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-18">2    183.1</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-19">3    119.3</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a2397675536-20">4    180.3</div><div class="crayon-line" id="crayon-5a6591c7de5a2397675536-21">dtype: float64</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now that we know how to prepare data for the LSTM network, we can start developing our model.</p>
<h2>LSTM Model Development</h2>
<p>The Long Short-Term Memory network (LSTM) is a type of Recurrent Neural Network (RNN).</p>
<p>A benefit of this type of network is that it can learn and remember over long sequences and does not rely on a pre-specified window lagged observation as input.</p>
<p>In Keras, this is referred to as stateful, and involves setting the “<em>stateful</em>” argument to “<em>True</em>” when defining an LSTM layer.</p>
<p>By default, an LSTM layer in Keras maintains state between data within one batch. A batch of data is a fixed-sized number of rows from the training dataset that defines how many patterns to process before updating the weights of the network. State in the LSTM layer between batches is cleared by default, therefore we must make the LSTM stateful. This gives us fine-grained control over when state of the LSTM layer is cleared, by calling the <em>reset_states()</em> function.</p>
<p>The LSTM layer expects input to be in a matrix with the dimensions: [<em>samples, time steps, features</em>].</p>
<ul>
<li><strong>Samples</strong>: These are independent observations from the domain, typically rows of data.</li>
<li><strong>Time steps</strong>: These are separate time steps of a given variable for a given observation.</li>
<li><strong>Features</strong>: These are separate measures observed at the time of observation.</li>
</ul>
<p>We have some flexibility in how the Shampoo Sales dataset is framed for the network. We will keep it simple and frame the problem as each time step in the original sequence is one separate sample, with one timestep and one feature.</p>
<p>Given that the training dataset is defined as X inputs and y outputs, it must be reshaped into the Samples/TimeSteps/Features format, for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5a9004315771" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X, y = train[:, 0:-1], train[:, -1]
X = X.reshape(X.shape[0], 1, X.shape[1])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5a9004315771-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5a9004315771-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5a9004315771-1"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5a9004315771-2"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>The shape of the input data must be specified in the LSTM layer using the “<em>batch_input_shape</em>” argument as a tuple that specifies the expected number of observations to read each batch, the number of time steps, and the number of features.</p>
<p>The batch size is often much smaller than the total number of samples. It, along with the number of epochs, defines how quickly the network learns the data (how often the weights are updated).</p>
<p>The final import parameter in defining the LSTM layer is the number of neurons, also called the number of memory units or blocks. This is a reasonably simple problem and a number between 1 and 5 should be sufficient.</p>
<p>The line below creates a single LSTM hidden layer that also specifies the expectations of the input layer via the “<em>batch_input_shape</em>” argument.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5ac109679454" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
layer = LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5ac109679454-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5ac109679454-1"><span class="crayon-v">layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>The network requires a single neuron in the output layer with a linear activation to predict the number of shampoo sales at the next time step.</p>
<p>Once the network is specified, it must be compiled into an efficient symbolic representation using a backend mathematical library, such as TensorFlow or Theano.</p>
<p>In compiling the network, we must specify a loss function and optimization algorithm. We will use “<em>mean_squared_error</em>” as the loss function as it closely matches RMSE that we will are interested in, and the efficient ADAM optimization algorithm.</p>
<p>Using the Sequential Keras API to define the network, the below snippet creates and compiles the network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5af626925624" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = Sequential()
model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5af626925624-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5af626925624-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5af626925624-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5af626925624-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5af626925624-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5af626925624-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5af626925624-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5af626925624-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Once compiled, it can be fit to the training data. Because the network is stateful, we must control when the internal state is reset. Therefore, we must manually manage the training process one epoch at a time across the desired number of epochs.</p>
<p>By default, the samples within an epoch are shuffled prior to being exposed to the network. Again, this is undesirable for the LSTM because we want the network to build up state as it learns across the sequence of observations. We can disable the shuffling of samples by setting “<em>shuffle</em>” to “<em>False</em>“.</p>
<p>Also by default, the network reports a lot of debug information about the learning progress and skill of the model at the end of each epoch. We can disable this by setting the “<em>verbose</em>” argument to the level of “<em>0</em>“.</p>
<p>We can then reset the internal state at the end of the training epoch, ready for the next training iteration.</p>
<p>Below is a loop that manually fits the network to the training data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5b1187966292" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
for i in range(nb_epoch):
	model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
	model.reset_states()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5b1187966292-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b1187966292-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5b1187966292-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5b1187966292-1"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b1187966292-2"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5b1187966292-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Putting this all together, we can define a function called <em>fit_lstm()</em> that trains and returns an LSTM model. As arguments, it takes the training dataset in a supervised learning format, a batch size, a number of epochs, and a number of neurons.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5b4283514892" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def fit_lstm(train, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	model = Sequential()
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		model.reset_states()
	return model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b4283514892-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b4283514892-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b4283514892-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b4283514892-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b4283514892-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5b4283514892-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-1"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b4283514892-2"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-3"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b4283514892-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b4283514892-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b4283514892-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-9"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b4283514892-10"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5b4283514892-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>The batch_size must be set to 1. This is because it must be a factor of the size of the training and test datasets.</p>
<p>The <em>predict()</em> function on the model is also constrained by the batch size; there it must be set to 1 because we are interested in making one-step forecasts on the test data.</p>
<p>We will not tune the network parameters in this tutorial; instead we will use the following configuration, found with a little trial and error:</p>
<ul>
<li>Batch Size: 1</li>
<li>Epochs: 3000</li>
<li>Neurons: 4</li>
</ul>
<p>As an extension to this tutorial, you might like to explore different model parameters and see if you can improve performance.</p>
<ul>
<li><strong>Update</strong>: Consider trying 1500 epochs and 1 neuron, the performance may be better!</li>
</ul>
<p>Next, we will look at how we can use a fit LSTM model to make a one-step forecast.</p>
<h2>LSTM Forecast</h2>
<p>Once the LSTM model is fit to the training data, it can be used to make forecasts.</p>
<p>Again, we have some flexibility. We can decide to fit the model once on all of the training data, then predict each new time step one at a time from the test data (we’ll call this the fixed approach), or we can re-fit the model or update the model each time step of the test data as new observations from the test data are made available (we’ll call this the dynamic approach).</p>
<p>In this tutorial, we will go with the fixed approach for its simplicity, although, we would expect the dynamic approach to result in better model skill.</p>
<p>To make a forecast, we can call the <em>predict()</em> function on the model. This requires a 3D NumPy array input as an argument. In this case, it will be an array of one value, the observation at the previous time step.</p>
<p>The <em>predict()</em> function returns an array of predictions, one for each input row provided. Because we are providing a single input, the output will be a 2D NumPy array with one value.</p>
<p>We can capture this behavior in a function named <em>forecast()</em> listed below. Given a fit model, a batch-size used when fitting the model (e.g. 1), and a row from the test data, the function will separate out the input data from the test row, reshape it, and return the prediction as a single floating point value.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5b7314954020" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def forecast(model, batch_size, row):
	X = row[0:-1]
	X = X.reshape(1, 1, len(X))
	yhat = model.predict(X, batch_size=batch_size)
	return yhat[0,0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5b7314954020-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b7314954020-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5b7314954020-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5b7314954020-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5b7314954020-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5b7314954020-1"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b7314954020-2"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">row</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5b7314954020-3"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5b7314954020-4"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5b7314954020-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>During training, the internal state is reset after each epoch. While forecasting, we will not want to reset the internal state between forecasts. In fact, we would like the model to build up state as we forecast each time step in the test dataset.</p>
<p>This raises the question as to what would be a good initial state for the network prior to forecasting the test dataset.</p>
<p>In this tutorial, we will seed the state by making a prediction on all samples in the training dataset. In theory, the internal state should be set up ready to forecast the next time step.</p>
<p>We now have all of the pieces to fit an LSTM Network model for the Shampoo Sales dataset and evaluate its performance.</p>
<p>In the next section, we will put all of these pieces together.</p>
<h2>Complete LSTM Example</h2>
<p>In this section, we will fit an LSTM to the Shampoo Sales dataset and evaluate the model.</p>
<p>This will involve drawing together all of the elements from the prior sections. There are a lot of them, so let’s review:</p>
<ol>
<li>Load the dataset from CSV file.</li>
<li>Transform the dataset to make it suitable for the LSTM model, including:
<ol>
<li>Transforming the data to a supervised learning problem.</li>
<li>Transforming the data to be stationary.</li>
<li>Transforming the data so that it has the scale -1 to 1.</li>
</ol>
</li>
<li>Fitting a stateful LSTM network model to the training data.</li>
<li>Evaluating the static LSTM model on the test data.</li>
<li>Report the performance of the forecasts.</li>
</ol>
<p>Some things to note about the example:</p>
<ul>
<li>The scaling and inverse scaling behaviors have been moved to the functions <em>scale()</em> and <em>invert_scale()</em> for brevity.</li>
<li>The test data is scaled using the fit of the scaler on the training data, as is required to ensure the min/max values of the test data do not influence the model.</li>
<li>The order of data transforms was adjusted for convenience to first make the data stationary, then a supervised learning problem, then scaled.</li>
<li>Differencing was performed on the entire dataset prior to splitting into train and test sets for convenience. We could just as easily collect observations during the walk-forward validation and difference them as we go. I decided against it for readability.</li>
</ul>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5bb329446637" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df.fillna(0, inplace=True)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, value):
	new_row = [x for x in X] + [value]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# fit an LSTM network to training data
def fit_lstm(train, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	model = Sequential()
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		model.reset_states()
	return model

# make a one-step forecast
def forecast_lstm(model, batch_size, X):
	X = X.reshape(1, 1, len(X))
	yhat = model.predict(X, batch_size=batch_size)
	return yhat[0,0]

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)

# transform data to be stationary
raw_values = series.values
diff_values = difference(raw_values, 1)

# transform data to be supervised learning
supervised = timeseries_to_supervised(diff_values, 1)
supervised_values = supervised.values

# split data into train and test-sets
train, test = supervised_values[0:-12], supervised_values[-12:]

# transform the scale of the data
scaler, train_scaled, test_scaled = scale(train, test)

# fit the model
lstm_model = fit_lstm(train_scaled, 1, 3000, 4)
# forecast the entire training dataset to build up state for forecasting
train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)
lstm_model.predict(train_reshaped, batch_size=1)

# walk-forward validation on the test data
predictions = list()
for i in range(len(test_scaled)):
	# make one-step forecast
	X, y = test_scaled[i, 0:-1], test_scaled[i, -1]
	yhat = forecast_lstm(lstm_model, 1, X)
	# invert scaling
	yhat = invert_scale(scaler, X, yhat)
	# invert differencing
	yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
	# store forecast
	predictions.append(yhat)
	expected = raw_values[len(train) + i + 1]
	print('Month=%d, Predicted=%f, Expected=%f' % (i+1, yhat, expected))

# report performance
rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
print('Test RMSE: %.3f' % rmse)
# line plot of observed vs predicted
pyplot.plot(raw_values[-12:])
pyplot.plot(predictions)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-28">28</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-30">30</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-32">32</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-34">34</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-36">36</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-38">38</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-40">40</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-42">42</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-44">44</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-46">46</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-48">48</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-50">50</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-52">52</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-54">54</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-56">56</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-58">58</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-60">60</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-62">62</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-64">64</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-66">66</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-68">68</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-70">70</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-72">72</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-74">74</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-76">76</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-78">78</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-80">80</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-82">82</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-84">84</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-86">86</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-88">88</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-90">90</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-92">92</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-94">94</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-96">96</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-98">98</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-100">100</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-102">102</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-104">104</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-106">106</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-108">108</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-110">110</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-112">112</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-114">114</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-116">116</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-118">118</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-120">120</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-122">122</div><div class="crayon-num" data-line="crayon-5a6591c7de5bb329446637-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5bb329446637-124">124</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-11"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-12"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-13"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-14"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-15"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-16"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-18"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-19"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-20"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-21"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-22"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-23"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-24"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-25"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">fillna</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-28"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-29"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-30"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-31"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-32"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-33"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-36"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-37"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-38"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-40"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-41"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-42"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-43"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-44"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-45"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-46"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-47"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-48"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-49"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-50"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-52"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-53"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-54"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-55"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-56"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-57"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-58"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-59"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-60"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-61"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-62"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-63"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-64"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-65"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-66"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-69"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-70"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-71"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-72"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-73"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-74"><span class="crayon-p"># make a one-step forecast</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-75"><span class="crayon-e">def </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-76"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-77"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-78"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-79"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-80"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-81"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-82"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-83"><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-84"><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-85"><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-86"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-87"><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-88"><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-89"><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-90"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-91"><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-92"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-93"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-94"><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-95"><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-96"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-97"><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-98"><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-99"><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-100"><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-101"><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-102"> </div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-103"><span class="crayon-p"># walk-forward validation on the test data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-104"><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-105"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-106"><span class="crayon-h"> </span><span class="crayon-p"># make one-step forecast</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-107"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-108"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">lstm_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-109"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-110"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-111"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-112"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-113"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-114"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-115"><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-116"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Month=%d, Predicted=%f, Expected=%f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-117"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-118"><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-119"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-120"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-121"><span class="crayon-p"># line plot of observed vs predicted</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-122"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5bb329446637-123"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5bb329446637-124"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0098 seconds] -->
<p>Running the example prints the expected and predicted values for each of the 12 months in the test dataset.</p>
<p>The example also prints the RMSE of all forecasts. The model shows an RMSE of 71.721 monthly shampoo sales, which is better than the persistence model that achieved an RMSE of 136.761 shampoo sales.</p>
<p>Random numbers are used in seeding the LSTM, and as a result, you may have a different result from a single run of the model. We cover this further in the next section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5c1784115894" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month=1, Predicted=351.582196, Expected=339.700000
Month=2, Predicted=432.169667, Expected=440.400000
Month=3, Predicted=378.064505, Expected=315.900000
Month=4, Predicted=441.370077, Expected=439.300000
Month=5, Predicted=446.872627, Expected=401.300000
Month=6, Predicted=514.021244, Expected=437.400000
Month=7, Predicted=525.608903, Expected=575.500000
Month=8, Predicted=473.072365, Expected=407.600000
Month=9, Predicted=523.126979, Expected=682.000000
Month=10, Predicted=592.274106, Expected=475.300000
Month=11, Predicted=589.299863, Expected=581.300000
Month=12, Predicted=584.149152, Expected=646.900000
Test RMSE: 71.721</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5c1784115894-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5c1784115894-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-1">Month=1, Predicted=351.582196, Expected=339.700000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-2">Month=2, Predicted=432.169667, Expected=440.400000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-3">Month=3, Predicted=378.064505, Expected=315.900000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-4">Month=4, Predicted=441.370077, Expected=439.300000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-5">Month=5, Predicted=446.872627, Expected=401.300000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-6">Month=6, Predicted=514.021244, Expected=437.400000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-7">Month=7, Predicted=525.608903, Expected=575.500000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-8">Month=8, Predicted=473.072365, Expected=407.600000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-9">Month=9, Predicted=523.126979, Expected=682.000000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-10">Month=10, Predicted=592.274106, Expected=475.300000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-11">Month=11, Predicted=589.299863, Expected=581.300000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5c1784115894-12">Month=12, Predicted=584.149152, Expected=646.900000</div><div class="crayon-line" id="crayon-5a6591c7de5c1784115894-13">Test RMSE: 71.721</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A line plot of the test data (blue) vs the predicted values (orange) is also created, providing context for the model skill.</p>
<div class="wp-caption aligncenter" id="attachment_3884" style="max-width: 650px"><img alt="Line Plot of LSTM Forecast vs Expected Values" class="size-full wp-image-3884" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-LSTM-Forecast-vs-Expected-Values.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-LSTM-Forecast-vs-Expected-Values.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/Line-Plot-of-LSTM-Forecast-vs-Expected-Values-300x225.png 300w" width="640"/><p class="wp-caption-text">Line Plot of LSTM Forecast vs Expected Values</p></div>
<p>As an afternote, you can do a quick experiment to build your trust in the test harness and all of the transforms and inverse transforms.</p>
<p>Comment out the line that fits the LSTM model in walk-forward validation:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5c5955062982" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat = forecast_lstm(lstm_model, 1, X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5c5955062982-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5c5955062982-1"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">lstm_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>And replace it with the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5c7457739204" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat = y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5c7457739204-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5c7457739204-1"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This should produce a model with perfect skill (e.g. a model that predicts the expected outcome as the model output).</p>
<p>The results should look as follows, showing that if the LSTM model could predict the series perfectly, the inverse transforms and error calculation would show it correctly.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5ca040657514" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Month=1, Predicted=339.700000, Expected=339.700000
Month=2, Predicted=440.400000, Expected=440.400000
Month=3, Predicted=315.900000, Expected=315.900000
Month=4, Predicted=439.300000, Expected=439.300000
Month=5, Predicted=401.300000, Expected=401.300000
Month=6, Predicted=437.400000, Expected=437.400000
Month=7, Predicted=575.500000, Expected=575.500000
Month=8, Predicted=407.600000, Expected=407.600000
Month=9, Predicted=682.000000, Expected=682.000000
Month=10, Predicted=475.300000, Expected=475.300000
Month=11, Predicted=581.300000, Expected=581.300000
Month=12, Predicted=646.900000, Expected=646.900000
Test RMSE: 0.000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5ca040657514-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5ca040657514-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-1">Month=1, Predicted=339.700000, Expected=339.700000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-2">Month=2, Predicted=440.400000, Expected=440.400000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-3">Month=3, Predicted=315.900000, Expected=315.900000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-4">Month=4, Predicted=439.300000, Expected=439.300000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-5">Month=5, Predicted=401.300000, Expected=401.300000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-6">Month=6, Predicted=437.400000, Expected=437.400000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-7">Month=7, Predicted=575.500000, Expected=575.500000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-8">Month=8, Predicted=407.600000, Expected=407.600000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-9">Month=9, Predicted=682.000000, Expected=682.000000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-10">Month=10, Predicted=475.300000, Expected=475.300000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-11">Month=11, Predicted=581.300000, Expected=581.300000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5ca040657514-12">Month=12, Predicted=646.900000, Expected=646.900000</div><div class="crayon-line" id="crayon-5a6591c7de5ca040657514-13">Test RMSE: 0.000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Develop a Robust Result</h2>
<p>A difficulty with neural networks is that they give different results with different starting conditions.</p>
<p>One approach might be to fix the random number seed used by Keras to ensure the results are reproducible. Another approach would be to control for the random initial conditions using a different experimental setup.</p>
<p>For more on randomness in machine learning, see the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/randomness-in-machine-learning/">Embrace Randomness in Machine Learning</a></li>
</ul>
<p>We can repeat the experiment from the previous section multiple times, then take the average RMSE as an indication of how well the configuration would be expected to perform on unseen data on average.</p>
<p>This is often called multiple repeats or multiple restarts.</p>
<p>We can wrap the model fitting and walk-forward validation in a loop of fixed number of repeats. Each iteration the RMSE of the run can be recorded. We can then summarize the distribution of RMSE scores.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5cd787018031" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# repeat experiment
repeats = 30
error_scores = list()
for r in range(repeats):
	# fit the model
	lstm_model = fit_lstm(train_scaled, 1, 3000, 4)
	# forecast the entire training dataset to build up state for forecasting
	train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)
	lstm_model.predict(train_reshaped, batch_size=1)
	# walk-forward validation on the test data
	predictions = list()
	for i in range(len(test_scaled)):
		# make one-step forecast
		X, y = test_scaled[i, 0:-1], test_scaled[i, -1]
		yhat = forecast_lstm(lstm_model, 1, X)
		# invert scaling
		yhat = invert_scale(scaler, X, yhat)
		# invert differencing
		yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
		# store forecast
		predictions.append(yhat)
	# report performance
	rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
	print('%d) Test RMSE: %.3f' % (r+1, rmse))
	error_scores.append(rmse)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5cd787018031-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de5cd787018031-25">25</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-1"><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-2"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-3"><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-4"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-5"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-6"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-7"><span class="crayon-h"> </span><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-8"><span class="crayon-h"> </span><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-9"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-10"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation on the test data</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-11"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-12"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-13"><span class="crayon-h"> </span><span class="crayon-p"># make one-step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-14"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-15"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">lstm_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-16"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-17"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-18"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-19"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-20"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-21"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-22"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-23"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5cd787018031-24"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5cd787018031-25"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0022 seconds] -->
<p>The data preparation would be the same as before.</p>
<p>We will use 30 repeats as that is sufficient to provide a good distribution of RMSE scores.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5d0662308936" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import DataFrame
from pandas import Series
from pandas import concat
from pandas import read_csv
from pandas import datetime
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import MinMaxScaler
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
from matplotlib import pyplot
import numpy

# date-time parsing function for loading the dataset
def parser(x):
	return datetime.strptime('190'+x, '%Y-%m')

# frame a sequence as a supervised learning problem
def timeseries_to_supervised(data, lag=1):
	df = DataFrame(data)
	columns = [df.shift(i) for i in range(1, lag+1)]
	columns.append(df)
	df = concat(columns, axis=1)
	df.fillna(0, inplace=True)
	return df

# create a differenced series
def difference(dataset, interval=1):
	diff = list()
	for i in range(interval, len(dataset)):
		value = dataset[i] - dataset[i - interval]
		diff.append(value)
	return Series(diff)

# invert differenced value
def inverse_difference(history, yhat, interval=1):
	return yhat + history[-interval]

# scale train and test data to [-1, 1]
def scale(train, test):
	# fit scaler
	scaler = MinMaxScaler(feature_range=(-1, 1))
	scaler = scaler.fit(train)
	# transform train
	train = train.reshape(train.shape[0], train.shape[1])
	train_scaled = scaler.transform(train)
	# transform test
	test = test.reshape(test.shape[0], test.shape[1])
	test_scaled = scaler.transform(test)
	return scaler, train_scaled, test_scaled

# inverse scaling for a forecasted value
def invert_scale(scaler, X, value):
	new_row = [x for x in X] + [value]
	array = numpy.array(new_row)
	array = array.reshape(1, len(array))
	inverted = scaler.inverse_transform(array)
	return inverted[0, -1]

# fit an LSTM network to training data
def fit_lstm(train, batch_size, nb_epoch, neurons):
	X, y = train[:, 0:-1], train[:, -1]
	X = X.reshape(X.shape[0], 1, X.shape[1])
	model = Sequential()
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))
	model.add(Dense(1))
	model.compile(loss='mean_squared_error', optimizer='adam')
	for i in range(nb_epoch):
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)
		model.reset_states()
	return model

# make a one-step forecast
def forecast_lstm(model, batch_size, X):
	X = X.reshape(1, 1, len(X))
	yhat = model.predict(X, batch_size=batch_size)
	return yhat[0,0]

# load dataset
series = read_csv('shampoo-sales.csv', header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)

# transform data to be stationary
raw_values = series.values
diff_values = difference(raw_values, 1)

# transform data to be supervised learning
supervised = timeseries_to_supervised(diff_values, 1)
supervised_values = supervised.values

# split data into train and test-sets
train, test = supervised_values[0:-12], supervised_values[-12:]

# transform the scale of the data
scaler, train_scaled, test_scaled = scale(train, test)

# repeat experiment
repeats = 30
error_scores = list()
for r in range(repeats):
	# fit the model
	lstm_model = fit_lstm(train_scaled, 1, 3000, 4)
	# forecast the entire training dataset to build up state for forecasting
	train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)
	lstm_model.predict(train_reshaped, batch_size=1)
	# walk-forward validation on the test data
	predictions = list()
	for i in range(len(test_scaled)):
		# make one-step forecast
		X, y = test_scaled[i, 0:-1], test_scaled[i, -1]
		yhat = forecast_lstm(lstm_model, 1, X)
		# invert scaling
		yhat = invert_scale(scaler, X, yhat)
		# invert differencing
		yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)
		# store forecast
		predictions.append(yhat)
	# report performance
	rmse = sqrt(mean_squared_error(raw_values[-12:], predictions))
	print('%d) Test RMSE: %.3f' % (r+1, rmse))
	error_scores.append(rmse)

# summarize results
results = DataFrame()
results['rmse'] = error_scores
print(results.describe())
results.boxplot()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-28">28</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-30">30</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-32">32</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-34">34</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-36">36</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-38">38</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-40">40</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-42">42</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-44">44</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-46">46</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-48">48</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-50">50</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-52">52</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-54">54</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-56">56</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-58">58</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-60">60</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-62">62</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-64">64</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-66">66</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-68">68</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-70">70</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-72">72</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-74">74</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-76">76</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-78">78</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-80">80</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-82">82</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-84">84</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-86">86</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-88">88</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-90">90</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-92">92</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-94">94</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-96">96</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-98">98</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-100">100</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-102">102</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-104">104</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-106">106</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-108">108</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-110">110</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-112">112</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-114">114</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-116">116</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-118">118</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-120">120</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-122">122</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-124">124</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-126">126</div><div class="crayon-num" data-line="crayon-5a6591c7de5d0662308936-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d0662308936-128">128</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">Series</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-3"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">datetime</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-11"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-12"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-13"><span class="crayon-e">import </span><span class="crayon-v">numpy</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-14"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-15"><span class="crayon-p"># date-time parsing function for loading the dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-16"><span class="crayon-e">def </span><span class="crayon-e">parser</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-s">'190'</span><span class="crayon-o">+</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y-%m'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-18"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-19"><span class="crayon-p"># frame a sequence as a supervised learning problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-20"><span class="crayon-e">def </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-21"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-22"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lag</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-23"><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-24"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-25"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">fillna</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">df</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-27"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-28"><span class="crayon-p"># create a differenced series</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-29"><span class="crayon-e">def </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-30"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-31"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">interval</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-32"><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-33"><span class="crayon-h"> </span><span class="crayon-v">diff</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">Series</span><span class="crayon-sy">(</span><span class="crayon-v">diff</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-36"><span class="crayon-p"># invert differenced value</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-37"><span class="crayon-e">def </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-38"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">interval</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-40"><span class="crayon-p"># scale train and test data to [-1, 1]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-41"><span class="crayon-e">def </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-42"><span class="crayon-h"> </span><span class="crayon-p"># fit scaler</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-43"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-44"><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-45"><span class="crayon-h"> </span><span class="crayon-p"># transform train</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-46"><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-47"><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-48"><span class="crayon-h"> </span><span class="crayon-p"># transform test</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-49"><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-50"><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-52"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-53"><span class="crayon-p"># inverse scaling for a forecasted value</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-54"><span class="crayon-e">def </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-55"><span class="crayon-h"> </span><span class="crayon-v">new_row</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">value</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-56"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">new_row</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-57"><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-58"><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-59"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">inverted</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-60"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-61"><span class="crayon-p"># fit an LSTM network to training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-62"><span class="crayon-e">def </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">neurons</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-63"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-64"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-65"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-66"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">neurons</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stateful</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-67"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-68"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-69"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">nb_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-70"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-71"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">reset_states</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-72"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-73"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-74"><span class="crayon-p"># make a one-step forecast</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-75"><span class="crayon-e">def </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-76"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-77"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-78"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-79"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-80"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-81"><span class="crayon-v">series</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'shampoo-sales.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">squeeze</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parser</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-82"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-83"><span class="crayon-p"># transform data to be stationary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-84"><span class="crayon-v">raw_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">series</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-85"><span class="crayon-v">diff_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-86"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-87"><span class="crayon-p"># transform data to be supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-88"><span class="crayon-v">supervised</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">timeseries_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">diff_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-89"><span class="crayon-v">supervised_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-90"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-91"><span class="crayon-p"># split data into train and test-sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-92"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">supervised_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-93"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-94"><span class="crayon-p"># transform the scale of the data</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-95"><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">scale</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-96"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-97"><span class="crayon-p"># repeat experiment</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-98"><span class="crayon-v">repeats</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-99"><span class="crayon-v">error_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-100"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">repeats</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-101"><span class="crayon-h"> </span><span class="crayon-p"># fit the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-102"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-103"><span class="crayon-h"> </span><span class="crayon-p"># forecast the entire training dataset to build up state for forecasting</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-104"><span class="crayon-h"> </span><span class="crayon-v">train_reshaped</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_scaled</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-105"><span class="crayon-h"> </span><span class="crayon-v">lstm_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">train_reshaped</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-106"><span class="crayon-h"> </span><span class="crayon-p"># walk-forward validation on the test data</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-107"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-108"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-109"><span class="crayon-h"> </span><span class="crayon-p"># make one-step forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-110"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_scaled</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-111"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">lstm_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-112"><span class="crayon-h"> </span><span class="crayon-p"># invert scaling</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-113"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">invert_scale</span><span class="crayon-sy">(</span><span class="crayon-v">scaler</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-114"><span class="crayon-h"> </span><span class="crayon-p"># invert differencing</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-115"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">inverse_difference</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_scaled</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-116"><span class="crayon-h"> </span><span class="crayon-p"># store forecast</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-117"><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-118"><span class="crayon-h"> </span><span class="crayon-p"># report performance</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-119"><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">raw_values</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">12</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-120"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%d) Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">r</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-121"><span class="crayon-h"> </span><span class="crayon-v">error_scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-122"> </div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-123"><span class="crayon-p"># summarize results</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-124"><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-125"><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'rmse'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">error_scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-126"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">describe</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6591c7de5d0662308936-127"><span class="crayon-v">results</span><span class="crayon-sy">.</span><span class="crayon-e">boxplot</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d0662308936-128"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0097 seconds] -->
<p>Running the example prints the RMSE score each repeat. The end of the run provides summary statistics of the collected RMSE scores.</p>
<p>We can see that the mean and standard deviation RMSE scores are 138.491905 and 46.313783 monthly shampoo sales respectively.</p>
<p>This is a very useful result as it suggests the result reported above was probably a statistical fluke. The experiment suggests that the model is probably about as good as the persistence model on average (136.761), if not slightly worse.</p>
<p>This indicates that, at the very least, further model tuning is required.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7de5d5045986215" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
1) Test RMSE: 136.191
2) Test RMSE: 169.693
3) Test RMSE: 176.553
4) Test RMSE: 198.954
5) Test RMSE: 148.960
6) Test RMSE: 103.744
7) Test RMSE: 164.344
8) Test RMSE: 108.829
9) Test RMSE: 232.282
10) Test RMSE: 110.824
11) Test RMSE: 163.741
12) Test RMSE: 111.535
13) Test RMSE: 118.324
14) Test RMSE: 107.486
15) Test RMSE: 97.719
16) Test RMSE: 87.817
17) Test RMSE: 92.920
18) Test RMSE: 112.528
19) Test RMSE: 131.687
20) Test RMSE: 92.343
21) Test RMSE: 173.249
22) Test RMSE: 182.336
23) Test RMSE: 101.477
24) Test RMSE: 108.171
25) Test RMSE: 135.880
26) Test RMSE: 254.507
27) Test RMSE: 87.198
28) Test RMSE: 122.588
29) Test RMSE: 228.449
30) Test RMSE: 94.427
             rmse
count   30.000000
mean   138.491905
std     46.313783
min     87.198493
25%    104.679391
50%    120.456233
75%    168.356040
max    254.507272</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-28">28</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-30">30</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-32">32</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-34">34</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-36">36</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7de5d5045986215-38">38</div><div class="crayon-num" data-line="crayon-5a6591c7de5d5045986215-39">39</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-1">1) Test RMSE: 136.191</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-2">2) Test RMSE: 169.693</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-3">3) Test RMSE: 176.553</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-4">4) Test RMSE: 198.954</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-5">5) Test RMSE: 148.960</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-6">6) Test RMSE: 103.744</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-7">7) Test RMSE: 164.344</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-8">8) Test RMSE: 108.829</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-9">9) Test RMSE: 232.282</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-10">10) Test RMSE: 110.824</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-11">11) Test RMSE: 163.741</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-12">12) Test RMSE: 111.535</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-13">13) Test RMSE: 118.324</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-14">14) Test RMSE: 107.486</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-15">15) Test RMSE: 97.719</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-16">16) Test RMSE: 87.817</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-17">17) Test RMSE: 92.920</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-18">18) Test RMSE: 112.528</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-19">19) Test RMSE: 131.687</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-20">20) Test RMSE: 92.343</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-21">21) Test RMSE: 173.249</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-22">22) Test RMSE: 182.336</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-23">23) Test RMSE: 101.477</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-24">24) Test RMSE: 108.171</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-25">25) Test RMSE: 135.880</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-26">26) Test RMSE: 254.507</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-27">27) Test RMSE: 87.198</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-28">28) Test RMSE: 122.588</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-29">29) Test RMSE: 228.449</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-30">30) Test RMSE: 94.427</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-31">             rmse</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-32">count   30.000000</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-33">mean   138.491905</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-34">std     46.313783</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-35">min     87.198493</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-36">25%    104.679391</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-37">50%    120.456233</div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7de5d5045986215-38">75%    168.356040</div><div class="crayon-line" id="crayon-5a6591c7de5d5045986215-39">max    254.507272</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A box and whisker plot is created from the distribution shown below. This captures the middle of the data as well as the extents and outlier results.</p>
<div class="wp-caption aligncenter" id="attachment_3885" style="max-width: 650px"><img alt="LSTM Repeated Experiment Box and Whisker Plot" class="size-full wp-image-3885" height="480" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/LSTM-Repeated-Experiment-Box-and-Whisker-Plot.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/LSTM-Repeated-Experiment-Box-and-Whisker-Plot.png 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/LSTM-Repeated-Experiment-Box-and-Whisker-Plot-300x225.png 300w" width="640"/><p class="wp-caption-text">LSTM Repeated Experiment Box and Whisker Plot</p></div>
<p>This is an experimental setup that could be used to compare one configuration of the LSTM model or set up to another.</p>
<h2>Tutorial Extensions</h2>
<p>There are many extensions to this tutorial that we may consider.</p>
<p>Perhaps you could explore some of these yourself and post your discoveries in the comments below.</p>
<ul>
<li><strong>Multi-Step Forecast</strong>. The experimental setup could be changed to predict the next <em>n</em>-time steps rather than the next single time step. This would also permit a larger batch size and faster training. Note that we are basically performing a type of 12 one-step forecast in this tutorial given the model is not updated, although new observations are available and are used as input variables.</li>
<li><strong>Tune LSTM model</strong>. The model was not tuned; instead, the configuration was found with some quick trial and error. I believe much better results could be achieved by tuning at least the number of neurons and number of training epochs. I also think early stopping via a callback might be useful during training.</li>
<li><strong>Seed State Experiments</strong>. It is not clear whether seeding the system prior to forecasting by predicting all of the training data is beneficial. It seems like a good idea in theory, but this needs to be demonstrated. Also, perhaps other methods of seeding the model prior to forecasting would be beneficial.</li>
<li><strong>Update Model</strong>. The model could be updated in each time step of the walk-forward validation. Experiments are needed to determine if it would be better to refit the model from scratch or update the weights with a few more training epochs including the new sample.</li>
<li><strong>Input Time Steps</strong>. The LSTM input supports multiple time steps for a sample. Experiments are needed to see if including lag observations as time steps provides any benefit.</li>
<li><strong>Input Lag Features</strong>. Lag observations may be included as input features. Experiments are needed to see if including lag features provide any benefit, not unlike an AR(k) linear model.</li>
<li><strong>Input Error Series</strong>. An error series may be constructed (forecast error from a persistence model) and used as an additional input feature, not unlike an MA(k) linear model. Experiments are needed to see if this provides any benefit.</li>
<li><strong>Learn Non-Stationary</strong>. The LSTM network may be able to learn the trend in the data and make reasonable predictions. Experiments are needed to see if temporal dependent structures, like trends and seasonality, left in data can be learned and effectively predicted by LSTMs.</li>
<li><strong>Contrast Stateless</strong>. Stateful LSTMs were used in this tutorial. The results should be compared with stateless LSTM configurations.</li>
<li><strong>Statistical Significance</strong>. The multiple repeats experimental protocol can be extended further to include statistical significance tests to demonstrate whether the difference between populations of RMSE results with different configurations are statistically significant.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an LSTM model for time series forecasting.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to prepare time series data for developing an LSTM model.</li>
<li>How to develop an LSTM model for time series forecasting.</li>
<li>How to evaluate an LSTM model using a robust test harness.</li>
</ul>
<p>Can you get a better result?<br/>
Share your findings in the comments below.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Ftime-series-forecasting-long-short-term-memory-network-python%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/&amp;summary=The+Long+Short-Term+Memory+recurrent+neural+network+has+the+promise+of+learning+long+sequences+of+ob..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Time%20Series%20Forecasting%20with%20the%20Long%20Short-Term%20Memory%20Network%20in%20Python&amp;url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/&amp;summary=The+Long+Short-Term+Memory+recurrent+neural+network+has+the+promise+of+learning+long+sequences+of+ob...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/seasonal-persistence-forecasting-python/" rel="prev"><i class="fa fa-angle-left"></i> Seasonal Persistence Forecasting With Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/seed-state-lstms-time-series-forecasting-python/" rel="next">How to Seed State for LSTMs for Time Series Forecasting in Python <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">305 Responses to <em>Time Series Forecasting with the Long Short-Term Memory Network in Python</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-395611">
<div class="comment-container" id="li-comment-395611">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2070866c0175dc61d99cbef3a5b05b01?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2070866c0175dc61d99cbef3a5b05b01?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chang</span>
<span class="date">April 7, 2017 at 4:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395611" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’ve been working on multi-step-ahead forecast after reading your ebook and following one step ahead tutorials. But still struggling getting nothing. It seems that seq2seq model is used, but I want to configure simple lstm for multi step ahead prediction. Can you help me in getting basic idea to do this?</p>
<div class="reply">
<a aria-label="Reply to Chang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395611#respond" onclick='return addComment.moveForm( "comment-395611", "395611", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395817">
<div class="comment-container" id="li-comment-395817">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 2:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395817" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I have some seq2seq examples scheduled to come out on the blog soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395817#respond" onclick='return addComment.moveForm( "comment-395817", "395817", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-395752">
<div class="comment-container" id="li-comment-395752">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/43cc6ce12de070c2b79830a9cb26e8f7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/43cc6ce12de070c2b79830a9cb26e8f7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Supriya</span>
<span class="date">April 9, 2017 at 9:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395752" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for this blog. I am working on  multi-step-ahead forecast using recursive prediction technique  and I have some difficulty. Blog on this particular topic would be really helpful.<br/>
Also, is it possible to somehow implement recursive technique in ARIMA?.</p>
<div class="reply">
<a aria-label="Reply to Supriya" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395752#respond" onclick='return addComment.moveForm( "comment-395752", "395752", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-395828">
<div class="comment-container" id="li-comment-395828">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 9, 2017 at 3:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395828" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Absolutely, you can take the predictions as history and re-fit the ARIMA.</p>
<p>Thanks for the suggestion, it would make a good blog post.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395828#respond" onclick='return addComment.moveForm( "comment-395828", "395828", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-407587">
<div class="comment-container" id="li-comment-407587">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">July 28, 2017 at 5:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407587" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am wondering if I have predictions (not good prediction) and  refitting without validating with the test set, wouldn’t it give false prediction again?</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407587#respond" onclick='return addComment.moveForm( "comment-407587", "407587", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-407625">
<div class="comment-container" id="li-comment-407625">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407625" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may, design an experiment to test the approach.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407625#respond" onclick='return addComment.moveForm( "comment-407625", "407625", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-424986">
<div class="comment-container" id="li-comment-424986">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5bf980a045580ed2cdd2c45073ca24e6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5bf980a045580ed2cdd2c45073ca24e6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shifu jain</span>
<span class="date">December 27, 2017 at 11:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424986" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this blog. Can you please share an example of multi-step-ahead forecast using recursive prediction technique using LSTM.</p>
<p>Thanks,<br/>
Shifu</p>
<div class="reply">
<a aria-label="Reply to Shifu jain" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424986#respond" onclick='return addComment.moveForm( "comment-424986", "424986", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-425008">
<div class="comment-container" id="li-comment-425008">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425008" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<p>I have an example of a direct model for multi-step forecasting here:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425008#respond" onclick='return addComment.moveForm( "comment-425008", "425008", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-395804">
<div class="comment-container" id="li-comment-395804">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c591b3aa78239d67786996bca4485c78?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c591b3aa78239d67786996bca4485c78?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Peter Marelas</span>
<span class="date">April 9, 2017 at 2:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395804" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>LSTM remember sequences but is there a way to encode calendar effects in the network so that it remembers or learns events that occur at different intervals within the sequence and each cycles? A concrete example would be a time series that exhibits specific events that repeat themselves on specific times in the year, example first Monday of every month and/or last day of every month. I am thinking whether we can label this data in advance to help the LSTM predict these events better?</p>
<div class="reply">
<a aria-label="Reply to Peter Marelas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395804#respond" onclick='return addComment.moveForm( "comment-395804", "395804", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-405402">
<div class="comment-container" id="li-comment-405402">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/51a4833f6219f8fec7182a2fba2fb392?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/51a4833f6219f8fec7182a2fba2fb392?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Guillaume</span>
<span class="date">July 10, 2017 at 8:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405402" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Peter,</p>
<p>You might want to check out the X-11 method to separate trend, seasonal, and random change to your sequence. Then apply an algorithm to each part.</p>
<p>You can look at the following article :<br/>
Study of the Long-term Performance Prediction Methods Using the Spacecraft Telemetry Data<br/>
from Hongzeng Fang<br/>
(Sorry but I can’t find a free dl page anymore ..).</p>
<div class="reply">
<a aria-label="Reply to Guillaume" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405402#respond" onclick='return addComment.moveForm( "comment-405402", "405402", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-405479">
<div class="comment-container" id="li-comment-405479">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 11, 2017 at 10:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405479" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the tip.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405479#respond" onclick='return addComment.moveForm( "comment-405479", "405479", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-395894">
<div class="comment-container" id="li-comment-395894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 10, 2017 at 5:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Nice post. Is there any tutorial available on multivariate time series forecasting problem?<br/>
I got two sets of data: traffic flow data and weather data.  I am thinking to predict the traffic flow using these two data sets.<br/>
I’d like to learn if I get weather condition involved what will happen for my model.<br/>
Could you kindly give me some advice?<br/>
Thank you.</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395894#respond" onclick='return addComment.moveForm( "comment-395894", "395894", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-395913">
<div class="comment-container" id="li-comment-395913">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 10, 2017 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-395913" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I do not have a multivariate regression example, but I hope to post one soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=395913#respond" onclick='return addComment.moveForm( "comment-395913", "395913", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-396190">
<div class="comment-container" id="li-comment-396190">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 12, 2017 at 10:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396190" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great. Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396190#respond" onclick='return addComment.moveForm( "comment-396190", "396190", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-396217">
<div class="comment-container" id="li-comment-396217">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ef10133ba4bbc7d63f56446ed831b1bd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ef10133ba4bbc7d63f56446ed831b1bd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">galdo trouchky</span>
<span class="date">April 12, 2017 at 7:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396217" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That would be awesome, indeed</p>
<div class="reply">
<a aria-label="Reply to galdo trouchky" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396217#respond" onclick='return addComment.moveForm( "comment-396217", "396217", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-415107">
<div class="comment-container" id="li-comment-415107">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/60621ea4285d8f8b2de21f0c44dfe602?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/60621ea4285d8f8b2de21f0c44dfe602?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wenhan Wang</span>
<span class="date">September 29, 2017 at 10:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415107" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason. It is really a nice example of using LSTM. I’m working on it.<br/>
I also have the same question, are you going to give an example on multivariate time series forecasting? I’m struggling on it.</p>
<div class="reply">
<a aria-label="Reply to Wenhan Wang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415107#respond" onclick='return addComment.moveForm( "comment-415107", "415107", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-415163">
<div class="comment-container" id="li-comment-415163">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415163" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have an example here:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415163#respond" onclick='return addComment.moveForm( "comment-415163", "415163", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-396238">
<div class="comment-container" id="li-comment-396238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/31b071afa6e0c4c270edbddc304a8fba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/31b071afa6e0c4c270edbddc304a8fba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gabriel Beauplet</span>
<span class="date">April 13, 2017 at 12:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You did a great job. This is very detailed ! Bravo 😉</p>
<div class="reply">
<a aria-label="Reply to Gabriel Beauplet" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396238#respond" onclick='return addComment.moveForm( "comment-396238", "396238", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396287">
<div class="comment-container" id="li-comment-396287">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 13, 2017 at 10:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396287" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad you found it useful Gabriel.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396287#respond" onclick='return addComment.moveForm( "comment-396287", "396287", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-396895">
<div class="comment-container" id="li-comment-396895">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hand</span>
<span class="date">April 19, 2017 at 1:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396895" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial,</p>
<p>How do we get a prediction on a currently not existing point in the future?</p>
<div class="reply">
<a aria-label="Reply to Hand" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396895#respond" onclick='return addComment.moveForm( "comment-396895", "396895", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396983">
<div class="comment-container" id="li-comment-396983">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 20, 2017 at 9:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396983" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>yhat = model.predict(X)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396983#respond" onclick='return addComment.moveForm( "comment-396983", "396983", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-396948">
<div class="comment-container" id="li-comment-396948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 20, 2017 at 1:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I mean without a y. </p>
<p>Error measurements are cool, but I also want to make a prediction for a next step.<br/>
That’s my main intention to read this tutorial.</p>
<p>Since there are other tutorials out there, lacking the same issue, it would be great to have a complete example, with a real live ouput/result/value. </p>
<p>I’m aware of the fact that every problem should have its own solution/model, but with a real result (or a comprehensible way to it), the code would be more practical/reusable- especially for python-ml beginners trying to predict some values in the future.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396948#respond" onclick='return addComment.moveForm( "comment-396948", "396948", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-396994">
<div class="comment-container" id="li-comment-396994">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 20, 2017 at 9:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-396994" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fit your model on the entire training dataset then predict the next time step as:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7e6bf9020913934" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
yhat = model.predict(X)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7e6bf9020913934-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7e6bf9020913934-1"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=396994#respond" onclick='return addComment.moveForm( "comment-396994", "396994", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-400228">
<div class="comment-container" id="li-comment-400228">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e6d3d830a29cf720d19da7e53d6aea0c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e6d3d830a29cf720d19da7e53d6aea0c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Donna</span>
<span class="date">May 22, 2017 at 7:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400228" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for your tutorial. But can you specify how to fit the model on the entire training set and do the prediction for future point? Thanks.</p>
<div class="reply">
<a aria-label="Reply to Donna" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400228#respond" onclick='return addComment.moveForm( "comment-400228", "400228", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-400243">
<div class="comment-container" id="li-comment-400243">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 22, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400243" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is just a little too much hand holding Donna. What are you having trouble with exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400243#respond" onclick='return addComment.moveForm( "comment-400243", "400243", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397020">
<div class="comment-container" id="li-comment-397020">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 20, 2017 at 2:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397020" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason,</p>
<p>I’m new to Python (mainly coding other languages) and just beginning to understand the code- thanks to your outstanding detailed descriptions. </p>
<p>In the last weeks I tried out two other tutorials and failed exactly at this point (making a first own test-appliance with a result).  </p>
<p>A) Could you please suggest a location/row number in the code in one of the examples for that line?</p>
<p>B) Is there a magic trick available to avoid the date conversion and work with real dates in own data sets?<br/>
In the moment I would have to transform my data to that date format of the used raw data.</p>
<p>I’m afraid to break the code logic. </p>
<p>But I also try to research every crucial part of the code separately for example here:<br/>
<a href="https://docs.scipy.org/doc/numpy/reference/arrays.indexing.html" rel="nofollow">https://docs.scipy.org/doc/numpy/reference/arrays.indexing.html</a></p>
<p>My current Python skills are on the level of this tutorial<br/>
<a href="https://www.youtube.com/watch?v=N4mEzFDjqtA" rel="nofollow">https://www.youtube.com/watch?v=N4mEzFDjqtA</a> .</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397020#respond" onclick='return addComment.moveForm( "comment-397020", "397020", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397088">
<div class="comment-container" id="li-comment-397088">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 21, 2017 at 8:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397088" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Hans,</p>
<p>What do you mean by “first own test-appliance with a result”. I don’t follow.</p>
<p>Do you mean make a prediction? If so you can make a prediction by fitting the model no all of your data and calling model.predict(X).</p>
<p>Pandas is really flexible when it comes to loading date data. A good approach for you might be to specify your own date parsing function to use when loading your data. See this post for an example that does this:<br/>
<a href="http://machinelearningmastery.com/stateful-stateless-lstm-time-series-forecasting-python/" rel="nofollow">http://machinelearningmastery.com/stateful-stateless-lstm-time-series-forecasting-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397088#respond" onclick='return addComment.moveForm( "comment-397088", "397088", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397022">
<div class="comment-container" id="li-comment-397022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 20, 2017 at 3:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Worth to mention (latest Windows-Info 4.2017):</p>
<p>There is an issue with Keras/Anaconda on Windows.<br/>
To run the last example above on Win, we have to manually reinstall Keras.<br/>
Further informations can be found here:<br/>
<a href="https://github.com/llSourcell/How-to-Predict-Stock-Prices-Easily-Demo/issues/3#issuecomment-288981625" rel="nofollow">https://github.com/llSourcell/How-to-Predict-Stock-Prices-Easily-Demo/issues/3#issuecomment-288981625</a><br/>
…otherwise it throws compiling errors.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397022#respond" onclick='return addComment.moveForm( "comment-397022", "397022", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397089">
<div class="comment-container" id="li-comment-397089">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 21, 2017 at 8:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397089" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does this tutorial work for you?<br/>
<a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397089#respond" onclick='return addComment.moveForm( "comment-397089", "397089", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-397113">
<div class="comment-container" id="li-comment-397113">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 21, 2017 at 11:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397113" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I already saw this tutorial written by you. </p>
<p>On Windows (not a Mac) it’s a slightly different story to build such an environment, even with Anaconda.</p>
<p>It begins with the fact that there is no Tensorflow with a version &lt;= 3 for Windows and ends with the Keras-hint.</p>
<p>We needed several days to discuss it on Github and find the right setup in the context of another RNN-script (see the link).</p>
<p>I use virtual conda-environments and your scripts are running on windows if the keras-hint is implemented.<br/>
Before I had the same issue with some of your scripts then with the discussed one on Github (compile error).</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397113#respond" onclick='return addComment.moveForm( "comment-397113", "397113", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397027">
<div class="comment-container" id="li-comment-397027">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 20, 2017 at 5:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397027" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Update, what I mean:</p>
<p>I guess one could trigger “forecast_lstm(model, batch_size, X)” or “yhat = model.predict(X)” from the end of the last two example scripts. </p>
<p>But how to do that in regard to the trained model?</p>
<p>“Month=13, Predicted=???”</p>
<p>Do I have to define a new “fictional” X? And if so how?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397027#respond" onclick='return addComment.moveForm( "comment-397027", "397027", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397090">
<div class="comment-container" id="li-comment-397090">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 21, 2017 at 8:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397090" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You must load the new input data for which a prediction is required as X and use your already fit model to make the prediction by calling the predict() function.</p>
<p>I’m eager to help, but perhaps I don’t understand the difficulty exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397090#respond" onclick='return addComment.moveForm( "comment-397090", "397090", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-397109">
<div class="comment-container" id="li-comment-397109">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 21, 2017 at 10:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397109" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>I knew I shouldn’t mention the date conversion part :-). Meanwhile I managed it with “return datetime.strptime(x, ‘%Y-%m-%d’)”<br/>
I have all of your example script parts in separate python file version. So I can test out modifications for specific requirements.<br/>
<code><br/>
python basic_data_loading.py<br/>
python persistence_forecast_model.py<br/>
python transform_time_series_to_supervised.py<br/>
python transform_time_series_to_statonary_remove_trends.py<br/>
python transform_scales.py<br/>
python complete_example.py<br/>
</code></p>
<p>Own data loading is solved. That was a relatively easy task.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397109#respond" onclick='return addComment.moveForm( "comment-397109", "397109", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-397112">
<div class="comment-container" id="li-comment-397112">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 21, 2017 at 10:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397112" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Since the transforming and performance measurement parts are running (I guess they will do even with integer data)<br/>
I now have to build a part lets call it:</p>
<p>“python predict_one_value.py”</p>
<p>Of course I have to load my own data that’s clear. </p>
<p>The question is where to trigger the function<br/>
<code><br/>
yhat = model.predict(X)<br/>
</code><br/>
in the context of one of your example-scripts and finally say:<br/>
print(yhat). That’s all. </p>
<p>I guess a short example snippet could solve the problem.<br/>
Could you provide an example- It would help a lot?</p>
<p>Currently I also don’t understand the role of X completely.<br/>
In the context of “datetime.strptime” it seems to be a date only, If I print it out.<br/>
So if I would have training data of:<br/>
– 01.12.1977<br/>
– 02.12.1977<br/>
– 03.12.1977<br/>
I would guess I could say something like “yhat = model.predict(“1977-12-04″)”.<br/>
The question is where and when in which code context.</p>
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397112#respond" onclick='return addComment.moveForm( "comment-397112", "397112", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-397116">
<div class="comment-container" id="li-comment-397116">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 21, 2017 at 12:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397116" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Update:</p>
<p>Currently I use the the code from “complete example” (“without robust result”).<br/>
If I comment out from line 106 to line 127 and then at the end of the script say:</p>
<p><code><br/>
# report one value in the future<br/>
test = datetime.strptime('2017-04-15', '%Y-%m-%d')<br/>
yhat = model.predict(test)<br/>
print(yhat)<br/>
</code></p>
<p>I get the error message ‘model is not defined’. So trying…</p>
<p><code><br/>
# report one value in the future<br/>
test = datetime.strptime('2017-04-15', '%Y-%m-%d')<br/>
yhat = lstm_model.predict(test)<br/>
print(yhat)<br/>
</code></p>
<p>…throws the error “Data should be a Numby array”.</p>
<p>I guess maybe I could also append a new date to the raw data (without a y),<br/>
but I’m not sure If this would be right.</p>
<p>The best way to get this running would be an example snipped in context.</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397116#respond" onclick='return addComment.moveForm( "comment-397116", "397116", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-397187">
<div class="comment-container" id="li-comment-397187">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 22, 2017 at 9:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397187" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will give you a clearer idea of how to use neural nets in Keras including making predictions:<br/>
<a href="http://machinelearningmastery.com/5-step-life-cycle-neural-network-models-keras/" rel="nofollow">http://machinelearningmastery.com/5-step-life-cycle-neural-network-models-keras/</a></p>
<p>Yes, input data to making a prediction must be a 2D numpy array. It will not be date data, it will be past obs in the case of time series forecasting.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397187#respond" onclick='return addComment.moveForm( "comment-397187", "397187", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-397218">
<div class="comment-container" id="li-comment-397218">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 22, 2017 at 11:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397218" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you,</p>
<p>I will read it ;-).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-397229">
<div class="comment-container" id="li-comment-397229">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 22, 2017 at 12:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397229" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have read the tutorial and tried out the pima indians diabetes example.<br/>
I guess I got it and understand the 5 steps (mostly).</p>
<p>Unfortunately this does not answer my question. Or do I miss something?<br/>
In my problem I have only one input like in the tutorial on this site.</p>
<p>When you say:</p>
<p>“yhat = model.predict(X)”</p>
<p>would give a forecast for a next step.<br/>
What about a step which is not in the training data nor in the test data?</p>
<p>I have a SVM model which proves and predicts based on my raw data (realized in another environment).<br/>
Lets say I have 100 items training data, 10 items test data.<br/>
It will printout 10 predictions and additionally corresponding performance data.<br/>
The last printed prediction is for a future step which lies in the future.</p>
<p>How would this be archived in your example?<br/>
Do I have to shift something?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-397291">
<div class="comment-container" id="li-comment-397291">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 23, 2017 at 5:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397291" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>To make predictions beyond your dataset, you must feed in the last few observations from your dataset as input (X) to predict what happens next (y).</p>
<p>This post might clear up your thinking on X and y:<br/>
<a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-supervised-learning/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-397314">
<div class="comment-container" id="li-comment-397314">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 23, 2017 at 1:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397314" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>&gt;To make predictions beyond your dataset, you must feed in the last few observations from your dataset as input (X) to &gt;predict what happens next (y).</p>
<p>Is there an example available where this is done?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-397381">
<div class="comment-container" id="li-comment-397381">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397381" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the “LSTM Forecast” section of this very post.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-397433">
<div class="comment-container" id="li-comment-397433">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 24, 2017 at 1:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397433" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Assuming that “X = row[0:-1]” is an observation,<br/>
how do we sample/collect the last few observations, to make a forecast.?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-397520">
<div class="comment-container" id="li-comment-397520">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 25, 2017 at 7:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397520" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on your model, if your model expects the last one observation as input, then reframe that value as a 2d array and provide it as X to model.predict(X). </p>
<p>If your model requires the last two lag obs as inputs, retrieve them, define them as a one row, two column matrix and provide them to model.predict(). </p>
<p>And so on. I hope that helps.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-405735">
<div class="comment-container" id="li-comment-405735">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.linkedin.com/in/arunpmenon1990/" rel="external nofollow">Arun</a></span>
<span class="date">July 13, 2017 at 10:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405735" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason,</p>
<p>Even i started with machine learning and have similar kind of doubt so in one step forecasting we can only get one time step future observation correct ? and to get the prediction i have provided last input observation and then the value obtained from model.predict(X) has to be again scaled and inversed correct ?</p>
<p>PFB the code:<br/>
X = test_scaled[3,-1:] (my last observation)<br/>
yhat = forecast_lstm(lstm_model, 1, X)<br/>
yhat = invert_scale(scaler, X, yhat)<br/>
yhat = inverse_difference(raw_values, yhat, 1)<br/>
print(yhat)</p>
<p>Can you please guide me if i am going in a right way ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-405757">
<div class="comment-container" id="li-comment-405757">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 4:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405757" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, one step forecasting involves predicting the next time step. </p>
<p>You can make multi-step forecasts, learn more in this post:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>Yes, to make use of the prediction you will need to invert any data transforms performed such as scaling and differencing.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-405787">
<div class="comment-container" id="li-comment-405787">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun Menon</span>
<span class="date">July 13, 2017 at 11:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405787" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason ..</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-405789">
<div class="comment-container" id="li-comment-405789">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun Menon</span>
<span class="date">July 13, 2017 at 11:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405789" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Being said that, i have another clarification , so when i forecast the next time step using this model , using the below code:<br/>
X = test_scaled[3,-1:] (my last observation)<br/>
yhat = forecast_lstm(lstm_model, 1, X)<br/>
yhat = invert_scale(scaler, X, yhat)<br/>
yhat = inverse_difference(raw_values, yhat, 1)<br/>
print(yhat)</p>
<p>in the above code, let yhat be the prediction of future time step, can i use the result of yhat and use the same model to predict one more step ahead in the future ? is this what we call as the recursive multistep forecast ?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-405845">
<div class="comment-container" id="li-comment-405845">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 14, 2017 at 8:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405845" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. This is recursive.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-405803">
<div class="comment-container" id="li-comment-405803">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun Menon</span>
<span class="date">July 14, 2017 at 1:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405803" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Can i use the below code and use the recursive multistep forecast<br/>
for eg :<br/>
yhat value can be used as an input to the same model again to get the next future step and so on ?</p>
<p>X = test_scaled[3,-1:] (my last observation)<br/>
yhat = forecast_lstm(lstm_model, 1, X)<br/>
yhat = invert_scale(scaler, X, yhat)<br/>
yhat = inverse_difference(raw_values, yhat, 1)<br/>
print(yhat)</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-405872">
<div class="comment-container" id="li-comment-405872">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun Menon</span>
<span class="date">July 14, 2017 at 11:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405872" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In predictive analytics using this ML technique, how many future steps should we able to predict , is there any ideal forecasting range in future for eg if i have a data for the last 10 days or so , and i want to forecast the future , the less the future time steps are set, the better the result as the error will be minimum right. Can i use the same code for predicting time series data in production for network traffic for future 3 days ? requirement given for me was to predict the network bandwidth  for the next entire week given the data for past 1 year.</p>
<p>Your comments and suggestions always welcome 🙂</p>
<p>Regards,<br/>
Arun</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-405992">
<div class="comment-container" id="li-comment-405992">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 15, 2017 at 9:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405992" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on the problem and the model. </p>
<p>Generally, the further in the future you want to predict, the worse the performance of the model.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397140">
<div class="comment-container" id="li-comment-397140">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 21, 2017 at 6:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397140" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>can we normalize the RMSE-value(s)?<br/>
And if so how?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397140#respond" onclick='return addComment.moveForm( "comment-397140", "397140", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397190">
<div class="comment-container" id="li-comment-397190">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 22, 2017 at 9:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397190" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Normalize the skill score?</p>
<p>Yes, but you will need to know the largest possible error.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397190#respond" onclick='return addComment.moveForm( "comment-397190", "397190", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-397230">
<div class="comment-container" id="li-comment-397230">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">April 22, 2017 at 12:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397230" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m feeding your example with values ranged from 1 to 70.</p>
<p>There is no increasing trend in my raw data.</p>
<p>When it comes to predictions the script predicts values above 70.<br/>
Regarding to the other tutorial (5 Step Life-Cycle) I think it has to do with the compile part (model.compile).<br/>
But I’m not sure. Could you provide a comprehensible hint in regard of the example script on this site?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397230#respond" onclick='return addComment.moveForm( "comment-397230", "397230", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397307">
<div class="comment-container" id="li-comment-397307">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9dc8ca3092f4d85328f34e0713834785?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9dc8ca3092f4d85328f34e0713834785?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fabian</span>
<span class="date">April 23, 2017 at 10:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397307" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
assuming you had multiple features (you can add one feature to the shampoo dataset) and wanted to use multiple timesteps, what would the dataset look like that I put into the model? Is it a 3 dimensional array, where the features are lists of values and each observation is a list of these features and the label(s) (which is also a list of values)?</p>
<div class="reply">
<a aria-label="Reply to Fabian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397307#respond" onclick='return addComment.moveForm( "comment-397307", "397307", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397380">
<div class="comment-container" id="li-comment-397380">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 24, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397380" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, it would be a 3D array with the dimensions [samples, timesteps, features].</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397380#respond" onclick='return addComment.moveForm( "comment-397380", "397380", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-397618">
<div class="comment-container" id="li-comment-397618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f7542e2ce2c97b0a2353581b09f8403c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f7542e2ce2c97b0a2353581b09f8403c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rahul</span>
<span class="date">April 26, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Right now the model gives only one step forecast. What if I wanted to create a model which gives forecast for next 60 months.</p>
<div class="reply">
<a aria-label="Reply to Rahul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397618#respond" onclick='return addComment.moveForm( "comment-397618", "397618", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397631">
<div class="comment-container" id="li-comment-397631">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 26, 2017 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397631" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I will have a post on this see, until then see this post:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397631#respond" onclick='return addComment.moveForm( "comment-397631", "397631", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397702">
<div class="comment-container" id="li-comment-397702">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">April 27, 2017 at 1:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397702" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I have a question.<br/>
raw_values = series.values<br/>
diff_values = difference(raw_values, 1)<br/>
print(len(raw_values))        36<br/>
print(len(diff_values))         35</p>
<p>So, after difference we lose the first value?</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397702#respond" onclick='return addComment.moveForm( "comment-397702", "397702", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397741">
<div class="comment-container" id="li-comment-397741">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2017 at 8:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397741" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397741#respond" onclick='return addComment.moveForm( "comment-397741", "397741", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-397706">
<div class="comment-container" id="li-comment-397706">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/81fc844d62d6a167083283acc56e3ca1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/81fc844d62d6a167083283acc56e3ca1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Guido van Steen</a></span>
<span class="date">April 27, 2017 at 2:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397706" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason, </p>
<p>Thank you very much for this extremely useful and interesting post. </p>
<p>I may be missing something, but I think there is one omission: By differencing you loose the trend including its start and end level. Later on you try restore the trend again, but in your code it seems you fail to restore the end level. IMO the end level of the current observations should be added to all the predictions.  </p>
<p>Thanks again!</p>
<div class="reply">
<a aria-label="Reply to Guido van Steen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397706#respond" onclick='return addComment.moveForm( "comment-397706", "397706", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397743">
<div class="comment-container" id="li-comment-397743">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2017 at 8:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397743" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you mean by the end level? Sorry I don’t follow, perhaps you could restate your comment?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397743#respond" onclick='return addComment.moveForm( "comment-397743", "397743", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-397709">
<div class="comment-container" id="li-comment-397709">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ae4a59d807ca5b17d16554946460696c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ae4a59d807ca5b17d16554946460696c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Raul</span>
<span class="date">April 27, 2017 at 3:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397709" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great tutorial!<br/>
Quick question: On the scaling section of the tutorial you say that </p>
<p>“To make the experiment fair, the scaling coefficients (min and max) values must be calculated on the training dataset and applied to scale the test dataset and any forecasts. This is to avoid contaminating the experiment with knowledge from the test dataset, which might give the model a small edge.”</p>
<p>However, if the max of your sample is on the test dataset the scaling with parameters from the training set will yield a number outside the [-1,1] range. How can one deal with that?</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Raul" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397709#respond" onclick='return addComment.moveForm( "comment-397709", "397709", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-397744">
<div class="comment-container" id="li-comment-397744">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 27, 2017 at 8:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397744" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<p>One good approach is to estimate the expected min and max values that are possible for the domain and use these to scale.</p>
<p>If even then you see values out of range, you can clamp them to the bounds 0/1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397744#respond" onclick='return addComment.moveForm( "comment-397744", "397744", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-397720">
<div class="comment-container" id="li-comment-397720">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/367b5df5382b0a3feb7fd17bac0ea003?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/367b5df5382b0a3feb7fd17bac0ea003?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Guido van Steen</a></span>
<span class="date">April 27, 2017 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397720" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason, </p>
<p>To be more precise: you should add the difference between the start level and the end level of the train set. This is because the current code effectively replicates the train set. By this I means that it starts at the same level as the train set. However, it should start at the end level of the train set. </p>
<p>Kind regards, </p>
<p>Guido</p>
<div class="reply">
<a aria-label="Reply to Guido van Steen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397720#respond" onclick='return addComment.moveForm( "comment-397720", "397720", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-397770">
<div class="comment-container" id="li-comment-397770">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/367b5df5382b0a3feb7fd17bac0ea003?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/367b5df5382b0a3feb7fd17bac0ea003?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Guido van Steen</a></span>
<span class="date">April 27, 2017 at 3:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397770" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I will try to restate my comment: </p>
<p>Currently the predictions (of your test set) start at the same level as the observations (in your train set). Therefore, there is a shift between the last observed value (in your train set) and the first predicted value (of your test set). The size of this shift is equal to: start level of the observations minus end level of the observations (in your train set). You should correct for this shift by adding it to the predicted values.</p>
<div class="reply">
<a aria-label="Reply to Guido van Steen" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397770#respond" onclick='return addComment.moveForm( "comment-397770", "397770", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-397841">
<div class="comment-container" id="li-comment-397841">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 28, 2017 at 7:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397841" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Isn’t this made moot by making the data stationary?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397841#respond" onclick='return addComment.moveForm( "comment-397841", "397841", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-397820">
<div class="comment-container" id="li-comment-397820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bd02905e54b28969ac80042731a87ca6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bd02905e54b28969ac80042731a87ca6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Deeps</span>
<span class="date">April 28, 2017 at 4:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>1. can you please explain me the below 2 lines in detail. </p>
<p>model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1], X.shape[2]), stateful=True))<br/>
model.add(Dense(1))</p>
<p>2. I want to know the layer architecture. What are the number of neurons in hidden layer?<br/>
3. If I want to add one more hidden layer, how the syntax looks like?<br/>
4. What could be the reason for test rmse is less than train rmse?</p>
<div class="reply">
<a aria-label="Reply to Deeps" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397820#respond" onclick='return addComment.moveForm( "comment-397820", "397820", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-397860">
<div class="comment-container" id="li-comment-397860">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">April 28, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-397860" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The line defines the input layer and the first LSTM hidden layer with “neurons” number of memory units.</p>
<p>You can stack LSTMs, the first hidden layer must return sequences (return_sequence=True) and you can add a second LSTM layer. I have an example here:<br/>
<a href="http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">http://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/</a></p>
<p>Better performance on the test data than the training data may be a sign of an unstable/underfit model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=397860#respond" onclick='return addComment.moveForm( "comment-397860", "397860", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-398304">
<div class="comment-container" id="li-comment-398304">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6a1c54a7ba87f7c6072dc7ae19c2c0ca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6a1c54a7ba87f7c6072dc7ae19c2c0ca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fabio</span>
<span class="date">May 2, 2017 at 9:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398304" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hallo Jason, thank you for this post! I bought the first version of your book and I have seen you have in the meantime deeper analysed this topic. Very good! 🙂 Something have I yet not clear.</p>
<p>“Samples: These are independent observations from the domain, typically rows of data.<br/>
Time steps: These are separate time steps of a given variable for a given observation.”</p>
<p>I could understand the case where  the time step parameter is 1 as in your book and in this example but I can’t figure out why and how it could be grater than 1…</p>
<p>My hypothesys, sure wrong 🙂</p>
<p>Perhaps when a timestep is made of n observations one could give the value n to it…but then I would expect when one in the model writes (pag. 192):</p>
<p>“model.add(LSTM(4, input_shape=(1, look_back)))”</p>
<p>the LSTM would use (look_back * timesteps) rows for every step to predict the next row…</p>
<p>I cannot also understand why you say ‘of a given variable’…a row is normally built by the values of many variables, isn’t it?</p>
<p>Could you give me an example with timesteps &gt; 1? Thank you!</p>
<div class="reply">
<a aria-label="Reply to Fabio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398304#respond" onclick='return addComment.moveForm( "comment-398304", "398304", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398359">
<div class="comment-container" id="li-comment-398359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 3, 2017 at 7:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Fabio,</p>
<p>The structure of the input to the LSTM is [samples, timesteps, features]</p>
<p>If you have multiple observations at one time step, then these are represented as features.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398359#respond" onclick='return addComment.moveForm( "comment-398359", "398359", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-398933">
<div class="comment-container" id="li-comment-398933">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6a1c54a7ba87f7c6072dc7ae19c2c0ca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6a1c54a7ba87f7c6072dc7ae19c2c0ca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fabio</span>
<span class="date">May 7, 2017 at 10:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398933" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>unfortunately If don’t have a concrete example I cannot fully understand…The examples in your posts and your book are clear to me but they are always on timesteps=1…if I’m not wrong. For example how could be adapted the szenario described in this post in order to manage a timesteps&gt;1?</p>
<p>Thank you very much!</p>
<p>PS. In the meantime I bought also your book on time series 🙂</p>
<div class="reply">
<a aria-label="Reply to Fabio" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398933#respond" onclick='return addComment.moveForm( "comment-398933", "398933", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-398963">
<div class="comment-container" id="li-comment-398963">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398963" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post on multi-step forecasting:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398963#respond" onclick='return addComment.moveForm( "comment-398963", "398963", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-398586">
<div class="comment-container" id="li-comment-398586">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e3556750226c9743e5cefa9aa3bf2504?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e3556750226c9743e5cefa9aa3bf2504?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nitin</span>
<span class="date">May 5, 2017 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398586" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason for the wonderful tutorial!<br/>
I am using your tutorial to apply LSTM network on some syslog/network log data.</p>
<p>I have syslog data(a specific event) for each day for last 1 year and so I am using LSTM network for time series analysis.</p>
<p>As I understand from your tutorial.<br/>
	1. A batch of data is a fixed-sized number of rows from the training dataset that defines how many patterns to process before updating the weights of the network. Based on the batch_size the Model takes random samples from the data for the analysis. For time series this is not desirable, hence the batch_size should always be 1.<br/>
	2. By default, the samples within an epoch are shuffled prior to being exposed to the network. This is undesirable for the LSTM because we want the network to build up state as it learns across the sequence of observations. We can disable the shuffling of samples by setting “shuffle” to “False“.</p>
<p>Scenario1 –<br/>
Using above two rules/guidelines – I ran several trials with different number of neurons, epoch size and different layers and got better results from the baseline model(persistence model).</p>
<p>Scenario2-<br/>
Without using above guidelines/rules – I ran several trials with different number of neurons, epoch size and different layers and got even better results than Scenario 1.</p>
<p>Query – Setting shuffle to True and Batch_size values to 1 for time series. Is this a rule or a guideline?</p>
<p>It seems logical reading your tutorial that the data for time series should not be shuffled as we do not want to change the sequence of data, but for my data the results are better if I let the data be shuffled.<br/>
At the end what I think, what matters is how I get better predictions with my runs.<br/>
I think I should try and put away “theory” over concrete evidence, such as metrics, elbows, RMSEs,etc. </p>
<p>Kindly enlighten.</p>
<div class="reply">
<a aria-label="Reply to Nitin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398586#respond" onclick='return addComment.moveForm( "comment-398586", "398586", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398605">
<div class="comment-container" id="li-comment-398605">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 5, 2017 at 11:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398605" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Random samples are not taken, LSTMs require sequence data to be ordered – they learn order dependence.</p>
<p>The “shuffle” argument must be set to “False” on sequence prediction problems if sequence data is spread across samples.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398605#respond" onclick='return addComment.moveForm( "comment-398605", "398605", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-398840">
<div class="comment-container" id="li-comment-398840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Masum</span>
<span class="date">May 7, 2017 at 12:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,</p>
<p>I have two hours time series data which consists of 120 observations, using LSTM RNN how can I predict next 30 observation while putting all my data to training section. </p>
<p>We normally split the original data set in two data set ( test dataset and validation dataset) for checking our model performance. I would like to see that my model is only taking help from training dataset to produce an output that does match with validation data set. What I understand from several of your blogs that we are forecasting single value and using that single forecasting along with the help of validation dataset we are forecasting rest of values. I believe I getting lost there? How it is going to work when have only past and current data ( suppose no validation data) and we want to predict the next half an hour.</p>
<p>For example, suppose I have data of a product price from 12 to 1:30pm which consists of 90 observations and using these past 90 observations can we forecast the price of that product during 1:31 to 2:00pm(otherwise next 30 observations) .</p>
<p>Would you please help me to solve the confusion that I have? By the way I am going through your books time series forecasting with Python and deep learning with Python.</p>
<div class="reply">
<a aria-label="Reply to Masum" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398840#respond" onclick='return addComment.moveForm( "comment-398840", "398840", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398871">
<div class="comment-container" id="li-comment-398871">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 7, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398871" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can make a multi-step model with an LSTM by using it directly (predict n timesteps in a one shot manner) or recursively (use the same model again and again and use predictions as inputs for subsequent predictions).</p>
<p>More on multi-step forecasting here:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398871#respond" onclick='return addComment.moveForm( "comment-398871", "398871", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-398874">
<div class="comment-container" id="li-comment-398874">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">May 7, 2017 at 5:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398874" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for quick replay </p>
<p>Looks like you sleep very less as you have provided feedback on early morning from your site.</p>
<p>Thanks for being so kind to your students. May god bless you.</p>
<p>By the way do you have any blog or example for second option that you have provided me(use the same model again and again and use predictions as inputs for subsequent predictions). Obviously I would like to see that I am not using any data from validation dataset or not getting any feedback from validation data. Model should only from past and current data along with current predictions. I hope you got this confused student.</p>
<p>Thanking you</p>
<div class="reply">
<a aria-label="Reply to masum" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398874#respond" onclick='return addComment.moveForm( "comment-398874", "398874", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-398957">
<div class="comment-container" id="li-comment-398957">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 8, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-398957" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t have an example of using the model recursively. I believe you could adapt the above example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=398957#respond" onclick='return addComment.moveForm( "comment-398957", "398957", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-399099">
<div class="comment-container" id="li-comment-399099">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">masum</span>
<span class="date">May 9, 2017 at 9:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399099" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>would you please give me some hint where I have to change the code to make the model recursive as I am not very good at coding.</p>
<div class="reply">
<a aria-label="Reply to masum" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399099#respond" onclick='return addComment.moveForm( "comment-399099", "399099", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-399244">
<div class="comment-container" id="li-comment-399244">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2017 at 8:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399244" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Predictions would be used as history (input) to make predictions on the subsequent time steps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399244#respond" onclick='return addComment.moveForm( "comment-399244", "399244", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399110">
<div class="comment-container" id="li-comment-399110">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0ae8f55c5fc584f60ca9ad7fce0890ed?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0ae8f55c5fc584f60ca9ad7fce0890ed?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Max</span>
<span class="date">May 9, 2017 at 11:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399110" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason for the wonderful tutorial!<br/>
A little problem here:</p>
<p><code></code><code><br/>
def invert_scale(scaler, X, value):<br/>
	new_row = [x for x in X] + [yhat]<br/>
        ...<br/>
</code><code></code></p>
<p>Does it should be </p>
<p><code></code><code><br/>
def invert_scale(scaler, X, value):<br/>
	new_row = [x for x in X] + [value]<br/>
        ...<br/>
</code><code></code></p>
<div class="reply">
<a aria-label="Reply to Max" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399110#respond" onclick='return addComment.moveForm( "comment-399110", "399110", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399247">
<div class="comment-container" id="li-comment-399247">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 10, 2017 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399247" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Max.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399247#respond" onclick='return addComment.moveForm( "comment-399247", "399247", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-399838">
<div class="comment-container" id="li-comment-399838">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e62f690a21715117e1c6eef9da5932c2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e62f690a21715117e1c6eef9da5932c2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Charlie</span>
<span class="date">May 17, 2017 at 4:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399838" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m getting the following error when running the first block of code you provide.</p>
<p>TypeError: strptime() argument 1 must be str, not numpy.ndarray</p>
<p>It seems like this a problem with how Python 3.6 handles byte strings.</p>
<div class="reply">
<a aria-label="Reply to Charlie" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399838#respond" onclick='return addComment.moveForm( "comment-399838", "399838", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-399862">
<div class="comment-container" id="li-comment-399862">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 17, 2017 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399862" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have only tested the code on Python 2.7 and Python 3.5, perhaps try one of those?</p>
<p>Otherwise, you may need to adapt the example for your specific platform, if an API change is indeed the cause of your issue.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399862#respond" onclick='return addComment.moveForm( "comment-399862", "399862", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-419313">
<div class="comment-container" id="li-comment-419313">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/de683b611016bc221494aa857a6276c8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/de683b611016bc221494aa857a6276c8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sabih</span>
<span class="date">November 8, 2017 at 6:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419313" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The issue was with the text in footer ‘Sales of shampoo over a three year period’.</p>
<p>Either delete the footer OR </p>
<p>Change the line:</p>
<p>series = read_csv(‘shampoo-sales.csv’, header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser)</p>
<p>to:</p>
<p>series = read_csv(‘shampoo-sales.csv’, header=0, parse_dates=[0], index_col=0, squeeze=True, date_parser=parser, skipfooter=2)</p>
<div class="reply">
<a aria-label="Reply to Sabih" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419313#respond" onclick='return addComment.moveForm( "comment-419313", "419313", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-420895">
<div class="comment-container" id="li-comment-420895">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ac867dafb84fb456bbbecf27778b309?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.etherpros.com" rel="external nofollow">John Strong</a></span>
<span class="date">November 23, 2017 at 2:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420895" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think that error is caused by the line of descriptive text at the bottom of the shampoo sales data file. If you see this comment at the bottom of the data file, remove it:</p>
<p>Sales of shampoo over a three year period</p>
<p>The data file also has the dates enclosed in double quotes. A couple of times that bit me too. The date_parser callback is a little fickle.</p>
<div class="reply">
<a aria-label="Reply to John Strong" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420895#respond" onclick='return addComment.moveForm( "comment-420895", "420895", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-399941">
<div class="comment-container" id="li-comment-399941">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Logan</span>
<span class="date">May 18, 2017 at 10:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-399941" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, Your examples are great, thanks. </p>
<p>I have a question:</p>
<p>1- What do we do with the array of predicted values when we use lstm_model.predict() with train data in the example? It seems like they are not being used. Is it important for the net?</p>
<div class="reply">
<a aria-label="Reply to Logan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=399941#respond" onclick='return addComment.moveForm( "comment-399941", "399941", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400003">
<div class="comment-container" id="li-comment-400003">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 19, 2017 at 8:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400003" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Logan.</p>
<p>What do you mean exactly? Is there a specific section and line of code you are referring to in the tutorial?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400003#respond" onclick='return addComment.moveForm( "comment-400003", "400003", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-400606">
<div class="comment-container" id="li-comment-400606">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a925a54fb54e27f347277bd66836ce66?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Logan</span>
<span class="date">May 27, 2017 at 2:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400606" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, line 101 lstm_model.predict(train_reshaped, batch_size=1) on section Complete LSTM Example.</p>
<p>By the way, I have another question: When the differentiation is applied to the entire dataset, isn’t it giving information about the test dataset to the model? </p>
<p>Thanks. You’ve been helping me a lot.</p>
<div class="reply">
<a aria-label="Reply to Logan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400606#respond" onclick='return addComment.moveForm( "comment-400606", "400606", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-401147">
<div class="comment-container" id="li-comment-401147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 11:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In this case yes, but in practice, we can apply the same method to the test data using data from training step-wise without cheating.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401147#respond" onclick='return addComment.moveForm( "comment-401147", "401147", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400029">
<div class="comment-container" id="li-comment-400029">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3ffdb7d9cf7b2b04b706ea2d4da936e1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3ffdb7d9cf7b2b04b706ea2d4da936e1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brandon</span>
<span class="date">May 19, 2017 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400029" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks so much for this helpful tutorial. Could you clarify which of all the parameters need to be updated to change the lag value? I haven’t been able to get it to work.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Brandon" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400029#respond" onclick='return addComment.moveForm( "comment-400029", "400029", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400081">
<div class="comment-container" id="li-comment-400081">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 20, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400081" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>Change the parameters to the timeseries_to_supervised() function</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400081#respond" onclick='return addComment.moveForm( "comment-400081", "400081", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400760">
<div class="comment-container" id="li-comment-400760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/469421fd2b802081532dd81d56c38da2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/469421fd2b802081532dd81d56c38da2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nirikshith</span>
<span class="date">May 29, 2017 at 8:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-400760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have been following you for quite sometime now. Another great example for time series. I remember trying out sliding window approach in one of the earlier blogs. I am still waiting for you to write up a blog on involving external features(it can be as simple as (is_weekday =0/1 is_weekend=0/1) and see how its implemented.</p>
<p>can you point out where we can add the above external variables in the above example and the format please for these features please. I will try it out. being new to python its very confusing with these reshapes and pre -format required for LSTM s</p>
<p>#aspring data scientist, student</p>
<div class="reply">
<a aria-label="Reply to Nirikshith" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=400760#respond" onclick='return addComment.moveForm( "comment-400760", "400760", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401184">
<div class="comment-container" id="li-comment-401184">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401184" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can add them as separate features.</p>
<p>I am working on an example at the moment. I hope to post it when it gives good results.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401184#respond" onclick='return addComment.moveForm( "comment-401184", "401184", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-401056">
<div class="comment-container" id="li-comment-401056">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Donato</span>
<span class="date">June 1, 2017 at 10:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401056" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, nice example! I have your similar problem, but I don’t know how resolve. I have a two different class to predict, in different files. I have to training my neural network with this different files. The problem is that each file has different number of samples, and I have to use the same LSTM for each file.How I can generalize the number of input for each LSTM??<br/>
This is my problem:<br/>
<a href="https://drive.google.com/file/d/0B5hOtU0Xa45RUDJJWHVyeHVNQWM/view?usp=sharing" rel="nofollow">https://drive.google.com/file/d/0B5hOtU0Xa45RUDJJWHVyeHVNQWM/view?usp=sharing</a></p>
<div class="reply">
<a aria-label="Reply to Donato" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401056#respond" onclick='return addComment.moveForm( "comment-401056", "401056", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401235">
<div class="comment-container" id="li-comment-401235">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401235" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Maybe this post will help you better understand your prediction problem and frame it as supervised learning:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401235#respond" onclick='return addComment.moveForm( "comment-401235", "401235", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-401575">
<div class="comment-container" id="li-comment-401575">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d57ffba71bc818b2102fa81b36980ab6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Donato</span>
<span class="date">June 5, 2017 at 8:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401575" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the answere, I have understand which is my problem. It depends from the training, because I have a lot of file for training, and when I insert a new file and remake the fit, the previusly information are forgotten. Do you have some examples for train the LSTM with more file? And where each one has the supervisioned learning, apply to time-series and predict information? Thank you!</p>
<div class="reply">
<a aria-label="Reply to Donato" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401575#respond" onclick='return addComment.moveForm( "comment-401575", "401575", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-401629">
<div class="comment-container" id="li-comment-401629">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 6, 2017 at 9:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401629" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, this example shows how to update an existing model with more data:<br/>
<a href="http://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401629#respond" onclick='return addComment.moveForm( "comment-401629", "401629", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-401896">
<div class="comment-container" id="li-comment-401896">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1ca0e6d93252317c22bb1686f29a3734?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1ca0e6d93252317c22bb1686f29a3734?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pengyuan Shao</span>
<span class="date">June 8, 2017 at 10:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401896" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason:<br/>
You did a great job!!<br/>
Thank you for sharing the great post with us.<br/>
I’m a beginner to machine learning, these days i am busy on doing a project to predict the movement of ship on the sea.<br/>
I found this post is very usefull and easy to understand.<br/>
I have one question that:<br/>
if the number of neurons is the past steps used to predict next step?<br/>
Thank you for answer in advance.</p>
<p>Best wishes</p>
<div class="reply">
<a aria-label="Reply to Pengyuan Shao" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401896#respond" onclick='return addComment.moveForm( "comment-401896", "401896", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401941">
<div class="comment-container" id="li-comment-401941">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-401941" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure what you mean.</p>
<p>The number of neurons defines the size/complexity of the model. The model is used to make predictions.</p>
<p>Perhaps you could reframe your question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=401941#respond" onclick='return addComment.moveForm( "comment-401941", "401941", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-402127">
<div class="comment-container" id="li-comment-402127">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/368bff0a67d60ed7ff24404f17d822b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/368bff0a67d60ed7ff24404f17d822b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Macarena</span>
<span class="date">June 10, 2017 at 7:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402127" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
Congrats for the blog, and thanks! It helped me a lot.<br/>
I have one question related to the data transformation. I understand the step to make that one input is the last output, so the LSTM can learn and save that info. But I have a different case (classification) and I don’t know how could I apply this.<br/>
In my case my inputs are images (frames from a video) what have a temporal dependency, and my outputs are numbers (0,1 or 2). First I want to pass the images through a CNN network and then take the features and those would be my LSTM input. In that case, it is necessary to process the data as you have done here? I thought the LSTM would save that info by itself, but now I’m not so sure.</p>
<p>Thank you in advance.</p>
<div class="reply">
<a aria-label="Reply to Macarena" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402127#respond" onclick='return addComment.moveForm( "comment-402127", "402127", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402176">
<div class="comment-container" id="li-comment-402176">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 11, 2017 at 8:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402176" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t have an example of working with video data.</p>
<p>Generally, the principles would be the same. As a classification problem, you would need to change the output layer to use one of the log loss activation functions. The input would be from a CNN or similar, e.g. [cnn]-&gt;[lstm]-&gt;[dense].</p>
<p>Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402176#respond" onclick='return addComment.moveForm( "comment-402176", "402176", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-402559">
<div class="comment-container" id="li-comment-402559">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">June 15, 2017 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402559" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In your ARIMA tutorial you also use the shampoo data set, but measure accuracy by MSE.  Making the change to RMSE:<br/>
<code></code><code><br/>
rmse = sqrt(mean_squared_error(test, predictions))<br/>
print('Test RMSE: %.3f' % rmse)<br/>
</code><code></code><br/>
I get:<br/>
<code></code><code><br/>
&gt; Test RMSE: 83.417<br/>
</code><code></code><br/>
Can we conclude that ARIMA is far better than an LSTM for this problem so far in our research?</p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402559#respond" onclick='return addComment.moveForm( "comment-402559", "402559", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-402588">
<div class="comment-container" id="li-comment-402588">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 15, 2017 at 8:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402588" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, these are demonstrations. Both algorithms would require tuning to present the best version of themselves (“steel man” vs “straw man”) for model selection.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402588#respond" onclick='return addComment.moveForm( "comment-402588", "402588", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-402602">
<div class="comment-container" id="li-comment-402602">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">June 15, 2017 at 12:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402602" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are writing the timeseries_to_supervised function to accept a lag:<br/>
<code></code><code><br/>
def timeseries_to_supervised(data, lag=1):<br/>
</code><code></code><br/>
Is this feature to essentially the Window Method + reshaping described in your July 21, 2016 tutorial?  </p>
<p>But we don’t seem to use that parameter, always “timeseries_to_supervised(diff_values, 1)”</p>
<p>Using lag values up to around 50 (on the airline data) and changing predict() like so:<br/>
<code></code><code><br/>
# forecast the entire training dataset to build up state for forecasting<br/>
train_reshaped = train_scaled[:, 0:look_back].reshape(len(train_scaled), 1, look_back)<br/>
# train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)<br/>
lstm_model.predict(train_reshaped, batch_size=1)<br/>
</code><code></code><br/>
seems to make good predictions with very low RMSE on test.  </p>
<p>Am I possibly breaking the model now so it’s cheating somehow?</p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402602#respond" onclick='return addComment.moveForm( "comment-402602", "402602", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-402679">
<div class="comment-container" id="li-comment-402679">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">June 16, 2017 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402679" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p><code></code><code><br/>
look_back = 60<br/>
epochs = 15</code></p>
<p>Month=1, Predicted=321.813110, Expected=315.000000<br/>
Month=2, Predicted=310.719757, Expected=301.000000<br/>
Month=3, Predicted=363.746643, Expected=356.000000<br/>
...<br/>
Month=46, Predicted=458.424683, Expected=461.000000<br/>
Month=47, Predicted=418.427124, Expected=390.000000<br/>
Month=48, Predicted=412.831085, Expected=432.000000<br/>
Test RMSE: 18.078<br/>
<code></code><br/>
for test harness<br/>
<code></code><code><br/>
yhat = y<br/>
Test RMSE: 0.000<br/>
</code><code></code></p>
<p>It seems there is contamination of training data in the test forecast in the sense that forecast_lstm(model, batch_size, X) is being given X observations, each with 60 historical past observations that overlap into training data.  But so what, right?  That’s history that training saw, and as it moves into the test data it adds history only seen in the test set.  But that’s how real life observations work it seems: You always have all of the past to look at.</p>
<p>Finally, you say, “In this tutorial, we will go with the fixed approach for its simplicity, although, we would expect the dynamic approach to result in better model skill.”  For a small dataset like we have, a large lag seems as if it gives us a semi-dynamic approach in some ways?</p>
<p>Solid model with a seemingly good RMSE?<br/>
Full code: <a href="http://tinyurl.com/y74ypvde" rel="nofollow">http://tinyurl.com/y74ypvde</a><br/>
Prediction v. Actual Plot: <a href="http://tinyurl.com/y9ouajdm" rel="nofollow">http://tinyurl.com/y9ouajdm</a></p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402679#respond" onclick='return addComment.moveForm( "comment-402679", "402679", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-402684">
<div class="comment-container" id="li-comment-402684">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">June 16, 2017 at 7:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402684" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>On the Shampoo dataset:<br/>
look_back = 18  (lag)<br/>
epochs = 30<br/>
Test RMSE: 110.594<br/>
Prediction v. Actual Plot: <a href="http://tinyurl.com/ycoy6aes" rel="nofollow">http://tinyurl.com/ycoy6aes</a></p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402684#respond" onclick='return addComment.moveForm( "comment-402684", "402684", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-402710">
<div class="comment-container" id="li-comment-402710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 8:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Very sharp!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402710#respond" onclick='return addComment.moveForm( "comment-402710", "402710", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-402708">
<div class="comment-container" id="li-comment-402708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 8:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice.</p>
<p>Hmmm, I believe by dynamic I was referring to updating the model with new data.</p>
<p>If you have the resources, I would recommend exploring whether updating the model as new obs come in effects model skill. I expect it will. I have an example here:<br/>
<a href="http://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402708#respond" onclick='return addComment.moveForm( "comment-402708", "402708", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-402618">
<div class="comment-container" id="li-comment-402618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3ec68041892c0b3090eb9dd9e68a5cdb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3ec68041892c0b3090eb9dd9e68a5cdb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pedro</span>
<span class="date">June 15, 2017 at 5:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>You’re doing a great job helping people to learn how to apply machine learning. One week ago, I didn’t know anything about time series, but now I’m able to play a little bit with it. Thanks you!</p>
<p>Regarding this post, I’ve a doubt. When we say</p>
<p>‘To make the experiment fair, the scaling coefficients (min and max) values must be calculated on the training dataset and applied to scale the test dataset and any forecasts. This is to avoid contaminating the experiment with knowledge from the test dataset, which might give the model a small edge.’</p>
<p>shouldn’t we do </p>
<p>scaler = scaler.fit(X[:-12])</p>
<p>instead of</p>
<p>scaler = scaler.fit(X) ?</p>
<p>If we use X we are using data from the test set, no?</p>
<p>Thanks for your attention and keep up with the good work!</p>
<div class="reply">
<a aria-label="Reply to Pedro" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402618#respond" onclick='return addComment.moveForm( "comment-402618", "402618", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-402690">
<div class="comment-container" id="li-comment-402690">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 16, 2017 at 7:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-402690" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct. Ideally, we would use domain knowledge to estimate the expected min/max of values that could ever be observed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=402690#respond" onclick='return addComment.moveForm( "comment-402690", "402690", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403194">
<div class="comment-container" id="li-comment-403194">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">June 20, 2017 at 6:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403194" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>After using the robust code (last one) I got theses results</p>
<p>1) Test RMSE: 180.438<br/>
2) Test RMSE: 110.352<br/>
3) Test RMSE: 119.655<br/>
4) Test RMSE: 170.720<br/>
5) Test RMSE: 211.877<br/>
6) Test RMSE: 101.453<br/>
7) Test RMSE: 105.532<br/>
8) Test RMSE: 149.351<br/>
9) Test RMSE: 88.118<br/>
10) Test RMSE: 138.013<br/>
11) Test RMSE: 265.045<br/>
12) Test RMSE: 135.861<br/>
13) Test RMSE: 167.766  … (rest is omitted, it was taking too long).<br/>
Being a beginner in machine learning and using your tutorial to learn about it could you tell me if theses results are normal (being so different from what you have) while everything before was ok. If theses are not, could you tell my what could be the reason of such difference?</p>
<p>Thank you for your attention and please do continue making tutorial like that, it’s really helpful!</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=403194#respond" onclick='return addComment.moveForm( "comment-403194", "403194", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403261">
<div class="comment-container" id="li-comment-403261">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 21, 2017 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403261" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Eric, see this post to better understand the stochastic nature of neural network algorithms:<br/>
<a href="http://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">http://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<p>See this post for more details on how to develop a robust estimate of model skill:<br/>
<a href="http://machinelearningmastery.com/evaluate-skill-deep-learning-models/" rel="nofollow">http://machinelearningmastery.com/evaluate-skill-deep-learning-models/</a></p>
<p>See this post on how to fix the random number seed:<br/>
<a href="http://machinelearningmastery.com/reproducible-results-neural-networks-keras/" rel="nofollow">http://machinelearningmastery.com/reproducible-results-neural-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=403261#respond" onclick='return addComment.moveForm( "comment-403261", "403261", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-403291">
<div class="comment-container" id="li-comment-403291">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">June 21, 2017 at 1:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403291" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see, thank you very much for the links and solutions!</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=403291#respond" onclick='return addComment.moveForm( "comment-403291", "403291", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-403363">
<div class="comment-container" id="li-comment-403363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 22, 2017 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=403363#respond" onclick='return addComment.moveForm( "comment-403363", "403363", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-403566">
<div class="comment-container" id="li-comment-403566">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">June 23, 2017 at 5:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403566" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>After reading the links what I understood was:<br/>
– It’s pretty hard (impossible) to always get the same result due to a lot of randomness that can come from a lot of thing.<br/>
– Only by repeating the operation a lot (like you did on last example, with 30 example (but doing it like 100 would give a better idea?)) can help you to determine how much result can be different and find a range of “acceptable one”?<br/>
– Seeding the random number generator can help.</p>
<p>So to continue my project I thought about seed the random number generator like you explained. Like here, repeat the process 30 time (since I have a server I can let it do it overnight and go for 100) and determine the average and decide of a range.</p>
<p>Does it seem ok to begin with?<br/>
Am I lacking something?</p>
<p>Thank you for your attention and for the help you provide to everyone.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-403638">
<div class="comment-container" id="li-comment-403638">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 24, 2017 at 8:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-403638" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post on how to estimate the number of repeats:<br/>
<a href="http://machinelearningmastery.com/estimate-number-experiment-repeats-stochastic-machine-learning-algorithms/" rel="nofollow">http://machinelearningmastery.com/estimate-number-experiment-repeats-stochastic-machine-learning-algorithms/</a></p>
<p>I would not recommend fixing the random number seed for experimental work. Your results will misleading.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-404355">
<div class="comment-container" id="li-comment-404355">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b334674fc91705160eb6d88be41ae562?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b334674fc91705160eb6d88be41ae562?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dhineshkumar</span>
<span class="date">June 30, 2017 at 7:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404355" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you so much for the tutorial.</p>
<p>I have few doubts though.</p>
<p>1. I am working on a problem where the autocorrelation plot of the detrended data show me that the value at time t is significantly correlated to around past 100 values in the series. Is it ideal to take the batch size of 100 to model the series?</p>
<p>2. You mentioned that less than 5 memory units is sufficient for this example. Can you please give me some idea on how to choose the number of memory units for a particular problem like the above? On what other factors does this number depend on? </p>
<p>Kindly clarify.<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Dhineshkumar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404355#respond" onclick='return addComment.moveForm( "comment-404355", "404355", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404414">
<div class="comment-container" id="li-comment-404414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 1, 2017 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try passing in 100-200 time steps and see how you go.</p>
<p>Systematically test a suite of different memory units to see what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404414#respond" onclick='return addComment.moveForm( "comment-404414", "404414", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-404441">
<div class="comment-container" id="li-comment-404441">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b334674fc91705160eb6d88be41ae562?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b334674fc91705160eb6d88be41ae562?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dhineshkumar</span>
<span class="date">July 1, 2017 at 2:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404441" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason.</p>
<div class="reply">
<a aria-label="Reply to Dhineshkumar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404441#respond" onclick='return addComment.moveForm( "comment-404441", "404441", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-404501">
<div class="comment-container" id="li-comment-404501">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 2, 2017 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404501" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404501#respond" onclick='return addComment.moveForm( "comment-404501", "404501", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-404692">
<div class="comment-container" id="li-comment-404692">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/45ce7b01a138309f339de67a480ca4ce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/45ce7b01a138309f339de67a480ca4ce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sophie</span>
<span class="date">July 4, 2017 at 3:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404692" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason! Thanks a lot for this tutorial, it really helped.</p>
<p>I used this tutorial as is for predicting the cost of an item which is of the the range of a dollar and few cents. </p>
<p>My dataset has 262 rows, i.e 0 to 261.</p>
<p>When I run the model, the graph captures even the most intricate trends beautifully, BUT there seems to be a lag of 1 time step in the predicted data. </p>
<p>The predicted values of this month almost exactly matches the expected value of the previous month. And this trend is followed throughout.</p>
<p>The indexing is the only thing I’ve changed,<br/>
to</p>
<p>train, test = supervised_values[0:200], supervised_values[200:]<br/>
rmse = sqrt(mean_squared_error(raw_values[200:], predictions))<br/>
pyplot.plot(raw_values[200:])</p>
<p>are the only lines of code I’ve really changed</p>
<div class="reply">
<a aria-label="Reply to Sophie" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404692#respond" onclick='return addComment.moveForm( "comment-404692", "404692", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-404879">
<div class="comment-container" id="li-comment-404879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 6, 2017 at 10:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-404879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider starting with a simpler linear model:<br/>
<a href="http://machinelearningmastery.com/start-here/#timeseries" rel="nofollow">http://machinelearningmastery.com/start-here/#timeseries</a></p>
<p>I do not believe LSTMs are the best or first choice for autoregression models:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=404879#respond" onclick='return addComment.moveForm( "comment-404879", "404879", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-422423">
<div class="comment-container" id="li-comment-422423">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/749e7051b2117c5d61e19b10687a3c9c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/749e7051b2117c5d61e19b10687a3c9c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">vijay</span>
<span class="date">December 7, 2017 at 8:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-422423" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think I’m facing the same issue. Were you able to solve the issue?</p>
<div class="reply">
<a aria-label="Reply to vijay" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=422423#respond" onclick='return addComment.moveForm( "comment-422423", "422423", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-405168">
<div class="comment-container" id="li-comment-405168">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/61f9f7daef721495bd9665f5fdc4cc7c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/61f9f7daef721495bd9665f5fdc4cc7c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Viorel Emilian Teodorescu</span>
<span class="date">July 9, 2017 at 2:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405168" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason </p>
<p>Doesn’t LSTM have a squashing gate at input? With outputs in between (-1, 1)? Then why do we need to prepare the input data to be between (-1, 1) if the first input gate will do this for us? </p>
<p>Am I missing something?</p>
<div class="reply">
<a aria-label="Reply to Viorel Emilian Teodorescu" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405168#respond" onclick='return addComment.moveForm( "comment-405168", "405168", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-405269">
<div class="comment-container" id="li-comment-405269">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 9, 2017 at 10:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405269" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can rescale input to [0,1]</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405269#respond" onclick='return addComment.moveForm( "comment-405269", "405269", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-405177">
<div class="comment-container" id="li-comment-405177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2ab114b86e9463e9ffc3431264b55beb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hans</span>
<span class="date">July 9, 2017 at 2:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Considering  </p>
<p>unseenPredict = lstm_model.predict(X)</p>
<p>…how do we structure X to get a one step forward prediction of unseen data?</p>
<p>Or can we change some offsets in script “Complete LSTM Example” to get the same effect, and if so how?</p>
<div class="reply">
<a aria-label="Reply to Hans" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405177#respond" onclick='return addComment.moveForm( "comment-405177", "405177", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-405406">
<div class="comment-container" id="li-comment-405406">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/07fff31ec995bbf4b7178a31e5bc45a4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/07fff31ec995bbf4b7178a31e5bc45a4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paba</span>
<span class="date">July 10, 2017 at 8:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405406" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for the excellent tutorial. I tried to modify the above code to include multiple timesteps and multiple lags in the model. I run give these parameters as input and paralleling run the script for different configurations to select the most accurate model. What do you think of the modifications I have done to the following functions? I am especially concerned about the time_steps included in the model, is that correct? </p>
<p>def timeseries_to_supervised(data, lag=1, time_steps=0):<br/>
	df = DataFrame(data)<br/>
	columns = [df.shift(i) for i in range(1, lag+1)]<br/>
	#considers the number of time_steps, t, involved and<br/>
	#add next t x columns next to each x columnn<br/>
	#question?? if time_steps = 3, does that mean y should start from y_4 and<br/>
	#we trim the last 3 values from the dataset?<br/>
	if time_steps &gt; 0 :<br/>
		columns_df = concat(columns,axis=1)<br/>
		#note that I have multipled i by -1 to perform left shift rather than right shift<br/>
		timestep_columns = [columns_df.shift(i*-1) for i in range(1, time_steps+1)]<br/>
		timestep_columns_df =concat(timestep_columns, axis=1)<br/>
		columns.append(timestep_columns_df)<br/>
	columns.append(df)<br/>
	df = concat(columns, axis=1)<br/>
	df.fillna(0, inplace=True)<br/>
	return df</p>
<p>def fit_lstm(train, batch_size, nb_epoch, neurons, lag, time_steps):<br/>
	X, y = train[:, 0:-1], train[:, -1]<br/>
	X = X.reshape(X.shape[0], time_steps+1, lag)<br/>
	model = Sequential()<br/>
	model.add(LSTM(neurons, batch_input_shape=(batch_size, X.shape[1] , X.shape[2]), stateful=True, return_sequences=True))<br/>
	model.add(LSTM(neurons, stateful=True))<br/>
	model.add(Dense(1))<br/>
	model.compile(loss=’mean_squared_error’ optimizer=’adam’)<br/>
	model.summary()<br/>
	for i in range(nb_epoch):<br/>
		model.fit(X, y, epochs=1, batch_size=batch_size, verbose=1, shuffle=False)<br/>
		model.reset_states()<br/>
	return model</p>
<p>def forecast_lstm(model, batch_size, X, lag,time_steps):</p>
<p>	X = X.reshape(1,time_steps+1,lag)<br/>
	pad = np.zeros(shape=(batch_size-1, time_steps+1, lag))<br/>
	padded = np.vstack((X, pad))<br/>
	yhat = model.predict(padded, batch_size=batch_size)<br/>
	return yhat[0,0]</p>
<div class="reply">
<a aria-label="Reply to Paba" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405406#respond" onclick='return addComment.moveForm( "comment-405406", "405406", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405481">
<div class="comment-container" id="li-comment-405481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 11, 2017 at 10:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405481#respond" onclick='return addComment.moveForm( "comment-405481", "405481", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-405708">
<div class="comment-container" id="li-comment-405708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">July 13, 2017 at 9:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I want to extend this idea to several features x the lag values for each x time observations.  Does it seem reasonable to give MinMaxScaler that 3D object?  How does the y truth fit in what I give MinMaxScaler, since it’s only 2D?</p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405708#respond" onclick='return addComment.moveForm( "comment-405708", "405708", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405732">
<div class="comment-container" id="li-comment-405732">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 10:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405732" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, I would recommend scaling each series separately.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405732#respond" onclick='return addComment.moveForm( "comment-405732", "405732", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-405740">
<div class="comment-container" id="li-comment-405740">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">July 13, 2017 at 11:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405740" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Above you seem to scale y along with X. But with multiple features, the rest of which are not just a time-shifted copy of y, I assume we could fit y_train by itself before transforming y_train and y_val?  Then that’s actually the only scaler object we need to save for later inversion?</p>
<div class="reply">
<a aria-label="Reply to Kim Miller" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405740#respond" onclick='return addComment.moveForm( "comment-405740", "405740", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-405761">
<div class="comment-container" id="li-comment-405761">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 4:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405761" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend scaling each series before any shifting of the series to make it a supervised learning problem.</p>
<p>I hope that answers your question, please shout if I misunderstood.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405761#respond" onclick='return addComment.moveForm( "comment-405761", "405761", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-405806">
<div class="comment-container" id="li-comment-405806">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3423a20950bd9efcc25a2e7657ff990c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kim Miller</span>
<span class="date">July 14, 2017 at 2:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405806" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think the words “each series separately” threw me.  I assume we can still scale all incoming values (all X’s and the time series that will later become y and shifted, one of the X’s) using a single scaler object. Then we create the lag values from scaled values.  Finally, that single scaler object is used to invert y predictions.  I have that right?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-405849">
<div class="comment-container" id="li-comment-405849">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 14, 2017 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405849" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Each series being a different “feature” or “column” or “time series” or whatever we call it.</p>
<p>The coefficients (min/max or mean/stdev) used in the scaling of each series will need to be kept to reverse the operation on predictions and apply the operation to input data later. You can save the coefficients or the objects that wrap them.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-405755">
<div class="comment-container" id="li-comment-405755">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a9d36ab805de54553e45a8dc909708d5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a9d36ab805de54553e45a8dc909708d5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sasha</span>
<span class="date">July 13, 2017 at 4:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405755" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, great tutorial, thank you!</p>
<p>A question: why do you loop through epochs instead of just setting an appropriate number of epochs within fit() function? Would’t it give the same result and be neater?</p>
<div class="reply">
<a aria-label="Reply to Sasha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405755#respond" onclick='return addComment.moveForm( "comment-405755", "405755", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-405764">
<div class="comment-container" id="li-comment-405764">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 13, 2017 at 5:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405764" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So that I can manually manage the resetting of the internal state of the network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405764#respond" onclick='return addComment.moveForm( "comment-405764", "405764", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-405767">
<div class="comment-container" id="li-comment-405767">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a9d36ab805de54553e45a8dc909708d5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a9d36ab805de54553e45a8dc909708d5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sasha</span>
<span class="date">July 13, 2017 at 5:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405767" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ah, I see, it has to do with “stateful” definition being different in keras, it’s well explained here: <a href="http://philipperemy.github.io/keras-stateful-lstm/" rel="nofollow">http://philipperemy.github.io/keras-stateful-lstm/</a></p>
<div class="reply">
<a aria-label="Reply to Sasha" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405767#respond" onclick='return addComment.moveForm( "comment-405767", "405767", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-405773">
<div class="comment-container" id="li-comment-405773">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a33cc4eda404a85e75841e76c8348302?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a33cc4eda404a85e75841e76c8348302?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kotb</span>
<span class="date">July 13, 2017 at 6:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405773" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, DR jason</p>
<p>thank you very much for this tutorial.</p>
<p>I want to have multiple time steps , but i don’t know how to modify function “timeseries_to_supervised()”.<br/>
I found another post of you talking about this , but you use function “create_dataset()”<br/>
i modify this function as follow:</p>
<p>def create_dataset(dataset, look_back=1):<br/>
	dataset = np.insert(dataset,[0]*look_back,0)<br/>
	dataX, dataY = [], []<br/>
	for i in range(len(dataset)-look_back):<br/>
		a = dataset[i:(i+look_back)]<br/>
		dataX.append(a)<br/>
		dataY.append(dataset[i + look_back])<br/>
	dataY=numpy.array(dataY)<br/>
	dataY = np.reshape(dataY,(dataY.shape[0],1))<br/>
	dataset = np.concatenate((dataX,dataY),axis=1)<br/>
	return dataset</p>
<p>please, check my modification , is it right OR what?</p>
<div class="reply">
<a aria-label="Reply to kotb" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405773#respond" onclick='return addComment.moveForm( "comment-405773", "405773", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-405842">
<div class="comment-container" id="li-comment-405842">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 14, 2017 at 8:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-405842" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=405842#respond" onclick='return addComment.moveForm( "comment-405842", "405842", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-406596">
<div class="comment-container" id="li-comment-406596">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 20, 2017 at 2:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406596" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Sorry if it seem stupid but there is a part that I don’t understand.</p>
<p>To predict you use: “yhat = model.predict(X, batch_size=batch_size)”<br/>
But as we see X is :<br/>
train, test = supervised_values[0:-12], supervised_values[-12:]<br/>
scaler, train_scaled, test_scaled = scale(train, test)<br/>
yhat = forecast_lstm(lstm_model, 1, X)</p>
<p>So X is the 12 value (after being passed in the scale function) that we want to predict. Why are we using them since in normal case we wouldn’t know theirs values.</p>
<p>Once again really thank you for your tutorial, really helped me in my training on machine learning.</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406596#respond" onclick='return addComment.moveForm( "comment-406596", "406596", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-406707">
<div class="comment-container" id="li-comment-406707">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 21, 2017 at 9:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406707" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In the general case, you can pass in whatever you like in order to make a prediction.</p>
<p>For example, if your model was defined by taking 6 days of values and predicting the next day and you want to predict tomorrow, pass in the  values for today and 5 days prior. </p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406707#respond" onclick='return addComment.moveForm( "comment-406707", "406707", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-406723">
<div class="comment-container" id="li-comment-406723">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 21, 2017 at 10:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406723" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think it does help me. In my case I have values for each minute and I have to predict the next week (so more or less 10K of prediction).<br/>
I have data from the last year so there isn’t any problem with my training, just wondered what I should do at the prediction part (so I can just instead of feeding it test_scaled send him my training set again?)<br/>
Thank you for your help and quick reply!</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406723#respond" onclick='return addComment.moveForm( "comment-406723", "406723", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-406821">
<div class="comment-container" id="li-comment-406821">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 22, 2017 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406821" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, if your model is setup to predict given some fixed set of lags, you must provide those lags to predict beyond the end of the dataset. These may be part of your training dataset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406821#respond" onclick='return addComment.moveForm( "comment-406821", "406821", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-407145">
<div class="comment-container" id="li-comment-407145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 24, 2017 at 5:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t think it’s in my training dataset, for this part I’m pretty much doing it like you (the lag appearing when turning a sequence to a supervised learning problem). I’m pretty much feeding my model like you do. The problem for me being to know what to feed it when calling the predict command. Sending it “train_scaled” was a bad idea (got poor result, predicting huge value when it should predict low and predicting low instead of predicting high). I’m working on it but every hint is accepted. Once again thank you and sorry for being a bit slow at learning/understanding.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-407221">
<div class="comment-container" id="li-comment-407221">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 25, 2017 at 9:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407221" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The argument to the predict() function is the same as the argument to the fit() function. </p>
<p>The data must be scaled the same and have the same shape, although the number of samples may vary, e.g. you may have just one sample.</p>
<p>Obviously, you don’t need to make predictions for the training data, so the data passed to predict will be the input required to make the prediction you require. This really depends on the framing of your problem/model.</p>
<p>Does that help?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-407240">
<div class="comment-container" id="li-comment-407240">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 25, 2017 at 12:09 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407240" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank your for your quick reply! I think I’m understanding it better but I have some part I have trouble to understand.</p>
<p>The input is X right?<br/>
If I follow your tutorial on input/output (<a href="http://machinelearningmastery.com/time-series-forecasting-supervised-learning/" rel="nofollow">http://machinelearningmastery.com/time-series-forecasting-supervised-learning/</a>) and I take my case as an example (the database register the value each 3 minute and we want to predict the next value (so to begin for example it would be 12:24:00)):<br/>
Date,congestion<br/>
2016-07-08 12:12:00,92<br/>
2016-07-08 12:15:00,80<br/>
2016-07-08 12:18:00,92<br/>
2016-07-08 12:21:00,86</p>
<p>This is (part of) my training data, when turning it into supervised training data (and shifting) I get:<br/>
X, y<br/>
?, 92<br/>
92, 80<br/>
80, 92<br/>
92, 86<br/>
86, ?</p>
<p>The problem is that I don’t know X for predicting, I only know the X I use for my training (train_scaled) and the one used to compare my results (test_scaled).</p>
<p>What is the input I should feed it? I can’t feed it my test_scaled since in real situation I would have no idea of what it would be.</p>
<p>Sorry if my question seem stupid and thank you for taking time to explain it.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-407312">
<div class="comment-container" id="li-comment-407312">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2017 at 7:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407312" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends how you have framed your model.</p>
<p>If the input (X) is the observation at t-1 to predict t, then you input the last observation to predict the next time step.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-407362">
<div class="comment-container" id="li-comment-407362">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 26, 2017 at 11:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407362" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is, each of my input X is the observation at t-1 (pretty similar to the shampoo case used in the tutorial).</p>
<p>Thank you for your answer, you answered my question, I shouldn’t have any problem now!</p>
<p>Thanks for the tutorial too, they really helped me!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-407388">
<div class="comment-container" id="li-comment-407388">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 26, 2017 at 4:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407388" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear that.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-407411">
<div class="comment-container" id="li-comment-407411">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">July 26, 2017 at 6:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407411" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just to be sure that I didn’t made any mistake in my reasoning, if I take my example from before:<br/>
X, y<br/>
?, 92        / T-3<br/>
92, 80      / T-2<br/>
80, 92      / T-1<br/>
92, 86      / T<br/>
86, ?        / T+1</p>
<p>to predict the next step (T+1) I have to use “yhat = model.predict(X, , batch_size=batch_size)” where X is 86 (after scaling/reshaping). Right?<br/>
Then I’ll get the value predicted for T+1 (that I have to send to invert_scale and difference to get a readable value).<br/>
If I want to predict farther then I continue (sending the scaled/reshaped value predicted at T+1 to get T+2 and then until I predict as far as wanted).</p>
<p>Thanks for your time and answers!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-407479">
<div class="comment-container" id="li-comment-407479">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2017 at 7:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407479" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-408491">
<div class="comment-container" id="li-comment-408491">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 4, 2017 at 12:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408491" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason with your help I managed to predict value of each minute of the next week. I had 2 question though:<br/>
First: I removed the code for testing sets (since I wouldn’t have it in reality), the only thing I have are the testing set in the excel file (the last 10000 lines)<br/>
When using this code (to train):<br/>
            # transform data to be stationary<br/>
            raw_values = data.values<br/>
            diff_values = difference(raw_values, 1)</p>
<p>            # transform data to be supervised learning<br/>
            supervised = timeseries_to_supervised(diff_values, 1)<br/>
            supervised_values = supervised.values</p>
<p>            # split data into train and test-sets<br/>
            train = supervised_values[:-10000]</p>
<p>            # transform the scale of the data<br/>
            scaler, train_scaled = scale(train)</p>
<p>and this one (to predict):<br/>
            # forecast the entire training dataset to build up state for forecasting<br/>
            train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)<br/>
            lstm_model.predict(train_reshaped)</p>
<p>            # walk-forward validation on the test data<br/>
            predictions = list()<br/>
            predictionFeeder = list() #Used to feed the model with the value of T-1<br/>
            X, y = train_scaled[0, 0:-1], train_scaled[0, -1]<br/>
            predictionFeeder.append(X) #Give the last value of training</p>
<p>            for i in range(0, 10000):<br/>
                # make one-step forecast<br/>
                yhat = forecast_lstm2(lstm_model, predictionFeeder[i])<br/>
                predictionFeeder.append(yhat)<br/>
                # invert scaling<br/>
                yhat2 = invert_scale(scaler, testa[i + 1], yhat)<br/>
                yhat3 = inverse_difference(raw_values, yhat2, 10000 + 1 – i)<br/>
                predictions.append(yhat3)<br/>
and train a model (25 epoch) then predict the results I get result that are way too good (RMSE of 2 or less and prediction that have less than 5% of error).<br/>
Being used of thing going wrong for no reasons I decide to remove the testing data from the excel (even though it shouldn’t change anything since I’m not using them (I’ve even set the variable to None at first)). Then when I do that the prediction is way less good and have some lag (though, if you remove the lag you still have a good results, just way less better than before).<br/>
Why is that?<br/>
My 2nd question is about lag, we can see on the prediction that while the shape of both chart (prediction and reality) look alike the prediction is raising/lowering before the reality, do you have any idea to fix it? Do you think changing the lag or timestep would help?</p>
<p>Once again thank you for your help, I don’t think I would have achieved this much without your tutorials.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-408507">
<div class="comment-container" id="li-comment-408507">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 4, 2017 at 3:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408507" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot debug your code for you.</p>
<p>Perhaps you are accidentally fitting the model on the training and test data then evaluating it on the test (e.g. on data it has seen before).</p>
<p>I would encourage you to evaluate different lag values to see what works best for your problem.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-408514">
<div class="comment-container" id="li-comment-408514">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 4, 2017 at 4:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408514" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Don’t worry, I wouldn’t ask you to debug.</p>
<p>Maybe, I don’t know, I did remove the variable to be sure to never have affected the testing set and using it but since I’m human I may have made errors.</p>
<p>So changing lag would help me for theses gap between reality and prediction raise. Thank you I’ll do that.</p>
<p>Thanks for your answer!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-406759">
<div class="comment-container" id="li-comment-406759">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Josep</span>
<span class="date">July 21, 2017 at 8:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406759" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can I buy your books physically(not Ebook)?Thanks</p>
<div class="reply">
<a aria-label="Reply to Josep" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406759#respond" onclick='return addComment.moveForm( "comment-406759", "406759", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-406760">
<div class="comment-container" id="li-comment-406760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4fcb6fed918ad33ff8ddda1c6165874e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Josep</span>
<span class="date">July 21, 2017 at 8:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, now I have read that is not possible. Thanks anyway. Your explanations and tutorials are amazing. Congratulations!</p>
<div class="reply">
<a aria-label="Reply to Josep" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406760#respond" onclick='return addComment.moveForm( "comment-406760", "406760", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-406829">
<div class="comment-container" id="li-comment-406829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 22, 2017 at 8:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-406829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Josep.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=406829#respond" onclick='return addComment.moveForm( "comment-406829", "406829", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-407417">
<div class="comment-container" id="li-comment-407417">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aee8173c104ff45c32d8536373d36caa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aee8173c104ff45c32d8536373d36caa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pawel</span>
<span class="date">July 26, 2017 at 7:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407417" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
Thanks for very good tutorial. I have one question/doubt. </p>
<p>in the following part of the code:</p>
<p># invert differencing<br/>
	yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)</p>
<p>should not we relay on predicted value instead of already known raw_values? In your example for validation we always refer to the test value(known) while calling inverse difference. But in reality we will have only the predicted values(used as X), and of course known starting point(t=0). Or I missed something?</p>
<p>my proposal:<br/>
# invert differencing – (starting from 2nd loop cycle (1st woul be the starting point (raw_values[-1]) )</p>
<p>yhat = inverse_difference(predictions, yhat, 1)</p>
<p>Thanks in advance<br/>
Pawel</p>
<div class="reply">
<a aria-label="Reply to Pawel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407417#respond" onclick='return addComment.moveForm( "comment-407417", "407417", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407481">
<div class="comment-container" id="li-comment-407481">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 27, 2017 at 8:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407481" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We could, but in this case the known observations are available and not in the future and it is reasonable to use them for the rescaling (inverting).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407481#respond" onclick='return addComment.moveForm( "comment-407481", "407481", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-407532">
<div class="comment-container" id="li-comment-407532">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aee8173c104ff45c32d8536373d36caa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aee8173c104ff45c32d8536373d36caa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pawel</span>
<span class="date">July 27, 2017 at 5:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407532" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Thanks for explanation, got it now. Cause I train the model used e.g. MAY data (15 seconds samples) and then used that model to predict whole JUNE data. Afterwards I compared predicted data VS data that I got from JUNE, and I have to say that model does not work, after few prediction there is huge “off sync”, </p>
<p>In the validation phase as described in your case I got RMSE 0.11 so not bad, but in reality when you use predicted value(t-1) to predict next (t) value there is a problem.</p>
<p>Do you know how to improve the model? should I use multiple step forecats, or lag features, input time steps?</p>
<p>Thanks a lot.<br/>
Pawel</p>
<div class="reply">
<a aria-label="Reply to Pawel" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407532#respond" onclick='return addComment.moveForm( "comment-407532", "407532", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-407614">
<div class="comment-container" id="li-comment-407614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2017 at 8:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend braining storming, then try everything you can think of.</p>
<p>I have a good list here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<p>Also, compare results to well-tuned MLPs with a window.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407614#respond" onclick='return addComment.moveForm( "comment-407614", "407614", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-407542">
<div class="comment-container" id="li-comment-407542">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8bf688ba7ac4371539003fc279f383db?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8bf688ba7ac4371539003fc279f383db?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Surya</span>
<span class="date">July 27, 2017 at 6:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407542" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason, I am not following one point in your post. You wanted to train a state-full LSTM but reset_states() is executed after every epoch. That means, the states from previous batch are not used in the current batch. How does it make the network state-full?</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Surya" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407542#respond" onclick='return addComment.moveForm( "comment-407542", "407542", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-407617">
<div class="comment-container" id="li-comment-407617">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">July 28, 2017 at 8:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-407617" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>State is maintained between the samples within one epoch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=407617#respond" onclick='return addComment.moveForm( "comment-407617", "407617", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-408168">
<div class="comment-container" id="li-comment-408168">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6509b79ca243d502a1b47fd70be8739f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6509b79ca243d502a1b47fd70be8739f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Niklas</span>
<span class="date">August 2, 2017 at 12:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408168" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>thanks for the great tutorial. I have one question. Wouldn’t it be better to use a callback for resetting the states? This would enable you to also use for example an EarlyStopping Monitor while training, here is what I changed:<br/>
class resetStates(Callback):<br/>
    def on_epoch_end(self, epoch, logs=None):<br/>
        self.model.reset_states()</p>
<p>model.fit(X, y, epochs=nb_epoch, batch_size=batch_size, verbose=1, shuffle=False, callbacks=[resetStates(),EarlyStopping(monitor=’loss’, patience=5, verbose=1, mode=’min’)])</p>
<div class="reply">
<a aria-label="Reply to Niklas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408168#respond" onclick='return addComment.moveForm( "comment-408168", "408168", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408224">
<div class="comment-container" id="li-comment-408224">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 2, 2017 at 7:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408224" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, that is a cleaner implementation for those problems that need to reset state at the end of each epoch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408224#respond" onclick='return addComment.moveForm( "comment-408224", "408224", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-408668">
<div class="comment-container" id="li-comment-408668">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d5f54ea67c5cceb9c8666ec3dffe5dc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d5f54ea67c5cceb9c8666ec3dffe5dc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bharath</span>
<span class="date">August 6, 2017 at 2:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408668" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, can we extend this for anomaly detection techniques ?</p>
<div class="reply">
<a aria-label="Reply to Bharath" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408668#respond" onclick='return addComment.moveForm( "comment-408668", "408668", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408695">
<div class="comment-container" id="li-comment-408695">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 6, 2017 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408695" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps, I have not used LSTMs for anomaly detection, I cannot give you good advice.</p>
<p>Perhaps you would frame it as sequence classification?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408695#respond" onclick='return addComment.moveForm( "comment-408695", "408695", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-408822">
<div class="comment-container" id="li-comment-408822">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Ruiz</span>
<span class="date">August 7, 2017 at 1:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408822" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In the persistence model plot there is a one time interval lag.  When making single step predictions, is it possible to overcome this issue?  What is causing this to happen?  It seems like the model places a huge weight on time interval x[t-1].<br/>
Here is an example of the dataset I am analyzing:</p>
<p>iteration:  969<br/>
Month=970, Predicted=-7.344685, Expected=280.000000<br/>
iteration:  970<br/>
Month=971, Predicted=73.259611, Expected=212.000000<br/>
iteration:  971<br/>
Month=972, Predicted=137.053028, Expected=0.000000</p>
<p>Expected should be 280 and 212 (high magnitudes), and the model captures this more or less with 73 and 137, but this is one time interval behind.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Daniel Ruiz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408822#respond" onclick='return addComment.moveForm( "comment-408822", "408822", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-408894">
<div class="comment-container" id="li-comment-408894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 7:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs are not great at autoregression problems and often converge to a persistence type model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408894#respond" onclick='return addComment.moveForm( "comment-408894", "408894", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-408921">
<div class="comment-container" id="li-comment-408921">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c464355f823136dce154ef525478a0a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Daniel Ruiz</span>
<span class="date">August 8, 2017 at 8:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408921" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ok thanks.  What model would be a good alternative to capture this issue?  I ran into the same problem with ARIMA.  It could just be a difficult dataset to predict.</p>
<div class="reply">
<a aria-label="Reply to Daniel Ruiz" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408921#respond" onclick='return addComment.moveForm( "comment-408921", "408921", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-408952">
<div class="comment-container" id="li-comment-408952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 8, 2017 at 5:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-408952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend starting with a well-tuned MLP + Window and see if anything can do better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=408952#respond" onclick='return addComment.moveForm( "comment-408952", "408952", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409066">
<div class="comment-container" id="li-comment-409066">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 9, 2017 at 11:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409066" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks to you I managed to get a working LSTM network who seem to have a good accuracy (and so a low RMSE)</p>
<p>But I’ve got a problem, do you know what could be the cause of extreme delay between reality values and predictions (my predictions have the same shape as the reality but increase/decrease way before reality)? </p>
<p>Best regards and please continue what you are doing, it’s really useful.</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409066#respond" onclick='return addComment.moveForm( "comment-409066", "409066", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409140">
<div class="comment-container" id="li-comment-409140">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2017 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409140" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Eric, it might be a bug in the way you are evaluating the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409140#respond" onclick='return addComment.moveForm( "comment-409140", "409140", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-409173">
<div class="comment-container" id="li-comment-409173">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 10, 2017 at 10:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409173" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It might be the case, I had to make some changes to the prediction system to use the last predicted value, I may have missed something at this moment. (Also I have to use Tflearn instead of Tensorflow but it shouldn’t be a problem since Tflearn is a more transparent way to use tensorflow).</p>
<p>Thank you for your answer!</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409173#respond" onclick='return addComment.moveForm( "comment-409173", "409173", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-409212">
<div class="comment-container" id="li-comment-409212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2017 at 4:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hang in there Eric!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409212#respond" onclick='return addComment.moveForm( "comment-409212", "409212", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-409219">
<div class="comment-container" id="li-comment-409219">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 10, 2017 at 5:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409219" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you!</p>
<p>Well.. I have a gap of 151 (reference to pokemon?).</p>
<p>Just to try I removed theses 151 values from my training set, I now have no gap of values (and frankly, the accuracy seem good for a 15 epoch training). I know that this is no way a fix but make me wonder where did I fail..</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-409232">
<div class="comment-container" id="li-comment-409232">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 10, 2017 at 7:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409232" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could it be that while my training set is on 400K of value my prediction start 151 value before the end (so predicting the value for 399849) of the training set (which is strange since the information from training tell me that I’m training on the 400K of data).<br/>
It would mean that my machine is trying to predict some point of time used for training.<br/>
Or it would mean that the 151 last data weren’t used at all for training (I tried to reduce the number of data but it’s the same problem).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-409271">
<div class="comment-container" id="li-comment-409271">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 11, 2017 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409271" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The algorithm is trained sample by sample, batch by batch, epoch by epoch. The last sample is what is key.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-409290">
<div class="comment-container" id="li-comment-409290">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 11, 2017 at 12:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409290" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the reply.<br/>
When I think about it my prediction is in advance compared to the reality.<br/>
So my model start his prediction not where I finished my training but after (which is strange since my training end where my testing begin and that each input are a value (and each line correspond to a minute like the the line of shampoo data sets correspond to month)).<br/>
I must have made a mistake somewhere.<br/>
Thanks for you answer I think I’m on something!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-409359">
<div class="comment-container" id="li-comment-409359">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 12, 2017 at 6:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409359" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hang in there!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-409070">
<div class="comment-container" id="li-comment-409070">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stone</span>
<span class="date">August 9, 2017 at 12:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409070" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One thing I don’t understand in these models is, how can I predict future. </p>
<p>Say, I have trained my model and let’s say we’re living August 8, 2017. Now model.predict() seems to require some test samples to predict anything, in this case values from test_scaled. So what do I give it when I want to get a prediction for August 9, 2017, which we don’t know yet? So I want to know yhat(t+1). Can I ask the model to give me forecasts for the next 5 days?</p>
<div class="reply">
<a aria-label="Reply to Stone" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409070#respond" onclick='return addComment.moveForm( "comment-409070", "409070", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-409078">
<div class="comment-container" id="li-comment-409078">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">August 9, 2017 at 2:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409078" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I may be wrong but in my case I trained my model on the data I had (let’s say one year, until August 8, 2017) and to predict the value T you send the value T-1 (so in this case the value of August 8 2017), you’ll get the value of August 9.<br/>
Then if you want August 10 (T+1) you send the value of August 9 (T). But this code here show a one step forecast implementation. Maybe if you want to predict more you should look for multi step forecasting? I’m think there is some example of it on this website.</p>
<p>Jason would give you a better answer I think.</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409078#respond" onclick='return addComment.moveForm( "comment-409078", "409078", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-409147">
<div class="comment-container" id="li-comment-409147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2017 at 6:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice one Eric!</p>
<p>Yes, I’ll add, if the model was trained to predict one day from the prior day as input, then when finalized, the model will need the observation from the prior day in order to predict the next day. </p>
<p>It all comes down to how you frame the prediction problem that determines what the inputs you need.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409147#respond" onclick='return addComment.moveForm( "comment-409147", "409147", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409143">
<div class="comment-container" id="li-comment-409143">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2017 at 6:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409143" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If you would like to predict one day, the model needs to be trained to predict one day. </p>
<p>You have to decide what the model will take as input in order to make that prediction, e.g. the last month or year of data. This is how the model is trained.</p>
<p>Then, when it’s trained, you can use it to predict future values using perhaps the last few values from the training data. You can use a model trained to predict one day to predict may days in a recursive manner where predictions become inputs for subsequent predictions. More about that here:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>You can also make multi-step forecasts directly, here is an example:<br/>
<a href="http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<p>Does that make things clearer?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409143#respond" onclick='return addComment.moveForm( "comment-409143", "409143", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-409175">
<div class="comment-container" id="li-comment-409175">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stone</span>
<span class="date">August 10, 2017 at 11:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409175" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Eric and Jason. That’s exactly how I’ve done it, but it seems to me, that the prediction that I get is not one timestep forward (T+1), but it’s a prediction of T, which doesn’t make sense. I’m using close price of a stock as my data. I’ll have to check again, if it’s really is making a prediction for the future, as you insist. and I will check the Jason’s links. </p>
<p>Anyways, thanks Jason for the excellent tutorials! 🙂</p>
<div class="reply">
<a aria-label="Reply to Stone" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409175#respond" onclick='return addComment.moveForm( "comment-409175", "409175", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-409180">
<div class="comment-container" id="li-comment-409180">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a05550103b834eca1e15b9365f36b136?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stone</span>
<span class="date">August 10, 2017 at 12:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409180" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here’s a sample of the close prices:<br/>
2017-05-30    5.660<br/>
2017-05-31    5.645<br/>
2017-06-01    5.795<br/>
2017-06-02    5.830</p>
<p>As a matter of fact, it seems to me that the predicted values lags one time step behind from expected ones.</p>
<p>Day=1, Predicted=5.705567, Expected=5.660000<br/>
Day=1, Predicted=5.671651, Expected=5.645000<br/>
Day=1, Predicted=5.657278, Expected=5.795000<br/>
Day=1, Predicted=5.805318, Expected=5.830000</p>
<p>Here I’m going forwarding one day at a time and as you see the predicted ones are closer to what was expected one day before than. And anyway, </p>
<p>Let’s examine the second line:<br/>
Day=1, Predicted=5.671651, Expected=5.645000</p>
<p>The expected price (which is the actual price on 2017-05-31) is what I give the model on 2017-05-31 after the trading day is closed. What I expect the model to predict is closer to 5.79 than 5.67 (which is closer to the actual price the day before!). See the problem? Have I missed something? I haven’t changed anything in the framework except the data.</p>
<div class="reply">
<a aria-label="Reply to Stone" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409180#respond" onclick='return addComment.moveForm( "comment-409180", "409180", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409213">
<div class="comment-container" id="li-comment-409213">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 10, 2017 at 4:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409213" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is a persistence model and the algorithm will converge to that (e.g. predict the input as the output) if it cannot do better. </p>
<p>Perhaps explore tuning the algorithm.</p>
<p>Also, I believe security prices are a random walk and persistence is the best we can do anyway:<br/>
<a href="http://machinelearningmastery.com/gentle-introduction-random-walk-times-series-forecasting-python/" rel="nofollow">http://machinelearningmastery.com/gentle-introduction-random-walk-times-series-forecasting-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409213#respond" onclick='return addComment.moveForm( "comment-409213", "409213", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409395">
<div class="comment-container" id="li-comment-409395">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcb26192097a40faf441ffb05c0470cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://amfirnas.me" rel="external nofollow">Firnas</a></span>
<span class="date">August 12, 2017 at 1:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409395" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Please do some tutorials RNN, NN with more categorical values in the dataset? please, I could not find many resources using the categorical values. </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Firnas" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409395#respond" onclick='return addComment.moveForm( "comment-409395", "409395", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409462">
<div class="comment-container" id="li-comment-409462">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 13, 2017 at 9:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409462" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a few tutorials on the blog – for example, text data input or output are categorical variables.</p>
<p>What are you looking for exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409462#respond" onclick='return addComment.moveForm( "comment-409462", "409462", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409823">
<div class="comment-container" id="li-comment-409823">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandini</span>
<span class="date">August 16, 2017 at 5:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409823" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>is it possible to write the code RNN Regression ,what is the activation function i need to give for regression RNN,how it is difference  from classification to regression?</p>
<div class="reply">
<a aria-label="Reply to nandini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409823#respond" onclick='return addComment.moveForm( "comment-409823", "409823", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409891">
<div class="comment-container" id="li-comment-409891">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409891" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes. The output would be ‘linear’ for regression.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409891#respond" onclick='return addComment.moveForm( "comment-409891", "409891", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409866">
<div class="comment-container" id="li-comment-409866">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/65980e0bdf6e107621b009342524aa3b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/65980e0bdf6e107621b009342524aa3b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maria Jimenez</span>
<span class="date">August 17, 2017 at 1:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409866" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr. Brownlee, </p>
<p>I am trying to understand this code. I am a beginner working with time-series and LSTM.</p>
<p>My questions about your code:</p>
<p>1. What does “transform data to be stationary” mean?<br/>
2. Why do you create diff? What does it mean?<br/>
3. If the raw_values are 36 data, why diff has only 35?</p>
<p>I appreciate your response in advance,</p>
<p>Maria</p>
<div class="reply">
<a aria-label="Reply to Maria Jimenez" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409866#respond" onclick='return addComment.moveForm( "comment-409866", "409866", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-409867">
<div class="comment-container" id="li-comment-409867">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/65980e0bdf6e107621b009342524aa3b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/65980e0bdf6e107621b009342524aa3b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maria Jimenez</span>
<span class="date">August 17, 2017 at 1:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409867" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Never mind, I already understand. 🙂</p>
<div class="reply">
<a aria-label="Reply to Maria Jimenez" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409867#respond" onclick='return addComment.moveForm( "comment-409867", "409867", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-409905">
<div class="comment-container" id="li-comment-409905">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409905" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409905#respond" onclick='return addComment.moveForm( "comment-409905", "409905", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409904">
<div class="comment-container" id="li-comment-409904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-409904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Consider using the blog search.</p>
<p>More about stationary data here:<br/>
<a href="http://machinelearningmastery.com/time-series-data-stationary-python/" rel="nofollow">http://machinelearningmastery.com/time-series-data-stationary-python/</a></p>
<p>More about differencing here:<br/>
<a href="http://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/" rel="nofollow">http://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/</a></p>
<p>I hope that helps.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=409904#respond" onclick='return addComment.moveForm( "comment-409904", "409904", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410002">
<div class="comment-container" id="li-comment-410002">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7df87dec547d19d8f4ab52986d0bc47?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7df87dec547d19d8f4ab52986d0bc47?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sourabh</span>
<span class="date">August 18, 2017 at 4:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410002" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, for the awesome blogs,<br/>
But, I have a doubt, for time series forecasting, classical methods like autoregression and ARIMA, or this machine learning approach using LSTM RNN model, which is the better approach?  Both are good on their own, So, what should be our first choice while forecasting any dataset? How should we choose between them?</p>
<div class="reply">
<a aria-label="Reply to Sourabh" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410002#respond" onclick='return addComment.moveForm( "comment-410002", "410002", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410025">
<div class="comment-container" id="li-comment-410025">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410025" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on your problem. Try a few methods and see what works best.</p>
<p>I recommend starting with linear methods like ARIMA, then try some ML methods like trees and such, then an MLP, then perhaps an RNN.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410025#respond" onclick='return addComment.moveForm( "comment-410025", "410025", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410271">
<div class="comment-container" id="li-comment-410271">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/56e69bc71757f9ac4ee06c54838f3880?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/56e69bc71757f9ac4ee06c54838f3880?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bilal</span>
<span class="date">August 19, 2017 at 10:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410271" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I changed train/test ration to 0.8/0.2 in LSTM code, it took half an hour to predict, and with another data that contains around 4000 records, it’s taking hours(i still couldn’t get result, i don’t know how long it’ll take). Can you please suggest me how I change settings for very long sequences. Thanks</p>
<div class="reply">
<a aria-label="Reply to Bilal" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410271#respond" onclick='return addComment.moveForm( "comment-410271", "410271", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410302">
<div class="comment-container" id="li-comment-410302">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2017 at 6:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410302" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some ideas here:<br/>
<a href="http://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/" rel="nofollow">http://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410302#respond" onclick='return addComment.moveForm( "comment-410302", "410302", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410473">
<div class="comment-container" id="li-comment-410473">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4af96cf6b557ceb736fc0d0e06ef01a1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4af96cf6b557ceb736fc0d0e06ef01a1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun</span>
<span class="date">August 22, 2017 at 1:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410473" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, for long sequence like 4000 records, can you please help me to understand the changes from code point of view as per your current example, the above link is for classification and i am looking for sequence prediction problem.</p>
<div class="reply">
<a aria-label="Reply to Arun" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410473#respond" onclick='return addComment.moveForm( "comment-410473", "410473", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-410512">
<div class="comment-container" id="li-comment-410512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 22, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You must split your sequence into subsequences, for example, see this post for ideas:<br/>
<a href="https://machinelearningmastery.com/truncated-backpropagation-through-time-in-keras/" rel="nofollow">https://machinelearningmastery.com/truncated-backpropagation-through-time-in-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410512#respond" onclick='return addComment.moveForm( "comment-410512", "410512", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-410614">
<div class="comment-container" id="li-comment-410614">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e40179433103201c642bdd7daabbe1f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun Menon</span>
<span class="date">August 23, 2017 at 12:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410614" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason, can you please help us to understand with a complete code example ? The above link just have an idea but not a code implementation, I want to understand from code point of view.</p>
<p>Regards,<br/>
Arun</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410416">
<div class="comment-container" id="li-comment-410416">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hirohi</span>
<span class="date">August 21, 2017 at 12:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410416" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is the evaluation method in this post really “walk-forward”? I’ve read your post about time-series backtest. Walk-forward corresponds to cross validation for not time series data. In both, we make many models to learn, so these methods are not suitable for deep learning, including LSTM, the theme of this post.</p>
<div class="reply">
<a aria-label="Reply to hirohi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410416#respond" onclick='return addComment.moveForm( "comment-410416", "410416", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410428">
<div class="comment-container" id="li-comment-410428">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 21, 2017 at 4:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410428" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, we are using walk-forward validation here.</p>
<p>Walk-forward validation is required for sequence prediction like time series forecasting.</p>
<p>See this post for more about the method and when to use it:<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410428#respond" onclick='return addComment.moveForm( "comment-410428", "410428", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410537">
<div class="comment-container" id="li-comment-410537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hirohi</span>
<span class="date">August 22, 2017 at 11:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your reply. Sorry, that’s not what I mean it. I’ve read the post you pasted above, in which you split data into train/test 2820 times and build 2820 models. But, in this LSTM post, you split data and build a LSTM network only once, so I suggest the test in this article is not walk forward. ordered(not shuffle) hold-out test?</p>
<div class="reply">
<a aria-label="Reply to hirohi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410537#respond" onclick='return addComment.moveForm( "comment-410537", "410537", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-410540">
<div class="comment-container" id="li-comment-410540">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hirohi</span>
<span class="date">August 22, 2017 at 11:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410540" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sorry, please delete this comment</p>
<div class="reply">
<a aria-label="Reply to hirohi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410540#respond" onclick='return addComment.moveForm( "comment-410540", "410540", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410639">
<div class="comment-container" id="li-comment-410639">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410639" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Above, the model is evaluated 30 times.</p>
<p>Within the evaluation of one model, we use walk forward validation and samples are not shuffled.</p>
<p>I recommend re-reading the tutorial and code above.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410639#respond" onclick='return addComment.moveForm( "comment-410639", "410639", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410692">
<div class="comment-container" id="li-comment-410692">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/06823b5a053f14474b3b0635dfd8ac32?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hirohi</span>
<span class="date">August 23, 2017 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410692" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your reply! Oh, repeat=30! Sorry, I misunderstood. But I think in the back-test article, the size of train data changes, while in this LSTM article, the size of train data is fixed, right? Sorry for so many questions.</p>
<div class="reply">
<a aria-label="Reply to hirohi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410692#respond" onclick='return addComment.moveForm( "comment-410692", "410692", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410752">
<div class="comment-container" id="li-comment-410752">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c3f40a82f1add08590fc17b283d66aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c3f40a82f1add08590fc17b283d66aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gauthier</span>
<span class="date">August 23, 2017 at 10:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410752" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for your work, it is seriously awesome.</p>
<p>I wanted to see the chart comparing training loss vs validation loss per epoch, see the chart here: <a href="https://ibb.co/kqcnBk" rel="nofollow">https://ibb.co/kqcnBk</a>. As you mentioned in your other post:</p>
<p>“From the plot of loss, we can see that the model has comparable performance on both train and validation datasets (labeled test). If these parallel plots start to depart consistently, it might be a sign to stop training at an earlier epoch.”</p>
<p>However, in this case, the test loss never really gets lower and both lines are not parallel at all. for this problem, and in general, does that mean that no meaningful test-set pattern is learned from the training, as seems to be corroborated by the RMSE being close on average to the persistent/dummy method?</p>
<p>Is this the end of the road? Have NN’s failed in their tasks? If not, where to go next? </p>
<p>The main thing I changed in the code was the end of the fit_lstm function:<br/>
for i in range(nb_epoch):<br/>
        e=model.fit(X, y, epochs=10, batch_size=batch_size, verbose=0,validation_split=0.33,                    shuffle=False)<br/>
        model.reset_states()<br/>
    return model, e</p>
<div class="reply">
<a aria-label="Reply to Gauthier" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410752#respond" onclick='return addComment.moveForm( "comment-410752", "410752", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410812">
<div class="comment-container" id="li-comment-410812">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410812" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Gauthier.</p>
<p>It may mean that the model under provisioned for the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410812#respond" onclick='return addComment.moveForm( "comment-410812", "410812", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-410904">
<div class="comment-container" id="li-comment-410904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c3f40a82f1add08590fc17b283d66aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c3f40a82f1add08590fc17b283d66aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gauthier</span>
<span class="date">August 24, 2017 at 6:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>OK… So in this case would you suggest to include more neurons for example, or try another ML algorithm?</p>
<div class="reply">
<a aria-label="Reply to Gauthier" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410904#respond" onclick='return addComment.moveForm( "comment-410904", "410904", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-410987">
<div class="comment-container" id="li-comment-410987">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 25, 2017 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-410987" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Both would be a safe bet.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=410987#respond" onclick='return addComment.moveForm( "comment-410987", "410987", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-411463">
<div class="comment-container" id="li-comment-411463">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4fe1b628d85732247260ec94b8e0c21?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4fe1b628d85732247260ec94b8e0c21?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Muni</span>
<span class="date">August 28, 2017 at 12:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-411463" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Json,</p>
<p>Thanks for your blogs and tutorials. Being a research scholar, when I was in dilemma how to learn ML, your tutorials gave me an excellent start to carry out my work in Machine Learning and Deep Learning. </p>
<p>I tried to work with the example in this page, But, I couldnt download the shampoo_sales dataset from datamarket.com. Could you please put the link to the datasets in the blog? If any procedure to download, please let me know.</p>
<div class="reply">
<a aria-label="Reply to Muni" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=411463#respond" onclick='return addComment.moveForm( "comment-411463", "411463", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-411604">
<div class="comment-container" id="li-comment-411604">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2017 at 5:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-411604" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’m glad to hear that.</p>
<p>Here is the full dataset:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6591c7e40db297184609" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
"Month","Sales"
"1-01",266.0
"1-02",145.9
"1-03",183.1
"1-04",119.3
"1-05",180.3
"1-06",168.5
"1-07",231.8
"1-08",224.5
"1-09",192.8
"1-10",122.9
"1-11",336.5
"1-12",185.9
"2-01",194.3
"2-02",149.5
"2-03",210.1
"2-04",273.3
"2-05",191.4
"2-06",287.0
"2-07",226.0
"2-08",303.6
"2-09",289.9
"2-10",421.6
"2-11",264.5
"2-12",342.3
"3-01",339.7
"3-02",440.4
"3-03",315.9
"3-04",439.3
"3-05",401.3
"3-06",437.4
"3-07",575.5
"3-08",407.6
"3-09",682.0
"3-10",475.3
"3-11",581.3
"3-12",646.9</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-2">2</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-4">4</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-6">6</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-8">8</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-10">10</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-12">12</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-14">14</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-16">16</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-18">18</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-20">20</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-22">22</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-24">24</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-26">26</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-28">28</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-30">30</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-32">32</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-34">34</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6591c7e40db297184609-36">36</div><div class="crayon-num" data-line="crayon-5a6591c7e40db297184609-37">37</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6591c7e40db297184609-1"><span class="crayon-s">"Month"</span><span class="crayon-sy">,</span><span class="crayon-s">"Sales"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-2"><span class="crayon-s">"1-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">266.0</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-3"><span class="crayon-s">"1-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">145.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-4"><span class="crayon-s">"1-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">183.1</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-5"><span class="crayon-s">"1-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">119.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-6"><span class="crayon-s">"1-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">180.3</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-7"><span class="crayon-s">"1-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">168.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-8"><span class="crayon-s">"1-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">231.8</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-9"><span class="crayon-s">"1-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">224.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-10"><span class="crayon-s">"1-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">192.8</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-11"><span class="crayon-s">"1-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">122.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-12"><span class="crayon-s">"1-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">336.5</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-13"><span class="crayon-s">"1-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">185.9</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-14"><span class="crayon-s">"2-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">194.3</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-15"><span class="crayon-s">"2-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">149.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-16"><span class="crayon-s">"2-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">210.1</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-17"><span class="crayon-s">"2-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">273.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-18"><span class="crayon-s">"2-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">191.4</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-19"><span class="crayon-s">"2-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">287.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-20"><span class="crayon-s">"2-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">226.0</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-21"><span class="crayon-s">"2-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">303.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-22"><span class="crayon-s">"2-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">289.9</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-23"><span class="crayon-s">"2-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">421.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-24"><span class="crayon-s">"2-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">264.5</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-25"><span class="crayon-s">"2-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">342.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-26"><span class="crayon-s">"3-01"</span><span class="crayon-sy">,</span><span class="crayon-cn">339.7</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-27"><span class="crayon-s">"3-02"</span><span class="crayon-sy">,</span><span class="crayon-cn">440.4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-28"><span class="crayon-s">"3-03"</span><span class="crayon-sy">,</span><span class="crayon-cn">315.9</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-29"><span class="crayon-s">"3-04"</span><span class="crayon-sy">,</span><span class="crayon-cn">439.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-30"><span class="crayon-s">"3-05"</span><span class="crayon-sy">,</span><span class="crayon-cn">401.3</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-31"><span class="crayon-s">"3-06"</span><span class="crayon-sy">,</span><span class="crayon-cn">437.4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-32"><span class="crayon-s">"3-07"</span><span class="crayon-sy">,</span><span class="crayon-cn">575.5</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-33"><span class="crayon-s">"3-08"</span><span class="crayon-sy">,</span><span class="crayon-cn">407.6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-34"><span class="crayon-s">"3-09"</span><span class="crayon-sy">,</span><span class="crayon-cn">682.0</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-35"><span class="crayon-s">"3-10"</span><span class="crayon-sy">,</span><span class="crayon-cn">475.3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6591c7e40db297184609-36"><span class="crayon-s">"3-11"</span><span class="crayon-sy">,</span><span class="crayon-cn">581.3</span></div><div class="crayon-line" id="crayon-5a6591c7e40db297184609-37"><span class="crayon-s">"3-12"</span><span class="crayon-sy">,</span><span class="crayon-cn">646.9</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=411604#respond" onclick='return addComment.moveForm( "comment-411604", "411604", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-412391">
<div class="comment-container" id="li-comment-412391">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9c65f1afa9cc40f4a08f769bd5bb5f85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9c65f1afa9cc40f4a08f769bd5bb5f85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mikiwate</span>
<span class="date">September 3, 2017 at 3:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412391" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am getting NAN on the 12 month:::</p>
<p>Month=1, Predicted=440.400000, Expected=440.400000<br/>
Month=2, Predicted=315.900000, Expected=315.900000<br/>
Month=3, Predicted=439.300000, Expected=439.300000<br/>
Month=4, Predicted=401.300000, Expected=401.300000<br/>
Month=5, Predicted=437.400000, Expected=437.400000<br/>
Month=6, Predicted=575.500000, Expected=575.500000<br/>
Month=7, Predicted=407.600000, Expected=407.600000<br/>
Month=8, Predicted=682.000000, Expected=682.000000<br/>
Month=9, Predicted=475.300000, Expected=475.300000<br/>
Month=10, Predicted=581.300000, Expected=581.300000<br/>
Month=11, Predicted=646.900000, Expected=646.900000<br/>
Month=12, Predicted=646.900000, Expected=nan</p>
<p>from the code below:</p>
<p>predictions = list()<br/>
for i in range(len(test_scaled)):<br/>
	# make one-step forecast<br/>
	X, y = test_scaled[i, 0:-1], test_scaled[i, -1]<br/>
	#yhat = forecast_lstm(lstm_model, 1, X)<br/>
	yhat=y<br/>
    # invert scaling<br/>
	yhat = invert_scale(scaler, X, yhat)<br/>
	# invert differencing<br/>
	yhat = inverse_difference(raw_values, yhat, len(test_scaled)+1-i)<br/>
	# store forecast<br/>
	predictions.append(yhat)<br/>
	expected = raw_values[len(train) + i + 1]<br/>
	print(‘Month=%d, Predicted=%f, Expected=%f’ % (i+1, yhat, expected))</p>
<p>I do not understand as to why this is happening.</p>
<p>thanks for the feedback.</p>
<div class="reply">
<a aria-label="Reply to mikiwate" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412391#respond" onclick='return addComment.moveForm( "comment-412391", "412391", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412397">
<div class="comment-container" id="li-comment-412397">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 3, 2017 at 3:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412397" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting.</p>
<p>Does this happen every time? </p>
<p>I wonder if it is platform specific. Are you on a 32-bit machine? What version of Python?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412397#respond" onclick='return addComment.moveForm( "comment-412397", "412397", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-412415">
<div class="comment-container" id="li-comment-412415">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 3, 2017 at 6:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412415" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,</p>
<p>I had a question, what are we supposed to send as first parameter of inverse_difference if we go with the idea that we don’t know the future?</p>
<p>Regardless what I do, if I give it the testing set then it have perfect accuracy and values. If I send the training set it will look like the last len(test_scaled) training values.</p>
<p>Best regards</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412415#respond" onclick='return addComment.moveForm( "comment-412415", "412415", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412463">
<div class="comment-container" id="li-comment-412463">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412463" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You would pass a list of past observations so that you can reverse the difference operation.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412463#respond" onclick='return addComment.moveForm( "comment-412463", "412463", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-412490">
<div class="comment-container" id="li-comment-412490">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 4, 2017 at 9:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412490" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Mr Jason,</p>
<p>Sorry, I have trouble understanding, what do you mean by “list of past observations”? Would that be what we predict (the predictions list)?<br/>
It would then follow what “Pawel” asked and said previously?<br/>
“my proposal:<br/>
# invert differencing – (starting from 2nd loop cycle (1st would be the starting point (raw_values[-1]) )</p>
<p>yhat = inverse_difference(predictions, yhat, 1)”</p>
<p>Best regards,<br/>
Eric</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412490#respond" onclick='return addComment.moveForm( "comment-412490", "412490", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-412927">
<div class="comment-container" id="li-comment-412927">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-412927" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I mean it is the true or real values observed in the domain at prior time steps. E.g. not predictions.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=412927#respond" onclick='return addComment.moveForm( "comment-412927", "412927", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-413007">
<div class="comment-container" id="li-comment-413007">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 7, 2017 at 5:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-413007" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Mr Jason,</p>
<p>Thank you, so let’s imagine a 500 000 entry file.<br/>
My training would be the 490 000 first line. I want to predict the last 10 000 lines.</p>
<p>For predicting I send the last line of the training set (then for the next prediction I send my first prediction without having unscaled or reversed the difference).<br/>
To get the true value I send as argument of “Invert_difference” my training set, or more specially, my last 10 000 thousands line?</p>
<p>Best regards,<br/>
Eric Godard.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-413199">
<div class="comment-container" id="li-comment-413199">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-413199" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would not recommend prediction 10K time steps. I expect skill would be very poor.</p>
<p>Nevertheless, observation 490000 would be used to invert observation 490001, then the 490001 transformed prediction would be used to decode 490002 and so on.</p>
<p>Does that help?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-413072">
<div class="comment-container" id="li-comment-413072">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 8, 2017 at 10:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-413072" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I may have badly worded myself here.</p>
<p>My dataset have one entry per minute, one day is 1440 entry, I have years worth of data in my data set. I want to predict the next day, should I send the last day of the training set (trained_scaled[-1440:]) as argument of inverse_difference?</p>
<p>Best regards,</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-413216">
<div class="comment-container" id="li-comment-413216">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-413216" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help you better understand the different transform:<br/>
<a href="https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/" rel="nofollow">https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414041">
<div class="comment-container" id="li-comment-414041">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc4369ac93ed04e05ee4ca8a42b72e41?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc4369ac93ed04e05ee4ca8a42b72e41?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brian</span>
<span class="date">September 16, 2017 at 8:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414041" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I keep getting inconsistent result of RMSE every time I rerun the code, so I added</p>
<p>np.random.seed(1) # for consistent results</p>
<p>to the very top of my code so now every run produces consistent RMSE.</p>
<div class="reply">
<a aria-label="Reply to Brian" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414041#respond" onclick='return addComment.moveForm( "comment-414041", "414041", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414071">
<div class="comment-container" id="li-comment-414071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 17, 2017 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is hard to get reproducible results, see this post for more information Brian:<br/>
<a href="https://machinelearningmastery.com/reproducible-results-neural-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reproducible-results-neural-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414071#respond" onclick='return addComment.moveForm( "comment-414071", "414071", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414200">
<div class="comment-container" id="li-comment-414200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/33c125b7b4675a267d43ee131f8be1e7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/33c125b7b4675a267d43ee131f8be1e7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Irene</span>
<span class="date">September 18, 2017 at 8:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I try to load the data after executing the following code line with Python 3.6 I get the following error: </p>
<p>series = read_csv(‘shampoo-sales.csv’, header=0, parse_dates=[0], index_col=0,<br/>
                  squeeze=True, date_parser=parser)</p>
<p>TypeError: ufunc ‘add’ did not contain a loop with signature matching types dtype(‘&lt;U32') dtype('&lt;U32') dtype('&lt;U32').</p>
<p>Can you help me, please?</p>
<div class="reply">
<a aria-label="Reply to Irene" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414200#respond" onclick='return addComment.moveForm( "comment-414200", "414200", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414238">
<div class="comment-container" id="li-comment-414238">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2017 at 7:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414238" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ouch, I have not seen that error before.</p>
<p>Perhaps confirm that the data is CSV and that you have removed the footer.</p>
<p>Perhaps ensure that your environment was installed correctly:<br/>
<a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<p>If that does not help, perhaps try posting to stackoverflow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414238#respond" onclick='return addComment.moveForm( "comment-414238", "414238", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414203">
<div class="comment-container" id="li-comment-414203">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c34ae77d2ec3e4a6302708ac6c953111?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c34ae77d2ec3e4a6302708ac6c953111?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Priyank</span>
<span class="date">September 18, 2017 at 10:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414203" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, </p>
<p>Thanks for sharing this post, very helpful as currently I am working on a time series project. I have one query.. How can we save a model with best RSME and use it to further prediction. </p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Priyank" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414203#respond" onclick='return addComment.moveForm( "comment-414203", "414203", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414242">
<div class="comment-container" id="li-comment-414242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 19, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post shows you how to save your model and use it to make predictions:<br/>
<a href="https://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414242#respond" onclick='return addComment.moveForm( "comment-414242", "414242", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414429">
<div class="comment-container" id="li-comment-414429">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8dcca9a5d59391a86f19aaf43aa1c4b6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8dcca9a5d59391a86f19aaf43aa1c4b6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">September 21, 2017 at 10:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414429" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason for the great tutorial!</p>
<p>Can you please clarify this statement for me: “The batch_size must be set to 1. This is because it must be a factor of the size of the training and test datasets”</p>
<p>I don’t understand how 1 in this case is a factor of the training and test datasets?</p>
<p>Further, for time series data, can we have a batch size greater than 1? If not, what was the relevance of the above statement?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414429#respond" onclick='return addComment.moveForm( "comment-414429", "414429", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414441">
<div class="comment-container" id="li-comment-414441">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2017 at 4:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414441" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is a constraint for the chosen framing of the problem so that we can make one-step forecasts with a stateful LSTM.</p>
<p>It is not a constraint generally.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414441#respond" onclick='return addComment.moveForm( "comment-414441", "414441", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414512">
<div class="comment-container" id="li-comment-414512">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nidhi</span>
<span class="date">September 22, 2017 at 9:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414512" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post Jason, very granularly explained LSTM example. Thanks a lot. I am trying to train a model to predict scientific notation data like “9.543301358961403E-9”, could you suggest a good way to rescale this data that fits LSTM the best?</p>
<div class="reply">
<a aria-label="Reply to Nidhi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414512#respond" onclick='return addComment.moveForm( "comment-414512", "414512", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414591">
<div class="comment-container" id="li-comment-414591">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-414591" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For input data, rescale values to the range 0-1.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=414591#respond" onclick='return addComment.moveForm( "comment-414591", "414591", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415338">
<div class="comment-container" id="li-comment-415338">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d15e3230eb18d9b183650f75dd273914?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d15e3230eb18d9b183650f75dd273914?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">vardhan</span>
<span class="date">October 2, 2017 at 4:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415338" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I have gone through many of your posts and still confusing when BPTT is applied?? Does BPTT is applied in this example? or just applied when we take more than one previous inputs to predict the current output??</p>
<p>And in this example, the parameters are updated at each epoch (batch gradient descent) completely contrast to stochastic gradient descent (online-learning), is this right??</p>
<div class="reply">
<a aria-label="Reply to vardhan" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415338#respond" onclick='return addComment.moveForm( "comment-415338", "415338", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415369">
<div class="comment-container" id="li-comment-415369">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 3, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415369" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post provides an intro to BPTT:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<p>BPTT is applied when you have more than one time step in your input sequence data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415369#respond" onclick='return addComment.moveForm( "comment-415369", "415369", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415480">
<div class="comment-container" id="li-comment-415480">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e50b35b89f473a72338e98f1676bc0e5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e50b35b89f473a72338e98f1676bc0e5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aljo Jose</span>
<span class="date">October 3, 2017 at 11:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415480" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for great tutorial. Please let me know the difference between below two – </p>
<p>1)  model.fit(trainX, trainY, epochs=3000, batch_size=1, verbose=0)</p>
<p>2) for i in range(3000):<br/>
	model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)<br/>
	model.reset_states()</p>
<div class="reply">
<a aria-label="Reply to Aljo Jose" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415480#respond" onclick='return addComment.moveForm( "comment-415480", "415480", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415517">
<div class="comment-container" id="li-comment-415517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 4, 2017 at 5:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-415517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not much.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=415517#respond" onclick='return addComment.moveForm( "comment-415517", "415517", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-416803">
<div class="comment-container" id="li-comment-416803">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nidhi</span>
<span class="date">October 16, 2017 at 1:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416803" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
You have reshaped value of X and then predicted the value of yhat, after that invert scaling of yhat is done and then this value is added to the raw value of the previous month. My question is what if I add the reshaped value of yhat and reshaped value of previous month and then call invert scale_function and not call inverse_difference function at all. Will both give the same result?<br/>
Best Regards</p>
<div class="reply">
<a aria-label="Reply to Nidhi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416803#respond" onclick='return addComment.moveForm( "comment-416803", "416803", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-416837">
<div class="comment-container" id="li-comment-416837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe so, we need to group yhat with anything, even 0 values to ensure that we meet the shape requirements when inverting the transform.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416837#respond" onclick='return addComment.moveForm( "comment-416837", "416837", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-416807">
<div class="comment-container" id="li-comment-416807">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/272a4a0b4145a12ffcc81590d5fd2b15?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nidhi</span>
<span class="date">October 16, 2017 at 1:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416807" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I ran your code multiple times with different parameters. There is one more question, when we are plotting both “pyplot.plot(raw_values[-12:]) and pyplot.plot(predictions)”, I expected both the lines to coincide at certain points(like in your example graph values for months 1 &amp; 3 are almost close) OR at least show a similar trend, but why in most of the results the orange line for time (t) always seem to be more closely associated with the blue line for time (t-1)??  Initially, I thought it because we must be plotting raw values of month 24-36 and predictions from month 25-37, but that’s not the case, we are plotting both prediction values(predicted from month 23-35) and the raw values(from 24-36). Could be please clarify, why is that the case?. I am definitely missing out something, but not able to figure out! Thanks again.</p>
<div class="reply">
<a aria-label="Reply to Nidhi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416807#respond" onclick='return addComment.moveForm( "comment-416807", "416807", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-416838">
<div class="comment-container" id="li-comment-416838">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 5:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416838" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This suggests a persistence model (e.g. no skill).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416838#respond" onclick='return addComment.moveForm( "comment-416838", "416838", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-416826">
<div class="comment-container" id="li-comment-416826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/419e7a01e0ff3eeabfc72a51ce11e857?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/419e7a01e0ff3eeabfc72a51ce11e857?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rubens</span>
<span class="date">October 16, 2017 at 4:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m using lag&gt;1</p>
<p>Shouldn’t the function “timeseries_to_supervised” revert the range range(1, lag+1) ?</p>
<p>    columns = [df.shift(i) for i in reversed(range(1, lag+1))]</p>
<div class="reply">
<a aria-label="Reply to Rubens" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416826#respond" onclick='return addComment.moveForm( "comment-416826", "416826", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416827">
<div class="comment-container" id="li-comment-416827">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/905913a0c56327ddf56fbd07c8076dd4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/905913a0c56327ddf56fbd07c8076dd4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thong Bui</span>
<span class="date">October 16, 2017 at 5:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416827" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks so much for the in-depth tutorial. I have a question about this block of code in fit_lstm(): </p>
<p>    for i in range(nb_epoch):<br/>
        model.fit(X, y, epochs=1, batch_size=batch_size, verbose=0, shuffle=False)<br/>
        model.reset_states()</p>
<p>Can it simply be done by this line?<br/>
    model.fit(X, y, epochs=nb_epoch, batch_size=batch_size, verbose=0, shuffle=False)</p>
<p>Thanks for your clarification</p>
<div class="reply">
<a aria-label="Reply to Thong Bui" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416827#respond" onclick='return addComment.moveForm( "comment-416827", "416827", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416840">
<div class="comment-container" id="li-comment-416840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but I wanted to explicitly reset states at the end of each epoch rather than the end of each batch.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416840#respond" onclick='return addComment.moveForm( "comment-416840", "416840", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-416849">
<div class="comment-container" id="li-comment-416849">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/905913a0c56327ddf56fbd07c8076dd4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/905913a0c56327ddf56fbd07c8076dd4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thong Bui</span>
<span class="date">October 16, 2017 at 7:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416849" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>what’s the difference between the 2 approaches?</p>
<div class="reply">
<a aria-label="Reply to Thong Bui" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416849#respond" onclick='return addComment.moveForm( "comment-416849", "416849", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-416884">
<div class="comment-container" id="li-comment-416884">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 16, 2017 at 3:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-416884" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can learn more about LSTM internal states here:<br/>
<a href="https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/" rel="nofollow">https://machinelearningmastery.com/understanding-stateful-lstm-recurrent-neural-networks-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=416884#respond" onclick='return addComment.moveForm( "comment-416884", "416884", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417179">
<div class="comment-container" id="li-comment-417179">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1a01efb1c9b77da2f215406c82d4958f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a01efb1c9b77da2f215406c82d4958f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Danier</span>
<span class="date">October 19, 2017 at 7:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417179" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I am a college student. I am particularly interested in machine learning and are working hard on it. But my English is not very good, so my problems may be a little rough.<br/>
1. The rmse in this article is somewhat large, and you have some other articles that describe how to adjust the parameters to reduce the rmse? What are the reasons for regulation?<br/>
2. Would you have a better article about using LSTM to predict time series problems? Ps: in Uni-variate time series. Because I did the experiment myself, if I use the model of this article, my experiment accuracy is 85% to 90%. I want to improve it.<br/>
3. Is there any article to solve the multivariate time series forecasting problem? If so, where is the latest?<br/>
4. I have been running the model several times with my own macbookpro, which is too slow. If I want to be more efficient, can I buy some GPU cloud services? Like amazon? But it seems that these cloud services are especially expensive. Do you have any good solutions?<br/>
Thank you so much! I want to say that you are my machine learning primer teacher.</p>
<div class="reply">
<a aria-label="Reply to Danier" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417179#respond" onclick='return addComment.moveForm( "comment-417179", "417179", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417212">
<div class="comment-container" id="li-comment-417212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 20, 2017 at 5:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post has a list of things to try to lift model skill:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<p>Generally, I would not recommend LSTMs for autoregression problems, see this post:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Here is a multivariate time series example:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<p>In practice, AWS is very cheap:<br/>
<a href="https://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/" rel="nofollow">https://machinelearningmastery.com/develop-evaluate-large-deep-learning-models-keras-amazon-web-services/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417212#respond" onclick='return addComment.moveForm( "comment-417212", "417212", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417729">
<div class="comment-container" id="li-comment-417729">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Danier</span>
<span class="date">October 24, 2017 at 3:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417729" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, Jason<br/>
          Thank you for your last reply. I have improved the accuracy of 4% by various methods. I used bias_regularizer =L1L2 (0.01, 0.01) to reduce the value of rmse. (based on my own dataset). But I would like to ask about Tutorial Extensions.<br/>
          I want to know how to complete multi-step Forecast. For example, my training set is 201601 to  201712, 24 sets of data, I would like to predict the six sets of data from 20171-201706. And these six sets of data have no expected value and are empty. I tried 10 or more methods but failed, maybe my python was too bad? Or is my understanding of LSTM not enough?I really can’t figure out a solution.and I was very depressed………..<br/>
         I hope you can give me some Suggestions. Thank you. Or do you know of any article that can be used as my reference?</p>
<div class="reply">
<a aria-label="Reply to Danier" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417729#respond" onclick='return addComment.moveForm( "comment-417729", "417729", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417743">
<div class="comment-container" id="li-comment-417743">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2017 at 4:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417743" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417743#respond" onclick='return addComment.moveForm( "comment-417743", "417743", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417793">
<div class="comment-container" id="li-comment-417793">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fcaff9045b5be7d7efb6bf1713c66128?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fcaff9045b5be7d7efb6bf1713c66128?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">argyn</span>
<span class="date">October 25, 2017 at 1:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417793" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello</p>
<p>I have an issue with your terminology regarding the dynamic forecasting, which you defined as follows:<br/>
“re-fit the model or update the model each time step of the test data as new observations from the test data are made available (we’ll call this the dynamic approach).”</p>
<p>That’s not what’s called dynamic forecasting in time series and econometric analysis. The dynamic forecasting involves using the previous forecast value as input into the next forecast. In your case, you are using the lagged value of the dependent variable as a regressor in the estimation of the model: X(t) = Y(t-1). For instance, see this paper <a href="https://files.stlouisfed.org/files/htdocs/publications/review/80/06/Forecasting_Jun_Jul1980.pdf" rel="nofollow">https://files.stlouisfed.org/files/htdocs/publications/review/80/06/Forecasting_Jun_Jul1980.pdf</a></p>
<p>So, the dynamic multi-step forecast would involve something like this: Yhat(t) = function(Yhat(t-1)). It doesn’t need to re-estimate the model at each step to be dynamic. All it needs is to use the previous forecast value to come up with the next.</p>
<p>Particularly this step would change to use yhat as X:</p>
<p>		X, y = test_scaled[i, 0:-1], test_scaled[i, -1]<br/>
		yhat = forecast_lstm(lstm_model, 1, X)</p>
<div class="reply">
<a aria-label="Reply to argyn" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417793#respond" onclick='return addComment.moveForm( "comment-417793", "417793", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417832">
<div class="comment-container" id="li-comment-417832">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 25, 2017 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417832" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the clarification.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417832#respond" onclick='return addComment.moveForm( "comment-417832", "417832", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417902">
<div class="comment-container" id="li-comment-417902">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7149ea32c0a1338676f626ce4880710?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7149ea32c0a1338676f626ce4880710?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sulgi</span>
<span class="date">October 25, 2017 at 7:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417902" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi I like to input time difference between timesteps into LSTM to model a decay. I saw someone manually put this term into the weight, so weight now has the form, W(t). I wonder if we can include the time difference in input, X. Do you have any advice on this?</p>
<div class="reply">
<a aria-label="Reply to Sulgi" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417902#respond" onclick='return addComment.moveForm( "comment-417902", "417902", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-417961">
<div class="comment-container" id="li-comment-417961">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417961" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not done this, perhaps talk to the person that raised this idea with you?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417961#respond" onclick='return addComment.moveForm( "comment-417961", "417961", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-417989">
<div class="comment-container" id="li-comment-417989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/075bb9ae37f0660dd0333ed59503db11?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/075bb9ae37f0660dd0333ed59503db11?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eren</span>
<span class="date">October 26, 2017 at 10:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-417989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>My observation is the model tries to predict the previous value so that it is able to pick a moderate precision. (I used another dataset)</p>
<div class="reply">
<a aria-label="Reply to Eren" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=417989#respond" onclick='return addComment.moveForm( "comment-417989", "417989", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418016">
<div class="comment-container" id="li-comment-418016">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ea25739bc7616fd37563dc4d37a44279?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ea25739bc7616fd37563dc4d37a44279?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tony</span>
<span class="date">October 26, 2017 at 5:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-418016" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason:<br/>
    Use the shampoo sales data and my own test data, the results are good.But when the time series with        seasonal trends, LSTM result is very bad.So I want to ask is there any way to solve include seasonal time series forecasting problem?<br/>
   thank you.</p>
<div class="reply">
<a aria-label="Reply to tony" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=418016#respond" onclick='return addComment.moveForm( "comment-418016", "418016", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418047">
<div class="comment-container" id="li-comment-418047">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 27, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-418047" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can seasonally adjust your data:<br/>
<a href="https://machinelearningmastery.com/time-series-seasonality-with-python/" rel="nofollow">https://machinelearningmastery.com/time-series-seasonality-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=418047#respond" onclick='return addComment.moveForm( "comment-418047", "418047", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419215">
<div class="comment-container" id="li-comment-419215">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/23de17adb64b39e24634d2a295f77726?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/23de17adb64b39e24634d2a295f77726?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Frank</span>
<span class="date">November 7, 2017 at 11:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419215" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>While the visuals and numbers in this tutorial are compelling, there are several things seriously wrong that aren’t apparent until you go over it with a very fine-toothed comb. Among all the arrays, lists, and indices flying all over the place, there are errors that make the results non-reproducible for one.</p>
<p>At the detail level you’ve got this prediction output:</p>
<p>    Month=1, Predicted=339.700000, Expected=339.700000<br/>
    Month=2, Predicted=440.400000, Expected=440.400000<br/>
    Month=3, Predicted=315.900000, Expected=315.900000<br/>
    ….</p>
<p>However running the code block that is supposed to produce that results in an IndexError because “Expected” is supposed to come from:</p>
<p>    expected = raw_values[len(train) + i + 1]</p>
<p>Index i starts out at 0 because you are looping through len(train), so raw_values[len(train) + i + 1] will first be raw_values[len(train) + 0 + 1] which is raw_values[25], which is 440.40 (Month 2), not 339.7 (Month 1). </p>
<p>This kind of thing seems minor, but it’s actually very frustrating to readers who are trying to get some reproducible output, but instead they end up having to track down a bug in the code from the start.</p>
<p>At a more general level, the purpose of building a machine learning model is not to produce some metrics on test data and leave it at that. Instead, it is to build a model that performs well on out-of-sample data that you haven’t encountered yet. From the beginning, you apply a difference function to the data that is supposed to remove the trend, then you forecast the residuals, and then add the trend back in with an inverse difference function. Right there is a major violation as you are literally imputing known information into what is supposed to be the forecast. The inverse difference function takes raw_values as a parameter, however in a real out-of-sample scenario, you wouldn’t have access to those raw_values, so you couldn’t simply adjust the forecasted residuals to reflect the trend in that manner. How did no one catch this?</p>
<p>I’m doing a research project on LSTMS for time-series data and trying to extract something useful from this tutorial that I can apply to this problem, but I feel there are too many land-mines hidden throughout.</p>
<div class="reply">
<a aria-label="Reply to Frank" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419215#respond" onclick='return addComment.moveForm( "comment-419215", "419215", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-419263">
<div class="comment-container" id="li-comment-419263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4f596df7f0d92b7403a1f027dc2cae54?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4f596df7f0d92b7403a1f027dc2cae54?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Luciano</span>
<span class="date">November 7, 2017 at 10:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!</p>
<p>I have a dataset of 200 thousand time-series. Each with 150 timestamps. </p>
<p>Let’s say they are sales of the same product but for different stores. </p>
<p>What is the best way to design the problem?</p>
<p>I can’t figure out what would be the ideal way to structure it. Just feed each sequence of 149 values to predict the 150th; Or should I do a rolling-window? If I give the whole sequence, I’m giving it a lot of context to work on, but I’m afraid the series it to big and training will be hard. </p>
<p>Any thoughts?<br/>
There is a lack of literature on how to design time-series problems with LSTMs. You are the only one that is talking about it. Thanks!</p>
<div class="reply">
<a aria-label="Reply to Luciano" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419263#respond" onclick='return addComment.moveForm( "comment-419263", "419263", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419339">
<div class="comment-container" id="li-comment-419339">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 8, 2017 at 9:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419339" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend exploring many different framings of the problem and see what works best.</p>
<p>200K series is a lot. Perhaps you can group series and use sub-models and combine results in an ensemble of some sort.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419339#respond" onclick='return addComment.moveForm( "comment-419339", "419339", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-419470">
<div class="comment-container" id="li-comment-419470">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashima</span>
<span class="date">November 9, 2017 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419470" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Would like to request your help in updating the above code to a dynamic model which updates itself after every observation and accordingly predicts the future points. Could you suggest how to modify this code to suit that purpose.</p>
<div class="reply">
<a aria-label="Reply to Ashima" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419470#respond" onclick='return addComment.moveForm( "comment-419470", "419470", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-419500">
<div class="comment-container" id="li-comment-419500">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 9, 2017 at 10:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419500" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/update-lstm-networks-training-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419500#respond" onclick='return addComment.moveForm( "comment-419500", "419500", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-419533">
<div class="comment-container" id="li-comment-419533">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d59d4da7b6a5ab0a7e69647ffdda587d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ashima</span>
<span class="date">November 9, 2017 at 6:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419533" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Also if I need to create a lookback of a number other than 1, say 7 what all do I need to update in this code above to get it running for a look back of 7.</p>
<div class="reply">
<a aria-label="Reply to Ashima" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419533#respond" onclick='return addComment.moveForm( "comment-419533", "419533", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419968">
<div class="comment-container" id="li-comment-419968">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3b63a65798542a760e09654f93c8b81c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3b63a65798542a760e09654f93c8b81c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Bahar</span>
<span class="date">November 14, 2017 at 4:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-419968" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the useful tutorial.<br/>
I have a question about 		X, y = test_scaled[i, 0:-1], test_scaled[i, -1]<br/>
		                                yhat = forecast_lstm(lstm_model, 1, X)</p>
<p>(line110):</p>
<p>I didn’t understand how the prediction will use timestamps to predict on test data set.<br/>
As far as I know, eventually we want to predict based on future time. So we should test based on timestamps (not values) and compare the prediction results with real test values to see the accuracy of the prediction.<br/>
But in the code, it seems that you are predicting based on the values and comparing again with those values!</p>
<p>Would you please explain it to me? Maybe I misunderstood some part.</p>
<p>Best Regards,<br/>
Bahar</p>
<div class="reply">
<a aria-label="Reply to Bahar" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=419968#respond" onclick='return addComment.moveForm( "comment-419968", "419968", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420038">
<div class="comment-container" id="li-comment-420038">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420038" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are predicting t+1.</p>
<p>Perhaps this post will help to better understand Python array slicing and ranges:<br/>
<a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420038#respond" onclick='return addComment.moveForm( "comment-420038", "420038", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420566">
<div class="comment-container" id="li-comment-420566">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/47c6468a94d44b795c461292cb8785f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/47c6468a94d44b795c461292cb8785f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pradeep</span>
<span class="date">November 19, 2017 at 5:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420566" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason awesome tutorial which helps in getting folks started out.<br/>
I had 2 quick questions.<br/>
1. Is there a good example of adding other “features” apart form time lags. For example whether a particular hour is rush hour or not, whether a particular day is a weekday or not .<br/>
2. I have hourly data for 3 years and wish to forecast hourly for the next 3 months. So i have approximately 14600 training rows and have to forecast for approximately 2600 test rows. Multi Step seems to be the right approach. However will be able to train a model to forecast so mant steps in advance?</p>
<div class="reply">
<a aria-label="Reply to Pradeep" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420566#respond" onclick='return addComment.moveForm( "comment-420566", "420566", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420638">
<div class="comment-container" id="li-comment-420638">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2017 at 10:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420638" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post shows you how to use multiple input variables:<br/>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="nofollow">https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/</a></p>
<p>Multistep for that many obs may result in poor results. I’d recommend testing a suite of approaches to see which works best for your data:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420638#respond" onclick='return addComment.moveForm( "comment-420638", "420638", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-420665">
<div class="comment-container" id="li-comment-420665">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/47c6468a94d44b795c461292cb8785f0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/47c6468a94d44b795c461292cb8785f0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pradeep</span>
<span class="date">November 20, 2017 at 4:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420665" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome Thanks Jason.I will go through the links suggested.<br/>
Are there any other references which you can suggest for multi step forecasting?</p>
<div class="reply">
<a aria-label="Reply to Pradeep" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420665#respond" onclick='return addComment.moveForm( "comment-420665", "420665", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-420793">
<div class="comment-container" id="li-comment-420793">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 10:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420793" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420793#respond" onclick='return addComment.moveForm( "comment-420793", "420793", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-420605">
<div class="comment-container" id="li-comment-420605">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ec96756a49c58e27b994a233e3c2bd11?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ec96756a49c58e27b994a233e3c2bd11?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harini</span>
<span class="date">November 20, 2017 at 1:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420605" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I have a quarterly sales dataset(below) and tried to use the same code on this post:<br/>
Month, Sales<br/>
5-09,11<br/>
5-12,20<br/>
6-03,66<br/>
6-06,50<br/>
6-09,65<br/>
6-12,63<br/>
7-06,25<br/>
7-12,34</p>
<p>I trained the model with data from all preceding quarters to predict the last quarter:<br/>
last quarter: predicted=-1.329951, actual=34.000000</p>
<p>The sales number can’t be negative but the model has predicted a negative value.<br/>
Is there a way to prevent the model from predicting negative values?</p>
<div class="reply">
<a aria-label="Reply to Harini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420605#respond" onclick='return addComment.moveForm( "comment-420605", "420605", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420643">
<div class="comment-container" id="li-comment-420643">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2017 at 10:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420643" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend starting with some simple linear models to better understand your data and how time series works:<br/>
<a href="https://machinelearningmastery.com/start-here/#timeseries" rel="nofollow">https://machinelearningmastery.com/start-here/#timeseries</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420643#respond" onclick='return addComment.moveForm( "comment-420643", "420643", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421120">
<div class="comment-container" id="li-comment-421120">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ec96756a49c58e27b994a233e3c2bd11?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ec96756a49c58e27b994a233e3c2bd11?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harini</span>
<span class="date">November 25, 2017 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-421120" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason, I tried linear regression but it din’t seem to give me expected results.</p>
<p>Then I tuned the LSTM in your code to predict positive values by<br/>
* changing the scaler range from (-1,1) to (0,1)<br/>
* adding the activation function ‘relu’ to the model</p>
<div class="reply">
<a aria-label="Reply to Harini" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=421120#respond" onclick='return addComment.moveForm( "comment-421120", "421120", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420743">
<div class="comment-container" id="li-comment-420743">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/36ac5a793ba0ee2debe13f67cb21979a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/36ac5a793ba0ee2debe13f67cb21979a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">SRIRAM P</span>
<span class="date">November 21, 2017 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-420743" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Need a small clarification,</p>
<p>Does the for loop started at 100th line ends at 102?</p>
<p>for r in range(repeats):<br/>
	# fit the model<br/>
	lstm_model = fit_lstm(train_scaled, 1, 3000, 4)<br/>
	# forecast the entire training dataset to build up state for forecasting<br/>
	train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)<br/>
	lstm_model.predict(train_reshaped, batch_size=1)</p>
<p>here in the above, does the lines<br/>
	train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)<br/>
	lstm_model.predict(train_reshaped, batch_size=1)</p>
<p>also belongs to for loop?</p>
<div class="reply">
<a aria-label="Reply to SRIRAM P" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=420743#respond" onclick='return addComment.moveForm( "comment-420743", "420743", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421402">
<div class="comment-container" id="li-comment-421402">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d10e5cdfddb770bf6aa13475ac7b310e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d10e5cdfddb770bf6aa13475ac7b310e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">AB</span>
<span class="date">November 28, 2017 at 5:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-421402" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hey Jason,</p>
<p>How to Predict next one month for above example?</p>
<div class="reply">
<a aria-label="Reply to AB" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=421402#respond" onclick='return addComment.moveForm( "comment-421402", "421402", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421433">
<div class="comment-container" id="li-comment-421433">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2017 at 8:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-421433" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help you make predictions:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=421433#respond" onclick='return addComment.moveForm( "comment-421433", "421433", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-422303">
<div class="comment-container" id="li-comment-422303">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/749e7051b2117c5d61e19b10687a3c9c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/749e7051b2117c5d61e19b10687a3c9c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vijay</span>
<span class="date">December 6, 2017 at 11:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-422303" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason,</p>
<p>Thanks for all your wonderful articles. I’ve trying this model to predict a spending pattern of a customer. I have mean of the weekly expenditure of a customer. Once I finished training, i’m seeing this pattern where the predicted output for current is matching the expected output in the last week. I changed yhat = y to see if all the conversions are taking place correctly. But even yhat = y is showing the same behaviour.</p>
<p>Week=1, Predicted=975.556027, Expected=989.100588<br/>
Week=2, Predicted=989.100588, Expected=928.604400<br/>
Week=3, Predicted=928.604400, Expected=921.209794<br/>
Week=4, Predicted=921.209794, Expected=919.813532<br/>
Week=5, Predicted=919.813532, Expected=904.214533<br/>
Week=6, Predicted=904.214533, Expected=913.695025<br/>
Week=7, Predicted=913.695025, Expected=971.727005<br/>
Week=8, Predicted=971.727005, Expected=1095.774093<br/>
Week=9, Predicted=1095.774093, Expected=1159.611429<br/>
Week=10, Predicted=1159.611429, Expected=732.743950<br/>
Week=11, Predicted=732.743950, Expected=963.615794<br/>
Week=12, Predicted=963.615794, Expected=896.842055<br/>
Week=13, Predicted=896.842055, Expected=960.630000<br/>
Week=14, Predicted=960.630000, Expected=905.481048<br/>
Week=15, Predicted=905.481048, Expected=994.167244<br/>
Week=16, Predicted=994.167244, Expected=975.601111<br/>
Week=17, Predicted=975.601111, Expected=1210.307037<br/>
Week=18, Predicted=1210.307037, Expected=9293.130000<br/>
Week=19, Predicted=9293.130000, Expected=367.780000</p>
<p>I’m not differencing the data since my data is stationary, I dont see a increasing/decreasing pattering the spending patterns. Can you help me out ?</p>
<div class="reply">
<a aria-label="Reply to Vijay" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=422303#respond" onclick='return addComment.moveForm( "comment-422303", "422303", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422352">
<div class="comment-container" id="li-comment-422352">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 7:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-422352" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It may suggest that the model is only learning a persistence model (e.g. output what was input).</p>
<p>I would recommend starting with a simple MLP and see if an LSTM can do better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=422352#respond" onclick='return addComment.moveForm( "comment-422352", "422352", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-423515">
<div class="comment-container" id="li-comment-423515">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 17, 2017 at 2:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423515" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thanks for your great work and all the posts, they are really amazing and helpful!</p>
<p>Lets look at my changed csv data:</p>
<p>“1-01”,0.1<br/>
“1-02”,-0.2<br/>
“1-03”,0.3<br/>
“1-04”,-0.4<br/>
“1-05”,0.5<br/>
“1-06”,-0.6<br/>
“1-07”,0.7<br/>
“1-08”,-0.8<br/>
“1-09”,0.9<br/>
“1-10”,-1.0<br/>
“1-11”,1.1<br/>
“1-12”,-1.2<br/>
“2-01”,1.3<br/>
“2-02”,-1.4<br/>
“2-03”,1.5<br/>
“2-04”,-1.6<br/>
“2-05”,1.7<br/>
“2-06”,-1.8<br/>
“2-07”,1.9<br/>
“2-08”,-2.0<br/>
“2-09”,2.1<br/>
“2-10”,-2.2<br/>
“2-11”,2.3<br/>
“2-12”,-2.4<br/>
“3-01”,2.5<br/>
“3-02”,-2.6<br/>
“3-03”,2.7<br/>
“3-04”,-2.8<br/>
“3-05”,2.9<br/>
“3-06”,-3.0<br/>
“3-07”,3.1<br/>
“3-08”,-3.2<br/>
“3-09”,3.3<br/>
“3-10”,-3.4<br/>
“3-11”,3.5<br/>
“3-12”,-3.6</p>
<p>Its a very simple sequence of “resonant” points, increasing every step over y axis. I didn’t changed any changes in the program code, and here is the result: <a href="http://prntscr.com/hob1hf" rel="nofollow">http://prntscr.com/hob1hf</a></p>
<p>Why LSTM can not predict so simple and logical sequence of data? What are we missing here? </p>
<p>Waiting for your reply, and once again, thanks a lot!</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423515#respond" onclick='return addComment.moveForm( "comment-423515", "423515", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423567">
<div class="comment-container" id="li-comment-423567">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 17, 2017 at 8:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423567" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nothing, LSTMS are poor at autoregression, here’s why:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Use an MLP instead.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423567#respond" onclick='return addComment.moveForm( "comment-423567", "423567", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423516">
<div class="comment-container" id="li-comment-423516">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 17, 2017 at 2:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423516" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One interesting thing: I made the time serie 2 years longer, but with the same increasing resonant coefficient (0.1):</p>
<p>“1-01”,0.1<br/>
“1-02”,-0.2<br/>
“1-03”,0.3<br/>
“1-04”,-0.4<br/>
“1-05”,0.5<br/>
“1-06”,-0.6<br/>
“1-07”,0.7<br/>
“1-08”,-0.8<br/>
“1-09”,0.9<br/>
“1-10”,-1.0<br/>
“1-11”,1.1<br/>
“1-12”,-1.2<br/>
“2-01”,1.3<br/>
“2-02”,-1.4<br/>
“2-03”,1.5<br/>
“2-04”,-1.6<br/>
“2-05”,1.7<br/>
“2-06”,-1.8<br/>
“2-07”,1.9<br/>
“2-08”,-2.0<br/>
“2-09”,2.1<br/>
“2-10”,-2.2<br/>
“2-11”,2.3<br/>
“2-12”,-2.4<br/>
“3-01”,2.5<br/>
“3-02”,-2.6<br/>
“3-03”,2.7<br/>
“3-04”,-2.8<br/>
“3-05”,2.9<br/>
“3-06”,-3.0<br/>
“3-07”,3.1<br/>
“3-08”,-3.2<br/>
“3-09”,3.3<br/>
“3-10”,-3.4<br/>
“3-11”,3.5<br/>
“3-12”,-3.6<br/>
“4-01”,3.7<br/>
“4-02”,-3.8<br/>
“4-03”,3.9<br/>
“4-04”,-4.0<br/>
“4-05”,4.1<br/>
“4-06”,-4.2<br/>
“4-07”,4.3<br/>
“4-08”,-4.4<br/>
“4-09”,4.5<br/>
“4-10”,-4.6<br/>
“4-11”,4.7<br/>
“4-12”,-4.8<br/>
“5-01”,4.9<br/>
“5-02”,-5.0<br/>
“5-03”,5.1<br/>
“5-04”,-5.2<br/>
“5-05”,5.3<br/>
“5-06”,-5.4<br/>
“5-07”,5.5<br/>
“5-08”,-5.6<br/>
“5-09”,5.7<br/>
“5-10”,-5.8<br/>
“5-11”,5.9<br/>
“5-12”,-6.0</p>
<p>Now, we see that LSTM made a predictions more closely, but still don’t see the increment over Y axis (the red lines and arrows are my own paining) <a href="http://prntscr.com/hob7eo" rel="nofollow">http://prntscr.com/hob7eo</a></p>
<p>Any ideas?</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423516#respond" onclick='return addComment.moveForm( "comment-423516", "423516", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423568">
<div class="comment-container" id="li-comment-423568">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 17, 2017 at 8:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423568" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Not enough data, model needs tuning, lstms are poor at autoregression.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423568#respond" onclick='return addComment.moveForm( "comment-423568", "423568", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-423521">
<div class="comment-container" id="li-comment-423521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 17, 2017 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>One more question about the code:</p>
<p>Why you performs 1 prediction before the predictions cycle:</p>
<p>train_reshaped = train_scaled[:, 0].reshape(len(train_scaled), 1, 1)<br/>
lstm_model.predict(train_reshaped, batch_size=1)</p>
<p>what is this for?</p>
<p>And at the line<br/>
	# make one-step forecast<br/>
	X, y = test_scaled[i, 0:-1], test_scaled[i, -1]</p>
<p>what is “y” for?</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423521#respond" onclick='return addComment.moveForm( "comment-423521", "423521", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423569">
<div class="comment-container" id="li-comment-423569">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 17, 2017 at 8:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423569" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It’s unused.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423569#respond" onclick='return addComment.moveForm( "comment-423569", "423569", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423689">
<div class="comment-container" id="li-comment-423689">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/526311427780f4d21de2ca4d7db638fb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/526311427780f4d21de2ca4d7db638fb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Krasimir</span>
<span class="date">December 18, 2017 at 8:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423689" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for the great posts, very helpful and informative. </p>
<p>I am using some of your example for stock market values predictions. The models work well. Could you please provide more detail on why there is a one sample delay (lag) in the response of the model. It can be seen on all your plots and mine too.</p>
<div class="reply">
<a aria-label="Reply to Krasimir" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423689#respond" onclick='return addComment.moveForm( "comment-423689", "423689", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423717">
<div class="comment-container" id="li-comment-423717">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 3:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-423717" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Because the model is not very good, it’s a sign that it is outputting the input as an output, called persistence:<br/>
<a href="https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=423717#respond" onclick='return addComment.moveForm( "comment-423717", "423717", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424067">
<div class="comment-container" id="li-comment-424067">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 20, 2017 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424067" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is the model state updated after each </p>
<p>lstm_model.predict(train_reshaped, batch_size=1)</p>
<p>?</p>
<p>So can we be sure that after 100 predictions the model will have actual state for 101 prediction? Or should we use some additional model updates technique after each prediction step? It is not clear for me…</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424067#respond" onclick='return addComment.moveForm( "comment-424067", "424067", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424070">
<div class="comment-container" id="li-comment-424070">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424070" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>State does not see to matter that much in this example.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424070#respond" onclick='return addComment.moveForm( "comment-424070", "424070", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424071">
<div class="comment-container" id="li-comment-424071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 20, 2017 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Agree, but in general? Does lstm_model.predict updates the model?</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424071#respond" onclick='return addComment.moveForm( "comment-424071", "424071", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424161">
<div class="comment-container" id="li-comment-424161">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 3:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424161" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It will update internal state variables, but not weights.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424161#respond" onclick='return addComment.moveForm( "comment-424161", "424161", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424266">
<div class="comment-container" id="li-comment-424266">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 21, 2017 at 8:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424266" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, thank you very much</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424266#respond" onclick='return addComment.moveForm( "comment-424266", "424266", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424293">
<div class="comment-container" id="li-comment-424293">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 3:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-424293" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=424293#respond" onclick='return addComment.moveForm( "comment-424293", "424293", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425791">
<div class="comment-container" id="li-comment-425791">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f0b45852fb0b5e2dd49e436371e34835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f0b45852fb0b5e2dd49e436371e34835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Novin</span>
<span class="date">January 7, 2018 at 1:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425791" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason for the tutorial.</p>
<p>What’s your suggestion for adapting this network for different stores shampoo sales? Things that I could think of are:</p>
<p>1- run this model for different stores separately (maybe we can learn something from sales of all stores together, but with this approach, we can’t benefit that)<br/>
2- giving in the number of sales of each store as features</p>
<div class="reply">
<a aria-label="Reply to Novin" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425791#respond" onclick='return addComment.moveForm( "comment-425791", "425791", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425809">
<div class="comment-container" id="li-comment-425809">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 7, 2018 at 5:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425809" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Some ideas:</p>
<p>– model each store separately<br/>
– model each store separately and add data from all stores<br/>
– model each store separately and add data from related stores (regionally? profile? etc.)<br/>
– create a regional store model and ensemble with separate store model.<br/>
– create all store model and ensemble with separate store model<br/>
– so on… </p>
<p>Think up 100 ideas and try them all to see what works best for your specific data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425809#respond" onclick='return addComment.moveForm( "comment-425809", "425809", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425840">
<div class="comment-container" id="li-comment-425840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5100fb54283cd3bf5e15df3a57a14f79?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5100fb54283cd3bf5e15df3a57a14f79?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mostafa kotb</span>
<span class="date">January 8, 2018 at 12:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thank you Dr. Jason for this tutorial.<br/>
If i want to perform a walkforward validation on training data to, it is going to be:</p>
<p>for i in range(len(train_scaled)):<br/>
		# make one-step forecast<br/>
		X, y = train_scaled[i, 0:-1], train_scaled[i, -1]<br/>
		yhat = forecast_lstm(lstm_model, 1, X)<br/>
		# invert scaling<br/>
		yhat = invert_scale(scaler, X, yhat)<br/>
		# invert differencing<br/>
		yhat = inverse_difference(raw_values, yhat, len(raw_values)-i)<br/>
		# store forecast<br/>
		predictions_train.append(yhat)<br/>
		expected = raw_values[ i+1 ]<br/>
		print(‘Month=%d, Predicted=%f, Expected=%f’ % (i+1, yhat, expected))</p>
<p>	# report performance<br/>
	rmse_train = sqrt(mean_squared_error(raw_values[1:len(train_scaled)+1], predictions_train))</p>
<p>please, verify if it is right or not</p>
<div class="reply">
<a aria-label="Reply to mostafa kotb" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425840#respond" onclick='return addComment.moveForm( "comment-425840", "425840", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425853">
<div class="comment-container" id="li-comment-425853">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 8, 2018 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425853" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot debug your code. You can learn more about walk-forward validation here:<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425853#respond" onclick='return addComment.moveForm( "comment-425853", "425853", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425856">
<div class="comment-container" id="li-comment-425856">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5100fb54283cd3bf5e15df3a57a14f79?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5100fb54283cd3bf5e15df3a57a14f79?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mostafa kotb</span>
<span class="date">January 8, 2018 at 6:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425856" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanks for your reply…</p>
<p>let me rephrase my question….i want to know when i compute RMSE for training data, Do i skip the first point in the raw values?</p>
<p> rmse_train = sqrt(mean_squared_error(raw_values[1:len(train_scaled)+1], predictions_train))</p>
<p>if you notice in the last equation i started from the second point raw_values[1:len(train_scaled)+1]</p>
<p>because we don’t predict the first point, actually we start by first point as x and predict the second point as y.</p>
<div class="reply">
<a aria-label="Reply to mostafa kotb" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425856#respond" onclick='return addComment.moveForm( "comment-425856", "425856", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425871">
<div class="comment-container" id="li-comment-425871">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e613e3a9fe6ff612e73bae7a1a762322?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e613e3a9fe6ff612e73bae7a1a762322?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Swapnil</span>
<span class="date">January 8, 2018 at 3:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425871" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Thanks for the great article.<br/>
I have some log data from my honeypot. I have encoded the actions taking place with label encoder. Is this data good enough for training the lstm?  I finally want to recover the next action. Should i go for word to vector instead?</p>
<div class="reply">
<a aria-label="Reply to Swapnil" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425871#respond" onclick='return addComment.moveForm( "comment-425871", "425871", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425876">
<div class="comment-container" id="li-comment-425876">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 8, 2018 at 3:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425876" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try a few representations to see what works best for your data?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425876#respond" onclick='return addComment.moveForm( "comment-425876", "425876", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425938">
<div class="comment-container" id="li-comment-425938">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/091b71d391c24d4dc789b3ebe7ad02d1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/091b71d391c24d4dc789b3ebe7ad02d1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.jacquesthibodeau.com" rel="external nofollow">Jacques</a></span>
<span class="date">January 9, 2018 at 11:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425938" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey, I’m trying to understand why you implemented the persistence algorithm in a different way compared to your other post (<a href="https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a>). In your other post, you framed the problem as a supervised learning problem, but you didn’t do the same here? You also talk about t-1 and t+1 on that post, not t-1 and t. Could you clarify why you didn’t convert the problem in this post into supervised until the lstm model?</p>
<div class="reply">
<a aria-label="Reply to Jacques" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425938#respond" onclick='return addComment.moveForm( "comment-425938", "425938", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425957">
<div class="comment-container" id="li-comment-425957">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 9, 2018 at 3:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425957" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I was trying to make the example simpler.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425957#respond" onclick='return addComment.moveForm( "comment-425957", "425957", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425975">
<div class="comment-container" id="li-comment-425975">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e613e3a9fe6ff612e73bae7a1a762322?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e613e3a9fe6ff612e73bae7a1a762322?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Swapnil</span>
<span class="date">January 9, 2018 at 6:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-425975" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi how do u judge efficacy with rmse? Less is better or more?</p>
<div class="reply">
<a aria-label="Reply to Swapnil" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=425975#respond" onclick='return addComment.moveForm( "comment-425975", "425975", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426054">
<div class="comment-container" id="li-comment-426054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/#comment-426054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Small RMSE is better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/?replytocom=426054#respond" onclick='return addComment.moveForm( "comment-426054", "426054", "respond", "3882" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/time-series-forecasting-long-short-term-memory-network-python/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="3882"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="d10e20c1e9"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="135"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>