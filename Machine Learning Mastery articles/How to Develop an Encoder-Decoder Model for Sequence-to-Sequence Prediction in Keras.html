<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras - Machine Learning Mastery" property="og:title"/>
<meta content="The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems such as machine translation. Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-11-02T05:00:26+11:00" property="article:published_time"/>
<meta content="2017-10-18T05:58:09+11:00" property="article:modified_time"/>
<meta content="2017-10-18T05:58:09+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="425" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/develop-encoder-decoder-model-sequence-sequence-prediction-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4569" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4569 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4569 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-11-02T05:00:26+1100">November 2, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>The encoder-decoder model provides a pattern for using recurrent neural networks to address challenging sequence-to-sequence prediction problems such as machine translation.</p>
<p>Encoder-decoder models can be developed in the Keras Python deep learning library and an example of a neural machine translation system developed with this model has been described on the Keras blog, with sample code distributed with the Keras project.</p>
<p>This example can provide the basis for developing encoder-decoder LSTM models for your own sequence-to-sequence prediction problems.</p>
<p>In this tutorial, you will discover how to develop a sophisticated encoder-decoder recurrent neural network for sequence-to-sequence prediction problems with Keras.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to correctly define a sophisticated encoder-decoder model in Keras for sequence-to-sequence prediction.</li>
<li>How to define a contrived yet scalable sequence-to-sequence prediction problem that you can use to evaluate the encoder-decoder LSTM model.</li>
<li>How to apply the encoder-decoder LSTM model in Keras to address the scalable integer sequence-to-sequence prediction problem.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4570" style="max-width: 650px"><img alt="How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras" class="size-full wp-image-4570" height="425" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/How-to-Develop-an-Encoder-Decoder-Model-for-Sequence-to-Sequence-Prediction-in-Keras-300x199.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras<br/>Photo by <a href="https://www.flickr.com/photos/damescalito/35370558025/">Björn Groß</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 3 parts; they are:</p>
<ul>
<li>Encoder-Decoder Model in Keras</li>
<li>Scalable Sequence-to-Sequence Problem</li>
<li>Encoder-Decoder LSTM for Sequence Prediction</li>
</ul>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this tutorial.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy, and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Encoder-Decoder Model in Keras</h2>
<p>The encoder-decoder model is a way of organizing recurrent neural networks for sequence-to-sequence prediction problems.</p>
<p>It was originally developed for machine translation problems, although it has proven successful at related sequence-to-sequence prediction problems such as text summarization and question answering.</p>
<p>The approach involves two recurrent neural networks, one to encode the source sequence, called the encoder, and a second to decode the encoded source sequence into the target sequence, called the decoder.</p>
<p>The Keras deep learning Python library provides an example of how to implement the encoder-decoder model for machine translation (<a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">lstm_seq2seq.py</a>) described by the libraries creator in the post: “<a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a>.”</p>
<p>Using the code in that example as a starting point, we can develop a generic function to define an encoder-decoder recurrent neural network. Below is this function named <em>define_models()</em>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a5a229701408" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# returns train, inference_encoder and inference_decoder models
def define_models(n_input, n_output, n_units):
	# define training encoder
	encoder_inputs = Input(shape=(None, n_input))
	encoder = LSTM(n_units, return_state=True)
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)
	encoder_states = [state_h, state_c]
	# define training decoder
	decoder_inputs = Input(shape=(None, n_output))
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
	decoder_dense = Dense(n_output, activation='softmax')
	decoder_outputs = decoder_dense(decoder_outputs)
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
	# define inference encoder
	encoder_model = Model(encoder_inputs, encoder_states)
	# define inference decoder
	decoder_state_input_h = Input(shape=(n_units,))
	decoder_state_input_c = Input(shape=(n_units,))
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
	decoder_states = [state_h, state_c]
	decoder_outputs = decoder_dense(decoder_outputs)
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
	# return all models
	return model, encoder_model, decoder_model</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-6">6</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-8">8</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-10">10</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-12">12</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-14">14</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-16">16</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-18">18</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-20">20</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-22">22</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-24">24</div><div class="crayon-num" data-line="crayon-5a65911012a5a229701408-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a5a229701408-26">26</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a5a229701408-1"><span class="crayon-p"># returns train, inference_encoder and inference_decoder models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-2"><span class="crayon-e">def </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-3"><span class="crayon-h"> </span><span class="crayon-p"># define training encoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-4"><span class="crayon-h"> </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-5"><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-6"><span class="crayon-h"> </span><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-7"><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-8"><span class="crayon-h"> </span><span class="crayon-p"># define training decoder</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-9"><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-10"><span class="crayon-h"> </span><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-11"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-12"><span class="crayon-h"> </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-13"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-14"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-15"><span class="crayon-h"> </span><span class="crayon-p"># define inference encoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-16"><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-17"><span class="crayon-h"> </span><span class="crayon-p"># define inference decoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-18"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-19"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-20"><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-21"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-22"><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-23"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-24"><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a5a229701408-25"><span class="crayon-h"> </span><span class="crayon-p"># return all models</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a5a229701408-26"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0028 seconds] -->
<p>The function takes 3 arguments, as follows:</p>
<ul>
<li><strong>n_input</strong>: The cardinality of the input sequence, e.g. number of features, words, or characters for each time step.</li>
<li><strong>n_output</strong>: The cardinality of the output sequence, e.g. number of features, words, or characters for each time step.</li>
<li><strong>n_units</strong>: The number of cells to create in the encoder and decoder models, e.g. 128 or 256.</li>
</ul>
<p>The function then creates and returns 3 models, as follows:</p>
<ul>
<li><strong>train</strong>: Model that can be trained given source, target, and shifted target sequences.</li>
<li><strong>inference_encoder</strong>: Encoder model used when making a prediction for a new source sequence.</li>
<li><strong>inference_decoder</strong> Decoder model use when making a prediction for a new source sequence.</li>
</ul>
<p>The model is trained given source and target sequences where the model takes both the source and a shifted version of the target sequence as input and predicts the whole target sequence.</p>
<p>For example, one source sequence may be [1,2,3] and the target sequence [4,5,6]. The inputs and outputs to the model during training would be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a69397169959" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Input1: ['1', '2', '3']
Input2: ['_', '4', '5']
Output: ['4', '5', '6']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a69397169959-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a69397169959-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a69397169959-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a69397169959-1">Input1: ['1', '2', '3']</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a69397169959-2">Input2: ['_', '4', '5']</div><div class="crayon-line" id="crayon-5a65911012a69397169959-3">Output: ['4', '5', '6']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The model is intended to be called recursively when generating target sequences for new source sequences.</p>
<p>The source sequence is encoded and the target sequence is generated one element at a time, using a “start of sequence” character such as ‘_’ to start the process. Therefore, in the above case, the following input-output pairs would occur during training:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a6e690944752" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
t, 	Input1,				Input2,		Output
1,  ['1', '2', '3'],	'_',		'4'
2,  ['1', '2', '3'],	'4',		'5'
3,  ['1', '2', '3'],	'5',		'6'</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a6e690944752-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a6e690944752-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a6e690944752-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a6e690944752-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a6e690944752-1">t, 	Input1,				Input2,		Output</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a6e690944752-2">1,  ['1', '2', '3'],	'_',		'4'</div><div class="crayon-line" id="crayon-5a65911012a6e690944752-3">2,  ['1', '2', '3'],	'4',		'5'</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a6e690944752-4">3,  ['1', '2', '3'],	'5',		'6'</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Here you can see how the recursive use of the model can be used to build up output sequences.</p>
<p>During prediction, the <em>inference_encoder</em> model is used to encode the input sequence once which returns states that are used to initialize the <em>inference_decoder</em> model. From that point, the <em>inference_decoder</em> model is used to generate predictions step by step.</p>
<p>The function below named <em>predict_sequence()</em> can be used after the model is trained to generate a target sequence given a source sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a72056025757" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate target given source sequence
def predict_sequence(infenc, infdec, source, n_steps, cardinality):
	# encode
	state = infenc.predict(source)
	# start of sequence input
	target_seq = array([0.0 for _ in range(cardinality)]).reshape(1, 1, cardinality)
	# collect predictions
	output = list()
	for t in range(n_steps):
		# predict next char
		yhat, h, c = infdec.predict([target_seq] + state)
		# store prediction
		output.append(yhat[0,0,:])
		# update state
		state = [h, c]
		# update target sequence
		target_seq = yhat
	return array(output)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a72056025757-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-6">6</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-8">8</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-10">10</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-12">12</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-14">14</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-16">16</div><div class="crayon-num" data-line="crayon-5a65911012a72056025757-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a72056025757-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a72056025757-1"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-2"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-3"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-4"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-5"><span class="crayon-h"> </span><span class="crayon-p"># start of sequence input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-6"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-7"><span class="crayon-h"> </span><span class="crayon-p"># collect predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-8"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-10"><span class="crayon-h"> </span><span class="crayon-p"># predict next char</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-11"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_seq</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-12"><span class="crayon-h"> </span><span class="crayon-p"># store prediction</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-13"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-14"><span class="crayon-h"> </span><span class="crayon-p"># update state</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-15"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-16"><span class="crayon-h"> </span><span class="crayon-p"># update target sequence</span></div><div class="crayon-line" id="crayon-5a65911012a72056025757-17"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a72056025757-18"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>This function takes 5 arguments as follows:</p>
<ul>
<li><strong>infenc</strong>: Encoder model used when making a prediction for a new source sequence.</li>
<li><strong>infdec</strong>: Decoder model use when making a prediction for a new source sequence.</li>
<li><strong>source</strong>:Encoded source sequence.</li>
<li><strong>n_steps</strong>: Number of time steps in the target sequence.</li>
<li><strong>cardinality</strong>: The cardinality of the output sequence, e.g. the number of features, words, or characters for each time step.</li>
</ul>
<p>The function then returns a list containing the target sequence.</p>
<h2>Scalable Sequence-to-Sequence Problem</h2>
<p>In this section, we define a contrived and scalable sequence-to-sequence prediction problem.</p>
<p>The source sequence is a series of randomly generated integer values, such as [20, 36, 40, 10, 34, 28], and the target sequence is a reversed pre-defined subset of the input sequence, such as the first 3 elements in reverse order [40, 36, 20].</p>
<p>The length of the source sequence is configurable; so is the cardinality of the input and output sequence and the length of the target sequence.</p>
<p>We will use source sequences of 6 elements, a cardinality of 50, and target sequences of 3 elements.</p>
<p>Below are some more examples to make this concrete.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a78221591022" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Source,						Target
[13, 28, 18, 7, 9, 5]		[18, 28, 13]
[29, 44, 38, 15, 26, 22]	[38, 44, 29]
[27, 40, 31, 29, 32, 1]		[31, 40, 27]
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a78221591022-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a78221591022-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a78221591022-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a78221591022-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a78221591022-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a78221591022-1">Source,						Target</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a78221591022-2">[13, 28, 18, 7, 9, 5]		[18, 28, 13]</div><div class="crayon-line" id="crayon-5a65911012a78221591022-3">[29, 44, 38, 15, 26, 22]	[38, 44, 29]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a78221591022-4">[27, 40, 31, 29, 32, 1]		[31, 40, 27]</div><div class="crayon-line" id="crayon-5a65911012a78221591022-5">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>You are encouraged to explore larger and more complex variations. Post your findings in the comments below.</p>
<p>Let’s start off by defining a function to generate a sequence of random integers.</p>
<p>We will use the value of 0 as the padding or start of sequence character, therefore it is reserved and we cannot use it in our source sequences. To achieve this, we will add 1 to our configured cardinality to ensure the one-hot encoding is large enough (e.g. a value of 1 maps to a ‘1’ value in index 1).</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a7c411100473" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
n_features = 50 + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a7c411100473-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a7c411100473-1"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can use the <em>randint()</em> python function to generate random integers in a range between 1 and 1-minus the size of the problem’s cardinality. The <em>generate_sequence()</em> below generates a sequence of random integers.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a80612330755" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a80612330755-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a80612330755-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a80612330755-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a80612330755-1"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a80612330755-2"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a80612330755-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we need to create the corresponding output sequence given the source sequence.</p>
<p>To keep thing simple, we will select the first n elements of the source sequence as the target sequence and reverse them.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a84687873838" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define target sequence
target = source[:n_out]
target.reverse()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a84687873838-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a84687873838-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a84687873838-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a84687873838-1"><span class="crayon-p"># define target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a84687873838-2"><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a84687873838-3"><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need a version of the output sequence shifted forward by one time step that we can use as the mock target generated so far, including the start of sequence value in the first time step. We can create this from the target sequence directly.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a86053977199" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create padded input target sequence
target_in = [0] + target[:-1]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a86053977199-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a86053977199-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a86053977199-1"><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a86053977199-2"><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Now that all of the sequences have been defined, we can one-hot encode them, i.e. transform them into sequences of binary vectors. We can use the Keras built in <em>to_categorical()</em> function to achieve this.</p>
<p>We can put all of this into a function named <em>get_dataset()</em> that will generate a specific number of sequences that we can use to train a model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a89232581329" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a89232581329-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-6">6</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-8">8</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-10">10</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-12">12</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-14">14</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-16">16</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-18">18</div><div class="crayon-num" data-line="crayon-5a65911012a89232581329-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a89232581329-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a89232581329-1"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-2"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-3"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-5"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-6"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-7"><span class="crayon-h"> </span><span class="crayon-p"># define target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-8"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-9"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-10"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-11"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-12"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-13"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-14"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-15"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-16"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-17"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-18"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a89232581329-19"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a89232581329-20"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>Finally, we need to be able to decode a one-hot encoded sequence to make it readable again.</p>
<p>This is needed for both printing the generated target sequences but also for easily comparing whether the full predicted target sequence matches the expected target sequence. The <em>one_hot_decode()</em> function will decode an encoded sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a8c610493330" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a8c610493330-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8c610493330-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a8c610493330-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a8c610493330-1"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8c610493330-2"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a8c610493330-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can tie all of this together and test these functions.</p>
<p>A complete worked example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a8e030489667" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from keras.utils import to_categorical

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]

# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3
# generate a single source and target sequence
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
print(X1.shape, X2.shape, y.shape)
print('X1=%s, X2=%s, y=%s' % (one_hot_decode(X1[0]), one_hot_decode(X2[0]), one_hot_decode(y[0])))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-6">6</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-8">8</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-10">10</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-12">12</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-14">14</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-16">16</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-18">18</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-20">20</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-22">22</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-24">24</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-26">26</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-28">28</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-30">30</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-32">32</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-34">34</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-36">36</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-38">38</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-40">40</div><div class="crayon-num" data-line="crayon-5a65911012a8e030489667-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a8e030489667-42">42</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a8e030489667-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-v">to_categorical</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-6"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-7"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-10"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-11"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-12"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-14"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-15"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-16"><span class="crayon-h"> </span><span class="crayon-p"># define target sequence</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-17"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-18"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-19"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-20"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-21"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-22"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-23"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-24"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-25"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-26"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-27"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-28"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-30"> </div><div class="crayon-line" id="crayon-5a65911012a8e030489667-31"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-32"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-34"> </div><div class="crayon-line" id="crayon-5a65911012a8e030489667-35"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-36"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-37"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-38"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-39"><span class="crayon-p"># generate a single source and target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-40"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a8e030489667-41"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a8e030489667-42"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'X1=%s, X2=%s, y=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0032 seconds] -->
<p>Running the example first prints the shape of the generated dataset, ensuring the 3D shape required to train the model matches our expectations.</p>
<p>The generated sequence is then decoded and printed to screen demonstrating both that the preparation of source and target sequences matches our intention and that the decode operation is working.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a91689268102" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(1, 6, 51) (1, 3, 51) (1, 3, 51)
X1=[32, 16, 12, 34, 25, 24], X2=[0, 12, 16], y=[12, 16, 32]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a91689268102-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a91689268102-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a91689268102-1">(1, 6, 51) (1, 3, 51) (1, 3, 51)</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a91689268102-2">X1=[32, 16, 12, 34, 25, 24], X2=[0, 12, 16], y=[12, 16, 32]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We are now ready to develop a model for this sequence-to-sequence prediction problem.</p>
<h2>Encoder-Decoder LSTM for Sequence Prediction</h2>
<p>In this section, we will apply the encoder-decoder LSTM model developed in the first section to the sequence-to-sequence prediction problem developed in the second section.</p>
<p>The first step is to configure the problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a94187415746" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a94187415746-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a94187415746-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a94187415746-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a94187415746-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a94187415746-1"><span class="crayon-p"># configure problem</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a94187415746-2"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65911012a94187415746-3"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a94187415746-4"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we must define the models and compile the training model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a98543565786" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
train, infenc, infdec = define_models(n_features, n_features, 128)
train.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['acc'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a98543565786-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a98543565786-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a98543565786-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a98543565786-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a98543565786-2"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">128</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a98543565786-3"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Next, we can generate a training dataset of 100,000 examples and train the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012a9c871105366" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate training dataset
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 100000)
print(X1.shape,X2.shape,y.shape)
# train model
train.fit([X1, X2], y, epochs=1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012a9c871105366-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a9c871105366-2">2</div><div class="crayon-num" data-line="crayon-5a65911012a9c871105366-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012a9c871105366-4">4</div><div class="crayon-num" data-line="crayon-5a65911012a9c871105366-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012a9c871105366-1"><span class="crayon-p"># generate training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a9c871105366-2"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100000</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012a9c871105366-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012a9c871105366-4"><span class="crayon-p"># train model</span></div><div class="crayon-line" id="crayon-5a65911012a9c871105366-5"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Once the model is trained, we can evaluate it. We will do this by making predictions for 100 source sequences and counting the number of target sequences that were predicted correctly. We will use the numpy <em>array_equal()</em> function on the decoded sequences to check for equality.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012aa0641382512" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(target)):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012aa0641382512-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa0641382512-2">2</div><div class="crayon-num" data-line="crayon-5a65911012aa0641382512-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa0641382512-4">4</div><div class="crayon-num" data-line="crayon-5a65911012aa0641382512-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa0641382512-6">6</div><div class="crayon-num" data-line="crayon-5a65911012aa0641382512-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa0641382512-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012aa0641382512-1"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa0641382512-2"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5a65911012aa0641382512-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa0641382512-4"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa0641382512-5"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa0641382512-6"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa0641382512-7"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa0641382512-8"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Finally, we will generate some predictions and print the decoded source, target, and predicted target sequences to get an idea of whether the model is working as expected.</p>
<p>Putting all of these elements together, the complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012aa4516021396" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array
from numpy import argmax
from numpy import array_equal
from keras.utils import to_categorical
from keras.models import Model
from keras.layers import Input
from keras.layers import LSTM
from keras.layers import Dense

# generate a sequence of random integers
def generate_sequence(length, n_unique):
	return [randint(1, n_unique-1) for _ in range(length)]

# prepare data for the LSTM
def get_dataset(n_in, n_out, cardinality, n_samples):
	X1, X2, y = list(), list(), list()
	for _ in range(n_samples):
		# generate source sequence
		source = generate_sequence(n_in, cardinality)
		# define padded target sequence
		target = source[:n_out]
		target.reverse()
		# create padded input target sequence
		target_in = [0] + target[:-1]
		# encode
		src_encoded = to_categorical([source], num_classes=cardinality)
		tar_encoded = to_categorical([target], num_classes=cardinality)
		tar2_encoded = to_categorical([target_in], num_classes=cardinality)
		# store
		X1.append(src_encoded)
		X2.append(tar2_encoded)
		y.append(tar_encoded)
	return array(X1), array(X2), array(y)

# returns train, inference_encoder and inference_decoder models
def define_models(n_input, n_output, n_units):
	# define training encoder
	encoder_inputs = Input(shape=(None, n_input))
	encoder = LSTM(n_units, return_state=True)
	encoder_outputs, state_h, state_c = encoder(encoder_inputs)
	encoder_states = [state_h, state_c]
	# define training decoder
	decoder_inputs = Input(shape=(None, n_output))
	decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True)
	decoder_outputs, _, _ = decoder_lstm(decoder_inputs, initial_state=encoder_states)
	decoder_dense = Dense(n_output, activation='softmax')
	decoder_outputs = decoder_dense(decoder_outputs)
	model = Model([encoder_inputs, decoder_inputs], decoder_outputs)
	# define inference encoder
	encoder_model = Model(encoder_inputs, encoder_states)
	# define inference decoder
	decoder_state_input_h = Input(shape=(n_units,))
	decoder_state_input_c = Input(shape=(n_units,))
	decoder_states_inputs = [decoder_state_input_h, decoder_state_input_c]
	decoder_outputs, state_h, state_c = decoder_lstm(decoder_inputs, initial_state=decoder_states_inputs)
	decoder_states = [state_h, state_c]
	decoder_outputs = decoder_dense(decoder_outputs)
	decoder_model = Model([decoder_inputs] + decoder_states_inputs, [decoder_outputs] + decoder_states)
	# return all models
	return model, encoder_model, decoder_model

# generate target given source sequence
def predict_sequence(infenc, infdec, source, n_steps, cardinality):
	# encode
	state = infenc.predict(source)
	# start of sequence input
	target_seq = array([0.0 for _ in range(cardinality)]).reshape(1, 1, cardinality)
	# collect predictions
	output = list()
	for t in range(n_steps):
		# predict next char
		yhat, h, c = infdec.predict([target_seq] + state)
		# store prediction
		output.append(yhat[0,0,:])
		# update state
		state = [h, c]
		# update target sequence
		target_seq = yhat
	return array(output)

# decode a one hot encoded string
def one_hot_decode(encoded_seq):
	return [argmax(vector) for vector in encoded_seq]

# configure problem
n_features = 50 + 1
n_steps_in = 6
n_steps_out = 3
# define model
train, infenc, infdec = define_models(n_features, n_features, 128)
train.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['acc'])
# generate training dataset
X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 100000)
print(X1.shape,X2.shape,y.shape)
# train model
train.fit([X1, X2], y, epochs=1)
# evaluate LSTM
total, correct = 100, 0
for _ in range(total):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	if array_equal(one_hot_decode(y[0]), one_hot_decode(target)):
		correct += 1
print('Accuracy: %.2f%%' % (float(correct)/float(total)*100.0))
# spot check some examples
for _ in range(10):
	X1, X2, y = get_dataset(n_steps_in, n_steps_out, n_features, 1)
	target = predict_sequence(infenc, infdec, X1, n_steps_out, n_features)
	print('X=%s y=%s, yhat=%s' % (one_hot_decode(X1[0]), one_hot_decode(y[0]), one_hot_decode(target)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-2">2</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-4">4</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-6">6</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-8">8</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-10">10</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-12">12</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-14">14</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-16">16</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-18">18</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-20">20</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-22">22</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-24">24</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-26">26</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-28">28</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-30">30</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-32">32</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-34">34</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-36">36</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-38">38</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-40">40</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-42">42</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-44">44</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-46">46</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-48">48</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-50">50</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-52">52</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-54">54</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-56">56</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-58">58</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-60">60</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-62">62</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-64">64</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-66">66</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-68">68</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-70">70</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-72">72</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-74">74</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-76">76</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-78">78</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-80">80</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-82">82</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-84">84</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-86">86</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-88">88</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-90">90</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-92">92</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-94">94</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-96">96</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-98">98</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-100">100</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-102">102</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-104">104</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-106">106</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-108">108</div><div class="crayon-num" data-line="crayon-5a65911012aa4516021396-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012aa4516021396-110">110</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012aa4516021396-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">array_equal</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Model</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-10"> </div><div class="crayon-line" id="crayon-5a65911012aa4516021396-11"><span class="crayon-p"># generate a sequence of random integers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-12"><span class="crayon-e">def </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_unique</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-14"> </div><div class="crayon-line" id="crayon-5a65911012aa4516021396-15"><span class="crayon-p"># prepare data for the LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-16"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-17"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-18"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-19"><span class="crayon-h"> </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-20"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-21"><span class="crayon-h"> </span><span class="crayon-p"># define padded target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-22"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-23"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-24"><span class="crayon-h"> </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-25"><span class="crayon-h"> </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-26"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-27"><span class="crayon-h"> </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-28"><span class="crayon-h"> </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-29"><span class="crayon-h"> </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-30"><span class="crayon-h"> </span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-31"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-32"><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-33"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-34"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-35"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-36"><span class="crayon-p"># returns train, inference_encoder and inference_decoder models</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-37"><span class="crayon-e">def </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-38"><span class="crayon-h"> </span><span class="crayon-p"># define training encoder</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-39"><span class="crayon-h"> </span><span class="crayon-v">encoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-40"><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-41"><span class="crayon-h"> </span><span class="crayon-v">encoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encoder</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-42"><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-43"><span class="crayon-h"> </span><span class="crayon-p"># define training decoder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-44"><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">None</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_output</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-45"><span class="crayon-h"> </span><span class="crayon-v">decoder_lstm</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_state</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-46"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-47"><span class="crayon-h"> </span><span class="crayon-v">decoder_dense</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_output</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-48"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-50"><span class="crayon-h"> </span><span class="crayon-p"># define inference encoder</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-51"><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-v">encoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-52"><span class="crayon-h"> </span><span class="crayon-p"># define inference decoder</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-53"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-54"><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Input</span><span class="crayon-sy">(</span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-55"><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_state_input_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_state_input_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-56"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_lstm</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_state</span><span class="crayon-o">=</span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-57"><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">state_h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">state_c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-58"><span class="crayon-h"> </span><span class="crayon-v">decoder_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">decoder_dense</span><span class="crayon-sy">(</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-59"><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">decoder_inputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states_inputs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">decoder_outputs</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decoder_states</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-60"><span class="crayon-h"> </span><span class="crayon-p"># return all models</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-61"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoder_model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decoder_model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-62"> </div><div class="crayon-line" id="crayon-5a65911012aa4516021396-63"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-64"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-65"><span class="crayon-h"> </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-66"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-67"><span class="crayon-h"> </span><span class="crayon-p"># start of sequence input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-68"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0.0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-69"><span class="crayon-h"> </span><span class="crayon-p"># collect predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-70"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-71"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-72"><span class="crayon-h"> </span><span class="crayon-p"># predict next char</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-73"><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_seq</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-74"><span class="crayon-h"> </span><span class="crayon-p"># store prediction</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-75"><span class="crayon-h"> </span><span class="crayon-v">output</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-76"><span class="crayon-h"> </span><span class="crayon-p"># update state</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-77"><span class="crayon-h"> </span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">h</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-78"><span class="crayon-h"> </span><span class="crayon-p"># update target sequence</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-79"><span class="crayon-h"> </span><span class="crayon-v">target_seq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-80"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">output</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-82"><span class="crayon-p"># decode a one hot encoded string</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-83"><span class="crayon-e">def </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-84"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">encoded_seq</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-85"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-86"><span class="crayon-p"># configure problem</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-87"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-88"><span class="crayon-v">n_steps_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-89"><span class="crayon-v">n_steps_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-90"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-91"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_models</span><span class="crayon-sy">(</span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">128</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-92"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'acc'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-93"><span class="crayon-p"># generate training dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-94"><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100000</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-95"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-96"><span class="crayon-p"># train model</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-97"><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-98"><span class="crayon-p"># evaluate LSTM</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-99"><span class="crayon-v">total</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-100"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-101"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-102"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-103"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">array_equal</span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-104"><span class="crayon-h"> </span><span class="crayon-v">correct</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-105"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Accuracy: %.2f%%'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">correct</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-v">total</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-cn">100.0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-106"><span class="crayon-p"># spot check some examples</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-107"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-108"><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911012aa4516021396-109"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">infenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infdec</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012aa4516021396-110"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'X=%s y=%s, yhat=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_decode</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0139 seconds] -->
<p>Running the example first prints the shape of the prepared dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012aad704006569" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(100000, 6, 51) (100000, 3, 51) (100000, 3, 51)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012aad704006569-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012aad704006569-1">(100000, 6, 51) (100000, 3, 51) (100000, 3, 51)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, the model is fit. You should see a progress bar and the run should take less than one minute on a modern multi-core CPU.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012ab1896417561" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
100000/100000 [==============================] - 50s - loss: 0.6344 - acc: 0.7968</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012ab1896417561-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012ab1896417561-1">100000/100000 [==============================] - 50s - loss: 0.6344 - acc: 0.7968</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Next, the model is evaluated and the accuracy printed. We can see that the model achieves 100% accuracy on new randomly generated examples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012ab5185383800" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Accuracy: 100.00%</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012ab5185383800-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012ab5185383800-1">Accuracy: 100.00%</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Finally, 10 new examples are generated and target sequences are predicted. Again, we can see that the model correctly predicts the output sequence in each case and the expected value matches the reversed first 3 elements of the source sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911012ab8522468397" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
X=[22, 17, 23, 5, 29, 11] y=[23, 17, 22], yhat=[23, 17, 22]
X=[28, 2, 46, 12, 21, 6] y=[46, 2, 28], yhat=[46, 2, 28]
X=[12, 20, 45, 28, 18, 42] y=[45, 20, 12], yhat=[45, 20, 12]
X=[3, 43, 45, 4, 33, 27] y=[45, 43, 3], yhat=[45, 43, 3]
X=[34, 50, 21, 20, 11, 6] y=[21, 50, 34], yhat=[21, 50, 34]
X=[47, 42, 14, 2, 31, 6] y=[14, 42, 47], yhat=[14, 42, 47]
X=[20, 24, 34, 31, 37, 25] y=[34, 24, 20], yhat=[34, 24, 20]
X=[4, 35, 15, 14, 47, 33] y=[15, 35, 4], yhat=[15, 35, 4]
X=[20, 28, 21, 39, 5, 25] y=[21, 28, 20], yhat=[21, 28, 20]
X=[50, 38, 17, 25, 31, 48] y=[17, 38, 50], yhat=[17, 38, 50]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911012ab8522468397-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012ab8522468397-2">2</div><div class="crayon-num" data-line="crayon-5a65911012ab8522468397-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012ab8522468397-4">4</div><div class="crayon-num" data-line="crayon-5a65911012ab8522468397-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012ab8522468397-6">6</div><div class="crayon-num" data-line="crayon-5a65911012ab8522468397-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012ab8522468397-8">8</div><div class="crayon-num" data-line="crayon-5a65911012ab8522468397-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911012ab8522468397-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911012ab8522468397-1">X=[22, 17, 23, 5, 29, 11] y=[23, 17, 22], yhat=[23, 17, 22]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012ab8522468397-2">X=[28, 2, 46, 12, 21, 6] y=[46, 2, 28], yhat=[46, 2, 28]</div><div class="crayon-line" id="crayon-5a65911012ab8522468397-3">X=[12, 20, 45, 28, 18, 42] y=[45, 20, 12], yhat=[45, 20, 12]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012ab8522468397-4">X=[3, 43, 45, 4, 33, 27] y=[45, 43, 3], yhat=[45, 43, 3]</div><div class="crayon-line" id="crayon-5a65911012ab8522468397-5">X=[34, 50, 21, 20, 11, 6] y=[21, 50, 34], yhat=[21, 50, 34]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012ab8522468397-6">X=[47, 42, 14, 2, 31, 6] y=[14, 42, 47], yhat=[14, 42, 47]</div><div class="crayon-line" id="crayon-5a65911012ab8522468397-7">X=[20, 24, 34, 31, 37, 25] y=[34, 24, 20], yhat=[34, 24, 20]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012ab8522468397-8">X=[4, 35, 15, 14, 47, 33] y=[15, 35, 4], yhat=[15, 35, 4]</div><div class="crayon-line" id="crayon-5a65911012ab8522468397-9">X=[20, 28, 21, 39, 5, 25] y=[21, 28, 20], yhat=[21, 28, 20]</div><div class="crayon-line crayon-striped-line" id="crayon-5a65911012ab8522468397-10">X=[50, 38, 17, 25, 31, 48] y=[17, 38, 50], yhat=[17, 38, 50]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>You now have a template for an encoder-decoder LSTM model that you can apply to your own sequence-to-sequence prediction problems.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html">A ten-minute introduction to sequence-to-sequence learning in Keras</a></li>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/lstm_seq2seq.py">Keras seq2seq Code Example (lstm_seq2seq)</a></li>
<li><a href="https://keras.io/getting-started/functional-api-guide/">Keras Functional API</a></li>
<li><a href="https://keras.io/layers/recurrent/#lstm">LSTM API in Keras</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an encoder-decoder recurrent neural network for sequence-to-sequence prediction problems with Keras.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to correctly define a sophisticated encoder-decoder model in Keras for sequence-to-sequence prediction.</li>
<li>How to define a contrived yet scalable sequence-to-sequence prediction problem that you can use to evaluate the encoder-decoder LSTM model.</li>
<li>How to apply the encoder-decoder LSTM model in Keras to address the scalable integer sequence-to-sequence prediction problem.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-encoder-decoder-model-sequence-sequence-prediction-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20an%20Encoder-Decoder%20Model%20for%20Sequence-to-Sequence%20Prediction%20in%20Keras&amp;url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/&amp;summary=The+encoder-decoder+model+provides+a+pattern+for+using+recurrent+neural+networks+to+address+challeng...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/statistical-language-modeling-and-neural-language-models/" rel="prev"><i class="fa fa-angle-left"></i> Gentle Introduction to Statistical Language Modeling and Neural Language Models</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/develop-word-based-neural-language-models-python-keras/" rel="next">How to Develop Word-Based Neural Language Models in Python with Keras <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">27 Responses to <em>How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418805">
<div class="comment-container" id="li-comment-418805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8e1b745128d324ae58800448c40f5df6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8e1b745128d324ae58800448c40f5df6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alex</span>
<span class="date">November 2, 2017 at 7:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is this model suited for sequence regression too? For example the shampoo sales problem</p>
<div class="reply">
<a aria-label="Reply to Alex" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418805#respond" onclick='return addComment.moveForm( "comment-418805", "418805", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418834">
<div class="comment-container" id="li-comment-418834">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418834" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could try, but generally LSTMs do not perform well on autoregression problems:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418834#respond" onclick='return addComment.moveForm( "comment-418834", "418834", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418808">
<div class="comment-container" id="li-comment-418808">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7dcc5ad52d0ad82e7f381d1e1fe3d169?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7dcc5ad52d0ad82e7f381d1e1fe3d169?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Teimour</span>
<span class="date">November 2, 2017 at 9:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418808" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi. is it possible to have multi layers of LSTM in encoder and decoder in this code? thank you for your great blog</p>
<div class="reply">
<a aria-label="Reply to Teimour" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418808#respond" onclick='return addComment.moveForm( "comment-418808", "418808", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418836">
<div class="comment-container" id="li-comment-418836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but I don’t have an example. For this specific case it would require some careful re-design.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418836#respond" onclick='return addComment.moveForm( "comment-418836", "418836", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418813">
<div class="comment-container" id="li-comment-418813">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7d2717facbef20886a831b0178ab64dc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7d2717facbef20886a831b0178ab64dc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kyu</span>
<span class="date">November 3, 2017 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418813" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How can I extract the bottleneck layer to extract the important features with sequence data?</p>
<div class="reply">
<a aria-label="Reply to Kyu" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418813#respond" onclick='return addComment.moveForm( "comment-418813", "418813", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418840">
<div class="comment-container" id="li-comment-418840">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418840" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could access the returned states to get the context vector, but it does not help you understand which input features are relevant/important.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418840#respond" onclick='return addComment.moveForm( "comment-418840", "418840", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418826">
<div class="comment-container" id="li-comment-418826">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 3, 2017 at 4:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418826" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason!</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418826#respond" onclick='return addComment.moveForm( "comment-418826", "418826", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418846">
<div class="comment-container" id="li-comment-418846">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-418846" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=418846#respond" onclick='return addComment.moveForm( "comment-418846", "418846", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420395">
<div class="comment-container" id="li-comment-420395">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11a17e7e203917ae63837874f967aef0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harry Garrison</span>
<span class="date">November 18, 2017 at 3:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-420395" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the wonderful tutorial, Jason!<br/>
I am facing an issue, though: I tried to execute your code as is (copy-pasted it), but it throws an error:</p>
<p>Using TensorFlow backend.<br/>
Traceback (most recent call last):<br/>
  File “C:\Users\User\Documents\pystuff\keras_auto.py”, line 91, in<br/>
    train, infenc, infdec = define_models(n_features, n_features, 128)<br/>
  File “C:\Users\User\Documents\pystuff\keras_auto.py”, line 40, in define_models<br/>
    encoder = LSTM(n_units, return_state=True)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\legacy\interfaces.py”, line 88, in wrapper<br/>
    return func(*args, **kwargs)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\layers\recurrent.py”, line 949, in __init__<br/>
    super(LSTM, self).__init__(**kwargs)<br/>
  File C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\layers\recurrent.py”, line 191, in __init__<br/>
    super(Recurrent, self).__init__(**kwargs)<br/>
  File “C:\Users\User\Anaconda3\envs\py35\lib\site-packages\keras\engine\topology.py”, line 281, in __init__<br/>
    raise TypeError(‘Keyword argument not understood:’, kwarg)<br/>
TypeError: (‘Keyword argument not understood:’, ‘return_state’)</p>
<p>I am using an anaconda environment (python 3.5.3). What could have possibly gone wrong?</p>
<div class="reply">
<a aria-label="Reply to Harry Garrison" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=420395#respond" onclick='return addComment.moveForm( "comment-420395", "420395", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420431">
<div class="comment-container" id="li-comment-420431">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 18, 2017 at 10:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-420431" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps confirm that you have the most recent version of Keras and TensorFlow installed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=420431#respond" onclick='return addComment.moveForm( "comment-420431", "420431", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-422484">
<div class="comment-container" id="li-comment-422484">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carolyn</span>
<span class="date">December 8, 2017 at 12:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422484" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I had the same problem, and updated Keras (to version 2.1.2) and TensorFlow (to version 1.4.0). The problem above was solved. However, I now see that the shapes of X1, X2, and y are ((100000, 1, 6, 51), (100000, 1, 3, 51), (100000, 1, 3, 51)) instead of ((100000, 6, 51), (100000, 3, 51), (100000, 3, 51)). Why could this be?</p>
<div class="reply">
<a aria-label="Reply to Carolyn" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422484#respond" onclick='return addComment.moveForm( "comment-422484", "422484", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-422495">
<div class="comment-container" id="li-comment-422495">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 8, 2017 at 2:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422495" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m not sure, perhaps related to recent API changes in Keras?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422495#respond" onclick='return addComment.moveForm( "comment-422495", "422495", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-422521">
<div class="comment-container" id="li-comment-422521">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87caaed05117d32a58017ed3376224c0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Carolyn</span>
<span class="date">December 9, 2017 at 1:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422521" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here’s how I fixed the problem.</p>
<p>At the top of the code, include this line (before any ‘from numpy import’ statements:</p>
<p>import numpy as np</p>
<p>Change the get_dataset() function to the following:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65911014123903841883" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
def get_dataset(n_in, n_out, cardinality, n_samples):
        X1, X2, y = list(), list(), list()
        for _ in range(n_samples):
                # generate source sequence
                source = generate_sequence(n_in, cardinality)
                # define padded target sequence
                target = source[:n_out]
                target.reverse()
                # create padded input target sequence
                target_in = [0] + target[:-1]
                # encode
                src_encoded = to_categorical([source], num_classes=cardinality)
                tar_encoded = to_categorical([target], num_classes=cardinality)
                tar2_encoded = to_categorical([target_in], num_classes=cardinality)
                # store
                X1.append(src_encoded)
                X2.append(tar2_encoded)
                y.append(tar_encoded)
        X1 = np.squeeze(array(X1), axis=1) 
        X2 = np.squeeze(array(X2), axis=1) 
        y = np.squeeze(array(y), axis=1) 
        return X1, X2, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65911014123903841883-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-2">2</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-4">4</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-6">6</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-8">8</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-10">10</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-12">12</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-14">14</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-16">16</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-18">18</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-20">20</div><div class="crayon-num" data-line="crayon-5a65911014123903841883-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65911014123903841883-22">22</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65911014123903841883-1"><span class="crayon-e">def </span><span class="crayon-e">get_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-2"><span class="crayon-h">        </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-3"><span class="crayon-h">        </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-4"><span class="crayon-h">                </span><span class="crayon-p"># generate source sequence</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-5"><span class="crayon-h">                </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-6"><span class="crayon-h">                </span><span class="crayon-p"># define padded target sequence</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-7"><span class="crayon-h">                </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_out</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-8"><span class="crayon-h">                </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">reverse</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-9"><span class="crayon-h">                </span><span class="crayon-p"># create padded input target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-10"><span class="crayon-h">                </span><span class="crayon-v">target_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-11"><span class="crayon-h">                </span><span class="crayon-p"># encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-12"><span class="crayon-h">                </span><span class="crayon-v">src_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">source</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-13"><span class="crayon-h">                </span><span class="crayon-v">tar_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-14"><span class="crayon-h">                </span><span class="crayon-v">tar2_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">target_in</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">cardinality</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-15"><span class="crayon-h">                </span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-16"><span class="crayon-h">                </span><span class="crayon-v">X1</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">src_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-17"><span class="crayon-h">                </span><span class="crayon-v">X2</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar2_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-18"><span class="crayon-h">                </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tar_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65911014123903841883-19"><span class="crayon-h">        </span><span class="crayon-v">X1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-20"><span class="crayon-h">        </span><span class="crayon-v">X2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a65911014123903841883-21"><span class="crayon-h">        </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">squeeze</span><span class="crayon-sy">(</span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65911014123903841883-22"><span class="crayon-h">        </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0024 seconds] -->
<p></p>
<p>Notice instead of returning array(X1), array(X2), array(y), we now return arrays that have been squeezed – one axis has been removed. We remove axis 1 because it’s the wrong shape for what we need.</p>
<p>The output is now as it should be (although I’m getting 98% accuracy instead of 100%).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-422541">
<div class="comment-container" id="li-comment-422541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 9, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for sharing.</p>
<p>Perhaps confirm that you have updated Keras to 2.1.2, it fixes bugs with to_categorical()?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421212">
<div class="comment-container" id="li-comment-421212">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 26, 2017 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421212" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!<br/>
Are the encoder-decoder networks suitable for time series classification?</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=421212#respond" onclick='return addComment.moveForm( "comment-421212", "421212", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421277">
<div class="comment-container" id="li-comment-421277">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 27, 2017 at 5:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421277" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In my experience LSTMs have not proven effective at autoregression compared to MLPs.</p>
<p>See this post for more details:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=421277#respond" onclick='return addComment.moveForm( "comment-421277", "421277", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421754">
<div class="comment-container" id="li-comment-421754">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/21454ff208f6cf48e95b69020266fad5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/21454ff208f6cf48e95b69020266fad5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Python</span>
<span class="date">November 30, 2017 at 11:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421754" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
running the get_dataset the function returns one additional row in the Arrays X1, X2, y:<br/>
(1,1,6,51) (1,1,3,51)(1,1,3,51).<br/>
This results form numpy.array(), before the X1, X2, y are lists with the correct sizes:<br/>
(1,6,51) (1,3,51)(1,3,51).<br/>
It seems the comand array() adds an additional dimension. Could you help on solving this problem?</p>
<div class="reply">
<a aria-label="Reply to Python" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=421754#respond" onclick='return addComment.moveForm( "comment-421754", "421754", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421852">
<div class="comment-container" id="li-comment-421852">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/915cae986938189d008b8322a0da043a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">nandu</span>
<span class="date">December 1, 2017 at 6:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421852" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how to train the keras ,it has to identify capital letter and small letter has to same </p>
<p>Please suggest any tactics for it.</p>
<div class="reply">
<a aria-label="Reply to nandu" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=421852#respond" onclick='return addComment.moveForm( "comment-421852", "421852", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421906">
<div class="comment-container" id="li-comment-421906">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 2, 2017 at 8:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-421906" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Start by clearly defining your problem:<br/>
<a href="http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/" rel="nofollow">http://machinelearningmastery.com/how-to-define-your-machine-learning-problem/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=421906#respond" onclick='return addComment.moveForm( "comment-421906", "421906", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422332">
<div class="comment-container" id="li-comment-422332">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/826da901288894bd468a2a9d719bf598?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/826da901288894bd468a2a9d719bf598?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pritish Yuvraj</span>
<span class="date">December 7, 2017 at 4:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422332" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you please give me a tutorial for a case where we are input to the seq2seq model is word embeddings and outputs is also word embeddings. I find it frustrating to see a Dense layer at the end. this is what is stopping a fully seq2seq model with input as well as output word embeddings.</p>
<div class="reply">
<a aria-label="Reply to Pritish Yuvraj" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422332#respond" onclick='return addComment.moveForm( "comment-422332", "422332", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422363">
<div class="comment-container" id="li-comment-422363">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 7, 2017 at 8:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422363" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why would we have a word embedding at the output layer?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422363#respond" onclick='return addComment.moveForm( "comment-422363", "422363", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422922">
<div class="comment-container" id="li-comment-422922">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/74da881ad05a47d5dfb93c851b65f8d6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/74da881ad05a47d5dfb93c851b65f8d6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dinter</span>
<span class="date">December 13, 2017 at 12:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422922" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi ! When adding dropout and recurrent_dropout as LSTM arguments on line 40 of the last complete code example with everything else being the same, the code went wrong. So how can I add dropout in this case? Thanks!</p>
<div class="reply">
<a aria-label="Reply to Dinter" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422922#respond" onclick='return addComment.moveForm( "comment-422922", "422922", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422949">
<div class="comment-container" id="li-comment-422949">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-422949" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give a worked example of dropout with LSTMs here:<br/>
<a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=422949#respond" onclick='return addComment.moveForm( "comment-422949", "422949", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-426182">
<div class="comment-container" id="li-comment-426182">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dipesh</span>
<span class="date">January 11, 2018 at 6:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426182" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! Thanks for your great effort to put encoder decoder implementations here. As Dinter mentioned, when dropout is added, the code runs well for training phase but gives following error during prediction.</p>
<p>InvalidArgumentError (see above for traceback): You must feed a value for placeholder tensor ‘lstm_1/keras_learning_phase’ with dtype bool<br/>
	 [[Node: lstm_1/keras_learning_phase = Placeholder[dtype=DT_BOOL, shape=, _device=”/job:localhost/replica:0/task:0/cpu:0″]()]]</p>
<p>How to fix the problem in this particular implementation?</p>
<p>[Note: Your worked example of dropout however worked for me, but the difference is you are adding layer by layer in sequential model there which is different than this example of encoder decoder]</p>
<div class="reply">
<a aria-label="Reply to Dipesh" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=426182#respond" onclick='return addComment.moveForm( "comment-426182", "426182", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-426246">
<div class="comment-container" id="li-comment-426246">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426246" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry to hear that, perhaps it’s a bug? See if you can reproduce the fault on a small standalone network?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/?replytocom=426246#respond" onclick='return addComment.moveForm( "comment-426246", "426246", "respond", "4569" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-426703">
<div class="comment-container" id="li-comment-426703">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e522cbe33be1409cbdaa7061a65aa97c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dipesh Gautam</span>
<span class="date">January 17, 2018 at 6:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426703" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When I tried with exactly the same network in the example you presented and added dropout=0.0 in line 10 and line 15 of define_models function, the program runs but for other values of dropout it gives error. Also changing the size of network, for example, number of units to 5, 10, 20 does give the same error. </p>
<p>Any idea to add dropout?</p>
<p>line 5: encoder = LSTM(n_units, return_state=True,dropout=0.0)</p>
<p>line 10: decoder_lstm = LSTM(n_units, return_sequences=True, return_state=True,dropout=0.0)</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-426728">
<div class="comment-container" id="li-comment-426728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 17, 2018 at 10:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#comment-426728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this tutorial:<br/>
<a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-encoder-decoder-model-sequence-sequence-prediction-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4569"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="73417664e1"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="53"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>