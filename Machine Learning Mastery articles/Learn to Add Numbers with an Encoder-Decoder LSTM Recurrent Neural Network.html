<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network - Machine Learning Mastery" property="og:title"/>
<meta content="Long Short-Term Memory (LSTM) networks are a type of Recurrent Neural Network (RNN) that are capable of learning the relationships between elements in an input sequence. A good demonstration of LSTMs is to learn how to combine multiple terms together using a mathematical operation like a sum and outputting the result of the calculation. A …" property="og:description"/>
<meta content="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-05-19T05:00:25+11:00" property="article:published_time"/>
<meta content="2017-07-20T08:53:44+11:00" property="article:modified_time"/>
<meta content="2017-07-20T08:53:44+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Learn-to-Add-Numbers-with-seq2seq-Recurrent-Neural-Networks.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Learn-to-Add-Numbers-with-seq2seq-Recurrent-Neural-Networks.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="394" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/learn-add-numbers-seq2seq-recurrent-neural-networks\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/feed/" rel="alternate" title="Machine Learning Mastery » Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4001" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-add-numbers-seq2seq-recurrent-neural-networks%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-add-numbers-seq2seq-recurrent-neural-networks%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4001 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4001 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-05-19T05:00:25+1100">May 19, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-add-numbers-seq2seq-recurrent-neural-networks%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+networks+are+a+type+of+Recurrent+Neural+Network+%28RNN%29+that+are+capable..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+networks+are+a+type+of+Recurrent+Neural+Network+%28RNN%29+that+are+capable...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Long Short-Term Memory (LSTM) networks are a type of Recurrent Neural Network (RNN) that are capable of learning the relationships between elements in an input sequence.</p>
<p>A good demonstration of LSTMs is to learn how to combine multiple terms together using a mathematical operation like a sum and outputting the result of the calculation.</p>
<p>A common mistake made by beginners is to simply learn the mapping function from input term to the output term. A good demonstration of LSTMs on such a problem involves learning the sequenced input of characters (“50+11”) and predicting the sequence output in characters (“61”). This hard problem can be learned with LSTMs using the sequence-to-sequence, or seq2seq (encoder-decoder), stacked LSTM configuration.</p>
<p>In this tutorial, you will discover how to address the problem of adding sequences of randomly generated integers using LSTMs.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to learn the naive mapping function of input terms to output terms for addition.</li>
<li>How to frame the addition problem (and similar problems) and suitably encode inputs and outputs.</li>
<li>How to address the true sequence-prediction addition problem using the seq2seq paradigm.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4002" style="max-width: 650px"><img alt="How to Learn to Add Numbers with seq2seq Recurrent Neural Networks" class="size-full wp-image-4002" height="394" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Learn-to-Add-Numbers-with-seq2seq-Recurrent-Neural-Networks.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Learn-to-Add-Numbers-with-seq2seq-Recurrent-Neural-Networks.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/05/How-to-Learn-to-Add-Numbers-with-seq2seq-Recurrent-Neural-Networks-300x185.jpg 300w" width="640"/><p class="wp-caption-text">How to Learn to Add Numbers with seq2seq Recurrent Neural Networks<br/>Photo by <a href="https://www.flickr.com/photos/minhocos/11161305703/">Lima Pix</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 3 parts; they are:</p>
<ol>
<li>Adding Numbers</li>
<li>Addition as a Mapping Problem (the beginner’s mistake)</li>
<li>Addition as a seq2seq Problem</li>
</ol>
<h3>Environment</h3>
<p>This tutorial assumes a Python 2 or Python 3 development environment with SciPy, NumPy, Pandas installed.</p>
<p>The tutorial also assumes scikit-learn and Keras v2.0+ are installed with either the Theano or TensorFlow backend.</p>
<p>If you need help with your environment, see the post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<h2>Adding Numbers</h2>
<p>The task is that, given a sequence of randomly selected integers, to return the sum of those integers.</p>
<p>For example, given 10 + 5, the model should output 15.</p>
<p>The model is to be both trained and tested on randomly generated examples so that the general problem of adding numbers is learned, rather than memorization of specific cases.</p>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>Addition as a Mapping Problem<br/>
(the beginner’s mistake)</h2>
<p>In this section, we will work through the problem and solve it using an LSTM and show how easy it is to make the beginner’s mistake and not harness the power of recurrent neural networks.</p>
<h3>Data Generation</h3>
<p>Let’s start off by defining a function to generate sequences of random integers and their sum as training and test data.</p>
<p>We can use the <a href="https://docs.python.org/3/library/random.html">randint()</a> function to generate random integers between a min and max value, such as between 1 and 100. We can then sum the sequence. This process can be repeated for a fixed number of times to create pairs of input sequences of numbers and matching output summed values.</p>
<p>For example, this snippet will create 100 examples of adding 2 numbers between 1 and 100:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a754d318434676" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint

seed(1)
X, y = list(), list()
for i in range(100):
	in_pattern = [randint(1,100) for _ in range(2)]
	out_pattern = sum(in_pattern)
	print(in_pattern, out_pattern)
	X.append(in_pattern)
	y.append(out_pattern)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a754d318434676-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a754d318434676-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a754d318434676-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a754d318434676-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a754d318434676-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a754d318434676-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a754d318434676-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a754d318434676-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a754d318434676-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a754d318434676-4"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a754d318434676-5"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a754d318434676-6"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a754d318434676-7"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a754d318434676-8"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a754d318434676-9"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a754d318434676-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a754d318434676-11"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Running the example will print each input-output pair.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a755d247647928" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
[2, 97] 99
[97, 36] 133
[32, 35] 67
[15, 80] 95
[24, 45] 69
[38, 9] 47
[22, 21] 43</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a755d247647928-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a755d247647928-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a755d247647928-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a755d247647928-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a755d247647928-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a755d247647928-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a755d247647928-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a755d247647928-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a755d247647928-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a755d247647928-2">[2, 97] 99</div><div class="crayon-line" id="crayon-5a6586f2a755d247647928-3">[97, 36] 133</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a755d247647928-4">[32, 35] 67</div><div class="crayon-line" id="crayon-5a6586f2a755d247647928-5">[15, 80] 95</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a755d247647928-6">[24, 45] 69</div><div class="crayon-line" id="crayon-5a6586f2a755d247647928-7">[38, 9] 47</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a755d247647928-8">[22, 21] 43</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Once we have the patterns, we can convert the lists to NumPy Arrays and rescale the values. We must rescale the values to fit within the bounds of the activation used by the LSTM.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7562292794075" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# format as NumPy arrays
X,y = array(X), array(y)
# normalize
X = X.astype('float') / float(100 * 2)
y = y.astype('float') / float(100 * 2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7562292794075-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7562292794075-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7562292794075-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7562292794075-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7562292794075-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7562292794075-1"><span class="crayon-p"># format as NumPy arrays</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7562292794075-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7562292794075-3"><span class="crayon-p"># normalize</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7562292794075-4"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7562292794075-5"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Putting this all together, we can define the function <em>random_sum_pairs()</em> that takes a specified number of examples, a number of integers in each sequence, and the largest integer to generate and return X, y pairs of data for modeling.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7566885724977" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import randint
from numpy import array

# generate examples of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	# format as NumPy arrays
	X,y = array(X), array(y)
	# normalize
	X = X.astype('float') / float(largest * n_numbers)
	y = y.astype('float') / float(largest * n_numbers)
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7566885724977-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a7566885724977-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7566885724977-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-4"><span class="crayon-p"># generate examples of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-5"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-8"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-9"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-11"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-12"><span class="crayon-h"> </span><span class="crayon-p"># format as NumPy arrays</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-13"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-14"><span class="crayon-h"> </span><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-15"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7566885724977-16"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7566885724977-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0017 seconds] -->
<p>We may want to invert the rescaling of numbers later. This will be useful to compare predictions to expected values and get an idea of an error score in the same units as the original data.</p>
<p>The <em>invert()</em> function below inverts the normalization of predicted and expected values passed in.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a756a040577999" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert normalization
def invert(value, n_numbers, largest):
	return round(value * float(largest * n_numbers))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a756a040577999-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a756a040577999-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a756a040577999-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a756a040577999-1"><span class="crayon-p"># invert normalization</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a756a040577999-2"><span class="crayon-e">def </span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a756a040577999-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-e ">value *</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<h3>Configure LSTM</h3>
<p>We can now define an LSTM to model this problem.</p>
<p>It’s a relatively simple problem, so the model does not need to be very large. The input layer will expect 1 input feature and 2 time steps (in the case of adding two numbers).</p>
<p>Two hidden LSTM layers are defined, the first with 6 units and the second with 2 units, followed by a fully connected output layer that returns a single sum value.</p>
<p>The efficient ADAM optimization algorithm is used to fit the model along with the mean squared error loss function given the real valued output of the network.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a756f232728116" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create LSTM
model = Sequential()
model.add(LSTM(6, input_shape=(n_numbers, 1), return_sequences=True))
model.add(LSTM(6))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a756f232728116-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a756f232728116-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a756f232728116-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a756f232728116-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a756f232728116-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a756f232728116-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a756f232728116-1"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a756f232728116-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a756f232728116-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a756f232728116-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">6</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a756f232728116-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a756f232728116-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>The network is fit for 50 epochs, new examples are generated each epoch and weight updates are performed after every 2 examples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7573191313356" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train LSTM
for _ in range(n_epoch):
	X, y = random_sum_pairs(n_examples, n_numbers, largest)
	X = X.reshape(n_examples, n_numbers, 1)
	model.fit(X, y, epochs=1, batch_size=n_batch, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7573191313356-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7573191313356-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7573191313356-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7573191313356-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7573191313356-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7573191313356-1"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7573191313356-2"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a7573191313356-3"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7573191313356-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7573191313356-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<h3>LSTM Evaluation</h3>
<p>We evaluate the network on 100 new patterns.</p>
<p>These are generated and a sum value is predicted for each. Both the actual and predicted sum values are rescaled to the original range and a Root Mean Squared Error (RMSE) score is calculated that has the same scale as the original values. Finally, some 20 examples of expected and predicted values are listed as examples.</p>
<p>Finally, 20 examples of expected and predicted values are listed as examples.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7577511067575" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate on some new patterns
X, y = random_sum_pairs(n_examples, n_numbers, largest)
X = X.reshape(n_examples, n_numbers, 1)
result = model.predict(X, batch_size=n_batch, verbose=0)
# calculate error
expected = [invert(x, n_numbers, largest) for x in y]
predicted = [invert(x, n_numbers, largest) for x in result[:,0]]
rmse = sqrt(mean_squared_error(expected, predicted))
print('RMSE: %f' % rmse)
# show some examples
for i in range(20):
	error = expected[i] - predicted[i]
	print('Expected=%d, Predicted=%d (err=%d)' % (expected[i], predicted[i], error))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7577511067575-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a7577511067575-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7577511067575-1"><span class="crayon-p"># evaluate on some new patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-3"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-4"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-5"><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-6"><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-7"><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-8"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-10"><span class="crayon-p"># show some examples</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-11"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7577511067575-12"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a7577511067575-13"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected=%d, Predicted=%d (err=%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0019 seconds] -->
<p></p>
<h2>Complete Example</h2>
<p>We can tie this all together. The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75a3893320678" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from numpy import array
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
from sklearn.metrics import mean_squared_error

# generate examples of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	# format as NumPy arrays
	X,y = array(X), array(y)
	# normalize
	X = X.astype('float') / float(largest * n_numbers)
	y = y.astype('float') / float(largest * n_numbers)
	return X, y

# invert normalization
def invert(value, n_numbers, largest):
	return round(value * float(largest * n_numbers))

# generate training data
seed(1)
n_examples = 100
n_numbers = 2
largest = 100
# define LSTM configuration
n_batch = 1
n_epoch = 100
# create LSTM
model = Sequential()
model.add(LSTM(10, input_shape=(n_numbers, 1)))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
# train LSTM
for _ in range(n_epoch):
	X, y = random_sum_pairs(n_examples, n_numbers, largest)
	X = X.reshape(n_examples, n_numbers, 1)
	model.fit(X, y, epochs=1, batch_size=n_batch, verbose=2)
# evaluate on some new patterns
X, y = random_sum_pairs(n_examples, n_numbers, largest)
X = X.reshape(n_examples, n_numbers, 1)
result = model.predict(X, batch_size=n_batch, verbose=0)
# calculate error
expected = [invert(x, n_numbers, largest) for x in y]
predicted = [invert(x, n_numbers, largest) for x in result[:,0]]
rmse = sqrt(mean_squared_error(expected, predicted))
print('RMSE: %f' % rmse)
# show some examples
for i in range(20):
	error = expected[i] - predicted[i]
	print('Expected=%d, Predicted=%d (err=%d)' % (expected[i], predicted[i], error))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-42">42</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-44">44</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-46">46</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-48">48</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-50">50</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-52">52</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-54">54</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-56">56</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75a3893320678-58">58</div><div class="crayon-num" data-line="crayon-5a6586f2a75a3893320678-59">59</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-7"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-10"><span class="crayon-p"># generate examples of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-11"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-14"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-15"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-16"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-17"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-18"><span class="crayon-h"> </span><span class="crayon-p"># format as NumPy arrays</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-19"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-20"><span class="crayon-h"> </span><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-21"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-22"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-24"> </div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-25"><span class="crayon-p"># invert normalization</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-26"><span class="crayon-e">def </span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-e ">value *</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-28"> </div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-29"><span class="crayon-p"># generate training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-30"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-31"><span class="crayon-v">n_examples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-32"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-33"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-34"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-35"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-36"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-37"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-38"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-39"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-42"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-43"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-44"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-45"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-46"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-47"><span class="crayon-p"># evaluate on some new patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-48"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-49"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-50"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-51"><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-52"><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-53"><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-54"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-55"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-56"><span class="crayon-p"># show some examples</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-57"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75a3893320678-58"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75a3893320678-59"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected=%d, Predicted=%d (err=%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0056 seconds] -->
<p>Running the example prints some loss information each epoch and finishes by printing the RMSE for the run and some example outputs.</p>
<p>The results are not perfect, but many examples are predicted correctly.</p>
<p>Your specific outputs may differ given the stochastic nature of neural networks.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75ad790055008" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
RMSE: 0.565685
Expected=110, Predicted=110 (err=0)
Expected=122, Predicted=123 (err=-1)
Expected=104, Predicted=104 (err=0)
Expected=103, Predicted=103 (err=0)
Expected=163, Predicted=163 (err=0)
Expected=100, Predicted=100 (err=0)
Expected=56, Predicted=57 (err=-1)
Expected=61, Predicted=62 (err=-1)
Expected=109, Predicted=109 (err=0)
Expected=129, Predicted=130 (err=-1)
Expected=98, Predicted=98 (err=0)
Expected=60, Predicted=61 (err=-1)
Expected=66, Predicted=67 (err=-1)
Expected=63, Predicted=63 (err=0)
Expected=84, Predicted=84 (err=0)
Expected=148, Predicted=149 (err=-1)
Expected=96, Predicted=96 (err=0)
Expected=33, Predicted=34 (err=-1)
Expected=75, Predicted=75 (err=0)
Expected=64, Predicted=64 (err=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ad790055008-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75ad790055008-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-1">RMSE: 0.565685</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-2">Expected=110, Predicted=110 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-3">Expected=122, Predicted=123 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-4">Expected=104, Predicted=104 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-5">Expected=103, Predicted=103 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-6">Expected=163, Predicted=163 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-7">Expected=100, Predicted=100 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-8">Expected=56, Predicted=57 (err=-1)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-9">Expected=61, Predicted=62 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-10">Expected=109, Predicted=109 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-11">Expected=129, Predicted=130 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-12">Expected=98, Predicted=98 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-13">Expected=60, Predicted=61 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-14">Expected=66, Predicted=67 (err=-1)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-15">Expected=63, Predicted=63 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-16">Expected=84, Predicted=84 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-17">Expected=148, Predicted=149 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-18">Expected=96, Predicted=96 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-19">Expected=33, Predicted=34 (err=-1)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ad790055008-20">Expected=75, Predicted=75 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75ad790055008-21">Expected=64, Predicted=64 (err=0)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>The Beginner’s Mistake</h3>
<p>All done, right?</p>
<p>Wrong.</p>
<p>The problem we have solved had multiple inputs but was technically not a sequence prediction problem.</p>
<p>In fact, you can just as easily solve it using a multilayer Perceptron (MLP). For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75b2294037868" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from numpy import array
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from math import sqrt
from sklearn.metrics import mean_squared_error

# generate examples of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	# format as NumPy arrays
	X,y = array(X), array(y)
	# normalize
	X = X.astype('float') / float(largest * n_numbers)
	y = y.astype('float') / float(largest * n_numbers)
	return X, y

# invert normalization
def invert(value, n_numbers, largest):
	return round(value * float(largest * n_numbers))

# generate training data
seed(1)
n_examples = 100
n_numbers = 2
largest = 100
# define LSTM configuration
n_batch = 2
n_epoch = 50
# create LSTM
model = Sequential()
model.add(Dense(4, input_dim=n_numbers))
model.add(Dense(2))
model.add(Dense(1))
model.compile(loss='mean_squared_error', optimizer='adam')
# train LSTM
for _ in range(n_epoch):
	X, y = random_sum_pairs(n_examples, n_numbers, largest)
	model.fit(X, y, epochs=1, batch_size=n_batch, verbose=2)
# evaluate on some new patterns
X, y = random_sum_pairs(n_examples, n_numbers, largest)
result = model.predict(X, batch_size=n_batch, verbose=0)
# calculate error
expected = [invert(x, n_numbers, largest) for x in y]
predicted = [invert(x, n_numbers, largest) for x in result[:,0]]
rmse = sqrt(mean_squared_error(expected, predicted))
print('RMSE: %f' % rmse)
# show some examples
for i in range(20):
	error = expected[i] - predicted[i]
	print('Expected=%d, Predicted=%d (err=%d)' % (expected[i], predicted[i], error))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-42">42</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-44">44</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-46">46</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-48">48</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-50">50</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-52">52</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-54">54</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-56">56</div><div class="crayon-num" data-line="crayon-5a6586f2a75b2294037868-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b2294037868-58">58</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-7"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-v">mean_squared_error</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-10"><span class="crayon-p"># generate examples of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-11"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-13"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-14"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-15"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-16"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-17"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-18"><span class="crayon-h"> </span><span class="crayon-p"># format as NumPy arrays</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-19"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-20"><span class="crayon-h"> </span><span class="crayon-p"># normalize</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-21"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-22"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-24"> </div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-25"><span class="crayon-p"># invert normalization</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-26"><span class="crayon-e">def </span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">value</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-e ">value *</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-sy">(</span><span class="crayon-e ">largest *</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-28"> </div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-29"><span class="crayon-p"># generate training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-30"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-31"><span class="crayon-v">n_examples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-32"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-33"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-34"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-35"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-36"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-37"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-38"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-39"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_dim</span><span class="crayon-o">=</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-40"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-41"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-42"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mean_squared_error'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-43"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-44"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-45"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-46"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-47"><span class="crayon-p"># evaluate on some new patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-48"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-49"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-50"><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-51"><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-52"><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-53"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-54"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'RMSE: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-55"><span class="crayon-p"># show some examples</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-56"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75b2294037868-57"><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b2294037868-58"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected=%d, Predicted=%d (err=%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0052 seconds] -->
<p>Running the example solves the problem perfectly, and in fewer epochs.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75b7917925443" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
RMSE: 0.000000
Expected=108, Predicted=108 (err=0)
Expected=143, Predicted=143 (err=0)
Expected=109, Predicted=109 (err=0)
Expected=16, Predicted=16 (err=0)
Expected=152, Predicted=152 (err=0)
Expected=59, Predicted=59 (err=0)
Expected=95, Predicted=95 (err=0)
Expected=113, Predicted=113 (err=0)
Expected=90, Predicted=90 (err=0)
Expected=104, Predicted=104 (err=0)
Expected=123, Predicted=123 (err=0)
Expected=92, Predicted=92 (err=0)
Expected=150, Predicted=150 (err=0)
Expected=136, Predicted=136 (err=0)
Expected=130, Predicted=130 (err=0)
Expected=76, Predicted=76 (err=0)
Expected=112, Predicted=112 (err=0)
Expected=129, Predicted=129 (err=0)
Expected=171, Predicted=171 (err=0)
Expected=127, Predicted=127 (err=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75b7917925443-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75b7917925443-21">21</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-1">RMSE: 0.000000</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-2">Expected=108, Predicted=108 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-3">Expected=143, Predicted=143 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-4">Expected=109, Predicted=109 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-5">Expected=16, Predicted=16 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-6">Expected=152, Predicted=152 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-7">Expected=59, Predicted=59 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-8">Expected=95, Predicted=95 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-9">Expected=113, Predicted=113 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-10">Expected=90, Predicted=90 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-11">Expected=104, Predicted=104 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-12">Expected=123, Predicted=123 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-13">Expected=92, Predicted=92 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-14">Expected=150, Predicted=150 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-15">Expected=136, Predicted=136 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-16">Expected=130, Predicted=130 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-17">Expected=76, Predicted=76 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-18">Expected=112, Predicted=112 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-19">Expected=129, Predicted=129 (err=0)</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75b7917925443-20">Expected=171, Predicted=171 (err=0)</div><div class="crayon-line" id="crayon-5a6586f2a75b7917925443-21">Expected=127, Predicted=127 (err=0)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The issue is that we encoded so much of the domain into the problem that it turned the problem from a sequence prediction problem into a function mapping problem.</p>
<p>That is, the order of the input no longer matters. We could shuffle it up any way we want and still learn the problem.</p>
<p>MLPs are designed to learn mapping functions and can easily nail the problem of learning how to add numbers.</p>
<p>On one hand, this is a better way to approach the specific problem of adding numbers because the model is simpler and the results are better. On the other, it is a terrible use of recurrent neural networks.</p>
<p>This is a beginner’s mistake I see replicated in many “<em>introduction to LSTMs</em>” around the web.</p>
<h2>Addition as a Sequence Prediction Problem</h2>
<p>There is another way to frame addition that makes it an unambiguous sequence prediction problem, and in turn makes it much harder to solve.</p>
<p>We can frame addition as an input and output string of characters and let the model figure out the meaning of the characters. The entire addition problem can be framed as a string of characters, such as “12+50” with the output “62”, or more specifically:</p>
<ul>
<li>Input: [‘1’, ‘2’, ‘+’, ‘5’, ‘0’]</li>
<li>Output: [‘6’, ‘2’]</li>
</ul>
<p>The model must learn not only the integer nature of the characters, but also the nature of the mathematical operation to perform.</p>
<p>Notice how sequence is now important, and that randomly shuffling the input will create a nonsense sequence that could not be related to the output sequence.</p>
<p>Also notice how the problem has transformed to have both an input and an output sequence. This is called a sequence-to-sequence prediction problem, or a seq2seq problem.</p>
<p>We can keep things simple with addition of two numbers, but we can see how this may be scaled to a variable number of terms and mathematical operations that could be given as input for the model to learn and generalize.</p>
<p>Note that this formation and the rest of this example is inspired by the <a href="https://github.com/fchollet/keras/blob/master/examples/addition_rnn.py">addition seq2seq example</a> in the Keras project, although I re-developed it from the ground up.</p>
<h3>Data Generation</h3>
<p>Data generation for the seq2seq definition of the problem is a lot more involved.</p>
<p>We will develop each piece as a standalone function so you can play with them and understand how they work. Hang in there.</p>
<p>The first step is to generate sequences of random integers and their sum, as before, but with no normalization. We can put this in a function named <em>random_sum_pairs()</em>, as follows.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75be701265224" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint

# generate lists of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	return X, y

seed(1)
n_samples = 1
n_numbers = 2
largest = 10
# generate pairs
X, y = random_sum_pairs(n_samples, n_numbers, largest)
print(X, y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75be701265224-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75be701265224-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75be701265224-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-v">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-4"><span class="crayon-p"># generate lists of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-5"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-8"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-9"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-11"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">y</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-14"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-15"><span class="crayon-v">n_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-16"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-17"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-18"><span class="crayon-p"># generate pairs</span></div><div class="crayon-line" id="crayon-5a6586f2a75be701265224-19"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75be701265224-20"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running just this function prints a single example of adding two random integers between 1 and 10.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75c2529871447" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[[3, 10]] [13]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75c2529871447-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75c2529871447-1">[[3, 10]] [13]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The next step is to convert the integers to strings. The input string will have the format ’99+99′ and the output string will have the format ’99’.</p>
<p>Key to this function is the padding of numbers to ensure that each input and output sequence has the same number of characters. A padding character should be different from the data so the model can learn to ignore them. In this case, we use the space character for padding(‘ ‘) and pad the string on the left, keeping the information on the far right.</p>
<p>There are other ways to pad, such as padding each term individually. Try it and see if it results in better performance. Report your results in the comments below.</p>
<p>Padding requires we know how long the longest sequence may be. We can calculate this easily by taking the <em>log10()</em> of the largest integer we can generate and the ceiling of that number to get an idea of how many chars are needed for each number. We add 1 to the largest number to ensure we expect 3 chars instead of 2 chars for the case of a round largest number, like 200. We then need to add the right number of plus symbols.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75c6059367121" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
max_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75c6059367121-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75c6059367121-1"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>A similar process is repeated on the output sequence, without the plus symbols of course.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75ca409991232" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
max_length = ceil(log10(n_numbers * (largest+1)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75ca409991232-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75ca409991232-1"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The example below adds the <em>to_string()</em> function and demonstrates its usage with a single input/output pair.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75ce248490855" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from math import ceil
from math import log10

# generate lists of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	return X, y

# convert data to strings
def to_string(X, y, n_numbers, largest):
	max_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1
	Xstr = list()
	for pattern in X:
		strp = '+'.join([str(n) for n in pattern])
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		Xstr.append(strp)
	max_length = ceil(log10(n_numbers * (largest+1)))
	ystr = list()
	for pattern in y:
		strp = str(pattern)
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		ystr.append(strp)
	return Xstr, ystr

seed(1)
n_samples = 1
n_numbers = 2
largest = 10
# generate pairs
X, y = random_sum_pairs(n_samples, n_numbers, largest)
print(X, y)
# convert to strings
X, y = to_string(X, y, n_numbers, largest)
print(X, y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ce248490855-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a75ce248490855-41">41</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-3"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">ceil</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-4"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-v">log10</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-6"><span class="crayon-p"># generate lists of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-7"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-10"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-11"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-13"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-16"><span class="crayon-p"># convert data to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-17"><span class="crayon-e">def </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-18"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-19"><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-21"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-22"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-23"><span class="crayon-e"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-24"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-25"><span class="crayon-h"> </span><span class="crayon-v">ystr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-26"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-27"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-28"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-29"><span class="crayon-e"> </span><span class="crayon-v">ystr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">ystr</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-32"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-33"><span class="crayon-v">n_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-34"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-35"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-36"><span class="crayon-p"># generate pairs</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-37"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-38"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-39"><span class="crayon-p"># convert to strings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ce248490855-40"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ce248490855-41"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0042 seconds] -->
<p>Running this example first prints the integer sequence and the padded string representation of the same sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75d3494189209" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[[3, 10]] [13]
[' 3+10'] ['13']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75d3494189209-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75d3494189209-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75d3494189209-1">[[3, 10]] [13]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75d3494189209-2">[' 3+10'] ['13']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, we need to encode each character in the string as an integer value. We have to work with numbers in neural networks after all, not characters.</p>
<p>Integer encoding transforms the problem into a classification problem, where the output sequence may be considered class outputs with 11 possible values each. This just so happens to be integers with some ordinal relationship (first 10 class values).</p>
<p>To perform this encoding, we must define the full alphabet of symbols that may appear in the string encoding, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75d7486915859" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
alphabet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', ' ']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75d7486915859-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75d7486915859-1"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'4'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'5'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'6'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'8'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'9'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Integer encoding then becomes a simple process of building a lookup table of character to integer offset and converting each char of each string, one by one.</p>
<p>The example below provides the <em>integer_encode()</em> function for integer encoding and demonstrates how to use it.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75db946814029" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from math import ceil
from math import log10

# generate lists of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	return X, y

# convert data to strings
def to_string(X, y, n_numbers, largest):
	max_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1
	Xstr = list()
	for pattern in X:
		strp = '+'.join([str(n) for n in pattern])
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		Xstr.append(strp)
	max_length = ceil(log10(n_numbers * (largest+1)))
	ystr = list()
	for pattern in y:
		strp = str(pattern)
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		ystr.append(strp)
	return Xstr, ystr

# integer encode strings
def integer_encode(X, y, alphabet):
	char_to_int = dict((c, i) for i, c in enumerate(alphabet))
	Xenc = list()
	for pattern in X:
		integer_encoded = [char_to_int[char] for char in pattern]
		Xenc.append(integer_encoded)
	yenc = list()
	for pattern in y:
		integer_encoded = [char_to_int[char] for char in pattern]
		yenc.append(integer_encoded)
	return Xenc, yenc

seed(1)
n_samples = 1
n_numbers = 2
largest = 10
# generate pairs
X, y = random_sum_pairs(n_samples, n_numbers, largest)
print(X, y)
# convert to strings
X, y = to_string(X, y, n_numbers, largest)
print(X, y)
# integer encode
alphabet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', ' ']
X, y = integer_encode(X, y, alphabet)
print(X, y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-42">42</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-44">44</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-46">46</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-48">48</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-50">50</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-52">52</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-54">54</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-56">56</div><div class="crayon-num" data-line="crayon-5a6586f2a75db946814029-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75db946814029-58">58</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75db946814029-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-3"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">ceil</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-4"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-v">log10</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-6"><span class="crayon-p"># generate lists of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-7"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-10"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-11"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-13"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-16"><span class="crayon-p"># convert data to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-17"><span class="crayon-e">def </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-18"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-19"><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-21"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-22"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-23"><span class="crayon-e"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-24"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-25"><span class="crayon-h"> </span><span class="crayon-v">ystr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-26"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-27"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-28"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-29"><span class="crayon-e"> </span><span class="crayon-v">ystr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ystr</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-32"><span class="crayon-p"># integer encode strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-33"><span class="crayon-e">def </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-34"><span class="crayon-h"> </span><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-35"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-36"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-37"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-38"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-39"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-41"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-42"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">yenc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-44"> </div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-45"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-46"><span class="crayon-v">n_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-47"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-48"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-49"><span class="crayon-p"># generate pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-50"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-51"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-52"><span class="crayon-p"># convert to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-53"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-54"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-55"><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-56"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'4'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'5'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'6'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'8'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'9'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75db946814029-57"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75db946814029-58"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0055 seconds] -->
<p>Running the example prints the integer encoded version of each string encoded pattern.</p>
<p>We can see that the space character (‘ ‘) was encoded with 11 and the three character (‘3’) was encoded as 3, and so on.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75e0683804050" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[[3, 10]] [13]
[' 3+10'] ['13']
[[11, 3, 10, 1, 0]] [[1, 3]]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75e0683804050-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75e0683804050-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75e0683804050-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75e0683804050-1">[[3, 10]] [13]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75e0683804050-2">[' 3+10'] ['13']</div><div class="crayon-line" id="crayon-5a6586f2a75e0683804050-3">[[11, 3, 10, 1, 0]] [[1, 3]]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The next step is to binary encode the integer encoding sequences.</p>
<p>This involves converting each integer to a binary vector with the same length as the alphabet and marking the specific integer with a 1.</p>
<p>For example, a 0 integer represents the ‘0’ character and would be encoded as a binary vector with a 1 in the 0th position of an 11 element vector: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].</p>
<p>The example below defines the <em>one_hot_encode()</em> function for binary encoding and demonstrates how to use it.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75ea187001544" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from math import ceil
from math import log10

# generate lists of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	return X, y

# convert data to strings
def to_string(X, y, n_numbers, largest):
	max_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1
	Xstr = list()
	for pattern in X:
		strp = '+'.join([str(n) for n in pattern])
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		Xstr.append(strp)
	max_length = ceil(log10(n_numbers * (largest+1)))
	ystr = list()
	for pattern in y:
		strp = str(pattern)
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		ystr.append(strp)
	return Xstr, ystr

# integer encode strings
def integer_encode(X, y, alphabet):
	char_to_int = dict((c, i) for i, c in enumerate(alphabet))
	Xenc = list()
	for pattern in X:
		integer_encoded = [char_to_int[char] for char in pattern]
		Xenc.append(integer_encoded)
	yenc = list()
	for pattern in y:
		integer_encoded = [char_to_int[char] for char in pattern]
		yenc.append(integer_encoded)
	return Xenc, yenc

# one hot encode
def one_hot_encode(X, y, max_int):
	Xenc = list()
	for seq in X:
		pattern = list()
		for index in seq:
			vector = [0 for _ in range(max_int)]
			vector[index] = 1
			pattern.append(vector)
		Xenc.append(pattern)
	yenc = list()
	for seq in y:
		pattern = list()
		for index in seq:
			vector = [0 for _ in range(max_int)]
			vector[index] = 1
			pattern.append(vector)
		yenc.append(pattern)
	return Xenc, yenc

seed(1)
n_samples = 1
n_numbers = 2
largest = 10
# generate pairs
X, y = random_sum_pairs(n_samples, n_numbers, largest)
print(X, y)
# convert to strings
X, y = to_string(X, y, n_numbers, largest)
print(X, y)
# integer encode
alphabet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', ' ']
X, y = integer_encode(X, y, alphabet)
print(X, y)
# one hot encode
X, y = one_hot_encode(X, y, len(alphabet))
print(X, y)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-42">42</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-44">44</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-46">46</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-48">48</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-50">50</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-52">52</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-54">54</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-56">56</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-58">58</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-60">60</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-62">62</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-64">64</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-66">66</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-68">68</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-70">70</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-72">72</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-74">74</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-76">76</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-78">78</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75ea187001544-80">80</div><div class="crayon-num" data-line="crayon-5a6586f2a75ea187001544-81">81</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-3"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">ceil</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-4"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-v">log10</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-6"><span class="crayon-p"># generate lists of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-7"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-10"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-11"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-13"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-16"><span class="crayon-p"># convert data to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-17"><span class="crayon-e">def </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-18"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-19"><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-21"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-22"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-23"><span class="crayon-e"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-24"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-25"><span class="crayon-h"> </span><span class="crayon-v">ystr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-26"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-27"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-28"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-29"><span class="crayon-e"> </span><span class="crayon-v">ystr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ystr</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-32"><span class="crayon-p"># integer encode strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-33"><span class="crayon-e">def </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-34"><span class="crayon-h"> </span><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-35"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-36"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-37"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-38"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-39"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-41"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-42"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-43"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yenc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-44"> </div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-45"><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-46"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-47"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-48"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">seq </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-49"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-50"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-51"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-52"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-53"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-54"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-55"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-56"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">seq </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-57"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-58"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-59"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-60"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-61"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-62"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-63"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">yenc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-64"> </div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-65"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-66"><span class="crayon-v">n_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-67"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-68"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-69"><span class="crayon-p"># generate pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-70"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-71"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-72"><span class="crayon-p"># convert to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-73"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-74"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-75"><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-76"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'4'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'5'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'6'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'8'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'9'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-77"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-78"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-79"><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75ea187001544-80"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75ea187001544-81"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>Running the example prints the binary encoded sequence for each integer encoding.</p>
<p>I’ve added some new lines to make the input and output binary encodings clearer.</p>
<p>You can see that a single sum pattern becomes a sequence of 5 binary encoded vectors, each with 11 elements. The output or sum becomes a sequence of 2 binary encoded vectors, again each with 11 elements.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75f1149550473" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[[3, 10]] [13]
[' 3+10'] ['13']
[[11, 3, 10, 1, 0]] [[1, 3]]
[[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
  [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
  [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]
 [[[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
   [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]]]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75f1149550473-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f1149550473-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75f1149550473-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f1149550473-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75f1149550473-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f1149550473-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75f1149550473-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f1149550473-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75f1149550473-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f1149550473-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75f1149550473-1">[[3, 10]] [13]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f1149550473-2">[' 3+10'] ['13']</div><div class="crayon-line" id="crayon-5a6586f2a75f1149550473-3">[[11, 3, 10, 1, 0]] [[1, 3]]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f1149550473-4">[[[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],</div><div class="crayon-line" id="crayon-5a6586f2a75f1149550473-5">  [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f1149550473-6">  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],</div><div class="crayon-line" id="crayon-5a6586f2a75f1149550473-7">  [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f1149550473-8">  [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]</div><div class="crayon-line" id="crayon-5a6586f2a75f1149550473-9"> [[[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f1149550473-10">   [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]]]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can tie all of these steps together into a function called <em>generate_data()</em>, listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75f6075958283" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate an encoded dataset
def generate_data(n_samples, n_numbers, largest, alphabet):
	# generate pairs
	X, y = random_sum_pairs(n_samples, n_numbers, largest)
	# convert to strings
	X, y = to_string(X, y, n_numbers, largest)
	# integer encode
	X, y = integer_encode(X, y, alphabet)
	# one hot encode
	X, y = one_hot_encode(X, y, len(alphabet))
	# return as numpy arrays
	X, y = array(X), array(y)
	return X, y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75f6075958283-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a75f6075958283-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-1"><span class="crayon-p"># generate an encoded dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-2"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-3"><span class="crayon-h"> </span><span class="crayon-p"># generate pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-5"><span class="crayon-h"> </span><span class="crayon-p"># convert to strings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-7"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-8"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-9"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-10"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-11"><span class="crayon-h"> </span><span class="crayon-p"># return as numpy arrays</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75f6075958283-12"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75f6075958283-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>Finally, we need to invert the encoding to convert the output vectors back into numbers so we can compare expected output integers to predicted integers.</p>
<p>The <em>invert()</em> function below performs this operation. Key is first converting the binary encoding back into an integer using the <em>argmax()</em> function, then converting the integer back into a character using a reverse mapping of the integers to chars from the alphabet.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a75fb711081143" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert encoding
def invert(seq, alphabet):
	int_to_char = dict((i, c) for i, c in enumerate(alphabet))
	strings = list()
	for pattern in seq:
		string = int_to_char[argmax(pattern)]
		strings.append(string)
	return ''.join(strings)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a75fb711081143-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75fb711081143-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a75fb711081143-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75fb711081143-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a75fb711081143-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75fb711081143-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a75fb711081143-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a75fb711081143-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a75fb711081143-1"><span class="crayon-p"># invert encoding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75fb711081143-2"><span class="crayon-e">def </span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a75fb711081143-3"><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75fb711081143-4"><span class="crayon-h"> </span><span class="crayon-v">strings</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a75fb711081143-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75fb711081143-6"><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a75fb711081143-7"><span class="crayon-h"> </span><span class="crayon-v">strings</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a75fb711081143-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">strings</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>We now have everything we need to prepare data for this example.</p>
<p>Note, these functions were written for this post and I did not write any unit tests nor battle test them with all kinds of inputs. If you see or find an obvious bug, please let me know in the comments below.</p>
<h3>Configure and Fit a seq2seq LSTM Model</h3>
<p>We can now fit an LSTM model to this problem.</p>
<p>We can think of the model as being comprised of two key parts: the encoder and the decoder.</p>
<p>First, the input sequence is shown to the network one encoded character at a time. We need an encoding level to learn the relationship between the steps in the input sequence and develop an internal representation of these relationships.</p>
<p>The input to the network (for the two number case) is a series of 5 encoded characters (2 for each integer and one for the ‘+’) where each vector contains 11 features for the 11 possible characters that each item in the sequence may be.</p>
<p>The encoder will use a single LSTM hidden layer with 100 units.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7600148185291" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model = Sequential()
model.add(LSTM(100, input_shape=(5, 11)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7600148185291-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7600148185291-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7600148185291-1"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7600148185291-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The decoder must transform the learned internal representation of the input sequence into the correct output sequence. For this, we will use a hidden layer LSTM with 50 units, followed by an output layer.</p>
<p>The problem is defined as requiring two binary output vectors for the two output characters. We will use the same fully connected layer (Dense) to output each binary vector. To use the same layer twice, we will wrap it in a TimeDistributed() wrapper layer.</p>
<p>The output fully connected layer will use a <a href="https://en.wikipedia.org/wiki/Softmax_function">softmax activation function</a> to output values in the range [0,1].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7604012578064" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(50, return_sequences=True))
model.add(TimeDistributed(Dense(11, activation='softmax')))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7604012578064-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7604012578064-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7604012578064-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7604012578064-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>There’s a problem though.</p>
<p>We must connect the encoder to the decoder and they do not fit.</p>
<p>That is, the encoder will produce a 2-dimensional matrix of 100 outputs for each input in the sequence of 5 vectors. The decoder is an LSTM layer that expects a 3D input of [samples, timesteps, features] in order to produce a decoded sequence of 1 sample with 2 timesteps each with 11 features.</p>
<p>If you try to force these pieces together, you get an error like:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7609577553818" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
ValueError: Input 0 is incompatible with layer lstm_2: expected ndim=3, found ndim=2</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7609577553818-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7609577553818-1">ValueError: Input 0 is incompatible with layer lstm_2: expected ndim=3, found ndim=2</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Exactly as we would expect.</p>
<p>We can solve this using a <a href="https://keras.io/layers/core/#repeatvector">RepeatVector</a> layer. This layer simply repeats the provided 2D input n-times to create a 3D output.</p>
<p>The RepeatVector layer can be used like an adapter to fit the encoder and decoder parts of the network together. We can configure the RepeatVector to repeat the input 2 times. This creates a 3D output comprised of two copies of the sequence output from the encoder, that we can decode two times using the same fully connected layer for each of the two desired output vectors.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a760d073263314" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(RepeatVector(2))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a760d073263314-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a760d073263314-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The problem is framed as a classification problem with 11 classes, therefore we can optimize the log loss (<em>categorical_crossentropy</em>) function and even track accuracy as well as loss on each training epoch.</p>
<p>Putting this together, we have:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7611309427563" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define LSTM configuration
n_batch = 10
n_epoch = 30
# create LSTM
model = Sequential()
model.add(LSTM(100, input_shape=(n_in_seq_length, n_chars)))
model.add(RepeatVector(n_out_seq_length))
model.add(LSTM(50, return_sequences=True))
model.add(TimeDistributed(Dense(n_chars, activation='softmax')))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
# train LSTM
for i in range(n_epoch):
	X, y = generate_data(n_samples, n_numbers, largest, alphabet)
	print(i)
	model.fit(X, y, epochs=1, batch_size=n_batch)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a7611309427563-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7611309427563-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7611309427563-1"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-2"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-3"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-4"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-5"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_in_seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_out_seq_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-9"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_chars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-10"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-12"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-13"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-14"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a7611309427563-15"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7611309427563-16"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0018 seconds] -->
<p></p>
<h3>Why Use a RepeatVector Layer?</h3>
<p>Why not return the sequence output from the encoder as input for the decoder?</p>
<p>That is, one output for each LSTM at each input sequence time step rather than one output for each LSTM for the whole input sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7615924323574" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.add(LSTM(100, input_shape=(n_in_seq_length, n_chars), return_sequences=True))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7615924323574-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7615924323574-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_in_seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>An output for each step of the input sequence gives the decoder access to the intermediate representation of the input sequence each step. This may or may not be useful. Providing the final LSTM output at the end of the input sequence may be more logical as it captures information about the entire input sequence, ready to map to or calculate an output.</p>
<p>Also, this leaves nothing in the network to specify the size of the decoder other than the input, giving one output value for each timestep of the input sequence (5 instead of 2).</p>
<p>You could reframe the output to be a sequence of 5 characters padded with whitespace. The network would be doing more work than is required and may lose some of the compression type capability provided by the encoder-decoder paradigm. Try it and see.</p>
<p>The issue titled “<a href="https://github.com/fchollet/keras/issues/395">is the Sequence to Sequence learning right?</a>” on the Keras GitHub project provides some good discussions of alternate representations you could play with.</p>
<h3>Evaluate LSTM Model</h3>
<p>As before, we can generate a new batch of examples and evaluate the algorithm after it has been fit.</p>
<p>We could calculate an RMSE score on the prediction, although I have left it out for simplicity here.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a761a225165876" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate on some new patterns
X, y = generate_data(n_samples, n_numbers, largest, alphabet)
result = model.predict(X, batch_size=n_batch, verbose=0)
# calculate error
expected = [invert(x, alphabet) for x in y]
predicted = [invert(x, alphabet) for x in result]
# show some examples
for i in range(20):
	print('Expected=%s, Predicted=%s' % (expected[i], predicted[i]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a761a225165876-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761a225165876-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a761a225165876-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761a225165876-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a761a225165876-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761a225165876-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a761a225165876-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761a225165876-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a761a225165876-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a761a225165876-1"><span class="crayon-p"># evaluate on some new patterns</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761a225165876-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761a225165876-3"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761a225165876-4"><span class="crayon-p"># calculate error</span></div><div class="crayon-line" id="crayon-5a6586f2a761a225165876-5"><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761a225165876-6"><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a761a225165876-7"><span class="crayon-p"># show some examples</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761a225165876-8"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761a225165876-9"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected=%s, Predicted=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>Putting it all together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a761f034653656" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from random import seed
from random import randint
from numpy import array
from math import ceil
from math import log10
from math import sqrt
from numpy import argmax
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.layers import TimeDistributed
from keras.layers import RepeatVector

# generate lists of random integers and their sum
def random_sum_pairs(n_examples, n_numbers, largest):
	X, y = list(), list()
	for i in range(n_examples):
		in_pattern = [randint(1,largest) for _ in range(n_numbers)]
		out_pattern = sum(in_pattern)
		X.append(in_pattern)
		y.append(out_pattern)
	return X, y

# convert data to strings
def to_string(X, y, n_numbers, largest):
	max_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1
	Xstr = list()
	for pattern in X:
		strp = '+'.join([str(n) for n in pattern])
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		Xstr.append(strp)
	max_length = ceil(log10(n_numbers * (largest+1)))
	ystr = list()
	for pattern in y:
		strp = str(pattern)
		strp = ''.join([' ' for _ in range(max_length-len(strp))]) + strp
		ystr.append(strp)
	return Xstr, ystr

# integer encode strings
def integer_encode(X, y, alphabet):
	char_to_int = dict((c, i) for i, c in enumerate(alphabet))
	Xenc = list()
	for pattern in X:
		integer_encoded = [char_to_int[char] for char in pattern]
		Xenc.append(integer_encoded)
	yenc = list()
	for pattern in y:
		integer_encoded = [char_to_int[char] for char in pattern]
		yenc.append(integer_encoded)
	return Xenc, yenc

# one hot encode
def one_hot_encode(X, y, max_int):
	Xenc = list()
	for seq in X:
		pattern = list()
		for index in seq:
			vector = [0 for _ in range(max_int)]
			vector[index] = 1
			pattern.append(vector)
		Xenc.append(pattern)
	yenc = list()
	for seq in y:
		pattern = list()
		for index in seq:
			vector = [0 for _ in range(max_int)]
			vector[index] = 1
			pattern.append(vector)
		yenc.append(pattern)
	return Xenc, yenc

# generate an encoded dataset
def generate_data(n_samples, n_numbers, largest, alphabet):
	# generate pairs
	X, y = random_sum_pairs(n_samples, n_numbers, largest)
	# convert to strings
	X, y = to_string(X, y, n_numbers, largest)
	# integer encode
	X, y = integer_encode(X, y, alphabet)
	# one hot encode
	X, y = one_hot_encode(X, y, len(alphabet))
	# return as numpy arrays
	X, y = array(X), array(y)
	return X, y

# invert encoding
def invert(seq, alphabet):
	int_to_char = dict((i, c) for i, c in enumerate(alphabet))
	strings = list()
	for pattern in seq:
		string = int_to_char[argmax(pattern)]
		strings.append(string)
	return ''.join(strings)

# define dataset
seed(1)
n_samples = 1000
n_numbers = 2
largest = 10
alphabet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', ' ']
n_chars = len(alphabet)
n_in_seq_length = n_numbers * ceil(log10(largest+1)) + n_numbers - 1
n_out_seq_length = ceil(log10(n_numbers * (largest+1)))
# define LSTM configuration
n_batch = 10
n_epoch = 30
# create LSTM
model = Sequential()
model.add(LSTM(100, input_shape=(n_in_seq_length, n_chars)))
model.add(RepeatVector(n_out_seq_length))
model.add(LSTM(50, return_sequences=True))
model.add(TimeDistributed(Dense(n_chars, activation='softmax')))
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
# train LSTM
for i in range(n_epoch):
	X, y = generate_data(n_samples, n_numbers, largest, alphabet)
	print(i)
	model.fit(X, y, epochs=1, batch_size=n_batch)

# evaluate on some new patterns
X, y = generate_data(n_samples, n_numbers, largest, alphabet)
result = model.predict(X, batch_size=n_batch, verbose=0)
# calculate error
expected = [invert(x, alphabet) for x in y]
predicted = [invert(x, alphabet) for x in result]
# show some examples
for i in range(20):
	print('Expected=%s, Predicted=%s' % (expected[i], predicted[i]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-24">24</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-26">26</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-28">28</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-30">30</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-32">32</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-34">34</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-36">36</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-38">38</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-40">40</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-42">42</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-44">44</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-46">46</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-48">48</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-50">50</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-52">52</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-54">54</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-56">56</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-58">58</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-60">60</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-62">62</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-64">64</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-66">66</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-68">68</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-70">70</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-72">72</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-74">74</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-76">76</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-78">78</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-80">80</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-82">82</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-84">84</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-86">86</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-88">88</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-90">90</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-92">92</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-94">94</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-96">96</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-98">98</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-100">100</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-102">102</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-104">104</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-106">106</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-108">108</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-110">110</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-112">112</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-114">114</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-116">116</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-118">118</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-120">120</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-122">122</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-124">124</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-126">126</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-128">128</div><div class="crayon-num" data-line="crayon-5a6586f2a761f034653656-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a761f034653656-130">130</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a761f034653656-1"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">seed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-2"><span class="crayon-e">from </span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">randint</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-4"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">ceil</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-5"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">log10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-6"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-7"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">RepeatVector</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-14"><span class="crayon-p"># generate lists of random integers and their sum</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-15"><span class="crayon-e">def </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-16"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-17"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_examples</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-18"><span class="crayon-h"> </span><span class="crayon-v">in_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">randint</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_numbers</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-19"><span class="crayon-h"> </span><span class="crayon-v">out_pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-20"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">in_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-21"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">out_pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-22"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-23"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-24"><span class="crayon-p"># convert data to strings</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-25"><span class="crayon-e">def </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-26"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-27"><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-28"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-29"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-30"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-31"><span class="crayon-e"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-32"><span class="crayon-h"> </span><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-33"><span class="crayon-h"> </span><span class="crayon-v">ystr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-35"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-36"><span class="crayon-h"> </span><span class="crayon-v">strp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">' '</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_length</span><span class="crayon-o">-</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">strp</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-37"><span class="crayon-e"> </span><span class="crayon-v">ystr</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">strp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-38"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xstr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ystr</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-39"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-40"><span class="crayon-p"># integer encode strings</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-41"><span class="crayon-e">def </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-42"><span class="crayon-h"> </span><span class="crayon-v">char_to_int</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">c</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-43"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-44"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-45"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-46"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-47"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-48"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-49"><span class="crayon-h"> </span><span class="crayon-v">integer_encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">char_to_int</span><span class="crayon-sy">[</span><span class="crayon-t">char</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-50"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">integer_encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-51"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yenc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-52"> </div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-53"><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-54"><span class="crayon-e">def </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-55"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-56"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">seq </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-57"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-58"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-59"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-60"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-61"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-62"><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-63"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-64"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">seq </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-65"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-66"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-67"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">max_int</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-68"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-sy">[</span><span class="crayon-v">index</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-69"><span class="crayon-h"> </span><span class="crayon-v">pattern</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-70"><span class="crayon-h"> </span><span class="crayon-v">yenc</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-71"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Xenc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">yenc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-72"> </div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-73"><span class="crayon-p"># generate an encoded dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-74"><span class="crayon-e">def </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-75"><span class="crayon-h"> </span><span class="crayon-p"># generate pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-76"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">random_sum_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-77"><span class="crayon-h"> </span><span class="crayon-p"># convert to strings</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-78"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_string</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-79"><span class="crayon-h"> </span><span class="crayon-p"># integer encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-80"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">integer_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-81"><span class="crayon-h"> </span><span class="crayon-p"># one hot encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-82"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">one_hot_encode</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-83"><span class="crayon-h"> </span><span class="crayon-p"># return as numpy arrays</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-84"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-85"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-86"> </div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-87"><span class="crayon-p"># invert encoding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-88"><span class="crayon-e">def </span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">seq</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-89"><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-90"><span class="crayon-h"> </span><span class="crayon-v">strings</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-91"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pattern </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">seq</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-92"><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">int_to_char</span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-93"><span class="crayon-h"> </span><span class="crayon-v">strings</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-94"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">strings</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-95"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-96"><span class="crayon-p"># define dataset</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-97"><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-98"><span class="crayon-v">n_samples</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-99"><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-100"><span class="crayon-v">largest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-101"><span class="crayon-v">alphabet</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'4'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'5'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'6'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'7'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'8'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'9'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'+'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-102"><span class="crayon-v">n_chars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-103"><span class="crayon-v">n_in_seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-104"><span class="crayon-v">n_out_seq_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ceil</span><span class="crayon-sy">(</span><span class="crayon-e">log10</span><span class="crayon-sy">(</span><span class="crayon-e ">n_numbers *</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">largest</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-105"><span class="crayon-p"># define LSTM configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-106"><span class="crayon-v">n_batch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-107"><span class="crayon-v">n_epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">30</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-108"><span class="crayon-p"># create LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-109"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-110"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_in_seq_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_chars</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-111"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_out_seq_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-112"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-113"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_chars</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-114"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-115"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-116"><span class="crayon-p"># train LSTM</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-117"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_epoch</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-118"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-119"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-120"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-121"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-122"><span class="crayon-p"># evaluate on some new patterns</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-123"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">generate_data</span><span class="crayon-sy">(</span><span class="crayon-v">n_samples</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_numbers</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">largest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-124"><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">n_batch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-125"><span class="crayon-p"># calculate error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-126"><span class="crayon-v">expected</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-127"><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">invert</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alphabet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-128"><span class="crayon-p"># show some examples</span></div><div class="crayon-line" id="crayon-5a6586f2a761f034653656-129"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a761f034653656-130"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Expected=%s, Predicted=%s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">expected</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0116 seconds] -->
<p>Running the example nearly perfectly fits the problem. In fact, running for more epochs or increasing weight updates to every epoch (<em>batch_size=1</em>) will get you there, but will take 10 times longer to train.</p>
<p>We can see that the predicted outcome matches the expected outcome on the first 20 examples we look at.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586f2a7626928612910" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 1/1
1000/1000 [==============================] - 2s - loss: 0.0579 - acc: 0.9940
Expected=13, Predicted=13
Expected=13, Predicted=13
Expected=13, Predicted=13
Expected= 9, Predicted= 9
Expected=11, Predicted=11
Expected=18, Predicted=18
Expected=15, Predicted=15
Expected=14, Predicted=14
Expected= 6, Predicted= 6
Expected=15, Predicted=15
Expected= 9, Predicted= 9
Expected=10, Predicted=10
Expected= 8, Predicted= 8
Expected=14, Predicted=14
Expected=14, Predicted=14
Expected=19, Predicted=19
Expected= 4, Predicted= 4
Expected=13, Predicted=13
Expected= 9, Predicted= 9
Expected=12, Predicted=12</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-2">2</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-4">4</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-6">6</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-8">8</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-10">10</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-12">12</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-14">14</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-16">16</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-18">18</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-20">20</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586f2a7626928612910-22">22</div><div class="crayon-num" data-line="crayon-5a6586f2a7626928612910-23">23</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586f2a7626928612910-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-2">Epoch 1/1</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-3">1000/1000 [==============================] - 2s - loss: 0.0579 - acc: 0.9940</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-4">Expected=13, Predicted=13</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-5">Expected=13, Predicted=13</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-6">Expected=13, Predicted=13</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-7">Expected= 9, Predicted= 9</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-8">Expected=11, Predicted=11</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-9">Expected=18, Predicted=18</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-10">Expected=15, Predicted=15</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-11">Expected=14, Predicted=14</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-12">Expected= 6, Predicted= 6</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-13">Expected=15, Predicted=15</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-14">Expected= 9, Predicted= 9</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-15">Expected=10, Predicted=10</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-16">Expected= 8, Predicted= 8</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-17">Expected=14, Predicted=14</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-18">Expected=14, Predicted=14</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-19">Expected=19, Predicted=19</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-20">Expected= 4, Predicted= 4</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-21">Expected=13, Predicted=13</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586f2a7626928612910-22">Expected= 9, Predicted= 9</div><div class="crayon-line" id="crayon-5a6586f2a7626928612910-23">Expected=12, Predicted=12</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some natural extensions to this tutorial that you may wish to explore.</p>
<ul>
<li><strong>Integer Encoding</strong>. Explore whether the problem can learn the problem better using an integer encoding alone. The ordinal relationship between most of the inputs may prove very useful.</li>
<li><strong>Variable Numbers</strong>. Change the example to support a variable number of terms on each input sequence. This should be straightforward as long as you perform sufficient padding.</li>
<li><strong>Variable Mathematical Operations</strong>. Change the example to vary the mathematical operation to allow the network to generalize even further.</li>
<li><strong>Brackets</strong>. Allow the use of brackets along with other mathematical operations.</li>
</ul>
<p>Did you try any of these extensions?<br/>
Share your findings in the comments; I’d love to see what you found.</p>
<h2>Further Reading</h2>
<p>This section lists some resources for further reading and other related examples you may find useful.</p>
<h3>Papers</h3>
<ul>
<li><a href="https://arxiv.org/pdf/1409.3215.pdf">Sequence to Sequence Learning with Neural Networks</a>, 2014 [PDF]</li>
<li><a href="https://arxiv.org/pdf/1406.1078.pdf">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a>, 2014 [PDF]</li>
<li><a href="https://papers.nips.cc/paper/1215-lstm-can-solve-hard-long-time-lag-problems.pdf">LSTM can Solve Hard Long Time Lag Problems</a> [PDF]</li>
<li><a href="https://arxiv.org/pdf/1410.4615.pdf">Learn to Execute</a>, 2014 [PDF]</li>
</ul>
<h3>Code and Posts</h3>
<ul>
<li><a href="https://github.com/fchollet/keras/blob/master/examples/addition_rnn.py">Keras addition example</a></li>
<li><a href="https://github.com/Lasagne/Lasagne/blob/master/examples/recurrent.py">Addition example in Lasagne</a></li>
<li><a href="http://projects.rajivshah.com/blog/2016/04/05/rnn_addition/">RNN Addition (1st Grade)</a> and <a href="https://gist.github.com/rajshah4/aa6c67944f4a43a7c9a1204301788e0c">notebook</a></li>
<li><a href="https://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/">Anyone Can Learn To Code an LSTM-RNN in Python (Part 1: RNN)</a></li>
<li><a href="https://gist.github.com/nivwusquorum/b18ce332bde37e156034e5d3f60f8a23">Simple implementation of LSTM in Tensorflow in 50 lines</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop an LSTM network to learn how to add random integers together using the seq2seq stacked LSTM paradigm.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to learn the naive mapping function of input terms to output terms for addition.</li>
<li>How to frame the addition problem (and similar problems) and suitably encode inputs and outputs.</li>
<li>How to address the true sequence-prediction addition problem using the seq2seq paradigm.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Flearn-add-numbers-seq2seq-recurrent-neural-networks%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+networks+are+a+type+of+Recurrent+Neural+Network+%28RNN%29+that+are+capable..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Learn%20to%20Add%20Numbers%20with%20an%20Encoder-Decoder%20LSTM%20Recurrent%20Neural%20Network&amp;url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/&amp;summary=Long+Short-Term+Memory+%28LSTM%29+networks+are+a+type+of+Recurrent+Neural+Network+%28RNN%29+that+are+capable...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" rel="prev"><i class="fa fa-angle-left"></i> How to Use the TimeDistributed Layer for Long Short-Term Memory Networks in Python</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/promise-recurrent-neural-networks-time-series-forecasting/" rel="next">The Promise of Recurrent Neural Networks for Time Series Forecasting <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">44 Responses to <em>Learn to Add Numbers with an Encoder-Decoder LSTM Recurrent Neural Network</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-400127">
<div class="comment-container" id="li-comment-400127">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/619f1c2bb5565ac57e932930738642fc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/619f1c2bb5565ac57e932930738642fc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">xi</span>
<span class="date">May 20, 2017 at 6:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400127" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LOVE U</p>
<div class="reply">
<a aria-label="Reply to xi" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400127#respond" onclick='return addComment.moveForm( "comment-400127", "400127", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400162">
<div class="comment-container" id="li-comment-400162">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2017 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400162" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’m glad it helped.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400162#respond" onclick='return addComment.moveForm( "comment-400162", "400162", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-400137">
<div class="comment-container" id="li-comment-400137">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3356640e69948ebe417f2cd37679135d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3356640e69948ebe417f2cd37679135d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chauhan Hardik</span>
<span class="date">May 20, 2017 at 9:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400137" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How can we write code for decoder network whose input is encoder’s memory plus previous time step’s output ?</p>
<div class="reply">
<a aria-label="Reply to Chauhan Hardik" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400137#respond" onclick='return addComment.moveForm( "comment-400137", "400137", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400163">
<div class="comment-container" id="li-comment-400163">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2017 at 5:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400163" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, I have not done this myself yet. It may require a careful network design.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400163#respond" onclick='return addComment.moveForm( "comment-400163", "400163", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-400145">
<div class="comment-container" id="li-comment-400145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8541d020d29246b22a52c9e99a317020?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8541d020d29246b22a52c9e99a317020?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.bonaccorso.eu" rel="external nofollow">Giuseppe Bonaccorso</a></span>
<span class="date">May 21, 2017 at 1:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
very interesting article. I’ve written an extension for coping with more complex expressions (it’s available on this GIST: <a href="https://gist.github.com/giuseppebonaccorso/d6e5bee6d50480344493b66f88fc414b" rel="nofollow">https://gist.github.com/giuseppebonaccorso/d6e5bee6d50480344493b66f88fc414b</a>)</p>
<p>Unfortunately, there are still many errors, but it’s probably due to the size of the training dataset (which doesn’t contain all possible examples). That’s probably the hardest part of Seq2Seq, I mean creating a model which can also learn semantics, so that can be easily trained with fewer examples and with always better performances.</p>
<p>I’m continuing my experiments!</p>
<div class="reply">
<a aria-label="Reply to Giuseppe Bonaccorso" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400145#respond" onclick='return addComment.moveForm( "comment-400145", "400145", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400165">
<div class="comment-container" id="li-comment-400165">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2017 at 6:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400165" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done, keep experimenting Giuseppe!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400165#respond" onclick='return addComment.moveForm( "comment-400165", "400165", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-400156">
<div class="comment-container" id="li-comment-400156">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">max ales</span>
<span class="date">May 21, 2017 at 3:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400156" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m sorry but i get this error. What’s wrong?</p>
<p>Using Theano backend.<br/>
Traceback (most recent call last):<br/>
  File “test.py”, line 110, in<br/>
    model.add(LSTM(100, input_shape=(n_in_seq_length, n_chars)))<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/models.py”, line 430, in add<br/>
    layer(x)<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/layers/recurrent.py”, line 257, in __call__<br/>
    return super(Recurrent, self).__call__(inputs, **kwargs)<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/engine/topology.py”, line 578, in __call__<br/>
    output = self.call(inputs, **kwargs)<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/layers/recurrent.py”, line 295, in call<br/>
    preprocessed_input = self.preprocess_input(inputs, training=None)<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/layers/recurrent.py”, line 1028, in preprocess_input<br/>
    timesteps, training=training)<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/layers/recurrent.py”, line 58, in _time_distributed_dense<br/>
    x = K.reshape(x, (-1, timesteps, output_dim))<br/>
  File “/usr/local/lib/python2.7/dist-packages/keras/backend/theano_backend.py”, line 739, in reshape<br/>
    y = T.reshape(x, shape)<br/>
  File “/usr/local/lib/python2.7/dist-packages/Theano-0.9.0-py2.7.egg/theano/tensor/basic.py”, line 4910, in reshape<br/>
    rval = op(x, newshape)<br/>
  File “/usr/local/lib/python2.7/dist-packages/Theano-0.9.0-py2.7.egg/theano/gof/op.py”, line 615, in __call__<br/>
    node = self.make_node(*inputs, **kwargs)<br/>
  File “/usr/local/lib/python2.7/dist-packages/Theano-0.9.0-py2.7.egg/theano/tensor/basic.py”, line 4748, in make_node<br/>
    raise TypeError(“Shape must be integers”, shp, shp.dtype)<br/>
TypeError: (‘Shape must be integers’, TensorConstant{[  -1.    5.  100.]}, ‘float64’)</p>
<div class="reply">
<a aria-label="Reply to max ales" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400156#respond" onclick='return addComment.moveForm( "comment-400156", "400156", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-400167">
<div class="comment-container" id="li-comment-400167">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 21, 2017 at 6:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400167" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ensure you have copied the example exactly without any extra white space.</p>
<p>Also ensure you are using Keras 2.0 or higher.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400167#respond" onclick='return addComment.moveForm( "comment-400167", "400167", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-400208">
<div class="comment-container" id="li-comment-400208">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">giorgio borghi</span>
<span class="date">May 21, 2017 at 9:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400208" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thanx for your help, but<br/>
i wrote carefully</p>
<p>line model.add(LSTM(100, input_shape=(n_in_seq_length, n_chars)))</p>
<p>raise TypeError(“Shape must be integers”, shp, shp.dtype)<br/>
TypeError: (‘Shape must be integers’, TensorConstant{[  -1.    5.  100.]}, ‘float64’)</p>
<div class="reply">
<a aria-label="Reply to giorgio borghi" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400208#respond" onclick='return addComment.moveForm( "comment-400208", "400208", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-400237">
<div class="comment-container" id="li-comment-400237">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 22, 2017 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400237" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not seen this error before, sorry.</p>
<p>Do any other examples work on your system?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400237#respond" onclick='return addComment.moveForm( "comment-400237", "400237", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-400381">
<div class="comment-container" id="li-comment-400381">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1c46d5f7886ee847583487c4b21f6e56?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Giorgio borghi</span>
<span class="date">May 23, 2017 at 9:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400381" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes . Keras is 2.0.4 and your post is too important and awesome ! Great job !</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-403729">
<div class="comment-container" id="li-comment-403729">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">RealUser404</span>
<span class="date">June 25, 2017 at 9:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403729" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I got almost the same error when just copy/pasting the code :<br/>
TypeError: Value passed to parameter ‘shape’ has DataType float32 not in list of allowed values: int32, int64</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-403803">
<div class="comment-container" id="li-comment-403803">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2017 at 6:03 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403803" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I have not seen this error. Ensure you have the latest version of all the libraries installed.</p>
<p>See if you can pull the example apart and narrow down the line the fails. It looks like numpy and the .shape property. Perhaps your numpy is not up to date. shape always returns an int. No idea what this error could be,.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-403831">
<div class="comment-container" id="li-comment-403831">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">RealUser404</span>
<span class="date">June 26, 2017 at 9:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403831" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well it was due to the n_out_seq_length = ceil(log10(n_numbers * (largest+1))) lines. </p>
<p>I do not know why it does that, as ceil is supposed to return an integer.<br/>
If I change manually the value to n_out_seq_length = 2, then it works correctly.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-403935">
<div class="comment-container" id="li-comment-403935">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 27, 2017 at 8:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403935" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Interesting.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-400186">
<div class="comment-container" id="li-comment-400186">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfccb37eb2036bb031f66fc21c544815?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Birkey</span>
<span class="date">May 21, 2017 at 12:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400186" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work  Jason!<br/>
For seq2seq problem, RNN is the choice by default. But it seems quite subtle  to choose between MLP vs RNN for seq2vec problem. In the case discussed, if we “encode too much  domain knowledge into the problem” we turned it into a function mapping problem, here by “domain knowledge ” we means “split addition equation into added and addon” . But this kind of “Data preprocessing” is not uncommon for input sequence.</p>
<p>Q: do you have any principles or guidelines for model choosing for seq2vec problem?</p>
<p>BTW: I have read the keras issue you recommend. Maybe there’s answer</p>
<div class="reply">
<a aria-label="Reply to Birkey" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400186#respond" onclick='return addComment.moveForm( "comment-400186", "400186", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-400236">
<div class="comment-container" id="li-comment-400236">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">May 22, 2017 at 7:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400236" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>It really comes down to what performs best on your problem. You may want a seq2seq formulation because of the elegance, but a mapping-based solution (seq2vec) may just perform better.</p>
<p>In practice, I would try a suite of methods and double down on what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400236#respond" onclick='return addComment.moveForm( "comment-400236", "400236", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-400848">
<div class="comment-container" id="li-comment-400848">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">May 30, 2017 at 11:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400848" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is seq2seq can be used for time series prediction? Given you delivered lots of wonderful posts over time series, what if translate traditional time series prediction to a seq2seq formulation?<br/>
Could you give me some advice?</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400848#respond" onclick='return addComment.moveForm( "comment-400848", "400848", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-401205">
<div class="comment-container" id="li-comment-401205">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:37 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401205" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, if you have a different number of output time steps for each one input time step.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=401205#respond" onclick='return addComment.moveForm( "comment-401205", "401205", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-401592">
<div class="comment-container" id="li-comment-401592">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2c2fc2d581e40949e709d4c0be2a206f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kunpeng Zhang</span>
<span class="date">June 6, 2017 at 1:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401592" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your response.</p>
<div class="reply">
<a aria-label="Reply to Kunpeng Zhang" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=401592#respond" onclick='return addComment.moveForm( "comment-401592", "401592", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-400854">
<div class="comment-container" id="li-comment-400854">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mehrdad</span>
<span class="date">May 31, 2017 at 3:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-400854" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason. Thanks for your great article.<br/>
Something is not clear for me. LSTMs are capable of learning series (sequences) with different length. Why we should use padding to have sequences with same length?</p>
<div class="reply">
<a aria-label="Reply to Mehrdad" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=400854#respond" onclick='return addComment.moveForm( "comment-400854", "400854", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-401208">
<div class="comment-container" id="li-comment-401208">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 2, 2017 at 12:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401208" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here, the difference is between the lengths of input and output sequences, not differences in the lengths of input sequences themselves.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=401208#respond" onclick='return addComment.moveForm( "comment-401208", "401208", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-401579">
<div class="comment-container" id="li-comment-401579">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mehrdadscomputer</span>
<span class="date">June 5, 2017 at 10:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401579" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason.</p>
<p>I did some searches and it seems that after padding, it’s essential to use masking or initializing sample_weight to say model to ignore white spaces. It doesn’t learn to automatically ignore padded characters (I had a wrong assumption about it)</p>
<p>I did masking for this problem and the result is as follow:</p>
<p>The result without masking for 10 epochs is: loss: 0.6787 – acc: 0.8185<br/>
The result with masking for 10 epochs is: loss:      0.6202 – acc: 0.8705</p>
<p>As you see, there is too much improvement. But may please say how we can use apply sample_weight to this problem?</p>
<p>The improvement achieved by changing this part of code:</p>
<p>model = Sequential()<br/>
model.add(Masking(mask_value = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], input_shape=(n_in_seq_length, n_chars)))<br/>
model.add(LSTM(100))</p>
<p>Note: remember to add:<br/>
from keras.layers import Masking</p>
<div class="reply">
<a aria-label="Reply to mehrdadscomputer" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=401579#respond" onclick='return addComment.moveForm( "comment-401579", "401579", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-401631">
<div class="comment-container" id="li-comment-401631">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 6, 2017 at 9:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401631" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work! Thanks for reporting your results.</p>
<p>I have a post on masking scheduled that should provide further help.</p>
<p>What do you mean sample weight? Weighting input samples? I guess neural nets do this already. You could also resample your training data to affect the sampling distribution of different classes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=401631#respond" onclick='return addComment.moveForm( "comment-401631", "401631", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-401880">
<div class="comment-container" id="li-comment-401880">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/701564aeee2a2e48ebc0d799cefb0897?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">mehrdad12</span>
<span class="date">June 8, 2017 at 6:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401880" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason.<br/>
I run my model many times and it seems that the improvement is because of randomness and not masking, unfortunately.</p>
<p>I am really excited about your new post on masking.</p>
<p>Yes, I mean weighting input samples.</p>
<p>I asked about this in Keras’ slack channel and some guys told me that neural network is not capable of learning to ignore padded part of time series and I need to do it by weighting input samples</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-401939">
<div class="comment-container" id="li-comment-401939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 9, 2017 at 6:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-401939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you could ask what this person meant.</p>
<p>Off the cuff, I cannot see how weighting inputs would help with masking.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-403735">
<div class="comment-container" id="li-comment-403735">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6508606fe9489601d669f5cdc283d7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">RealUser404</span>
<span class="date">June 25, 2017 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403735" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This was a great tutorial, thanks a lot!</p>
<p>I have a question concerning the size of the LSTM layers. You chose to use a LSTM layer of 100 neurons for the encoder, and 50 for the decoder. How did you choose those values? Are these somehow related to the size of the input and size of the output? Does that mean if I use an input twice as big (numbers of 4 digits instead of 2) I should be doubling the number of neurons too?</p>
<p>Thank you in advance!</p>
<div class="reply">
<a aria-label="Reply to RealUser404" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=403735#respond" onclick='return addComment.moveForm( "comment-403735", "403735", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-403805">
<div class="comment-container" id="li-comment-403805">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">June 26, 2017 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-403805" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, just a little trial and error.</p>
<p>Experiment and see how different values affect model skill.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=403805#respond" onclick='return addComment.moveForm( "comment-403805", "403805", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-412437">
<div class="comment-container" id="li-comment-412437">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">anurag</span>
<span class="date">September 4, 2017 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-412437" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the nice post, I want to use the encoder – decoder lstm network to extract features for shampoo sales data to use the features for multistep forecasting.</p>
<p>def lstm_autoencoder(train_data, target, timesteps, repeat_vec, batch_size, epochs, ls_cells=[10, 6], lr=0.01):<br/>
    train_data = train_data.reshape(train_data.shape[0], timesteps, train_data.shape[1])<br/>
    target = target.reshape(target.shape[0], timesteps, target.shape[1])<br/>
    model = Sequential()<br/>
    model.add(LSTM(ls_cells[0], batch_input_shape=(batch_size, train_data.shape[1], train_data.shape[2]), return_sequences=True))<br/>
    model.add(LSTM(ls_cells[1], batch_input_shape=(batch_size, train_data.shape[1], train_data.shape[2])))<br/>
    model.add(RepeatVector(repeat_vec))<br/>
    model.add(LSTM(ls_cells[2], batch_input_shape=(batch_size, train_data.shape[1], train_data.shape[2]), return_sequences=True))<br/>
    model.add(TimeDistributed(Dense(1, activation=’relu’)))<br/>
    model.compile(loss=’mse’, optimizer=Adam(lr=lr), callbacks=[early_stopping])<br/>
    print(model.summary())<br/>
    # train LSTM<br/>
    tr_mse, val_mse = list(), list()<br/>
    for i in range(epochs):<br/>
        print(‘Epoch :’, str(i) )<br/>
        history = model.fit(train_data, target, epochs=1, batch_size=1, verbose=2, shuffle=False, validation_split=0.1)<br/>
        tr_mse.append(history.history[‘loss’])<br/>
        val_mse.append(history.history[‘val_loss’])<br/>
    return model, history, tr_mse, val_mse</p>
<p>model, history, tr_mse, val_mse = lstm_autoencoder(X_scaled, y_scaled, timesteps=1,<br/>
                                                                                    repeat_vec=1,  batch_size=1,<br/>
                                                                                    epochs=80, ls_cells=[20, 16, 7],<br/>
                                                                                    lr=0.002)</p>
<p>After training the network, I am predicting……………..<br/>
X_train = X_train.reshape(X_train.shape[0], 1, 1)<br/>
result = model.predict(X_train, batch_size=1, verbose=2)</p>
<p>Is this the correct way, as my idea was to do it in an unsupervised way…</p>
<p>Thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to anurag" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=412437#respond" onclick='return addComment.moveForm( "comment-412437", "412437", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-412439">
<div class="comment-container" id="li-comment-412439">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d52778b918079c57c1563a0c2d22b6dd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">anurag</span>
<span class="date">September 4, 2017 at 12:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-412439" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I wanted to understand how to use the network in an unsupervised way to reduce the dimension to a fixed length vector(encode) and then reconstruct (decode) , later on this reduced dimension of fixed length , I would like to train a LSTM for multi-step forecasts.</p>
<div class="reply">
<a aria-label="Reply to anurag" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=412439#respond" onclick='return addComment.moveForm( "comment-412439", "412439", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-412471">
<div class="comment-container" id="li-comment-412471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-412471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but it would not be unsupervised, it is supervised.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=412471#respond" onclick='return addComment.moveForm( "comment-412471", "412471", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-412470">
<div class="comment-container" id="li-comment-412470">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-412470" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could use the encoder-decoder for time series.</p>
<p>The key is to choose the length of the input sequences and the length of the context vector, experiment with both. I’d love to hear how you go.</p>
<p>This post might give you a cleaner template as a starting point:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=412470#respond" onclick='return addComment.moveForm( "comment-412470", "412470", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414879">
<div class="comment-container" id="li-comment-414879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7a4418594cb28f4333120ea95858e9c6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7a4418594cb28f4333120ea95858e9c6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">BouBou</span>
<span class="date">September 27, 2017 at 2:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-414879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this detailed article! </p>
<p>I have a question: what is the initial state for both the encoder and the decoder? </p>
<p>It appears that instead of “sending” the last state of the encoder to the decoder as initial state, the last output of the encoder is “send”/fed to the decoder as input, right? But the last output of the encoder corresponds actually to the last time step input data … and not a representation of all the input data … Moreover, the difference between two time steps in the decoder is only the hidden state (because the input of each time step in the decoder == last encoder output) …</p>
<p>A second question is in case you have tested the solution that consists in “sending” the last hidden state of the encoder to the decoder or using the attention mechanism and where each decoder input is the output of the last decoder output time step, could you precise how you have achieved this in Keras or only Tensorflow?</p>
<p>Thank you in advance for your answers</p>
<div class="reply">
<a aria-label="Reply to BouBou" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=414879#respond" onclick='return addComment.moveForm( "comment-414879", "414879", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414901">
<div class="comment-container" id="li-comment-414901">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2017 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-414901" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When you refer to state, are you referring to the internal variables within each memory unit, or the output of the encoder or decoder model? I think you may have these elements mixed up.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=414901#respond" onclick='return addComment.moveForm( "comment-414901", "414901", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-414943">
<div class="comment-container" id="li-comment-414943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ca4331c4d2086d7a4b61b1414e5ad0f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ca4331c4d2086d7a4b61b1414e5ad0f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">BouBou</span>
<span class="date">September 27, 2017 at 7:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-414943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your answer!<br/>
I refer to the hidden state and cell states (for LSTM). They are transferred from an LSTM cell to another through time steps …<br/>
At each time step, a LSTM cell:<br/>
–  has as input: X (batch_size, n_features), the previous hidden state h, the previous cell/memory state c,<br/>
– produces: Y (batch_size, n_hidden_units), the hidden state h, the cell/memory state c. </p>
<p>Thanks !</p>
<div class="reply">
<a aria-label="Reply to BouBou" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=414943#respond" onclick='return addComment.moveForm( "comment-414943", "414943", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-415021">
<div class="comment-container" id="li-comment-415021">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ca4331c4d2086d7a4b61b1414e5ad0f8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ca4331c4d2086d7a4b61b1414e5ad0f8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">BouBou</span>
<span class="date">September 28, 2017 at 10:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-415021" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If I can precise my question: The input of the decoder is a constant vector and this vector is the last output of the encoder y(n); but this last output fits to the encoder input x(n).<br/>
For instance:<br/>
number of time steps in the encoder = n<br/>
number of time steps in the decoder = m<br/>
encoder input = x:{x1, x2, x3 … xn}<br/>
encoder outputs = y:{y1,y2,y3 … yn}<br/>
encoder states = he:{he0,he1….hen}<br/>
decoder input = y’:{yn,yn …yn} (m times)<br/>
decoder output = z:{z1,z2 … zm}<br/>
decoder states= hd:{hd0,hd1, hd2… hdm}<br/>
So, my questions are:<br/>
– what is he0? (initial encoder state)<br/>
– what is hd0 ? (initial decoder state .. I think that it should be hen == hd0)<br/>
– yn = f[he(n-1), xn] is the input of the decoder, where is the information about x1 … x(n-1) to decode properly? </p>
<p>Thanks !!</p>
<div class="reply">
<a aria-label="Reply to BouBou" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=415021#respond" onclick='return addComment.moveForm( "comment-415021", "415021", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-415043">
<div class="comment-container" id="li-comment-415043">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 29, 2017 at 5:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-415043" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The encoder and decoder initial hidden state values are 0.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=415043#respond" onclick='return addComment.moveForm( "comment-415043", "415043", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418612">
<div class="comment-container" id="li-comment-418612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/819d50c88d69442d6f5ae4fac9576238?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/819d50c88d69442d6f5ae4fac9576238?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony</span>
<span class="date">October 31, 2017 at 10:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-418612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason, thank you for your posts. I was wondering about the first solution in this one, where a MLP is used to learn to sum numbers. The values used in the training are such that the trained model “sees” 5,000 examples (n_examples * n_epoch) if I’m not mistaken and the possible values for the two input numbers are between 1 and 100, which makes 5,050 (100 * 99 / 2 + 100) different possible pairs. Of course, the 5,000 examples are not unique but still: doesn’t this turn the MLP more into a hash table of all possible pairs for this particular example?</p>
<p>Still, it looks like if we increase the value of <code>largest</code> without touching the other vars, the approach still works mostly due to the normalization, I suppose. I find that quite amazing.</p>
<div class="reply">
<a aria-label="Reply to Tony" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=418612#respond" onclick='return addComment.moveForm( "comment-418612", "418612", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-418613">
<div class="comment-container" id="li-comment-418613">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/819d50c88d69442d6f5ae4fac9576238?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/819d50c88d69442d6f5ae4fac9576238?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony</span>
<span class="date">October 31, 2017 at 10:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-418613" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Actually, now that I think about it more: the model needs to learn a simple linear function, so with enough training examples it is normal for it to be able to generalise to numbers with any size. Probably there is some minimum number of training examples that are enough for it to any size of the numbers. My experiments show that <code>n_examples = 100, n_epoch = 100</code> gets the work done.</p>
<div class="reply">
<a aria-label="Reply to Tony" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=418613#respond" onclick='return addComment.moveForm( "comment-418613", "418613", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-418633">
<div class="comment-container" id="li-comment-418633">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-418633" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the model must generalize a mapping function. Well done on seeing that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=418633#respond" onclick='return addComment.moveForm( "comment-418633", "418633", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-420847">
<div class="comment-container" id="li-comment-420847">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 22, 2017 at 3:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-420847" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason!</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=420847#respond" onclick='return addComment.moveForm( "comment-420847", "420847", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420940">
<div class="comment-container" id="li-comment-420940">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 23, 2017 at 10:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-420940" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=420940#respond" onclick='return addComment.moveForm( "comment-420940", "420940", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-422071">
<div class="comment-container" id="li-comment-422071">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/09106f09ed7af0df2b4c73862458d10d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/09106f09ed7af0df2b4c73862458d10d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jay</span>
<span class="date">December 4, 2017 at 12:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-422071" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I notice that you are training on 30,000 examples (= 30 epochs x 1000 samples per epoch).<br/>
Also, the largest numbers being added in both the train and test sets are 10 – which probably means there are a max of 100 unique pairs (10 x 10) of addition examples in the domain.</p>
<p>Since 30,000 training examples is way larger (&gt;&gt;) than the the available unique pairs for addition (i.e. 100) – Do you think the model has simply memorized the results ?</p>
<p>At first glance – It seems like the “test data” might NOT really be new data that the model is seeing.</p>
<p>Experimented with increasing “largest” to a value of 100 – which means 10,000 unique addition possibilities. But this time- -the test accuracy was way lower(~ 58%) and it seemed like the the predictions on the test set were all incorrect (though they were pretty close in many cases).</p>
<p>So – Is the LSTM really learning ??</p>
<div class="reply">
<a aria-label="Reply to Jay" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=422071#respond" onclick='return addComment.moveForm( "comment-422071", "422071", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-422101">
<div class="comment-container" id="li-comment-422101">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/#comment-422101" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It’s a good question that requires careful testing to answer.</p>
<p>I don’t think it is getting enough exposures/or has sufficient capacity to memorize, but you could be right.</p>
<p>A better evaluation of the model would be to train it on a subset of possible pairs and test it on the held out pairs to see if indeed it learns addition.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/learn-add-numbers-seq2seq-recurrent-neural-networks/?replytocom=422101#respond" onclick='return addComment.moveForm( "comment-422101", "422101", "respond", "4001" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/learn-add-numbers-seq2seq-recurrent-neural-networks/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4001"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="fd94fe73f0"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="223"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>