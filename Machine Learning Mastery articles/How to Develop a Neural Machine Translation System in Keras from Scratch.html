<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Develop a Neural Machine Translation System in Keras from Scratch - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop a Neural Machine Translation System in Keras from Scratch - Machine Learning Mastery" property="og:title"/>
<meta content="Machine translation is a challenging task that traditionally involves large statistical models developed using highly sophisticated linguistic knowledge. Neural machine translation is the use of deep neural networks for the problem of machine translation. In this tutorial, you will discover how to develop a neural machine translation system for translating German phrases to English. After …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Natural Language Processing" property="article:section"/>
<meta content="2018-01-10T05:00:47+11:00" property="article:published_time"/>
<meta content="2018-01-13T05:12:23+11:00" property="article:modified_time"/>
<meta content="2018-01-13T05:12:23+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" property="og:image:secure_url"/>
<meta content="640" property="og:image:width"/>
<meta content="360" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/develop-neural-machine-translation-system-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop a Neural Machine Translation System in Keras from Scratch Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4579" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4579 single-format-standard unknown alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Need help with Deep Learning for Text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4579 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop a Neural Machine Translation System in Keras from Scratch</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-01-10T05:00:47+1100">January 10, 2018</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Natural Language Processing">Natural Language Processing</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/&amp;summary=Machine+translation+is+a+challenging+task+that+traditionally+involves+large+statistical+models+devel..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/&amp;summary=Machine+translation+is+a+challenging+task+that+traditionally+involves+large+statistical+models+devel...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Machine translation is a challenging task that traditionally involves large statistical models developed using highly sophisticated linguistic knowledge.</p>
<p>Neural machine translation is the use of deep neural networks for the problem of machine translation.</p>
<p>In this tutorial, you will discover how to develop a neural machine translation system for translating German phrases to English.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to clean and prepare data ready to train a neural machine translation system.</li>
<li>How to develop an encoder-decoder model for machine translation.</li>
<li>How to use a trained model for inference on new input phrases and evaluate the model skill.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4581" style="max-width: 650px"><img alt="How to Develop a Neural Machine Translation System in Keras" class="size-full wp-image-4581" height="360" sizes="(max-width: 640px) 100vw, 640px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-300x169.jpg 300w" width="640"/><p class="wp-caption-text">How to Develop a Neural Machine Translation System in Keras<br/>Photo by <a href="https://www.flickr.com/photos/damescalito/34527830324/">Björn Groß</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 4 parts; they are:</p>
<ol>
<li>German to English Translation Dataset</li>
<li>Preparing the Text Data</li>
<li>Train Neural Translation Model</li>
<li>Evaluate Neural Translation Model</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python 3 SciPy environment installed.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have NumPy and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<!-- Start shortcoder --><p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>German to English Translation Dataset</h2>
<p>In this tutorial, we will use a dataset of German to English terms used as the basis for flashcards for language learning.</p>
<p>The dataset is available from the <a href="http://www.manythings.org">ManyThings.org</a> website, with examples drawn from the <a href="http://tatoeba.org/home">Tatoeba Project</a>. The dataset is comprised of German phrases and their English counterparts and is intended to be used with the <a href="https://apps.ankiweb.net/">Anki flashcard software</a>.</p>
<p>The page provides a list of many language pairs, and I encourage you to explore other languages:</p>
<ul>
<li><a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a></li>
</ul>
<p>The dataset we will use in this tutorial is available for download here:</p>
<ul>
<li><a href="http://www.manythings.org/anki/deu-eng.zip">German – English deu-eng.zip</a></li>
</ul>
<p>Download the dataset to your current working directory and decompress; for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615b7100953157" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
unzip deu-eng.zip</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615b7100953157-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615b7100953157-1">unzip deu-eng.zip</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>You will have a file called <em>deu.txt</em> that contains 152,820 pairs of English to German phases, one pair per line with a tab separating the language.</p>
<p>For example, the first 5 lines of the file look as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615c0830259359" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Hi.	Hallo!
Hi.	Grüß Gott!
Run!	Lauf!
Wow!	Potzdonner!
Wow!	Donnerwetter!</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615c0830259359-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c0830259359-2">2</div><div class="crayon-num" data-line="crayon-5a658917615c0830259359-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c0830259359-4">4</div><div class="crayon-num" data-line="crayon-5a658917615c0830259359-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615c0830259359-1">Hi.	Hallo!</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c0830259359-2">Hi.	Grüß Gott!</div><div class="crayon-line" id="crayon-5a658917615c0830259359-3">Run!	Lauf!</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c0830259359-4">Wow!	Potzdonner!</div><div class="crayon-line" id="crayon-5a658917615c0830259359-5">Wow!	Donnerwetter!</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We will frame the prediction problem as given a sequence of words in German as input, translate or predict the sequence of words in English.</p>
<p>The model we will develop will be suitable for some beginner German phrases.</p>
<h2>Preparing the Text Data</h2>
<p>The next step is to prepare the text data ready for modeling.</p>
<p>Take a look at the raw data and note what you see that we might need to handle in a data cleaning operation.</p>
<p>For example, here are some observations I note from reviewing the raw data:</p>
<ul>
<li>There is punctuation.</li>
<li>The text contains uppercase and lowercase.</li>
<li>There are special characters in the German.</li>
<li>There are duplicate phrases in English with different translations in German.</li>
<li>The file is ordered by sentence length with very long sentences toward the end of the file.</li>
</ul>
<p>Did you note anything else that could be important?<br/>
Let me know in the comments below.</p>
<p>A good text cleaning procedure may handle some or all of these observations.</p>
<p>Data preparation is divided into two subsections:</p>
<ol>
<li>Clean Text</li>
<li>Split Text</li>
</ol>
<h3>1. Clean Text</h3>
<p>First, we must load the data in a way that preserves the Unicode German characters. The function below called <em>load_doc()</em> will load the file as a blob of text.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615c4246597968" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, mode='rt', encoding='utf-8')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615c4246597968-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c4246597968-2">2</div><div class="crayon-num" data-line="crayon-5a658917615c4246597968-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c4246597968-4">4</div><div class="crayon-num" data-line="crayon-5a658917615c4246597968-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c4246597968-6">6</div><div class="crayon-num" data-line="crayon-5a658917615c4246597968-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c4246597968-8">8</div><div class="crayon-num" data-line="crayon-5a658917615c4246597968-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615c4246597968-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c4246597968-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615c4246597968-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c4246597968-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'rt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615c4246597968-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c4246597968-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615c4246597968-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c4246597968-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615c4246597968-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Each line contains a single pair of phrases, first English and then German, separated by a tab character.</p>
<p>We must split the loaded text by line and then by phrase. The function <em>to_pairs()</em> below will split the loaded text.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615c6893339981" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split a loaded document into sentences
def to_pairs(doc):
	lines = doc.strip().split('\n')
	pairs = [line.split('\t') for line in  lines]
	return pairs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615c6893339981-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c6893339981-2">2</div><div class="crayon-num" data-line="crayon-5a658917615c6893339981-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c6893339981-4">4</div><div class="crayon-num" data-line="crayon-5a658917615c6893339981-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615c6893339981-1"><span class="crayon-p"># split a loaded document into sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c6893339981-2"><span class="crayon-e">def </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615c6893339981-3"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\n'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c6893339981-4"><span class="crayon-h"> </span><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\t'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h">  </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658917615c6893339981-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pairs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We are now ready to clean each sentence. The specific cleaning operations we will perform are as follows:</p>
<ul>
<li>Remove all non-printable characters.</li>
<li>Remove all punctuation characters.</li>
<li>Normalize all Unicode characters to ASCII (e.g. Latin characters).</li>
<li>Normalize the case to lowercase.</li>
<li>Remove any remaining tokens that are not alphabetic.</li>
</ul>
<p>We will perform these operations on each phrase for each pair in the loaded dataset.</p>
<p>The <em>clean_pairs()</em> function below implements these operations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615c9562131233" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# clean a list of lines
def clean_pairs(lines):
	cleaned = list()
	# prepare regex for char filtering
	re_print = re.compile('[^%s]' % re.escape(string.printable))
	# prepare translation table for removing punctuation
	table = str.maketrans('', '', string.punctuation)
	for pair in lines:
		clean_pair = list()
		for line in pair:
			# normalize unicode characters
			line = normalize('NFD', line).encode('ascii', 'ignore')
			line = line.decode('UTF-8')
			# tokenize on white space
			line = line.split()
			# convert to lowercase
			line = [word.lower() for word in line]
			# remove punctuation from each token
			line = [word.translate(table) for word in line]
			# remove non-printable chars form each token
			line = [re_print.sub('', w) for w in line]
			# remove tokens with numbers in them
			line = [word for word in line if word.isalpha()]
			# store as string
			clean_pair.append(' '.join(line))
		cleaned.append(clean_pair)
	return array(cleaned)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615c9562131233-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-2">2</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-4">4</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-6">6</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-8">8</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-10">10</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-12">12</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-14">14</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-16">16</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-18">18</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-20">20</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-22">22</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-24">24</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615c9562131233-26">26</div><div class="crayon-num" data-line="crayon-5a658917615c9562131233-27">27</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615c9562131233-1"><span class="crayon-p"># clean a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-2"><span class="crayon-e">def </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-3"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-4"><span class="crayon-h"> </span><span class="crayon-p"># prepare regex for char filtering</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-5"><span class="crayon-h"> </span><span class="crayon-v">re_print</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'[^%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">printable</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-6"><span class="crayon-h"> </span><span class="crayon-p"># prepare translation table for removing punctuation</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-7"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pair </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-9"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-10"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pair</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-11"><span class="crayon-h"> </span><span class="crayon-p"># normalize unicode characters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-12"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-s">'NFD'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'ascii'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ignore'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-13"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'UTF-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-14"><span class="crayon-h"> </span><span class="crayon-p"># tokenize on white space</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-15"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-16"><span class="crayon-h"> </span><span class="crayon-p"># convert to lowercase</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-17"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-19"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-20"><span class="crayon-h"> </span><span class="crayon-p"># remove non-printable chars form each token</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-21"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">re_print</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-22"><span class="crayon-h"> </span><span class="crayon-p"># remove tokens with numbers in them</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-23"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-24"><span class="crayon-h"> </span><span class="crayon-p"># store as string</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-25"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615c9562131233-26"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pair</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615c9562131233-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">cleaned</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0024 seconds] -->
<p>Finally, now that the data has been cleaned, we can save the list of phrase pairs to a file ready for use.</p>
<p>The function <em>save_clean_data()</em> uses the pickle API to save the list of clean text to file.</p>
<p>Pulling all of this together, the complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615cc476880777" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
import string
import re
from pickle import dump
from unicodedata import normalize
from numpy import array

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, mode='rt', encoding='utf-8')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# split a loaded document into sentences
def to_pairs(doc):
	lines = doc.strip().split('\n')
	pairs = [line.split('\t') for line in  lines]
	return pairs

# clean a list of lines
def clean_pairs(lines):
	cleaned = list()
	# prepare regex for char filtering
	re_print = re.compile('[^%s]' % re.escape(string.printable))
	# prepare translation table for removing punctuation
	table = str.maketrans('', '', string.punctuation)
	for pair in lines:
		clean_pair = list()
		for line in pair:
			# normalize unicode characters
			line = normalize('NFD', line).encode('ascii', 'ignore')
			line = line.decode('UTF-8')
			# tokenize on white space
			line = line.split()
			# convert to lowercase
			line = [word.lower() for word in line]
			# remove punctuation from each token
			line = [word.translate(table) for word in line]
			# remove non-printable chars form each token
			line = [re_print.sub('', w) for w in line]
			# remove tokens with numbers in them
			line = [word for word in line if word.isalpha()]
			# store as string
			clean_pair.append(' '.join(line))
		cleaned.append(clean_pair)
	return array(cleaned)

# save a list of clean sentences to file
def save_clean_data(sentences, filename):
	dump(sentences, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load dataset
filename = 'deu.txt'
doc = load_doc(filename)
# split into english-german pairs
pairs = to_pairs(doc)
# clean sentences
clean_pairs = clean_pairs(pairs)
# save clean pairs to file
save_clean_data(clean_pairs, 'english-german.pkl')
# spot check
for i in range(100):
	print('[%s] =&gt; [%s]' % (clean_pairs[i,0], clean_pairs[i,1]))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615cc476880777-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-2">2</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-4">4</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-6">6</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-8">8</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-10">10</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-12">12</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-14">14</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-16">16</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-18">18</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-20">20</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-22">22</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-24">24</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-26">26</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-28">28</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-30">30</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-32">32</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-34">34</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-36">36</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-38">38</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-40">40</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-42">42</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-44">44</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-46">46</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-48">48</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-50">50</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-52">52</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-54">54</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-56">56</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-58">58</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-60">60</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-62">62</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-64">64</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615cc476880777-66">66</div><div class="crayon-num" data-line="crayon-5a658917615cc476880777-67">67</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615cc476880777-1"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-2"><span class="crayon-e">import </span><span class="crayon-e">re</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-3"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">dump</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-4"><span class="crayon-e">from </span><span class="crayon-e">unicodedata </span><span class="crayon-e">import </span><span class="crayon-e">normalize</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-6"> </div><div class="crayon-line" id="crayon-5a658917615cc476880777-7"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-8"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-9"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-10"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'rt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">encoding</span><span class="crayon-o">=</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-11"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-12"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-13"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-14"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-15"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-16"> </div><div class="crayon-line" id="crayon-5a658917615cc476880777-17"><span class="crayon-p"># split a loaded document into sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-18"><span class="crayon-e">def </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-19"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\n'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-20"><span class="crayon-h"> </span><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-s">'\t'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h">  </span><span class="crayon-v">lines</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-22"> </div><div class="crayon-line" id="crayon-5a658917615cc476880777-23"><span class="crayon-p"># clean a list of lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-24"><span class="crayon-e">def </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-25"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-26"><span class="crayon-h"> </span><span class="crayon-p"># prepare regex for char filtering</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-27"><span class="crayon-h"> </span><span class="crayon-v">re_print</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'[^%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">escape</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">printable</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-28"><span class="crayon-h"> </span><span class="crayon-p"># prepare translation table for removing punctuation</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-29"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-30"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">pair </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-31"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-32"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">pair</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-33"><span class="crayon-h"> </span><span class="crayon-p"># normalize unicode characters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-34"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">normalize</span><span class="crayon-sy">(</span><span class="crayon-s">'NFD'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'ascii'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'ignore'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-35"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'UTF-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-36"><span class="crayon-h"> </span><span class="crayon-p"># tokenize on white space</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-37"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-38"><span class="crayon-h"> </span><span class="crayon-p"># convert to lowercase</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-39"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">lower</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-40"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-41"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-42"><span class="crayon-h"> </span><span class="crayon-p"># remove non-printable chars form each token</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-43"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">re_print</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">w</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-44"><span class="crayon-h"> </span><span class="crayon-p"># remove tokens with numbers in them</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-45"><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-46"><span class="crayon-h"> </span><span class="crayon-p"># store as string</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-47"><span class="crayon-h"> </span><span class="crayon-v">clean_pair</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-48"><span class="crayon-h"> </span><span class="crayon-v">cleaned</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pair</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-49"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">cleaned</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-50"> </div><div class="crayon-line" id="crayon-5a658917615cc476880777-51"><span class="crayon-p"># save a list of clean sentences to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-52"><span class="crayon-e">def </span><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-53"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-54"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-56"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-57"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'deu.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-58"><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-59"><span class="crayon-p"># split into english-german pairs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-60"><span class="crayon-v">pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-61"><span class="crayon-p"># clean sentences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-62"><span class="crayon-v">clean_pairs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_pairs</span><span class="crayon-sy">(</span><span class="crayon-v">pairs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-63"><span class="crayon-p"># save clean pairs to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-64"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-65"><span class="crayon-p"># spot check</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615cc476880777-66"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615cc476880777-67"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'[%s] =&gt; [%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">clean_pairs</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0049 seconds] -->
<p>Running the example creates a new file in the current working directory with the cleaned text called <em>english-german.pkl</em>.</p>
<p>Some examples of the clean text are printed for us to evaluate at the end of the run to confirm that the clean operations were performed as expected.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615d0600850497" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
[hi] =&gt; [hallo]
[hi] =&gt; [gru gott]
[run] =&gt; [lauf]
[wow] =&gt; [potzdonner]
[wow] =&gt; [donnerwetter]
[fire] =&gt; [feuer]
[help] =&gt; [hilfe]
[help] =&gt; [zu hulf]
[stop] =&gt; [stopp]
[wait] =&gt; [warte]
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615d0600850497-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d0600850497-2">2</div><div class="crayon-num" data-line="crayon-5a658917615d0600850497-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d0600850497-4">4</div><div class="crayon-num" data-line="crayon-5a658917615d0600850497-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d0600850497-6">6</div><div class="crayon-num" data-line="crayon-5a658917615d0600850497-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d0600850497-8">8</div><div class="crayon-num" data-line="crayon-5a658917615d0600850497-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d0600850497-10">10</div><div class="crayon-num" data-line="crayon-5a658917615d0600850497-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615d0600850497-1">[hi] =&gt; [hallo]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d0600850497-2">[hi] =&gt; [gru gott]</div><div class="crayon-line" id="crayon-5a658917615d0600850497-3">[run] =&gt; [lauf]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d0600850497-4">[wow] =&gt; [potzdonner]</div><div class="crayon-line" id="crayon-5a658917615d0600850497-5">[wow] =&gt; [donnerwetter]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d0600850497-6">[fire] =&gt; [feuer]</div><div class="crayon-line" id="crayon-5a658917615d0600850497-7">[help] =&gt; [hilfe]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d0600850497-8">[help] =&gt; [zu hulf]</div><div class="crayon-line" id="crayon-5a658917615d0600850497-9">[stop] =&gt; [stopp]</div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d0600850497-10">[wait] =&gt; [warte]</div><div class="crayon-line" id="crayon-5a658917615d0600850497-11">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>2. Split Text</h3>
<p>The clean data contains a little over 150,000 phrase pairs and some of the pairs toward the end of the file are very long.</p>
<p>This is a good number of examples for developing a small translation model. The complexity of the model increases with the number of examples, length of phrases, and size of the vocabulary.</p>
<p>Although we have a good dataset for modeling translation, we will simplify the problem slightly to dramatically reduce the size of the model required, and in turn the training time required to fit the model.</p>
<p>You can explore developing a model on the fuller dataset as an extension; I would love to hear how you do.</p>
<p>We will simplify the problem by reducing the dataset to the first 10,000 examples in the file; these will be the shortest phrases in the dataset.</p>
<p>Further, we will then stake the first 9,000 of those as examples for training and the remaining 1,000 examples to test the fit model.</p>
<p>Below is the complete example of loading the clean data, splitting it, and saving the split portions of data to new files.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615d3321225846" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from pickle import dump
from numpy.random import rand
from numpy.random import shuffle

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# save a list of clean sentences to file
def save_clean_data(sentences, filename):
	dump(sentences, open(filename, 'wb'))
	print('Saved: %s' % filename)

# load dataset
raw_dataset = load_clean_sentences('english-german.pkl')

# reduce dataset size
n_sentences = 10000
dataset = raw_dataset[:n_sentences, :]
# random shuffle
shuffle(dataset)
# split into train/test
train, test = dataset[:9000], dataset[9000:]
# save
save_clean_data(dataset, 'english-german-both.pkl')
save_clean_data(train, 'english-german-train.pkl')
save_clean_data(test, 'english-german-test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615d3321225846-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-2">2</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-4">4</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-6">6</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-8">8</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-10">10</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-12">12</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-14">14</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-16">16</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-18">18</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-20">20</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-22">22</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-24">24</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-26">26</div><div class="crayon-num" data-line="crayon-5a658917615d3321225846-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d3321225846-28">28</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615d3321225846-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-2"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">dump</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-3"><span class="crayon-e">from </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-e">rand</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-4"><span class="crayon-e">from </span><span class="crayon-v">numpy</span><span class="crayon-sy">.</span><span class="crayon-e">random </span><span class="crayon-e">import </span><span class="crayon-v">shuffle</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-6"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-7"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-8"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-9"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-10"><span class="crayon-p"># save a list of clean sentences to file</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-11"><span class="crayon-e">def </span><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-12"><span class="crayon-h"> </span><span class="crayon-e">dump</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-13"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Saved: %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-14"> </div><div class="crayon-line" id="crayon-5a658917615d3321225846-15"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-16"><span class="crayon-v">raw_dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-17"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-18"><span class="crayon-p"># reduce dataset size</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-19"><span class="crayon-v">n_sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10000</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-20"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-21"><span class="crayon-p"># random shuffle</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-22"><span class="crayon-e">shuffle</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-23"><span class="crayon-p"># split into train/test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-24"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">9000</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">9000</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-25"><span class="crayon-p"># save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-26"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d3321225846-27"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d3321225846-28"><span class="crayon-e">save_clean_data</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the example creates three new files: the <em>english-german-both.pkl</em> that contains all of the train and test examples that we can use to define the parameters of the problem, such as max phrase lengths and the vocabulary, and the <em>english-german-train.pkl</em> and <em>english-german-test.pkl</em> files for the train and test dataset.</p>
<p>We are now ready to start developing our translation model.</p>
<h2>Train Neural Translation Model</h2>
<p>In this section, we will develop the translation model.</p>
<p>This involves both loading and preparing the clean text data ready for modeling and defining and training the model on the prepared data.</p>
<p>Let’s start off by loading the datasets so that we can prepare the data. The function below named <em>load_clean_sentences()</em> can be used to load the train, test, and both datasets in turn.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615d6058515304" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615d6058515304-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d6058515304-2">2</div><div class="crayon-num" data-line="crayon-5a658917615d6058515304-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d6058515304-4">4</div><div class="crayon-num" data-line="crayon-5a658917615d6058515304-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d6058515304-6">6</div><div class="crayon-num" data-line="crayon-5a658917615d6058515304-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d6058515304-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615d6058515304-1"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d6058515304-2"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615d6058515304-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d6058515304-4"> </div><div class="crayon-line" id="crayon-5a658917615d6058515304-5"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d6058515304-6"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d6058515304-7"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d6058515304-8"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We will use the “both” or combination of the train and test datasets to define the maximum length and vocabulary of the problem.</p>
<p>This is for simplicity. Alternately, we could define these properties from the training dataset alone and truncate examples in the test set that are too long or have words that are out of the vocabulary.</p>
<p>We can use the Keras <em>Tokenize</em> class to map words to integers, as needed for modeling. We will use separate tokenizer for the English sequences and the German sequences. The function below-named <em>create_tokenizer()</em> will train a tokenizer on a list of phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615d9445714879" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615d9445714879-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d9445714879-2">2</div><div class="crayon-num" data-line="crayon-5a658917615d9445714879-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615d9445714879-4">4</div><div class="crayon-num" data-line="crayon-5a658917615d9445714879-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615d9445714879-1"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d9445714879-2"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615d9445714879-3"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615d9445714879-4"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615d9445714879-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Similarly, the function named <em>max_length()</em> below will find the length of the longest sequence in a list of phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615db016719752" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615db016719752-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615db016719752-2">2</div><div class="crayon-num" data-line="crayon-5a658917615db016719752-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615db016719752-1"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615db016719752-2"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615db016719752-3"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can call these functions with the combined dataset to prepare tokenizers, vocabulary sizes, and maximum lengths for both the English and German phrases.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615de149352545" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
print('English Vocabulary Size: %d' % eng_vocab_size)
print('English Max Length: %d' % (eng_length))
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
print('German Vocabulary Size: %d' % ger_vocab_size)
print('German Max Length: %d' % (ger_length))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615de149352545-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-2">2</div><div class="crayon-num" data-line="crayon-5a658917615de149352545-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-4">4</div><div class="crayon-num" data-line="crayon-5a658917615de149352545-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-6">6</div><div class="crayon-num" data-line="crayon-5a658917615de149352545-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-8">8</div><div class="crayon-num" data-line="crayon-5a658917615de149352545-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-10">10</div><div class="crayon-num" data-line="crayon-5a658917615de149352545-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615de149352545-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615de149352545-1"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-2"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615de149352545-3"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-4"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615de149352545-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-6"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">eng_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615de149352545-7"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-8"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615de149352545-9"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-10"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615de149352545-11"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615de149352545-12"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ger_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>We are now ready to prepare the training dataset.</p>
<p>Each input and output sequence must be encoded to integers and padded to the maximum phrase length. This is because we will use a word embedding for the input sequences and one hot encode the output sequences The function below named <em>encode_sequences()</em> will perform these operations and return the result.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615e0382163585" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615e0382163585-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e0382163585-2">2</div><div class="crayon-num" data-line="crayon-5a658917615e0382163585-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e0382163585-4">4</div><div class="crayon-num" data-line="crayon-5a658917615e0382163585-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e0382163585-6">6</div><div class="crayon-num" data-line="crayon-5a658917615e0382163585-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615e0382163585-1"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e0382163585-2"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615e0382163585-3"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e0382163585-4"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e0382163585-5"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e0382163585-6"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e0382163585-7"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The output sequence needs to be one-hot encoded. This is because the model will predict the probability of each word in the vocabulary as output.</p>
<p>The function <em>encode_output()</em> below will one-hot encode English output sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615e3538539651" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# one hot encode target sequence
def encode_output(sequences, vocab_size):
	ylist = list()
	for sequence in sequences:
		encoded = to_categorical(sequence, num_classes=vocab_size)
		ylist.append(encoded)
	y = array(ylist)
	y = y.reshape(sequences.shape[0], sequences.shape[1], vocab_size)
	return y</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615e3538539651-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e3538539651-2">2</div><div class="crayon-num" data-line="crayon-5a658917615e3538539651-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e3538539651-4">4</div><div class="crayon-num" data-line="crayon-5a658917615e3538539651-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e3538539651-6">6</div><div class="crayon-num" data-line="crayon-5a658917615e3538539651-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e3538539651-8">8</div><div class="crayon-num" data-line="crayon-5a658917615e3538539651-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615e3538539651-1"><span class="crayon-p"># one hot encode target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e3538539651-2"><span class="crayon-e">def </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615e3538539651-3"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e3538539651-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">sequence </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658917615e3538539651-5"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e3538539651-6"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e3538539651-7"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">ylist</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e3538539651-8"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e3538539651-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can make use of these two functions and prepare both the train and test dataset ready for training the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658917615e5466343911" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# prepare training data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
trainY = encode_sequences(eng_tokenizer, eng_length, train[:, 0])
trainY = encode_output(trainY, eng_vocab_size)
# prepare validation data
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])
testY = encode_sequences(eng_tokenizer, eng_length, test[:, 0])
testY = encode_output(testY, eng_vocab_size)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658917615e5466343911-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e5466343911-2">2</div><div class="crayon-num" data-line="crayon-5a658917615e5466343911-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e5466343911-4">4</div><div class="crayon-num" data-line="crayon-5a658917615e5466343911-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e5466343911-6">6</div><div class="crayon-num" data-line="crayon-5a658917615e5466343911-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658917615e5466343911-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658917615e5466343911-1"><span class="crayon-p"># prepare training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e5466343911-2"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e5466343911-3"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e5466343911-4"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e5466343911-5"><span class="crayon-p"># prepare validation data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e5466343911-6"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658917615e5466343911-7"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658917615e5466343911-8"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We are now ready to define the model.</p>
<p>We will use an encoder-decoder LSTM model on this problem. In this architecture, the input sequence is encoded by a front-end model called the encoder then decoded word by word by a backend model called the decoder.</p>
<p>The function <em>define_model()</em> below defines the model and takes a number of arguments used to configure the model, such as the size of the input and output vocabularies, the maximum length of input and output phrases, and the number of memory units used to configure the model.</p>
<p>The model is trained using the efficient Adam approach to stochastic gradient descent and minimizes the categorical loss function because we have framed the prediction problem as multi-class classification.</p>
<p>The model configuration was not optimized for this problem, meaning that there is plenty of opportunity for you to tune it and lift the skill of the translations. I would love to see what you can come up with.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761620164472084" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define NMT model
def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):
	model = Sequential()
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))
	model.add(LSTM(n_units))
	model.add(RepeatVector(tar_timesteps))
	model.add(LSTM(n_units, return_sequences=True))
	model.add(TimeDistributed(Dense(tar_vocab, activation='softmax')))
	return model

# define model
model = define_model(ger_vocab_size, eng_vocab_size, ger_length, eng_length, 256)
model.compile(optimizer='adam', loss='categorical_crossentropy')
# summarize defined model
print(model.summary())
plot_model(model, to_file='model.png', show_shapes=True)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761620164472084-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-2">2</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-4">4</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-6">6</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-8">8</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-10">10</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-12">12</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-14">14</div><div class="crayon-num" data-line="crayon-5a65891761620164472084-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761620164472084-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761620164472084-1"><span class="crayon-p"># define NMT model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-2"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-3"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-4"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mask_zero</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-5"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-6"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-7"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-8"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-10"> </div><div class="crayon-line" id="crayon-5a65891761620164472084-11"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-12"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-13"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-14"><span class="crayon-p"># summarize defined model</span></div><div class="crayon-line" id="crayon-5a65891761620164472084-15"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761620164472084-16"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Finally, we can train the model.</p>
<p>We train the model for 30 epochs and a batch size of 64 examples.</p>
<p>We use checkpointing to ensure that each time the model skill on the test set improves, the model is saved to file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761623003318315" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# fit model
filename = 'model.h5'
checkpoint = ModelCheckpoint(filename, monitor='val_loss', verbose=1, save_best_only=True, mode='min')
model.fit(trainX, trainY, epochs=30, batch_size=64, validation_data=(testX, testY), callbacks=[checkpoint], verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761623003318315-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761623003318315-2">2</div><div class="crayon-num" data-line="crayon-5a65891761623003318315-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761623003318315-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761623003318315-1"><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761623003318315-2"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'model.h5'</span></div><div class="crayon-line" id="crayon-5a65891761623003318315-3"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761623003318315-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>We can tie all of this together and fit the neural translation model.</p>
<p>The complete working example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761626796335776" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.utils import to_categorical
from keras.utils.vis_utils import plot_model
from keras.models import Sequential
from keras.layers import LSTM
from keras.layers import Dense
from keras.layers import Embedding
from keras.layers import RepeatVector
from keras.layers import TimeDistributed
from keras.callbacks import ModelCheckpoint

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)

# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X

# one hot encode target sequence
def encode_output(sequences, vocab_size):
	ylist = list()
	for sequence in sequences:
		encoded = to_categorical(sequence, num_classes=vocab_size)
		ylist.append(encoded)
	y = array(ylist)
	y = y.reshape(sequences.shape[0], sequences.shape[1], vocab_size)
	return y

# define NMT model
def define_model(src_vocab, tar_vocab, src_timesteps, tar_timesteps, n_units):
	model = Sequential()
	model.add(Embedding(src_vocab, n_units, input_length=src_timesteps, mask_zero=True))
	model.add(LSTM(n_units))
	model.add(RepeatVector(tar_timesteps))
	model.add(LSTM(n_units, return_sequences=True))
	model.add(TimeDistributed(Dense(tar_vocab, activation='softmax')))
	return model

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')

# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
print('English Vocabulary Size: %d' % eng_vocab_size)
print('English Max Length: %d' % (eng_length))
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
print('German Vocabulary Size: %d' % ger_vocab_size)
print('German Max Length: %d' % (ger_length))

# prepare training data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
trainY = encode_sequences(eng_tokenizer, eng_length, train[:, 0])
trainY = encode_output(trainY, eng_vocab_size)
# prepare validation data
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])
testY = encode_sequences(eng_tokenizer, eng_length, test[:, 0])
testY = encode_output(testY, eng_vocab_size)

# define model
model = define_model(ger_vocab_size, eng_vocab_size, ger_length, eng_length, 256)
model.compile(optimizer='adam', loss='categorical_crossentropy')
# summarize defined model
print(model.summary())
plot_model(model, to_file='model.png', show_shapes=True)
# fit model
filename = 'model.h5'
checkpoint = ModelCheckpoint(filename, monitor='val_loss', verbose=1, save_best_only=True, mode='min')
model.fit(trainX, trainY, epochs=30, batch_size=64, validation_data=(testX, testY), callbacks=[checkpoint], verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761626796335776-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-2">2</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-4">4</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-6">6</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-8">8</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-10">10</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-12">12</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-14">14</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-16">16</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-18">18</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-20">20</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-22">22</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-24">24</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-26">26</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-28">28</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-30">30</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-32">32</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-34">34</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-36">36</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-38">38</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-40">40</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-42">42</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-44">44</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-46">46</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-48">48</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-50">50</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-52">52</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-54">54</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-56">56</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-58">58</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-60">60</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-62">62</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-64">64</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-66">66</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-68">68</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-70">70</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-72">72</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-74">74</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-76">76</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-78">78</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-80">80</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-82">82</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-84">84</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-86">86</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-88">88</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-90">90</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761626796335776-92">92</div><div class="crayon-num" data-line="crayon-5a65891761626796335776-93">93</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761626796335776-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-3"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">utils </span><span class="crayon-e">import </span><span class="crayon-e">to_categorical</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">utils</span><span class="crayon-sy">.</span><span class="crayon-e">vis_utils </span><span class="crayon-e">import </span><span class="crayon-e">plot_model</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">callbacks </span><span class="crayon-e">import </span><span class="crayon-v">ModelCheckpoint</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-14"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-15"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-16"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-18"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-19"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-20"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-21"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-22"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-24"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-25"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-26"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-27"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-28"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-29"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-30"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-31"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-32"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-33"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-34"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-36"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-37"><span class="crayon-p"># one hot encode target sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-38"><span class="crayon-e">def </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-39"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-40"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">sequence </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-41"><span class="crayon-h"> </span><span class="crayon-v">encoded</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_categorical</span><span class="crayon-sy">(</span><span class="crayon-v">sequence</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">num_classes</span><span class="crayon-o">=</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-42"><span class="crayon-h"> </span><span class="crayon-v">ylist</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">encoded</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-43"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">ylist</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-44"><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sequences</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-45"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">y</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-46"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-47"><span class="crayon-p"># define NMT model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-48"><span class="crayon-e">def </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-49"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-50"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">src_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">src_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mask_zero</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-51"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-52"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">tar_timesteps</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-53"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-v">n_units</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-54"><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">tar_vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'softmax'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-56"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-57"><span class="crayon-p"># load datasets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-58"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-59"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-60"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-61"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-62"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-63"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-64"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-65"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-66"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-67"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'English Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">eng_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-68"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-69"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-70"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-71"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-72"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Vocabulary Size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-73"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'German Max Length: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ger_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-74"> </div><div class="crayon-line" id="crayon-5a65891761626796335776-75"><span class="crayon-p"># prepare training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-76"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-77"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-78"><span class="crayon-v">trainY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-79"><span class="crayon-p"># prepare validation data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-80"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-81"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-82"><span class="crayon-v">testY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_output</span><span class="crayon-sy">(</span><span class="crayon-v">testY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-84"><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-85"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">define_model</span><span class="crayon-sy">(</span><span class="crayon-v">ger_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">256</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-86"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-87"><span class="crayon-p"># summarize defined model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-88"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-89"><span class="crayon-e">plot_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">to_file</span><span class="crayon-o">=</span><span class="crayon-s">'model.png'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">show_shapes</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-90"><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-91"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'model.h5'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761626796335776-92"><span class="crayon-v">checkpoint</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ModelCheckpoint</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">monitor</span><span class="crayon-o">=</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">save_best_only</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mode</span><span class="crayon-o">=</span><span class="crayon-s">'min'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761626796335776-93"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainY</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testY</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callbacks</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">checkpoint</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0077 seconds] -->
<p>Running the example first prints a summary of the parameters of the dataset such as vocabulary size and maximum phrase lengths.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176162a337264646" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
English Vocabulary Size: 2404
English Max Length: 5
German Vocabulary Size: 3856
German Max Length: 10</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176162a337264646-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176162a337264646-2">2</div><div class="crayon-num" data-line="crayon-5a6589176162a337264646-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176162a337264646-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176162a337264646-1">English Vocabulary Size: 2404</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176162a337264646-2">English Max Length: 5</div><div class="crayon-line" id="crayon-5a6589176162a337264646-3">German Vocabulary Size: 3856</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176162a337264646-4">German Max Length: 10</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, a summary of the defined model is printed, allowing us to confirm the model configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761631325168330" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_1 (Embedding)      (None, 10, 256)           987136
_________________________________________________________________
lstm_1 (LSTM)                (None, 256)               525312
_________________________________________________________________
repeat_vector_1 (RepeatVecto (None, 5, 256)            0
_________________________________________________________________
lstm_2 (LSTM)                (None, 5, 256)            525312
_________________________________________________________________
time_distributed_1 (TimeDist (None, 5, 2404)           617828
=================================================================
Total params: 2,655,588
Trainable params: 2,655,588
Non-trainable params: 0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761631325168330-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-2">2</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-4">4</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-6">6</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-8">8</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-10">10</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-12">12</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-14">14</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761631325168330-16">16</div><div class="crayon-num" data-line="crayon-5a65891761631325168330-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761631325168330-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5a65891761631325168330-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-4">embedding_1 (Embedding)      (None, 10, 256)           987136</div><div class="crayon-line" id="crayon-5a65891761631325168330-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-6">lstm_1 (LSTM)                (None, 256)               525312</div><div class="crayon-line" id="crayon-5a65891761631325168330-7">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-8">repeat_vector_1 (RepeatVecto (None, 5, 256)            0</div><div class="crayon-line" id="crayon-5a65891761631325168330-9">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-10">lstm_2 (LSTM)                (None, 5, 256)            525312</div><div class="crayon-line" id="crayon-5a65891761631325168330-11">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-12">time_distributed_1 (TimeDist (None, 5, 2404)           617828</div><div class="crayon-line" id="crayon-5a65891761631325168330-13">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-14">Total params: 2,655,588</div><div class="crayon-line" id="crayon-5a65891761631325168330-15">Trainable params: 2,655,588</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761631325168330-16">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5a65891761631325168330-17">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A plot of the model is also created providing another perspective on the model configuration.</p>
<div class="wp-caption aligncenter" id="attachment_4580" style="max-width: 665px"><img alt="Plot of Model Graph for NMT" class="size-full wp-image-4580" height="627" sizes="(max-width: 655px) 100vw, 655px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT.png 655w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/Plot-of-Model-Graph-for-NMT-300x287.png 300w" width="655"/><p class="wp-caption-text">Plot of Model Graph for NMT</p></div>
<p>Next, the model is trained.</p>
<p>Each epoch takes about 30 seconds on modern CPU hardware; no GPU is required.</p>
<p>During the run, the model will be saved to the file <em>model.h5</em>, ready for inference in the next step.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761634133622107" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 26/30
Epoch 00025: val_loss improved from 2.20048 to 2.19976, saving model to model.h5
17s - loss: 0.7114 - val_loss: 2.1998
Epoch 27/30
Epoch 00026: val_loss improved from 2.19976 to 2.18255, saving model to model.h5
17s - loss: 0.6532 - val_loss: 2.1826
Epoch 28/30
Epoch 00027: val_loss did not improve
17s - loss: 0.5970 - val_loss: 2.1970
Epoch 29/30
Epoch 00028: val_loss improved from 2.18255 to 2.17872, saving model to model.h5
17s - loss: 0.5474 - val_loss: 2.1787
Epoch 30/30
Epoch 00029: val_loss did not improve
17s - loss: 0.5023 - val_loss: 2.1823</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761634133622107-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-2">2</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-4">4</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-6">6</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-8">8</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-10">10</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-12">12</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-14">14</div><div class="crayon-num" data-line="crayon-5a65891761634133622107-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761634133622107-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761634133622107-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-2">Epoch 26/30</div><div class="crayon-line" id="crayon-5a65891761634133622107-3">Epoch 00025: val_loss improved from 2.20048 to 2.19976, saving model to model.h5</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-4">17s - loss: 0.7114 - val_loss: 2.1998</div><div class="crayon-line" id="crayon-5a65891761634133622107-5">Epoch 27/30</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-6">Epoch 00026: val_loss improved from 2.19976 to 2.18255, saving model to model.h5</div><div class="crayon-line" id="crayon-5a65891761634133622107-7">17s - loss: 0.6532 - val_loss: 2.1826</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-8">Epoch 28/30</div><div class="crayon-line" id="crayon-5a65891761634133622107-9">Epoch 00027: val_loss did not improve</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-10">17s - loss: 0.5970 - val_loss: 2.1970</div><div class="crayon-line" id="crayon-5a65891761634133622107-11">Epoch 29/30</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-12">Epoch 00028: val_loss improved from 2.18255 to 2.17872, saving model to model.h5</div><div class="crayon-line" id="crayon-5a65891761634133622107-13">17s - loss: 0.5474 - val_loss: 2.1787</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-14">Epoch 30/30</div><div class="crayon-line" id="crayon-5a65891761634133622107-15">Epoch 00029: val_loss did not improve</div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761634133622107-16">17s - loss: 0.5023 - val_loss: 2.1823</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Evaluate Neural Translation Model</h2>
<p>We will evaluate the model on the train and the test dataset.</p>
<p>The model should perform very well on the train dataset and ideally have been generalized to perform well on the test dataset.</p>
<p>Ideally, we would use a separate validation dataset to help with model selection during training instead of the test set. You can try this as an extension.</p>
<p>The clean datasets must be loaded and prepared as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761637292604220" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
# prepare data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761637292604220-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-2">2</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-4">4</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-6">6</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-8">8</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-10">10</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-12">12</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-14">14</div><div class="crayon-num" data-line="crayon-5a65891761637292604220-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761637292604220-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761637292604220-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-2"><span class="crayon-p"># load datasets</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-3"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-4"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-5"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-6"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-7"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-8"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-9"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-10"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-11"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-12"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-13"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-14"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5a65891761637292604220-15"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761637292604220-16"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Next, the best model saved during training must be loaded.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176163a097695729" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load model
model = load_model('model.h5')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176163a097695729-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176163a097695729-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176163a097695729-1"><span class="crayon-p"># load model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176163a097695729-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Evaluation involves two steps: first generating a translated output sequence, and then repeating this process for many input examples and summarizing the skill of the model across multiple cases.</p>
<p>Starting with inference, the model can predict the entire output sequence in a one-shot manner.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176163c620324105" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
translation = model.predict(source, verbose=0)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176163c620324105-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176163c620324105-1"><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This will be a sequence of integers that we can enumerate and lookup in the tokenizer to map back to words.</p>
<p>The function below, named <em>word_for_id()</em>, will perform this reverse mapping.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176163e477700673" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# map an integer to a word
def word_for_id(integer, tokenizer):
	for word, index in tokenizer.word_index.items():
		if index == integer:
			return word
	return None</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176163e477700673-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176163e477700673-2">2</div><div class="crayon-num" data-line="crayon-5a6589176163e477700673-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176163e477700673-4">4</div><div class="crayon-num" data-line="crayon-5a6589176163e477700673-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176163e477700673-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176163e477700673-1"><span class="crayon-p"># map an integer to a word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176163e477700673-2"><span class="crayon-e">def </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-t">integer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6589176163e477700673-3"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176163e477700673-4"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">integer</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6589176163e477700673-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176163e477700673-6"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can perform this mapping for each integer in the translation and return the result as a string of words.</p>
<p>The function <em>predict_sequence()</em> below performs this operation for a single encoded source phrase.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761641048993557" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# generate target given source sequence
def predict_sequence(model, tokenizer, source):
	prediction = model.predict(source, verbose=0)[0]
	integers = [argmax(vector) for vector in prediction]
	target = list()
	for i in integers:
		word = word_for_id(i, tokenizer)
		if word is None:
			break
		target.append(word)
	return ' '.join(target)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761641048993557-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761641048993557-2">2</div><div class="crayon-num" data-line="crayon-5a65891761641048993557-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761641048993557-4">4</div><div class="crayon-num" data-line="crayon-5a65891761641048993557-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761641048993557-6">6</div><div class="crayon-num" data-line="crayon-5a65891761641048993557-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761641048993557-8">8</div><div class="crayon-num" data-line="crayon-5a65891761641048993557-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761641048993557-10">10</div><div class="crayon-num" data-line="crayon-5a65891761641048993557-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761641048993557-1"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761641048993557-2"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761641048993557-3"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761641048993557-4"><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65891761641048993557-5"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761641048993557-6"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761641048993557-7"><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761641048993557-8"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761641048993557-9"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761641048993557-10"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761641048993557-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Next, we can repeat this for each source phrase in a dataset and compare the predicted result to the expected target phrase in English.</p>
<p>We can print some of these comparisons to screen to get an idea of how the model performs in practice.</p>
<p>We will also calculate the BLEU scores to get a quantitative idea of how well the model has performed.</p>
<p>The <em>evaluate_model()</em> function below implements this, calling the above <em>predict_sequence()</em> function for each phrase in a provided dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761643889547328" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate the skill of the model
def evaluate_model(model, tokenizer, sources, raw_dataset):
	actual, predicted = list(), list()
	for i, source in enumerate(sources):
		# translate encoded source text
		source = source.reshape((1, source.shape[0]))
		translation = predict_sequence(model, eng_tokenizer, source)
		raw_target, raw_src = raw_dataset[i]
		if i &lt; 10:
			print('src=[%s], target=[%s], predicted=[%s]' % (raw_src, raw_target, translation))
		actual.append(raw_target.split())
		predicted.append(translation.split())
	# calculate BLEU score
	print('BLEU-1: %f' % corpus_bleu(actual, predicted, weights=(1.0, 0, 0, 0)))
	print('BLEU-2: %f' % corpus_bleu(actual, predicted, weights=(0.5, 0.5, 0, 0)))
	print('BLEU-3: %f' % corpus_bleu(actual, predicted, weights=(0.3, 0.3, 0.3, 0)))
	print('BLEU-4: %f' % corpus_bleu(actual, predicted, weights=(0.25, 0.25, 0.25, 0.25)))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761643889547328-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-2">2</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-4">4</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-6">6</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-8">8</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-10">10</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-12">12</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-14">14</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761643889547328-16">16</div><div class="crayon-num" data-line="crayon-5a65891761643889547328-17">17</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761643889547328-1"><span class="crayon-p"># evaluate the skill of the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sources</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-3"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-4"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">source </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">sources</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-5"><span class="crayon-h"> </span><span class="crayon-p"># translate encoded source text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-6"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-7"><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-8"><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-10"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'src=[%s], target=[%s], predicted=[%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">raw_src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-11"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">raw_target</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-12"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">translation</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-13"><span class="crayon-h"> </span><span class="crayon-p"># calculate BLEU score</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-14"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-1: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-15"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-2: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761643889547328-16"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-3: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761643889547328-17"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-4: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>We can tie all of this together and evaluate the loaded model on both the training and test datasets.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65891761646328261886" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pickle import load
from numpy import array
from numpy import argmax
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import load_model
from nltk.translate.bleu_score import corpus_bleu

# load a clean dataset
def load_clean_sentences(filename):
	return load(open(filename, 'rb'))

# fit a tokenizer
def create_tokenizer(lines):
	tokenizer = Tokenizer()
	tokenizer.fit_on_texts(lines)
	return tokenizer

# max sentence length
def max_length(lines):
	return max(len(line.split()) for line in lines)

# encode and pad sequences
def encode_sequences(tokenizer, length, lines):
	# integer encode sequences
	X = tokenizer.texts_to_sequences(lines)
	# pad sequences with 0 values
	X = pad_sequences(X, maxlen=length, padding='post')
	return X

# map an integer to a word
def word_for_id(integer, tokenizer):
	for word, index in tokenizer.word_index.items():
		if index == integer:
			return word
	return None

# generate target given source sequence
def predict_sequence(model, tokenizer, source):
	prediction = model.predict(source, verbose=0)[0]
	integers = [argmax(vector) for vector in prediction]
	target = list()
	for i in integers:
		word = word_for_id(i, tokenizer)
		if word is None:
			break
		target.append(word)
	return ' '.join(target)

# evaluate the skill of the model
def evaluate_model(model, tokenizer, sources, raw_dataset):
	actual, predicted = list(), list()
	for i, source in enumerate(sources):
		# translate encoded source text
		source = source.reshape((1, source.shape[0]))
		translation = predict_sequence(model, eng_tokenizer, source)
		raw_target, raw_src = raw_dataset[i]
		if i &lt; 10:
			print('src=[%s], target=[%s], predicted=[%s]' % (raw_src, raw_target, translation))
		actual.append(raw_target.split())
		predicted.append(translation.split())
	# calculate BLEU score
	print('BLEU-1: %f' % corpus_bleu(actual, predicted, weights=(1.0, 0, 0, 0)))
	print('BLEU-2: %f' % corpus_bleu(actual, predicted, weights=(0.5, 0.5, 0, 0)))
	print('BLEU-3: %f' % corpus_bleu(actual, predicted, weights=(0.3, 0.3, 0.3, 0)))
	print('BLEU-4: %f' % corpus_bleu(actual, predicted, weights=(0.25, 0.25, 0.25, 0.25)))

# load datasets
dataset = load_clean_sentences('english-german-both.pkl')
train = load_clean_sentences('english-german-train.pkl')
test = load_clean_sentences('english-german-test.pkl')
# prepare english tokenizer
eng_tokenizer = create_tokenizer(dataset[:, 0])
eng_vocab_size = len(eng_tokenizer.word_index) + 1
eng_length = max_length(dataset[:, 0])
# prepare german tokenizer
ger_tokenizer = create_tokenizer(dataset[:, 1])
ger_vocab_size = len(ger_tokenizer.word_index) + 1
ger_length = max_length(dataset[:, 1])
# prepare data
trainX = encode_sequences(ger_tokenizer, ger_length, train[:, 1])
testX = encode_sequences(ger_tokenizer, ger_length, test[:, 1])

# load model
model = load_model('model.h5')
# test on some training sequences
print('train')
evaluate_model(model, eng_tokenizer, trainX, train)
# test on some test sequences
print('test')
evaluate_model(model, eng_tokenizer, testX, test)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65891761646328261886-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-2">2</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-4">4</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-6">6</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-8">8</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-10">10</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-12">12</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-14">14</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-16">16</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-18">18</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-20">20</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-22">22</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-24">24</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-26">26</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-28">28</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-30">30</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-32">32</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-34">34</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-36">36</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-38">38</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-40">40</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-42">42</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-44">44</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-46">46</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-48">48</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-50">50</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-52">52</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-54">54</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-56">56</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-58">58</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-60">60</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-62">62</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-64">64</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-66">66</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-68">68</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-70">70</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-72">72</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-74">74</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-76">76</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-78">78</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-80">80</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-82">82</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-84">84</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-86">86</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-88">88</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65891761646328261886-90">90</div><div class="crayon-num" data-line="crayon-5a65891761646328261886-91">91</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65891761646328261886-1"><span class="crayon-e">from </span><span class="crayon-e">pickle </span><span class="crayon-e">import </span><span class="crayon-e">load</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">argmax</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">load_model</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-7"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-v">translate</span><span class="crayon-sy">.</span><span class="crayon-e">bleu_score </span><span class="crayon-e">import </span><span class="crayon-v">corpus_bleu</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-8"> </div><div class="crayon-line" id="crayon-5a65891761646328261886-9"><span class="crayon-p"># load a clean dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-10"><span class="crayon-e">def </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rb'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-12"> </div><div class="crayon-line" id="crayon-5a65891761646328261886-13"><span class="crayon-p"># fit a tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-14"><span class="crayon-e">def </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-15"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-16"><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-17"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-18"> </div><div class="crayon-line" id="crayon-5a65891761646328261886-19"><span class="crayon-p"># max sentence length</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-20"><span class="crayon-e">def </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-22"> </div><div class="crayon-line" id="crayon-5a65891761646328261886-23"><span class="crayon-p"># encode and pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-24"><span class="crayon-e">def </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-25"><span class="crayon-h"> </span><span class="crayon-p"># integer encode sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-26"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-27"><span class="crayon-h"> </span><span class="crayon-p"># pad sequences with 0 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-28"><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-29"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">X</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-30"> </div><div class="crayon-line" id="crayon-5a65891761646328261886-31"><span class="crayon-p"># map an integer to a word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-32"><span class="crayon-e">def </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-t">integer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-33"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">index </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">integer</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">word</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-38"><span class="crayon-p"># generate target given source sequence</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-39"><span class="crayon-e">def </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-40"><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-41"><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">argmax</span><span class="crayon-sy">(</span><span class="crayon-v">vector</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">prediction</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-42"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-43"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">integers</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-44"><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">word_for_id</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-46"><span class="crayon-h"> </span><span class="crayon-st">break</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-47"><span class="crayon-h"> </span><span class="crayon-v">target</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-48"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">target</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-49"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-50"><span class="crayon-p"># evaluate the skill of the model</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-51"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sources</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-52"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-53"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">source </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">enumerate</span><span class="crayon-sy">(</span><span class="crayon-v">sources</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-54"><span class="crayon-h"> </span><span class="crayon-p"># translate encoded source text</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-55"><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-56"><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">predict_sequence</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-57"><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_src</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">raw_dataset</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-58"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-59"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'src=[%s], target=[%s], predicted=[%s]'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">raw_src</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">raw_target</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">translation</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-60"><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">raw_target</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-61"><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">translation</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-62"><span class="crayon-h"> </span><span class="crayon-p"># calculate BLEU score</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-63"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-1: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-64"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-2: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-65"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-3: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-66"><span class="crayon-h"> </span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'BLEU-4: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">corpus_bleu</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.25</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-67"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-68"><span class="crayon-p"># load datasets</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-69"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-both.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-70"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-train.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-71"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_clean_sentences</span><span class="crayon-sy">(</span><span class="crayon-s">'english-german-test.pkl'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-72"><span class="crayon-p"># prepare english tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-73"><span class="crayon-v">eng_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-74"><span class="crayon-v">eng_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-75"><span class="crayon-v">eng_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-76"><span class="crayon-p"># prepare german tokenizer</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-77"><span class="crayon-v">ger_tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_tokenizer</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-78"><span class="crayon-v">ger_vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-79"><span class="crayon-v">ger_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max_length</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-80"><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-81"><span class="crayon-v">trainX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-82"><span class="crayon-v">testX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">encode_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">ger_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ger_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-84"><span class="crayon-p"># load model</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-85"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_model</span><span class="crayon-sy">(</span><span class="crayon-s">'model.h5'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-86"><span class="crayon-p"># test on some training sequences</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-87"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-88"><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-89"><span class="crayon-p"># test on some test sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65891761646328261886-90"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65891761646328261886-91"><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eng_tokenizer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">testX</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0083 seconds] -->
<p>Running the example first prints examples of source text, expected and predicted translations, as well as scores for the training dataset, followed by the test dataset.</p>
<p>Your specific results will differ given the random shuffling of the dataset and the stochastic nature of neural networks.</p>
<p>Looking at the results for the test dataset first, we can see that the translations are readable and mostly correct.</p>
<p>For example: “<em>ich liebe dich</em>” was correctly translated to “<em>i love you</em>“.</p>
<p>We can also see that the translations were not perfect, with “<em>ich konnte nicht gehen</em>” translated to “<em>i cant go</em>” instead of the expected “<em>i couldnt walk</em>“.</p>
<p>We can also see the BLEU-4 score of 0.51, which provides an upper bound on what we might expect from this model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176164b122401076" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
src=[ich liebe dich], target=[i love you], predicted=[i love you]
src=[ich sagte du sollst den mund halten], target=[i said shut up], predicted=[i said stop up]
src=[wie geht es eurem vater], target=[hows your dad], predicted=[hows your dad]
src=[das gefallt mir], target=[i like that], predicted=[i like that]
src=[ich gehe immer zu fu], target=[i always walk], predicted=[i will to]
src=[ich konnte nicht gehen], target=[i couldnt walk], predicted=[i cant go]
src=[er ist sehr jung], target=[he is very young], predicted=[he is very young]
src=[versucht es doch einfach], target=[just try it], predicted=[just try it]
src=[sie sind jung], target=[youre young], predicted=[youre young]
src=[er ging surfen], target=[he went surfing], predicted=[he went surfing]

BLEU-1: 0.085682
BLEU-2: 0.284191
BLEU-3: 0.459090
BLEU-4: 0.517571</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176164b122401076-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-2">2</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-4">4</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-6">6</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-8">8</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-10">10</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-12">12</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164b122401076-14">14</div><div class="crayon-num" data-line="crayon-5a6589176164b122401076-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176164b122401076-1">src=[ich liebe dich], target=[i love you], predicted=[i love you]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-2">src=[ich sagte du sollst den mund halten], target=[i said shut up], predicted=[i said stop up]</div><div class="crayon-line" id="crayon-5a6589176164b122401076-3">src=[wie geht es eurem vater], target=[hows your dad], predicted=[hows your dad]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-4">src=[das gefallt mir], target=[i like that], predicted=[i like that]</div><div class="crayon-line" id="crayon-5a6589176164b122401076-5">src=[ich gehe immer zu fu], target=[i always walk], predicted=[i will to]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-6">src=[ich konnte nicht gehen], target=[i couldnt walk], predicted=[i cant go]</div><div class="crayon-line" id="crayon-5a6589176164b122401076-7">src=[er ist sehr jung], target=[he is very young], predicted=[he is very young]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-8">src=[versucht es doch einfach], target=[just try it], predicted=[just try it]</div><div class="crayon-line" id="crayon-5a6589176164b122401076-9">src=[sie sind jung], target=[youre young], predicted=[youre young]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-10">src=[er ging surfen], target=[he went surfing], predicted=[he went surfing]</div><div class="crayon-line" id="crayon-5a6589176164b122401076-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-12">BLEU-1: 0.085682</div><div class="crayon-line" id="crayon-5a6589176164b122401076-13">BLEU-2: 0.284191</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164b122401076-14">BLEU-3: 0.459090</div><div class="crayon-line" id="crayon-5a6589176164b122401076-15">BLEU-4: 0.517571</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Looking at the results on the test set, do see readable translations, which is not an easy task.</p>
<p>For example, we see “<em>ich mag dich nicht</em>” correctly translated to “<em>i dont like you</em>“.</p>
<p>We also see some poor translations and a good case that the model could suffer from further tuning, such as “<em>ich bin etwas beschwipst</em>” translated as “<em>i a bit bit</em>” instead of the expected “<em>im a bit tipsy</em>”</p>
<p>A BLEU-4 score of 0.076238 was achieved, providing a baseline skill to improve upon with further improvements to the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6589176164f500209786" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
src=[tom erblasste], target=[tom turned pale], predicted=[tom went pale]
src=[bring mich nach hause], target=[take me home], predicted=[let us at]
src=[ich bin etwas beschwipst], target=[im a bit tipsy], predicted=[i a bit bit]
src=[das ist eine frucht], target=[its a fruit], predicted=[thats a a]
src=[ich bin pazifist], target=[im a pacifist], predicted=[im am]
src=[unser plan ist aufgegangen], target=[our plan worked], predicted=[who is a man]
src=[hallo tom], target=[hi tom], predicted=[hello tom]
src=[sei nicht nervos], target=[dont be nervous], predicted=[dont be crazy]
src=[ich mag dich nicht], target=[i dont like you], predicted=[i dont like you]
src=[tom stellte eine falle], target=[tom set a trap], predicted=[tom has a cough]

BLEU-1: 0.082088
BLEU-2: 0.006182
BLEU-3: 0.046129
BLEU-4: 0.076238</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6589176164f500209786-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-2">2</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-4">4</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-6">6</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-8">8</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-10">10</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-12">12</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6589176164f500209786-14">14</div><div class="crayon-num" data-line="crayon-5a6589176164f500209786-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6589176164f500209786-1">src=[tom erblasste], target=[tom turned pale], predicted=[tom went pale]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-2">src=[bring mich nach hause], target=[take me home], predicted=[let us at]</div><div class="crayon-line" id="crayon-5a6589176164f500209786-3">src=[ich bin etwas beschwipst], target=[im a bit tipsy], predicted=[i a bit bit]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-4">src=[das ist eine frucht], target=[its a fruit], predicted=[thats a a]</div><div class="crayon-line" id="crayon-5a6589176164f500209786-5">src=[ich bin pazifist], target=[im a pacifist], predicted=[im am]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-6">src=[unser plan ist aufgegangen], target=[our plan worked], predicted=[who is a man]</div><div class="crayon-line" id="crayon-5a6589176164f500209786-7">src=[hallo tom], target=[hi tom], predicted=[hello tom]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-8">src=[sei nicht nervos], target=[dont be nervous], predicted=[dont be crazy]</div><div class="crayon-line" id="crayon-5a6589176164f500209786-9">src=[ich mag dich nicht], target=[i dont like you], predicted=[i dont like you]</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-10">src=[tom stellte eine falle], target=[tom set a trap], predicted=[tom has a cough]</div><div class="crayon-line" id="crayon-5a6589176164f500209786-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-12">BLEU-1: 0.082088</div><div class="crayon-line" id="crayon-5a6589176164f500209786-13">BLEU-2: 0.006182</div><div class="crayon-line crayon-striped-line" id="crayon-5a6589176164f500209786-14">BLEU-3: 0.046129</div><div class="crayon-line" id="crayon-5a6589176164f500209786-15">BLEU-4: 0.076238</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Data Cleaning</strong>. Different data cleaning operations could be performed on the data, such as not removing punctuation or normalizing case, or perhaps removing duplicate English phrases.</li>
<li><strong>Vocabulary</strong>. The vocabulary could be refined, perhaps removing words used less than 5 or 10 times in the dataset and replaced with “<em>unk</em>“.</li>
<li><strong>More Data</strong>. The dataset used to fit the model could be expanded to 50,000, 100,000 phrases, or more.</li>
<li><strong>Input Order</strong>. The order of input phrases could be reversed, which has been reported to lift skill, or a Bidirectional input layer could be used.</li>
<li><strong>Layers</strong>. The encoder and/or the decoder models could be expanded with additional layers and trained for more epochs, providing more representational capacity for the model.</li>
<li><strong>Units</strong>. The number of memory units in the encoder and decoder could be increased, providing more representational capacity for the model.</li>
<li><strong>Regularization</strong>. The model could use regularization, such as weight or activation regularization, or the use of dropout on the LSTM layers.</li>
<li><strong>Pre-Trained Word Vectors</strong>. Pre-trained word vectors could be used in the model.</li>
<li><strong>Recursive Model</strong>. A recursive formulation of the model could be used where the next word in the output sequence could be conditional on the input sequence and the output sequence generated so far.</li>
</ul>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<ul>
<li><a href="http://www.manythings.org/anki/">Tab-delimited Bilingual Sentence Pairs</a></li>
<li><a href="http://www.manythings.org/anki/deu-eng.zip">German – English deu-eng.zip</a></li>
<li><a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/">Encoder-Decoder Long Short-Term Memory Networks</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop a neural machine translation system for translating German phrases to English.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to clean and prepare data ready to train a neural machine translation system.</li>
<li>How to develop an encoder-decoder model for machine translation.</li>
<li>How to use a trained model for inference on new input phrases and evaluate the model skill.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-neural-machine-translation-system-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/&amp;summary=Machine+translation+is+a+challenging+task+that+traditionally+involves+large+statistical+models+devel..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Neural%20Machine%20Translation%20System%20in%20Keras%20from%20Scratch&amp;url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/&amp;summary=Machine+translation+is+a+challenging+task+that+traditionally+involves+large+statistical+models+devel...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/prepare-french-english-dataset-machine-translation/" rel="prev"><i class="fa fa-angle-left"></i> How to Prepare a French-to-English Dataset for Machine Translation</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" rel="next">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">14 Responses to <em>How to Develop a Neural Machine Translation System in Keras from Scratch</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-426079">
<div class="comment-container" id="li-comment-426079">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a309c869da076b74a18bb4b3e40fe5ad?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Klaas</span>
<span class="date">January 10, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426079" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>amazing work again. One Question. Do you have a seperate tutorial where you explain the LSTM layers (Timedistributed, Repeatvector,…)?</p>
<div class="reply">
<a aria-label="Reply to Klaas" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426079#respond" onclick='return addComment.moveForm( "comment-426079", "426079", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426106">
<div class="comment-container" id="li-comment-426106">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 3:41 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426106" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you might want to start here:<br/>
<a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/" rel="nofollow">https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426106#respond" onclick='return addComment.moveForm( "comment-426106", "426106", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426099">
<div class="comment-container" id="li-comment-426099">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/269d5cd1ff057c49e47711ca173fc4b8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/269d5cd1ff057c49e47711ca173fc4b8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mohamed</span>
<span class="date">January 10, 2018 at 1:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426099" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your tutorials are amazing indeed. Thank you!<br/>
Hope you will have the time to work on the Extensions lists above. This will complete this amazing tutorial. </p>
<p>Thanks again!</p>
<div class="reply">
<a aria-label="Reply to Mohamed" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426099#respond" onclick='return addComment.moveForm( "comment-426099", "426099", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426111">
<div class="comment-container" id="li-comment-426111">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 3:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426111" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426111#respond" onclick='return addComment.moveForm( "comment-426111", "426111", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426256">
<div class="comment-container" id="li-comment-426256">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/614a8de8b739c6d7140f8bbef1979702?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/614a8de8b739c6d7140f8bbef1979702?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Richard</span>
<span class="date">January 12, 2018 at 5:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426256" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Brilliant, thanks Jason. I’m looking forward to giving this a try.</p>
<div class="reply">
<a aria-label="Reply to Richard" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426256#respond" onclick='return addComment.moveForm( "comment-426256", "426256", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426263">
<div class="comment-container" id="li-comment-426263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You’re welcome.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426263#respond" onclick='return addComment.moveForm( "comment-426263", "426263", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426493">
<div class="comment-container" id="li-comment-426493">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a1a73c4c0180a5cbb38eec079ff63c91?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Parul</span>
<span class="date">January 14, 2018 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426493" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hey i want to know one thing that if we are giving english to german translations to the model for training 9000 and for testing 1000.. then what is the encoder decoder model is actually doing ..as we are giving everything to the model at the time of testing.</p>
<div class="reply">
<a aria-label="Reply to Parul" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426493#respond" onclick='return addComment.moveForm( "comment-426493", "426493", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426576">
<div class="comment-container" id="li-comment-426576">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426576" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model is not given the answer, it must translate new examples.</p>
<p>Perhaps I don’t follow your question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426576#respond" onclick='return addComment.moveForm( "comment-426576", "426576", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426612">
<div class="comment-container" id="li-comment-426612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a4e7ab81c95260f045e82d13c8bb9a9b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a4e7ab81c95260f045e82d13c8bb9a9b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">abkul orto</span>
<span class="date">January 15, 2018 at 5:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I am regular reader of your articles and purchased books.i want to work on translation of a local language to english.kindly advice on the steps.</p>
<p>thanks you</p>
<div class="reply">
<a aria-label="Reply to abkul orto" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426612#respond" onclick='return addComment.moveForm( "comment-426612", "426612", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426649">
<div class="comment-container" id="li-comment-426649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Just start!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426649#respond" onclick='return addComment.moveForm( "comment-426649", "426649", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426955">
<div class="comment-container" id="li-comment-426955">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d4602bb60f153524379c8f64523c445?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kannu</span>
<span class="date">January 20, 2018 at 4:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426955" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p># prepare regex for char filtering<br/>
	re_print = re.compile(‘[^%s]’ % re.escape(string.printable))</p>
<p>can u please explain me the meaning of this code for ex what is  string.printable actually doing and what is the meaning of  (‘[^%s]’</p>
<div class="reply">
<a aria-label="Reply to kannu" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426955#respond" onclick='return addComment.moveForm( "comment-426955", "426955", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426993">
<div class="comment-container" id="li-comment-426993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2018 at 8:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-426993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am selecting “not the printable characters”.</p>
<p>You can learn more about regex from a good book on Python.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=426993#respond" onclick='return addComment.moveForm( "comment-426993", "426993", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427023">
<div class="comment-container" id="li-comment-427023">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5ffb2b1d930512b32aa58e9de0536edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Harish Yadav</span>
<span class="date">January 20, 2018 at 9:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427023" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent explanation i would say!!!! damn good !!!looking to develop  text-phonemes with your model !!!</p>
<div class="reply">
<a aria-label="Reply to Harish Yadav" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=427023#respond" onclick='return addComment.moveForm( "comment-427023", "427023", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-427052">
<div class="comment-container" id="li-comment-427052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 21, 2018 at 9:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/#comment-427052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/?replytocom=427052#respond" onclick='return addComment.moveForm( "comment-427052", "427052", "respond", "4579" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-neural-machine-translation-system-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4579"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="115673dfd4"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="68"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Text Data</h3>
<p>Cut through the math and research papers.<br/>
Discover Word Embeddings, Text Translation and more.</p>
<p><a href="/deep-learning-for-nlp/">Get Started With Deep Learning for NLP Today!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>