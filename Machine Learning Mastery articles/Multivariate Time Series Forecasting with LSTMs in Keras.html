<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>Multivariate Time Series Forecasting with LSTMs in Keras - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="Multivariate Time Series Forecasting with LSTMs in Keras - Machine Learning Mastery" property="og:title"/>
<meta content="Neural networks like Long Short-Term Memory (LSTM) recurrent neural networks are able to almost seamlessly model problems with multiple input variables. This is a great benefit in time series forecasting, where classical linear methods can be difficult to adapt to multivariate or multiple input forecasting problems. In this tutorial, you will discover how you can …" property="og:description"/>
<meta content="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Long Short-Term Memory Networks" property="article:section"/>
<meta content="2017-08-14T05:00:38+11:00" property="article:published_time"/>
<meta content="2017-10-24T08:40:06+11:00" property="article:modified_time"/>
<meta content="2017-10-24T08:40:06+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series.png" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series.png" property="og:image:secure_url"/>
<meta content="1280" property="og:image:width"/>
<meta content="960" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/multivariate-time-series-forecasting-lstms-keras\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/feed/" rel="alternate" title="Machine Learning Mastery » Multivariate Time Series Forecasting with LSTMs in Keras Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4195" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmultivariate-time-series-forecasting-lstms-keras%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fmultivariate-time-series-forecasting-lstms-keras%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4195 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-31"> <div class="textwidget"><p>Need help with LSTMs in Python? <a href="https://machinelearningmastery.lpages.co/lnwp-mini-course/">Take the FREE Mini-Course</a>.</p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4195 post type-post status-publish format-standard has-post-thumbnail hentry category-lstm">
<header>
<h1 class="title entry-title">Multivariate Time Series Forecasting with LSTMs in Keras</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-08-14T05:00:38+1100">August 14, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/lstm/" title="View all items in Long Short-Term Memory Networks">Long Short-Term Memory Networks</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fmultivariate-time-series-forecasting-lstms-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/&amp;summary=Neural+networks+like+Long+Short-Term+Memory+%28LSTM%29+recurrent+neural+networks+are+able+to+almost+seam..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/&amp;summary=Neural+networks+like+Long+Short-Term+Memory+%28LSTM%29+recurrent+neural+networks+are+able+to+almost+seam...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Neural networks like Long Short-Term Memory (LSTM) recurrent neural networks are able to almost seamlessly model problems with multiple input variables.</p>
<p>This is a great benefit in time series forecasting, where classical linear methods can be difficult to adapt to multivariate or multiple input forecasting problems.</p>
<p>In this tutorial, you will discover how you can develop an LSTM model for multivariate time series forecasting in the Keras deep learning library.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to transform a raw dataset into something we can use for time series forecasting.</li>
<li>How to prepare data and fit an LSTM for a multivariate time series forecasting problem.</li>
<li>How to make a forecast and rescale the result back into the original units.</li>
</ul>
<p>Let’s get started.</p>
<ul>
<li><strong>Updated Aug/2017</strong>: Fixed a bug where yhat was compared to obs at the previous time step when calculating the final RMSE. Thanks, Songbin Xu and David Righart.</li>
<li><strong>Update Oct/2017</strong>: Added a new example showing how to train on multiple prior time steps due to popular demand.</li>
</ul>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 3 parts; they are:</p>
<ol>
<li>Air Pollution Forecasting</li>
<li>Basic Data Preparation</li>
<li>Multivariate LSTM Forecast Model</li>
</ol>
<h3>Python Environment</h3>
<p>This tutorial assumes you have a Python SciPy environment installed. You can use either Python 2 or 3 with this tutorial.</p>
<p>You must have Keras (2.0 or higher) installed with either the TensorFlow or Theano backend.</p>
<p>The tutorial also assumes you have scikit-learn, Pandas, NumPy and Matplotlib installed.</p>
<p>If you need help with your environment, see this post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a></li>
</ul>
<!-- Start shortcoder --><div class="woo-sc-hr"></div>
<center>
<h3>Need help with LSTMs for Sequence Prediction?</h3>
<p>Take my free 7-day email course and discover 6 different LSTM architectures (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Mini-Course Now!</a><script data-config="%7B%7D" data-leadbox="1403a9373f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/1403a9373f72a2%3A164f8be4f346dc/5754903989321728/" src="https://machinelearningmastery.lpages.co/leadbox-1500400021.js" type="text/javascript"></script></p>
</center>
<div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>1. Air Pollution Forecasting</h2>
<p>In this tutorial, we are going to use the Air Quality dataset.</p>
<p>This is a dataset that reports on the weather and the level of pollution each hour for five years at the US embassy in Beijing, China.</p>
<p>The data includes the date-time, the pollution called PM2.5 concentration, and the weather information including dew point, temperature, pressure, wind direction, wind speed and the cumulative number of hours of snow and rain. The complete feature list in the raw data is as follows:</p>
<ol>
<li><strong>No</strong>: row number</li>
<li><strong>year</strong>: year of data in this row</li>
<li><strong>month</strong>: month of data in this row</li>
<li><strong>day</strong>: day of data in this row</li>
<li><strong>hour</strong>: hour of data in this row</li>
<li><strong>pm2.5</strong>: PM2.5 concentration</li>
<li><strong>DEWP</strong>: Dew Point</li>
<li><strong>TEMP</strong>: Temperature</li>
<li><strong>PRES</strong>: Pressure</li>
<li><strong>cbwd</strong>: Combined wind direction</li>
<li><strong>Iws</strong>: Cumulated wind speed</li>
<li><strong>Is</strong>: Cumulated hours of snow</li>
<li><strong>Ir</strong>: Cumulated hours of rain</li>
</ol>
<p>We can use this data and frame a forecasting problem where, given the weather conditions and pollution for prior hours, we forecast the pollution at the next hour.</p>
<p>This dataset can be used to frame other forecasting problems.<br/>
Do you have good ideas? Let me know in the comments below.</p>
<p>You can download the dataset from the UCI Machine Learning Repository.</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/Beijing+PM2.5+Data">Beijing PM2.5 Data Set</a></li>
</ul>
<p>Download the dataset and place it in your current working directory with the filename “<em>raw.csv</em>“.</p>
<h2>2. Basic Data Preparation</h2>
<p>The data is not ready to use. We must prepare it first.</p>
<p>Below are the first few rows of the raw dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e16ec654745990" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
No,year,month,day,hour,pm2.5,DEWP,TEMP,PRES,cbwd,Iws,Is,Ir
1,2010,1,1,0,NA,-21,-11,1021,NW,1.79,0,0
2,2010,1,1,1,NA,-21,-12,1020,NW,4.92,0,0
3,2010,1,1,2,NA,-21,-11,1019,NW,6.71,0,0
4,2010,1,1,3,NA,-21,-14,1019,NW,9.84,0,0
5,2010,1,1,4,NA,-20,-12,1018,NW,12.97,0,0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e16ec654745990-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16ec654745990-2">2</div><div class="crayon-num" data-line="crayon-5a659185e16ec654745990-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16ec654745990-4">4</div><div class="crayon-num" data-line="crayon-5a659185e16ec654745990-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16ec654745990-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e16ec654745990-1">No,year,month,day,hour,pm2.5,DEWP,TEMP,PRES,cbwd,Iws,Is,Ir</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16ec654745990-2">1,2010,1,1,0,NA,-21,-11,1021,NW,1.79,0,0</div><div class="crayon-line" id="crayon-5a659185e16ec654745990-3">2,2010,1,1,1,NA,-21,-12,1020,NW,4.92,0,0</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16ec654745990-4">3,2010,1,1,2,NA,-21,-11,1019,NW,6.71,0,0</div><div class="crayon-line" id="crayon-5a659185e16ec654745990-5">4,2010,1,1,3,NA,-21,-14,1019,NW,9.84,0,0</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16ec654745990-6">5,2010,1,1,4,NA,-20,-12,1018,NW,12.97,0,0</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The first step is to consolidate the date-time information into a single date-time so that we can use it as an index in Pandas.</p>
<p>A quick check reveals NA values for pm2.5 for the first 24 hours. We will, therefore, need to remove the first row of data. There are also a few scattered “NA” values later in the dataset; we can mark them with 0 values for now.</p>
<p>The script below loads the raw dataset and parses the date-time information as the Pandas DataFrame index. The “No” column is dropped and then clearer names are specified for each column. Finally, the NA values are replaced with “0” values and the first 24 hours are removed.</p>
<p>The “No” column is dropped and then clearer names are specified for each column. Finally, the NA values are replaced with “0” values and the first 24 hours are removed.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e16f7672754702" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from datetime import datetime
# load data
def parse(x):
	return datetime.strptime(x, '%Y %m %d %H')
dataset = read_csv('raw.csv',  parse_dates = [['year', 'month', 'day', 'hour']], index_col=0, date_parser=parse)
dataset.drop('No', axis=1, inplace=True)
# manually specify column names
dataset.columns = ['pollution', 'dew', 'temp', 'press', 'wnd_dir', 'wnd_spd', 'snow', 'rain']
dataset.index.name = 'date'
# mark all NA values with 0
dataset['pollution'].fillna(0, inplace=True)
# drop the first 24 hours
dataset = dataset[24:]
# summarize first 5 rows
print(dataset.head(5))
# save to file
dataset.to_csv('pollution.csv')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-2">2</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-4">4</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-6">6</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-8">8</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-10">10</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-12">12</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-14">14</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-16">16</div><div class="crayon-num" data-line="crayon-5a659185e16f7672754702-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16f7672754702-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e16f7672754702-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-2"><span class="crayon-e">from </span><span class="crayon-e">datetime </span><span class="crayon-e">import </span><span class="crayon-v">datetime</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-3"><span class="crayon-p"># load data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-4"><span class="crayon-e">def </span><span class="crayon-e">parse</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-5"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">datetime</span><span class="crayon-sy">.</span><span class="crayon-e">strptime</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'%Y %m %d %H'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-6"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'raw.csv'</span><span class="crayon-sy">,</span><span class="crayon-h">  </span><span class="crayon-v">parse_dates</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-s">'year'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'month'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'day'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'hour'</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">date_parser</span><span class="crayon-o">=</span><span class="crayon-v">parse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-7"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-s">'No'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-8"><span class="crayon-p"># manually specify column names</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-9"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'pollution'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'dew'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'temp'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'press'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wnd_dir'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wnd_spd'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'snow'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'rain'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-10"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">index</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'date'</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-11"><span class="crayon-p"># mark all NA values with 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-12"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'pollution'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">fillna</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-13"><span class="crayon-p"># drop the first 24 hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-14"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-cn">24</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-15"><span class="crayon-p"># summarize first 5 rows</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-16"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16f7672754702-17"><span class="crayon-p"># save to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16f7672754702-18"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'pollution.csv'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the example prints the first 5 rows of the transformed dataset and saves the dataset to “<em>pollution.csv</em>“.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e16fa760827563" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
                     pollution  dew  temp   press wnd_dir  wnd_spd  snow  rain
date
2010-01-02 00:00:00      129.0  -16  -4.0  1020.0      SE     1.79     0     0
2010-01-02 01:00:00      148.0  -15  -4.0  1020.0      SE     2.68     0     0
2010-01-02 02:00:00      159.0  -11  -5.0  1021.0      SE     3.57     0     0
2010-01-02 03:00:00      181.0   -7  -5.0  1022.0      SE     5.36     1     0
2010-01-02 04:00:00      138.0   -7  -5.0  1022.0      SE     6.25     2     0</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e16fa760827563-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fa760827563-2">2</div><div class="crayon-num" data-line="crayon-5a659185e16fa760827563-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fa760827563-4">4</div><div class="crayon-num" data-line="crayon-5a659185e16fa760827563-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fa760827563-6">6</div><div class="crayon-num" data-line="crayon-5a659185e16fa760827563-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e16fa760827563-1">                     pollution  dew  temp   press wnd_dir  wnd_spd  snow  rain</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fa760827563-2">date</div><div class="crayon-line" id="crayon-5a659185e16fa760827563-3">2010-01-02 00:00:00      129.0  -16  -4.0  1020.0      SE     1.79     0     0</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fa760827563-4">2010-01-02 01:00:00      148.0  -15  -4.0  1020.0      SE     2.68     0     0</div><div class="crayon-line" id="crayon-5a659185e16fa760827563-5">2010-01-02 02:00:00      159.0  -11  -5.0  1021.0      SE     3.57     0     0</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fa760827563-6">2010-01-02 03:00:00      181.0   -7  -5.0  1022.0      SE     5.36     1     0</div><div class="crayon-line" id="crayon-5a659185e16fa760827563-7">2010-01-02 04:00:00      138.0   -7  -5.0  1022.0      SE     6.25     2     0</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now that we have the data in an easy-to-use form, we can create a quick plot of each series and see what we have.</p>
<p>The code below loads the new “<em>pollution.csv</em>” file and plots each series as a separate subplot, except wind speed dir, which is categorical.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e16fd051904566" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from pandas import read_csv
from matplotlib import pyplot
# load dataset
dataset = read_csv('pollution.csv', header=0, index_col=0)
values = dataset.values
# specify columns to plot
groups = [0, 1, 2, 3, 5, 6, 7]
i = 1
# plot each column
pyplot.figure()
for group in groups:
	pyplot.subplot(len(groups), 1, i)
	pyplot.plot(values[:, group])
	pyplot.title(dataset.columns[group], y=0.5, loc='right')
	i += 1
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-2">2</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-4">4</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-6">6</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-8">8</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-10">10</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-12">12</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-14">14</div><div class="crayon-num" data-line="crayon-5a659185e16fd051904566-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e16fd051904566-16">16</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e16fd051904566-1"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-2"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-v">pyplot</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-3"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'pollution.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-5"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-6"><span class="crayon-p"># specify columns to plot</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-7"><span class="crayon-v">groups</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-8"><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-9"><span class="crayon-p"># plot each column</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-10"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-11"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">group </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">groups</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-12"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">subplot</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">groups</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-13"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">group</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-14"><span class="crayon-h"> </span><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-v">group</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-o">=</span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-o">=</span><span class="crayon-s">'right'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e16fd051904566-15"><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e16fd051904566-16"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Running the example creates a plot with 7 subplots showing the 5 years of data for each variable.</p>
<div class="wp-caption aligncenter" id="attachment_4196" style="max-width: 1034px"><img alt="Line Plots of Air Pollution Time Series" class="size-large wp-image-4196" height="768" sizes="(max-width: 1024px) 100vw, 1024px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-1024x768.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-1024x768.png 1024w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series.png 1280w" width="1024"/><p class="wp-caption-text">Line Plots of Air Pollution Time Series</p></div>
<h2>3. Multivariate LSTM Forecast Model</h2>
<p>In this section, we will fit an LSTM to the problem.</p>
<h3>LSTM Data Preparation</h3>
<p>The first step is to prepare the pollution dataset for the LSTM.</p>
<p>This involves framing the dataset as a supervised learning problem and normalizing the input variables.</p>
<p>We will frame the supervised learning problem as predicting the pollution at the current hour (t) given the pollution measurement and weather conditions at the prior time step.</p>
<p>This formulation is straightforward and just for this demonstration. Some alternate formulations you could explore include:</p>
<ul>
<li>Predict the pollution for the next hour based on the weather conditions and pollution over the last 24 hours.</li>
<li>Predict the pollution for the next hour as above and given the “expected” weather conditions for the next hour.</li>
</ul>
<p>We can transform the dataset using the <em>series_to_supervised()</em> function developed in the blog post:</p>
<ul>
<li><a href="http://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/">How to Convert a Time Series to a Supervised Learning Problem in Python</a></li>
</ul>
<p>First, the “<em>pollution.csv</em>” dataset is loaded. The wind speed feature is label encoded (integer encoded). This could further be one-hot encoded in the future if you are interested in exploring it.</p>
<p>Next, all features are normalized, then the dataset is transformed into a supervised learning problem. The weather variables for the hour to be predicted (t) are then removed.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1701438711349" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# convert series to supervised learning
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg
 
# load dataset
dataset = read_csv('pollution.csv', header=0, index_col=0)
values = dataset.values
# integer encode direction
encoder = LabelEncoder()
values[:,4] = encoder.fit_transform(values[:,4])
# ensure all data is float
values = values.astype('float32')
# normalize features
scaler = MinMaxScaler(feature_range=(0, 1))
scaled = scaler.fit_transform(values)
# frame as supervised learning
reframed = series_to_supervised(scaled, 1, 1)
# drop columns we don't want to predict
reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)
print(reframed.head())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1701438711349-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-12">12</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-14">14</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-16">16</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-18">18</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-20">20</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-22">22</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-24">24</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-26">26</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-28">28</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-30">30</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-32">32</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-34">34</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-36">36</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-38">38</div><div class="crayon-num" data-line="crayon-5a659185e1701438711349-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1701438711349-40">40</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1701438711349-1"><span class="crayon-p"># convert series to supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-2"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-3"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-4"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-5"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-6"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-7"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-8"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-9"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-10"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-11"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-12"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-13"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-14"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-15"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-16"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-17"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-18"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-19"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-20"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-21"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-22"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-24"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-25"><span class="crayon-p"># load dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-26"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'pollution.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-27"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-28"><span class="crayon-p"># integer encode direction</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-29"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LabelEncoder</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-30"><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-31"><span class="crayon-p"># ensure all data is float</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-32"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-33"><span class="crayon-p"># normalize features</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-34"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-35"><span class="crayon-v">scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-36"><span class="crayon-p"># frame as supervised learning</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-37"><span class="crayon-v">reframed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-38"><span class="crayon-p"># drop columns we don't want to predict</span></div><div class="crayon-line" id="crayon-5a659185e1701438711349-39"><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-cn">13</span><span class="crayon-sy">,</span><span class="crayon-cn">14</span><span class="crayon-sy">,</span><span class="crayon-cn">15</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1701438711349-40"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>Running the example prints the first 5 rows of the transformed dataset. We can see the 8 input variables (input series) and the 1 output variable (pollution level at the current hour).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1704227730557" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
   var1(t-1)  var2(t-1)  var3(t-1)  var4(t-1)  var5(t-1)  var6(t-1)  \
1   0.129779   0.352941   0.245902   0.527273   0.666667   0.002290
2   0.148893   0.367647   0.245902   0.527273   0.666667   0.003811
3   0.159960   0.426471   0.229508   0.545454   0.666667   0.005332
4   0.182093   0.485294   0.229508   0.563637   0.666667   0.008391
5   0.138833   0.485294   0.229508   0.563637   0.666667   0.009912
 
   var7(t-1)  var8(t-1)   var1(t)
1   0.000000        0.0  0.148893
2   0.000000        0.0  0.159960
3   0.000000        0.0  0.182093
4   0.037037        0.0  0.138833
5   0.074074        0.0  0.109658</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1704227730557-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1704227730557-12">12</div><div class="crayon-num" data-line="crayon-5a659185e1704227730557-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1704227730557-1">   var1(t-1)  var2(t-1)  var3(t-1)  var4(t-1)  var5(t-1)  var6(t-1)  \</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-2">1   0.129779   0.352941   0.245902   0.527273   0.666667   0.002290</div><div class="crayon-line" id="crayon-5a659185e1704227730557-3">2   0.148893   0.367647   0.245902   0.527273   0.666667   0.003811</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-4">3   0.159960   0.426471   0.229508   0.545454   0.666667   0.005332</div><div class="crayon-line" id="crayon-5a659185e1704227730557-5">4   0.182093   0.485294   0.229508   0.563637   0.666667   0.008391</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-6">5   0.138833   0.485294   0.229508   0.563637   0.666667   0.009912</div><div class="crayon-line" id="crayon-5a659185e1704227730557-7"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-8">   var7(t-1)  var8(t-1)   var1(t)</div><div class="crayon-line" id="crayon-5a659185e1704227730557-9">1   0.000000        0.0  0.148893</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-10">2   0.000000        0.0  0.159960</div><div class="crayon-line" id="crayon-5a659185e1704227730557-11">3   0.000000        0.0  0.182093</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1704227730557-12">4   0.037037        0.0  0.138833</div><div class="crayon-line" id="crayon-5a659185e1704227730557-13">5   0.074074        0.0  0.109658</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This data preparation is simple and there is more we could explore. Some ideas you could look at include:</p>
<ul>
<li>One-hot encoding wind speed.</li>
<li>Making all series stationary with differencing and seasonal adjustment.</li>
<li>Providing more than 1 hour of input time steps.</li>
</ul>
<p>This last point is perhaps the most important given the use of Backpropagation through time by LSTMs when learning sequence prediction problems.</p>
<h3>Define and Fit Model</h3>
<p>In this section, we will fit an LSTM on the multivariate input data.</p>
<p>First, we must split the prepared dataset into train and test sets. To speed up the training of the model for this demonstration, we will only fit the model on the first year of data, then evaluate it on the remaining 4 years of data. If you have time, consider exploring the inverted version of this test harness.</p>
<p>The example below splits the dataset into train and test sets, then splits the train and test sets into input and output variables. Finally, the inputs (X) are reshaped into the 3D format expected by LSTMs, namely [samples, timesteps, features].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1708666237750" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split into train and test sets
values = reframed.values
n_train_hours = 365 * 24
train = values[:n_train_hours, :]
test = values[n_train_hours:, :]
# split into input and outputs
train_X, train_y = train[:, :-1], train[:, -1]
test_X, test_y = test[:, :-1], test[:, -1]
# reshape input to be 3D [samples, timesteps, features]
train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))
test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))
print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1708666237750-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1708666237750-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1708666237750-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1708666237750-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1708666237750-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1708666237750-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1708666237750-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1708666237750-1"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-2"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a659185e1708666237750-3"><span class="crayon-v">n_train_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">365</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-4"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_train_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1708666237750-5"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_train_hours</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-6"><span class="crayon-p"># split into input and outputs</span></div><div class="crayon-line" id="crayon-5a659185e1708666237750-7"><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-8"><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1708666237750-9"><span class="crayon-p"># reshape input to be 3D [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-10"><span class="crayon-v">train_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1708666237750-11"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1708666237750-12"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running this example prints the shape of the train and test input and output sets with about 9K hours of data for training and about 35K hours for testing.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e170b269330534" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
(8760, 1, 8) (8760,) (35039, 1, 8) (35039,)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e170b269330534-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e170b269330534-1">(8760, 1, 8) (8760,) (35039, 1, 8) (35039,)</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Now we can define and fit our LSTM model.</p>
<p>We will define the LSTM with 50 neurons in the first hidden layer and 1 neuron in the output layer for predicting pollution. The input shape will be 1 time step with 8 features.</p>
<p>We will use the Mean Absolute Error (MAE) loss function and the efficient Adam version of stochastic gradient descent.</p>
<p>The model will be fit for 50 training epochs with a batch size of 72. Remember that the internal state of the LSTM in Keras is reset at the end of each batch, so an internal state that is a function of a number of days may be helpful (try testing this).</p>
<p>Finally, we keep track of both the training and test loss during training by setting the <em>validation_data</em> argument in the fit() function. At the end of the run both the training and test loss are plotted.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e170d792474856" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# design network
model = Sequential()
model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))
model.add(Dense(1))
model.compile(loss='mae', optimizer='adam')
# fit network
history = model.fit(train_X, train_y, epochs=50, batch_size=72, validation_data=(test_X, test_y), verbose=2, shuffle=False)
# plot history
pyplot.plot(history.history['loss'], label='train')
pyplot.plot(history.history['val_loss'], label='test')
pyplot.legend()
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e170d792474856-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-2">2</div><div class="crayon-num" data-line="crayon-5a659185e170d792474856-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-4">4</div><div class="crayon-num" data-line="crayon-5a659185e170d792474856-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-6">6</div><div class="crayon-num" data-line="crayon-5a659185e170d792474856-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-8">8</div><div class="crayon-num" data-line="crayon-5a659185e170d792474856-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-10">10</div><div class="crayon-num" data-line="crayon-5a659185e170d792474856-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e170d792474856-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e170d792474856-1"><span class="crayon-p"># design network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e170d792474856-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e170d792474856-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mae'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-6"><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5a659185e170d792474856-7"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-8"><span class="crayon-p"># plot history</span></div><div class="crayon-line" id="crayon-5a659185e170d792474856-9"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-10"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e170d792474856-11"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e170d792474856-12"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0015 seconds] -->
<p></p>
<h3>Evaluate Model</h3>
<p>After the model is fit, we can forecast for the entire test dataset.</p>
<p>We combine the forecast with the test dataset and invert the scaling. We also invert scaling on the test dataset with the expected pollution numbers.</p>
<p>With forecasts and actual values in their original scale, we can then calculate an error score for the model. In this case, we calculate the Root Mean Squared Error (RMSE) that gives error in the same units as the variable itself.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1710215336148" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# make a prediction
yhat = model.predict(test_X)
test_X = test_X.reshape((test_X.shape[0], test_X.shape[2]))
# invert scaling for forecast
inv_yhat = concatenate((yhat, test_X[:, 1:]), axis=1)
inv_yhat = scaler.inverse_transform(inv_yhat)
inv_yhat = inv_yhat[:,0]
# invert scaling for actual
test_y = test_y.reshape((len(test_y), 1))
inv_y = concatenate((test_y, test_X[:, 1:]), axis=1)
inv_y = scaler.inverse_transform(inv_y)
inv_y = inv_y[:,0]
# calculate RMSE
rmse = sqrt(mean_squared_error(inv_y, inv_yhat))
print('Test RMSE: %.3f' % rmse)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1710215336148-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-12">12</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1710215336148-14">14</div><div class="crayon-num" data-line="crayon-5a659185e1710215336148-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1710215336148-1"><span class="crayon-p"># make a prediction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-3"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-4"><span class="crayon-p"># invert scaling for forecast</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-5"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-6"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-7"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-8"><span class="crayon-p"># invert scaling for actual</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-9"><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-10"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-11"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-12"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_y</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-13"><span class="crayon-p"># calculate RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1710215336148-14"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1710215336148-15"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p></p>
<h3>Complete Example</h3>
<p>The complete example is listed below.</p>
<p><strong>NOTE</strong>: This example assumes you have prepared the data correctly, e.g. converted the downloaded “<em>raw.csv</em>” to the prepared “<em>pollution.csv</em>“. See the first part of this tutorial.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1713735938641" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from math import sqrt
from numpy import concatenate
from matplotlib import pyplot
from pandas import read_csv
from pandas import DataFrame
from pandas import concat
from sklearn.preprocessing import MinMaxScaler
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
 
# convert series to supervised learning
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg
 
# load dataset
dataset = read_csv('pollution.csv', header=0, index_col=0)
values = dataset.values
# integer encode direction
encoder = LabelEncoder()
values[:,4] = encoder.fit_transform(values[:,4])
# ensure all data is float
values = values.astype('float32')
# normalize features
scaler = MinMaxScaler(feature_range=(0, 1))
scaled = scaler.fit_transform(values)
# frame as supervised learning
reframed = series_to_supervised(scaled, 1, 1)
# drop columns we don't want to predict
reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)
print(reframed.head())
 
# split into train and test sets
values = reframed.values
n_train_hours = 365 * 24
train = values[:n_train_hours, :]
test = values[n_train_hours:, :]
# split into input and outputs
train_X, train_y = train[:, :-1], train[:, -1]
test_X, test_y = test[:, :-1], test[:, -1]
# reshape input to be 3D [samples, timesteps, features]
train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))
test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))
print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)
 
# design network
model = Sequential()
model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))
model.add(Dense(1))
model.compile(loss='mae', optimizer='adam')
# fit network
history = model.fit(train_X, train_y, epochs=50, batch_size=72, validation_data=(test_X, test_y), verbose=2, shuffle=False)
# plot history
pyplot.plot(history.history['loss'], label='train')
pyplot.plot(history.history['val_loss'], label='test')
pyplot.legend()
pyplot.show()
 
# make a prediction
yhat = model.predict(test_X)
test_X = test_X.reshape((test_X.shape[0], test_X.shape[2]))
# invert scaling for forecast
inv_yhat = concatenate((yhat, test_X[:, 1:]), axis=1)
inv_yhat = scaler.inverse_transform(inv_yhat)
inv_yhat = inv_yhat[:,0]
# invert scaling for actual
test_y = test_y.reshape((len(test_y), 1))
inv_y = concatenate((test_y, test_X[:, 1:]), axis=1)
inv_y = scaler.inverse_transform(inv_y)
inv_y = inv_y[:,0]
# calculate RMSE
rmse = sqrt(mean_squared_error(inv_y, inv_yhat))
print('Test RMSE: %.3f' % rmse)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1713735938641-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-12">12</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-14">14</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-16">16</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-18">18</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-20">20</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-22">22</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-24">24</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-26">26</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-28">28</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-30">30</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-32">32</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-34">34</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-36">36</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-38">38</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-40">40</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-42">42</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-44">44</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-46">46</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-48">48</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-50">50</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-52">52</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-54">54</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-56">56</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-58">58</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-60">60</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-62">62</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-64">64</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-66">66</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-68">68</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-70">70</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-72">72</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-74">74</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-76">76</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-78">78</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-80">80</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-82">82</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-84">84</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-86">86</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-88">88</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-90">90</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-92">92</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1713735938641-94">94</div><div class="crayon-num" data-line="crayon-5a659185e1713735938641-95">95</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1713735938641-1"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">concatenate</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-3"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">LabelEncoder</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-13"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-14"><span class="crayon-p"># convert series to supervised learning</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-15"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-16"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-17"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-18"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-19"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-21"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-22"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-23"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-25"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-26"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-27"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-28"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-29"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-30"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-32"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-33"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-35"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-37"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-38"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-39"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'pollution.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-40"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-41"><span class="crayon-p"># integer encode direction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-42"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LabelEncoder</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-43"><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-44"><span class="crayon-p"># ensure all data is float</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-45"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-46"><span class="crayon-p"># normalize features</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-47"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-48"><span class="crayon-v">scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-49"><span class="crayon-p"># frame as supervised learning</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-50"><span class="crayon-v">reframed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-51"><span class="crayon-p"># drop columns we don't want to predict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-52"><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">,</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-cn">11</span><span class="crayon-sy">,</span><span class="crayon-cn">12</span><span class="crayon-sy">,</span><span class="crayon-cn">13</span><span class="crayon-sy">,</span><span class="crayon-cn">14</span><span class="crayon-sy">,</span><span class="crayon-cn">15</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-53"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-54"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-55"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-56"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-57"><span class="crayon-v">n_train_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">365</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-58"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_train_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-59"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_train_hours</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-60"><span class="crayon-p"># split into input and outputs</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-61"><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-62"><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-63"><span class="crayon-p"># reshape input to be 3D [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-64"><span class="crayon-v">train_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-65"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-66"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-67"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-68"><span class="crayon-p"># design network</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-69"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-70"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-71"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-72"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mae'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-73"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-74"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-75"><span class="crayon-p"># plot history</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-76"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-77"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-78"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-79"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-80"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-81"><span class="crayon-p"># make a prediction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-82"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-83"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-84"><span class="crayon-p"># invert scaling for forecast</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-85"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-86"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-87"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-88"><span class="crayon-p"># invert scaling for actual</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-89"><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-90"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-91"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-92"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_y</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-93"><span class="crayon-p"># calculate RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1713735938641-94"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1713735938641-95"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0088 seconds] -->
<p>Running the example first creates a plot showing the train and test loss during training.</p>
<p>Interestingly, we can see that test loss drops below training loss. The model may be overfitting the training data. Measuring and plotting RMSE during training may shed more light on this.</p>
<div class="wp-caption aligncenter" id="attachment_4197" style="max-width: 1034px"><img alt="Line Plot of Train and Test Loss from the Multivariate LSTM During Training" class="size-large wp-image-4197" height="768" sizes="(max-width: 1024px) 100vw, 1024px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plot-of-Train-and-Test-Loss-from-the-Multivariate-LSTM-During-Training-1024x768.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plot-of-Train-and-Test-Loss-from-the-Multivariate-LSTM-During-Training-1024x768.png 1024w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plot-of-Train-and-Test-Loss-from-the-Multivariate-LSTM-During-Training-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plot-of-Train-and-Test-Loss-from-the-Multivariate-LSTM-During-Training-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plot-of-Train-and-Test-Loss-from-the-Multivariate-LSTM-During-Training.png 1280w" width="1024"/><p class="wp-caption-text">Line Plot of Train and Test Loss from the Multivariate LSTM During Training</p></div>
<p>The Train and test loss are printed at the end of each training epoch. At the end of the run, the final RMSE of the model on the test dataset is printed.</p>
<p>We can see that the model achieves a respectable RMSE of 26.496, which is lower than an RMSE of 30 found with a persistence model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1718783328138" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 46/50
0s - loss: 0.0143 - val_loss: 0.0133
Epoch 47/50
0s - loss: 0.0143 - val_loss: 0.0133
Epoch 48/50
0s - loss: 0.0144 - val_loss: 0.0133
Epoch 49/50
0s - loss: 0.0143 - val_loss: 0.0133
Epoch 50/50
0s - loss: 0.0144 - val_loss: 0.0133
Test RMSE: 26.496</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1718783328138-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1718783328138-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1718783328138-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1718783328138-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1718783328138-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1718783328138-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1718783328138-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1718783328138-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-2">Epoch 46/50</div><div class="crayon-line" id="crayon-5a659185e1718783328138-3">0s - loss: 0.0143 - val_loss: 0.0133</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-4">Epoch 47/50</div><div class="crayon-line" id="crayon-5a659185e1718783328138-5">0s - loss: 0.0143 - val_loss: 0.0133</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-6">Epoch 48/50</div><div class="crayon-line" id="crayon-5a659185e1718783328138-7">0s - loss: 0.0144 - val_loss: 0.0133</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-8">Epoch 49/50</div><div class="crayon-line" id="crayon-5a659185e1718783328138-9">0s - loss: 0.0143 - val_loss: 0.0133</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-10">Epoch 50/50</div><div class="crayon-line" id="crayon-5a659185e1718783328138-11">0s - loss: 0.0144 - val_loss: 0.0133</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1718783328138-12">Test RMSE: 26.496</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>This model is not tuned. Can you do better?<br/>
Let me know your problem framing, model configuration, and RMSE in the comments below.</p>
<h2>Update: Train On Multiple Lag Timesteps Example</h2>
<p>There have been many requests for advice on how to adapt the above example to train the model on multiple previous time steps.</p>
<p>I had tried this and a myriad of other configurations when writing the original post and decided not to include them because they did not lift model skill.</p>
<p>Nevertheless, I have included this example below as reference template that you could adapt for your own problems.</p>
<p>The changes needed to train the model on multiple previous time steps are quite minimal, as follows:</p>
<p>First, you must frame the problem suitably when calling series_to_supervised(). We will use 3 hours of data as input. Also note, we no longer explictly drop the columns from all of the other fields at ob(t).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e171c586916321" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# specify the number of lag hours
n_hours = 3
n_features = 8
# frame as supervised learning
reframed = series_to_supervised(scaled, n_hours, 1)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e171c586916321-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e171c586916321-2">2</div><div class="crayon-num" data-line="crayon-5a659185e171c586916321-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e171c586916321-4">4</div><div class="crayon-num" data-line="crayon-5a659185e171c586916321-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e171c586916321-1"><span class="crayon-p"># specify the number of lag hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e171c586916321-2"><span class="crayon-v">n_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a659185e171c586916321-3"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e171c586916321-4"><span class="crayon-p"># frame as supervised learning</span></div><div class="crayon-line" id="crayon-5a659185e171c586916321-5"><span class="crayon-v">reframed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, we need to be more careful in specifying the column for input and output.</p>
<p>We have 3 * 8 + 8 columns in our framed dataset. We will take 3 * 8 or 24 columns as input for the obs of all features across the previous 3 hours. We will take just the pollution variable as output at the following hour, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e171e119139179" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# split into input and outputs
n_obs = n_hours * n_features
train_X, train_y = train[:, :n_obs], train[:, -n_features]
test_X, test_y = test[:, :n_obs], test[:, -n_features]
print(train_X.shape, len(train_X), train_y.shape)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e171e119139179-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e171e119139179-2">2</div><div class="crayon-num" data-line="crayon-5a659185e171e119139179-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e171e119139179-4">4</div><div class="crayon-num" data-line="crayon-5a659185e171e119139179-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e171e119139179-1"><span class="crayon-p"># split into input and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e171e119139179-2"><span class="crayon-v">n_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_hours *</span><span class="crayon-h"> </span><span class="crayon-e">n_features</span></div><div class="crayon-line" id="crayon-5a659185e171e119139179-3"><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e171e119139179-4"><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e171e119139179-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Next, we can reshape our input data correctly to reflect the time steps and features.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1721822291859" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# reshape input to be 3D [samples, timesteps, features]
train_X = train_X.reshape((train_X.shape[0], n_hours, n_features))
test_X = test_X.reshape((test_X.shape[0], n_hours, n_features))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1721822291859-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1721822291859-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1721822291859-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1721822291859-1"><span class="crayon-p"># reshape input to be 3D [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1721822291859-2"><span class="crayon-v">train_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1721822291859-3"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Fitting the model is the same.</p>
<p>The only other small change is in how to evaluate the model. Specifically, in how we reconstruct the rows with 8 columns suitable for reversing the scaling operation to get the y and yhat back into the original scale so that we can calculate the RMSE.</p>
<p>The gist of the change is that we concatenate the y or yhat column with the last 7 features of the test dataset in order to inverse the scaling, as follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1723293050054" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# invert scaling for forecast
inv_yhat = concatenate((yhat, test_X[:, -7:]), axis=1)
inv_yhat = scaler.inverse_transform(inv_yhat)
inv_yhat = inv_yhat[:,0]
# invert scaling for actual
test_y = test_y.reshape((len(test_y), 1))
inv_y = concatenate((test_y, test_X[:, -7:]), axis=1)
inv_y = scaler.inverse_transform(inv_y)
inv_y = inv_y[:,0]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1723293050054-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1723293050054-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1723293050054-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1723293050054-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1723293050054-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1723293050054-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1723293050054-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1723293050054-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1723293050054-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1723293050054-1"><span class="crayon-p"># invert scaling for forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1723293050054-2"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">7</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1723293050054-3"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1723293050054-4"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1723293050054-5"><span class="crayon-p"># invert scaling for actual</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1723293050054-6"><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1723293050054-7"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">7</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1723293050054-8"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1723293050054-9"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_y</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We can tie all of these modifications to the above example together. The complete example of multvariate time series forecasting with multiple lag inputs is listed below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1726573338787" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from math import sqrt
from numpy import concatenate
from matplotlib import pyplot
from pandas import read_csv
from pandas import DataFrame
from pandas import concat
from sklearn.preprocessing import MinMaxScaler
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import mean_squared_error
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM

# convert series to supervised learning
def series_to_supervised(data, n_in=1, n_out=1, dropnan=True):
	n_vars = 1 if type(data) is list else data.shape[1]
	df = DataFrame(data)
	cols, names = list(), list()
	# input sequence (t-n, ... t-1)
	for i in range(n_in, 0, -1):
		cols.append(df.shift(i))
		names += [('var%d(t-%d)' % (j+1, i)) for j in range(n_vars)]
	# forecast sequence (t, t+1, ... t+n)
	for i in range(0, n_out):
		cols.append(df.shift(-i))
		if i == 0:
			names += [('var%d(t)' % (j+1)) for j in range(n_vars)]
		else:
			names += [('var%d(t+%d)' % (j+1, i)) for j in range(n_vars)]
	# put it all together
	agg = concat(cols, axis=1)
	agg.columns = names
	# drop rows with NaN values
	if dropnan:
		agg.dropna(inplace=True)
	return agg

# load dataset
dataset = read_csv('pollution.csv', header=0, index_col=0)
values = dataset.values
# integer encode direction
encoder = LabelEncoder()
values[:,4] = encoder.fit_transform(values[:,4])
# ensure all data is float
values = values.astype('float32')
# normalize features
scaler = MinMaxScaler(feature_range=(0, 1))
scaled = scaler.fit_transform(values)
# specify the number of lag hours
n_hours = 3
n_features = 8
# frame as supervised learning
reframed = series_to_supervised(scaled, n_hours, 1)
print(reframed.shape)

# split into train and test sets
values = reframed.values
n_train_hours = 365 * 24
train = values[:n_train_hours, :]
test = values[n_train_hours:, :]
# split into input and outputs
n_obs = n_hours * n_features
train_X, train_y = train[:, :n_obs], train[:, -n_features]
test_X, test_y = test[:, :n_obs], test[:, -n_features]
print(train_X.shape, len(train_X), train_y.shape)
# reshape input to be 3D [samples, timesteps, features]
train_X = train_X.reshape((train_X.shape[0], n_hours, n_features))
test_X = test_X.reshape((test_X.shape[0], n_hours, n_features))
print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)

# design network
model = Sequential()
model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))
model.add(Dense(1))
model.compile(loss='mae', optimizer='adam')
# fit network
history = model.fit(train_X, train_y, epochs=50, batch_size=72, validation_data=(test_X, test_y), verbose=2, shuffle=False)
# plot history
pyplot.plot(history.history['loss'], label='train')
pyplot.plot(history.history['val_loss'], label='test')
pyplot.legend()
pyplot.show()

# make a prediction
yhat = model.predict(test_X)
test_X = test_X.reshape((test_X.shape[0], n_hours*n_features))
# invert scaling for forecast
inv_yhat = concatenate((yhat, test_X[:, -7:]), axis=1)
inv_yhat = scaler.inverse_transform(inv_yhat)
inv_yhat = inv_yhat[:,0]
# invert scaling for actual
test_y = test_y.reshape((len(test_y), 1))
inv_y = concatenate((test_y, test_X[:, -7:]), axis=1)
inv_y = scaler.inverse_transform(inv_y)
inv_y = inv_y[:,0]
# calculate RMSE
rmse = sqrt(mean_squared_error(inv_y, inv_yhat))
print('Test RMSE: %.3f' % rmse)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1726573338787-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-2">2</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-4">4</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-6">6</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-8">8</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-10">10</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-12">12</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-14">14</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-16">16</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-18">18</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-20">20</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-22">22</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-24">24</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-26">26</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-28">28</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-30">30</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-32">32</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-34">34</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-36">36</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-38">38</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-40">40</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-42">42</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-44">44</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-46">46</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-48">48</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-50">50</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-52">52</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-54">54</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-56">56</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-58">58</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-60">60</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-62">62</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-64">64</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-66">66</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-68">68</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-70">70</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-72">72</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-74">74</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-76">76</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-78">78</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-80">80</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-82">82</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-84">84</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-86">86</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-88">88</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-90">90</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-92">92</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-94">94</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-96">96</div><div class="crayon-num" data-line="crayon-5a659185e1726573338787-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e1726573338787-98">98</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1726573338787-1"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">concatenate</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-3"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">DataFrame</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-6"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">concat</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-7"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">MinMaxScaler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-8"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">preprocessing </span><span class="crayon-e">import </span><span class="crayon-e">LabelEncoder</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-9"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-14"><span class="crayon-p"># convert series to supervised learning</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-15"><span class="crayon-e">def </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_in</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-16"><span class="crayon-h"> </span><span class="crayon-v">n_vars</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">type</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">list </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-17"><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-18"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-19"><span class="crayon-h"> </span><span class="crayon-p"># input sequence (t-n, ... t-1)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-20"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_in</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-21"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-22"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t-%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-23"><span class="crayon-h"> </span><span class="crayon-p"># forecast sequence (t, t+1, ... t+n)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-24"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-25"><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-e">shift</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-26"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-27"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-28"><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-29"><span class="crayon-h"> </span><span class="crayon-v">names</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">(</span><span class="crayon-s">'var%d(t+%d)'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">n_vars</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-30"><span class="crayon-h"> </span><span class="crayon-p"># put it all together</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-31"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concat</span><span class="crayon-sy">(</span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-32"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">names</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-33"><span class="crayon-h"> </span><span class="crayon-p"># drop rows with NaN values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-34"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">dropnan</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-35"><span class="crayon-h"> </span><span class="crayon-v">agg</span><span class="crayon-sy">.</span><span class="crayon-e">dropna</span><span class="crayon-sy">(</span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-36"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">agg</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-37"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-38"><span class="crayon-p"># load dataset</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-39"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'pollution.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-40"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-41"><span class="crayon-p"># integer encode direction</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-42"><span class="crayon-v">encoder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LabelEncoder</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-43"><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">encoder</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-44"><span class="crayon-p"># ensure all data is float</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-45"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-46"><span class="crayon-p"># normalize features</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-47"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">MinMaxScaler</span><span class="crayon-sy">(</span><span class="crayon-v">feature_range</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-48"><span class="crayon-v">scaled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-49"><span class="crayon-p"># specify the number of lag hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-50"><span class="crayon-v">n_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-51"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-52"><span class="crayon-p"># frame as supervised learning</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-53"><span class="crayon-v">reframed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-54"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-55"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-56"><span class="crayon-p"># split into train and test sets</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-57"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">reframed</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-58"><span class="crayon-v">n_train_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">365</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-59"><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-v">n_train_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-60"><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">n_train_hours</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-61"><span class="crayon-p"># split into input and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-62"><span class="crayon-v">n_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_hours *</span><span class="crayon-h"> </span><span class="crayon-e">n_features</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-63"><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-64"><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-65"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-66"><span class="crayon-p"># reshape input to be 3D [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-67"><span class="crayon-v">train_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-68"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-69"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-70"> </div><div class="crayon-line" id="crayon-5a659185e1726573338787-71"><span class="crayon-p"># design network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-72"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-73"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-74"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-75"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mae'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-76"><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-77"><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-cn">72</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">validation_data</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shuffle</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-78"><span class="crayon-p"># plot history</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-79"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'train'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-80"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'val_loss'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'test'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-81"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-82"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-84"><span class="crayon-p"># make a prediction</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-85"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-86"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e ">n_hours*</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-87"><span class="crayon-p"># invert scaling for forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-88"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">yhat</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">7</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-89"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-90"><span class="crayon-v">inv_yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-91"><span class="crayon-p"># invert scaling for actual</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-92"><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-93"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">concatenate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">7</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-94"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">inverse_transform</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-95"><span class="crayon-v">inv_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">inv_y</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-96"><span class="crayon-p"># calculate RMSE</span></div><div class="crayon-line" id="crayon-5a659185e1726573338787-97"><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e1726573338787-98"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test RMSE: %.3f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>The model is fit as before in a minute or two.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e172a730859572" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 45/50
1s - loss: 0.0143 - val_loss: 0.0154
Epoch 46/50
1s - loss: 0.0143 - val_loss: 0.0148
Epoch 47/50
1s - loss: 0.0143 - val_loss: 0.0152
Epoch 48/50
1s - loss: 0.0143 - val_loss: 0.0151
Epoch 49/50
1s - loss: 0.0143 - val_loss: 0.0152
Epoch 50/50
1s - loss: 0.0144 - val_loss: 0.0149</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e172a730859572-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-2">2</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-4">4</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-6">6</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-8">8</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-10">10</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185e172a730859572-12">12</div><div class="crayon-num" data-line="crayon-5a659185e172a730859572-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e172a730859572-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-2">Epoch 45/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-3">1s - loss: 0.0143 - val_loss: 0.0154</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-4">Epoch 46/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-5">1s - loss: 0.0143 - val_loss: 0.0148</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-6">Epoch 47/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-7">1s - loss: 0.0143 - val_loss: 0.0152</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-8">Epoch 48/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-9">1s - loss: 0.0143 - val_loss: 0.0151</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-10">Epoch 49/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-11">1s - loss: 0.0143 - val_loss: 0.0152</div><div class="crayon-line crayon-striped-line" id="crayon-5a659185e172a730859572-12">Epoch 50/50</div><div class="crayon-line" id="crayon-5a659185e172a730859572-13">1s - loss: 0.0144 - val_loss: 0.0149</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>A plot of train and test loss over the epochs is plotted.</p>
<div class="wp-caption aligncenter" id="attachment_4594" style="max-width: 1290px"><img alt="Plot of Loss on the Train and Test Datasets" class="size-full wp-image-4594" height="960" sizes="(max-width: 1280px) 100vw, 1280px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/Plot-of-Loss-on-the-Train-and-Test-Datasets.png" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/Plot-of-Loss-on-the-Train-and-Test-Datasets.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/Plot-of-Loss-on-the-Train-and-Test-Datasets-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/Plot-of-Loss-on-the-Train-and-Test-Datasets-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/Plot-of-Loss-on-the-Train-and-Test-Datasets-1024x768.png 1024w" width="1280"/><p class="wp-caption-text">Plot of Loss on the Train and Test Datasets</p></div>
<p>Finally, the Test RMSE is printed, not really showing any advantage in skill, at least on this problem.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185e1732659961260" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Test RMSE: 27.177</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185e1732659961260-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185e1732659961260-1">Test RMSE: 27.177</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>I would add that the LSTM <a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/">does not appear to be suitable for autoregression type problems</a> and that you may be better off exploring an MLP with a large window.</p>
<p>I hope this example helps you with your own time series forecasting experiments.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking go deeper.</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/Beijing+PM2.5+Data">Beijing PM2.5 Data Set on the UCI Machine Learning Repository</a></li>
<li><a href="http://machinelearningmastery.com/5-step-life-cycle-long-short-term-memory-models-keras/">The 5 Step Life-Cycle for Long Short-Term Memory Models in Keras</a></li>
<li><a href="http://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/">Time Series Forecasting with the Long Short-Term Memory Network in Python</a></li>
<li><a href="http://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/">Multi-step Time Series Forecasting with Long Short-Term Memory Networks in Python</a></li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to fit an LSTM to a multivariate time series forecasting problem.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to transform a raw dataset into something we can use for time series forecasting.</li>
<li>How to prepare data and fit an LSTM for a multivariate time series forecasting problem.</li>
<li>How to make a forecast and rescale the result back into the original units.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-30"> <div class="textwidget"><div class="woo-sc-hr"></div>
<p></p><center>
<h2>Develop LSTMs for Sequence Prediction Today!</h2>
<p><a href="/lstms-with-python/"><img align="left" alt="Long Short-Term Memory Networks with Python" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own LSTM models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/lstms-with-python/">Long Short-Term Memory Networks with Python</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>CNN LSTMs, Encoder-Decoder LSTMs, generative models, data preparation, making predictions</em> and much more…</p>
<h4>Finally Bring LSTM Recurrent Neural Networks to<br/>
Your Sequence Predictions Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/lstms-with-python/">Click to learn more</a>.<br/>
</p></center><br/>
<div class="woo-sc-hr"></div>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fmultivariate-time-series-forecasting-lstms-keras%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/&amp;summary=Neural+networks+like+Long+Short-Term+Memory+%28LSTM%29+recurrent+neural+networks+are+able+to+almost+seam..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=Multivariate%20Time%20Series%20Forecasting%20with%20LSTMs%20in%20Keras&amp;url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/&amp;summary=Neural+networks+like+Long+Short-Term+Memory+%28LSTM%29+recurrent+neural+networks+are+able+to+almost+seam...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/get-the-most-out-of-lstms/" rel="prev"><i class="fa fa-angle-left"></i> Get the Most out of LSTMs on Your Sequence Prediction Problem</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/long-short-term-memory-recurrent-neural-networks-mini-course/" rel="next">Mini-Course on Long Short-Term Memory Recurrent Neural Networks with Keras <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">459 Responses to <em>Multivariate Time Series Forecasting with LSTMs in Keras</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-409580">
<div class="comment-container" id="li-comment-409580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/83f49a8da1dc030d9f671f521839aecc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83f49a8da1dc030d9f671f521839aecc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">zorg</span>
<span class="date">August 14, 2017 at 7:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>except wind *dir*, which is categorical.</p>
<div class="reply">
<a aria-label="Reply to zorg" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409580#respond" onclick='return addComment.moveForm( "comment-409580", "409580", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409630">
<div class="comment-container" id="li-comment-409630">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409630" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, fixed!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409630#respond" onclick='return addComment.moveForm( "comment-409630", "409630", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-426240">
<div class="comment-container" id="li-comment-426240">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">bhupesh</span>
<span class="date">January 12, 2018 at 4:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426240" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>how to use grid search for neurons</p>
<div class="reply">
<a aria-label="Reply to bhupesh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426240#respond" onclick='return addComment.moveForm( "comment-426240", "426240", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-426243">
<div class="comment-container" id="li-comment-426243">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">bhupesh</span>
<span class="date">January 12, 2018 at 4:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426243" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I want to apply grid search in this to tune neurons and add layers</p>
<div class="reply">
<a aria-label="Reply to bhupesh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426243#respond" onclick='return addComment.moveForm( "comment-426243", "426243", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-426244">
<div class="comment-container" id="li-comment-426244">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2121b2fe75956d9f677a3ee43b5f68cd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lstm</span>
<span class="date">January 12, 2018 at 4:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426244" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>and to find best parameters</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426262">
<div class="comment-container" id="li-comment-426262">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426262" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/tune-lstm-hyperparameters-keras-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426262#respond" onclick='return addComment.moveForm( "comment-426262", "426262", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-426562">
<div class="comment-container" id="li-comment-426562">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/23c18392020cfc14e5a519df53d3f6d6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/23c18392020cfc14e5a519df53d3f6d6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">qing</span>
<span class="date">January 15, 2018 at 3:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426562" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello Jason,<br/>
   I have run the code in my spyder and I know the RMSE index is good enough for this model. However, I added the accuracy index in this code, that is<br/>
model.compile(loss=’mae’, optimizer=’adam’, metrics=[‘accuracy’])<br/>
and the accuracy is totally the same in each epoch and is very low (0.0761). I also use my own data to run your code, and the result is the same, with good RMSE values but bad accuracy. I have troubled by this for several days and looking forward to your reply.</p>
<div class="reply">
<a aria-label="Reply to qing" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426562#respond" onclick='return addComment.moveForm( "comment-426562", "426562", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-426586">
<div class="comment-container" id="li-comment-426586">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 15, 2018 at 7:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426586" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You cannot measure accuracy for regression.</p>
<p>Learn more here:<br/>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426586#respond" onclick='return addComment.moveForm( "comment-426586", "426586", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-409643">
<div class="comment-container" id="li-comment-409643">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/efa60fdb1f6da2ef73708fd9280261e3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/efa60fdb1f6da2ef73708fd9280261e3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Francois AKOA</span>
<span class="date">August 15, 2017 at 7:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409643" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great post Jason. Thank you so much for making this material available for the community..</p>
<div class="reply">
<a aria-label="Reply to Francois AKOA" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409643#respond" onclick='return addComment.moveForm( "comment-409643", "409643", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409686">
<div class="comment-container" id="li-comment-409686">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 4:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409686" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Francois, I’m glad it helped!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409686#respond" onclick='return addComment.moveForm( "comment-409686", "409686", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-409671">
<div class="comment-container" id="li-comment-409671">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/67c08b6eb801051e99c97943dba481b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/67c08b6eb801051e99c97943dba481b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://none" rel="external nofollow">yao</a></span>
<span class="date">August 15, 2017 at 2:02 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409671" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi, jason. There were some problems under my environment which were keras2.0.4and tensorflow-GPU0.12.0rc0. </p>
<p>And Bug was that “TypeError: Expected int32, got list containing Tensors of type ‘_Message’ instead.” </p>
<p>The sentence that “model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))” was located.</p>
<p>Could you please help me with that?</p>
<p>Regards,</p>
<p>yao</p>
<div class="reply">
<a aria-label="Reply to yao" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409671#respond" onclick='return addComment.moveForm( "comment-409671", "409671", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-409687">
<div class="comment-container" id="li-comment-409687">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 15, 2017 at 4:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409687" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend this tutorial for setting up your environment:<br/>
<a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409687#respond" onclick='return addComment.moveForm( "comment-409687", "409687", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-409836">
<div class="comment-container" id="li-comment-409836">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/67c08b6eb801051e99c97943dba481b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/67c08b6eb801051e99c97943dba481b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://none" rel="external nofollow">yao</a></span>
<span class="date">August 16, 2017 at 7:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409836" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thx a lot, doctor, it works! fabulous! 🙂</p>
<div class="reply">
<a aria-label="Reply to yao" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409836#respond" onclick='return addComment.moveForm( "comment-409836", "409836", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-409898">
<div class="comment-container" id="li-comment-409898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409898#respond" onclick='return addComment.moveForm( "comment-409898", "409898", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-410063">
<div class="comment-container" id="li-comment-410063">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shirley Yang</span>
<span class="date">August 18, 2017 at 12:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410063" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr.Jason, I update TensorFlow then it works!<br/>
Sorry to bother you.<br/>
Thank you very much !<br/>
Best wishes !</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-410095">
<div class="comment-container" id="li-comment-410095">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 4:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410095" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-4" id="comment-409964">
<div class="comment-container" id="li-comment-409964">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shirley Yang</span>
<span class="date">August 17, 2017 at 8:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409964" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I met the same problem .</p>
<p>Did you uninstall all the programs previously installed or just set up the environment again?</p>
<p>Thx a lot!</p>
<div class="reply">
<a aria-label="Reply to Shirley Yang" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409964#respond" onclick='return addComment.moveForm( "comment-409964", "409964", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-410061">
<div class="comment-container" id="li-comment-410061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a25919eee1afa3c64d6d94075c07154c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shirley Yang</span>
<span class="date">August 18, 2017 at 11:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,I set up my environment as the your tutorial.</p>
<p>scipy: 0.19.0<br/>
numoy: 1.12.1<br/>
matplotlib: 2.0.2<br/>
pandas: 0.20.1<br/>
statsmodels: 0.8.0<br/>
sklearn: 0.18.1</p>
<p>theano: 0.9.0.dev-c697eeab84e5b8a74908da654b66ec9eca4f1291<br/>
tensorflow: 0.12.1<br/>
Using TensorFlow backend.<br/>
keras: 2.0.5</p>
<p>But the bug still existed.Is the version of tensorFlow too odd?How could I do?<br/>
Thanks!</p>
<div class="reply">
<a aria-label="Reply to Shirley Yang" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410061#respond" onclick='return addComment.moveForm( "comment-410061", "410061", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-410093">
<div class="comment-container" id="li-comment-410093">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 4:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410093" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It might be, I am running v1.2.1.</p>
<p>Perhaps try running Keras off Theano instead (e.g. change the backend in the ~/.keras.jason config)</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410093#respond" onclick='return addComment.moveForm( "comment-410093", "410093", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409715">
<div class="comment-container" id="li-comment-409715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Songbin Xu</span>
<span class="date">August 15, 2017 at 10:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It seems that inv_y = scaler.inverse_transform(test_X)[:,0] is not the actual, should inv_yhat be compared with test_y but not pollution(t-1)? Because I think this inv_y here means pollution(t-1).  Is this prediction equals to only making a time shifting from the current known pollution value (which means the models just take pollution(t) as the prediction of pollution(t+1))?</p>
<div class="reply">
<a aria-label="Reply to Songbin Xu" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409715#respond" onclick='return addComment.moveForm( "comment-409715", "409715", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409755">
<div class="comment-container" id="li-comment-409755">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409755" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow. Can you please restate your question, perhaps with an example?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409755#respond" onclick='return addComment.moveForm( "comment-409755", "409755", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-409837">
<div class="comment-container" id="li-comment-409837">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Songbin Xu</span>
<span class="date">August 16, 2017 at 7:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409837" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry for the confusing expression. In fact, the series_to_supervised()  function would create a DataFrame whose columns are: [ var1(t-1), var2(t-1), …, var1(t) ] where ‘var1’ represents ‘pollution’, therefore, the first dimension in test_X (that is, test_X[:,0]) would be ‘pollution(t-1)’. However, in the code you calculate the rmse between inv_yhat and test_X[:,0], even though the rmse is low, it could only shows that the model’s prediction for t+1 is close to what it has known at t.<br/>
I am asking this question because I’ve ran through the codes and saw the models prediction pollution(t+1) looks just like pollution(t). I’ve also tried to use t-1, t-2 and so on for training, but still changed nothing.<br/>
Do you think the model tends to learn to just take the pollution value at current moment as the prediction for the next moment?</p>
<p>thanks 🙂</p>
<div class="reply">
<a aria-label="Reply to Songbin Xu" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409837#respond" onclick='return addComment.moveForm( "comment-409837", "409837", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-409899">
<div class="comment-container" id="li-comment-409899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If we predict t for t+1 that is called persistence, and we show in the tutorial that the LSTM does a lot better than persistence.</p>
<p>Perhaps I don’t understand your question? Can you give me an example of what you are asking?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409899#respond" onclick='return addComment.moveForm( "comment-409899", "409899", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-409925">
<div class="comment-container" id="li-comment-409925">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Songbin Xu</span>
<span class="date">August 17, 2017 at 10:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409925" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hmm, it’s difficult to explain without a graph. </p>
<p>In a word, and also it’s an example, I want to ask two questions: </p>
<p>1. In the “make a prediction” part of your codes, why it computes rmse between predicted t+1 and real t, but not between predicted t+1 and real t+1? </p>
<p>2. After the “make a prediction” part of your codes run, it turns out that rmse between predicted t+1 and real t is small, is it an evidence that LSTM is making persistence?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-409950">
<div class="comment-container" id="li-comment-409950">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 4:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409950" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>RMSE is calculated for y and yhat for the same time periods (well, that was the intent), why do you think they are not?</p>
<p>Is there a bug?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-410006">
<div class="comment-container" id="li-comment-410006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9cb2d2d955e04aaa55980d05b4159598?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9cb2d2d955e04aaa55980d05b4159598?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David Righart</span>
<span class="date">August 18, 2017 at 5:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think Songbin Xu is right. By executing the statement at line 90: inv_y = inv_y[:,0], you compare the inv_yhat with inv_y. inv_y is the polution(t-1) and inv_yhat is the predicted polution(t).</p>
<p>On line 50 the second parameter the function series_to_supervised can be changed to 3 or 5, so more days of history are used. If you do so, an error occurs in the scaler.inverse_transform (line 89).</p>
<p>No worries, great tutorial and I learned a lot so far!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-410028">
<div class="comment-container" id="li-comment-410028">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410028" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see now, you guys are 100% correct. Thank you!</p>
<p>I have updated the calculation of RMSE and the final score reported in the post.</p>
<p>Note, I ran a ton of experiments on AWS with many different lag values &gt; 1 and none achieved better results than a simple lag=1 model (e.g. an LSTM model with no BPTT). I see this as a bad sign for the use of LSTMs for autoregression problems.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409728">
<div class="comment-container" id="li-comment-409728">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Simone</span>
<span class="date">August 16, 2017 at 1:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409728" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, great post!</p>
<p>Is it necessary remove seasonality (by seasonal differentiation) when we are using LSTM?</p>
<div class="reply">
<a aria-label="Reply to Simone" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409728#respond" onclick='return addComment.moveForm( "comment-409728", "409728", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409760">
<div class="comment-container" id="li-comment-409760">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 6:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409760" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, but results are often better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409760#respond" onclick='return addComment.moveForm( "comment-409760", "409760", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409746">
<div class="comment-container" id="li-comment-409746">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6530754bf9385ad8a58fcb0521418317?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6530754bf9385ad8a58fcb0521418317?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Slavenya</span>
<span class="date">August 16, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409746" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good article, thank. </p>
<p>Two questions:<br/>
What changes will be required if your data is sporadic? Meaning sometimes it could be 5 hours without the report.</p>
<p>And how do you add more timesteps into your model? Obviously you have to reshape it properly but you also have to calculate it properly.</p>
<div class="reply">
<a aria-label="Reply to Slavenya" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409746#respond" onclick='return addComment.moveForm( "comment-409746", "409746", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409763">
<div class="comment-container" id="li-comment-409763">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 6:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409763" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could fill in the missing data by imputing or ignore the gaps using masking.</p>
<p>What do you mean by “add more timesteps”?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409763#respond" onclick='return addComment.moveForm( "comment-409763", "409763", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-409832">
<div class="comment-container" id="li-comment-409832">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6530754bf9385ad8a58fcb0521418317?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6530754bf9385ad8a58fcb0521418317?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Slavenya</span>
<span class="date">August 16, 2017 at 7:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409832" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>But what should I do if all data is stochastic time sequence?</p>
<p>For example predicting time till the next event – when events frequency is stochastically distributed on the timeline.</p>
<div class="reply">
<a aria-label="Reply to Slavenya" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409832#respond" onclick='return addComment.moveForm( "comment-409832", "409832", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-409896">
<div class="comment-container" id="li-comment-409896">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 17, 2017 at 6:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409896" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, this sounds like survival analysis to me, perhaps see if it applies:<br/>
<a href="https://en.wikipedia.org/wiki/Survival_analysis" rel="nofollow">https://en.wikipedia.org/wiki/Survival_analysis</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409896#respond" onclick='return addComment.moveForm( "comment-409896", "409896", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409748">
<div class="comment-container" id="li-comment-409748">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 16, 2017 at 5:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409748" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr.Jason,</p>
<p>Thank you for an awesome post.<br/>
(I was practicing on load forecast using MLP and SVR (You also suggested on a comment in your other LSTM tutorials). I also tried with LSTM and it did almost perform like SVR. However, in LSTM, I did not consider time lags because I have predicted future predictor variables that I was feeding as test set. I will try this method with time lags to cross validate the models)</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409748#respond" onclick='return addComment.moveForm( "comment-409748", "409748", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409765">
<div class="comment-container" id="li-comment-409765">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409765" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice Jack, let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409765#respond" onclick='return addComment.moveForm( "comment-409765", "409765", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409798">
<div class="comment-container" id="li-comment-409798">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f56af564eb8e47087e90d539d7349bee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f56af564eb8e47087e90d539d7349bee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">August 16, 2017 at 1:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409798" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Can I use ‘look back'(Using t-2 , t-1 steps data to predict t step air pollution) in this case?<br/>
If it’s available,that my input data shape will be [samples , look back ,  features] isn’t it?</p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409798#respond" onclick='return addComment.moveForm( "comment-409798", "409798", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-409819">
<div class="comment-container" id="li-comment-409819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 16, 2017 at 5:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can Adam, see the series_to_supervised() function and its usage in the tutorial.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409819#respond" onclick='return addComment.moveForm( "comment-409819", "409819", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410106">
<div class="comment-container" id="li-comment-410106">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f56af564eb8e47087e90d539d7349bee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f56af564eb8e47087e90d539d7349bee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">August 18, 2017 at 6:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410106" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>If I used n_in=5 in series_to_supervised() function,in your tutorial the input shape will be [samples, 1 , features*5].Can I reshape it to [samples, 5 , features]?If I can, what is the difference between these two shape?</p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410106#respond" onclick='return addComment.moveForm( "comment-410106", "410106", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-410175">
<div class="comment-container" id="li-comment-410175">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2017 at 6:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410175" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The second dimension is time steps (e.g. BPTT) and the third dimension are the features (e.g. observations at each time step). You can use features as time steps, but it would not really make sense and I expect performance to be poor.</p>
<p>Here’s how to build a model multiple time steps for multiple features:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185ec73d329975306" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# specify number of hours
n_hours = 2
reframed = series_to_supervised(scaled, n_hours, 1)
...

# no longer just drop those columns
# reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)
# print(reframed.head())
...

# be more careful about choosing columns for input and output
n_features = 7
n_obs = n_hours * n_features
train_X, train_y = train[:, 0:n_obs], train[:, -n_features]
test_X, test_y = test[:, 0:n_obs], test[:, -n_features]
# reshape input to be 3D [samples, timesteps, features]
train_X = train_X.reshape((train_X.shape[0], n_hours, n_features))
test_X = test_X.reshape((test_X.shape[0], n_hours, n_features))
print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-2">2</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-4">4</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-6">6</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-8">8</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-10">10</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-12">12</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-14">14</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-16">16</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-18">18</div><div class="crayon-num" data-line="crayon-5a659185ec73d329975306-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ec73d329975306-20">20</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185ec73d329975306-1"><span class="crayon-p"># specify number of hours</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-2"><span class="crayon-v">n_hours</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-3"><span class="crayon-v">reframed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">series_to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">scaled</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-4"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-6"><span class="crayon-p"># no longer just drop those columns</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-7"><span class="crayon-p"># reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-8"><span class="crayon-p"># print(reframed.head())</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-9"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-10"> </div><div class="crayon-line" id="crayon-5a659185ec73d329975306-11"><span class="crayon-p"># be more careful about choosing columns for input and output</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-12"><span class="crayon-v">n_features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-13"><span class="crayon-v">n_obs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_hours *</span><span class="crayon-h"> </span><span class="crayon-e">n_features</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-14"><span class="crayon-v">train_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-15"><span class="crayon-v">test_X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-v">n_obs</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">n_features</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-16"><span class="crayon-p"># reshape input to be 3D [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-17"><span class="crayon-v">train_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-18"><span class="crayon-v">test_X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_hours</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185ec73d329975306-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ec73d329975306-20"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p></p>
<p>And that’s it. I just tested and it looks good. The RMSE calculation will blow up, but you guys can fix that up I figure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410175#respond" onclick='return addComment.moveForm( "comment-410175", "410175", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-410274">
<div class="comment-container" id="li-comment-410274">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7107d96686aa8347c583343cf0bd4607?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7107d96686aa8347c583343cf0bd4607?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.linkedin.com/in/georgeakhoury" rel="external nofollow">George Khoury</a></span>
<span class="date">August 19, 2017 at 11:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410274" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, great post, very clear, and very useful!! I’m about 90% with you and think a few folks may be stuck on this final point if they try to implement multi-feature, multi-hour-lookback LSTM.</p>
<p>Seems like by making adjustments above, I’m able to make a prediction, but the scaling  inversion doesn’t want to cooperate. The reshape step now that we have multiple features and multiple timesteps has a mismatch in the shape, and even if I make the shape work, the concatenation and inversion still don’t work. Could you share what else you changed in this section to make it work? I’m not so concerned about the RMSE as much as that I can extract useful predictions. Thank you for any insight since you’ve been able to do it successfully.</p>
<p># make a prediction<br/>
yhat = model.predict(test_X)<br/>
test_X = test_X.reshape((test_X.shape[0], test_X.shape[2]))<br/>
# invert scaling for forecast<br/>
inv_yhat = concatenate((yhat, test_X[:, 1:]), axis=1)<br/>
inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
inv_yhat = inv_yhat[:,0]</p>
<p>…</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-412090">
<div class="comment-container" id="li-comment-412090">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lg</span>
<span class="date">September 2, 2017 at 12:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412090" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great and useful article.</p>
<p>I am somewhat puzzled by the number of features you specify to forecast the pollution rate based on data from the previous 24 hours.</p>
<p>Do not we have 8 features for each time-step and not 7? </p>
<p>After generating data to supervise with the function series_to_supervised(scaled,24, 1), the resulting array has a shape of (43800, 200) which is 25 * 8. </p>
<p>To invert the scaling for forecast I made few modifications. I used scaled.shape[1] below but in my opinion it could be n_features. Moreover, I don’t know if the values concatenated to yhat and test_y really matter, as long as they have been scaled with fit_transform and the array has the right shape.</p>
<p>yhat = model.predict(test_X)<br/>
test_X = test_X.reshape((test_X.shape[0], n_obs))</p>
<p># invert scaling for forecast<br/>
inv_yhat = concatenate((yhat, test_X[:, 1:scaled.shape[1]]), axis=1)<br/>
inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
inv_yhat = inv_yhat[:,0]</p>
<p># invert scaling for actual<br/>
test_y = test_y.reshape((len(test_y), 1))<br/>
inv_y = concatenate((test_y, test_X[:, 1:scaled.shape[1]]), axis=1)<br/>
inv_y = scaler.inverse_transform(inv_y)<br/>
inv_y = inv_y[:,0]</p>
<p>The model has 4 layers with dropout.<br/>
After 200 epochs I have got<br/>
loss: 0.0169 – val_loss: 0.0162<br/>
And a rmse = 29.173 </p>
<p>Regards.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-412121">
<div class="comment-container" id="li-comment-412121">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412121" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We have 7 features because we drop one in section “2. Basic Data Preparation”.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-412266">
<div class="comment-container" id="li-comment-412266">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lg</span>
<span class="date">September 2, 2017 at 5:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412266" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>It’s really weird to me :(, as I used your code to prepare the data (pollution.csv) and I have 9 fields in the resulting file.   </p>
<p>[date, pollution, dew,  temp, press, wnd_dir,  wnd_spd,  snow,  rain]</p>
<p>😯</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-412343">
<div class="comment-container" id="li-comment-412343">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 3, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412343" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Date and wind direction are dropped during data preparation, perhaps you accidentally skipped a step or are reviewing a different file from the output file?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-412414">
<div class="comment-container" id="li-comment-412414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/27e305af951a8352f9e6f51a9a571925?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lg</span>
<span class="date">September 3, 2017 at 6:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>So that’s fine, in my case I have 8 features.</p>
<p>When reading the file, the field ‘date’ becomes the index of the dataframe and the field ‘wnd_dir’ is later label encoded, as you do above in “The complete example” lines 42-43.</p>
<p>It is now much clearer for me. I am not puzzled anymore. 😉 </p>
<p>Thanks a lot for all the information contained in your articles and your e-books. </p>
<p>They are really very informative.</p>
<p>🙂</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-412462">
<div class="comment-container" id="li-comment-412462">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 4, 2017 at 4:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412462" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-5" id="comment-414370">
<div class="comment-container" id="li-comment-414370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f40067945bead7bb1fc08b4c7efbbdc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f40067945bead7bb1fc08b4c7efbbdc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Cloud</span>
<span class="date">September 20, 2017 at 8:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I think the output is column var1(t), that means:<br/>
train_X, train_y = train[:, 0:n_obs], train[:, -(n_features+1)]<br/>
am I right?<br/>
In case the “pollution” is in the last column, it is easy to get train[:, -1]<br/>
am i right?<br/>
I just want to verify that I understand your post.<br/>
Thank you, Jason</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-416338">
<div class="comment-container" id="li-comment-416338">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hesam</span>
<span class="date">October 11, 2017 at 9:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416338" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have some confusion for this problem.</p>
<p>I want to use a bigger windows (I want to go back in time more, for example t-5 to include more data to make a prediction of the time t) and use all of this to predict one variable (such as just the pollution), like you did. I think predicting one variable will be more accurate than predicting many. Such as pollution and temperature.</p>
<p>What should I do to apply more shift?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-416381">
<div class="comment-container" id="li-comment-416381">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 12, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416381" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I show in another comment how to update the example to use lab obs as input.</p>
<p>I will update the post and add an example to make it clearer.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-417190">
<div class="comment-container" id="li-comment-417190">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/081542682233da03e2ec82ff7651cfa5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/081542682233da03e2ec82ff7651cfa5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kentor</span>
<span class="date">October 19, 2017 at 10:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417190" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thanks for your work and the effort you put in!</p>
<p>I tried to implement your suggestion for increasing the timesteps (BPTT). I have intergrated your code but I keep getting this error in when reshaping test_X in the prediction step:</p>
<p>test_X = test_X.reshape((test_X.shape[0], test_X.shape[2]))<br/>
ValueError: cannot reshape array of size 490532 into shape (35038,7)</p>
<p>Do you have any tips on how to proceed?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-417216">
<div class="comment-container" id="li-comment-417216">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 20, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417216" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I will update the post with a worked example. Adding to trello now…</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-420993">
<div class="comment-container" id="li-comment-420993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2b8c36151c79cd1440b7c1031fafd3f9?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2b8c36151c79cd1440b7c1031fafd3f9?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://-" rel="external nofollow">Robert Dan</a></span>
<span class="date">November 23, 2017 at 10:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.<br/>
  In the code you wrote above, should the following code:</p>
<p>train_X = train_X.reshape((train_X.shape[0], n_hours, n_features))</p>
<p>be actually</p>
<p>train_X = train_X.reshape((train_X.shape[0]/n_hours, n_hours, n_features))</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-421040">
<div class="comment-container" id="li-comment-421040">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421040" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why is that?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-409989">
<div class="comment-container" id="li-comment-409989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/18cde149f64575c684ac6499ed1463ce?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/18cde149f64575c684ac6499ed1463ce?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arun</span>
<span class="date">August 18, 2017 at 12:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I get the following error from line # 82 of your ‘Complete Example’ code.</p>
<p>ValueError: Error when checking : expected lstm_1_input to have 3 dimensions, but got array with shape (34895, 8)</p>
<p>I think LSTM() is looking for (sequences, timesteps, dimensions).  In your code, line # 70, I believe 50 is timesteps while input_shape (1,8) represents the dimensions.  May be it’s missing ‘sequences’ ?</p>
<p>Appreciate your response.</p>
<div class="reply">
<a aria-label="Reply to Arun" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409989#respond" onclick='return addComment.moveForm( "comment-409989", "409989", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410022">
<div class="comment-container" id="li-comment-410022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ensure that you first prepare the data (e.g. convert “raw.csv” to “pollution.csv”).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410022#respond" onclick='return addComment.moveForm( "comment-410022", "410022", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-409995">
<div class="comment-container" id="li-comment-409995">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Neal Valiant</span>
<span class="date">August 18, 2017 at 2:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-409995" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I am wondering what the issue that  I’m getting is caused by, maybe a different type of dataset then the example one. basically when I run the history into the model, When i check the History.history.keys() I only get back ‘loss’ as my only key.</p>
<div class="reply">
<a aria-label="Reply to Neal Valiant" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=409995#respond" onclick='return addComment.moveForm( "comment-409995", "409995", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410024">
<div class="comment-container" id="li-comment-410024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 6:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You must specify the metrics to collect when you compile the model.</p>
<p>For example, in classification:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185ec97a274461512" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185ec97a274461512-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185ec97a274461512-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'categorical_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410024#respond" onclick='return addComment.moveForm( "comment-410024", "410024", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410088">
<div class="comment-container" id="li-comment-410088">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e106f1c922d7e4def5829d66b1d5ed85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e106f1c922d7e4def5829d66b1d5ed85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Aman Garg</span>
<span class="date">August 18, 2017 at 4:18 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410088" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason, </p>
<p>Thank you for such a nice tutorial. </p>
<p>Since you have published a similar topic and few other related topics in one of your paid books (LSTM networks), should the reader also expect some different topics covered in it?</p>
<p>I’m an ardent fan of your blogs since it covers most of the learning material and therefore, it makes me wonder that will be different in your book?</p>
<div class="reply">
<a aria-label="Reply to Aman Garg" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410088#respond" onclick='return addComment.moveForm( "comment-410088", "410088", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410097">
<div class="comment-container" id="li-comment-410097">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 18, 2017 at 4:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410097" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Arman.</p>
<p>The book does not cover time series, instead it focuses on teaching you how to implement a suite of different LSTM architectures, as well as prepare data for your problems.</p>
<p>Some ideas were tested on the blog first, most are only in the book.</p>
<p>You can see the full table of contents here:<br/>
<a href="http://machinelearningmastery.com/lstms-with-python/" rel="nofollow">http://machinelearningmastery.com/lstms-with-python/</a></p>
<p>The book provides all the content in one place, code as well, more access to me, updates as I fix bugs and adapt to new APIs, and it is a great way to support my site so I can keep doing this.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410097#respond" onclick='return addComment.moveForm( "comment-410097", "410097", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410109">
<div class="comment-container" id="li-comment-410109">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/99ed31d9c853901ac7191acd878a068b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Songbin Xu</span>
<span class="date">August 18, 2017 at 6:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410109" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for accepting my opinions, such a pleasure!</p>
<p>Running the codes u modified, still something puzzles me here,</p>
<p>1. Have u drawn the waveforms of inv_y and inv_yhat in the same plot? I think they looks quite like persistence.</p>
<p>2. Curiously, I computed the rmse between pollution(t) and pollution(t-1) in test_X, it’s 4.629, much lower than your final score 26.496, does it mean LSTM performs even worse than persistence?</p>
<p>3. I’ve tried to remove var1 at t-1, t-2, … , and I’ve also tried to use lag values&gt;1, and also assign different weights to the inputs at different timesteps, but none of them improved, they performed even worse. </p>
<p>Do you have any other ideas to avoid the whole model to learn persistence?</p>
<p>Looking forward to your advices 🙂</p>
<div class="reply">
<a aria-label="Reply to Songbin Xu" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410109#respond" onclick='return addComment.moveForm( "comment-410109", "410109", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410176">
<div class="comment-container" id="li-comment-410176">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 19, 2017 at 6:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410176" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for pointing out the fault!</p>
<p>The final line plot shows loss on the transformed train and test sets.</p>
<p>Yes, LSTMs are no good at autoregression, yet I keep getting asked to develop examples (tens of emails per day)… See here:<br/>
<a href="http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">http://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Consider developing a baseline with an MLP, you’ll find it tough to beat it with an LSTM!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410176#respond" onclick='return addComment.moveForm( "comment-410176", "410176", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410231">
<div class="comment-container" id="li-comment-410231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b486a4b040df23a57e3137a46c45dcc4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b486a4b040df23a57e3137a46c45dcc4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://blog.varunajayasiri.com/" rel="external nofollow">Varuna Jayasiri</a></span>
<span class="date">August 19, 2017 at 2:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Why are you only training with a single timestep (or sequence length)? Shouldn’t you use more timesteps for better training/prediction? For instance in <a href="https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py" rel="nofollow">https://github.com/fchollet/keras/blob/master/examples/lstm_text_generation.py</a> they use 40 (maxlen)  timesteps</p>
<div class="reply">
<a aria-label="Reply to Varuna Jayasiri" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410231#respond" onclick='return addComment.moveForm( "comment-410231", "410231", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410300">
<div class="comment-container" id="li-comment-410300">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 20, 2017 at 6:05 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410300" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, it is just an example to help you get started. I do recommend using multiple time steps in order to get the full BPTT.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410300#respond" onclick='return addComment.moveForm( "comment-410300", "410300", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410682">
<div class="comment-container" id="li-comment-410682">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e5cddf7b4f2eea21c26f50c6ce4e71c7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e5cddf7b4f2eea21c26f50c6ce4e71c7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Long.Ye</span>
<span class="date">August 23, 2017 at 11:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410682" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason and Varuna,</p>
<p>When the timesteps = 1 as you mentioned, does it mean the value of t-1 time was used to predict the value of t time?  Is moving window a method to use multiple time steps? Is there any other way? Has Keras any functions of moving window?</p>
<p>Thank you very much.</p>
<div class="reply">
<a aria-label="Reply to Long.Ye" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410682#respond" onclick='return addComment.moveForm( "comment-410682", "410682", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-410713">
<div class="comment-container" id="li-comment-410713">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 4:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410713" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Keras treats the “time steps” of a sequence as the window, kind of. It is the closest match I can think of.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410713#respond" onclick='return addComment.moveForm( "comment-410713", "410713", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410341">
<div class="comment-container" id="li-comment-410341">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a85fee3239fb760a5a9e7423bd4a5322?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a85fee3239fb760a5a9e7423bd4a5322?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lymlin</span>
<span class="date">August 20, 2017 at 4:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410341" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I met some problem when learning your codes.</p>
<p> dataset = read_csv(‘D:\Geany\scriptslym\raw.csv’, parse_dates = [[‘year’, ‘month’, ‘day’, ‘hour’]],index_col=0, data_parser=parse)<br/>
Traceback (most recent call last):<br/>
  File “”, line 1, in<br/>
    dataset = read_csv(‘D:\Geany\scriptslym\raw.csv’, parse_dates = [[‘year’, ‘month’, ‘day’, ‘hour’]],index_col=0, data_parser=parse)<br/>
NameError: name ‘parse’ is not defined<br/>
&gt;&gt;&gt;</p>
<div class="reply">
<a aria-label="Reply to lymlin" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410341#respond" onclick='return addComment.moveForm( "comment-410341", "410341", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410385">
<div class="comment-container" id="li-comment-410385">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 21, 2017 at 6:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410385" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks like you have specified a function “parse” but not defined it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410385#respond" onclick='return addComment.moveForm( "comment-410385", "410385", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410409">
<div class="comment-container" id="li-comment-410409">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/284046cbf75de47d08f02433aa872a65?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/284046cbf75de47d08f02433aa872a65?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">guntama</span>
<span class="date">August 21, 2017 at 11:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410409" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Can I use “keras.layers.normalization.BatchNormalization” as a substitute for “sklearn.preprocessing.MinMaxScaler”?</p>
<div class="reply">
<a aria-label="Reply to guntama" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410409#respond" onclick='return addComment.moveForm( "comment-410409", "410409", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410425">
<div class="comment-container" id="li-comment-410425">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 21, 2017 at 4:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410425" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, they do very different things.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410425#respond" onclick='return addComment.moveForm( "comment-410425", "410425", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410459">
<div class="comment-container" id="li-comment-410459">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb456edc1b5669c6a810c1620dd7583b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb456edc1b5669c6a810c1620dd7583b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Naveen Koneti</span>
<span class="date">August 21, 2017 at 10:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410459" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Its a very Informative article. Thanks. I have a question regarding forecasting in time series. You have used the training data with all the columns while learning after variable transformations and the same has been done for the test data too. The test data along with all the variables were used during prediction.  For instance, If I want to predict the pollution for a future date, Should I know the other inputs like dew, pressure, wind dir etc on a future date which I’m not aware off?  Another question is, Suppose we have same data about multiple regions(let us consider that the pollution among these regions is not negligible), How can we model so that the input argument while prediction is the region name along with time to forecast just for that one region.</p>
<div class="reply">
<a aria-label="Reply to Naveen Koneti" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410459#respond" onclick='return addComment.moveForm( "comment-410459", "410459", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410505">
<div class="comment-container" id="li-comment-410505">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 22, 2017 at 6:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410505" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It depends on how you define your model.</p>
<p>The model defined above uses the variables from the prior time step as inputs to predict the next pollution value.</p>
<p>In your case, maybe you want to build a separate model per region, perhaps a model that improves performance by combining models across regions. You must experiment to see what works best for your data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410505#respond" onclick='return addComment.moveForm( "comment-410505", "410505", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410878">
<div class="comment-container" id="li-comment-410878">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb456edc1b5669c6a810c1620dd7583b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb456edc1b5669c6a810c1620dd7583b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Naveen Koneti</span>
<span class="date">August 24, 2017 at 4:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410878" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks! I missed the trick of converting the time-series to supervised learning problem. That alone is sufficient even for multiple regions I guess. We just have to submit the input parameters of the previous time stamp for the specific region during prediction. We may also try one-hot encoding on the region variable too during data preprocessing.</p>
<div class="reply">
<a aria-label="Reply to Naveen Koneti" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410878#respond" onclick='return addComment.moveForm( "comment-410878", "410878", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-413016">
<div class="comment-container" id="li-comment-413016">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ba915b98ee9c9353aa28720ca0d64356?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ba915b98ee9c9353aa28720ca0d64356?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">LY</span>
<span class="date">September 7, 2017 at 8:12 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413016" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for your excellent blog, Jason. I’ve really learnt a lot from your nice work recently. After this post, I’ve already known how to transform data into data that formates LSTM and how to construct a LSTM model.</p>
<p>Like the question aksed by Naveen Koneti, I have the same puzzle.<br/>
Recently I’ve worked on some clinical data. The data is not like the one we used in this demo. It is consist of hunderds of patients, each patient has several vital sign records. If it is about one individual’s records through many years, I can process the data as what you told us. I wonder how I can conquer this kind of data. Could you give me some advice, or tell me where I can find any solutions about it?<br/>
If I didn’t state my question clearly and you’re interested it, pls let me know.<br/>
Thanks in advance.</p>
<p>PS. the data set in my situation is like this<br/>
[ID           date  feature1 feature2  feautre3 ]<br/>
[patient1 date1 value11  value12  value13  ]<br/>
[patient1 date2 value21  value22  value23  ]<br/>
[patient2 date1 value31  value32  value33  ]<br/>
[patient2 date2……………………………………..]<br/>
[patient3 ……………………………………………..]</p>
<div class="reply">
<a aria-label="Reply to LY" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413016#respond" onclick='return addComment.moveForm( "comment-413016", "413016", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-413203">
<div class="comment-container" id="li-comment-413203">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413203" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could model one patient at a time, or groups or all of them. Try different approaches and see what works best.</p>
<p>I cannot tell you what would work best – I have no idea – you must discover it.</p>
<p>See this post:<br/>
<a href="http://machinelearningmastery.com/a-data-driven-approach-to-machine-learning/" rel="nofollow">http://machinelearningmastery.com/a-data-driven-approach-to-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413203#respond" onclick='return addComment.moveForm( "comment-413203", "413203", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410461">
<div class="comment-container" id="li-comment-410461">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">August 21, 2017 at 11:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410461" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,<br/>
again a nice post for the use of lstm’s!</p>
<p>I had the following idea when reading.</p>
<p>I would like to build a network, in which each feature has its own LSTM neuron/layer, so that the input is not fully connected.<br/>
My idea is adding a lstm layer for each feature and merge it with the merge layer and feed these results to the output neurons.</p>
<p>Is there a better way to do this? Or would you recommend to avoid this because the features are poorly abstracted? On the other hand, this might also be interesting. </p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410461#respond" onclick='return addComment.moveForm( "comment-410461", "410461", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410506">
<div class="comment-container" id="li-comment-410506">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 22, 2017 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410506" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try it and see if it can out-perform a model that learns all features together. </p>
<p>Also, contrast to an MLP with a window – that often does better than LSTMs on autoregression problems.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410506#respond" onclick='return addComment.moveForm( "comment-410506", "410506", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410494">
<div class="comment-container" id="li-comment-410494">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffa63d210ca9bae2becd03e173fc3f83?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffa63d210ca9bae2becd03e173fc3f83?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tryfon</span>
<span class="date">August 22, 2017 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410494" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>I have two questions:</p>
<p>1) I have a question/ notice regarding the scaling of the Y variable (pollution). The way you implement the rescaling between [0-1] you consider the entire length of the array (all of the 43799 observations -after the dropna-). </p>
<p>Is it rightto rescale it that way? By doing so we are incorporating information of the furture (test set) to the past (train set) because the scaler is “exposed” to both of them and therefore we introduce bias. </p>
<p>If you agree with my point what could be a fix?</p>
<p>2) Also the activation function of the output (Y variable) is sigmoid, that’s why we rescale it within the [0,1] range. Am I correct?</p>
<p>Thanks for sharing the article!</p>
<div class="reply">
<a aria-label="Reply to Tryfon" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410494#respond" onclick='return addComment.moveForm( "comment-410494", "410494", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410517">
<div class="comment-container" id="li-comment-410517">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 22, 2017 at 6:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410517" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, ideally you would develop a scaling procedure on the training data and use it on test and when making predictions on new data.</p>
<p>I tried to keep the tutorial simple by scaling all data together.</p>
<p>The activation on the output layer is ‘linear’, the default. This must be the case because we are predicting a real-value.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410517#respond" onclick='return addComment.moveForm( "comment-410517", "410517", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410570">
<div class="comment-container" id="li-comment-410570">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e81d6edb489cc4a4a539cba56dba1172?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e81d6edb489cc4a4a539cba56dba1172?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">WCH</span>
<span class="date">August 22, 2017 at 5:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410570" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you very much for your tutorial.</p>
<p>I have one question, </p>
<p>but I  failed to read the NW in pollution. csv.(cbwd column) </p>
<p>values = values.astype(‘float32’)<br/>
ValueError: could not convert string to float: NW</p>
<p>How do you fix it?</p>
<div class="reply">
<a aria-label="Reply to WCH" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410570#respond" onclick='return addComment.moveForm( "comment-410570", "410570", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-410572">
<div class="comment-container" id="li-comment-410572">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e81d6edb489cc4a4a539cba56dba1172?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e81d6edb489cc4a4a539cba56dba1172?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">WCH</span>
<span class="date">August 22, 2017 at 5:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410572" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sorry, I saw the text above and solved it.</p>
<div class="reply">
<a aria-label="Reply to WCH" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410572#respond" onclick='return addComment.moveForm( "comment-410572", "410572", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-410648">
<div class="comment-container" id="li-comment-410648">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410648" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410648#respond" onclick='return addComment.moveForm( "comment-410648", "410648", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410574">
<div class="comment-container" id="li-comment-410574">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/76d656b353162989e5226ffabfb411de?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/76d656b353162989e5226ffabfb411de?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dmitry</span>
<span class="date">August 22, 2017 at 5:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410574" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!<br/>
I assume there is little mistake when you calculate RMSE on test data.<br/>
You must write this code before calculate RMSE: </p>
<p>inv_y = inv_y[:-1]<br/>
inv_yhat = inv_yhat[1:]</p>
<p>Thus, RMSE equals 10.6 (on the same data, in my case), that is much less than 26.5 in your case.</p>
<div class="reply">
<a aria-label="Reply to Dmitry" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410574#respond" onclick='return addComment.moveForm( "comment-410574", "410574", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410649">
<div class="comment-container" id="li-comment-410649">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410649" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t understand your comment and snippet of code, can you spell out the bug you see?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410649#respond" onclick='return addComment.moveForm( "comment-410649", "410649", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-419815">
<div class="comment-container" id="li-comment-419815">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d713d62e11b0bb299172446029774587?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d713d62e11b0bb299172446029774587?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 12, 2017 at 2:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419815" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This beats further exploration</p>
<div class="reply">
<a aria-label="Reply to Tommy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419815#respond" onclick='return addComment.moveForm( "comment-419815", "419815", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-424454">
<div class="comment-container" id="li-comment-424454">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/12988f65ba5769d937b28a01613f0b57?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/12988f65ba5769d937b28a01613f0b57?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Azhar Khan</span>
<span class="date">December 22, 2017 at 11:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424454" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I agree with @Dmitry here. The prediction “inv_yhat” is one index ahead of real output “inv_y”.</p>
<p>It can be seen by plotting predicted output v/s real output:<br/>
pyplot.plot(inv_y[:-1,], color=’green’, marker=’o’, label = ‘Real Screening Count’)<br/>
pyplot.plot(inv_yhat[1:,], color=’red’, marker=’o’, label = ‘Predicted Screening Count’)<br/>
pyplot.legend()<br/>
pyplot.show()</p>
<p>Compute RMSE by skipping first element of inv_yhat, and better RSME score is presented:<br/>
rmse = sqrt(mean_squared_error(inv_y[:-1,], inv_yhat[1:,]))<br/>
print(‘Test RMSE: %.3f’ % rmse)</p>
<p>rmse = sqrt(mean_squared_error(inv_y, inv_yhat))<br/>
print(‘Test RMSE: %.3f’ % rmse)</p>
<div class="reply">
<a aria-label="Reply to Azhar Khan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424454#respond" onclick='return addComment.moveForm( "comment-424454", "424454", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410603">
<div class="comment-container" id="li-comment-410603">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/544d1a205925f88d63d380ce45ebabbd?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/544d1a205925f88d63d380ce45ebabbd?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jan</span>
<span class="date">August 22, 2017 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410603" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>great post! I was waiting for meteo problems to infiltrate the machinelearningmastery world.</p>
<p>Could you write something about the changed scenareo where, given the weather conditions and pollution for some time, we can predict the pollution for another time or place with given weather conditions?</p>
<p>For example: We have the weather conditions and pollution given for Beijing in 2016, and we have the weather conditions given for Chengde (city close to Bejing) also in 2016. Now we want to know how was the pollution in Chengde in 2016.</p>
<p>Would be great to learn about that!</p>
<div class="reply">
<a aria-label="Reply to jan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410603#respond" onclick='return addComment.moveForm( "comment-410603", "410603", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410659">
<div class="comment-container" id="li-comment-410659">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 6:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410659" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great suggestion, I like it. An approach would be to train the model to generalize across geographical domains based only on weather conditions.</p>
<p>I have tried not to use too many weather examples – I came from 6 years of work in severe weather, it’s too close to home 🙂</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410659#respond" onclick='return addComment.moveForm( "comment-410659", "410659", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410673">
<div class="comment-container" id="li-comment-410673">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Simone</span>
<span class="date">August 23, 2017 at 9:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410673" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I have read many of your posts about LSTM. I have not completely clear the difference between the parameters batch_size and time_steps. Batch_size means when the memory is reset (right?), but this shouldn’t have the same value of time_steps that, if I have understood correctly, means how often the system makes a prediction?</p>
<div class="reply">
<a aria-label="Reply to Simone" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410673#respond" onclick='return addComment.moveForm( "comment-410673", "410673", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410711">
<div class="comment-container" id="li-comment-410711">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 23, 2017 at 4:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410711" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question!</p>
<p>Batch size is the number of samples (e.g. sequences) to that are used to estimate the gradient before the weights are updated. The internal state is reset at the end of each batch after the weights are updated.</p>
<p>One sample is comprised of 1 or more time steps that are stepped over during backpropagation through time. Each time step may have one or more features (e.g. observations recorded at that time).</p>
<p>Time steps and batch size and generally not related.</p>
<p>You can split up a sequence to have one-time step per sequence. In that case you will not get the benefit of learning across time (e.g. bptt), but you can reset state at the end of the time steps for one sequence. This an odd config though and really only good to showing off the LSTMs memory capability.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410711#respond" onclick='return addComment.moveForm( "comment-410711", "410711", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-410802">
<div class="comment-container" id="li-comment-410802">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a711cbfc1f33a66dd2114f9da3b9cf13?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Simone</span>
<span class="date">August 24, 2017 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410802" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, now it’s more clear!</p>
<div class="reply">
<a aria-label="Reply to Simone" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410802#respond" onclick='return addComment.moveForm( "comment-410802", "410802", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410747">
<div class="comment-container" id="li-comment-410747">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/87dbe816af4e7fcf75d3c6221840c846?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/87dbe816af4e7fcf75d3c6221840c846?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pedro</span>
<span class="date">August 23, 2017 at 8:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410747" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,I ger this error at this step, could you help me please?</p>
<p>model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))</p>
<p>—————————————————————————<br/>
TypeError                                 Traceback (most recent call last)<br/>
 in ()<br/>
—-&gt; 1 model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))</p>
<p>C:\Anaconda3\lib\site-packages\keras\models.py in add(self, layer)<br/>
    431                 # and create the node connecting the current layer<br/>
    432                 # to the input layer we just created.<br/>
–&gt; 433                 layer(x)<br/>
    434<br/>
    435             if len(layer.inbound_nodes) != 1:</p>
<p>C:\Anaconda3\lib\site-packages\keras\layers\recurrent.py in __call__(self, inputs, initial_state, **kwargs)<br/>
    241         # modify the input spec to include the state.<br/>
    242         if initial_state is None:<br/>
–&gt; 243             return super(Recurrent, self).__call__(inputs, **kwargs)<br/>
    244<br/>
    245         if not isinstance(initial_state, (list, tuple)):</p>
<p>C:\Anaconda3\lib\site-packages\keras\engine\topology.py in __call__(self, inputs, **kwargs)<br/>
    556                                          ‘<code>layer.build(batch_input_shape)</code>‘)<br/>
    557                 if len(input_shapes) == 1:<br/>
–&gt; 558                     self.build(input_shapes[0])<br/>
    559                 else:<br/>
    560                     self.build(input_shapes)</p>
<p>C:\Anaconda3\lib\site-packages\keras\layers\recurrent.py in build(self, input_shape)<br/>
   1010                                         initializer=bias_initializer,<br/>
   1011                                         regularizer=self.bias_regularizer,<br/>
-&gt; 1012                                         constraint=self.bias_constraint)<br/>
   1013         else:<br/>
   1014             self.bias = None</p>
<p>C:\Anaconda3\lib\site-packages\keras\legacy\interfaces.py in wrapper(*args, **kwargs)<br/>
     86                 warnings.warn(‘Update your <code>' + object_name +<br/>
     87                               '</code> call to the Keras 2 API: ‘ + signature, stacklevel=2)<br/>
—&gt; 88             return func(*args, **kwargs)<br/>
     89         wrapper._legacy_support_signature = inspect.getargspec(func)<br/>
     90         return wrapper</p>
<p>C:\Anaconda3\lib\site-packages\keras\engine\topology.py in add_weight(self, name, shape, dtype, initializer, regularizer, trainable, constraint)<br/>
    389         if dtype is None:<br/>
    390             dtype = K.floatx()<br/>
–&gt; 391         weight = K.variable(initializer(shape), dtype=dtype, name=name)<br/>
    392         if regularizer is not None:<br/>
    393             self.add_loss(regularizer(weight))</p>
<p>C:\Anaconda3\lib\site-packages\keras\layers\recurrent.py in bias_initializer(shape, *args, **kwargs)<br/>
   1002                         self.bias_initializer((self.units,), *args, **kwargs),<br/>
   1003                         initializers.Ones()((self.units,), *args, **kwargs),<br/>
-&gt; 1004                         self.bias_initializer((self.units * 2,), *args, **kwargs),<br/>
   1005                     ])<br/>
   1006             else:</p>
<p>C:\Anaconda3\lib\site-packages\keras\backend\tensorflow_backend.py in concatenate(tensors, axis)<br/>
   1679         return tf.sparse_concat(axis, tensors)<br/>
   1680     else:<br/>
-&gt; 1681         return tf.concat([to_dense(x) for x in tensors], axis)<br/>
   1682<br/>
   1683 </p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\ops\array_ops.py in concat(concat_dim, values, name)<br/>
    998       ops.convert_to_tensor(concat_dim,<br/>
    999                             name=”concat_dim”,<br/>
-&gt; 1000                             dtype=dtypes.int32).get_shape(<br/>
   1001                             ).assert_is_compatible_with(tensor_shape.scalar())<br/>
   1002       return identity(values[0], name=scope)</p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\framework\ops.py in convert_to_tensor(value, dtype, name, as_ref, preferred_dtype)<br/>
    667<br/>
    668         if ret is None:<br/>
–&gt; 669           ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)<br/>
    670<br/>
    671         if ret is NotImplemented:</p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\framework\constant_op.py in _constant_tensor_conversion_function(v, dtype, name, as_ref)<br/>
    174                                          as_ref=False):<br/>
    175   _ = as_ref<br/>
–&gt; 176   return constant(v, dtype=dtype, name=name)<br/>
    177<br/>
    178 </p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\framework\constant_op.py in constant(value, dtype, shape, name, verify_shape)<br/>
    163   tensor_value = attr_value_pb2.AttrValue()<br/>
    164   tensor_value.tensor.CopyFrom(<br/>
–&gt; 165       tensor_util.make_tensor_proto(value, dtype=dtype, shape=shape, verify_shape=verify_shape))<br/>
    166   dtype_value = attr_value_pb2.AttrValue(type=tensor_value.tensor.dtype)<br/>
    167   const_tensor = g.create_op(</p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_util.py in make_tensor_proto(values, dtype, shape, verify_shape)<br/>
    365       nparray = np.empty(shape, dtype=np_dt)<br/>
    366     else:<br/>
–&gt; 367       _AssertCompatible(values, dtype)<br/>
    368       nparray = np.array(values, dtype=np_dt)<br/>
    369       # check to them.</p>
<p>C:\Anaconda3\lib\site-packages\tensorflow\python\framework\tensor_util.py in _AssertCompatible(values, dtype)<br/>
    300     else:<br/>
    301       raise TypeError(“Expected %s, got %s of type ‘%s’ instead.” %<br/>
–&gt; 302                       (dtype.name, repr(mismatch), type(mismatch).__name__))<br/>
    303<br/>
    304 </p>
<p>TypeError: Expected int32, got list containing Tensors of type ‘_Message’ instead.</p>
<div class="reply">
<a aria-label="Reply to Pedro" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410747#respond" onclick='return addComment.moveForm( "comment-410747", "410747", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410811">
<div class="comment-container" id="li-comment-410811">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410811" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps check that your environment is setup correctly:<br/>
<a href="http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" rel="nofollow">http://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/</a></p>
<p>Also, ensure that you have copied all of the code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410811#respond" onclick='return addComment.moveForm( "comment-410811", "410811", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-410773">
<div class="comment-container" id="li-comment-410773">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Neal Valiant</span>
<span class="date">August 24, 2017 at 2:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410773" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I was curious if you can point me in the right direction for converting data back to the actual values instead of scaled.</p>
<div class="reply">
<a aria-label="Reply to Neal Valiant" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410773#respond" onclick='return addComment.moveForm( "comment-410773", "410773", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410818">
<div class="comment-container" id="li-comment-410818">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410818" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you can invert the scaling.</p>
<p>This tutorial demonstrates how to do that Neal.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410818#respond" onclick='return addComment.moveForm( "comment-410818", "410818", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-411005">
<div class="comment-container" id="li-comment-411005">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/584ad99335f9602fc42d4330df7032ba?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Neal Valiant</span>
<span class="date">August 25, 2017 at 7:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411005" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I did have an issue converting back to actual values, but was able to get past it using the drop columns on the reframed data which got me past it.</p>
<p>When looking at my predicted values vs actual values, I’m noticing that my first column has a prediction and a true value, but for every other variable, I only see what I can assume is a prediction? does this make a prediction on every column, or just one particular one.</p>
<p>Im sorry for asking a question such as this, I just think I’m confusing myself looking at my results.</p>
<div class="reply">
<a aria-label="Reply to Neal Valiant" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411005#respond" onclick='return addComment.moveForm( "comment-411005", "411005", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-411063">
<div class="comment-container" id="li-comment-411063">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 25, 2017 at 3:56 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411063" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The code in the tutorial only predicts pollution.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411063#respond" onclick='return addComment.moveForm( "comment-411063", "411063", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-410778">
<div class="comment-container" id="li-comment-410778">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 24, 2017 at 3:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410778" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Jason,<br/>
I have been trying with my own dataset and I am getting an error “ValueError: operands could not be broadcast together with shapes (168,39) (41,) (168,39)” when I try to do <code>inv_yhat = scaler.inverse_transform(inv_yhat)</code> as you have in line 86 in your script. I still can not figure out where my issue is. I have <code>yhat.shape</code> as (168,1) and test_X.shape<code> as (168,38). When I do this,  </code>inv_yhat = np.concatenate((yhat, test_X[:, 1:]), axis=1)<code>, my </code>inv_yhat.shape<code> is (168,39)</code>. I still can not figure why <code>inverse_transform</code> gives that error.</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410778#respond" onclick='return addComment.moveForm( "comment-410778", "410778", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-410819">
<div class="comment-container" id="li-comment-410819">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410819" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The shape of the data must be the same when inverting the scale as when it was originally scaled.</p>
<p>This means, if you scaled with the entire test dataset (all columns), then you need to tack the yhat onto the test dataset for the inverse. We jump through these exact hoops at the end of the example when calculating RMSE.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410819#respond" onclick='return addComment.moveForm( "comment-410819", "410819", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-410827">
<div class="comment-container" id="li-comment-410827">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/745b6d75c628c22c2ccb4d64f905e90b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/745b6d75c628c22c2ccb4d64f905e90b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jay Regalia</span>
<span class="date">August 24, 2017 at 7:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410827" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This seems to be the same issue I am having at the moment also. i concatenate my inv_yhat with my test_X like you said, but the shape of inv_yhat after is still not taking into account the 2nd numbers(in posts case (41,).</p>
<div class="reply">
<a aria-label="Reply to Jay Regalia" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410827#respond" onclick='return addComment.moveForm( "comment-410827", "410827", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-411156">
<div class="comment-container" id="li-comment-411156">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 26, 2017 at 6:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411156" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ask a question in stackoverflow and post the link, I should be able to help. I spent lots of time on this and have a decent idea now.</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411156#respond" onclick='return addComment.moveForm( "comment-411156", "411156", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-410829">
<div class="comment-container" id="li-comment-410829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 24, 2017 at 7:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you’re right! I did that and it worked, nice! Thank you for your comment!</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410829#respond" onclick='return addComment.moveForm( "comment-410829", "410829", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-410882">
<div class="comment-container" id="li-comment-410882">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 4:24 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410882" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear that Jack.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410882#respond" onclick='return addComment.moveForm( "comment-410882", "410882", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-3" id="comment-410835">
<div class="comment-container" id="li-comment-410835">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/745b6d75c628c22c2ccb4d64f905e90b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/745b6d75c628c22c2ccb4d64f905e90b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John Regilina</span>
<span class="date">August 24, 2017 at 8:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410835" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am having the same problem, but cannot solve the issue. everytime i try to concatenante them together, there is not change to my inv_yhat variable. i still am unable to understand this issue if you can expand a bit more that would be amazing</p>
<div class="reply">
<a aria-label="Reply to John Regilina" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410835#respond" onclick='return addComment.moveForm( "comment-410835", "410835", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-4" id="comment-411159">
<div class="comment-container" id="li-comment-411159">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bf2c5c24800dc323de5ac11cb41b354d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jack Dan</span>
<span class="date">August 26, 2017 at 6:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411159" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>@John Regilina,<br/>
Check the shape of data after you scale the data and then check the scale again after you do the concatenation. Remember, when your <code>yhat</code> shape will be (rowlength,1) and after concatenation <code>inv_yhat</code> should be the same shape after you scaled the data. Look at Dr.Jason’s answer to my comment/question. Hope that will help. (Thanks to Dr.Jason saved a lot of my time)</p>
<div class="reply">
<a aria-label="Reply to Jack Dan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411159#respond" onclick='return addComment.moveForm( "comment-411159", "411159", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even depth-2" id="comment-414268">
<div class="comment-container" id="li-comment-414268">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shan</span>
<span class="date">September 19, 2017 at 1:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414268" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I am also stuck with same thing. How did you fix it?</p>
<div class="reply">
<a aria-label="Reply to Shan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414268#respond" onclick='return addComment.moveForm( "comment-414268", "414268", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410786">
<div class="comment-container" id="li-comment-410786">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/979e63fca56622202562027e7dbb954b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/979e63fca56622202562027e7dbb954b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lizzie</span>
<span class="date">August 24, 2017 at 4:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410786" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, In  dataset.drop(‘No’, axis =1, inplace = True), what is the purpose of ‘axis’ and ‘inplace’?</p>
<div class="reply">
<a aria-label="Reply to Lizzie" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410786#respond" onclick='return addComment.moveForm( "comment-410786", "410786", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410820">
<div class="comment-container" id="li-comment-410820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question.</p>
<p>We specify to remove the column with axis=1 and to do it on the array in memory with inplace rather than return a copy of the array with the column removed.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410820#respond" onclick='return addComment.moveForm( "comment-410820", "410820", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410790">
<div class="comment-container" id="li-comment-410790">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/979e63fca56622202562027e7dbb954b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/979e63fca56622202562027e7dbb954b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lizzie</span>
<span class="date">August 24, 2017 at 4:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410790" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Fabulous tutorials Jason!</p>
<div class="reply">
<a aria-label="Reply to Lizzie" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410790#respond" onclick='return addComment.moveForm( "comment-410790", "410790", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410821">
<div class="comment-container" id="li-comment-410821">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410821" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Lizzie.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410821#respond" onclick='return addComment.moveForm( "comment-410821", "410821", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-410796">
<div class="comment-container" id="li-comment-410796">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfee7ce9962f3518519a13d91db9c1ec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Jaskaran</span>
<span class="date">August 24, 2017 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410796" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can you show how the multi variate forecast looks like?<br/>
Looks like you missed it in the article.</p>
<div class="reply">
<a aria-label="Reply to Jaskaran" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410796#respond" onclick='return addComment.moveForm( "comment-410796", "410796", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410824">
<div class="comment-container" id="li-comment-410824">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 24, 2017 at 6:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410824" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure,</p>
<p>You can plot all predictions as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185ebe87823114137" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
pyplot.plot(inv_yhat)
pyplot.plot(inv_y)
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185ebe87823114137-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ebe87823114137-2">2</div><div class="crayon-num" data-line="crayon-5a659185ebe87823114137-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185ebe87823114137-1"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ebe87823114137-2"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185ebe87823114137-3"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p>You get:</p>
<p><img alt="" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/all.png"/></p>
<p>It’s a mess, you can plot the last 100 time steps as follows:</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a659185ebe96292704381" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
pyplot.plot(inv_yhat[-100:])
pyplot.plot(inv_y[-100:])
pyplot.show()</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a659185ebe96292704381-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a659185ebe96292704381-2">2</div><div class="crayon-num" data-line="crayon-5a659185ebe96292704381-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a659185ebe96292704381-1"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">inv_yhat</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">100</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a659185ebe96292704381-2"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">inv_y</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">100</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a659185ebe96292704381-3"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p>You get:<br/>
<img alt="" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/08/100.png"/></p>
<p>The predictions look like persistence.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410824#respond" onclick='return addComment.moveForm( "comment-410824", "410824", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-411580">
<div class="comment-container" id="li-comment-411580">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/48d470509eb41a1ab9a034e535d0cdbf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/48d470509eb41a1ab9a034e535d0cdbf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">BEN BECKER</span>
<span class="date">August 29, 2017 at 1:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411580" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, what am I missing, looking at your plot of the most recent 100 time steps, it looks like the predicted value is always 1 time period after the actual?  If on step 90 the actual is 17, but the predicted value shows 17 for step 91, we are one time period off, that is if we shifted the predicted values back a day, it would overlap with the actual which doesn’t really buy us much since the next hour prediction seems to really align with the prior actual.  Am I missing something looking at this chart?</p>
<div class="reply">
<a aria-label="Reply to BEN BECKER" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411580#respond" onclick='return addComment.moveForm( "comment-411580", "411580", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-411621">
<div class="comment-container" id="li-comment-411621">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2017 at 5:16 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411621" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is what a persistence forecast looks like, that value(t) = value(t-1).</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411621#respond" onclick='return addComment.moveForm( "comment-411621", "411621", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-411647">
<div class="comment-container" id="li-comment-411647">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/48d470509eb41a1ab9a034e535d0cdbf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/48d470509eb41a1ab9a034e535d0cdbf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">BECKER</span>
<span class="date">August 29, 2017 at 9:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411647" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So how would you get the true predicted value(t)?  I am thinking of the last record in the time series where we are trying to predict the value for the next hour.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-411697">
<div class="comment-container" id="li-comment-411697">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 30, 2017 at 6:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411697" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t follow. Perhaps you can restate your question?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-415340">
<div class="comment-container" id="li-comment-415340">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/92e3597973d61ab1514845b684ceed6b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/92e3597973d61ab1514845b684ceed6b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anna</span>
<span class="date">October 2, 2017 at 4:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415340" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason Brownlee</p>
<p>Thank you for your great posts. I run the model above for my data and it works perfectly, how ever when I draw the real data (blue one –  inv_y) and the prediction (the orange one – inv_yhat), the result shows the prediction is delay after 1 step. it should be predicted one step before as your graph. your model is the same with the matlab tool:<br/>
<a href="https://nl.mathworks.com/videos/maglev-modeling-with-neural-time-series-tool-68797.html" rel="nofollow">https://nl.mathworks.com/videos/maglev-modeling-with-neural-time-series-tool-68797.html</a></p>
<p>And after running the model, I  applyed realtime this model for my problem to compute the inv_yhat in every step. I got the result is really bad, since I have never had the real inv_y. I took the prediction to feed the input ( instead of real data inv_y)</p>
<p>My problem is: I received some signals as  inputs, then I labeled offline to have  output (real data inv_y or the first column in train_X)</p>
<p>Do you have the model that trains without the real data in the first column?????? thank you</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-415370">
<div class="comment-container" id="li-comment-415370">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 3, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415370" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your model may have low skill and be simply predicting the input as the output (e.g. persistence).</p>
<p>You may need to continue to develop your model, I list some ideas for lifting model skill here:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-417939">
<div class="comment-container" id="li-comment-417939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8ac0a5ef4dc2d6ea3a0f5037b59c666c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8ac0a5ef4dc2d6ea3a0f5037b59c666c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tyler Byers</span>
<span class="date">October 26, 2017 at 3:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It’s definitely similar to a persistence model since we trained the model using the <code>var1(t-1)</code> feature (i.e. the lagged pollution feature). The model certainly found that to be the strongest predictor. This would be ok if we were doing predictions later on an hour-by-hour basis.  But, if, say we want to predict the pollution 20 hours from now, we aren’t yet going to know what the hour-19 pollution is. So it seems like cheating to include this variable in the training and prediction sets.</p>
<p>I removed this variable to train the model, leaving other parameters about the same, and was then only able to get a minimum validation loss of 0.55 and test RMSE of 87.02</p>
<div class="reply">
<a aria-label="Reply to Tyler Byers" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417939#respond" onclick='return addComment.moveForm( "comment-417939", "417939", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-417971">
<div class="comment-container" id="li-comment-417971">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417971" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice work.</p>
<p>It’s not cheating, it comes down to different framings of the problem based on the requirements of the problem.</p>
<p>This post can help if you want to explore direct multi-step forecasting:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417971#respond" onclick='return addComment.moveForm( "comment-417971", "417971", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-3" id="comment-424753">
<div class="comment-container" id="li-comment-424753">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/36682ea74789ca76efee0fc0a6b5e829?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/36682ea74789ca76efee0fc0a6b5e829?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">xeo</span>
<span class="date">December 26, 2017 at 4:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424753" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It looks the prediction is pretty good. Can we say the lstm model is good?</p>
<div class="reply">
<a aria-label="Reply to xeo" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424753#respond" onclick='return addComment.moveForm( "comment-424753", "424753", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-424768">
<div class="comment-container" id="li-comment-424768">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 26, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424768" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think LSTMs are poor at autoregression.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424768#respond" onclick='return addComment.moveForm( "comment-424768", "424768", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-410931">
<div class="comment-container" id="li-comment-410931">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c18ad8c603d4bbd29cba87d74f50eac6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c18ad8c603d4bbd29cba87d74f50eac6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">gammarayburst</span>
<span class="date">August 24, 2017 at 11:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410931" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Wind dir is label encoded not wind speed!!!</p>
<div class="reply">
<a aria-label="Reply to gammarayburst" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410931#respond" onclick='return addComment.moveForm( "comment-410931", "410931", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-410989">
<div class="comment-container" id="li-comment-410989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 25, 2017 at 6:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-410989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=410989#respond" onclick='return addComment.moveForm( "comment-410989", "410989", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411278">
<div class="comment-container" id="li-comment-411278">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b39a469060133808c7214722798e5159?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b39a469060133808c7214722798e5159?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Filipe</span>
<span class="date">August 27, 2017 at 4:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411278" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all, thanks. All of this material on the blog is super interesting, and helpful and making me learn a lot. </p>
<p>Of course… I have a question. </p>
<p>I’m surprised by the use of LSTMs here. The property of them being “stateful” I guess is being used. But is there “sequence” information flowing? </p>
<p>So when I used LSTMs in Keras for text classification tasks (sentence, outcome), each “sentence” is a sequence. Each observation is a sequence. It’s an ordered array of the words in the sentence (and it’s outcome).<br/>
In this example, I could not see a sense in which var1(t-1) is linked to var1(t-2). Aren’t they being treated as independent Xs in a regression problem? (predicting var8(t))</p>
<div class="reply">
<a aria-label="Reply to Filipe" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411278#respond" onclick='return addComment.moveForm( "comment-411278", "411278", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411296">
<div class="comment-container" id="li-comment-411296">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 27, 2017 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411296" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Correct, we are not providing a sequence of observations and therefore not getting good BPTT.</p>
<p>Based on my tests, I have found LSTMs to be poor at autoregression, and in this case, as I added more history to the model (longer sequences), performance degraded.</p>
<p>I would strongly encourage you to use an MLP baseline that any MLP would have to out-perform.</p>
<p>See this post for more on the limitations of LSTM for time series:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411296#respond" onclick='return addComment.moveForm( "comment-411296", "411296", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411284">
<div class="comment-container" id="li-comment-411284">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/747937e1262044972f0f987667efc8e2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/747937e1262044972f0f987667efc8e2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.linkedin.com/in/stylianos-iordanis-34787a19/" rel="external nofollow">STYLIANOS IORDANIS</a></span>
<span class="date">August 27, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411284" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome article, as always.<br/>
Btw, what is your view on using an autoencoder/ restricted Boltzmann layer compressing features/ features before feeding an LSTM network ? For example, if one has a financial timeseries to forecast, e.g. a classifier trying to predict increase or decrease in a look ahead time window, via numerous technical indicators and/or other candidate exogenous leading indicators…..<br/>
Could you write an article based on that idea?</p>
<div class="reply">
<a aria-label="Reply to STYLIANOS IORDANIS" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411284#respond" onclick='return addComment.moveForm( "comment-411284", "411284", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411297">
<div class="comment-container" id="li-comment-411297">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 27, 2017 at 5:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411297" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have seen better results from large MLPs, nevertheless, try it and see how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411297#respond" onclick='return addComment.moveForm( "comment-411297", "411297", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-411309">
<div class="comment-container" id="li-comment-411309">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/747937e1262044972f0f987667efc8e2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/747937e1262044972f0f987667efc8e2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">STYLIANOS IORDANIS</span>
<span class="date">August 27, 2017 at 7:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411309" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>autoencoder/ restricted Boltzmann layers also deal with multicollinearity issues… do MLPs also deal with multicollinearity if you have multicollinearity in the features, right?</p>
<div class="reply">
<a aria-label="Reply to STYLIANOS IORDANIS" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411309#respond" onclick='return addComment.moveForm( "comment-411309", "411309", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-411424">
<div class="comment-container" id="li-comment-411424">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 28, 2017 at 6:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411424" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>MLPs are more robust to multicollinearity than linear models.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411424#respond" onclick='return addComment.moveForm( "comment-411424", "411424", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411514">
<div class="comment-container" id="li-comment-411514">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d34f88ace6fa5777154aa3e43c0456c7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d34f88ace6fa5777154aa3e43c0456c7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hee Un</span>
<span class="date">August 29, 2017 at 12:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411514" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, I am always amazed at your article. Thank you.<br/>
I have a question.<br/>
Is this LSTM code now weighted for each features?<br/>
Nowdays, I’m predicting precipitation, that is the trend is correct, but the amount is not right.<br/>
What’s wrong with that?:(</p>
<div class="reply">
<a aria-label="Reply to Hee Un" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411514#respond" onclick='return addComment.moveForm( "comment-411514", "411514", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411612">
<div class="comment-container" id="li-comment-411612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 29, 2017 at 5:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<p>Sorry, I’m not sure I understand the question, perhaps you could rephrase it?</p>
<p>I can say that I would expect better skill if the data was further prepared – e.g. made stationary.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411612#respond" onclick='return addComment.moveForm( "comment-411612", "411612", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411783">
<div class="comment-container" id="li-comment-411783">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9feaca69d922a7e54eea179ea5a2f861?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9feaca69d922a7e54eea179ea5a2f861?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vipul</span>
<span class="date">August 30, 2017 at 7:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411783" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for wonderful explanation!<br/>
Could you please help me to understand dimensionality reduction concept. Should PCA or statistical approach be used before feeding the data to LSTM OR LSTM will learn correlation with the inputs provided on its own? how to approach regression problem in LSTM when we have large set of features?</p>
<p>Your reply is greatly appreciated!</p>
<div class="reply">
<a aria-label="Reply to Vipul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411783#respond" onclick='return addComment.moveForm( "comment-411783", "411783", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411845">
<div class="comment-container" id="li-comment-411845">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411845" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, if you make the problem simpler using data preparation, the LSTM or any model will perform better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411845#respond" onclick='return addComment.moveForm( "comment-411845", "411845", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-411821">
<div class="comment-container" id="li-comment-411821">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">August 31, 2017 at 2:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411821" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How can I predict a single input ?<br/>
for example :</p>
<p>[0.036, 0.338, 0.197, 0.836, 0.333, 0.128, 0.00000001, 0.0000001]</p>
<p>how do i reshape and do a  model.predict () ?</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411821#respond" onclick='return addComment.moveForm( "comment-411821", "411821", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411853">
<div class="comment-container" id="li-comment-411853">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411853" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will make it clearer:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411853#respond" onclick='return addComment.moveForm( "comment-411853", "411853", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-411879">
<div class="comment-container" id="li-comment-411879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d902111389ae6ed31320da7a481d2835?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nader</span>
<span class="date">August 31, 2017 at 12:48 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason.<br/>
I applied: </p>
<p>my_x = np.array([0.036, 0.338, 0.197, 0.836, 0.333, 0.128, 0.00000001, 0.0000001])<br/>
print(my_x.shape) # (8,)<br/>
my_x = my_x.reshape((1, 1, 8))<br/>
my_pred = model.predict(my_x)<br/>
print(my_pred)</p>
<p>The answer is the “scaled” answer which is 0.03436</p>
<p>I tried applying the scaler.inverse_transform(my_pred)  to GET the actual number</p>
<p>But I get the following error: </p>
<p>on-broadcastable output operand with shape (1,1) doesn’t match the broadcast shape (1,8)</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Nader" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411879#respond" onclick='return addComment.moveForm( "comment-411879", "411879", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-411986">
<div class="comment-container" id="li-comment-411986">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 1, 2017 at 6:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411986" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the transform requires data in the same form as when you “fit” it.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411986#respond" onclick='return addComment.moveForm( "comment-411986", "411986", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-414636">
<div class="comment-container" id="li-comment-414636">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6708431315d594fd2bfecfaf67d04e7f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6708431315d594fd2bfecfaf67d04e7f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David</span>
<span class="date">September 23, 2017 at 3:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414636" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Then what if I use multi-time step prediction? (use several lags for prediction)<br/>
The y_hat and X_test can not have the same dimension.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-414682">
<div class="comment-container" id="li-comment-414682">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 24, 2017 at 5:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414682" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If the size of X or y must vary, you can use padding.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-411828">
<div class="comment-container" id="li-comment-411828">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e09b295734f8fcc9e6b5a38b00cc474f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e09b295734f8fcc9e6b5a38b00cc474f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fejwin</span>
<span class="date">August 31, 2017 at 3:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411828" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thanks for the tutorial!<br/>
Maybe I missed something, but it seems that you provided the model with all of remaining data as ‘testdata’ and then tried predicting it? Isn’t that kind of pointless, since we should be interested in predicting unknown data in the future, instead of data that the model has already seen? Wouldn’t it make more sense to try the model to predict a first timestep into the future that neither the training nor the test data knew anything about? (Perhaps only give the model training data, but no test data, and afterwards ask it to predict first time step after training data?) How would I have to change the code to achieve that?</p>
<div class="reply">
<a aria-label="Reply to Fejwin" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411828#respond" onclick='return addComment.moveForm( "comment-411828", "411828", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-411856">
<div class="comment-container" id="li-comment-411856">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">August 31, 2017 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-411856" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The model is fit on the training data, then makes a prediction for each step in the test data. The model did not “know” the answer to the test data prior to making each prediction.</p>
<p>Normally we would use walk-forward validation:<br/>
<a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/</a></p>
<p>I did use walk forward validation on other LSTM examples (use the blog search) but it confuses readers more than helps it seems.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=411856#respond" onclick='return addComment.moveForm( "comment-411856", "411856", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-419420">
<div class="comment-container" id="li-comment-419420">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/04d2bb3133980fb172ae2abf47dad041?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/04d2bb3133980fb172ae2abf47dad041?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Guillermo</span>
<span class="date">November 8, 2017 at 9:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419420" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.</p>
<p>I am digging into your example and maybe missing something because I agree with Fejwin.</p>
<p>I mean, as long as real Pollution in t-1 is introduced in the test_X set, instead of predicted Pollution in t-1, when you run model.predict(test_X) each output is not considered for future prediction.</p>
<p>This is with all the features, including real Pollution(t-1) the model predicts an output: predicted Pollution(t).  But on the next step, when the model predicts Pollution(t+1) it doesn´t take predicted Pollution(t), it takes real Pollution(t) instead.</p>
<p>Can you clarify this point please?</p>
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Guillermo" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419420#respond" onclick='return addComment.moveForm( "comment-419420", "419420", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-419488">
<div class="comment-container" id="li-comment-419488">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 9, 2017 at 9:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419488" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, the assumption in the setup of the problem is that each prior hours pollution is available when predicting t+1.</p>
<p>You could change the framing of the problem if you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419488#respond" onclick='return addComment.moveForm( "comment-419488", "419488", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-2" id="comment-414709">
<div class="comment-container" id="li-comment-414709">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6708431315d594fd2bfecfaf67d04e7f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6708431315d594fd2bfecfaf67d04e7f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">David</span>
<span class="date">September 24, 2017 at 1:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414709" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can I use part of trainX to predict testY ? (lags needed to predict testY is in trainX) Not sure if it is a logical way to do it.</p>
<div class="reply">
<a aria-label="Reply to David" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414709#respond" onclick='return addComment.moveForm( "comment-414709", "414709", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-414748">
<div class="comment-container" id="li-comment-414748">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 25, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414748" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414748#respond" onclick='return addComment.moveForm( "comment-414748", "414748", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412028">
<div class="comment-container" id="li-comment-412028">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/127cf1579a8d974dbeb196ac391018c4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/127cf1579a8d974dbeb196ac391018c4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">hadi</span>
<span class="date">September 1, 2017 at 12:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412028" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason Brownlee,</p>
<p>I have a little different question, Actually I have a sequence of characters as input and I want to project it into a multidimensional space.<br/>
I mean I want to project each sequence of chars (let say word) to an vector of 100 real numbers along my corpus, so my input is a sequence of chars (any char-emedding is welcome) and my output is a vector for each sequence (which is a word ) and Im really confused how to define the model,<br/>
I would appreciate if you give any clue help or sample code to define my model.</p>
<p>Thanks a lot in advance.</p>
<div class="reply">
<a aria-label="Reply to hadi" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412028#respond" onclick='return addComment.moveForm( "comment-412028", "412028", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412045">
<div class="comment-container" id="li-comment-412045">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 1, 2017 at 3:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412045" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Keras provides an Embedding layer that you can use directly:<br/>
<a href="https://keras.io/layers/embeddings/" rel="nofollow">https://keras.io/layers/embeddings/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412045#respond" onclick='return addComment.moveForm( "comment-412045", "412045", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-412087">
<div class="comment-container" id="li-comment-412087">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bcd96901407c33887c0f2bb82bc4a96e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bcd96901407c33887c0f2bb82bc4a96e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sai k</span>
<span class="date">September 2, 2017 at 12:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412087" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thanks for the wonderful tutorial!<br/>
Could you please explain how to deal the problem when situation is “Predict the pollution for the complete month (assume month has 30 days. t+1…t+30) and given the “expected” weather features for that month…assuming we have been provided historic data of pollution and weather data on daily basis”</p>
<p>How should the data be prepared and how it should be feed into LSTM?</p>
<p>As I new to LSTM model, I have problem understanding the data preparation and feeding to LSTM.</p>
<p>Thanks in advance for your response</p>
<div class="reply">
<a aria-label="Reply to Sai k" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412087#respond" onclick='return addComment.moveForm( "comment-412087", "412087", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412120">
<div class="comment-container" id="li-comment-412120">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 2, 2017 at 6:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412120" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Predicting for a month is called multi-step forecasting.</p>
<p>Here is a post on the general approach:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>Here is an example of doing multi-step forecasting with an LSTM:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412120#respond" onclick='return addComment.moveForm( "comment-412120", "412120", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-412619">
<div class="comment-container" id="li-comment-412619">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3795e33ff2464384809c70d4ea93c61c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3795e33ff2464384809c70d4ea93c61c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adrian</span>
<span class="date">September 5, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412619" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for sharing. I added accuracy info to model while training using ‘ metrics=[‘accuracy’] ‘.</p>
<p>So model.compile(loss=’mae’, optimizer=’adam’) becomes : </p>
<p>model.compile(loss=’mae’, optimizer=’adam’, metrics=[‘accuracy’])</p>
<p>This adds acc &amp; val_acc to output. After 100 epochs the acc value appears quite low : (0.0761) :<br/>
Epoch 100/100<br/>
1s – loss: 0.0143 – acc: 0.0761 – val_loss: 0.0132 – val_acc: 0.0393</p>
<p>The accuracy of the model appears very low ? Is this expected ?</p>
<p>Further info on acc &amp; val_acc values : <a href="https://github.com/tflearn/tflearn/issues/357" rel="nofollow">https://github.com/tflearn/tflearn/issues/357</a> “acc is the accuracy of a batch of training data and val_acc is the accuracy of a batch of testing data.”</p>
<div class="reply">
<a aria-label="Reply to Adrian" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412619#respond" onclick='return addComment.moveForm( "comment-412619", "412619", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412943">
<div class="comment-container" id="li-comment-412943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is a regression problem. Accuracy does not make sense.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412943#respond" onclick='return addComment.moveForm( "comment-412943", "412943", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-412632">
<div class="comment-container" id="li-comment-412632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b5b675dd30589029154fd70d2695559f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b5b675dd30589029154fd70d2695559f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.hiller.pro" rel="external nofollow">Eric H</a></span>
<span class="date">September 5, 2017 at 6:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I’ve recently discovered your site and have been so pleased with your information – thank you. I’ve been trying to model data which is much like the air quality data described here, but every few time steps there will be a change in the number of features present.<br/>
Example: in my data a time step = 1 day and a sequence can be 800 – 1200 days long. Normally the data consists of features<br/>
– pm2.5: PM2.5 concentration<br/>
– DEWP: Dew Point<br/>
– TEMP: Temperature<br/>
– PRES: Pressure<br/>
– cbwd: Combined wind direction<br/>
– Iws: Cumulated wind speed<br/>
– Is: Cumulated hours of snow<br/>
– Ir: Cumulated hours of rain</p>
<p>But then every (random-ish amount of time) there will be an additional number of features for a day and then back to the baseline number of features. </p>
<p>I’ve no idea on how to handle variable feature length. I’ve seen and played with plenty of variable sequence length examples, but I have both variable sequenceS and features. I’d love your input!<br/>
Thanks!<br/>
-Eric</p>
<div class="reply">
<a aria-label="Reply to Eric H" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412632#respond" onclick='return addComment.moveForm( "comment-412632", "412632", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-412945">
<div class="comment-container" id="li-comment-412945">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 7, 2017 at 12:40 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-412945" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to normalize the number of features to be consistent for all time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=412945#respond" onclick='return addComment.moveForm( "comment-412945", "412945", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-413305">
<div class="comment-container" id="li-comment-413305">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0560d6c56f22b7fdb70baa59155c6206?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0560d6c56f22b7fdb70baa59155c6206?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://www.hiller.pro" rel="external nofollow">Eric Hiller</a></span>
<span class="date">September 10, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413305" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is it possible to use (what in TensorFlow – land is called) SparseFeatures or SparseTensors to represent sparse datasets, or is there a fundamental issue with handling sparse datasets within RNNs?</p>
<div class="reply">
<a aria-label="Reply to Eric Hiller" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413305#respond" onclick='return addComment.moveForm( "comment-413305", "413305", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-413426">
<div class="comment-container" id="li-comment-413426">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 11, 2017 at 12:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413426" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, I’m not sure off the cuff. Keras may support sparse numpy arrays – try it and see?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413426#respond" onclick='return addComment.moveForm( "comment-413426", "413426", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413037">
<div class="comment-container" id="li-comment-413037">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ffd32cab7c13fd706aef8e486c6cd864?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ffd32cab7c13fd706aef8e486c6cd864?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali Haidar</span>
<span class="date">September 8, 2017 at 1:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413037" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thanks for the amazing articles. They are really helpful. </p>
<p>Lets say I want to forecast with lead 2. I mean by that forecasting values at time t using t-2 values, without using t-1 elements. I have to remove columns from reframed  after running function series_to_supervised right ? To remove all columns with values t-1?<br/>
reframed.drop(reframed.columns[…])</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Ali Haidar" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413037#respond" onclick='return addComment.moveForm( "comment-413037", "413037", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413208">
<div class="comment-container" id="li-comment-413208">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 9, 2017 at 11:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413208" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yep, looks good.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413208#respond" onclick='return addComment.moveForm( "comment-413208", "413208", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413472">
<div class="comment-container" id="li-comment-413472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/940af00480e39fd02024ee712636cf05?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/940af00480e39fd02024ee712636cf05?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Inna</span>
<span class="date">September 11, 2017 at 7:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello!<br/>
Thanks for articles.</p>
<p>I have a question related with time series. Is it possible to forecast all variables? For example, I have ‘pollution’, ‘dew’, ‘temp’, ‘press’, ‘wnd_dir’, ‘wnd_spd’, ‘snow’, ‘rain’ and want to predict all of them for the next hour. We know about trends and common rules (because of data amount: few years), so we can do forecasting. Where can I find more info about it?</p>
<div class="reply">
<a aria-label="Reply to Inna" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413472#respond" onclick='return addComment.moveForm( "comment-413472", "413472", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413632">
<div class="comment-container" id="li-comment-413632">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413632" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, this example can be modified to predict each variable.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413632#respond" onclick='return addComment.moveForm( "comment-413632", "413632", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413539">
<div class="comment-container" id="li-comment-413539">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/75f29114f59792781c134003b0e15cf5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/75f29114f59792781c134003b0e15cf5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">appreciator</span>
<span class="date">September 12, 2017 at 10:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413539" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason for the great tutorial! I’m adapting it for different data, and i’m trying to use &gt;1 time step. However I noticed something strange in the series-to-supervised: Since the first loops ends at 0 and the last loops starts at 0, won’t there be two columns that are the same?</p>
<div class="reply">
<a aria-label="Reply to appreciator" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413539#respond" onclick='return addComment.moveForm( "comment-413539", "413539", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413641">
<div class="comment-container" id="li-comment-413641">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413641" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No, try it with the data and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413641#respond" onclick='return addComment.moveForm( "comment-413641", "413641", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413541">
<div class="comment-container" id="li-comment-413541">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 12, 2017 at 11:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413541" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for the tutorial. I had just one question though.<br/>
I’ve seen tutorial using multivariate time series to train a lot of dataset (all have correlation between each other) at the same time and were able to predict for each dataset used.</p>
<p>For sake of argument let’s say than one of the dataset is broke, the sensor that get the information to feed it is out of service (let’s say at some point one of the column of data only have 0 instead of whatever value). Do you think that we could use the other spot to continue to predict the broken one? (there is correlation between them and there would be a lot of non broken data from before the bug)</p>
<p>Best regards,</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413541#respond" onclick='return addComment.moveForm( "comment-413541", "413541", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413642">
<div class="comment-container" id="li-comment-413642">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413642" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, you could try it and see. Or impute the missing data and see if that is better.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413642#respond" onclick='return addComment.moveForm( "comment-413642", "413642", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-413778">
<div class="comment-container" id="li-comment-413778">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2652cc5d8b7c695c33eec56a8206774b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Eric</span>
<span class="date">September 14, 2017 at 2:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413778" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you Jason,</p>
<p>I shall try that as soon as possible.I guess that the overall accuracy will lower for every set prediction (since my goal is to use multivariate, feed it every spot data set and predict each of them (with possibility to predict a broken one)) so one spot being fed “wrong” data should lower each spot accuracy no?</p>
<p>Best regards,</p>
<div class="reply">
<a aria-label="Reply to Eric" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413778#respond" onclick='return addComment.moveForm( "comment-413778", "413778", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-413892">
<div class="comment-container" id="li-comment-413892">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413892" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It will.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413892#respond" onclick='return addComment.moveForm( "comment-413892", "413892", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413612">
<div class="comment-container" id="li-comment-413612">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://pk.linkedin.com/in/shanzehra66" rel="external nofollow">Shan</a></span>
<span class="date">September 13, 2017 at 3:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413612" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Is there any time parser like date parser? I am working with data which is in milliseconds.</p>
<div class="reply">
<a aria-label="Reply to Shan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413612#respond" onclick='return addComment.moveForm( "comment-413612", "413612", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413653">
<div class="comment-container" id="li-comment-413653">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 13, 2017 at 12:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413653" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It can handle parsing dates and times I believe.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413653#respond" onclick='return addComment.moveForm( "comment-413653", "413653", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413697">
<div class="comment-container" id="li-comment-413697">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7b1550e35b177010ba173392794a1c30?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b1550e35b177010ba173392794a1c30?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">kumar</span>
<span class="date">September 13, 2017 at 10:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413697" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i got this error when i tried to run the program</p>
<p>pyplot.plot(history.history[‘val_loss’], label=’test’)<br/>
KeyError: ‘val_loss’</p>
<div class="reply">
<a aria-label="Reply to kumar" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413697#respond" onclick='return addComment.moveForm( "comment-413697", "413697", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413880">
<div class="comment-container" id="li-comment-413880">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 15, 2017 at 12:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413880" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ensure you copy all of the code.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413880#respond" onclick='return addComment.moveForm( "comment-413880", "413880", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413943">
<div class="comment-container" id="li-comment-413943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f27b9e48ab4d5da5ea8c5e078aa164f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f27b9e48ab4d5da5ea8c5e078aa164f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Simon</span>
<span class="date">September 15, 2017 at 9:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Wouldn’t it be better to scale the data after you run the series_to_supervised function? As it stands now, the inverse scaling doesn’t work if n_in &gt; 1 since the dimensions don’t line up anymore.</p>
<div class="reply">
<a aria-label="Reply to Simon" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413943#respond" onclick='return addComment.moveForm( "comment-413943", "413943", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-413993">
<div class="comment-container" id="li-comment-413993">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 16, 2017 at 8:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413993" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It would, but the scaling would be column-wise and incorrect.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413993#respond" onclick='return addComment.moveForm( "comment-413993", "413993", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-414096">
<div class="comment-container" id="li-comment-414096">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f27b9e48ab4d5da5ea8c5e078aa164f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f27b9e48ab4d5da5ea8c5e078aa164f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Simon</span>
<span class="date">September 17, 2017 at 11:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414096" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Could you expand more on this and how the code might be modified to incorporate multi-step? I’m also playing around with turning this into a classification problem, would it still work if the feature we are trying to predict is a classifier?</p>
<div class="reply">
<a aria-label="Reply to Simon" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414096#respond" onclick='return addComment.moveForm( "comment-414096", "414096", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-414149">
<div class="comment-container" id="li-comment-414149">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 18, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414149" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give the code to do this in another comment.</p>
<p>For classification, you will need to change the number of neurons in the output layer, the activation function in the output layer and the loss function.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414149#respond" onclick='return addComment.moveForm( "comment-414149", "414149", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-413972">
<div class="comment-container" id="li-comment-413972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e6a151e8cc4b7a273ab54f2c365bb1f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e6a151e8cc4b7a273ab54f2c365bb1f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Agrippa Sulla</span>
<span class="date">September 16, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have a little question. I’ve successfully built my own LSTM multivariate NN using your code as a basis (thanks!). It forecasts export growth for the UK using past export growth and GDP. It perform decently but the financial crisis kinda messes things up. </p>
<p>Now I want to add data to this model, but I can’t go further back than 1980 for the time-series (not for now at least). So what I want to do is add the GDP growth rate of all the UK’s major trading partners. Should I be worried about adding another 20 input neurons (e.g. countries)? Do you have a post talking about the risks of using data that is low in rows (e.g. years) but high in columns (e.g. inputs).</p>
<p>I hope my question makes sense.</p>
<p>Cheers</p>
<div class="reply">
<a aria-label="Reply to Agrippa Sulla" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413972#respond" onclick='return addComment.moveForm( "comment-413972", "413972", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414001">
<div class="comment-container" id="li-comment-414001">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 16, 2017 at 8:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414001" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t have posts on the topic of more columns than rows. It does require careful handling.</p>
<p>As a start, I would recommend developing a strong test harness, then try adding data and see how it impacts the model skill. Experiment.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414001#respond" onclick='return addComment.moveForm( "comment-414001", "414001", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413974">
<div class="comment-container" id="li-comment-413974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">September 16, 2017 at 6:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-413974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason<br/>
Thanks a lot for your tutorial!<br/>
Is there a feature importance plot for cases like this?<br/>
sometimes is very important to know it</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=413974#respond" onclick='return addComment.moveForm( "comment-413974", "413974", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414002">
<div class="comment-container" id="li-comment-414002">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 16, 2017 at 8:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414002" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question. I’m not sure about feature importance plots for LSTMs. I would expect that if feature importance can be calculated for MLPs, then it could be calculated for LSTMs, but this is not something I have looked into sorry.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414002#respond" onclick='return addComment.moveForm( "comment-414002", "414002", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-414057">
<div class="comment-container" id="li-comment-414057">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/875163e086ed54c30ce973cde9e5fbfe?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ed</span>
<span class="date">September 17, 2017 at 2:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414057" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks a lot, Jason!</p>
<div class="reply">
<a aria-label="Reply to Ed" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414057#respond" onclick='return addComment.moveForm( "comment-414057", "414057", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-414074">
<div class="comment-container" id="li-comment-414074">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 17, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414074" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414074#respond" onclick='return addComment.moveForm( "comment-414074", "414074", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414298">
<div class="comment-container" id="li-comment-414298">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1293f7a013a2b84eca196f7030d734e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1293f7a013a2b84eca196f7030d734e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kuldeep</span>
<span class="date">September 20, 2017 at 12:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414298" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Great post as always!</p>
<p>I have a question regarding scaling. My problem is quite different as I have to apply series to supervised function first on the data coming from different source and then combine the data… my question is, can I apply scaling at the end? Should scaling be applied column wise or on complete matrix/array?</p>
<div class="reply">
<a aria-label="Reply to Kuldeep" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414298#respond" onclick='return addComment.moveForm( "comment-414298", "414298", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414327">
<div class="comment-container" id="li-comment-414327">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 20, 2017 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414327" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The key is being able to scale the data consistently. The place in the pipeline is less important.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414327#respond" onclick='return addComment.moveForm( "comment-414327", "414327", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-414387">
<div class="comment-container" id="li-comment-414387">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/59604064be8b82a41693c4249bbe84f6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/59604064be8b82a41693c4249bbe84f6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nejra</span>
<span class="date">September 21, 2017 at 1:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414387" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason thank you very much for your tutorials!<br/>
I’m trying to develop an LSTM for time prediction having as input 3 features (2 measurements and a third one is a sort of control of the system) and the output (value to predict) is not a single value but a vector of 6 values. So, at every time step my network should be able to predict this entire vector. Two questions:<br/>
1. Since my inputs are not correlated between them, their order in the input array will not influence my predictions?<br/>
2. How can I shape my output in order to estimate all the 6 values of the vector for each time step?<br/>
Thanks for any kind of help!</p>
<div class="reply">
<a aria-label="Reply to Nejra" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414387#respond" onclick='return addComment.moveForm( "comment-414387", "414387", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-414414">
<div class="comment-container" id="li-comment-414414">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 21, 2017 at 5:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414414" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you understand how to prepare data for multi-step forecasting:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414414#respond" onclick='return addComment.moveForm( "comment-414414", "414414", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-414484">
<div class="comment-container" id="li-comment-414484">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mitchel Myers</span>
<span class="date">September 22, 2017 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414484" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I replicated the example described on this page, and saved my test_y and yhat vectors to csv so that I could manually check how my prediction compared with the true values. However, when I did this, I discovered that every yhat value in my array is the exact same value (~34). I was expecting a unique yhat value for each input vector. Do you have any suggestions to help fix this?</p>
<div class="reply">
<a aria-label="Reply to Mitchel Myers" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414484#respond" onclick='return addComment.moveForm( "comment-414484", "414484", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414584">
<div class="comment-container" id="li-comment-414584">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mitchel Myers</span>
<span class="date">September 23, 2017 at 3:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414584" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Follow up on this — when this error arose, I was using my own data set that I want to perform time series forecasting on. When I duplicated the guide exactly as described above, the issue goes away. Do you have any idea why this issue comes up (where every predicted yhat value is the exact same) when I use a different data set?</p>
<div class="reply">
<a aria-label="Reply to Mitchel Myers" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414584#respond" onclick='return addComment.moveForm( "comment-414584", "414584", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414609">
<div class="comment-container" id="li-comment-414609">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 23, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414609" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps the model needs to be tuned to your specific dataset?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414609#respond" onclick='return addComment.moveForm( "comment-414609", "414609", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414777">
<div class="comment-container" id="li-comment-414777">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f20603c6433d511e2596e9077c08acee?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f20603c6433d511e2596e9077c08acee?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">zwj</span>
<span class="date">September 25, 2017 at 1:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414777" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason thank you very much for your tutorials!  I try to delete the columns [‘dew’, ‘temp’, ‘press’, ‘wnd_dir’, ‘wnd_spd’, ‘snow’, ‘rain’] from the train_X data, and I also get the almost same test RMSE. It is 26.461. It seems to show that the 8 weather conditions have no affect on the prediction result. The code is below.</p>
<p># fit an LSTM network to training data<br/>
def fit_lstm(train, test, batch_size, neurons):<br/>
	# split into input and outputs<br/>
	train_X, train_y = train[:, 0:1], train[:, -1]<br/>
	test_X, test_y   = test [:, 0:1], test [:, -1]</p>
<p>	train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))<br/>
	test_X  = test_X.reshape((test_X.shape[0],   1, test_X.shape[1]))<br/>
	print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)</p>
<p>	# design network<br/>
	model = Sequential()<br/>
	model.add(LSTM(neurons, input_shape=(train_X.shape[1], train_X.shape[2])))<br/>
	model.add(Dense(1))<br/>
	model.compile(loss=’mae’, optimizer=’adam’)</p>
<p>	# fit network<br/>
	history = model.fit(train_X, train_y, epochs=50, batch_size=batch_size, validation_data=(test_X, test_y), verbose=2, shuffle=False)<br/>
	#history = model.fit(train_X, train_y, epochs=50, batch_size=72,  verbose=2, shuffle=False)</p>
<p>	return model</p>
<p># make a prediction<br/>
def make_forecasts(model, test_X):<br/>
	test_X = test_X[:, 0:1]<br/>
	test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))<br/>
	forecasts   = model.predict(test_X)</p>
<p>	return forecasts</p>
<div class="reply">
<a aria-label="Reply to zwj" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414777#respond" onclick='return addComment.moveForm( "comment-414777", "414777", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414781">
<div class="comment-container" id="li-comment-414781">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 25, 2017 at 3:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414781" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice one!</p>
<p>The real motivation for me writing this post was to help the 100s of people asking how to develop a multivariate LSTM. </p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414781#respond" onclick='return addComment.moveForm( "comment-414781", "414781", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-419849">
<div class="comment-container" id="li-comment-419849">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d713d62e11b0bb299172446029774587?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d713d62e11b0bb299172446029774587?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 13, 2017 at 4:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419849" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is more substantial than I think is being acknowledged. What is the point of creating a multivariate lstm if all of the other variables don’t have an impact on the outcome? Has this been attempted with other data sets?</p>
<div class="reply">
<a aria-label="Reply to Tommy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419849#respond" onclick='return addComment.moveForm( "comment-419849", "419849", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-419879">
<div class="comment-container" id="li-comment-419879">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 13, 2017 at 10:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419879" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is an example for those who want to explore the approach.</p>
<p>I don’t have more examples because it turns out the method is outperformed by MLPs for autoregression problems. At least in my experience.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419879#respond" onclick='return addComment.moveForm( "comment-419879", "419879", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-414875">
<div class="comment-container" id="li-comment-414875">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9925e36e69c54e780388dcb6920538f5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mitchel</span>
<span class="date">September 27, 2017 at 1:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414875" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can you explain why the train_X and test_X data sets are reshaped to this? </p>
<p>train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))<br/>
test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))</p>
<div class="reply">
<a aria-label="Reply to Mitchel" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414875#respond" onclick='return addComment.moveForm( "comment-414875", "414875", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-414899">
<div class="comment-container" id="li-comment-414899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 27, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The shape is: samples, time steps, features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414899#respond" onclick='return addComment.moveForm( "comment-414899", "414899", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-414989">
<div class="comment-container" id="li-comment-414989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e29b1c2bd454a5e2df26fe21de087201?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e29b1c2bd454a5e2df26fe21de087201?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lino</span>
<span class="date">September 28, 2017 at 12:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-414989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason</p>
<p>Great post.<br/>
Suppose i want to predict the next 24h using previous one year dataset. How can we do it?<br/>
Thanks</p>
<div class="reply">
<a aria-label="Reply to Lino" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=414989#respond" onclick='return addComment.moveForm( "comment-414989", "414989", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415003">
<div class="comment-container" id="li-comment-415003">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 28, 2017 at 4:45 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415003" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I give an example in another comment.</p>
<p>Also, generally, see this post on multi-step forecasting with LSTMs:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415003#respond" onclick='return addComment.moveForm( "comment-415003", "415003", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415052">
<div class="comment-container" id="li-comment-415052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c2bd8400b88bcf8af2c920474375a392?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c2bd8400b88bcf8af2c920474375a392?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nels</span>
<span class="date">September 29, 2017 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think I’m missing something fundamental in my understanding of LSTM/s and BPTT.  I’ve read through many of your posts and have come to understand RNN’s and LSTM in particular much better because of them, so thank you for that!</p>
<p>My question that I hope you can shed some light on is what is the difference between passing the past information, i.e. var(t-n)…var(t-1) in the input vector for a single sample, and passing multiple sequences, of length n as a single sample?</p>
<p>To help clarify,  using temsteps of length N, I have a configuration that looks like this:</p>
<p>Input to LSTM is [samples, timesteps, features].<br/>
Each sample/observation consists of a vector of timestamps (of size N+1) where each of these vector’s values corresponds to the input feature’s values I.e.</p>
<p>            Observations for each time t, with features f and r<br/>
            [<br/>
                time t<br/>
                [<br/>
                    [  f(t-N)            r(t-N)          ]<br/>
                    [  f(t-N+1)          r(t-N+1)        ]<br/>
                    [  f(t-N+2)          r(t-N+2)        ]<br/>
                        .                   .<br/>
                        .                   .<br/>
                        .                   .<br/>
                    [  f(t)              r(t)            ]<br/>
                ]<br/>
            ]<br/>
And for each observation/sequence the target is Y(t).</p>
<p>Or, as many of your examples do, you can include the the past information in the form of a windowed input, with a single time step, so something like:</p>
<p>Input is [samples, 1, features].  So for every observation, we include previous time values as features</p>
<p> Observations for each time t, with features f and r<br/>
            [<br/>
                time t<br/>
                [<br/>
                    [  f(t-N), r(t-N), f(t-N+1), r(t-N+1), f(t-N+2), r(t-N+2), f(t), r(t) ]<br/>
                ]<br/>
            ]<br/>
And again, for each observation, the target is Y(t).</p>
<p>I understand that having sequences longer than 1 allows BPTT to work over the length of those sequences, but I don’t think I really understand the difference in these two methods.</p>
<p>I have tried the described two options, and I find the the latter is performing better based on preliminary tests.  I can use a window size of 3 and a sequence length of 1 and get good results, but if I use the first approach and a window size of 12, the model actually fails to learn within the same amount of time.  </p>
<p>Hence, I wonder if I don’t have a fundamental misconception.  If you have some time, I would like to hear your explanation on this difference and how the LSTM responds in terms of “memory” based on these two different types of input setup. (I have read a lot of articles, blogs, git hub issues, and stack overflow posts trying to wrap my head around this, but I haven’t found anything that address this directly.)</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Nels" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415052#respond" onclick='return addComment.moveForm( "comment-415052", "415052", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415147">
<div class="comment-container" id="li-comment-415147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, the multiple steps for one sequence are required for BPTT:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<p>Without the history, the training will not have sufficient context to estimate the error gradient and your model will learn a function mapping rather than a sequence prediction problem.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415147#respond" onclick='return addComment.moveForm( "comment-415147", "415147", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415074">
<div class="comment-container" id="li-comment-415074">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f30fc38f9fa6638a5a12865fa22b9d85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f30fc38f9fa6638a5a12865fa22b9d85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">September 29, 2017 at 12:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415074" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>With this line…</p>
<p># drop columns we don’t want to predict<br/>
reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)</p>
<p>I don’t understand the numbers used here, doesn’t the data not even have that many columns? There are 8 feature columns and 1 index column.</p>
<p>I’m adapting this code for my own use and have very different features but I’m not sure I’m getting that line adapted right.</p>
<p>Thanks for the great post!</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415074#respond" onclick='return addComment.moveForm( "comment-415074", "415074", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-415077">
<div class="comment-container" id="li-comment-415077">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f30fc38f9fa6638a5a12865fa22b9d85?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f30fc38f9fa6638a5a12865fa22b9d85?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">September 29, 2017 at 1:29 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415077" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nevermind! I figured it out.</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415077#respond" onclick='return addComment.moveForm( "comment-415077", "415077", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-415153">
<div class="comment-container" id="li-comment-415153">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415153" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Glad to hear it Paul.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415153#respond" onclick='return addComment.moveForm( "comment-415153", "415153", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415151">
<div class="comment-container" id="li-comment-415151">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">September 30, 2017 at 7:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415151" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It does have that many columns after we reshape it to be a supervised learning problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415151#respond" onclick='return addComment.moveForm( "comment-415151", "415151", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415194">
<div class="comment-container" id="li-comment-415194">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/60621ea4285d8f8b2de21f0c44dfe602?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/60621ea4285d8f8b2de21f0c44dfe602?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Wenhan Wang</span>
<span class="date">September 30, 2017 at 2:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415194" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is awesome!<br/>
Helping me a lot in my real work!</p>
<div class="reply">
<a aria-label="Reply to Wenhan Wang" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415194#respond" onclick='return addComment.moveForm( "comment-415194", "415194", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415251">
<div class="comment-container" id="li-comment-415251">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 1, 2017 at 9:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415251" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks, I’m glad to hear that.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415251#respond" onclick='return addComment.moveForm( "comment-415251", "415251", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415585">
<div class="comment-container" id="li-comment-415585">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c17646630cda46b35e860e874fe1663f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c17646630cda46b35e860e874fe1663f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vilmara Sanchez</span>
<span class="date">October 4, 2017 at 3:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415585" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr. Jason, I am working on a project for sleep stage classification where the number of timesteps (observations) in the input series (ECG signal) is different than the number of timesteps in the output series (sleep stage scores).</p>
<p>The issue here is that the input and output time series are not equal in terms of timesteps as the examples you have shown in your problems.</p>
<p>I have tried to frame the problem in different ways without getting results that make sense. Could you please provide guidance on how to approach this problem?. </p>
<p>Thanks,</p>
<p>Vilmara</p>
<div class="reply">
<a aria-label="Reply to Vilmara Sanchez" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415585#respond" onclick='return addComment.moveForm( "comment-415585", "415585", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415650">
<div class="comment-container" id="li-comment-415650">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 5, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415650" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, I would recommend an encoder-decoder model:<br/>
<a href="https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/encoder-decoder-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415650#respond" onclick='return addComment.moveForm( "comment-415650", "415650", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-415844">
<div class="comment-container" id="li-comment-415844">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d4219d9a8164c0ed0477d3a23672fb16?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Devakar Verma</span>
<span class="date">October 6, 2017 at 6:06 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415844" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
If we want to predict multiple features as output and having multiple feature as input. How can we solve this problem. For example input variables are temperature and humidity and want to predict both temperature and humidity, can we solve this with single LSTM model.</p>
<p>Thanks for your anticipated response.</p>
<div class="reply">
<a aria-label="Reply to Devakar Verma" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415844#respond" onclick='return addComment.moveForm( "comment-415844", "415844", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415886">
<div class="comment-container" id="li-comment-415886">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 7, 2017 at 5:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415886" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes you can. Change the multivariate input model to output more than one value in the output layer.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415886#respond" onclick='return addComment.moveForm( "comment-415886", "415886", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-415894">
<div class="comment-container" id="li-comment-415894">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/bcd3b622e0760a0bf9412b973bc05955?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bcd3b622e0760a0bf9412b973bc05955?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Brent</span>
<span class="date">October 7, 2017 at 5:55 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415894" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>Thank you for taking the time to write such an excellent post and follow up with questions. The mechanics of the data conversion &amp; training work great.</p>
<p>However, my first reaction is that the LSTM doesn’t seem to have learned anything more than to copy the previous value. As BECKER states:</p>
<p>&gt;  it looks like the predicted value is always 1 time period after the actual?</p>
<p>These are the same results as in your Shampoo example: the predicted value appears to be equal to the previous value (possibly with some constant offset).</p>
<p>Have you found a different network architecture that performs better than a DNN without LSTM layers?</p>
<div class="reply">
<a aria-label="Reply to Brent" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415894#respond" onclick='return addComment.moveForm( "comment-415894", "415894", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-415898">
<div class="comment-container" id="li-comment-415898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 7, 2017 at 5:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-415898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Agreed, LSTMs do not seem to be very good for autoregression. I would generally recommend using an MLP with a window for time series forecasting instead.</p>
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=415898#respond" onclick='return addComment.moveForm( "comment-415898", "415898", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-416082">
<div class="comment-container" id="li-comment-416082">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/9a86dbf59fb76e77c25bf2c5f727bf1b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9a86dbf59fb76e77c25bf2c5f727bf1b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sathvik</span>
<span class="date">October 9, 2017 at 1:34 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416082" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you so much Jason for the wonderful article, learnt a lot… I wanted to have a comparison shown on multivariate statistical methods and neural networks and I was looking for some post/article on multivariate time series model using ARIMA. I would be glad to know if anything you know of the same. </p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to sathvik" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416082#respond" onclick='return addComment.moveForm( "comment-416082", "416082", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-416097">
<div class="comment-container" id="li-comment-416097">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 9, 2017 at 4:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416097" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You will need to look into using SARIMAX, sorry I do not have an example at this stage.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416097#respond" onclick='return addComment.moveForm( "comment-416097", "416097", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-416374">
<div class="comment-container" id="li-comment-416374">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb4ff520de26ec298c8962811ea5d5e4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shan</span>
<span class="date">October 12, 2017 at 4:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416374" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, is there any library available to perform feature extraction/  dimensionlity reduction for sequential LSTM model?</p>
<div class="reply">
<a aria-label="Reply to Shan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416374#respond" onclick='return addComment.moveForm( "comment-416374", "416374", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-416391">
<div class="comment-container" id="li-comment-416391">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 12, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416391" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Often an embedding layer is used to project observations at each time step prior to feeding them into the LSTM.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416391#respond" onclick='return addComment.moveForm( "comment-416391", "416391", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-416424">
<div class="comment-container" id="li-comment-416424">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3df940b021e9a3a144157d4f535a2e71?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3df940b021e9a3a144157d4f535a2e71?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Terry</span>
<span class="date">October 12, 2017 at 6:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416424" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>How does multivariate LSTM compare to Multivariate ARIMAX? Are there use cases where one model outperforms the other?</p>
<div class="reply">
<a aria-label="Reply to Terry" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416424#respond" onclick='return addComment.moveForm( "comment-416424", "416424", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-416482">
<div class="comment-container" id="li-comment-416482">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 13, 2017 at 5:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416482" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend using a linear model first and only moving to a neural net if it delivers better results on your specific problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416482#respond" onclick='return addComment.moveForm( "comment-416482", "416482", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-416471">
<div class="comment-container" id="li-comment-416471">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hesam</span>
<span class="date">October 13, 2017 at 4:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416471" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello,</p>
<p>There are some problem of scaling back when we use more than one shift in time, I mean something like this: </p>
<p>reframed = series_to_supervised(scaled, 6, 1)</p>
<p>I can train and test the model, but some errors appears in the scaling back section which I couldn’t fix.</p>
<p>Please have a look. I really appreciate it.</p>
<div class="reply">
<a aria-label="Reply to Hesam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416471#respond" onclick='return addComment.moveForm( "comment-416471", "416471", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416511">
<div class="comment-container" id="li-comment-416511">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/26fe5f76e4e425fd61f5e57fe20ac99f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/26fe5f76e4e425fd61f5e57fe20ac99f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anil Maddala</span>
<span class="date">October 13, 2017 at 9:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416511" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the great series of articles. How should I modify the code from changing the LSTM code from preiction to classification?</p>
<p>One sample input data is 60 time steps over 2 features and I want to classify the 60 step input sequence into 3 classes.  To start with is LSTM the right approach?</p>
<p>Hoping that you wold take any requests, I would definetly love to see an article on Multivariate classification in Keras using LSTM/GRU and it would be really helpful for analyzing sensor data. You could look at the Human Activity Recognition dataset</p>
<div class="reply">
<a aria-label="Reply to Anil Maddala" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416511#respond" onclick='return addComment.moveForm( "comment-416511", "416511", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416530">
<div class="comment-container" id="li-comment-416530">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 13, 2017 at 2:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416530" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Change the loss function and the activation function of the output layer to categorical_crossentropy and softmax respectively.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416530#respond" onclick='return addComment.moveForm( "comment-416530", "416530", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416560">
<div class="comment-container" id="li-comment-416560">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d34f88ace6fa5777154aa3e43c0456c7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d34f88ace6fa5777154aa3e43c0456c7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">heeun</span>
<span class="date">October 13, 2017 at 6:31 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416560" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks yor nice article.</p>
<p>I have a question!</p>
<p>That algorithm is many to one right?</p>
<p>How can I slove many to many?? for example, i want predict pollution and rain</p>
<div class="reply">
<a aria-label="Reply to heeun" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416560#respond" onclick='return addComment.moveForm( "comment-416560", "416560", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416619">
<div class="comment-container" id="li-comment-416619">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 14, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416619" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is many-to-one in terms of features.</p>
<p>You can change it to be many-to-many by outputting multiple features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416619#respond" onclick='return addComment.moveForm( "comment-416619", "416619", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-416646">
<div class="comment-container" id="li-comment-416646">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63263f95035f8c4fb1ec667a96d08822?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63263f95035f8c4fb1ec667a96d08822?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Pau</span>
<span class="date">October 14, 2017 at 1:13 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416646" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>3 Things:<br/>
1) Thanks so much for this. I’ve used this as a basis for some code I’m writing and it gave me a great head start.<br/>
2) One thing that would be great to help with understanding the meanings of variables you’re using is to first put them into variables rather than using the integers. For example, </p>
<p>x_size = 1<br/>
train_X, train_y = train[:, :-x_size], train[:, -x_size:]<br/>
test_X, test_y = test[:, :-x_size], test[:, -x_size:]</p>
<p>This way, as people are reading the code they understand why it’s “-1” in case their adapted usage has different dimensions, they can change one variable and have it used everywhere it’s needed. </p>
<p>3) For instance, I’m trying to make this code output multiple predictions and am having a bit of trouble figuring out all the variables I need to change.</p>
<p>I have 368 columns of data, the first 168 are what will be predicted based on the other 200 points.</p>
<p>    x_size = 200<br/>
    # split into input and outputs<br/>
    train_X, train_y = train[:, :-x_size], train[:, -x_size:]<br/>
    test_X, test_y = test[:, :-x_size], test[:, -x_size:]</p>
<p>    # reshape input to be 3D [samples, timesteps, features]<br/>
    train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))<br/>
    test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))<br/>
    print(train_X.shape, train_y.shape, test_X.shape, test_y.shape)</p>
<p>    # design network<br/>
    model = Sequential()<br/>
    model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))<br/>
    model.add(Dense(1))</p>
<p>I get the error:<br/>
ValueError: Error when checking target: expected dense_1 to have shape (None, 1) but got array with shape (659, 200)</p>
<p>Should the Dense(1) be Dense(x_size) where for me that is 200? (this is why it would be great to use variables so I know what that 1 means). When I try it as 168 (which is what it seems like it should be), I get an error.</p>
<p>When I switch to x_size, it actually runs without errors, but I’m not sure if that means I’m correct or not.</p>
<p>I’m so confused.</p>
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Pau" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416646#respond" onclick='return addComment.moveForm( "comment-416646", "416646", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416719">
<div class="comment-container" id="li-comment-416719">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 15, 2017 at 5:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416719" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have an example of multiple timestep outputs here that you could use as a starting point:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416719#respond" onclick='return addComment.moveForm( "comment-416719", "416719", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-416889">
<div class="comment-container" id="li-comment-416889">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/63263f95035f8c4fb1ec667a96d08822?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/63263f95035f8c4fb1ec667a96d08822?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Paul</span>
<span class="date">October 16, 2017 at 4:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416889" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Rather than trying to predict many timestep outputs, I’m looking to output multiple predicted values per timestep. </p>
<p>One thing I don’t understand is this section:</p>
<p># invert scaling for forecast<br/>
inv_yhat = concatenate((yhat, test_X[:, 1:]), axis=1)<br/>
inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
inv_yhat = inv_yhat[:,0]</p>
<p>Why is it inserting the yhat values as the *first* column? The scaler has a different scale per column so positioning is important, and the Y data had been the last column in the row, hadn’t it? So won’t it get scaled incorrectly?</p>
<div class="reply">
<a aria-label="Reply to Paul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416889#respond" onclick='return addComment.moveForm( "comment-416889", "416889", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-416972">
<div class="comment-container" id="li-comment-416972">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 17, 2017 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416972" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The first column is the pollution value, we remove it from the test data, concat our prediction so we have enough columns for the transform’s expectations, then invert the transform and get the predicted pollution values in the correct scale.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416972#respond" onclick='return addComment.moveForm( "comment-416972", "416972", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-416664">
<div class="comment-container" id="li-comment-416664">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c83a273c95f67cffbe26a5780a84f1fb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c83a273c95f67cffbe26a5780a84f1fb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">October 14, 2017 at 9:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416664" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>First of all ,thanks a lot for the great tutorial Jason.</p>
<p>I just have one question regarding the achieved predictions using the LSTM network.</p>
<p>I just don’t understand why are you making  “trainPredict = model.predict(trainX)” .</p>
<p>I get the predict method using the testset testX, but using this method for trainX is not like if you were in some way cheating? I say this because we train the network using the trainX and trainY and trainY corresponds to the labels you are trying to predict in the predict method using trainX.</p>
<p>Is it performed for validation purposes only?</p>
<p>I’m still learning to work with the Keras API so I might be confused with the syntax of it</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416664#respond" onclick='return addComment.moveForm( "comment-416664", "416664", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-416725">
<div class="comment-container" id="li-comment-416725">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 15, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-416725" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Where am I doing that exactly?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=416725#respond" onclick='return addComment.moveForm( "comment-416725", "416725", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-417006">
<div class="comment-container" id="li-comment-417006">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/449699ac632be559ad84f66e0f516deb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/449699ac632be559ad84f66e0f516deb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Kai Li</span>
<span class="date">October 17, 2017 at 1:05 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417006" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason<br/>
Thanks a lot for your tutorial!<br/>
I still have some question,looking forward to your answer.<br/>
If I want use the feature(t) 、 feature(t-1)  and pollution(t-1) to predict pollution (t), how can I do to reshape my input?</p>
<div class="reply">
<a aria-label="Reply to Kai Li" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417006#respond" onclick='return addComment.moveForm( "comment-417006", "417006", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417033">
<div class="comment-container" id="li-comment-417033">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/aef9a7f4dd03e08964bb8bdd283f692d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/aef9a7f4dd03e08964bb8bdd283f692d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">DC</span>
<span class="date">October 17, 2017 at 8:21 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417033" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, Thank you very much for the wonderful post. I have a few questions. </p>
<p>1. You did not de-trend by using diff for above example. Diff from multi step only works for series. Can you please share how can we de-trend of multivariate time series?</p>
<p>2. I’d like to use past 3 days of above data to predict 3 time steps for multivariate data as above. Can you please let me know how I can do that with the example above?</p>
<p>Thanks for your help.</p>
<div class="reply">
<a aria-label="Reply to DC" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417033#respond" onclick='return addComment.moveForm( "comment-417033", "417033", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417058">
<div class="comment-container" id="li-comment-417058">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 18, 2017 at 5:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417058" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could de-trend each input series separately. Here is an example of using diff to detrend:<br/>
<a href="https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/" rel="nofollow">https://machinelearningmastery.com/remove-trends-seasonality-difference-transform-python/</a></p>
<p>I give an example in another comment of how to use multiple lag obs as input.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417058#respond" onclick='return addComment.moveForm( "comment-417058", "417058", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417124">
<div class="comment-container" id="li-comment-417124">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4b84a0746f7666aaab1d27906b9a7b7d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4b84a0746f7666aaab1d27906b9a7b7d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Xie</span>
<span class="date">October 19, 2017 at 12:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417124" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason. First of all, any thanks for your post. And I have some problems.</p>
<p>1. I don’t really get the meaning of hidden_units? Can you please explain a little bit.<br/>
2. I am building a lstm network as you do. I just follow your ways and build the network but got an error, as described  here <a href="https://stackoverflow.com/questions/46811085/dimension-error-building-lstm-with-keras.Could" rel="nofollow">https://stackoverflow.com/questions/46811085/dimension-error-building-lstm-with-keras.Could</a> you please help me?</p>
<p>Thanks!!</p>
<div class="reply">
<a aria-label="Reply to Xie" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417124#respond" onclick='return addComment.moveForm( "comment-417124", "417124", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417142">
<div class="comment-container" id="li-comment-417142">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417142" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>A hidden unit is a neuron or cell in a hidden layer.</p>
<p>A hidden layer is a layer that is not the output or the input layer.</p>
<p>Change your code to set “return_sequences” to be “False”.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417142#respond" onclick='return addComment.moveForm( "comment-417142", "417142", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417130">
<div class="comment-container" id="li-comment-417130">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Argie</span>
<span class="date">October 19, 2017 at 3:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417130" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So in your example you are using the data this way:</p>
<p>No,year, month,day,hour,pm2.5,DEWP,TEMP,PRES,cbwd,Iws,Is,Ir<br/>
1,   2010,1,1,0,NA,-21,-11,1021,NW,1.79,0,0</p>
<p>Is possible to use the data in a way that lets say we could have multiple input numbers in one of the columns like for example, having<br/>
No, year, month, day, hour, pm2.5, newVariable<br/>
and in the new variable position instead of having just one integer like 20<br/>
to have a sequence of integers like (5,10,3,50,23)  </p>
<p>Would that be possible using it on the same context, or is there any scenario that we could<br/>
use the data the way I mentioned  ?</p>
<div class="reply">
<a aria-label="Reply to Argie" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417130#respond" onclick='return addComment.moveForm( "comment-417130", "417130", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417144">
<div class="comment-container" id="li-comment-417144">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417144" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If you mean, can you predict a sequence output, then yes. Here is an example:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417144#respond" onclick='return addComment.moveForm( "comment-417144", "417144", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-417148">
<div class="comment-container" id="li-comment-417148">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Argie</span>
<span class="date">October 19, 2017 at 7:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417148" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I might have not been clear enough, and sorry for that.</p>
<p>What I mean is that as an input I will have 4 different categories of data lets call them A, B, C, and D, that each one of them will have more than one integer, to be exact they will have 10 integers<br/>
so for example:</p>
<p>A = {3,4,6,8,34,65,43,1,54} and so on with the other three categories.</p>
<p>The sequence of numbers within the four categories belong on different time stamps, for example 3 -&gt; t0 , 4-&gt; t1 and so on.</p>
<p>So what I need is to classify them for different data samples.</p>
<div class="reply">
<a aria-label="Reply to Argie" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417148#respond" onclick='return addComment.moveForm( "comment-417148", "417148", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-417169">
<div class="comment-container" id="li-comment-417169">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 3:55 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417169" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>These would be parallel series (columns) that could be all fed to one LSTM model like the example in the above tutorial.</p>
<p>The model will process the parallel series one at a time step at a time.</p>
<p>If the series extends beyond 200-400 time steps, then they could be split into multiple samples (e.g. multiple sub-parallel series).</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417169#respond" onclick='return addComment.moveForm( "comment-417169", "417169", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-417242">
<div class="comment-container" id="li-comment-417242">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/be304c559bff531e29c7ebaea1aec57e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Argie</span>
<span class="date">October 20, 2017 at 11:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417242" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>So so helpful, I tried it and worked like a charm.</p>
<p>Great job, and so helpful all the material you provide, and the way you do it !! </p>
<p>Thanks a lot Jason !!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-417315">
<div class="comment-container" id="li-comment-417315">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417315" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that, well done!</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417133">
<div class="comment-container" id="li-comment-417133">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a87941f97e7e7c336bf9b15d7c38e799?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a87941f97e7e7c336bf9b15d7c38e799?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tim</span>
<span class="date">October 19, 2017 at 4:59 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417133" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Really appreciate all the work you have done!</p>
<div class="reply">
<a aria-label="Reply to Tim" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417133#respond" onclick='return addComment.moveForm( "comment-417133", "417133", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417145">
<div class="comment-container" id="li-comment-417145">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417145" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Tim.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417145#respond" onclick='return addComment.moveForm( "comment-417145", "417145", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417146">
<div class="comment-container" id="li-comment-417146">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3aeaeef34959611a5eccfc84ed120bdf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3aeaeef34959611a5eccfc84ed120bdf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abhinav</span>
<span class="date">October 19, 2017 at 6:36 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417146" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Dr Brownlee. Thank you for this tutorial.</p>
<p>inv_yhat = concatenate((yhat, test_X[:, 1:]), axis=1)</p>
<p>inv_yhat = scaler.inverse_transform(inv_yhat)</p>
<p>what does these steps do?</p>
<p>Because I am getting a ValueError: operands could not be broadcast together with shapes (1822,11) (6,) (1822,11) on this step.<br/>
I am applying on my own dataset</p>
<div class="reply">
<a aria-label="Reply to Abhinav" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417146#respond" onclick='return addComment.moveForm( "comment-417146", "417146", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417168">
<div class="comment-container" id="li-comment-417168">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 19, 2017 at 3:52 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417168" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>These steps add the prediction to the test input data so that we can inverse the transform and get the prediction back into the scale we care about.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417168#respond" onclick='return addComment.moveForm( "comment-417168", "417168", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417184">
<div class="comment-container" id="li-comment-417184">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/fa649d478eebd3861238bebb5a4282d1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/fa649d478eebd3861238bebb5a4282d1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">TvT</span>
<span class="date">October 19, 2017 at 8:08 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417184" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for sharing your awesome work, I’ve been learning a lot from you!</p>
<p>I have been struggling with increasing the second dimension to fully benefit from the BPTT though. I keep getting lost in the shapes. Would you mind sharing your code for multiple time steps aswell?<br/>
That would be awesome!</p>
<p>Keep up the good work!</p>
<div class="reply">
<a aria-label="Reply to TvT" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417184#respond" onclick='return addComment.moveForm( "comment-417184", "417184", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417214">
<div class="comment-container" id="li-comment-417214">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 20, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417214" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post might help clear things up:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417214#respond" onclick='return addComment.moveForm( "comment-417214", "417214", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417271">
<div class="comment-container" id="li-comment-417271">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/65623ab13f9e1c4272e01a44af33e3cf?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/65623ab13f9e1c4272e01a44af33e3cf?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dirk</span>
<span class="date">October 20, 2017 at 7:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417271" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Awesome work, thanks for sharing it!</p>
<p>Could it be possible that you switched up the chronological order of your predictions?<br/>
It looks to me that you predict the pollution of the previous hour, instead of predicting the future.</p>
<div class="reply">
<a aria-label="Reply to Dirk" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417271#respond" onclick='return addComment.moveForm( "comment-417271", "417271", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417328">
<div class="comment-container" id="li-comment-417328">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417328" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>That is what a persistence model looks like exactly.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417328#respond" onclick='return addComment.moveForm( "comment-417328", "417328", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417301">
<div class="comment-container" id="li-comment-417301">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/315e3eb084cd0eb0c9eeb3a66e9d0aca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/315e3eb084cd0eb0c9eeb3a66e9d0aca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Craig</span>
<span class="date">October 21, 2017 at 3:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417301" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, I’m new to Deep Learning, so sorry if this is a fundamental question. I am trying to use an LSTM NN to create a super fast surrogate for a coastal circulation model (something sort of similar to this, but with time dependency: <a href="https://arxiv.org/pdf/1709.08725.pdf" rel="nofollow">https://arxiv.org/pdf/1709.08725.pdf</a>)</p>
<p>My training set looks something like this:</p>
<p>-samples: 2000 – (I modeled a year with hourly output)<br/>
-timesteps: 7 – (t-6, t-5, …, t)<br/>
-features: 4 – (offshore boundary tide, 1st derivative of offshore boundary tide, boundary river discharge for river-1, and boundary river discharge for river-2)</p>
<p>Currently, my target is velocity magnitude for one node in my model domain ([2000,1]</p>
<p>My question is: When you do this tutorial, you assign the time steps as additional features (i.e. for my problem, our train_X = [2000,1,28]). I did this and it works fine, but eventually I’d like to scale this, and I thought I’d try to reshape my data to it’s intended shape for the model (i.e. [2000,7,4]). However, when I do this, my training time goes way down (it’s probably 3-4x slower.</p>
<p>Does the model treat these two shapes differently? If not, why does it take so much longer to train with the latter shape?</p>
<div class="reply">
<a aria-label="Reply to Craig" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417301#respond" onclick='return addComment.moveForm( "comment-417301", "417301", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417344">
<div class="comment-container" id="li-comment-417344">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 21, 2017 at 5:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417344" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>More time steps is slower.</p>
<p>Perhaps this post will clear things up re input shapes:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417344#respond" onclick='return addComment.moveForm( "comment-417344", "417344", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417516">
<div class="comment-container" id="li-comment-417516">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3ca08a5d9abf023fc3250994b9aa8f08?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3ca08a5d9abf023fc3250994b9aa8f08?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amir Aaron</span>
<span class="date">October 22, 2017 at 5:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417516" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Great article.<br/>
I have a small question:<br/>
In previous article you pointed out that we need to make the data stationary,<br/>
Do we need to do it for multi-variant as well?</p>
<div class="reply">
<a aria-label="Reply to Amir Aaron" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417516#respond" onclick='return addComment.moveForm( "comment-417516", "417516", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417567">
<div class="comment-container" id="li-comment-417567">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 23, 2017 at 5:43 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417567" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ideally, yes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417567#respond" onclick='return addComment.moveForm( "comment-417567", "417567", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-417715">
<div class="comment-container" id="li-comment-417715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3bca0e4264325db31433ce65b6a480a2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3bca0e4264325db31433ce65b6a480a2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Andriy</span>
<span class="date">October 24, 2017 at 12:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nice article! I think one question remains unanswered. Why use RNNs if we only use one previous step to predict the next step? Why not SVM for example?</p>
<div class="reply">
<a aria-label="Reply to Andriy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417715#respond" onclick='return addComment.moveForm( "comment-417715", "417715", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417738">
<div class="comment-container" id="li-comment-417738">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 24, 2017 at 4:00 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417738" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No reason at all, we cannot what will work best for a given problem.</p>
<p>Try it and compare the results!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417738#respond" onclick='return addComment.moveForm( "comment-417738", "417738", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-417899">
<div class="comment-container" id="li-comment-417899">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali Abdul</span>
<span class="date">October 25, 2017 at 7:39 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417899" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this very informative post! Before applying to my financial dataset, I would like to consult you about my case. The type of my data is almost the same. I have financial risk factors like equity values, interest rates, foreign exchanges etc. values on daily basis and  their corresponding dependent variable which is profit or loss of a portfolio. My goal is to detect the patterns and features (if any) responsible for the highest profits or lowest losses. So my question is can I convert your code above to a classification problem if I label my classes as 0 for the lowest losses and 1 for the highest profits?</p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Ali Abdul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417899#respond" onclick='return addComment.moveForm( "comment-417899", "417899", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-417959">
<div class="comment-container" id="li-comment-417959">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 26, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-417959" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=417959#respond" onclick='return addComment.moveForm( "comment-417959", "417959", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-418041">
<div class="comment-container" id="li-comment-418041">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali Abdul</span>
<span class="date">October 27, 2017 at 1:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418041" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great! One more small thing. When dealing with tails (let’s say 0 for lower, 1 for other than tail, 2 for upper tail), the classes and the features of course will be highly imbalanced. What would your approach be?</p>
<div class="reply">
<a aria-label="Reply to Ali Abdul" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418041#respond" onclick='return addComment.moveForm( "comment-418041", "418041", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-418056">
<div class="comment-container" id="li-comment-418056">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 27, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418056" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You might need to adjust the distribution via rescaling to make the least represented classes better represented.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418056#respond" onclick='return addComment.moveForm( "comment-418056", "418056", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418022">
<div class="comment-container" id="li-comment-418022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/91036ecfe305c5b43ae7a03808a0d204?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mehmet Abd</span>
<span class="date">October 26, 2017 at 8:28 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for this very informative post! Before applying to my financial dataset, I would like to consult you about my case. The type of my data is almost the same. I have financial risk factors like equity values, interest rates, foreign exchanges etc. values on daily basis and  their corresponding dependent variable which is profit or loss of a portfolio. My goal is to detect the patterns and features (if any) responsible for the highest profits or lowest losses. So my question is can I convert your code above to a classification problem if I label my classes as 0 for the lowest losses and 1 for the highest profits?</p>
<p>Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Mehmet Abd" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418022#respond" onclick='return addComment.moveForm( "comment-418022", "418022", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418052">
<div class="comment-container" id="li-comment-418052">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 27, 2017 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418052" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418052#respond" onclick='return addComment.moveForm( "comment-418052", "418052", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418347">
<div class="comment-container" id="li-comment-418347">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/903c36c55f2a28cbb668176cd7d40522?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Hesam</span>
<span class="date">October 29, 2017 at 8:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418347" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello</p>
<p>What we should do if the time itself would be a value that we must predict, such as predicting time and date for the next rainfall?</p>
<div class="reply">
<a aria-label="Reply to Hesam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418347#respond" onclick='return addComment.moveForm( "comment-418347", "418347", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418401">
<div class="comment-container" id="li-comment-418401">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418401" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could predict the likelihood of rainfall for each hour and then use code (an if statement) to interpret those predictions and only output the predictions with a probability above a given threshold.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418401#respond" onclick='return addComment.moveForm( "comment-418401", "418401", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418386">
<div class="comment-container" id="li-comment-418386">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">October 30, 2017 at 3:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418386" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>Could you perhaps show me exactly where to change as to predict the temperature instead of pollution?</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418386#respond" onclick='return addComment.moveForm( "comment-418386", "418386", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418407">
<div class="comment-container" id="li-comment-418407">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 30, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418407" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can change the column used as the output variable when fitting the model.</p>
<p>Around line 52 in the full example where we drop columns we don’t care about. Change it to drop the pollution as well and not drop temperature.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418407#respond" onclick='return addComment.moveForm( "comment-418407", "418407", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-418560">
<div class="comment-container" id="li-comment-418560">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">October 31, 2017 at 10:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418560" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Can you please help me further as i can’t manage to find where to change to predict for the temperature instead of pollution</p>
<p>“” Next, we need to be more careful in specifying the column for input and output.<br/>
We have 3 * 8 + 8 columns in our framed dataset. We will take 3 * 8 or 24 columns as input for the obs of all features across the previous 3 hours. We will take just the pollution variable as output at the following hour, as follows:</p>
<p># split into input and outputs<br/>
n_obs = n_hours * n_features<br/>
train_X, train_y = train[:, :n_obs], train[:, -n_features]<br/>
test_X, test_y = test[:, :n_obs], test[:, -n_features]<br/>
print(train_X.shape, len(train_X), train_y.shape)</p>
<p>Where and how should i change to chose the temperature column?</p>
<div class="reply">
<a aria-label="Reply to Thabet" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418560#respond" onclick='return addComment.moveForm( "comment-418560", "418560", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-418577">
<div class="comment-container" id="li-comment-418577">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 2:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418577" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I cannot prepare an example for you.</p>
<p>You might want to explore getting more familiar with NumPy arrays first:<br/>
<a href="https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/index-slice-reshape-numpy-arrays-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418577#respond" onclick='return addComment.moveForm( "comment-418577", "418577", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-418642">
<div class="comment-container" id="li-comment-418642">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5789ddd0a76af869ed4079213d68c9b4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Thabet</span>
<span class="date">November 1, 2017 at 7:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418642" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Jason<br/>
can you at least point to me where in these lines the clue is?</p>
<p>train_X, train_y = train[:, :n_obs], train[:, -n_features]<br/>
test_X, test_y = test[:, :n_obs], test[:, -n_features]</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418692">
<div class="comment-container" id="li-comment-418692">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d6878cb70cfcc9b3c2627d2665ccb05e?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d6878cb70cfcc9b3c2627d2665ccb05e?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Allen</span>
<span class="date">November 1, 2017 at 7:03 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418692" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thanks for sharing your awesome work, I’ve been learning a lot from you!</p>
<p>I have a small question:</p>
<p>In previous article you pointed out that “Predict the pollution for the next hour as above and<br/>
given the “expected” weather conditions for the next hour.” ,  eg “pollution,dew,temp”.</p>
<p>What would your approach be?</p>
<div class="reply">
<a aria-label="Reply to Allen" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418692#respond" onclick='return addComment.moveForm( "comment-418692", "418692", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418733">
<div class="comment-container" id="li-comment-418733">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418733" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>For the case: “Predict the pollution for the next hour as above and given the “expected” weather conditions for the next hour.”</p>
<p>You would not need to transform the dataset, you would simply pretend that the actual weather conditions for the next hour are a forecast and predict the pollution value at that time.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418733#respond" onclick='return addComment.moveForm( "comment-418733", "418733", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-418719">
<div class="comment-container" id="li-comment-418719">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali</span>
<span class="date">November 2, 2017 at 3:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418719" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>first thanks for the post I learned a lot. I have a fundamental question about LSTM. lets say, I have 3 variables X, Y, and Z. I want to predict on Z.</p>
<p>if I make the input(train_X in example above) time lagged. So I pass it x(t), x(t-1), x(t-2), x(t-3) etc…. then will the time component of LSTM matter or not? For example we have:</p>
<p>t,  x,  y,  x-1, x-2, y-1, y-2, z-1, z-2,    z<br/>
1, 1, 2,    0,    0,     0,   0 ,   0,    0,     3<br/>
2, 2, 4,    1,    0,     2.   0,    3     0,     3<br/>
3, 3, 6,    2,    1,     4,   2,    3,    3,     6<br/>
4, 4,  8,   3,    2      6,   4     6,    3,     6<br/>
5, 5, 10,   4,   3,    8,    6     6,    6,     9</p>
<p>traditionally we would train on variables (x, y, x-1, x-2, y, y-1, y-2, z-2, z-2) on the first 4 time-steps then evaluate on the 5th.</p>
<p>my question is if I train it on time step,(1, 2, 4, 5) and evaluate on step 5, will I have the same result? mainly if I add the time-lag as an input can I reshuffle the data?</p>
<div class="reply">
<a aria-label="Reply to Ali" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418719#respond" onclick='return addComment.moveForm( "comment-418719", "418719", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-418736">
<div class="comment-container" id="li-comment-418736">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418736" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>If you reshuffle the data and the result is better/same then the LSTM is probably not the right method to use. I would recommend using an MLP. See this post:<br/>
<a href="https://machinelearningmastery.com/get-the-most-out-of-lstms/" rel="nofollow">https://machinelearningmastery.com/get-the-most-out-of-lstms/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418736#respond" onclick='return addComment.moveForm( "comment-418736", "418736", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-418722">
<div class="comment-container" id="li-comment-418722">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali</span>
<span class="date">November 2, 2017 at 4:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418722" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>if we pass in previous time lag can we shuffle the data around in the model? in other words make the input timeless?</p>
<div class="reply">
<a aria-label="Reply to Ali" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418722#respond" onclick='return addComment.moveForm( "comment-418722", "418722", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-418723">
<div class="comment-container" id="li-comment-418723">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/387a22b6ed5ccb743145c2c460fd9038?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ali</span>
<span class="date">November 2, 2017 at 4:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418723" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>sorry when I refreshed my question didn’t appear, I thought it did not go through….did not mean to impatiently spam. apologies.</p>
<div class="reply">
<a aria-label="Reply to Ali" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418723#respond" onclick='return addComment.moveForm( "comment-418723", "418723", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-418737">
<div class="comment-container" id="li-comment-418737">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418737" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem, I moderate comments so there is some delay before they appear.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418737#respond" onclick='return addComment.moveForm( "comment-418737", "418737", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418823">
<div class="comment-container" id="li-comment-418823">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cb94c5c402ca1a44ccbd74f48c43d8aa?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cb94c5c402ca1a44ccbd74f48c43d8aa?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Gus C</span>
<span class="date">November 3, 2017 at 3:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418823" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this great post.<br/>
So how do you assess graphically your forecast with the actual?</p>
<div class="reply">
<a aria-label="Reply to Gus C" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418823#respond" onclick='return addComment.moveForm( "comment-418823", "418823", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418845">
<div class="comment-container" id="li-comment-418845">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418845" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could plot both with matplotlib.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418845#respond" onclick='return addComment.moveForm( "comment-418845", "418845", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418827">
<div class="comment-container" id="li-comment-418827">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/283be31748ea90f66417527abcf657cc?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/283be31748ea90f66417527abcf657cc?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Num</span>
<span class="date">November 3, 2017 at 4:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418827" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, I have a problem that’s highly related to this guide. </p>
<p>I have a time series where the predicted variable is (allegedly) in part dependant on some features from that time step, and these features are known before it (they are “planned prices” and “expected value” for different feature). I would like to include them as input into the LSTM.<br/>
For one output, this turned out to be easy (just keep them in), but if I try to predict several outputs, I am having troubles formating the input correctly.</p>
<p>For better understanding, the desired input would be features x1 through x8 for t-1,t-2…etc and then x1 through x7 for t,t+1,t+2…etc. </p>
<p>Is this even possible with the example given here?</p>
<div class="reply">
<a aria-label="Reply to Num" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418827#respond" onclick='return addComment.moveForm( "comment-418827", "418827", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418847">
<div class="comment-container" id="li-comment-418847">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418847" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe you could adapt the example for your problem.</p>
<p>Spend some time with this post:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418847#respond" onclick='return addComment.moveForm( "comment-418847", "418847", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418830">
<div class="comment-container" id="li-comment-418830">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d91160e7cda2d674adc1e0032dd681c5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d91160e7cda2d674adc1e0032dd681c5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Geoffrey Anderson</span>
<span class="date">November 3, 2017 at 4:58 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418830" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>PM2.5 is just one time series to predict, clearly.  Predicting say 3 (or even 100,000) time series would be nice to look at too.  An real life example where it’s useful is inventory management in retailing businesses.  How many units will be sold in the next day of eggs, mascara, paper plates, frozen corn, 2% milk, skim milk, etc etc.  Many of these TS will be correlated. Might need multi-tasking neural network outputs.  LSTM would offer more automatic feature engineering than, say, using a boosted tree traditional machine learning algorithm which is natively unaware of time series.  The latter needs manual feature creation of time-windowed aggregates by the data scientist.  The LSTM just inputs the raw time series values directly by contrast, finding its own features.  A bonus when using the LSTM is there may be some time-window or other features the human didn’t know about in advance. Another bonus is multiple-output (multitasking) that neural networks can naturally provide, unlike boosted trees for example.  I’d suggest to start with only 2 or 3 TS at first, because a whole grocery store’s worth of items for even just a one day example is way too cumbersome to look at and manipulate easily on one small monitor screen.  Just a warning: This may be frontier research, believe it or not.</p>
<div class="reply">
<a aria-label="Reply to Geoffrey Anderson" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418830#respond" onclick='return addComment.moveForm( "comment-418830", "418830", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418848">
<div class="comment-container" id="li-comment-418848">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 3, 2017 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-418848" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion Geoffrey. I hope to spend more time on this soon.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=418848#respond" onclick='return addComment.moveForm( "comment-418848", "418848", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419142">
<div class="comment-container" id="li-comment-419142">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eabfa1b8d430dcbbd174679ad693f727?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eabfa1b8d430dcbbd174679ad693f727?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Lu</span>
<span class="date">November 6, 2017 at 8:35 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419142" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I plot inv_yhat and inv_y in a same figure, and I found an interesting fact, that the training result is shifted to right for an hour compared with the ground truth. That’s to say the predicted result is almost the one hour ago data, or  X_t = X_{t-1} approximately.<br/>
Actually, the best estimation for RNN is to output the latest result, without doing any prediction. How do you think about this?</p>
<div class="reply">
<a aria-label="Reply to Lu" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419142#respond" onclick='return addComment.moveForm( "comment-419142", "419142", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419194">
<div class="comment-container" id="li-comment-419194">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 7, 2017 at 9:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419194" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When a prediction looks like a shifted input it means the model has no skill because it is predicting the input as output, e.g. a persistence model:<br/>
<a href="https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/" rel="nofollow">https://machinelearningmastery.com/persistence-time-series-forecasting-with-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419194#respond" onclick='return addComment.moveForm( "comment-419194", "419194", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419177">
<div class="comment-container" id="li-comment-419177">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/68398f95ae9f8098af0ffdadfbccdd09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/68398f95ae9f8098af0ffdadfbccdd09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rafael</span>
<span class="date">November 7, 2017 at 6:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419177" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m using my own dataset and I’m not using the series_to_supervised method because I already have the dataset prepared in 2 files, train and test files. I still have the error:</p>
<p>Traceback (most recent call last):<br/>
  File “teste.py”, line 64, in<br/>
    inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
  File “C:\Users\rafae\AppData\Local\Programs\Python\Python35\lib\site-packages\sklearn\preprocessing\data.py”, line 385, in inverse_transform<br/>
    X -= self.min_<br/>
ValueError: operands could not be broadcast together with shapes (52,12585) (12586,) (52,12585)</p>
<div class="reply">
<a aria-label="Reply to Rafael" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419177#respond" onclick='return addComment.moveForm( "comment-419177", "419177", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-419178">
<div class="comment-container" id="li-comment-419178">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/68398f95ae9f8098af0ffdadfbccdd09?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/68398f95ae9f8098af0ffdadfbccdd09?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rafael</span>
<span class="date">November 7, 2017 at 6:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419178" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>To load the datasets </p>
<p>#Train dataset<br/>
dataset = read_csv(‘trainning_small.csv’, header=None, index_col=None)<br/>
dataset.drop(dataset.columns[[0]], axis=1, inplace=True)<br/>
train = dataset.values</p>
<p>encoder = LabelEncoder()<br/>
train[:,-1] = encoder.fit_transform(train[:,-1])<br/>
train = train.astype(‘float32’)</p>
<p>scaler = MinMaxScaler(feature_range=(0, 1))<br/>
train = scaler.fit_transform(train)</p>
<p>#Test dataset<br/>
dataset_test = read_csv(‘test_passare.csv’, header=None, index_col=None)<br/>
dataset_test.drop(dataset_test.columns[[0]], axis=1, inplace=True)<br/>
test = dataset_test.values</p>
<p>encoder = LabelEncoder()<br/>
test[:,-1] = encoder.fit_transform(test[:,-1])<br/>
test = test.astype(‘float32’)</p>
<p>test = scaler.fit_transform(test)</p>
<p>train_x, train_y = train[:, :-1], train[:, -1]<br/>
test_x, test_y = test[:, :-1], test[:, -1]</p>
<p>train_x = train_x.reshape((train_x.shape[0], 1, train_x.shape[1]))<br/>
test_x = test_x.reshape((test_x.shape[0], 1, test_x.shape[1]))<br/>
print(train_x.shape, train_y.shape, test_x.shape, test_y.shape)</p>
<p>THE RESULT FOR THE PRINT:<br/>
(838, 1, 12585) (838,) (52, 1, 12585) (52,)</p>
<div class="reply">
<a aria-label="Reply to Rafael" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419178#respond" onclick='return addComment.moveForm( "comment-419178", "419178", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419223">
<div class="comment-container" id="li-comment-419223">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/33ba11b92e6b155bebc022b8413a53c7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/33ba11b92e6b155bebc022b8413a53c7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Fred</span>
<span class="date">November 7, 2017 at 4:30 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419223" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Brownlee,</p>
<p>First of all, thanks for this wonderful post.  I have applied your code with the following parameters:<br/>
lags=8, features=8, epochs=50, batch=104, neurons=150</p>
<p>And got almost perfect match between train and test.  The test RMSE is 26.526.</p>
<p>My question is that what does this result stand for?</p>
<div class="reply">
<a aria-label="Reply to Fred" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419223#respond" onclick='return addComment.moveForm( "comment-419223", "419223", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419328">
<div class="comment-container" id="li-comment-419328">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 8, 2017 at 9:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419328" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Well done. The result is a summary of the error between predicted and expected values.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419328#respond" onclick='return addComment.moveForm( "comment-419328", "419328", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419777">
<div class="comment-container" id="li-comment-419777">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vlad</span>
<span class="date">November 12, 2017 at 5:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419777" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I launched this example on my notebook (AMD FX-8800P Radeon R7, 8GB RAM), it runs already 4 hours and I even can’t see what is going on with the model training and how long will it run. Is it possible to include in the example some monitoring and visualization of the training process, ex. using callbacks.RemoteMonitor ?</p>
<p>P.S. previously I worked with Matlab, it was so nice to see number of epochs, accuracy, error, and many other parameters during the training process. It helped a lot to understand should I continue training, or should I change the model.</p>
<div class="reply">
<a aria-label="Reply to Vlad" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419777#respond" onclick='return addComment.moveForm( "comment-419777", "419777", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419797">
<div class="comment-container" id="li-comment-419797">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 12, 2017 at 9:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419797" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You should see the progress for each epoch and across epochs as output on the command line.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419797#respond" onclick='return addComment.moveForm( "comment-419797", "419797", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419782">
<div class="comment-container" id="li-comment-419782">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vlad</span>
<span class="date">November 12, 2017 at 7:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419782" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hm, relaunched the example step-by-step and found out it’s stuck not at training, but at model compilation. Working for hours at 100% CPU load on block:<br/>
# design network<br/>
model = Sequential()<br/>
model.add(LSTM(50, input_shape=(train_X.shape[1], train_X.shape[2])))<br/>
model.add(Dense(1))<br/>
model.compile(loss=’mae’, optimizer=’adam’)<br/>
What’s wrong?<br/>
Ubuntu 16.4, Keras 2.0.6, Theano 0.9.0, Python 3.6.2, Anaconda custom</p>
<div class="reply">
<a aria-label="Reply to Vlad" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419782#respond" onclick='return addComment.moveForm( "comment-419782", "419782", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419798">
<div class="comment-container" id="li-comment-419798">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 12, 2017 at 9:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419798" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Are you running on the command line? If you run in a notebook, you may hide error or verbose messages.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419798#respond" onclick='return addComment.moveForm( "comment-419798", "419798", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-419804">
<div class="comment-container" id="li-comment-419804">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7c8d912927c0f7d305e8b25970b92c88?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vlad</span>
<span class="date">November 12, 2017 at 9:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419804" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I updated all libraries and anaconda and python and now it works! Sorry for disturbance 🙂 BTW, monitoring tool can be used for  callbacks.RemoteMonitor is hualos-master</p>
<div class="reply">
<a aria-label="Reply to Vlad" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419804#respond" onclick='return addComment.moveForm( "comment-419804", "419804", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419866">
<div class="comment-container" id="li-comment-419866">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 13, 2017 at 10:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419866" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad to hear that, well done!</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419866#respond" onclick='return addComment.moveForm( "comment-419866", "419866", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419854">
<div class="comment-container" id="li-comment-419854">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6f8866d0b0ac3c9d6e1090bae9948df0?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6f8866d0b0ac3c9d6e1090bae9948df0?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 13, 2017 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419854" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the very well written article.  I really appreciate the detailed walkthrough.</p>
<p>I have been looking for a way to apply multivariate input to a machine learning prediction model of any sort. I’m doing this in order to predict the growth of compute systems in excess of hundreds of thousands of nodes bases on 6 years of daily samples.  Simply looking at the Y growth over time and feeding that into something like Facebook prophet has proved somewhat insufficient because it only looks at the problem as a function of past behavior.</p>
<p>In reality there are more variables at play that control or effect that line of growth.  As such, simple univariate approaches fall short and the predictions can be very good or very bad.</p>
<p>When I found this article I thought to myself, Eureka! I will be able to use this approach in order to feed in multivariate data along with the growth of my systems in order to get better predictions.  However I was somewhat crestfallen at the revelation of 2 key problems discussed over the last several months here in the comments…</p>
<p>One problem you acknowledged as a potential/known issue and linked to another article explaining why autoregression time series problems may not be best solved with lstm neural networks. The article posits that better results might be obtained by stacking or using more layers. Have you tried this? If so, what did it look like and what results did you get?</p>
<p>The second and more concerning problem was when one commenter performed the same exercise as laid out in this article, but removed all of the multivariate data and still obtained the same rmse rate as you did.  It was as if none of the other variables had any bearing on the prediction.  This is deeply concerning, because as I see it, either this event was anomalous and driven by the input data, or the overall approach itself may be flawed, or the implementation thereof is broken.  I’m not sufficiently versed in the technology to make a value statement on any of those points.</p>
<p>I’m hoping that you would be willing to share your thoughts on possible answers to these questions.</p>
<div class="reply">
<a aria-label="Reply to Tommy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419854#respond" onclick='return addComment.moveForm( "comment-419854", "419854", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419881">
<div class="comment-container" id="li-comment-419881">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 13, 2017 at 10:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419881" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The tutorial is a demonstration of a method, not the best way of solving or even framing the presented problem.</p>
<p>I should have made that clearer, but that is the philosophy behind every single blog post on my site. I show how to use the methods, not how to get the best results (for a specific problem). The former problem is tractable the latter is not.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419881#respond" onclick='return addComment.moveForm( "comment-419881", "419881", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-419888">
<div class="comment-container" id="li-comment-419888">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 13, 2017 at 12:14 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419888" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the clarity and candor!  As a long-time comp-sci person, I find it very strange to run these tensorflow sessions and get different results for the same inputs (I’ve been putting your code through the paces) … I found I needed to add this, or every subsequent run would result in predictions that seemed to augment each previous run:</p>
<p><code></code><code><br/>
try:<br/>
    keras.backend.clear_session()<br/>
except:<br/>
    pass<br/>
</code><code></code></p>
<p>For what it’s worth, I zeroed out all the other variables (instead of eliminating them) and it /did/ have bearing on the output.  I don’t think this methodology can be dismissed as ineffective.  It seems to be approximating a workable solution.  More exploration is necessary.</p>
<p>Thank you for setting me on the path!</p>
<div class="reply">
<a aria-label="Reply to Tommy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419888#respond" onclick='return addComment.moveForm( "comment-419888", "419888", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-419939">
<div class="comment-container" id="li-comment-419939">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 14, 2017 at 10:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419939" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Damn.</p>
<p>Well, these are stochastic algorithms in general, but a single trained model should be deterministic and when it’s not, we’re in trouble.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=419939#respond" onclick='return addComment.moveForm( "comment-419939", "419939", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-5" id="comment-419960">
<div class="comment-container" id="li-comment-419960">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 14, 2017 at 11:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-419960" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Have you tried running multiple iterations and examining yhat_inv?</p>
<p>I keep getting different output, and I didn’t expect that.  Am I looking in the wrong place?</p>
<p>I can send a catalog of my results if that helps…</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-5" id="comment-420035">
<div class="comment-container" id="li-comment-420035">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 15, 2017 at 9:45 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420035" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have not.</p>
<p>In general, we do expect different results across different runs given the stochastic nature of neural networks (forgive me if I am missing the point):<br/>
<a href="https://machinelearningmastery.com/randomness-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/randomness-in-machine-learning/</a></p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-420108">
<div class="comment-container" id="li-comment-420108">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e53f2aeb60ef4d4b1ebfe571ac708454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e53f2aeb60ef4d4b1ebfe571ac708454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sam</span>
<span class="date">November 15, 2017 at 10:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420108" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>multivariate time series forecasting possible for multi-step??</p>
<div class="reply">
<a aria-label="Reply to sam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420108#respond" onclick='return addComment.moveForm( "comment-420108", "420108", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420180">
<div class="comment-container" id="li-comment-420180">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420180" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sure.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420180#respond" onclick='return addComment.moveForm( "comment-420180", "420180", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-420214">
<div class="comment-container" id="li-comment-420214">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e53f2aeb60ef4d4b1ebfe571ac708454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e53f2aeb60ef4d4b1ebfe571ac708454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">sam</span>
<span class="date">November 16, 2017 at 6:23 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420214" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, </p>
<p>Jason Can you please explain..How to prepare dataset for train models.. let’s suppose i have 5 feature and i want to predict t + 5 value..</p>
<p>For example.. </p>
<p>x1 = (2,3,4,3,1,6,8,9,4,1)<br/>
x2 = (5,2,5,7,9,9,6,3,1,3)<br/>
x3 = (2,3,4,8,1,6,8,9,1,1)<br/>
x4 = (5,1,5,7,9,9,6,3,1,7)<br/>
x5 = (2,3,4,6,8,3,1,3,5,7)<br/>
y =   (8,7,6,5,4,3,2,8,9,7)</p>
<p>Thanks,</p>
<div class="reply">
<a aria-label="Reply to sam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420214#respond" onclick='return addComment.moveForm( "comment-420214", "420214", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420448">
<div class="comment-container" id="li-comment-420448">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4efecf7ef0cbbf83dbc60c76d848d5eb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tommy</span>
<span class="date">November 18, 2017 at 3:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420448" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>What do you think about putting a dropout layer between the LSTM and Dense layers to address the overfitting phenomenon?</p>
<div class="reply">
<a aria-label="Reply to Tommy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420448#respond" onclick='return addComment.moveForm( "comment-420448", "420448", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420537">
<div class="comment-container" id="li-comment-420537">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 19, 2017 at 11:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420537" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Try it and see, I’d love to hear how it goes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420537#respond" onclick='return addComment.moveForm( "comment-420537", "420537", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420591">
<div class="comment-container" id="li-comment-420591">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/325ca6e186f097b950fca927bad13eb8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/325ca6e186f097b950fca927bad13eb8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdulrauf Garba</span>
<span class="date">November 19, 2017 at 10:36 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420591" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, Jason, we need a similar tutorial of Multivariate time series using the Recurrent neural network in R.</p>
<div class="reply">
<a aria-label="Reply to Abdulrauf Garba" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420591#respond" onclick='return addComment.moveForm( "comment-420591", "420591", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420641">
<div class="comment-container" id="li-comment-420641">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 20, 2017 at 10:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420641" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for the suggestion.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420641#respond" onclick='return addComment.moveForm( "comment-420641", "420641", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420768">
<div class="comment-container" id="li-comment-420768">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dcb18e49ae1765b5e2d4f7ee5a13ba63?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dcb18e49ae1765b5e2d4f7ee5a13ba63?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Louis</span>
<span class="date">November 22, 2017 at 1:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420768" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason!</p>
<p>You say in your post: </p>
<p>“We can use this data and frame a forecasting problem where, given the weather conditions and pollution for prior hours, we forecast the pollution at the next hour.”</p>
<p>Is it possible to do the same without prior knowledge of the pollution levels?</p>
<p>I am working on a very similar time series forecasting problem. However, in my case, I don’t have access to intermediate level of pollution.</p>
<p>Thank you</p>
<div class="reply">
<a aria-label="Reply to Louis" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420768#respond" onclick='return addComment.moveForm( "comment-420768", "420768", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420820">
<div class="comment-container" id="li-comment-420820">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 11:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420820" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but it is important to spend time exploring different framings of the problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420820#respond" onclick='return addComment.moveForm( "comment-420820", "420820", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420780">
<div class="comment-container" id="li-comment-420780">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/746201ba61ea26d2667d659c7d016ed3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/746201ba61ea26d2667d659c7d016ed3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Shantanu</span>
<span class="date">November 22, 2017 at 5:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420780" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>I have a question about splitting the data.<br/>
I have the data month wise for around 20 years.<br/>
How should I split it?<br/>
Thanks.</p>
<div class="reply">
<a aria-label="Reply to Shantanu" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420780#respond" onclick='return addComment.moveForm( "comment-420780", "420780", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420822">
<div class="comment-container" id="li-comment-420822">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 11:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420822" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420822#respond" onclick='return addComment.moveForm( "comment-420822", "420822", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420789">
<div class="comment-container" id="li-comment-420789">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/6ecb389bf41ce322695c7e992e8196f2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/6ecb389bf41ce322695c7e992e8196f2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">michael</span>
<span class="date">November 22, 2017 at 9:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420789" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you for this excellent tutorial!</p>
<p>This may or may not be a slight variation of your “Train On Multiple Lag Timesteps Example”, but I was wondering how I should modify your example to do a multivariate one to multiple time step prediction i.e. look at one time step of 8 dimensional data and predict 10 time steps of 8 dimensional data. Or a multivariate seq2seq prediction i.e. show 10 time steps of 8 dimensional data and predict 10 time steps of 8 dimensional data.</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to michael" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420789#respond" onclick='return addComment.moveForm( "comment-420789", "420789", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-420829">
<div class="comment-container" id="li-comment-420829">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 22, 2017 at 11:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420829" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hmmm, I have to think about that. It might be best to do a multiple output model:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420829#respond" onclick='return addComment.moveForm( "comment-420829", "420829", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-420965">
<div class="comment-container" id="li-comment-420965">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sammy</span>
<span class="date">November 23, 2017 at 1:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420965" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
   First of all, thank you very much for this excellent post. I would be grateful if you can show how to do multivariate time series forecasting per group. In other words, lets say we have data for many cities and we would like to add the forecasting per city ? How we can feed the data to LSTM for a given city and get inv_y, inv_yhat to compare to see how model does ?<br/>
Thanks again,<br/>
Sammy</p>
<div class="reply">
<a aria-label="Reply to Sammy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420965#respond" onclick='return addComment.moveForm( "comment-420965", "420965", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421029">
<div class="comment-container" id="li-comment-421029">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421029" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You could model each city separately or combine all cities into a single dataset, or do both and ensemble the result.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421029#respond" onclick='return addComment.moveForm( "comment-421029", "421029", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-420983">
<div class="comment-container" id="li-comment-420983">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/04b84804174505d7b12d88c405741eec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/04b84804174505d7b12d88c405741eec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://None" rel="external nofollow">Nagabhushan S Baddi</a></span>
<span class="date">November 23, 2017 at 7:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-420983" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.<br/>
I have a dataset of 169307 rows and 41 features. I want to use timestep of 5. So, when I am using X=np.reshape(X, (169307, 5, 41)), I am getting an error that “cannot reshape array of size 6941587 into shape (169307,5,41)”. Does this mean that n_samples*n_features in the orginal dataset should be divisible by n_timesteps? If this is true, then how can I be able to use timestep of my choice?</p>
<div class="reply">
<a aria-label="Reply to Nagabhushan S Baddi" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=420983#respond" onclick='return addComment.moveForm( "comment-420983", "420983", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421037">
<div class="comment-container" id="li-comment-421037">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 24, 2017 at 9:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421037" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps this post will help:<br/>
<a href="https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421037#respond" onclick='return addComment.moveForm( "comment-421037", "421037", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-421088">
<div class="comment-container" id="li-comment-421088">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/04b84804174505d7b12d88c405741eec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/04b84804174505d7b12d88c405741eec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://No%20e" rel="external nofollow">Nagabhushan</a></span>
<span class="date">November 24, 2017 at 7:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421088" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason.</p>
<p>I referred to this post. But it explains data preprocessing in which only 1 feature is present. But my dataset has multiple features..I am confused on how to reformulate the data and then reshape it…for example, let us say, the following is my dataset:<br/>
 Slno f1 f2 f2 target<br/>
  1.     2. 3.  1.  0<br/>
  2.     1.  7. 9.  1<br/>
  3 .     3.  3. 1. .1<br/>
  ……</p>
<p>Here it has three features f1 f2 f3..and a target label with two classes.here the classification cannot be done only on the current feature vector, since the output has a dependence on previous feature vectors..can u plz explain me the data formulation for this case to the format n_sample, time steps, n_features…where n_sample is the same as number of sample in the original dataset X and n_features is the same as number of feature I.e 3.  Let’s say the time step is 5. Plz help in this.</p>
<div class="reply">
<a aria-label="Reply to Nagabhushan" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421088#respond" onclick='return addComment.moveForm( "comment-421088", "421088", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-421134">
<div class="comment-container" id="li-comment-421134">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 25, 2017 at 10:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421134" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you frame your data as a supervised learning problem:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421134#respond" onclick='return addComment.moveForm( "comment-421134", "421134", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421179">
<div class="comment-container" id="li-comment-421179">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">November 25, 2017 at 11:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421179" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I’m a little confused about the range of scaling.</p>
<p>In many other posts you mentioned the following:<br/>
“Transform the observations to have a specific scale. Specifically, to rescale the data to values between -1 and 1 to meet the default hyperbolic tangent activation function of the LSTM model.”</p>
<p>Is there a reason for the use of 0 to 1 ?<br/>
Isn’t  -1 to 1 better for scaling, since the activation function is tanh?</p>
<p>Thank you,<br/>
Chris</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421179#respond" onclick='return addComment.moveForm( "comment-421179", "421179", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421200">
<div class="comment-container" id="li-comment-421200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 26, 2017 at 7:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great question, a scale of 0-1 results in better skill in my experience.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421200#respond" onclick='return addComment.moveForm( "comment-421200", "421200", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421390">
<div class="comment-container" id="li-comment-421390">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8ddc036a0c0cd9f63bc03115ec4b850c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8ddc036a0c0cd9f63bc03115ec4b850c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Somayeh</span>
<span class="date">November 28, 2017 at 1:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421390" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you so much for the wonderful tutorial! That was so helpful for me.<br/>
When i read your post, my questions was solved about how to predict multi-output multi-input system in multi-step time series because of your great illustration. </p>
<p>But  I have a question, in my problem, we have many observations for some cases in each time (about 500), so we have multiple series inputs and outputs in each time.</p>
<p>Could you please help me how can solve this issue.</p>
<p>Any help will be useful for me. i will be very appreciated for your help.</p>
<p>Thank you,</p>
<p>Somayeh</p>
<div class="reply">
<a aria-label="Reply to Somayeh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421390#respond" onclick='return addComment.moveForm( "comment-421390", "421390", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421429">
<div class="comment-container" id="li-comment-421429">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 28, 2017 at 8:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421429" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend exploring many different framings of the problem to see what works best and consider a baseline MLP model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421429#respond" onclick='return addComment.moveForm( "comment-421429", "421429", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421526">
<div class="comment-container" id="li-comment-421526">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cfb457d5b7806e749695027db0b90778?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cfb457d5b7806e749695027db0b90778?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Michael</span>
<span class="date">November 29, 2017 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421526" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I see this question has been raised before, I’m sorry for beating a dead horse. I’ve been struggling with the inverse_transform step.<br/>
I tried to implement this algorithm using my own dataset and had trouble with it. Then I tried to run the example with the example dataset as in the tutorial and also had an error on the inverse_transform step.</p>
<p>inv_yhat = scaler.inverse_transform(inv_yhat)</p>
<p>(on my data)<br/>
ValueError: operands could not be broadcast together with shapes (15357,287) (8,) (15357,287) </p>
<p>on the tutorial data set:<br/>
ValueError: operands could not be broadcast together with shapes (35037,24) (8,) (35037,24) </p>
<p>PS. your blog is great. Keep up the the good work!</p>
<div class="reply">
<a aria-label="Reply to Michael" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421526#respond" onclick='return addComment.moveForm( "comment-421526", "421526", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421552">
<div class="comment-container" id="li-comment-421552">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2017 at 8:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421552" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, you must make sure that the data has the same shape and that columns have the same index when transforming and inverse transforming.</p>
<p>Confirm this before performing each operation.</p>
<p>Does that help? Let me know how you go.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421552#respond" onclick='return addComment.moveForm( "comment-421552", "421552", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421543">
<div class="comment-container" id="li-comment-421543">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">November 29, 2017 at 8:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421543" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI jason,</p>
<p>Thanks for great tutorial. I have a question how to choose the no. of timesteps as you always choose 1 timestep ? From where can I see the predicted value as graph just showing training of model and how can I predict the value for different time intervals (e.g. if I want to predict the value for next 1, 2, 4 or hours)?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421543#respond" onclick='return addComment.moveForm( "comment-421543", "421543", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421554">
<div class="comment-container" id="li-comment-421554">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 29, 2017 at 8:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421554" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend experimenting with different numbers of time steps on your problem to see what works best.</p>
<p>You can collect predicted values and plot your own graph using matplotlib. I provide examples on other posts, for example:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421554#respond" onclick='return addComment.moveForm( "comment-421554", "421554", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421592">
<div class="comment-container" id="li-comment-421592">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/81d980169dd303a3baa120ad73dad744?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/81d980169dd303a3baa120ad73dad744?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmed Ali Mbarak</span>
<span class="date">November 29, 2017 at 4:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421592" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Mr Jason Brownlee, Your tutorial is awesome, it helped me in my project. I have been really interested in machine learning and this place has given me a lot.</p>
<p>My next move was to find a way to input data to my code and predict the future value. Like for example, for predicting air pollution.  A user will keep todays data like N02 and windspeed and the code will spit out tomorrow’s air pollution. In other words how to apply the code to practice?.</p>
<p>Thank you.</p>
<div class="reply">
<a aria-label="Reply to Ahmed Ali Mbarak" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421592#respond" onclick='return addComment.moveForm( "comment-421592", "421592", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-421628">
<div class="comment-container" id="li-comment-421628">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">November 30, 2017 at 12:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421628" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I think “yhat” is the predicted value regarding “test_X” actual value because we are providing test_X as input to predict.</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421628#respond" onclick='return addComment.moveForm( "comment-421628", "421628", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-421666">
<div class="comment-container" id="li-comment-421666">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421666" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sounds correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421666#respond" onclick='return addComment.moveForm( "comment-421666", "421666", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421656">
<div class="comment-container" id="li-comment-421656">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421656" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here is an example:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421656#respond" onclick='return addComment.moveForm( "comment-421656", "421656", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421610">
<div class="comment-container" id="li-comment-421610">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">November 29, 2017 at 8:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421610" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>In series_to_supervised() function, when we change the value of variable “n_in” (e.g. if we say 2 in this example ,does it mean we are now predicting for the next two hour because now the dataframe will have 16 columns instead of 8)? How the value of “n_out” effects please explain that also .</p>
<p>Best Regards,</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421610#respond" onclick='return addComment.moveForm( "comment-421610", "421610", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421663">
<div class="comment-container" id="li-comment-421663">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:11 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421663" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can learn more about that function here:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421663#respond" onclick='return addComment.moveForm( "comment-421663", "421663", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-421627">
<div class="comment-container" id="li-comment-421627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">November 30, 2017 at 12:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>i took the “yhat” array as my predicted values and “test_X” array as actual values because we predicted on test_X array and draw a plot using matplotlib , did I do the right ?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421627#respond" onclick='return addComment.moveForm( "comment-421627", "421627", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-421652">
<div class="comment-container" id="li-comment-421652">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sammy</span>
<span class="date">November 30, 2017 at 7:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421652" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
   I wanted to have n_in: Number of lag observations as input (X) set to 3 (using my own data) as can be seen below<br/>
49 # frame as supervised learning<br/>
50 reframed = series_to_supervised(scaled, 3, 1)</p>
<p>I make the data samples<br/>
86 inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
and I get the following error:<br/>
 File “/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages/sklearn/preprocessing/data.py”, line 385, in inverse_transform<br/>
    X -= self.min_<br/>
ValueError: operands could not be broadcast together with shapes (67112,57) (19,) (67112,57)<br/>
I have initially 19 variables and I have number of observations set to 3 the text_X has following shape<br/>
  &gt;&gt;&gt; test_X.shape<br/>
(67112, 1, 57)<br/>
yhat = model.predict(test_X)  and<br/>
&gt;&gt;&gt; yhat.shape<br/>
(67112, 1)</p>
<p>I don’t understand the error above. I would be grateful if you can help me see what I am doing wrong.<br/>
Again, thanks a lot. You are awesome !<br/>
Sammy</p>
<div class="reply">
<a aria-label="Reply to Sammy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421652#respond" onclick='return addComment.moveForm( "comment-421652", "421652", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-421677">
<div class="comment-container" id="li-comment-421677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 8:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Sammy, did you try the section “Update: Train On Multiple Lag Timesteps Example”?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421677#respond" onclick='return addComment.moveForm( "comment-421677", "421677", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-421678">
<div class="comment-container" id="li-comment-421678">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/878978f067558c3daae07bf708861c7b?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sammy</span>
<span class="date">November 30, 2017 at 9:00 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421678" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No as I didn’t see the update before. I will try it now. Thanks a lot</p>
<div class="reply">
<a aria-label="Reply to Sammy" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421678#respond" onclick='return addComment.moveForm( "comment-421678", "421678", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-421681">
<div class="comment-container" id="li-comment-421681">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 30, 2017 at 10:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421681" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>No problem.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421681#respond" onclick='return addComment.moveForm( "comment-421681", "421681", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-421766">
<div class="comment-container" id="li-comment-421766">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/08a1edc869df238b4c28c34546743166?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/08a1edc869df238b4c28c34546743166?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Miha</span>
<span class="date">December 1, 2017 at 2:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421766" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>First of all, many thanks for this great tutorial!</p>
<p>I’m trying to apply this to my own problem. However, I’m facing some problems.<br/>
Let’s say we have the time series of multivariate data structured like this:</p>
<p>x1,x2,x3,…x30, y1<br/>
x1,x2,x3,…x30, y2<br/>
….</p>
<p>where x1 – x30 are numeric (continues) values and y1 – yn are labels which I want to predict.<br/>
Y can only be 1 (on) or 0 (off). Some of these parameters are raw sensor data, which increase or decrease over n samples, so I know that this problem is ideal for RNN.</p>
<p>But I am not sure if my approach is ok.</p>
<p>Is it ok to re-factor the data in a way, that I take the first 10 samples (without y values of course), create the 2D array of them and try to predict the output of sample n10 and then move for 1 place and take next 10 samples and predict sample n11 and so on… So not to combine them into one vector like you did.</p>
<p>For example, if I have 10,000 samples, each for 100ms and I want to look at the last 10 samples (1 second) I train the data with samples of shape (99990, 10, 30 ) where 99990 represent the number of samples, each containing 10 readings (1 second) with the dimension of 30.</p>
<p>My current model looks like this, but it is not as successful as I want it to be (I think it can be a lot better):</p>
<p>model = Sequential()<br/>
model.add(LSTM(100, input_shape=(nsamples, nbatch, ndimension))<br/>
model.add(Dropout(0.2))<br/>
model.add(LSTM(100))<br/>
model.add(Dropout(0.2))<br/>
model.add(Dense(1, activation=’sigmoid’))<br/>
model.compile(loss=’binary_crossentropy’, optimizer=’adam’)</p>
<p>Can you please point me in the right direction?</p>
<div class="reply">
<a aria-label="Reply to Miha" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421766#respond" onclick='return addComment.moveForm( "comment-421766", "421766", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-2" id="comment-421929">
<div class="comment-container" id="li-comment-421929">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 2, 2017 at 9:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421929" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Maha,</p>
<p>Can you tell me why you are just applying “Activation Function” to just output layer I mean why there is no “Activation Function” for hidden layer?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421929#respond" onclick='return addComment.moveForm( "comment-421929", "421929", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-3" id="comment-421987">
<div class="comment-container" id="li-comment-421987">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 3, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421987" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are using the default activation functions for the LSTM hidden layers.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421987#respond" onclick='return addComment.moveForm( "comment-421987", "421987", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-421979">
<div class="comment-container" id="li-comment-421979">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/dac67684b219ac8d73ed9b09759a0e42?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dac67684b219ac8d73ed9b09759a0e42?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Silvia</span>
<span class="date">December 3, 2017 at 4:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421979" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>train_X = train_X.reshape((train_X.shape[0], 1, train_X.shape[1]))<br/>
test_X = test_X.reshape((test_X.shape[0], 1, test_X.shape[1]))</p>
<p>I’m having a lot of troubles with these two lines.</p>
<p>I don’t understand why it isn’t like so</p>
<p>train_X = train_X.reshape((1, train_X.shape[0], train_X.shape[1]))<br/>
test_X = test_X.reshape((1, test_X.shape[0],  test_X.shape[1]))</p>
<p>I thought (and obviously I’m wrong, but I want to know why) that we had 1 sample because we have one city, but have multiple timesteps one for each set of measurements.</p>
<p>If we had 3 cities would we then have 3 instead of 1?</p>
<div class="reply">
<a aria-label="Reply to Silvia" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421979#respond" onclick='return addComment.moveForm( "comment-421979", "421979", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-421996">
<div class="comment-container" id="li-comment-421996">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 3, 2017 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-421996" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In this example, we are only using a single time step per sample.</p>
<p>It is unrelated to the number of cities.</p>
<p>See this post for more on how to reshape data for LSTMs:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=421996#respond" onclick='return addComment.moveForm( "comment-421996", "421996", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422024">
<div class="comment-container" id="li-comment-422024">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e7fcdd7bca4e8c822dc99a05e293f236?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e7fcdd7bca4e8c822dc99a05e293f236?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mahesh</span>
<span class="date">December 3, 2017 at 12:50 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422024" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>If I have data for every city then how can I build one LSTM model. Here data is for only one city and have to forecast pollution. Lets suppose if I append data for other cities so can we predict pollution using single LSTM<br/>
Yes,we can build model for each city separately but can we build a single model?</p>
<div class="reply">
<a aria-label="Reply to Mahesh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422024#respond" onclick='return addComment.moveForm( "comment-422024", "422024", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422094">
<div class="comment-container" id="li-comment-422094">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2017 at 7:44 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422094" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There is no one best way. I would encourage you to explore different ways to frame this problem, perhaps one model per city, perhaps one model for regions or all cities, perhaps ensembles of models. See what works best for your data.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422094#respond" onclick='return addComment.moveForm( "comment-422094", "422094", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422062">
<div class="comment-container" id="li-comment-422062">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/50d86d87f6986dffaaad63ba2b957b0c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/50d86d87f6986dffaaad63ba2b957b0c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">lucy80</span>
<span class="date">December 3, 2017 at 10:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422062" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>If instead of single time series we have multiple time series, how should we normalize data?<br/>
i.e. if we have pollution data for 100 cities, normalization should be done citiwise or across all cities ?</p>
<div class="reply">
<a aria-label="Reply to lucy80" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422062#respond" onclick='return addComment.moveForm( "comment-422062", "422062", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422099">
<div class="comment-container" id="li-comment-422099">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 4, 2017 at 7:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422099" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It really depends on the model that you are constructing.</p>
<p>Your goal is to ensure input data to the model is consistent.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422099#respond" onclick='return addComment.moveForm( "comment-422099", "422099", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422555">
<div class="comment-container" id="li-comment-422555">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/7f3498c05249bc66410ccc314b3f59ca?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7f3498c05249bc66410ccc314b3f59ca?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mangesh Divate</span>
<span class="date">December 9, 2017 at 7:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422555" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,  one question is why didn’t you used scikit-learn train_test_split function instead of</p>
<p># split into train and test sets<br/>
values = reframed.values<br/>
n_train_hours = 365 * 24<br/>
train = values[:n_train_hours, :]<br/>
test = values[n_train_hours:,</p>
<div class="reply">
<a aria-label="Reply to Mangesh Divate" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422555#respond" onclick='return addComment.moveForm( "comment-422555", "422555", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422577">
<div class="comment-container" id="li-comment-422577">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 9, 2017 at 9:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422577" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>By all means, try it. Note that you cannot shuffle the series.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422577#respond" onclick='return addComment.moveForm( "comment-422577", "422577", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422691">
<div class="comment-container" id="li-comment-422691">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">james</span>
<span class="date">December 11, 2017 at 1:16 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422691" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>oh,jason,<br/>
    in  my computer, every epochs  used  191s!   emmmmmm………..  this time is  too long .<br/>
i want to  ask ,you used GPU  to speed up ? or  other  problems?<br/>
                                                                                                               thank you!!</p>
<div class="reply">
<a aria-label="Reply to james" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422691#respond" onclick='return addComment.moveForm( "comment-422691", "422691", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422715">
<div class="comment-container" id="li-comment-422715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 11, 2017 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>GPU can speed up LSTMs somewhat, but not as much as MLPs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422715#respond" onclick='return addComment.moveForm( "comment-422715", "422715", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-422736">
<div class="comment-container" id="li-comment-422736">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mark</span>
<span class="date">December 11, 2017 at 8:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422736" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Thank you so much for your brilliant website helping us all get good at machine learning!</p>
<p>Please could you clarify the line of code that outputs the next hour’s pollution reading? I’ve run the model and it return the RMSE but I’m interested to see the t+1 prediction.</p>
<p>What code would I add at the end so that when the model has finished running it prints the next hour’s predicted pollution reading?</p>
<p>Many thanks!</p>
<div class="reply">
<a aria-label="Reply to Mark" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422736#respond" onclick='return addComment.moveForm( "comment-422736", "422736", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422766">
<div class="comment-container" id="li-comment-422766">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 11, 2017 at 4:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422766" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Mark!</p>
<p>See this post on how to make predictions with a finalized LSTM model:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422766#respond" onclick='return addComment.moveForm( "comment-422766", "422766", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-422925">
<div class="comment-container" id="li-comment-422925">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mark</span>
<span class="date">December 13, 2017 at 12:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422925" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you, Jason.</p>
<p>I’m almost ready to apply what you’ve taught me here to my use case. The only other thing that isn’t 100% clear to me is the dropping columns number references 9,10,11,12,13,14,15 (below):</p>
<p># drop columns we don’t want to predict<br/>
reframed.drop(reframed.columns[[9,10,11,12,13,14,15]], axis=1, inplace=True)</p>
<p>I get that you’re dropping the columns after ‘pollution’ because you only want to predict the pollution readings but why are they referenced 9-15?</p>
<p>Thank you in advance!</p>
<div class="reply">
<a aria-label="Reply to Mark" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422925#respond" onclick='return addComment.moveForm( "comment-422925", "422925", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-422952">
<div class="comment-container" id="li-comment-422952">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 5:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422952" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are dropping variables that we do not want to predict at the next time step. We only want to predict pollution.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422952#respond" onclick='return addComment.moveForm( "comment-422952", "422952", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-422966">
<div class="comment-container" id="li-comment-422966">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0a0c268709b77e9605a78a55f9c02cd3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mark</span>
<span class="date">December 13, 2017 at 7:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422966" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I understand that. My question was around the numbering. If we’re dropping columns ‘dew’ through to ‘rain’ i.e. columns number 3 to 9 in the prepared “pollution.csv” dataset above then why isn’t the code written:</p>
<p>reframed.drop(reframed.columns[[3,4,5,6,7,8,9]], axis=1, inplace=True)</p>
<p>It’s the 9 – 15 that I just need an explanation for please.</p>
<p>Many thanks</p>
<div class="reply">
<a aria-label="Reply to Mark" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422966#respond" onclick='return addComment.moveForm( "comment-422966", "422966", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-422997">
<div class="comment-container" id="li-comment-422997">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 13, 2017 at 4:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-422997" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>We are dropping them from the new dataset that has lag variables.</p>
<p>Try printing the version of the dataset that we are modifying to get an idea of its shape.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=422997#respond" onclick='return addComment.moveForm( "comment-422997", "422997", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423026">
<div class="comment-container" id="li-comment-423026">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b7c1cb32c97bd28ec2f534fe4b204145?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Chris</span>
<span class="date">December 13, 2017 at 11:07 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423026" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello json,<br/>
again a very successful contribution. </p>
<p>What I would like to do is something like a early warning system that predicts as early as possible, as safely as possible for example in the case of natural disasters, financial forecast or driving data from the prediction output of a Multivariate Time Series LSTM Forecast.</p>
<p>Suppose I get the prediction, e.g. x, y and z and each area labeled  with x or z must be K-units long, each time they occur. X and z  make up 10 percent of the data.</p>
<p>The ground truth and Prediction would then look like e.g.<br/>
GT:y y y y y  y y y x x x x x x y y y y y y z z z z z z y y y y y y y y y y y y y y y y<br/>
PR:y y y x x y y y x x x x x x y y y x y y y z z z y y y y y y y y y z z y y y x x y y </p>
<p>Now I would like to determine an overall probability for an event, based on the PR sequence.<br/>
Op:y – – – – – – – – X – – – – – – Y – – – – – – Z- – – – – -Y – – – – – – – – – – – – – – – – – </p>
<p>I had the idea of a window with a threshold or a sequence classification task.</p>
<p>Since I am fairly new to machine learning and co, but I’m thinking that this problem has probably been discussed and solved very often, I would be very happy about your advice.</p>
<div class="reply">
<a aria-label="Reply to Chris" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423026#respond" onclick='return addComment.moveForm( "comment-423026", "423026", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423061">
<div class="comment-container" id="li-comment-423061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 14, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There is not one best way to solve a problem like, this, but many. I’d encourage you to brainstorm different ways of framing this as a prediction problem and see what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423061#respond" onclick='return addComment.moveForm( "comment-423061", "423061", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423049">
<div class="comment-container" id="li-comment-423049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 14, 2017 at 4:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>These days LSTM is also popular for sentimental analysis. Have you written any tutorial on Sentimental Analysis using LSTM or something like that ?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423049#respond" onclick='return addComment.moveForm( "comment-423049", "423049", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423065">
<div class="comment-container" id="li-comment-423065">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 14, 2017 at 5:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423065" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, see here:<br/>
<a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" rel="nofollow">https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423065#respond" onclick='return addComment.moveForm( "comment-423065", "423065", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423091">
<div class="comment-container" id="li-comment-423091">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7fcb7c1e3cc9a509c9fd5e9e9a4b2a5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7fcb7c1e3cc9a509c9fd5e9e9a4b2a5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Mike</span>
<span class="date">December 14, 2017 at 5:42 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423091" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,jason<br/>
     can i save my model ? i don’t  want to train it everytime….<br/>
oh,and do  you have any article to talk  how to  predict next n step  in Multivariate Time Series Forecasting with LSTMs in Keras??<br/>
                                          thank you!!!</p>
<div class="reply">
<a aria-label="Reply to Mike" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423091#respond" onclick='return addComment.moveForm( "comment-423091", "423091", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423147">
<div class="comment-container" id="li-comment-423147">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423147" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes you can save your model, here’s how:<br/>
<a href="https://machinelearningmastery.com/save-load-keras-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/save-load-keras-deep-learning-models/</a></p>
<p>Here’s how to make predictions:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423147#respond" onclick='return addComment.moveForm( "comment-423147", "423147", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423262">
<div class="comment-container" id="li-comment-423262">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony</span>
<span class="date">December 15, 2017 at 11:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423262" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi, jason<br/>
   I read your article and run the code.But  i have some  questions .Can you give me some suggestions?<br/>
1.   In this article, you prepare the pollution dataset for the LSTM.  All features are normalized, your dataset  is transformed a supervised learning problem . I  want to ask ,why the code is   ‘MinMaxScaler(feature_range=(0, 1)) ‘,  rather than  ‘MinMaxScaler(feature_range=(-1, 1))’ ?I remember  the default activation function for LSTMs is the hyperbolic tangent (tanh), which outputs values between -1 and 1.   Why we set (0,1) in there?<br/>
2.  In  this code,we don’t transform Time Series to Stationary. Why?  I think  we must  transform Time Series to Stationary.  It’s  necessary，right?<br/>
3. the important arguments are batch_size, n_neuron  and epochs. How shoud i adjust  them?<br/>
4. Can i use CNN network to  predict  Multivariate Time Series ? Too many  people all think LSTM is the best  way, Really?<br/>
                                                                                            Thank you very much!</p>
<div class="reply">
<a aria-label="Reply to Tony" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423262#respond" onclick='return addComment.moveForm( "comment-423262", "423262", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423335">
<div class="comment-container" id="li-comment-423335">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423335" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Results are better if you normalize the data.</p>
<p>Making the data stationary may improve the skill of the model. I was trying to keep the example simple.</p>
<p>Use experiments to see what values give the best results. Be systematic.</p>
<p>I think MLP is better at time series, here’s why:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423335#respond" onclick='return addComment.moveForm( "comment-423335", "423335", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-423474">
<div class="comment-container" id="li-comment-423474">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony</span>
<span class="date">December 16, 2017 at 7:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423474" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>thank you jason,<br/>
       your reply  it’s very usefu.  But i still  don’t  understand  why the code is MinMaxScaler(feature_range=(0, 1))?   in your other article ,you use feature_range=(0, 1),<br/>
so i’m very wondering . what is the reason? The activation function for LSTMs is changeable?</p>
<div class="reply">
<a aria-label="Reply to Tony" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423474#respond" onclick='return addComment.moveForm( "comment-423474", "423474", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-423566">
<div class="comment-container" id="li-comment-423566">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 17, 2017 at 8:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423566" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t follow?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423566#respond" onclick='return addComment.moveForm( "comment-423566", "423566", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-5" id="comment-423598">
<div class="comment-container" id="li-comment-423598">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3c6d6d407d2cf8dde005be5495e88903?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Tony</span>
<span class="date">December 17, 2017 at 1:47 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423598" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>i am foolish,I write it wrongly ,i am sorry,<br/>
         my question is:<br/>
          But i still don’t understand why the code is MinMaxScaler(feature_range=(0, 1))? in your other article ,you use feature_range=(-1, 1),The activation function for LSTMs is tanh?  i think  thnh is in (-1,1)  , why in there ,we use (0,1)?<br/>
          thank you so much….</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-423669">
<div class="comment-container" id="li-comment-423669">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423669" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>LSTMs generally perform better with normalized data (in the range 0-1).</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt depth-5" id="comment-426821">
<div class="comment-container" id="li-comment-426821">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8ae915f0c4bd95c44f67e1e006379773?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8ae915f0c4bd95c44f67e1e006379773?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">slouchpie</span>
<span class="date">January 18, 2018 at 12:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426821" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, great article.<br/>
Can you please explain why it is OK to use feature_range [0. 1] as opposed to [-1, 1].<br/>
In another article (<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" rel="nofollow">https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/</a>) you said that the feature_range should be [-1, 1] in order to be the same range as the hyperbolic tan (tanh) function, which default LSTM uses. In fact, you said “This is the preferred range for the time series data.”.<br/>
I am not sure why it is OK to now use [0, 1]. Are you taking absolute value of tanh somewhere in your LSTM layer?</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-5" id="comment-426870">
<div class="comment-container" id="li-comment-426870">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 19, 2018 at 6:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426870" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The range [0,1] results in better skill.</p>
<div class="reply">
</div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423270">
<div class="comment-container" id="li-comment-423270">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1e28eaec0b8479322b2355a6eb05fe83?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1e28eaec0b8479322b2355a6eb05fe83?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">soloyuyang</span>
<span class="date">December 16, 2017 at 12:06 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423270" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,Jason,<br/>
The work you have done is wonderful. i’m interested in time series forecasting with lstm.<br/>
i have two questions.<br/>
1.In some cases in time series forecasting, especially the single series, the features are the data of previous time(t-1,t-2…). For example,only the series of pm2.5, i want to predict the value on t+1,depending on the data of t-k……t-1,t. how should i set the “time-steps” and “features”,  [samples, k+1, 1]or [samples, 1, k+1](treat the previous data as features).<br/>
2.you have mentioned “LSTM does not appear to be suitable for autoregression type problems”. did you mean that LSTM didn’t perform well in the cases like the example i mentioned in the first question(single series ,and predict t+1 with data before t).</p>
<div class="reply">
<a aria-label="Reply to soloyuyang" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423270#respond" onclick='return addComment.moveForm( "comment-423270", "423270", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423337">
<div class="comment-container" id="li-comment-423337">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 16, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423337" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post may help you with preparing the data:<br/>
<a href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="nofollow">https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/</a></p>
<p>And this post has an example:<br/>
<a href="https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/prepare-univariate-time-series-data-long-short-term-memory-networks/</a></p>
<p>Correct.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423337#respond" onclick='return addComment.moveForm( "comment-423337", "423337", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423593">
<div class="comment-container" id="li-comment-423593">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/81d980169dd303a3baa120ad73dad744?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/81d980169dd303a3baa120ad73dad744?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ahmed Mbarak</span>
<span class="date">December 17, 2017 at 1:17 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423593" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>I hope you are doing fine. </p>
<p>I am getting this error and i don’t know why. I used my own data set for Ammarilo Texas.</p>
<p>raceback (most recent call last):<br/>
  File “/Users/Ahmed/Desktop/Coding/P.prediction.py”, line 118, in<br/>
    inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
  File “/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/sklearn/preprocessing/data.py”, line 385, in inverse_transform<br/>
    X -= self.min_<br/>
ValueError: operands could not be broadcast together with shapes (3567,13) (10,) (3567,13)</p>
<div class="reply">
<a aria-label="Reply to Ahmed Mbarak" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423593#respond" onclick='return addComment.moveForm( "comment-423593", "423593", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423668">
<div class="comment-container" id="li-comment-423668">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423668" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The size of your data may not match the expectations of your model?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423668#respond" onclick='return addComment.moveForm( "comment-423668", "423668", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423642">
<div class="comment-container" id="li-comment-423642">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 17, 2017 at 11:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423642" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Currently I am working on a project and I am following your tutorials , they are great but I have some questions regarding LSTM. First is can you briefly tell what timestep is exactly and how that affects the performance of model? </p>
<p>In the above example, we used model.add(LSTM(50)), if we increase the no. LSTM cells, how that will affect the performance of model ?</p>
<p>In the above example, why did you assign shuffle = False, If we keep it true , dont you think that will increase the performance ?</p>
<p>How can I check the underfitting and overfitting of my model and result accuracy of the model ? </p>
<p>Best Regards,</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423642#respond" onclick='return addComment.moveForm( "comment-423642", "423642", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423674">
<div class="comment-container" id="li-comment-423674">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423674" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can learn more about LSTM inputs here:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<p>I recommend testing different numbers of cells on your problem to see what works best.</p>
<p>We do not want to shuffle inputs because all samples are sequential, learn more here:<br/>
<a href="https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/</a></p>
<p>More about model diagnostics here:<br/>
<a href="https://machinelearningmastery.com/diagnose-overfitting-underfitting-lstm-models/" rel="nofollow">https://machinelearningmastery.com/diagnose-overfitting-underfitting-lstm-models/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423674#respond" onclick='return addComment.moveForm( "comment-423674", "423674", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423677">
<div class="comment-container" id="li-comment-423677">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d3ca990d016251679e2fe27de19d6af2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d3ca990d016251679e2fe27de19d6af2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">TAMER A. FARRAG</span>
<span class="date">December 18, 2017 at 6:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423677" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hi Jason, I want to ask why you do normalization (scale) for data before “series to supervised operation”. for another example, this may cause denormalization errors when using n_in=2, n_out=1 .<br/>
So , It is better to do normalization after “series to supervised” operation?</p>
<div class="reply">
<a aria-label="Reply to TAMER A. FARRAG" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423677#respond" onclick='return addComment.moveForm( "comment-423677", "423677", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423710">
<div class="comment-container" id="li-comment-423710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 3:22 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I recommend normalizing before splitting the series into multiple features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423710#respond" onclick='return addComment.moveForm( "comment-423710", "423710", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423686">
<div class="comment-container" id="li-comment-423686">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 18, 2017 at 8:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423686" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Again appreciation for your blogs and thanks for the quick response but still have some queries. </p>
<p>I am working on a dataset whose size is approximately 2.5 Million and more than 10 features and this is a time series data and interval is 5 min so in my case should I use Truncated Backpropagation Through Time or just I should increase the no. of timesteps to 250-500 as mentioned in one of your blog ?</p>
<p>I have followed many of your tutorials but I did not see “dropout” anywhere but I have read at some places it dcreases the learning time ? </p>
<p>No. of timesteps tells that how many times we are going to backpropagate ? Please correct me if I am wrong.</p>
<p>One big confusion is when to use LSTM and when to Bidirectional LSTM .e.g. as I mentioned my dataset above what will be useful in my case ?</p>
<p>Best Regards,</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423686#respond" onclick='return addComment.moveForm( "comment-423686", "423686", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423715">
<div class="comment-container" id="li-comment-423715">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 3:25 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423715" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Here are some ideas on strategies for dealing with long sequences:<br/>
<a href="https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/</a></p>
<p>Here is an example of dropout with LSTMs:<br/>
<a href="https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/use-dropout-lstm-networks-time-series-forecasting/</a></p>
<p>Yes, time steps define BPTT, here’s more on BPTT:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<p>Try bidirectional and see if it lifts model skill, here is an example:<br/>
<a href="https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/" rel="nofollow">https://machinelearningmastery.com/develop-bidirectional-lstm-sequence-classification-python-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423715#respond" onclick='return addComment.moveForm( "comment-423715", "423715", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423708">
<div class="comment-container" id="li-comment-423708">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">December 18, 2017 at 2:43 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423708" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello, nice example.</p>
<p>If you want to “compress” time, before entering the LSTM, using convNet1D how would you do ?</p>
<p> thanks in advance,<br/>
Rui</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423708#respond" onclick='return addComment.moveForm( "comment-423708", "423708", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423727">
<div class="comment-container" id="li-comment-423727">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 18, 2017 at 3:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423727" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Depends on the problem. </p>
<p>Perhaps you can compress all obs from an hour, day or week into a CNN output vector to feed into an LSTM.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423727#respond" onclick='return addComment.moveForm( "comment-423727", "423727", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423771">
<div class="comment-container" id="li-comment-423771">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d308520be749c71072454bbdb3a8d151?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d308520be749c71072454bbdb3a8d151?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Stefano</span>
<span class="date">December 19, 2017 at 4:13 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423771" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
I do not understand why you swap “samples” and “timesteps” meaning. From the Keras’ FAQ, a sample is an element of the dataset. In the case of timeseries prediction, an element of the dataset is a timeseries. In this case, you have just one timeseries. Instead you have N timeseries with just 1 timestep. A timeseries with 1 timestep is not really a timeseries. Anyway, you are not even setting the stateful property and the internal state is going to be reset at each step (sample in your case). So, how does the network remember? </p>
<p>Best regards</p>
<div class="reply">
<a aria-label="Reply to Stefano" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423771#respond" onclick='return addComment.moveForm( "comment-423771", "423771", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423793">
<div class="comment-container" id="li-comment-423793">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 19, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423793" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>When we frame our time series problem as a supervised learning problem, we can choose what constitutes a sample or a time step.</p>
<p>Indeed, we need multiple timesteps in order to achieve true BPTT:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<p>LSTMs can remember across samples if internal state is not reset.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423793#respond" onclick='return addComment.moveForm( "comment-423793", "423793", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423888">
<div class="comment-container" id="li-comment-423888">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 19, 2017 at 9:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423888" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Really great blogs. I have never seen such nice blogs. But again I am disturbing you.</p>
<p>If I have a time series dataset at 5min interval which contain 250000 rows and 10 features and I want to predict one feature and If I apply Backpropagation Through Time (BPTT) using 200 timesteps:</p>
<p>1-&gt; I have to reshape into [samples, timesteps, features] = [ 250000, 200, 10] ?</p>
<p>or</p>
<p>2-&gt; I will have to split the 250000 time steps into 1250 sub-sequences of 200 time steps each and I have to reshape into [samples, timesteps, features] = [ 1250, 200, 10]  ?</p>
<p>Which approach is the right for BPTT, both of them have mentioned in your blogs and now I am totally confused between these two ?</p>
<p>And kindly mention the reshape [samples, timesteps, features] for the above example in case of Truncated Backpropagation Through Time (TBPTT).</p>
<p>Regards,</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423888#respond" onclick='return addComment.moveForm( "comment-423888", "423888", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-423926">
<div class="comment-container" id="li-comment-423926">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 19, 2017 at 3:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423926" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, here are some ideas that may help:<br/>
<a href="https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/" rel="nofollow">https://machinelearningmastery.com/handle-long-sequences-long-short-term-memory-recurrent-neural-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423926#respond" onclick='return addComment.moveForm( "comment-423926", "423926", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-423943">
<div class="comment-container" id="li-comment-423943">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f6d4d46df902c0fea1c6a3b1f03ab22d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f6d4d46df902c0fea1c6a3b1f03ab22d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.hcltech.com" rel="external nofollow">Mahesh</a></span>
<span class="date">December 19, 2017 at 5:46 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423943" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,<br/>
I am trying to Solve a problem using RNN and wish to explain that problem using this example and want to know how to apply RNN<br/>
If the test data had every other data other than PM2.5 ( Pollution) for  few days  , how  to predict pollution using the Training data and test data with RNN<br/>
thanks</p>
<div class="reply">
<a aria-label="Reply to Mahesh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423943#respond" onclick='return addComment.moveForm( "comment-423943", "423943", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424040">
<div class="comment-container" id="li-comment-424040">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424040" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I’m not sure I follow. Can you perhaps rephrase your question?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424040#respond" onclick='return addComment.moveForm( "comment-424040", "424040", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-424344">
<div class="comment-container" id="li-comment-424344">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/f6d4d46df902c0fea1c6a3b1f03ab22d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f6d4d46df902c0fea1c6a3b1f03ab22d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://www.hcltech.com" rel="external nofollow">Mahesh</a></span>
<span class="date">December 21, 2017 at 11:59 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424344" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,<br/>
Let me Rephrase my question<br/>
We have a  problem to solve  similar to example you have explained above.<br/>
Instead of explaining my problem, I would like to pose a question on this problem hoping that would provide some clues to solve my problem<br/>
You had Stated </p>
<p>    Predict the pollution for the next hour based on the weather conditions and pollution over the last 24 hours.<br/>
    Predict the pollution for the next hour as above and given the “expected” weather conditions for the next hour.</p>
<p>The first one is clear. But the second line is not clear to me<br/>
Are you predicting the pollution for next hour based on Model created using past data AND using weather conditions  like temperature, pressure for next hour ?<br/>
if yes, then i would go ahead and read more on the solution you have posted<br/>
if no, i am wondering how RNN can be used to solve a problem like<br/>
Predict the pollution , not just for next hour but , say, for next 15 hours  based on past data and with weather conditions also provided for those 15 hours</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Mahesh" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424344#respond" onclick='return addComment.moveForm( "comment-424344", "424344", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-4" id="comment-424378">
<div class="comment-container" id="li-comment-424378">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 22, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424378" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, I use the weather conditions for the next hour with the conceit that we pretend they are forecast weather condition rather than obs.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424378#respond" onclick='return addComment.moveForm( "comment-424378", "424378", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-423999">
<div class="comment-container" id="li-comment-423999">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/d7fcb7c1e3cc9a509c9fd5e9e9a4b2a5?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d7fcb7c1e3cc9a509c9fd5e9e9a4b2a5?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">jack</span>
<span class="date">December 19, 2017 at 11:58 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-423999" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi，jason<br/>
     if   i want  to  make Multivariate Time Series classification  Forecasting with LSTMs in Keras.<br/>
what should i do ? my dataset is  Y: classified variable(0/1)  , X1：numericalvariable，X2：numerical variable，X3：numerical variable，and all of these variables are timeseries.    i want  to  predict Y’s class.<br/>
                                                                          thank you very much!</p>
<div class="reply">
<a aria-label="Reply to jack" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=423999#respond" onclick='return addComment.moveForm( "comment-423999", "423999", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-424054">
<div class="comment-container" id="li-comment-424054">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424054" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can use the above tutorial as a guide?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424054#respond" onclick='return addComment.moveForm( "comment-424054", "424054", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-424022">
<div class="comment-container" id="li-comment-424022">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 20, 2017 at 3:04 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424022" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason,</p>
<p>You are not using in this blog “stateful = True”, how your network will remember the previous history ? </p>
<p>When we use property “returnSequences = True” ?</p>
<p>Please give a brief description.</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424022#respond" onclick='return addComment.moveForm( "comment-424022", "424022", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-424042">
<div class="comment-container" id="li-comment-424042">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 20, 2017 at 5:39 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424042" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This model is not rolling-forecast, so we don’t need to manually reset the cells memory as of reset_states() method, and therefore the model is not required to be “stateful = True”</p>
<p>“returnSequences = True” is necessary for LSTM multi-layer stacking (probably not only), when each previous layer should return the same vectors as it received from the previous layer. In this post model Jason used only 1 LSTM layer, so it should transmit only one flat value to Dense(1) layer.</p>
<p>Am i right?</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424042#respond" onclick='return addComment.moveForm( "comment-424042", "424042", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424058">
<div class="comment-container" id="li-comment-424058">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:49 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424058" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The LSTM is still stateful, although state is reset at the end of each batch.</p>
<p>Return sequences is appropriate when stacking LSTMs or when outputting a sequence.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424058#respond" onclick='return addComment.moveForm( "comment-424058", "424058", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424037">
<div class="comment-container" id="li-comment-424037">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/579961fdcdf73b2a961bdcfc13cdb454?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Anton</span>
<span class="date">December 20, 2017 at 5:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424037" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason! </p>
<p>Is it important (or even necessary) to include the pollution of the previous timestep as the feature of observation to predict next?</p>
<p>   var1(t-1)  var2(t-1)  var3(t-1)  var4(t-1)  var5(t-1)  var6(t-1)  \<br/>
1   0.129779   0.352941   0.245902   0.527273   0.666667   0.002290</p>
<p>   var7(t-1)  var8(t-1)   var1(t)<br/>
1   0.000000        0.0  0.148893</p>
<p>I’m asking about var1(t-1)</p>
<p>Bacause if the pollution value is a result of all the other variables in the past, so why should we feed it to the LSTM? </p>
<p>Thanks for your great work!</p>
<div class="reply">
<a aria-label="Reply to Anton" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424037#respond" onclick='return addComment.moveForm( "comment-424037", "424037", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424069">
<div class="comment-container" id="li-comment-424069">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 20, 2017 at 5:54 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424069" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Test and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424069#respond" onclick='return addComment.moveForm( "comment-424069", "424069", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424226">
<div class="comment-container" id="li-comment-424226">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/449b21082ed936027fd3464cf3087a04?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/449b21082ed936027fd3464cf3087a04?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Franzi</span>
<span class="date">December 21, 2017 at 1:07 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424226" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>thank you very much for your turorial. I am wondering if it is possible to adapt your code to the a multi-step forecasting problem.<br/>
Can I predict multiple time steps of the pollution value under consideration of the other variables?</p>
<p>Thank you for your great work!</p>
<div class="reply">
<a aria-label="Reply to Franzi" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424226#respond" onclick='return addComment.moveForm( "comment-424226", "424226", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424254">
<div class="comment-container" id="li-comment-424254">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424254" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, use this post as a template:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424254#respond" onclick='return addComment.moveForm( "comment-424254", "424254", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424263">
<div class="comment-container" id="li-comment-424263">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/4f7ab6648ccee4bb2d652f85386bd57d?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4f7ab6648ccee4bb2d652f85386bd57d?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ismael</span>
<span class="date">December 21, 2017 at 6:51 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424263" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason!</p>
<p>Thanks for your tutorial, and the time you have dedicated to make it and answer all of us. And also sorry for my bad english!</p>
<p>I’m making a prediction model for water consumption, and I have for inputs, the real aggregated consume of a pool of people of the previous day, the previous-day forecast of consume for the day, if the day is labor/no labor, day of the week, and the average anual consume and standard dev for 10 subtypes of persons.</p>
<p>For last inputs, I have 20 columns, 10 for average consume, and 10 for standard dev.</p>
<p>With this, my question is, may I link in any way average consumue and std-dev, as something similar than a tuple, as input? I’m afraid that the model misunderstand relations between them.</p>
<p>Thank you in advance!! Best regards.</p>
<div class="reply">
<a aria-label="Reply to Ismael" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424263#respond" onclick='return addComment.moveForm( "comment-424263", "424263", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424292">
<div class="comment-container" id="li-comment-424292">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 21, 2017 at 3:33 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424292" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I would recommend brainstorming many different ways of framing the problem and test each to see what works best for your data, even ensemble a few of them together.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424292#respond" onclick='return addComment.moveForm( "comment-424292", "424292", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424573">
<div class="comment-container" id="li-comment-424573">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c6f73d1feef8931c307473daea5e4edb?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c6f73d1feef8931c307473daea5e4edb?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ankit Mishra</span>
<span class="date">December 23, 2017 at 7:53 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424573" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for this blog on using RNN and using LSTM  for forecasting.<br/>
 and its very enlightning</p>
<p>i have been working on an energy dataset with dimensions(87647,7).(approx five years of data).The data is collected at every half an hour </p>
<p>.I have trained my model using a single LSTM and Dense Layer with test batchsize of 4 years and predicted and validated over a 1 year of data .</p>
<p>The test rmse is about 0.458 and train rmse is 0.058 .does this means my model badly overfits the data. i have scaled the data using minmax scaler just like your post </p>
<p>i have read your other blog of diagnosis of underfitting and overfitting and played with batchsize and epochs but it doesnt helps much . </p>
<p>can you give me insights upon how to improve my model performance ?<br/>
does LSTM regressor work well ?</p>
<div class="reply">
<a aria-label="Reply to Ankit Mishra" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424573#respond" onclick='return addComment.moveForm( "comment-424573", "424573", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424618">
<div class="comment-container" id="li-comment-424618">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 24, 2017 at 4:52 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424618" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Great work! I have some ideas for lifting model skill here that might help as a first step:<br/>
<a href="http://machinelearningmastery.com/improve-deep-learning-performance/" rel="nofollow">http://machinelearningmastery.com/improve-deep-learning-performance/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424618#respond" onclick='return addComment.moveForm( "comment-424618", "424618", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424651">
<div class="comment-container" id="li-comment-424651">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Adam</span>
<span class="date">December 24, 2017 at 12:57 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424651" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason<br/>
thank you for such a great tutorial, I implement the code and it works fine with no problem.<br/>
but I was wondering about the future I mean how we may predict the next 10 hours or  5 days after the dataset ends based on this proven model</p>
<div class="reply">
<a aria-label="Reply to Adam" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424651#respond" onclick='return addComment.moveForm( "comment-424651", "424651", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424700">
<div class="comment-container" id="li-comment-424700">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 25, 2017 at 5:22 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424700" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can call model.predict()</p>
<p>Learn more here:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424700#respond" onclick='return addComment.moveForm( "comment-424700", "424700", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424742">
<div class="comment-container" id="li-comment-424742">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ab4c68bac57227d96bb7df438b3d21ec?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ab4c68bac57227d96bb7df438b3d21ec?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sara</span>
<span class="date">December 25, 2017 at 7:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424742" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi,</p>
<p>Why have you trained both examples till the 50 epochs? because the lowest validation error on each example might happen somewhere before the 50th epoch. for example, 10th at the first one and 15th at the second one.</p>
<p>the 50th epoch might not be the best point.</p>
<div class="reply">
<a aria-label="Reply to Sara" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424742#respond" onclick='return addComment.moveForm( "comment-424742", "424742", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-424763">
<div class="comment-container" id="li-comment-424763">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 26, 2017 at 5:15 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424763" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It is just a demonstration. You can tune the model with early stopping or any way you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424763#respond" onclick='return addComment.moveForm( "comment-424763", "424763", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-424989">
<div class="comment-container" id="li-comment-424989">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b84e9852c9d41162bc1b2ef38e1c2ac4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">tom</span>
<span class="date">December 28, 2017 at 1:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424989" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
Thanks for this awesome web site where I learned a lot about deep learning, but I have a question:<br/>
How to feed a multiple data sources (several csv files) special if these files are time series to neural network?<br/>
we may have a multiple data frames, different date format with different time steps, and may be different data format…etc.</p>
<div class="reply">
<a aria-label="Reply to tom" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424989#respond" onclick='return addComment.moveForm( "comment-424989", "424989", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425010">
<div class="comment-container" id="li-comment-425010">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2017 at 5:24 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425010" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps you can use a multi-headed model, see an example on this post:<br/>
<a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="nofollow">https://machinelearningmastery.com/keras-functional-api-deep-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425010#respond" onclick='return addComment.moveForm( "comment-425010", "425010", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-424995">
<div class="comment-container" id="li-comment-424995">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ba53e1499e0096048888a5d1176e2199?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ba53e1499e0096048888a5d1176e2199?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">karim</span>
<span class="date">December 28, 2017 at 1:42 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-424995" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason<br/>
thanks for the tutorial, I did the example you did with no problems at all, thanks for the detailed description you did, but I have a question about what’s next.<br/>
I mean how to publish this model into a complete application that can make prediction with different data based on the model without repeating the whole training process all over again and again.</p>
<div class="reply">
<a aria-label="Reply to karim" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=424995#respond" onclick='return addComment.moveForm( "comment-424995", "424995", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425013">
<div class="comment-container" id="li-comment-425013">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 28, 2017 at 5:25 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425013" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have notes on finalizing the model here:<br/>
<a href="https://machinelearningmastery.com/train-final-machine-learning-model/" rel="nofollow">https://machinelearningmastery.com/train-final-machine-learning-model/</a></p>
<p>I have some ideas on moving a model to production here:<br/>
<a href="http://machinelearningmastery.com/deploy-machine-learning-model-to-production/" rel="nofollow">http://machinelearningmastery.com/deploy-machine-learning-model-to-production/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425013#respond" onclick='return addComment.moveForm( "comment-425013", "425013", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425113">
<div class="comment-container" id="li-comment-425113">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="https://github.com/rjpg" rel="external nofollow">Rui</a></span>
<span class="date">December 29, 2017 at 12:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425113" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>hello </p>
<p>when using K.set_image_dim_ordering(“th”)</p>
<p>on LSTM the input_shape(timeSteps,variables) becomes input_shape(variables, timeSteps) ?</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425113#respond" onclick='return addComment.moveForm( "comment-425113", "425113", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425127">
<div class="comment-container" id="li-comment-425127">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 29, 2017 at 2:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425127" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I don’t know, try it and see.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425127#respond" onclick='return addComment.moveForm( "comment-425127", "425127", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-425172">
<div class="comment-container" id="li-comment-425172">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1f41d9f9cb92c9e5027c0fd70ec35115?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Rui</span>
<span class="date">December 30, 2017 at 6:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425172" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I tried , In my problem I am using K.set_image_dim_ordering(“th”) the acc drop when I use input_shape(variables, timeSteps) … Looking on the internet (on completely different approaches) it looks like it does not change the dim ordering on LSTM like on ConvNets.</p>
<p>With all that I assume the dim_order is always the same in LSTM :  input_shape(timeSteps,variables)</p>
<p>for K.set_image_dim_ordering(‘th’) or K.set_image_dim_ordering(‘tf’)</p>
<div class="reply">
<a aria-label="Reply to Rui" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425172#respond" onclick='return addComment.moveForm( "comment-425172", "425172", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-425234">
<div class="comment-container" id="li-comment-425234">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 31, 2017 at 5:19 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425234" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I believe dimensional order is always the same for LSTMS and that changing dim ordering is only for images (e.g. impacting CNNs) as the name suggests.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425234#respond" onclick='return addComment.moveForm( "comment-425234", "425234", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425139">
<div class="comment-container" id="li-comment-425139">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0b7df686ab181a8100f4e44a15681a27?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0b7df686ab181a8100f4e44a15681a27?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Peter Cserna</span>
<span class="date">December 29, 2017 at 10:04 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425139" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason,</p>
<p>I am wondering if I would one hot encode the wind feature, what modifications should be done on the shape of input?<br/>
Br,</p>
<div class="reply">
<a aria-label="Reply to Peter Cserna" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425139#respond" onclick='return addComment.moveForm( "comment-425139", "425139", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425160">
<div class="comment-container" id="li-comment-425160">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 30, 2017 at 5:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425160" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The length of the binary vector would be added to the number of input features.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425160#respond" onclick='return addComment.moveForm( "comment-425160", "425160", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425283">
<div class="comment-container" id="li-comment-425283">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/84be200054559e38984655b5c4df9957?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/84be200054559e38984655b5c4df9957?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Peter K.</span>
<span class="date">December 31, 2017 at 10:01 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425283" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason, </p>
<p>Great tutorial, and outstanding book btw. I have two related conceptual questions and would appreciate your expertise:</p>
<p>1. Given that LSTM is stateful and has memory, what would be a valid reason to use multi-lag input? Is it just to force a quasi-working memory onto the LSTM or are there some other reasons?</p>
<p>2. You mention that LSTM is not ideal for autoregression. I don’t get this. Doesn’t the inbuilt memory make LSTM ideal for autoregressive time series?</p>
<p>And one more question: what’s your view on combining convolutional NN with LSTM for time series predictions, for instance to capture multi-scale patterns?</p>
<p>Happy New Year!</p>
<div class="reply">
<a aria-label="Reply to Peter K." class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425283#respond" onclick='return addComment.moveForm( "comment-425283", "425283", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425320">
<div class="comment-container" id="li-comment-425320">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 1, 2018 at 5:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425320" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Time steps are required for BPTT:<br/>
<a href="https://machinelearningmastery.com/gentle-introduction-backpropagation-time/" rel="nofollow">https://machinelearningmastery.com/gentle-introduction-backpropagation-time/</a></p>
<p>The memory in LSTMs is simple and cannot act like a stack making it poor for autoregression. Please read this post:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>I have not tried combining CNN and LSTM for time series, but I have for video classification:<br/>
<a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/" rel="nofollow">https://machinelearningmastery.com/cnn-long-short-term-memory-networks/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425320#respond" onclick='return addComment.moveForm( "comment-425320", "425320", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425536">
<div class="comment-container" id="li-comment-425536">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ac4c69e103afed2ecdc657254e3dc2a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ac4c69e103afed2ecdc657254e3dc2a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Choi.HD</span>
<span class="date">January 3, 2018 at 11:01 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425536" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello. Thank you so much. Dr.Jason </p>
<p>I have a question. How can we see a graph of a prediction, not loss graph? like 1 year after</p>
<div class="reply">
<a aria-label="Reply to Choi.HD" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425536#respond" onclick='return addComment.moveForm( "comment-425536", "425536", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425578">
<div class="comment-container" id="li-comment-425578">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:10 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425578" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You can collect predictions and plot them using matplotlib.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425578#respond" onclick='return addComment.moveForm( "comment-425578", "425578", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-425565">
<div class="comment-container" id="li-comment-425565">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0d4109194474dcbd0249c7cfe0d94477?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0d4109194474dcbd0249c7cfe0d94477?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vlad Gorlov</span>
<span class="date">January 4, 2018 at 7:53 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425565" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>As far as I can understand so far (and I am a beginner in deep learning space), LSTM cannot handle trends or seasonality (you recommend making all series stationary with differencing and seasonal adjustment first). In practical business problems trends and seasonality are the most important aspects of forecasting so separating them out leaves us very little to work with. Any thoughts on how trends and seasonality could be handled by NN’s? In principle, NN’s are good at finding patterns and these are exactly that</p>
<p>Many thanks!</p>
<div class="reply">
<a aria-label="Reply to Vlad Gorlov" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425565#respond" onclick='return addComment.moveForm( "comment-425565", "425565", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425588">
<div class="comment-container" id="li-comment-425588">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 4, 2018 at 8:18 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425588" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Exactly as you say, model the structure and remove it, then model what you have left.</p>
<p>I would encourage you to explore MLPs and only move to LSTMs if they lift model skill.</p>
<p>Also, get creative about inputs to the model.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425588#respond" onclick='return addComment.moveForm( "comment-425588", "425588", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-425644">
<div class="comment-container" id="li-comment-425644">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/0d4109194474dcbd0249c7cfe0d94477?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/0d4109194474dcbd0249c7cfe0d94477?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Vlad Gorlov</span>
<span class="date">January 5, 2018 at 2:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425644" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I keep hoping that given deep learning success across such a variety of applications it can also be used eventually to pick up these patterns just like today it can handle video. I doubt that there is something structurally intractable about trends, seasonality, lifecycles, etc. If people can do it, ML should be able to even if not just yet.</p>
<p>Was looking at your CNN LSTM tutorial. Seems like a step in that direction. Of course, there we are dealing with a sequence of patterns each of which can be interpreted by CNN and then submitted to LSTM. Time series are not quite like that, they are sequences WITH patterns. But hopefully there is an architecture to handle that too</p>
<div class="reply">
<a aria-label="Reply to Vlad Gorlov" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425644#respond" onclick='return addComment.moveForm( "comment-425644", "425644", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-4" id="comment-425669">
<div class="comment-container" id="li-comment-425669">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 5, 2018 at 5:28 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425669" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It might come down to how the series is presented to the network.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425669#respond" onclick='return addComment.moveForm( "comment-425669", "425669", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-425627">
<div class="comment-container" id="li-comment-425627">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">January 4, 2018 at 11:51 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425627" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, </p>
<p>I have question, I am new to ML so please don’t get annoyed. I am actually trying to understand why the shape of a prediction does not have the same shape of test_X, I have fed the model with my data which is originally a time series with 3 values of a parameter max,min and avg, I have converted it to a supervised problem, I would like to predict these 3 values, so I’d expect the prediction to have more than one column, but I always get one column as output and I don’t understand which of the parameter values either min, max or avg is predicting.</p>
<p>Thanks a lot,<br/>
Antonio</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425627#respond" onclick='return addComment.moveForm( "comment-425627", "425627", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-425665">
<div class="comment-container" id="li-comment-425665">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 5, 2018 at 5:26 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425665" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post for a good explanation of input shape:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425665#respond" onclick='return addComment.moveForm( "comment-425665", "425665", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-3" id="comment-425906">
<div class="comment-container" id="li-comment-425906">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">January 9, 2018 at 5:23 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425906" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks!</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425906#respond" onclick='return addComment.moveForm( "comment-425906", "425906", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425742">
<div class="comment-container" id="li-comment-425742">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/449b21082ed936027fd3464cf3087a04?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/449b21082ed936027fd3464cf3087a04?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Franziska</span>
<span class="date">January 6, 2018 at 4:17 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425742" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hay, I would like to predict the pollution data for the next 10 timesteps so t+1 till t+10, just knowing the ‘dew’, ‘temp’, ‘press’, ‘wnd_dir’, ‘wnd_spd’, ‘snow’, ‘rain’ data of timestep t.</p>
<p>Is this possible? What do I have to change in the definition of series_to Supervised function?</p>
<p>Thank a lot in advance!</p>
<div class="reply">
<a aria-label="Reply to Franziska" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425742#respond" onclick='return addComment.moveForm( "comment-425742", "425742", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425757">
<div class="comment-container" id="li-comment-425757">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 6, 2018 at 5:56 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425757" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post has an example of multi-step forecasting:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425757#respond" onclick='return addComment.moveForm( "comment-425757", "425757", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425813">
<div class="comment-container" id="li-comment-425813">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/476c7c1d10d8a0411ef6713aab71c4d4?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/476c7c1d10d8a0411ef6713aab71c4d4?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">vlad</span>
<span class="date">January 7, 2018 at 6:31 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425813" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello and a happy new year! 😀</p>
<p>I’m back with more pertinent quesions. Managed to create the ml environment, finally, and ran this example with my own data (the values are all integers so i have not used the labelencoding() feature – used here for the wind dir)</p>
<p>i’ve transformed the data so it resembles the pollution data input, trained it but when executing </p>
<p>inv_yhat = scaler.inverse_transform(inv_yhat)</p>
<p>it returns the following error:</p>
<p>Traceback (most recent call last):<br/>
  File “/Users/vlad/anaconda3/lib/python3.6/site-packages/IPython/core/interactiveshell.py”, line 2862, in run_code<br/>
    exec(code_obj, self.user_global_ns, self.user_ns)<br/>
  File “”, line 1, in<br/>
    inv_yhat = scaler.inverse_transform(inv_yhat)<br/>
  File “/Users/vlad/anaconda3/lib/python3.6/site-packages/sklearn/preprocessing/data.py”, line 385, in inverse_transform<br/>
    X -= self.min_<br/>
ValueError: operands could not be broadcast together with shapes (13,13) (7,) (13,13) </p>
<p>the data structure is 303 rows x 7 columns (excluding the date)<br/>
training data size is 289.</p>
<p>Any idea what i’m doing wrong?</p>
<div class="reply">
<a aria-label="Reply to vlad" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425813#respond" onclick='return addComment.moveForm( "comment-425813", "425813", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425844">
<div class="comment-container" id="li-comment-425844">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 8, 2018 at 5:38 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425844" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Does the example in the post work as-is?</p>
<p>Perhaps this post will help you reshape your data:<br/>
<a href="https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/" rel="nofollow">https://machinelearningmastery.com/reshape-input-data-long-short-term-memory-networks-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425844#respond" onclick='return addComment.moveForm( "comment-425844", "425844", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425898">
<div class="comment-container" id="li-comment-425898">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc63d6185199d1aaab7e8ca973f0a59f?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Nathan D.</span>
<span class="date">January 9, 2018 at 1:41 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425898" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thank you for the great post. I have a short question that hope you may address:</p>
<p>Is this fair to normalize both training and test datasets at the same time? I think in your post, the test dataset is truly the validation one so it should be ok. However, how do we normalize and re-scale the unseen test data in the future, in which they may contain values (at some features) larger/smaller than the max/min that we have seen in our training data?</p>
<div class="reply">
<a aria-label="Reply to Nathan D." class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425898#respond" onclick='return addComment.moveForm( "comment-425898", "425898", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425922">
<div class="comment-container" id="li-comment-425922">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 9, 2018 at 5:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425922" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, normalize the training dataset and use the min/max from training to normalize the test set.</p>
<p>sklearn makes this really easy with their data transform objects.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425922#respond" onclick='return addComment.moveForm( "comment-425922", "425922", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-425947">
<div class="comment-container" id="li-comment-425947">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/664383c749762301a661097bca38a9b6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/664383c749762301a661097bca38a9b6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">January 9, 2018 at 2:10 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425947" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hey Jason, great work, thank you very much for your blog, it gives me many help.</p>
<p>However, I  have a question. Your code removed the other 7 features from the test data, therefore, we need to restore them in last section to do the invert scaling. But, the code :</p>
<p>concatenate((yhat, test_X[:, -7:]), axis=1), </p>
<p>whether the test_X should be replaced by test_y in this line?  is it right? Or it does not matter</p>
<p>Thanks again and happy new year!</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425947#respond" onclick='return addComment.moveForm( "comment-425947", "425947", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-425948">
<div class="comment-container" id="li-comment-425948">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/664383c749762301a661097bca38a9b6?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/664383c749762301a661097bca38a9b6?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Leo</span>
<span class="date">January 9, 2018 at 2:15 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425948" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>In fact, I mean the test_X[:, -7:]) should be replaced by test[:, -n_features:]?</p>
<div class="reply">
<a aria-label="Reply to Leo" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425948#respond" onclick='return addComment.moveForm( "comment-425948", "425948", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-425962">
<div class="comment-container" id="li-comment-425962">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 9, 2018 at 3:20 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425962" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Did you try it, does it work?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425962#respond" onclick='return addComment.moveForm( "comment-425962", "425962", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-425961">
<div class="comment-container" id="li-comment-425961">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 9, 2018 at 3:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425961" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>It does not matter.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425961#respond" onclick='return addComment.moveForm( "comment-425961", "425961", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-425966">
<div class="comment-container" id="li-comment-425966">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5f09c68b7652ff38f87f323b97630488?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5f09c68b7652ff38f87f323b97630488?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Dan Baez</span>
<span class="date">January 9, 2018 at 3:49 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-425966" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason, thanks for the great post and I recently purchased your book. Equally helpful for learning (I’m completely new to ML techniques!). I have question which is probably straight forward but has me puzzled. </p>
<p>In the China Pollution multivariate prediction code, what exactly is required to predict and print the next time hour prediction once I have updated all other variables with new data in the pollution.csv file? I have read other posts but it is still not clear to me. So essentially, I have run all the code as provided above not problems. I now have updated pollution.csv with my own variable data but can’t copy and paste any of the code provided to obtain new predictions….what is the exact code to use so I get a pollution value to be predicted and printed? Thanks in advance!</p>
<div class="reply">
<a aria-label="Reply to Dan Baez" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=425966#respond" onclick='return addComment.moveForm( "comment-425966", "425966", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426049">
<div class="comment-container" id="li-comment-426049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question, I spell out how to make a prediction here:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426049#respond" onclick='return addComment.moveForm( "comment-426049", "426049", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426010">
<div class="comment-container" id="li-comment-426010">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ac4c69e103afed2ecdc657254e3dc2a7?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ac4c69e103afed2ecdc657254e3dc2a7?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sergio</span>
<span class="date">January 10, 2018 at 12:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426010" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dr. Jason. Thank you so much always.</p>
<p>I have a question. </p>
<p>The value of result on your air pollution example was got 0.xxx. In other words, it is new value.</p>
<p>But in my case, the results exist. For example, area, weather, person are multivariate depends on time. And the sold number of icecream is the value of result through area, weather, person etc. And then i want to predict the sold number of ice cream in real time seeing datas. How can i make this codes? I think it can be regression or mixed regression and time series. </p>
<p>Thank you!</p>
<div class="reply">
<a aria-label="Reply to Sergio" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426010#respond" onclick='return addComment.moveForm( "comment-426010", "426010", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426066">
<div class="comment-container" id="li-comment-426066">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:27 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426066" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t follow. Perhaps use the above code as a template for your problem?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426066#respond" onclick='return addComment.moveForm( "comment-426066", "426066", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426018">
<div class="comment-container" id="li-comment-426018">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e85b4c9ff4ce92bdc07a327ccd4b3e34?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Antonio</span>
<span class="date">January 10, 2018 at 1:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426018" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>HI Jason,</p>
<p>I have a question I hope you can answer, the prediction you make with your model, are a step-by-step prediction, that is you use the current pollution value to predict the next one, so their variations are not very big and I assume the predictions are very accurate because of that. My question is: how would I predict all the values of the next hour based on past data, in other words how would you predict the shape of the pollution function for the next x seconds based on past data?</p>
<div class="reply">
<a aria-label="Reply to Antonio" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426018#respond" onclick='return addComment.moveForm( "comment-426018", "426018", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426069">
<div class="comment-container" id="li-comment-426069">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 10, 2018 at 5:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426069" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This is called multi-step forecasting, see this tutorial:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426069#respond" onclick='return addComment.moveForm( "comment-426069", "426069", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426184">
<div class="comment-container" id="li-comment-426184">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/b61d4bb318ba7b15b72fb153989b0602?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b61d4bb318ba7b15b72fb153989b0602?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JB</span>
<span class="date">January 11, 2018 at 6:48 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426184" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Jason-<br/>
This example is fantastic, but I have some questions.  If I alter the model to where n_in = 12 and n_out =3, am I correct in understanding that I am essentially using the last 12 time points to forecast the next three in time?  If that is so, wouldn’t there theoretically be multiple forecasts for each point in time?  If so, how do we come up with the values that are output?</p>
<div class="reply">
<a aria-label="Reply to JB" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426184#respond" onclick='return addComment.moveForm( "comment-426184", "426184", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426247">
<div class="comment-container" id="li-comment-426247">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 12, 2018 at 5:46 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426247" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>There are multiple ways to predict 3 time steps ahead:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>
<p>I would recommend this approach:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426247#respond" onclick='return addComment.moveForm( "comment-426247", "426247", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-even depth-1" id="comment-426327">
<div class="comment-container" id="li-comment-426327">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d6842367f185049718f93092acb5cac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d6842367f185049718f93092acb5cac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maria</span>
<span class="date">January 12, 2018 at 10:44 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426327" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello, Brownlee.</p>
<p>First of all, thanks!</p>
<p>If your problem were classification, what “loss” function would you indicate?<br/>
What changes would you do in “design network” section?</p>
<p>Thanks</p>
<div class="reply">
<a aria-label="Reply to Maria" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426327#respond" onclick='return addComment.moveForm( "comment-426327", "426327", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment even depth-2" id="comment-426329">
<div class="comment-container" id="li-comment-426329">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/8d6842367f185049718f93092acb5cac?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8d6842367f185049718f93092acb5cac?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Maria</span>
<span class="date">January 12, 2018 at 11:27 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426329" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I intend to use “categorical_crossentropy” loss function.<br/>
My problem has 3 possible output classes (0,1 or 2)</p>
<p>So the last layer I put 3 neurons. Right?</p>
<p>Before all of this, i need to use LabelEncoder class and np_utils.to_categorical() method. Right?</p>
<p>My doubts is about what activation function is better to my problem.</p>
<div class="reply">
<a aria-label="Reply to Maria" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426329#respond" onclick='return addComment.moveForm( "comment-426329", "426329", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-3" id="comment-426369">
<div class="comment-container" id="li-comment-426369">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426369" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Nope, you need to use categorical_crossentropy for &gt; 2 classes.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426369#respond" onclick='return addComment.moveForm( "comment-426369", "426369", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426368">
<div class="comment-container" id="li-comment-426368">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 13, 2018 at 5:33 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426368" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>binary_crossentropy for 2 classes otherwise categorical_crossentropy.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426368#respond" onclick='return addComment.moveForm( "comment-426368", "426368", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-426404">
<div class="comment-container" id="li-comment-426404">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79da4762ef6c7f371788441c78fbf754?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79da4762ef6c7f371788441c78fbf754?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">steven</span>
<span class="date">January 13, 2018 at 9:57 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426404" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,</p>
<p>Nice example, very detail and great responses to questions. I just found this post when tried to see if LSTM outperforms normal statistical learning methods. From your answers, you alluded two important points:</p>
<p>1. LSTM is not great for autoregression, compared to MLP<br/>
2. SARIMA is better fit to this particular dataset </p>
<p>Can you elaborate the first point? Do you mean there is an AR model in the dataset, esp., pollution? I did acf and pacf on pollution (in R, not Python):</p>
<p>acf(pollution,plot=T)</p>
<p>Autocorrelations of series ‘pollution’, by lag</p>
<p>    0     1     2     3     4     5     6     7     8     9    10    11    12<br/>
1.000 0.659 0.507 0.405 0.328 0.273 0.228 0.193 0.164 0.143 0.127 0.111 0.102  …</p>
<p>pacf(pollution,plot=T)</p>
<p>Partial autocorrelations of series ‘pollution’, by lag</p>
<p>     1      2      3      4      5      6      7      8      9     10     11<br/>
 0.659  0.128  0.053  0.024  0.023  0.012  0.012  0.006  0.011  0.011  0.004 </p>
<p>From your experience, how would compare performance between MLP and linear regression (SARIMA or whatever)? I understand you don’t have an example on linear regression yet. So just keep the discussion in general.</p>
<p>Thanks,<br/>
Steven</p>
<div class="reply">
<a aria-label="Reply to steven" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426404#respond" onclick='return addComment.moveForm( "comment-426404", "426404", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-426472">
<div class="comment-container" id="li-comment-426472">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 14, 2018 at 6:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426472" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Yes, but we are modeling it as an AR: t = f(t-1, t-2, …).</p>
<p>See more here:<br/>
<a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/</a></p>
<p>Compare the methods based on skill directly. Perhaps I don’t understand your question.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426472#respond" onclick='return addComment.moveForm( "comment-426472", "426472", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment odd alt depth-3" id="comment-426538">
<div class="comment-container" id="li-comment-426538">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/79da4762ef6c7f371788441c78fbf754?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/79da4762ef6c7f371788441c78fbf754?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Steven</span>
<span class="date">January 14, 2018 at 5:26 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426538" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Ah, now I realized what you refer “AR” to is different than I referred to after reading your link. Your AR is defined as the learning method: model prediction is based on previous knowledge at t-1, t-2, etc. What I referred to was time parametric behavior in the data itself. In other words, the dataset itself can or can’t be fit into AR, ARIMA… etc models and thus if LSTM would be advantageous to these parametric modeling methods.</p>
<div class="reply">
<a aria-label="Reply to Steven" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426538#respond" onclick='return addComment.moveForm( "comment-426538", "426538", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426639">
<div class="comment-container" id="li-comment-426639">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e18a661cce6b71e948ea30b80fabac5a?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sara</span>
<span class="date">January 16, 2018 at 4:21 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426639" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for this perfect post.<br/>
For prediction, in multivariate model, after saving this model, How I should call it back?</p>
<div class="reply">
<a aria-label="Reply to Sara" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426639#respond" onclick='return addComment.moveForm( "comment-426639", "426639", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426660">
<div class="comment-container" id="li-comment-426660">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 16, 2018 at 7:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426660" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>This post will help you understand how to make predictions:<br/>
<a href="https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/" rel="nofollow">https://machinelearningmastery.com/make-predictions-long-short-term-memory-models-keras/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426660#respond" onclick='return addComment.moveForm( "comment-426660", "426660", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426710">
<div class="comment-container" id="li-comment-426710">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/90172a87012b38947acedf37dc344ab1?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/90172a87012b38947acedf37dc344ab1?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Zack Stinnett</span>
<span class="date">January 17, 2018 at 9:20 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426710" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I have been working on this and I added the accuracy metric to compile and the results were really low. Is the accuracy supposed to be low?</p>
<p>model.compile(loss=’mae’, optimizer=’adam’,metrics=[‘accuracy’])</p>
<p>Epoch 50/50<br/>
1s – loss: 0.0143 – acc: 0.0761 – val_loss: 0.0141 – val_acc: 0.0393</p>
<div class="reply">
<a aria-label="Reply to Zack Stinnett" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426710#respond" onclick='return addComment.moveForm( "comment-426710", "426710", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426732">
<div class="comment-container" id="li-comment-426732">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 17, 2018 at 10:02 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426732" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>You cannot measure accuracy for regression.</p>
<p>Learn more here:<br/>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426732#respond" onclick='return addComment.moveForm( "comment-426732", "426732", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-426761">
<div class="comment-container" id="li-comment-426761">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/10a31f375480c14f661b7be19a806da2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/10a31f375480c14f661b7be19a806da2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John</span>
<span class="date">January 18, 2018 at 12:34 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426761" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason,<br/>
Thank you for your article. I have a question about the encoding part right after the normalization. Why are you doing that since we don’t have classes as data are time series ?<br/>
Thanks in advance.</p>
<div class="reply">
<a aria-label="Reply to John" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426761#respond" onclick='return addComment.moveForm( "comment-426761", "426761", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426802">
<div class="comment-container" id="li-comment-426802">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 18, 2018 at 10:09 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426802" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Sorry, I don’t follow John, what do you mean encoding?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426802#respond" onclick='return addComment.moveForm( "comment-426802", "426802", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-426904">
<div class="comment-container" id="li-comment-426904">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/eb05e181ca9874c93fa5812b5f270959?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/eb05e181ca9874c93fa5812b5f270959?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Sacha Jacob</span>
<span class="date">January 19, 2018 at 9:29 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426904" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Dear Jason,<br/>
Thank you very much for this tutorial, it helped me a lot<br/>
I have one question: how should we model our LSTM to produce predictions for the next N days instead of just the current hour?<br/>
It makes more sense to produce a larger prediction windows for other applications such as sales forecast or weather forecast </p>
<p>Regards.</p>
<div class="reply">
<a aria-label="Reply to Sacha Jacob" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426904#respond" onclick='return addComment.moveForm( "comment-426904", "426904", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-426974">
<div class="comment-container" id="li-comment-426974">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 20, 2018 at 8:14 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-426974" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>See this post:<br/>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting-long-short-term-memory-networks-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=426974#respond" onclick='return addComment.moveForm( "comment-426974", "426974", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-427030">
<div class="comment-container" id="li-comment-427030">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/664f97f134906e1ea96eab4400dbeda2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/664f97f134906e1ea96eab4400dbeda2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Arpita</span>
<span class="date">January 21, 2018 at 2:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-427030" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Your explanation is awesome and most helpful. My problem has multiple variables (5 input variables) of previous 24 time steps as an input,where n_in=24*5=120 and  the output (forecast) only one variable with next 24 time step, where n_out=24*1=24. How can I solve this problem. Please help me.</p>
<div class="reply">
<a aria-label="Reply to Arpita" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=427030#respond" onclick='return addComment.moveForm( "comment-427030", "427030", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-427061">
<div class="comment-container" id="li-comment-427061">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/10a31f375480c14f661b7be19a806da2?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/10a31f375480c14f661b7be19a806da2?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">John</span>
<span class="date">January 21, 2018 at 10:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-427061" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hello Jason. I am working on a project where i try to predict the evolution of a stock index. I used your function series_to_supervised to have one feature (which is obtained by offseting the stock index by one step). I trained my model on the data i have until. Then i tried to predict tomorrow index by using the model. Then i trained the model on the previous data plus the new information predicted for tomorrow in order to have a model that will be used to predict the stock index of day 2. But the problem is, besides it takes a lot of time, the result isn’t good. Do you have any idea how i can improve my algorithm ? Thank you</p>
<div class="reply">
<a aria-label="Reply to John" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=427061#respond" onclick='return addComment.moveForm( "comment-427061", "427061", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor even depth-2" id="comment-427084">
<div class="comment-container" id="li-comment-427084">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">January 22, 2018 at 4:40 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/#comment-427084" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Perhaps try an MLP instead? LSTMs are generally poor at autoregression type problems.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/?replytocom=427084#respond" onclick='return addComment.moveForm( "comment-427084", "427084", "respond", "4195" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/multivariate-time-series-forecasting-lstms-keras/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4195"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="fe4d49098a"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="78"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-29"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Sequence Prediction</h3>
<p>Cut through the math and research papers.<br/>
Discover 4 Models, 6 Architectures, and 14 Tutorials.</p>
<p><a href="/lstms-with-python/">Get Started With LSTMs in Python Today!</a><br/>
<a href="/lstms-with-python/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/07/Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>