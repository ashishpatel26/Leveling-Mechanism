<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="utf-8"/>
<title>How to Develop a Word Embedding Model for Predicting Movie Review Sentiment - Machine Learning Mastery</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://machinelearningmastery.com/xmlrpc.php" rel="pingback"/>
<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport"/>
<!-- This site is optimized with the Yoast SEO plugin v6.1.1 - https://yoa.st/1yg?utm_content=6.1.1 -->
<link href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" rel="canonical"/>
<link href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/" rel="publisher"/>
<meta content="en_US" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="How to Develop a Word Embedding Model for Predicting Movie Review Sentiment - Machine Learning Mastery" property="og:title"/>
<meta content="Word embeddings are a technique for representing text where different words with similar meaning have a similar real-valued vector representation. They are a key breakthrough that has led to great performance of neural network models on a suite of challenging natural language processing problems. In this tutorial, you will discover how to develop word embedding …" property="og:description"/>
<meta content="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" property="og:url"/>
<meta content="Machine Learning Mastery" property="og:site_name"/>
<meta content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/" property="article:publisher"/>
<meta content="Natural Language Processing" property="article:section"/>
<meta content="2017-10-30T05:00:39+11:00" property="article:published_time"/>
<meta content="2017-11-21T11:04:12+11:00" property="article:modified_time"/>
<meta content="2017-11-21T11:04:12+11:00" property="og:updated_time"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" property="og:image"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" property="og:image:secure_url"/>
<meta content="800" property="og:image:width"/>
<meta content="537" property="og:image:height"/>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"WebSite","@id":"#website","url":"https:\/\/machinelearningmastery.com\/","name":"Machine Learning Mastery","potentialAction":{"@type":"SearchAction","target":"https:\/\/machinelearningmastery.com\/?s={search_term_string}","query-input":"required name=search_term_string"}}</script>
<script type="application/ld+json">{"@context":"http:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/develop-word-embedding-model-predicting-movie-review-sentiment\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->
<link href="//cdnjs.cloudflare.com" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//s.w.org" rel="dns-prefetch"/>
<link href="https://feeds.feedburner.com/MachineLearningMastery" rel="alternate" title="Machine Learning Mastery » Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/comments/feed/" rel="alternate" title="Machine Learning Mastery » Comments Feed" type="application/rss+xml"/>
<link href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/feed/" rel="alternate" title="Machine Learning Mastery » How to Develop a Word Embedding Model for Predicting Movie Review Sentiment Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.2"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56794,8205,9794,65039],[55358,56794,8203,9794,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" id="crayon-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta" id="crayon-theme-classic-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" id="crayon-font-monaco-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.9.2" id="contact-form-7-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-font-awesome-css" media="all" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Open+Sans&amp;ver=4.9.2" id="apss-font-opensans-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/css/frontend.css?ver=4.2.2.0.iis7_supports_permalinks" id="apss-frontend-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/integrations/testimonials/css/testimonials.css?ver=4.9.2" id="woo-testimonials-css-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/style.css?ver=5.9.21" id="theme-stylesheet-css" media="all" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/third-party.min.js?ver=4.9.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/modernizr.min.js?ver=2.6.2" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/includes/js/general.min.js?ver=4.9.2" type="text/javascript"></script>
<link href="https://machinelearningmastery.com/wp-json/" rel="https://api.w.org/"/>
<link href="https://machinelearningmastery.com/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="https://machinelearningmastery.com/?p=4401" rel="shortlink"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F" rel="alternate" type="application/json+oembed"/>
<link href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F&amp;format=xml" rel="alternate" type="text/xml+oembed"/>
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '296263687421164');
fbq('track', "PageView");</script>
<noscript><img height="1" src="https://www.facebook.com/tr?id=296263687421164&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/></noscript>
<!-- End Facebook Pixel Code -->
<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em Helvetica Neue, Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:300 13px/1em Helvetica Neue, Helvetica, sans-serif;color:#999999;}
body, p { font:300 14px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:300 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:300 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:300 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:300 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:300 13px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
.widget {font:300 13px/1.5em &quot;Helvetica Neue&quot;, Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:300 14px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#666666; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#666666;}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:300 12px/1.6em Helvetica Neue, Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:300 13px/1.4em Helvetica Neue, Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>
<!-- Woo Shortcodes CSS -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/functions/css/shortcodes.css" rel="stylesheet" type="text/css"/>
<!-- Custom Stylesheet -->
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/custom.css" rel="stylesheet" type="text/css"/>
<!-- Theme version -->
<meta content="Canvas 5.9.21" name="generator"/>
<meta content="WooFramework 6.2.9" name="generator"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" rel="icon" sizes="32x32"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" rel="icon" sizes="192x192"/>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png" rel="apple-touch-icon-precomposed"/>
<meta content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png" name="msapplication-TileImage"/>
</head>
<body class="post-template-default single single-post postid-4401 single-format-standard chrome alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">
<div id="inner-wrapper">
<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>
<header class="col-full" id="header">
<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img alt="Machine Learning Mastery" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/MachineLearningMastery.png"/></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
<div class="header-widget">
<div class="widget widget_text" id="text-3"> <div class="textwidget"><br/>
<div style="font-size:12pt;">
<a href="/start-here"><strong>Start Here</strong></a>
     
<a href="/blog">Blog</a>
     
<a href="/products">Books</a>
     
<a href="/about">About</a>
     
<a href="/contact">Contact</a>
</div></div>
</div><div class="widget widget_search" id="search-3"><div class="search_main">
<form action="https://machinelearningmastery.com/" class="searchform" method="get">
<input class="field s" name="s" onblur="if (this.value == '') {this.value = 'Search...';}" onfocus="if (this.value == 'Search...') {this.value = '';}" type="text" value="Search..."/>
<button class="fa fa-search submit" name="submit" type="submit" value="Search"></button>
</form>
<div class="fix"></div>
</div></div><div class="widget widget_text" id="text-44"> <div class="textwidget"><p>Need help with Deep Learning for Text? <a href="https://machinelearningmastery.lpages.co/dlfnlp-mini-course/">Take the FREE Mini-Course</a></p>
</div>
</div> </div>
</header>
<nav class="col-full" id="navigation" role="navigation">
<section class="menus">
<a class="nav-home" href="https://machinelearningmastery.com"><span>Home</span></a>
<h3>Empty Menu</h3> <div class="side-nav">
</div><!-- /#side-nav -->
</section><!-- /.menus -->
<a class="nav-close" href="#top"><span>Return to Content</span></a>
</nav>
<!-- #content Starts -->
<div class="col-full" id="content">
<div id="main-sidebar-container">
<!-- #main Starts -->
<section id="main">
<article class="post-4401 post type-post status-publish format-standard has-post-thumbnail hentry category-natural-language-processing">
<header>
<h1 class="title entry-title">How to Develop a Word Embedding Model for Predicting Movie Review Sentiment</h1> </header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" rel="author" title="Posts by Jason Brownlee">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2017-10-30T05:00:39+1100">October 30, 2017</abbr> <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/natural-language-processing/" title="View all items in Natural Language Processing">Natural Language Processing</a></span> </div>
<section class="entry">
<div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/&amp;summary=Word+embeddings+are+a+technique+for+representing+text+where+different+words+with+similar+meaning+hav..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/&amp;summary=Word+embeddings+are+a+technique+for+representing+text+where+different+words+with+similar+meaning+hav...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div><p>Word embeddings are a technique for representing text where different words with similar meaning have a similar real-valued vector representation.</p>
<p>They are a key breakthrough that has led to great performance of neural network models on a suite of challenging natural language processing problems.</p>
<p>In this tutorial, you will discover how to develop word embedding models for neural networks to classify movie reviews.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to prepare movie review text data for classification with deep learning methods.</li>
<li>How to learn a word embedding as part of fitting a deep learning model.</li>
<li>How to learn a standalone word embedding and how to use a pre-trained embedding in a neural network model.</li>
</ul>
<p>Let’s get started.</p>
<div class="wp-caption aligncenter" id="attachment_4402" style="max-width: 810px"><img alt="How to Develop a Word Embedding Model for Predicting Movie Review Sentiment" class="size-full wp-image-4402" height="537" sizes="(max-width: 800px) 100vw, 800px" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment.jpg 800w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment-300x201.jpg 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/10/How-to-Develop-a-Word-Embedding-Model-for-Predicting-Movie-Review-Sentiment-768x516.jpg 768w" width="800"/><p class="wp-caption-text">How to Develop a Word Embedding Model for Predicting Movie Review Sentiment<br/>Photo by <a href="https://www.flickr.com/photos/fuzzyblue/6351564408/">Katrina Br*?#*!@nd</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into 5 parts; they are:</p>
<ol>
<li>Movie Review Dataset</li>
<li>Data Preparation</li>
<li>Train Embedding Layer</li>
<li>Train word2vec Embedding</li>
<li>Use Pre-trained Embedding</li>
</ol>
<!-- Start shortcoder --><p></p><div class="woo-sc-hr"></div>
<center>
<h3>Need help with Deep Learning for Text Data?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" rel="noopener" style="background: #ffce0a; color: #ffffff; text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" target="_blank">Start Your FREE Crash-Course Now</a><script data-config="%7B%7D" data-leadbox="144855173f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/144855173f72a2%3A164f8be4f346dc/5655638436741120/" src="https://machinelearningmastery.lpages.co/leadbox-1509466860.js" type="text/javascript"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div><!-- End shortcoder v4.1.5-->
<h2>1. Movie Review Dataset</h2>
<p>The Movie Review Data is a collection of movie reviews retrieved from the imdb.com website in the early 2000s by Bo Pang and Lillian Lee. The reviews were collected and made available as part of their research on natural language processing.</p>
<p>The reviews were originally released in 2002, but an updated and cleaned up version were released in 2004, referred to as “v2.0”.</p>
<p>The dataset is comprised of 1,000 positive and 1,000 negative movie reviews drawn from an archive of the rec.arts.movies.reviews newsgroup hosted at <a href="http://reviews.imdb.com/Reviews">imdb.com</a>. The authors refer to this dataset as the “polarity dataset.”</p>
<blockquote><p>Our data contains 1000 positive and 1000 negative reviews all written before 2002, with a cap of 20 reviews per author (312 authors total) per category. We refer to this corpus as the polarity dataset.</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>The data has been cleaned up somewhat, for example:</p>
<ul>
<li>The dataset is comprised of only English reviews.</li>
<li>All text has been converted to lowercase.</li>
<li>There is white space around punctuation like periods, commas, and brackets.</li>
<li>Text has been split into one sentence per line.</li>
</ul>
<p>The data has been used for a few related natural language processing tasks. For classification, the performance of machine learning models (such as Support Vector Machines) on the data is in the range of high 70% to low 80% (e.g. 78%-82%).</p>
<p>More sophisticated data preparation may see results as high as 86% with 10-fold cross validation. This gives us a ballpark of low-to-mid 80s if we were looking to use this dataset in experiments of modern methods.</p>
<blockquote><p>… depending on choice of downstream polarity classifier, we can achieve highly statistically significant improvement (from 82.8% to 86.4%)</p></blockquote>
<p>— <a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</p>
<p>You can download the dataset from here:</p>
<ul>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (review_polarity.tar.gz, 3MB)</li>
</ul>
<p>After unzipping the file, you will have a directory called “<em>txt_sentoken</em>” with two sub-directories containing the text “<em>neg</em>” and “<em>pos</em>” for negative and positive reviews. Reviews are stored one per file with a naming convention cv000 to cv999 for each neg and pos.</p>
<p>Next, let’s look at loading and preparing the text data.</p>
<h2>2. Data Preparation</h2>
<p>In this section, we will look at 3 things:</p>
<ol>
<li>Separation of data into training and test sets.</li>
<li>Loading and cleaning the data to remove punctuation and numbers.</li>
<li>Defining a vocabulary of preferred words.</li>
</ol>
<h3>Split into Train and Test Sets</h3>
<p>We are pretending that we are developing a system that can predict the sentiment of a textual movie review as either positive or negative.</p>
<p>This means that after the model is developed, we will need to make predictions on new textual reviews. This will require all of the same data preparation to be performed on those new reviews as is performed on the training data for the model.</p>
<p>We will ensure that this constraint is built into the evaluation of our models by splitting the training and test datasets prior to any data preparation. This means that any knowledge in the data in the test set that could help us better prepare the data (e.g. the words used) are unavailable in the preparation of data used for training the model.</p>
<p>That being said, we will use the last 100 positive reviews and the last 100 negative reviews as a test set (100 reviews) and the remaining 1,800 reviews as the training dataset.</p>
<p>This is a 90% train, 10% split of the data.</p>
<p>The split can be imposed easily by using the filenames of the reviews where reviews named 000 to 899 are for training data and reviews named 900 onwards are for test.</p>
<h3>Loading and Cleaning Reviews</h3>
<p>The text data is already pretty clean; not much preparation is required.</p>
<p>Without getting bogged down too much in the details, we will prepare the data using the following way:</p>
<ul>
<li>Split tokens on white space.</li>
<li>Remove all punctuation from words.</li>
<li>Remove all words that are not purely comprised of alphabetical characters.</li>
<li>Remove all words that are known stop words.</li>
<li>Remove all words that have a length &lt;= 1 character.</li>
</ul>
<p>We can put all of these steps into a function called <em>clean_doc()</em> that takes as an argument the raw text loaded from a file and returns a list of cleaned tokens. We can also define a function <em>load_doc()</em> that loads a document from file ready for use with the <em>clean_doc()</em> function.</p>
<p>An example of cleaning the first positive review is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65864236972113378915" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from nltk.corpus import stopwords
import string

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', string.punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load the document
filename = 'txt_sentoken/pos/cv000_29590.txt'
text = load_doc(filename)
tokens = clean_doc(text)
print(tokens)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65864236972113378915-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-2">2</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-4">4</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-6">6</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-8">8</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-10">10</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-12">12</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-14">14</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-16">16</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-18">18</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-20">20</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-22">22</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-24">24</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-26">26</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-28">28</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-30">30</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-32">32</div><div class="crayon-num" data-line="crayon-5a65864236972113378915-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236972113378915-34">34</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65864236972113378915-1"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-e">stopwords</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-2"><span class="crayon-e">import </span><span class="crayon-t">string</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-3"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-4"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-5"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-6"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-7"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-8"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-9"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-10"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-11"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-12"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-13"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-14"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-15"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-16"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-17"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-18"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-19"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">.</span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-20"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-21"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-23"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-24"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-25"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-26"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-30"><span class="crayon-p"># load the document</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-31"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'txt_sentoken/pos/cv000_29590.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-32"><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236972113378915-33"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236972113378915-34"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0023 seconds] -->
<p>Running the example prints a long list of clean tokens.</p>
<p>There are many more cleaning steps we may want to explore and I leave them as further exercises.</p>
<p>I’d love to see what you can come up with.<br/>
Post your approaches and findings in the comments at the end.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423697f149806053" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423697f149806053-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423697f149806053-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423697f149806053-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423697f149806053-2">'creepy', 'place', 'even', 'acting', 'hell', 'solid', 'dreamy', 'depp', 'turning', 'typically', 'strong', 'performance', 'deftly', 'handling', 'british', 'accent', 'ians', 'holm', 'joe', 'goulds', 'secret', 'richardson', 'dalmatians', 'log', 'great', 'supporting', 'roles', 'big', 'surprise', 'graham', 'cringed', 'first', 'time', 'opened', 'mouth', 'imagining', 'attempt', 'irish', 'accent', 'actually', 'wasnt', 'half', 'bad', 'film', 'however', 'good', 'strong', 'violencegore', 'sexuality', 'language', 'drug', 'content']</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h3>Define a Vocabulary</h3>
<p>It is important to define a vocabulary of known words when using a bag-of-words or embedding model.</p>
<p>The more words, the larger the representation of documents, therefore it is important to constrain the words to only those believed to be predictive. This is difficult to know beforehand and often it is important to test different hypotheses about how to construct a useful vocabulary.</p>
<p>We have already seen how we can remove punctuation and numbers from the vocabulary in the previous section. We can repeat this for all documents and build a set of all known words.</p>
<p>We can develop a vocabulary as a Counter, which is a dictionary mapping of words and their counts that allow us to easily update and query.</p>
<p>Each document can be added to the counter (a new function called <em>add_doc_to_vocab()</em>) and we can step over all of the reviews in the negative directory and then the positive directory (a new function called <em>process_docs()</em>).</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65864236983565833262" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from collections import Counter
from nltk.corpus import stopwords

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# remove remaining tokens that are not alphabetic
	tokens = [word for word in tokens if word.isalpha()]
	# filter out stop words
	stop_words = set(stopwords.words('english'))
	tokens = [w for w in tokens if not w in stop_words]
	# filter out short tokens
	tokens = [word for word in tokens if len(word) &gt; 1]
	return tokens

# load doc and add to vocab
def add_doc_to_vocab(filename, vocab):
	# load doc
	doc = load_doc(filename)
	# clean doc
	tokens = clean_doc(doc)
	# update counts
	vocab.update(tokens)

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# add doc to vocab
		add_doc_to_vocab(path, vocab)

# define vocab
vocab = Counter()
# add all docs to vocab
process_docs('txt_sentoken/neg', vocab, True)
process_docs('txt_sentoken/pos', vocab, True)
# print the size of the vocab
print(len(vocab))
# print the top words in the vocab
print(vocab.most_common(50))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65864236983565833262-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-2">2</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-4">4</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-6">6</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-8">8</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-10">10</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-12">12</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-14">14</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-16">16</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-18">18</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-20">20</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-22">22</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-24">24</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-26">26</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-28">28</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-30">30</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-32">32</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-34">34</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-36">36</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-38">38</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-40">40</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-42">42</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-44">44</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-46">46</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-48">48</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-50">50</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-52">52</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-54">54</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-56">56</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-58">58</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-60">60</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236983565833262-62">62</div><div class="crayon-num" data-line="crayon-5a65864236983565833262-63">63</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65864236983565833262-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-3"><span class="crayon-e">from </span><span class="crayon-e">collections </span><span class="crayon-e">import </span><span class="crayon-e">Counter</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-4"><span class="crayon-e">from </span><span class="crayon-v">nltk</span><span class="crayon-sy">.</span><span class="crayon-e">corpus </span><span class="crayon-e">import </span><span class="crayon-v">stopwords</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-5"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-6"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-7"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-8"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-9"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-10"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-11"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-12"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-13"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-15"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-16"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-17"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-18"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-19"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-20"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-21"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-22"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-23"><span class="crayon-h"> </span><span class="crayon-p"># remove remaining tokens that are not alphabetic</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">.</span><span class="crayon-e">isalpha</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out stop words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-26"><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">stopwords</span><span class="crayon-sy">.</span><span class="crayon-e">words</span><span class="crayon-sy">(</span><span class="crayon-s">'english'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-27"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">stop_words</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-28"><span class="crayon-h"> </span><span class="crayon-p"># filter out short tokens</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-30"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-31"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-32"><span class="crayon-p"># load doc and add to vocab</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-33"><span class="crayon-e">def </span><span class="crayon-e">add_doc_to_vocab</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-34"><span class="crayon-h"> </span><span class="crayon-p"># load doc</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-35"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-36"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-37"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-38"><span class="crayon-h"> </span><span class="crayon-p"># update counts</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-39"><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-40"> </div><div class="crayon-line" id="crayon-5a65864236983565833262-41"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-42"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-43"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-44"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-45"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-46"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-47"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-48"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-49"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-50"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-51"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-52"><span class="crayon-h"> </span><span class="crayon-p"># add doc to vocab</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-53"><span class="crayon-h"> </span><span class="crayon-e">add_doc_to_vocab</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-54"> </div><div class="crayon-line" id="crayon-5a65864236983565833262-55"><span class="crayon-p"># define vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-56"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Counter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-57"><span class="crayon-p"># add all docs to vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-58"><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-59"><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-60"><span class="crayon-p"># print the size of the vocab</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-61"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236983565833262-62"><span class="crayon-p"># print the top words in the vocab</span></div><div class="crayon-line" id="crayon-5a65864236983565833262-63"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">most_common</span><span class="crayon-sy">(</span><span class="crayon-cn">50</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>Running the example shows that we have a vocabulary of 44,276 words.</p>
<p>We also can see a sample of the top 50 most used words in the movie reviews.</p>
<p>Note, that this vocabulary was constructed based on only those reviews in the training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65864236987832259202" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
44276
[('film', 7983), ('one', 4946), ('movie', 4826), ('like', 3201), ('even', 2262), ('good', 2080), ('time', 2041), ('story', 1907), ('films', 1873), ('would', 1844), ('much', 1824), ('also', 1757), ('characters', 1735), ('get', 1724), ('character', 1703), ('two', 1643), ('first', 1588), ('see', 1557), ('way', 1515), ('well', 1511), ('make', 1418), ('really', 1407), ('little', 1351), ('life', 1334), ('plot', 1288), ('people', 1269), ('could', 1248), ('bad', 1248), ('scene', 1241), ('movies', 1238), ('never', 1201), ('best', 1179), ('new', 1140), ('scenes', 1135), ('man', 1131), ('many', 1130), ('doesnt', 1118), ('know', 1092), ('dont', 1086), ('hes', 1024), ('great', 1014), ('another', 992), ('action', 985), ('love', 977), ('us', 967), ('go', 952), ('director', 948), ('end', 946), ('something', 945), ('still', 936)]</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65864236987832259202-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236987832259202-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65864236987832259202-1">44276</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236987832259202-2">[('film', 7983), ('one', 4946), ('movie', 4826), ('like', 3201), ('even', 2262), ('good', 2080), ('time', 2041), ('story', 1907), ('films', 1873), ('would', 1844), ('much', 1824), ('also', 1757), ('characters', 1735), ('get', 1724), ('character', 1703), ('two', 1643), ('first', 1588), ('see', 1557), ('way', 1515), ('well', 1511), ('make', 1418), ('really', 1407), ('little', 1351), ('life', 1334), ('plot', 1288), ('people', 1269), ('could', 1248), ('bad', 1248), ('scene', 1241), ('movies', 1238), ('never', 1201), ('best', 1179), ('new', 1140), ('scenes', 1135), ('man', 1131), ('many', 1130), ('doesnt', 1118), ('know', 1092), ('dont', 1086), ('hes', 1024), ('great', 1014), ('another', 992), ('action', 985), ('love', 977), ('us', 967), ('go', 952), ('director', 948), ('end', 946), ('something', 945), ('still', 936)]</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We can step through the vocabulary and remove all words that have a low occurrence, such as only being used once or twice in all reviews.</p>
<p>For example, the following snippet will retrieve only the tokens that of appears 2 or more times in all reviews.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423698a514330334" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# keep tokens with a min occurrence
min_occurane = 2
tokens = [k for k,c in vocab.items() if c &gt;= min_occurane]
print(len(tokens))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423698a514330334-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698a514330334-2">2</div><div class="crayon-num" data-line="crayon-5a6586423698a514330334-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698a514330334-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423698a514330334-1"><span class="crayon-p"># keep tokens with a min occurrence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698a514330334-2"><span class="crayon-v">min_occurane</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5a6586423698a514330334-3"><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">k</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-v">min_occurane</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698a514330334-4"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Running the above example with this addition shows that the vocabulary size drops by a little more than half its size from 44,276 to 25,767 words.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423698c647571456" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
25767</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423698c647571456-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423698c647571456-1">25767</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Finally, the vocabulary can be saved to a new file called <em>vocab.txt</em> that we can later load and use to filter movie reviews prior to encoding them for modeling. We define a new function called <em>save_list()</em> that saves the vocabulary to file, with one word per file.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423698f792628190" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# save list to file
def save_list(lines, filename):
	# convert lines to a single blob of text
	data = '\n'.join(lines)
	# open file
	file = open(filename, 'w')
	# write text
	file.write(data)
	# close file
	file.close()

# save tokens to a vocabulary file
save_list(tokens, 'vocab.txt')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423698f792628190-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-2">2</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-4">4</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-6">6</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-8">8</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-10">10</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423698f792628190-12">12</div><div class="crayon-num" data-line="crayon-5a6586423698f792628190-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423698f792628190-1"><span class="crayon-p"># save list to file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-2"><span class="crayon-e">def </span><span class="crayon-e">save_list</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-3"><span class="crayon-h"> </span><span class="crayon-p"># convert lines to a single blob of text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-4"><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'\n'</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">lines</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-5"><span class="crayon-h"> </span><span class="crayon-p"># open file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-7"><span class="crayon-h"> </span><span class="crayon-p"># write text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-9"><span class="crayon-h"> </span><span class="crayon-p"># close file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-10"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-11"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423698f792628190-12"><span class="crayon-p"># save tokens to a vocabulary file</span></div><div class="crayon-line" id="crayon-5a6586423698f792628190-13"><span class="crayon-e">save_list</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Running the min occurrence filter on the vocabulary and saving it to file, you should now have a new file called <em>vocab.txt</em> with only the words we are interested in.</p>
<p>The order of words in your file will differ, but should look something like the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65864236991071151461" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
aberdeen
dupe
burt
libido
hamlet
arlene
available
corners
web
columbia
...</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65864236991071151461-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236991071151461-2">2</div><div class="crayon-num" data-line="crayon-5a65864236991071151461-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236991071151461-4">4</div><div class="crayon-num" data-line="crayon-5a65864236991071151461-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236991071151461-6">6</div><div class="crayon-num" data-line="crayon-5a65864236991071151461-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236991071151461-8">8</div><div class="crayon-num" data-line="crayon-5a65864236991071151461-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236991071151461-10">10</div><div class="crayon-num" data-line="crayon-5a65864236991071151461-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65864236991071151461-1">aberdeen</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236991071151461-2">dupe</div><div class="crayon-line" id="crayon-5a65864236991071151461-3">burt</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236991071151461-4">libido</div><div class="crayon-line" id="crayon-5a65864236991071151461-5">hamlet</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236991071151461-6">arlene</div><div class="crayon-line" id="crayon-5a65864236991071151461-7">available</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236991071151461-8">corners</div><div class="crayon-line" id="crayon-5a65864236991071151461-9">web</div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236991071151461-10">columbia</div><div class="crayon-line" id="crayon-5a65864236991071151461-11">...</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We are now ready to look at learning features from the reviews.</p>
<h2>3. Train Embedding Layer</h2>
<p>In this section, we will learn a word embedding while training a neural network on the classification problem.</p>
<p>A word embedding is a way of representing text where each word in the vocabulary is represented by a real valued vector in a high-dimensional space. The vectors are learned in such a way that words that have similar meanings will have similar representation in the vector space (close in the vector space). This is a more expressive representation for text than more classical methods like bag-of-words, where relationships between words or tokens are ignored, or forced in bigram and trigram approaches.</p>
<p>The real valued vector representation for words can be learned while training the neural network. We can do this in the Keras deep learning library using the <a href="https://keras.io/layers/embeddings/">Embedding layer</a>.</p>
<p>The first step is to load the vocabulary. We will use it to filter out words from movie reviews that we are not interested in.</p>
<p>If you have worked through the previous section, you should have a local file called ‘<em>vocab.txt</em>‘ with one word per line. We can load that file and build a vocabulary as a set for checking the validity of tokens.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a65864236995798832161" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a65864236995798832161-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-2">2</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-4">4</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-6">6</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-8">8</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-10">10</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-12">12</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a65864236995798832161-14">14</div><div class="crayon-num" data-line="crayon-5a65864236995798832161-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a65864236995798832161-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-10"> </div><div class="crayon-line" id="crayon-5a65864236995798832161-11"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-12"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-13"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a65864236995798832161-14"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a65864236995798832161-15"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Next, we need to load all of the training data movie reviews. For that we can adapt the <em>process_docs()</em> from the previous section to load the documents, clean them, and return them as a list of strings, with one document per string. We want each document to be a string for easy encoding as a sequence of integers later.</p>
<p>Cleaning the document involves splitting each review based on white space, removing punctuation, and then filtering out all tokens not in the vocabulary.</p>
<p>The updated <em>clean_doc()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423699a658581867" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423699a658581867-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699a658581867-2">2</div><div class="crayon-num" data-line="crayon-5a6586423699a658581867-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699a658581867-4">4</div><div class="crayon-num" data-line="crayon-5a6586423699a658581867-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699a658581867-6">6</div><div class="crayon-num" data-line="crayon-5a6586423699a658581867-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699a658581867-8">8</div><div class="crayon-num" data-line="crayon-5a6586423699a658581867-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699a658581867-10">10</div><div class="crayon-num" data-line="crayon-5a6586423699a658581867-11">11</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423699a658581867-1"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699a658581867-2"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586423699a658581867-3"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699a658581867-4"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699a658581867-5"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699a658581867-6"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699a658581867-7"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699a658581867-8"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5a6586423699a658581867-9"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699a658581867-10"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699a658581867-11"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>The updated <em>process_docs()</em> can then call the <em>clean_doc()</em> for each document on the ‘<em>pos</em>‘ and ‘<em>neg</em>‘ directories that are in our training dataset.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a6586423699e017838273" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a6586423699e017838273-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-2">2</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-4">4</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-6">6</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-8">8</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-10">10</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-12">12</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-14">14</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-16">16</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-18">18</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-20">20</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-22">22</div><div class="crayon-num" data-line="crayon-5a6586423699e017838273-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a6586423699e017838273-24">24</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a6586423699e017838273-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-3"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-13"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-15"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-16"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-17"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-18"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-19"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-20"> </div><div class="crayon-line" id="crayon-5a6586423699e017838273-21"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-22"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a6586423699e017838273-23"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a6586423699e017838273-24"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>The next step is to encode each document as a sequence of integers.</p>
<p>The Keras Embedding layer requires integer inputs where each integer maps to a single token that has a specific real-valued vector representation within the embedding. These vectors are random at the beginning of training, but during training become meaningful to the network.</p>
<p>We can encode the training documents as sequences of integers using the <a href="https://keras.io/preprocessing/text/#tokenizer">Tokenizer</a> class in the Keras API.</p>
<p>First, we must construct an instance of the class then train it on all documents in the training dataset. In this case, it develops a vocabulary of all tokens in the training dataset and develops a consistent mapping from words in the vocabulary to unique integers. We could just as easily develop this mapping ourselves using our vocabulary file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369a4184966789" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369a4184966789-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369a4184966789-2">2</div><div class="crayon-num" data-line="crayon-5a658642369a4184966789-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369a4184966789-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369a4184966789-1"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369a4184966789-2"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369a4184966789-3"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369a4184966789-4"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Now that the mapping of words to integers has been prepared, we can use it to encode the reviews in the training dataset. We can do that by calling the <em>texts_to_sequences()</em> function on the Tokenizer.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369a8248243727" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369a8248243727-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369a8248243727-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369a8248243727-1"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369a8248243727-2"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need to ensure that all documents have the same length.</p>
<p>This is a requirement of Keras for efficient computation. We could truncate reviews to the smallest size or zero-pad (pad with the value ‘0’) reviews to the maximum length, or some hybrid. In this case, we will pad all reviews to the length of the longest review in the training dataset.</p>
<p>First, we can find the longest review using the <em>max()</em> function on the training dataset and take its length. We can then call the Keras function <em>pad_sequences()</em> to pad the sequences to the maximum length by adding 0 values on the end.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369aa239778103" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369aa239778103-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369aa239778103-2">2</div><div class="crayon-num" data-line="crayon-5a658642369aa239778103-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369aa239778103-1"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369aa239778103-2"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369aa239778103-3"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Finally, we can define the class labels for the training dataset, needed to fit the supervised neural network model to predict the sentiment of reviews.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369ad907573009" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369ad907573009-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ad907573009-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369ad907573009-1"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ad907573009-2"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>We can then encode and pad the test dataset, needed later to evaluate the model after we train it.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369b0168918792" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369b0168918792-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b0168918792-2">2</div><div class="crayon-num" data-line="crayon-5a658642369b0168918792-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b0168918792-4">4</div><div class="crayon-num" data-line="crayon-5a658642369b0168918792-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b0168918792-6">6</div><div class="crayon-num" data-line="crayon-5a658642369b0168918792-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b0168918792-8">8</div><div class="crayon-num" data-line="crayon-5a658642369b0168918792-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b0168918792-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369b0168918792-1"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b0168918792-2"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b0168918792-3"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b0168918792-4"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5a658642369b0168918792-5"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b0168918792-6"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b0168918792-7"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b0168918792-8"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b0168918792-9"><span class="crayon-p"># define test labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b0168918792-10"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We are now ready to define our neural network model.</p>
<p>The model will use an Embedding layer as the first hidden layer. The Embedding requires the specification of the vocabulary size, the size of the real-valued vector space, and the maximum length of input documents.</p>
<p>The vocabulary size is the total number of words in our vocabulary, plus one for unknown words. This could be the vocab set length or the size of the vocab within the tokenizer used to integer encode the documents, for example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369b2727226266" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369b2727226266-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b2727226266-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369b2727226266-1"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b2727226266-2"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We will use a 100-dimensional vector space, but you could try other values, such as 50 or 150. Finally, the maximum document length was calculated above in the <em>max_length</em> variable used during padding.</p>
<p>The complete model definition is listed below including the Embedding layer.</p>
<p>We use a Convolutional Neural Network (CNN) as they have proven to be successful at document classification problems. A conservative CNN configuration is used with 32 filters (parallel fields for processing words) and a kernel size of 8 with a rectified linear (‘relu’) activation function. This is followed by a pooling layer that reduces the output of the convolutional layer by half.</p>
<p>Next, the 2D output from the CNN part of the model is flattened to one long 2D vector to represent the ‘features’ extracted by the CNN. The back-end of the model is a standard Multilayer Perceptron layers to interpret the CNN features. The output layer uses a sigmoid activation function to output a value between 0 and 1 for the negative and positive sentiment in the review.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369b5807059588" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(Embedding(vocab_size, 100, input_length=max_length))
model.add(Conv1D(filters=32, kernel_size=8, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(10, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369b5807059588-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b5807059588-2">2</div><div class="crayon-num" data-line="crayon-5a658642369b5807059588-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b5807059588-4">4</div><div class="crayon-num" data-line="crayon-5a658642369b5807059588-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b5807059588-6">6</div><div class="crayon-num" data-line="crayon-5a658642369b5807059588-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b5807059588-8">8</div><div class="crayon-num" data-line="crayon-5a658642369b5807059588-9">9</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369b5807059588-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b5807059588-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b5807059588-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b5807059588-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b5807059588-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b5807059588-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b5807059588-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b5807059588-8"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369b5807059588-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Running just this piece provides a summary of the defined network.</p>
<p>We can see that the Embedding layer expects documents with a length of 442 words as input and encodes each word in the document as a 100 element vector.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369b8727539938" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
embedding_1 (Embedding)      (None, 442, 100)          2576800
_________________________________________________________________
conv1d_1 (Conv1D)            (None, 435, 32)           25632
_________________________________________________________________
max_pooling1d_1 (MaxPooling1 (None, 217, 32)           0
_________________________________________________________________
flatten_1 (Flatten)          (None, 6944)              0
_________________________________________________________________
dense_1 (Dense)              (None, 10)                69450
_________________________________________________________________
dense_2 (Dense)              (None, 1)                 11
=================================================================
Total params: 2,671,893
Trainable params: 2,671,893
Non-trainable params: 0
_________________________________________________________________</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369b8727539938-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-2">2</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-4">4</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-6">6</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-8">8</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-10">10</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-12">12</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-14">14</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-16">16</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369b8727539938-18">18</div><div class="crayon-num" data-line="crayon-5a658642369b8727539938-19">19</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369b8727539938-1">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-2">Layer (type)                 Output Shape              Param #</div><div class="crayon-line" id="crayon-5a658642369b8727539938-3">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-4">embedding_1 (Embedding)      (None, 442, 100)          2576800</div><div class="crayon-line" id="crayon-5a658642369b8727539938-5">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-6">conv1d_1 (Conv1D)            (None, 435, 32)           25632</div><div class="crayon-line" id="crayon-5a658642369b8727539938-7">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-8">max_pooling1d_1 (MaxPooling1 (None, 217, 32)           0</div><div class="crayon-line" id="crayon-5a658642369b8727539938-9">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-10">flatten_1 (Flatten)          (None, 6944)              0</div><div class="crayon-line" id="crayon-5a658642369b8727539938-11">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-12">dense_1 (Dense)              (None, 10)                69450</div><div class="crayon-line" id="crayon-5a658642369b8727539938-13">_________________________________________________________________</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-14">dense_2 (Dense)              (None, 1)                 11</div><div class="crayon-line" id="crayon-5a658642369b8727539938-15">=================================================================</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-16">Total params: 2,671,893</div><div class="crayon-line" id="crayon-5a658642369b8727539938-17">Trainable params: 2,671,893</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369b8727539938-18">Non-trainable params: 0</div><div class="crayon-line" id="crayon-5a658642369b8727539938-19">_________________________________________________________________</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, we fit the network on the training data.</p>
<p>We use a binary cross entropy loss function because the problem we are learning is a binary classification problem. The efficient Adam implementation of stochastic gradient descent is used and we keep track of accuracy in addition to loss during training. The model is trained for 10 epochs, or 10 passes through the training data.</p>
<p>The network configuration and training schedule were found with a little trial and error, but are by no means optimal for this problem. If you can get better results with a different configuration, let me know.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369bb360994753" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369bb360994753-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369bb360994753-2">2</div><div class="crayon-num" data-line="crayon-5a658642369bb360994753-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369bb360994753-4">4</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369bb360994753-1"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369bb360994753-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369bb360994753-3"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369bb360994753-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>After the model is fit, it is evaluated on the test dataset. This dataset contains words that we have not seen before and reviews not seen during training.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369bd583756364" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369bd583756364-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369bd583756364-2">2</div><div class="crayon-num" data-line="crayon-5a658642369bd583756364-3">3</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369bd583756364-1"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369bd583756364-2"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369bd583756364-3"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We can tie all of this together.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369c0860717211" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# define model
model = Sequential()
model.add(Embedding(vocab_size, 100, input_length=max_length))
model.add(Conv1D(filters=32, kernel_size=8, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(10, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369c0860717211-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-2">2</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-4">4</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-6">6</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-8">8</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-10">10</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-12">12</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-14">14</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-16">16</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-18">18</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-20">20</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-22">22</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-24">24</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-26">26</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-28">28</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-30">30</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-32">32</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-34">34</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-36">36</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-38">38</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-40">40</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-42">42</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-44">44</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-46">46</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-48">48</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-50">50</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-52">52</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-54">54</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-56">56</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-58">58</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-60">60</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-62">62</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-64">64</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-66">66</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-68">68</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-70">70</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-72">72</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-74">74</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-76">76</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-78">78</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-80">80</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-82">82</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-84">84</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-86">86</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-88">88</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-90">90</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-92">92</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-94">94</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-96">96</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-98">98</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-100">100</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-102">102</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-104">104</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-106">106</div><div class="crayon-num" data-line="crayon-5a658642369c0860717211-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c0860717211-108">108</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369c0860717211-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-4"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-5"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-12"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-13"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-14"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-15"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-16"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-17"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-18"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-19"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-20"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-21"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-22"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-23"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-24"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-25"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-26"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-27"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-28"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-29"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-30"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-32"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-33"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-34"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-35"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-36"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-37"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-38"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-39"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-40"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-41"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-42"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-45"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-46"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-47"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-48"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-49"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-50"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-51"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-52"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-53"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-54"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-55"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-56"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-57"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-58"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-59"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-60"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-61"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-62"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-63"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-64"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-65"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-66"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-67"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-68"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-69"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-70"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-71"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-72"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-73"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-74"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-75"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-76"><span class="crayon-p"># define training labels</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-77"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-78"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-79"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-80"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-81"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-82"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-83"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-84"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-85"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-86"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-87"><span class="crayon-p"># define test labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-88"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-89"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-90"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-91"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-92"> </div><div class="crayon-line" id="crayon-5a658642369c0860717211-93"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-94"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-95"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-96"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">32</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-97"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-98"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-99"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-100"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-101"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-102"><span class="crayon-p"># compile network</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-103"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-104"><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-105"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-106"><span class="crayon-p"># evaluate</span></div><div class="crayon-line" id="crayon-5a658642369c0860717211-107"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c0860717211-108"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0072 seconds] -->
<p>Running the example prints the loss and accuracy at the end of each training epoch. We can see that the model very quickly achieves 100% accuracy on the training dataset.</p>
<p>At the end of the run, the model achieves an accuracy of 84.5% on the test dataset, which is a great score.</p>
<p>Given the stochastic nature of neural networks, your specific results will vary. Consider running the example a few times and taking the average score as the skill of the model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369c4440932827" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.0013 - acc: 1.0000
Epoch 7/10
2s - loss: 8.4573e-04 - acc: 1.0000
Epoch 8/10
2s - loss: 5.8323e-04 - acc: 1.0000
Epoch 9/10
2s - loss: 4.3155e-04 - acc: 1.0000
Epoch 10/10
2s - loss: 3.3083e-04 - acc: 1.0000
Test Accuracy: 84.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369c4440932827-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-2">2</div><div class="crayon-num" data-line="crayon-5a658642369c4440932827-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-4">4</div><div class="crayon-num" data-line="crayon-5a658642369c4440932827-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-6">6</div><div class="crayon-num" data-line="crayon-5a658642369c4440932827-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-8">8</div><div class="crayon-num" data-line="crayon-5a658642369c4440932827-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-10">10</div><div class="crayon-num" data-line="crayon-5a658642369c4440932827-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c4440932827-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369c4440932827-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5a658642369c4440932827-3">2s - loss: 0.0013 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5a658642369c4440932827-5">2s - loss: 8.4573e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5a658642369c4440932827-7">2s - loss: 5.8323e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5a658642369c4440932827-9">2s - loss: 4.3155e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5a658642369c4440932827-11">2s - loss: 3.3083e-04 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c4440932827-12">Test Accuracy: 84.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We have just seen an example of how we can learn a word embedding as part of fitting a neural network model.</p>
<p>Next, let’s look at how we can efficiently learn a standalone embedding that we could later use in our neural network.</p>
<h2>4. Train word2vec Embedding</h2>
<p>In this section, we will discover how to learn a standalone word embedding using an efficient algorithm called word2vec.</p>
<p>A downside of learning a word embedding as part of the network is that it can be very slow, especially for very large text datasets.</p>
<p>The word2vec algorithm is an approach to learning a word embedding from a text corpus in a standalone way. The benefit of the method is that it can produce high-quality word embeddings very efficiently, in terms of space and time complexity.</p>
<p>The first step is to prepare the documents ready for learning the embedding.</p>
<p>This involves the same data cleaning steps from the previous section, namely splitting documents by their white space, removing punctuation, and filtering out tokens not in the vocabulary.</p>
<p>The word2vec algorithm processes documents sentence by sentence. This means we will preserve the sentence-based structure during cleaning.</p>
<p>We start by loading the vocabulary, as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369c7892410621" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369c7892410621-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-2">2</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-4">4</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-6">6</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-8">8</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-10">10</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-12">12</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369c7892410621-14">14</div><div class="crayon-num" data-line="crayon-5a658642369c7892410621-15">15</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369c7892410621-1"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-2"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-3"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-5"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-6"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-7"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-9"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-10"> </div><div class="crayon-line" id="crayon-5a658642369c7892410621-11"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-12"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-13"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369c7892410621-14"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369c7892410621-15"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Next, we define a function named <em>doc_to_clean_lines()</em> to clean a loaded document line by line and return a list of the cleaned lines.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369ca757556566" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# turn a doc into clean tokens
def doc_to_clean_lines(doc, vocab):
	clean_lines = list()
	lines = doc.splitlines()
	for line in lines:
		# split into tokens by white space
		tokens = line.split()
		# remove punctuation from each token
		table = str.maketrans('', '', punctuation)
		tokens = [w.translate(table) for w in tokens]
		# filter out tokens not in vocab
		tokens = [w for w in tokens if w in vocab]
		clean_lines.append(tokens)
	return clean_lines</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369ca757556566-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-2">2</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-4">4</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-6">6</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-8">8</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-10">10</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-12">12</div><div class="crayon-num" data-line="crayon-5a658642369ca757556566-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ca757556566-14">14</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369ca757556566-1"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-2"><span class="crayon-e">def </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-3"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-4"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">splitlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-6"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-7"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-8"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-9"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-10"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-11"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-12"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658642369ca757556566-13"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ca757556566-14"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Next, we adapt the process_docs() function to load and clean all of the documents in a folder and return a list of all document lines.</p>
<p>The results from this function will be the training data for the word2vec model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369cd356203047" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	lines = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load and clean the doc
		doc = load_doc(path)
		doc_lines = doc_to_clean_lines(doc, vocab)
		# add lines to list
		lines += doc_lines
	return lines</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369cd356203047-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-2">2</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-4">4</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-6">6</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-8">8</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-10">10</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-12">12</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-14">14</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-16">16</div><div class="crayon-num" data-line="crayon-5a658642369cd356203047-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cd356203047-18">18</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369cd356203047-1"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-2"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-3"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-4"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-5"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-6"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-7"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-8"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-9"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-10"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-11"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-12"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-13"><span class="crayon-h"> </span><span class="crayon-p"># load and clean the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-14"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-15"><span class="crayon-h"> </span><span class="crayon-v">doc_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-16"><span class="crayon-h"> </span><span class="crayon-p"># add lines to list</span></div><div class="crayon-line" id="crayon-5a658642369cd356203047-17"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">doc_lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cd356203047-18"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lines</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>We can then load all of the training data and convert it into a long list of ‘sentences’ (lists of tokens) ready for fitting the word2vec model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369cf808244865" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load training data
positive_lines = process_docs('txt_sentoken/pos', vocab, True)
negative_lines = process_docs('txt_sentoken/neg', vocab, True)
sentences = negative_docs + positive_docs
print('Total training sentences: %d' % len(sentences))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369cf808244865-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cf808244865-2">2</div><div class="crayon-num" data-line="crayon-5a658642369cf808244865-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369cf808244865-4">4</div><div class="crayon-num" data-line="crayon-5a658642369cf808244865-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369cf808244865-1"><span class="crayon-p"># load training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cf808244865-2"><span class="crayon-v">positive_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369cf808244865-3"><span class="crayon-v">negative_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369cf808244865-4"><span class="crayon-v">sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5a658642369cf808244865-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total training sentences: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We will use the word2vec implementation provided in the Gensim Python library. Specifically the <a href="https://radimrehurek.com/gensim/models/word2vec.html">Word2Vec class</a>.</p>
<p>The model is fit when constructing the class. We pass in the list of clean sentences from the training data, then specify the size of the embedding vector space (we use 100 again), the number of neighboring words to look at when learning how to embed each word in the training sentences (we use 5 neighbors), the number of threads to use when fitting the model (we use 8, but change this if you have more or less CPU cores), and the minimum occurrence count for words to consider in the vocabulary (we set this to 1 as we have already prepared the vocabulary).</p>
<p>After the model is fit, we print the size of the learned vocabulary, which should match the size of our vocabulary in vocab.txt of 25,767 tokens.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369d2706126919" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# train word2vec model
model = Word2Vec(sentences, size=100, window=5, workers=8, min_count=1)
# summarize vocabulary size in model
words = list(model.wv.vocab)
print('Vocabulary size: %d' % len(words))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369d2706126919-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d2706126919-2">2</div><div class="crayon-num" data-line="crayon-5a658642369d2706126919-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d2706126919-4">4</div><div class="crayon-num" data-line="crayon-5a658642369d2706126919-5">5</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369d2706126919-1"><span class="crayon-p"># train word2vec model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d2706126919-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Word2Vec</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">workers</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">min_count</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d2706126919-3"><span class="crayon-p"># summarize vocabulary size in model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d2706126919-4"><span class="crayon-v">words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d2706126919-5"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">words</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Finally, we save the learned embedding vectors to file using the <a href="https://radimrehurek.com/gensim/models/keyedvectors.html">save_word2vec_format()</a> on the model’s ‘<em>wv</em>‘ (word vector) attribute. The embedding is saved in ASCII format with one word and vector per line.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369d5908020435" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from gensim.models import Word2Vec

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def doc_to_clean_lines(doc, vocab):
	clean_lines = list()
	lines = doc.splitlines()
	for line in lines:
		# split into tokens by white space
		tokens = line.split()
		# remove punctuation from each token
		table = str.maketrans('', '', punctuation)
		tokens = [w.translate(table) for w in tokens]
		# filter out tokens not in vocab
		tokens = [w for w in tokens if w in vocab]
		clean_lines.append(tokens)
	return clean_lines

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	lines = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load and clean the doc
		doc = load_doc(path)
		doc_lines = doc_to_clean_lines(doc, vocab)
		# add lines to list
		lines += doc_lines
	return lines

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load training data
positive_lines = process_docs('txt_sentoken/pos', vocab, True)
negative_lines = process_docs('txt_sentoken/neg', vocab, True)
sentences = negative_docs + positive_docs
print('Total training sentences: %d' % len(sentences))

# train word2vec model
model = Word2Vec(sentences, size=100, window=5, workers=8, min_count=1)
# summarize vocabulary size in model
words = list(model.wv.vocab)
print('Vocabulary size: %d' % len(words))

# save model in ASCII (word2vec) format
filename = 'embedding_word2vec.txt'
model.wv.save_word2vec_format(filename, binary=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369d5908020435-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-2">2</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-4">4</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-6">6</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-8">8</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-10">10</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-12">12</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-14">14</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-16">16</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-18">18</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-20">20</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-22">22</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-24">24</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-26">26</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-28">28</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-30">30</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-32">32</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-34">34</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-36">36</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-38">38</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-40">40</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-42">42</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-44">44</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-46">46</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-48">48</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-50">50</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-52">52</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-54">54</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-56">56</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-58">58</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-60">60</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-62">62</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-64">64</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-66">66</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d5908020435-68">68</div><div class="crayon-num" data-line="crayon-5a658642369d5908020435-69">69</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369d5908020435-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-3"><span class="crayon-e">from </span><span class="crayon-v">gensim</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-v">Word2Vec</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-4"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-5"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-6"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-7"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-8"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-9"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-10"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-11"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-12"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-14"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-15"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-16"><span class="crayon-e">def </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-17"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-18"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">splitlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-19"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-20"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-21"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-22"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-23"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-24"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-25"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-26"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-27"><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-28"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">clean_lines</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-29"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-30"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-31"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-32"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-33"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-34"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-35"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-36"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-37"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-38"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-39"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-40"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-41"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-42"><span class="crayon-h"> </span><span class="crayon-p"># load and clean the doc</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-43"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-44"><span class="crayon-h"> </span><span class="crayon-v">doc_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">doc_to_clean_lines</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-45"><span class="crayon-h"> </span><span class="crayon-p"># add lines to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-46"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-e">doc_lines</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-47"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lines</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-48"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-49"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-50"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-51"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-52"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-53"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-54"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-55"><span class="crayon-p"># load training data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-56"><span class="crayon-v">positive_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-57"><span class="crayon-v">negative_lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-58"><span class="crayon-v">sentences</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">positive_docs</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-59"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Total training sentences: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-60"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-61"><span class="crayon-p"># train word2vec model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-62"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Word2Vec</span><span class="crayon-sy">(</span><span class="crayon-v">sentences</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">window</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">workers</span><span class="crayon-o">=</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">min_count</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-63"><span class="crayon-p"># summarize vocabulary size in model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-64"><span class="crayon-v">words</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-65"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Vocabulary size: %d'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">words</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-66"> </div><div class="crayon-line" id="crayon-5a658642369d5908020435-67"><span class="crayon-p"># save model in ASCII (word2vec) format</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d5908020435-68"><span class="crayon-v">filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'embedding_word2vec.txt'</span></div><div class="crayon-line" id="crayon-5a658642369d5908020435-69"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">wv</span><span class="crayon-sy">.</span><span class="crayon-e">save_word2vec_format</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">binary</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0040 seconds] -->
<p>Running the example loads 58,109 sentences from the training data and creates an embedding for a vocabulary of 25,767 words.</p>
<p>You should now have a file ’embedding_word2vec.txt’ with the learned vectors in your current working directory.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369d8238625951" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
Total training sentences: 58109
Vocabulary size: 25767</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369d8238625951-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369d8238625951-2">2</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369d8238625951-1">Total training sentences: 58109</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369d8238625951-2">Vocabulary size: 25767</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, let’s look at using these learned vectors in our model.</p>
<h2>5. Use Pre-trained Embedding</h2>
<p>In this section, we will use a pre-trained word embedding prepared on a very large text corpus.</p>
<p>We can use the pre-trained word embedding developed in the previous section and the CNN model developed in the section before that.</p>
<p>The first step is to load the word embedding as a directory of words to vectors. The word embedding was saved in so-called ‘<em>word2vec</em>‘ format that contains a header line. We will skip this header line when loading the embedding.</p>
<p>The function below named <em>load_embedding()</em> loads the embedding and returns a directory of words mapped to the vectors in NumPy format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369db810591577" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()[1:]
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369db810591577-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-2">2</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-4">4</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-6">6</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-8">8</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-10">10</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369db810591577-12">12</div><div class="crayon-num" data-line="crayon-5a658642369db810591577-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369db810591577-1"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-2"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-3"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-5"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-7"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-8"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-10"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-11"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369db810591577-12"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369db810591577-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Now that we have all of the vectors in memory, we can order them in such a way as to match the integer encoding prepared by the Keras Tokenizer.</p>
<p>Recall that we integer encode the review documents prior to passing them to the Embedding layer. The integer maps to the index of a specific vector in the embedding layer. Therefore, it is important that we lay the vectors out in the Embedding layer such that the encoded words map to the correct vector.</p>
<p>Below defines a function <em>get_weight_matrix()</em> that takes the loaded embedding and the tokenizer.word_index vocabulary as arguments and returns a matrix with the word vectors in the correct locations.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369de467732693" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		weight_matrix[i] = embedding.get(word)
	return weight_matrix</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369de467732693-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369de467732693-2">2</div><div class="crayon-num" data-line="crayon-5a658642369de467732693-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369de467732693-4">4</div><div class="crayon-num" data-line="crayon-5a658642369de467732693-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369de467732693-6">6</div><div class="crayon-num" data-line="crayon-5a658642369de467732693-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369de467732693-8">8</div><div class="crayon-num" data-line="crayon-5a658642369de467732693-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369de467732693-10">10</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369de467732693-1"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369de467732693-2"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369de467732693-3"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369de467732693-4"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369de467732693-5"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369de467732693-6"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369de467732693-7"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369de467732693-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369de467732693-9"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369de467732693-10"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Now we can use these functions to create our new Embedding layer for our model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369e1572572380" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
# load embedding from file
raw_embedding = load_embedding('embedding_word2vec.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369e1572572380-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e1572572380-2">2</div><div class="crayon-num" data-line="crayon-5a658642369e1572572380-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e1572572380-4">4</div><div class="crayon-num" data-line="crayon-5a658642369e1572572380-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e1572572380-6">6</div><div class="crayon-num" data-line="crayon-5a658642369e1572572380-7">7</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369e1572572380-1"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e1572572380-2"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5a658642369e1572572380-3"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'embedding_word2vec.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e1572572380-4"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5a658642369e1572572380-5"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e1572572380-6"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5a658642369e1572572380-7"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Note that the prepared weight matrix <em>embedding_vectors</em> is passed to the new Embedding layer as an argument and that we set the ‘<em>trainable</em>‘ argument to ‘<em>False</em>‘ to ensure that the network does not try to adapt the pre-learned vectors as part of training the network.</p>
<p>We can now add this layer to our model. We also have a slightly different model configuration with a lot more filters (128) in the CNN model and a kernel that matches the 5 words used as neighbors when developing the word2vec embedding. Finally, the back-end of the model was simplified.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369e4174033687" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369e4174033687-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e4174033687-2">2</div><div class="crayon-num" data-line="crayon-5a658642369e4174033687-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e4174033687-4">4</div><div class="crayon-num" data-line="crayon-5a658642369e4174033687-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e4174033687-6">6</div><div class="crayon-num" data-line="crayon-5a658642369e4174033687-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e4174033687-8">8</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369e4174033687-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e4174033687-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e4174033687-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e4174033687-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e4174033687-5"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e4174033687-6"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e4174033687-7"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e4174033687-8"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>These changes were found with a little trial and error.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369e7756291771" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from numpy import asarray
from numpy import zeros
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()[1:]
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding

# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		weight_matrix[i] = embedding.get(word)
	return weight_matrix

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# load embedding from file
raw_embedding = load_embedding('embedding_word2vec.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)

# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369e7756291771-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-2">2</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-4">4</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-6">6</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-8">8</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-10">10</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-12">12</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-14">14</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-16">16</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-18">18</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-20">20</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-22">22</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-24">24</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-26">26</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-28">28</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-30">30</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-32">32</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-34">34</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-36">36</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-38">38</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-40">40</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-42">42</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-44">44</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-46">46</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-48">48</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-50">50</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-52">52</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-54">54</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-56">56</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-58">58</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-60">60</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-62">62</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-64">64</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-66">66</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-68">68</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-70">70</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-72">72</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-74">74</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-76">76</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-78">78</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-80">80</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-82">82</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-84">84</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-86">86</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-88">88</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-90">90</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-92">92</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-94">94</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-96">96</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-98">98</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-100">100</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-102">102</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-104">104</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-106">106</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-108">108</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-110">110</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-112">112</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-114">114</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-116">116</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-118">118</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-120">120</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-122">122</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-124">124</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-126">126</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-128">128</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-130">130</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-132">132</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-134">134</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-136">136</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-138">138</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369e7756291771-140">140</div><div class="crayon-num" data-line="crayon-5a658642369e7756291771-141">141</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369e7756291771-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">asarray</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">zeros</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-14"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-15"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-16"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-17"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-18"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-19"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-20"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-21"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-22"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-24"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-25"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-26"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-27"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-28"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-29"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-30"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-32"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-33"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-34"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-36"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-37"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-38"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-39"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-40"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-41"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-42"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-46"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-47"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-48"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-49"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-50"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-51"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-52"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-53"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-54"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-56"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-57"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-58"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-59"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-60"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-61"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-62"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-63"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-64"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-65"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-66"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-67"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-68"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-70"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-71"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-72"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-73"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-74"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-75"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-76"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-77"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-78"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-79"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-80"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-81"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-82"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-83"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-84"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-85"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-86"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-87"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-88"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-89"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-90"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-91"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-92"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-93"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-94"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-95"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-96"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-97"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-98"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-99"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-100"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-101"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-102"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-103"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-104"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-105"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-106"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-107"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-108"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-109"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-110"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-111"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-112"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-113"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-114"><span class="crayon-p"># define test labels</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-115"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-116"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-117"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-118"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-119"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-120"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-121"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'embedding_word2vec.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-122"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-123"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-124"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-125"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-126"> </div><div class="crayon-line" id="crayon-5a658642369e7756291771-127"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-128"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-129"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-130"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-131"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-132"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-133"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-134"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-135"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-136"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-137"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-138"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-139"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369e7756291771-140"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369e7756291771-141"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0090 seconds] -->
<p>Running the example shows that performance was not improved.</p>
<p>In fact, performance was a lot worse. The results show that the training dataset was learned successfully, but evaluation on the test dataset was very poor, at just above 50% accuracy.</p>
<p>The cause of the poor test performance may be because of the chosen word2vec configuration or the chosen neural network configuration.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369ec212903434" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.3306 - acc: 0.8778
Epoch 7/10
2s - loss: 0.2888 - acc: 0.8917
Epoch 8/10
2s - loss: 0.1878 - acc: 0.9439
Epoch 9/10
2s - loss: 0.1255 - acc: 0.9750
Epoch 10/10
2s - loss: 0.0812 - acc: 0.9928
Test Accuracy: 53.000000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369ec212903434-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-2">2</div><div class="crayon-num" data-line="crayon-5a658642369ec212903434-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-4">4</div><div class="crayon-num" data-line="crayon-5a658642369ec212903434-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-6">6</div><div class="crayon-num" data-line="crayon-5a658642369ec212903434-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-8">8</div><div class="crayon-num" data-line="crayon-5a658642369ec212903434-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-10">10</div><div class="crayon-num" data-line="crayon-5a658642369ec212903434-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ec212903434-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369ec212903434-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5a658642369ec212903434-3">2s - loss: 0.3306 - acc: 0.8778</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5a658642369ec212903434-5">2s - loss: 0.2888 - acc: 0.8917</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5a658642369ec212903434-7">2s - loss: 0.1878 - acc: 0.9439</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5a658642369ec212903434-9">2s - loss: 0.1255 - acc: 0.9750</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5a658642369ec212903434-11">2s - loss: 0.0812 - acc: 0.9928</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ec212903434-12">Test Accuracy: 53.000000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The weights in the embedding layer can be used as a starting point for the network, and adapted during the training of the network. We can do this by setting ‘<em>trainable=True</em>‘ (the default) in the creation of the embedding layer.</p>
<p>Repeating the experiment with this change shows slightly better results, but still poor.</p>
<p>I would encourage you to explore alternate configurations of the embedding and network to see if you can do better. Let me know how you do.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369ef371681939" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
4s - loss: 0.0950 - acc: 0.9917
Epoch 7/10
4s - loss: 0.0355 - acc: 0.9983
Epoch 8/10
4s - loss: 0.0158 - acc: 1.0000
Epoch 9/10
4s - loss: 0.0080 - acc: 1.0000
Epoch 10/10
4s - loss: 0.0050 - acc: 1.0000
Test Accuracy: 57.500000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369ef371681939-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-2">2</div><div class="crayon-num" data-line="crayon-5a658642369ef371681939-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-4">4</div><div class="crayon-num" data-line="crayon-5a658642369ef371681939-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-6">6</div><div class="crayon-num" data-line="crayon-5a658642369ef371681939-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-8">8</div><div class="crayon-num" data-line="crayon-5a658642369ef371681939-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-10">10</div><div class="crayon-num" data-line="crayon-5a658642369ef371681939-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ef371681939-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369ef371681939-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5a658642369ef371681939-3">4s - loss: 0.0950 - acc: 0.9917</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5a658642369ef371681939-5">4s - loss: 0.0355 - acc: 0.9983</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5a658642369ef371681939-7">4s - loss: 0.0158 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5a658642369ef371681939-9">4s - loss: 0.0080 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5a658642369ef371681939-11">4s - loss: 0.0050 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ef371681939-12">Test Accuracy: 57.500000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>It is possible to use pre-trained word vectors prepared on very large corpora of text data.</p>
<p>For example, both Google and Stanford provide pre-trained word vectors that you can download, trained with the efficient word2vec and GloVe methods respectively.</p>
<p>Let’s try to use pre-trained vectors in our model.</p>
<p>You can download <a href="https://nlp.stanford.edu/projects/glove/">pre-trained GloVe vectors</a> from the Stanford webpage. Specifically, vectors trained on Wikipedia data:</p>
<ul>
<li><a href="http://nlp.stanford.edu/data/glove.6B.zip">glove.6B.zip</a> (822 Megabyte download)</li>
</ul>
<p>Unzipping the file, you will find pre-trained embeddings for various different dimensions. We will load the 100 dimension version in the file ‘<em>glove.6B.100d.txt</em>‘</p>
<p>The Glove file does not contain a header file, so we do not need to skip the first line when loading the embedding into memory. The updated <em>load_embedding()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369f2692577811" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369f2692577811-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-2">2</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-4">4</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-6">6</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-8">8</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-10">10</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f2692577811-12">12</div><div class="crayon-num" data-line="crayon-5a658642369f2692577811-13">13</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369f2692577811-1"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-2"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-3"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-4"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-5"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-6"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-7"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-8"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-9"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-10"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-11"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f2692577811-12"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f2692577811-13"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>It is possible that the loaded embedding does not contain all of the words in our chosen vocabulary. As such, when creating the Embedding weight matrix, we need to skip words that do not have a corresponding vector in the loaded GloVe data. Below is the updated, more defensive version of the <em>get_weight_matrix()</em> function.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369f5788724800" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		vector = embedding.get(word)
		if vector is not None:
			weight_matrix[i] = vector
	return weight_matrix</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369f5788724800-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-2">2</div><div class="crayon-num" data-line="crayon-5a658642369f5788724800-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-4">4</div><div class="crayon-num" data-line="crayon-5a658642369f5788724800-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-6">6</div><div class="crayon-num" data-line="crayon-5a658642369f5788724800-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-8">8</div><div class="crayon-num" data-line="crayon-5a658642369f5788724800-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-10">10</div><div class="crayon-num" data-line="crayon-5a658642369f5788724800-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f5788724800-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369f5788724800-1"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-2"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369f5788724800-3"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-4"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369f5788724800-5"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-6"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f5788724800-7"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-8"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369f5788724800-9"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-10"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369f5788724800-11"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f5788724800-12"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can now load the GloVe embedding and create the Embedding layer as before.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369f8189302216" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
# load embedding from file
raw_embedding = load_embedding('glove.6B.100d.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369f8189302216-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f8189302216-2">2</div><div class="crayon-num" data-line="crayon-5a658642369f8189302216-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f8189302216-4">4</div><div class="crayon-num" data-line="crayon-5a658642369f8189302216-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369f8189302216-6">6</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369f8189302216-1"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f8189302216-2"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'glove.6B.100d.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f8189302216-3"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f8189302216-4"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369f8189302216-5"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369f8189302216-6"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We will use the same model as before.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369fa525475524" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
from string import punctuation
from os import listdir
from numpy import array
from numpy import asarray
from numpy import zeros
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import Embedding
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# load doc into memory
def load_doc(filename):
	# open the file as read only
	file = open(filename, 'r')
	# read all text
	text = file.read()
	# close the file
	file.close()
	return text

# turn a doc into clean tokens
def clean_doc(doc, vocab):
	# split into tokens by white space
	tokens = doc.split()
	# remove punctuation from each token
	table = str.maketrans('', '', punctuation)
	tokens = [w.translate(table) for w in tokens]
	# filter out tokens not in vocab
	tokens = [w for w in tokens if w in vocab]
	tokens = ' '.join(tokens)
	return tokens

# load all docs in a directory
def process_docs(directory, vocab, is_trian):
	documents = list()
	# walk through all files in the folder
	for filename in listdir(directory):
		# skip any reviews in the test set
		if is_trian and filename.startswith('cv9'):
			continue
		if not is_trian and not filename.startswith('cv9'):
			continue
		# create the full path of the file to open
		path = directory + '/' + filename
		# load the doc
		doc = load_doc(path)
		# clean doc
		tokens = clean_doc(doc, vocab)
		# add to list
		documents.append(tokens)
	return documents

# load embedding as a dict
def load_embedding(filename):
	# load embedding into memory, skip first line
	file = open(filename,'r')
	lines = file.readlines()
	file.close()
	# create a map of words to vectors
	embedding = dict()
	for line in lines:
		parts = line.split()
		# key is string word, value is numpy array for vector
		embedding[parts[0]] = asarray(parts[1:], dtype='float32')
	return embedding

# create a weight matrix for the Embedding layer from a loaded embedding
def get_weight_matrix(embedding, vocab):
	# total vocabulary size plus 0 for unknown words
	vocab_size = len(vocab) + 1
	# define weight matrix dimensions with all 0
	weight_matrix = zeros((vocab_size, 100))
	# step vocab, store vectors using the Tokenizer's integer mapping
	for word, i in vocab.items():
		vector = embedding.get(word)
		if vector is not None:
			weight_matrix[i] = vector
	return weight_matrix

# load the vocabulary
vocab_filename = 'vocab.txt'
vocab = load_doc(vocab_filename)
vocab = vocab.split()
vocab = set(vocab)

# load all training reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, True)
negative_docs = process_docs('txt_sentoken/neg', vocab, True)
train_docs = negative_docs + positive_docs

# create the tokenizer
tokenizer = Tokenizer()
# fit the tokenizer on the documents
tokenizer.fit_on_texts(train_docs)

# sequence encode
encoded_docs = tokenizer.texts_to_sequences(train_docs)
# pad sequences
max_length = max([len(s.split()) for s in train_docs])
Xtrain = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define training labels
ytrain = array([0 for _ in range(900)] + [1 for _ in range(900)])

# load all test reviews
positive_docs = process_docs('txt_sentoken/pos', vocab, False)
negative_docs = process_docs('txt_sentoken/neg', vocab, False)
test_docs = negative_docs + positive_docs
# sequence encode
encoded_docs = tokenizer.texts_to_sequences(test_docs)
# pad sequences
Xtest = pad_sequences(encoded_docs, maxlen=max_length, padding='post')
# define test labels
ytest = array([0 for _ in range(100)] + [1 for _ in range(100)])

# define vocabulary size (largest integer value)
vocab_size = len(tokenizer.word_index) + 1

# load embedding from file
raw_embedding = load_embedding('glove.6B.100d.txt')
# get vectors in the right order
embedding_vectors = get_weight_matrix(raw_embedding, tokenizer.word_index)
# create the embedding layer
embedding_layer = Embedding(vocab_size, 100, weights=[embedding_vectors], input_length=max_length, trainable=False)

# define model
model = Sequential()
model.add(embedding_layer)
model.add(Conv1D(filters=128, kernel_size=5, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())
model.add(Dense(1, activation='sigmoid'))
print(model.summary())
# compile network
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
# fit network
model.fit(Xtrain, ytrain, epochs=10, verbose=2)
# evaluate
loss, acc = model.evaluate(Xtest, ytest, verbose=0)
print('Test Accuracy: %f' % (acc*100))</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369fa525475524-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-2">2</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-4">4</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-6">6</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-8">8</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-10">10</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-12">12</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-14">14</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-16">16</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-18">18</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-20">20</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-22">22</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-24">24</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-26">26</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-28">28</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-30">30</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-32">32</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-34">34</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-36">36</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-38">38</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-40">40</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-42">42</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-44">44</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-46">46</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-48">48</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-50">50</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-52">52</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-54">54</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-56">56</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-58">58</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-60">60</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-62">62</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-64">64</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-66">66</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-68">68</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-70">70</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-72">72</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-74">74</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-76">76</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-78">78</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-80">80</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-82">82</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-84">84</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-86">86</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-88">88</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-90">90</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-92">92</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-94">94</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-96">96</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-98">98</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-100">100</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-102">102</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-104">104</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-106">106</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-108">108</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-110">110</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-112">112</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-114">114</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-116">116</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-118">118</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-120">120</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-122">122</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-124">124</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-126">126</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-128">128</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-130">130</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-132">132</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-134">134</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-136">136</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-138">138</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-140">140</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369fa525475524-142">142</div><div class="crayon-num" data-line="crayon-5a658642369fa525475524-143">143</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369fa525475524-1"><span class="crayon-e">from </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">import </span><span class="crayon-e">punctuation</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-2"><span class="crayon-e">from </span><span class="crayon-e">os </span><span class="crayon-e">import </span><span class="crayon-e">listdir</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">asarray</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-5"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">zeros</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-6"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">text </span><span class="crayon-e">import </span><span class="crayon-e">Tokenizer</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-7"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">preprocessing</span><span class="crayon-sy">.</span><span class="crayon-e">sequence </span><span class="crayon-e">import </span><span class="crayon-e">pad_sequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-14"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-15"><span class="crayon-p"># load doc into memory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-16"><span class="crayon-e">def </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-17"><span class="crayon-h"> </span><span class="crayon-p"># open the file as read only</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-18"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-19"><span class="crayon-h"> </span><span class="crayon-p"># read all text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-20"><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-21"><span class="crayon-h"> </span><span class="crayon-p"># close the file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-22"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-23"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">text</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-24"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-25"><span class="crayon-p"># turn a doc into clean tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-26"><span class="crayon-e">def </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-27"><span class="crayon-h"> </span><span class="crayon-p"># split into tokens by white space</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-28"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-29"><span class="crayon-h"> </span><span class="crayon-p"># remove punctuation from each token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-30"><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">str</span><span class="crayon-sy">.</span><span class="crayon-e">maketrans</span><span class="crayon-sy">(</span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">''</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">punctuation</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-31"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">w</span><span class="crayon-sy">.</span><span class="crayon-e">translate</span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-32"><span class="crayon-h"> </span><span class="crayon-p"># filter out tokens not in vocab</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-33"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">tokens </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">w</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-34"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-35"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">tokens</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-36"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-37"><span class="crayon-p"># load all docs in a directory</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-38"><span class="crayon-e">def </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">is_trian</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-39"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-40"><span class="crayon-h"> </span><span class="crayon-p"># walk through all files in the folder</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-41"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">filename </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">listdir</span><span class="crayon-sy">(</span><span class="crayon-v">directory</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-42"><span class="crayon-h"> </span><span class="crayon-p"># skip any reviews in the test set</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-43"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-44"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-45"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-e">is_trian </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">filename</span><span class="crayon-sy">.</span><span class="crayon-e">startswith</span><span class="crayon-sy">(</span><span class="crayon-s">'cv9'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-46"><span class="crayon-h"> </span><span class="crayon-st">continue</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-47"><span class="crayon-h"> </span><span class="crayon-p"># create the full path of the file to open</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-48"><span class="crayon-h"> </span><span class="crayon-v">path</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">filename</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-49"><span class="crayon-h"> </span><span class="crayon-p"># load the doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-50"><span class="crayon-h"> </span><span class="crayon-v">doc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">path</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-51"><span class="crayon-h"> </span><span class="crayon-p"># clean doc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-52"><span class="crayon-h"> </span><span class="crayon-v">tokens</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">clean_doc</span><span class="crayon-sy">(</span><span class="crayon-v">doc</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-53"><span class="crayon-h"> </span><span class="crayon-p"># add to list</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-54"><span class="crayon-h"> </span><span class="crayon-v">documents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">tokens</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-55"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-56"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-57"><span class="crayon-p"># load embedding as a dict</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-58"><span class="crayon-e">def </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-59"><span class="crayon-h"> </span><span class="crayon-p"># load embedding into memory, skip first line</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-60"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">filename</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-61"><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">readlines</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-62"><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-63"><span class="crayon-h"> </span><span class="crayon-p"># create a map of words to vectors</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-64"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">dict</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-65"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">line </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">lines</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-66"><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">line</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-67"><span class="crayon-h"> </span><span class="crayon-p"># key is string word, value is numpy array for vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-68"><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">[</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">asarray</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-o">=</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-69"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-70"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-71"><span class="crayon-p"># create a weight matrix for the Embedding layer from a loaded embedding</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-72"><span class="crayon-e">def </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-73"><span class="crayon-h"> </span><span class="crayon-p"># total vocabulary size plus 0 for unknown words</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-74"><span class="crayon-h"> </span><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-75"><span class="crayon-h"> </span><span class="crayon-p"># define weight matrix dimensions with all 0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-76"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-77"><span class="crayon-h"> </span><span class="crayon-p"># step vocab, store vectors using the Tokenizer's integer mapping</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-78"><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-t">word</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">items</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-79"><span class="crayon-h"> </span><span class="crayon-v">vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">embedding</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-t">word</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-80"><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">vector </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-81"><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">vector</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-82"><span class="crayon-e"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">weight_matrix</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-83"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-84"><span class="crayon-p"># load the vocabulary</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-85"><span class="crayon-v">vocab_filename</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vocab.txt'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-86"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_doc</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_filename</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-87"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-88"><span class="crayon-v">vocab</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">set</span><span class="crayon-sy">(</span><span class="crayon-v">vocab</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-89"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-90"><span class="crayon-p"># load all training reviews</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-91"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-92"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-93"><span class="crayon-v">train_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-94"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-95"><span class="crayon-p"># create the tokenizer</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-96"><span class="crayon-v">tokenizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tokenizer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-97"><span class="crayon-p"># fit the tokenizer on the documents</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-98"><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">fit_on_texts</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-99"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-100"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-101"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">train_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-102"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-103"><span class="crayon-v">max_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">max</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train_docs</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-104"><span class="crayon-v">Xtrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-105"><span class="crayon-p"># define training labels</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-106"><span class="crayon-v">ytrain</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">900</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-107"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-108"><span class="crayon-p"># load all test reviews</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-109"><span class="crayon-v">positive_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/pos'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-110"><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">process_docs</span><span class="crayon-sy">(</span><span class="crayon-s">'txt_sentoken/neg'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">vocab</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-111"><span class="crayon-v">test_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">negative_docs</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">positive_docs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-112"><span class="crayon-p"># sequence encode</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-113"><span class="crayon-v">encoded_docs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-e">texts_to_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">test_docs</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-114"><span class="crayon-p"># pad sequences</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-115"><span class="crayon-v">Xtest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">pad_sequences</span><span class="crayon-sy">(</span><span class="crayon-v">encoded_docs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">maxlen</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">padding</span><span class="crayon-o">=</span><span class="crayon-s">'post'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-116"><span class="crayon-p"># define test labels</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-117"><span class="crayon-v">ytest</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-118"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-119"><span class="crayon-p"># define vocabulary size (largest integer value)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-120"><span class="crayon-v">vocab_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-121"> </div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-122"><span class="crayon-p"># load embedding from file</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-123"><span class="crayon-v">raw_embedding</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">load_embedding</span><span class="crayon-sy">(</span><span class="crayon-s">'glove.6B.100d.txt'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-124"><span class="crayon-p"># get vectors in the right order</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-125"><span class="crayon-v">embedding_vectors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_weight_matrix</span><span class="crayon-sy">(</span><span class="crayon-v">raw_embedding</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tokenizer</span><span class="crayon-sy">.</span><span class="crayon-v">word_index</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-126"><span class="crayon-p"># create the embedding layer</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-127"><span class="crayon-v">embedding_layer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Embedding</span><span class="crayon-sy">(</span><span class="crayon-v">vocab_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">weights</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-v">embedding_vectors</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_length</span><span class="crayon-o">=</span><span class="crayon-v">max_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">trainable</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-128"> </div><div class="crayon-line" id="crayon-5a658642369fa525475524-129"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-130"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-131"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-v">embedding_layer</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-132"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">128</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-133"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-134"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-135"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-136"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-137"><span class="crayon-p"># compile network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-138"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">metrics</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-139"><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-140"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">Xtrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytrain</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-141"><span class="crayon-p"># evaluate</span></div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369fa525475524-142"><span class="crayon-v">loss</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">acc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">evaluate</span><span class="crayon-sy">(</span><span class="crayon-v">Xtest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ytest</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5a658642369fa525475524-143"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Test Accuracy: %f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">acc*</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0092 seconds] -->
<p>Running the example shows better performance.</p>
<p>Again, the training dataset is easily learned and the model achieves 76% accuracy on the test dataset. This is good, but not as good as using a learned Embedding layer.</p>
<p>This may be cause of the higher quality vectors trained on more data and/or using a slightly different training process.</p>
<p>Your specific results may vary given the stochastic nature of neural networks. Try running the example a few times.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->
<div class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover" id="crayon-5a658642369ff703257945" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;" wrap="soft">
...
Epoch 6/10
2s - loss: 0.0278 - acc: 1.0000
Epoch 7/10
2s - loss: 0.0174 - acc: 1.0000
Epoch 8/10
2s - loss: 0.0117 - acc: 1.0000
Epoch 9/10
2s - loss: 0.0086 - acc: 1.0000
Epoch 10/10
2s - loss: 0.0068 - acc: 1.0000
Test Accuracy: 76.000000</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5a658642369ff703257945-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-2">2</div><div class="crayon-num" data-line="crayon-5a658642369ff703257945-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-4">4</div><div class="crayon-num" data-line="crayon-5a658642369ff703257945-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-6">6</div><div class="crayon-num" data-line="crayon-5a658642369ff703257945-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-8">8</div><div class="crayon-num" data-line="crayon-5a658642369ff703257945-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-10">10</div><div class="crayon-num" data-line="crayon-5a658642369ff703257945-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5a658642369ff703257945-12">12</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5a658642369ff703257945-1">...</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-2">Epoch 6/10</div><div class="crayon-line" id="crayon-5a658642369ff703257945-3">2s - loss: 0.0278 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-4">Epoch 7/10</div><div class="crayon-line" id="crayon-5a658642369ff703257945-5">2s - loss: 0.0174 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-6">Epoch 8/10</div><div class="crayon-line" id="crayon-5a658642369ff703257945-7">2s - loss: 0.0117 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-8">Epoch 9/10</div><div class="crayon-line" id="crayon-5a658642369ff703257945-9">2s - loss: 0.0086 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-10">Epoch 10/10</div><div class="crayon-line" id="crayon-5a658642369ff703257945-11">2s - loss: 0.0068 - acc: 1.0000</div><div class="crayon-line crayon-striped-line" id="crayon-5a658642369ff703257945-12">Test Accuracy: 76.000000</div></div></td>
</tr>
</table>
</div>
</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>In this case, it seems that learning the embedding as part of the learning task may be a better direction than using a specifically trained embedding or a more general pre-trained embedding.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking go deeper.</p>
<h3>Dataset</h3>
<ul>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/">Movie Review Data</a></li>
<li><a href="http://xxx.lanl.gov/abs/cs/0409058">A Sentimental Education: Sentiment Analysis Using Subjectivity Summarization Based on Minimum Cuts</a>, 2004.</li>
<li><a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/review_polarity.tar.gz">Movie Review Polarity Dataset</a> (.tgz)</li>
<li>Dataset Readme <a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/poldata.README.2.0.txt">v2.0</a> and <a href="http://www.cs.cornell.edu/people/pabo/movie-review-data/README.1.1">v1.1</a>.</li>
</ul>
<h3>APIs</h3>
<ul>
<li><a href="https://docs.python.org/3/library/collections.html">collections API – Container datatypes</a></li>
<li><a href="https://keras.io/preprocessing/text/#tokenizer">Tokenizer Keras API</a></li>
<li><a href="https://keras.io/layers/embeddings/">Embedding Keras API</a></li>
<li><a href="https://radimrehurek.com/gensim/models/word2vec.html">Gensim Word2Vec API</a></li>
<li><a href="https://radimrehurek.com/gensim/models/keyedvectors.html">Gensim WordVector API</a></li>
</ul>
<h3>Embedding Methods</h3>
<ul>
<li><a href="https://code.google.com/archive/p/word2vec/">word2vec on Google Code</a></li>
<li><a href="https://nlp.stanford.edu/projects/glove/">GloVe on Stanford</a></li>
</ul>
<h3>Related Posts</h3>
<ul>
<li><a href="https://blog.keras.io/using-pre-trained-word-embeddings-in-a-keras-model.html">Using pre-trained word embeddings in a Keras model</a>, 2016.</li>
<li><a href="http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/">Implementing a CNN for Text Classification in TensorFlow</a>, 2015.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop word embeddings for the classification of movie reviews.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to prepare movie review text data for classification with deep learning methods.</li>
<li>How to learn a word embedding as part of fitting a deep learning model.</li>
<li>How to learn a standalone word embedding and how to use a pre-trained embedding in a neural network model.</li>
</ul>
<p>Do you have any questions?<br/>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-42"> <div class="textwidget"><p></p><center><br/>
<div class="woo-sc-hr"></div>
<h2>Develop Deep Learning models for Text Data Today!</h2>
<p><a href="/deep-learning-for-nlp/"><img align="left" alt="Deep Learning for Natural Language Processing" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png" style="border: 0;"/></a></p>
<h4>Develop Your Own Text models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br/>
<a href="/deep-learning-for-nlp/">Deep Learning for Natural Language Processing</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like:<br/>
<em>Bag-of-Words, Word Embedding, Language Models, Caption Generation, Text Translation</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Natural Language Processing Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="/deep-learning-for-nlp/">Click to learn more</a>.<br/>
</p><div class="woo-sc-hr"></div><br/>
</center>
</div>
</div></div><div class="apss-social-share apss-theme-4 clearfix">
<div class="apss-twitter apss-single-icon">
<a href="javascript:void(0);" onclick="apss_open_in_popup_window(event, 'https://twitter.com/intent/tweet?text=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https%3A%2F%2Fmachinelearningmastery.com%2Fdevelop-word-embedding-model-predicting-movie-review-sentiment%2F&amp;');" rel="nofollow" target="" title="Share on Twitter">
<div class="apss-icon-block clearfix">
<i class="fa fa-twitter"></i>
<span class="apss-social-text">Share on Twitter</span><span class="apss-share">Tweet</span>
</div>
</a>
</div>
<div class="apss-facebook apss-single-icon">
<a href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="apss_open_in_popup_window(event, 'https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/');" rel="nofollow" target="" title="Share on Facebook">
<div class="apss-icon-block clearfix">
<i class="fa fa-facebook"></i>
<span class="apss-social-text">Share on Facebook</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-linkedin apss-single-icon">
<a href="http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/&amp;summary=Word+embeddings+are+a+technique+for+representing+text+where+different+words+with+similar+meaning+hav..." onclick="apss_open_in_popup_window(event, 'http://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20Develop%20a%20Word%20Embedding%20Model%20for%20Predicting%20Movie%20Review%20Sentiment&amp;url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/&amp;summary=Word+embeddings+are+a+technique+for+representing+text+where+different+words+with+similar+meaning+hav...');" rel="nofollow" target="" title="Share on LinkedIn">
<div class="apss-icon-block clearfix"><i class="fa fa-linkedin"></i>
<span class="apss-social-text">Share on LinkedIn</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
<div class="apss-google-plus apss-single-icon">
<a href="https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/" onclick="apss_open_in_popup_window(event, 'https://plus.google.com/share?url=https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/');" rel="nofollow" target="" title="Share on Google Plus">
<div class="apss-icon-block clearfix">
<i class="fa fa-google-plus"></i>
<span class="apss-social-text">Share on Google Plus</span>
<span class="apss-share">Share</span>
</div>
</a>
</div>
</div> </section><!-- /.entry -->
<div class="fix"></div>
<aside id="post-author">
<div class="profile-image"><img alt="" class="avatar avatar-80 photo" height="80" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" width="80"/></div>
<div class="profile-content">
<h4>About Jason Brownlee</h4>
		Dr. Jason Brownlee is a husband, proud father, academic researcher, author, professional developer and a machine learning practitioner. He is dedicated to helping developers get started and get good at applied machine learning.
<a href="/about">Learn more</a>.				<div class="profile-link">
<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span> </a>
</div><!--#profile-link-->
</div>
<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
<div class="post-entries">
<div class="nav-prev fl"><a href="https://machinelearningmastery.com/keras-functional-api-deep-learning/" rel="prev"><i class="fa fa-angle-left"></i> How to Use the Keras Functional API for Deep Learning</a></div>
<div class="nav-next fr"><a href="https://machinelearningmastery.com/global-attention-for-encoder-decoder-recurrent-neural-networks/" rel="next">Gentle Introduction to Global Attention for Encoder-Decoder Recurrent Neural Networks <i class="fa fa-angle-right"></i></a></div>
<div class="fix"></div>
</div>
<div id="comments"> <h3 id="comments-title">14 Responses to <em>How to Develop a Word Embedding Model for Predicting Movie Review Sentiment</em></h3>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-418478">
<div class="comment-container" id="li-comment-418478">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 30, 2017 at 7:11 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418478" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for interest work.<br/>
Jason, help me please.<br/>
Imagine that we have an dataset which contains reviews with very different lengths (from just two words “good film” to long description “I remember the first work of this director….”.<br/>
Which length should we choose when we talk about “pad_sequence”?</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418478#respond" onclick='return addComment.moveForm( "comment-418478", "418478", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418526">
<div class="comment-container" id="li-comment-418526">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 5:32 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418526" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>All reviews must be padded to the same length.</p>
<p>You can use the longest review, you can use the average length, etc. Try a few and see what works best.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418526#respond" onclick='return addComment.moveForm( "comment-418526", "418526", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418513">
<div class="comment-container" id="li-comment-418513">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/ec3c1db58c0d354e88c4a098fc2be505?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ec3c1db58c0d354e88c4a098fc2be505?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">JingChunzhen</span>
<span class="date">October 31, 2017 at 2:37 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418513" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi Jason<br/>
I think it’s difficult to distinguish ”good” and “bad” using word2vec,  but it’s important in sentiment analysis anyway .<br/>
Is there a good method to solve this ? Thank you and sorry for my poor English .</p>
<div class="reply">
<a aria-label="Reply to JingChunzhen" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418513#respond" onclick='return addComment.moveForm( "comment-418513", "418513", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418532">
<div class="comment-container" id="li-comment-418532">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">October 31, 2017 at 5:35 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418532" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Generally, the model will minimize a loss function. We want the loss to be low.</p>
<p>I agree, it feels like clustering to some degree.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418532#respond" onclick='return addComment.moveForm( "comment-418532", "418532", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-418608">
<div class="comment-container" id="li-comment-418608">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">October 31, 2017 at 10:38 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418608" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks for feedback.<br/>
Jason, sorry i don’t understand one thing. Help me please.<br/>
I read you works about technique “Word Embeddings”. And I saw that when you use Embedding layer with Convolutional layer as feature extractor you always use 1D version.<br/>
Since the machine sees the sentence in form of matrix why we don’t base on Conv2D?</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418608#respond" onclick='return addComment.moveForm( "comment-418608", "418608", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418631">
<div class="comment-container" id="li-comment-418631">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 1, 2017 at 5:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418631" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Good question.</p>
<p>A sequence of words is a one dimensions vector of integers. The embedding maps each integer onto a real vector, so now we have a sequence of vectors. It is still a one-dimensional sequence, it just so happens each item in the sequence has many features.</p>
<p>It is not like an image that has spatial relationships in two dimensions.</p>
<p>Does that help?</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418631#respond" onclick='return addComment.moveForm( "comment-418631", "418631", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-418687">
<div class="comment-container" id="li-comment-418687">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a8a404e3ddf6be55ef21c4f4a1b5f77c?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Alexander</span>
<span class="date">November 1, 2017 at 6:19 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418687" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank for clear explanation, Jason.<br/>
I try to find an opportunity to use knowledges we have in Embedding layer the best way.</p>
<div class="reply">
<a aria-label="Reply to Alexander" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418687#respond" onclick='return addComment.moveForm( "comment-418687", "418687", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-418731">
<div class="comment-container" id="li-comment-418731">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 2, 2017 at 5:08 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-418731" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>I’m glad it helped Alexander.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=418731#respond" onclick='return addComment.moveForm( "comment-418731", "418731", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-419049">
<div class="comment-container" id="li-comment-419049">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/c35f435a9bd84ccf70bffe9267340b92?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c35f435a9bd84ccf70bffe9267340b92?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Ramesh Subrahmanyam</span>
<span class="date">November 5, 2017 at 9:12 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-419049" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Excellent post.  Thanks.</p>
<div class="reply">
<a aria-label="Reply to Ramesh Subrahmanyam" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=419049#respond" onclick='return addComment.moveForm( "comment-419049", "419049", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-419103">
<div class="comment-container" id="li-comment-419103">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 6, 2017 at 4:47 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-419103" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=419103#respond" onclick='return addComment.moveForm( "comment-419103", "419103", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-odd thread-alt depth-1" id="comment-420104">
<div class="comment-container" id="li-comment-420104">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/36f88e5579f209ca739f0d765f0b2db3?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/36f88e5579f209ca739f0d765f0b2db3?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Amit Adesara</span>
<span class="date">November 15, 2017 at 9:54 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-420104" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thank you for amazing posts. Eagerly waiting for your new book launch. I had one query on test,train split. Rather than defining a X and Y test/train, can’t we just use split model from sklearn. Doesn’t is automatically split the entire dataset into train and test? Thank you.</p>
<div class="reply">
<a aria-label="Reply to Amit Adesara" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=420104#respond" onclick='return addComment.moveForm( "comment-420104", "420104", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-420179">
<div class="comment-container" id="li-comment-420179">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">November 16, 2017 at 10:30 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-420179" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Thanks Amit!</p>
<p>Yes, you can use sklearn if you wish.</p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=420179#respond" onclick='return addComment.moveForm( "comment-420179", "420179", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li class="comment even thread-even depth-1" id="comment-423200">
<div class="comment-container" id="li-comment-423200">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5eedf4f02c80308b2cf11d79da1f0db8?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name">Abdur Rehman Nadeem</span>
<span class="date">December 15, 2017 at 8:50 am</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-423200" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>Hi jason,</p>
<p>Sorry once again I am asking the same question which I mentioned in some other blog that what if I am using my own dataset. How can I make my dataset compatible to the above pre-built dataset ? I have a dataset of tweets so how can i make my dataset of positive and negative tweets and then use them as a test and train set ?</p>
<div class="reply">
<a aria-label="Reply to Abdur Rehman Nadeem" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=423200#respond" onclick='return addComment.moveForm( "comment-423200", "423200", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
<ul class="children">
<li class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2" id="comment-423231">
<div class="comment-container" id="li-comment-423231">
<div class="avatar"><img alt="" class="avatar avatar-40 photo" height="40" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" width="40"/></div>
<div class="comment-head">
<span class="name"><a class="url" href="http://MachineLearningMastery.com" rel="external nofollow">Jason Brownlee</a></span>
<span class="date">December 15, 2017 at 3:32 pm</span>
<span class="perma"><a href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/#comment-423231" title="Direct link to this comment">#</a></span>
<span class="edit"></span>
</div><!-- /.comment-head -->
<div class="comment-entry">
<p>The post above shows how to prepare data.</p>
<p>Also, this post shows how to clean text:<br/>
<a href="https://machinelearningmastery.com/clean-text-machine-learning-python/" rel="nofollow">https://machinelearningmastery.com/clean-text-machine-learning-python/</a></p>
<div class="reply">
<a aria-label="Reply to Jason Brownlee" class="comment-reply-link" href="https://machinelearningmastery.com/develop-word-embedding-model-predicting-movie-review-sentiment/?replytocom=423231#respond" onclick='return addComment.moveForm( "comment-423231", "423231", "respond", "4401" )' rel="nofollow">Reply</a> </div><!-- /.reply -->
</div><!-- /comment-entry -->
</div><!-- /.comment-container -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
</div> <div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">Leave a Reply <small><a href="/develop-word-embedding-model-predicting-movie-review-sentiment/#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">Click here to cancel reply.</a></small></h3> <form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" class="comment-form" id="commentform" method="post">
<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea aria-required="true" cols="50" id="comment" maxlength="65525" name="comment" required="required" rows="10" tabindex="4"></textarea></p><p class="comment-form-author"><input aria-required="true" class="txt" id="author" name="author" size="30" tabindex="1" type="text" value=""/><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input aria-required="true" class="txt" id="email" name="email" size="30" tabindex="2" type="text" value=""/><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input class="txt" id="url" name="url" size="30" tabindex="3" type="text" value=""/><label for="url">Website</label></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="Submit Comment"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="4401"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" type="hidden" value="b08df5811e"/></p><p style="display: none;"><input id="ak_js" name="ak_js" type="hidden" value="2"/></p> </form>
</div><!-- #respond -->
</section><!-- /#main -->
<aside id="sidebar">
<div class="widget widget_woo_blogauthorinfo" id="woo_blogauthorinfo-2"><h3>Welcome to Machine Learning Mastery</h3><span class="left"><img alt="" class="avatar avatar-100 photo" height="100" src="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=100&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" width="100"/></span>
<p>Hi, I'm Dr. Jason Brownlee.
<br/>
My goal is to make practitioners like YOU awesome at applied machine learning.</p>
<p><a href="/about">Read More</a></p>
<div class="fix"></div>
</div><div class="widget widget_text" id="text-43"> <div class="textwidget"><p></p><center>
<h3>Deep Learning for Text Data</h3>
<p>Cut through the math and research papers.<br/>
Discover Word Embeddings, Text Translation and more.</p>
<p><a href="/deep-learning-for-nlp/">Get Started With Deep Learning for NLP Today!</a><br/>
<a href="/deep-learning-for-nlp/"><img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/11/DLFNLP-Cover-220.png"/></a><br/>
</p></center>
</div>
</div>
<div class="widget widget_woo_tabs" id="woo_tabs-2"> <div id="tabs">
<ul class="wooTabs">
<li class="popular"><a href="#tab-pop">Popular</a></li> </ul>
<div class="clear"></div>
<div class="boxes box inside">
<ul class="list" id="tab-pop">
<li>
<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step"><img alt="Your First Machine Learning Project in Python Step-By-Step" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Your-First-Machine-Learning-Project-in-Python-Step-By-Step-150x150.jpg" title="Your First Machine Learning Project in Python Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/" title="Your First Machine Learning Project in Python Step-By-Step">Your First Machine Learning Project in Python Step-By-Step</a>
<span class="meta">June 10, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Time-Series-Prediction-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-prediction-lstm-recurrent-neural-networks-python-keras/" title="Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras">Time Series Prediction with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 21, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras"><img alt="Line Plots of Air Pollution Time Series" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/Line-Plots-of-Air-Pollution-Time-Series-150x150.png" title="Multivariate Time Series Forecasting with LSTMs in Keras" width="45"/></a> <a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" title="Multivariate Time Series Forecasting with LSTMs in Keras">Multivariate Time Series Forecasting with LSTMs in Keras</a>
<span class="meta">August 14, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step"><img alt="Tour of Deep Learning Algorithms" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/04/Tour-of-Deep-Learning-Algorithms-150x150.jpg" title="Develop Your First Neural Network in Python With Keras Step-By-Step" width="45"/></a> <a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" title="Develop Your First Neural Network in Python With Keras Step-By-Step">Develop Your First Neural Network in Python With Keras Step-By-Step</a>
<span class="meta">May 24, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda"><img alt="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/03/How-to-Setup-a-Python-Environment-for-Machine-Learning-and-Deep-Learning-with-Anaconda-150x150.png" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda" width="45"/></a> <a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/" title="How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda">How to Setup a Python Environment for Machine Learning and Deep Learning with Anaconda</a>
<span class="meta">March 13, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras"><img alt="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/07/Sequence-Classification-with-LSTM-Recurrent-Neural-Networks-in-Python-with-Keras-150x150.jpg" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras" width="45"/></a> <a href="https://machinelearningmastery.com/sequence-classification-lstm-recurrent-neural-networks-python-keras/" title="Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras">Sequence Classification with LSTM Recurrent Neural Networks in Python with Keras</a>
<span class="meta">July 26, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python"><img alt="Time Series Forecasting with the Long Short-Term Memory Network in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2017/04/Time-Series-Forecasting-with-the-Long-Short-Term-Memory-Network-in-Python-150x150.jpg" title="Time Series Forecasting with the Long Short-Term Memory Network in Python" width="45"/></a> <a href="https://machinelearningmastery.com/time-series-forecasting-long-short-term-memory-network-python/" title="Time Series Forecasting with the Long Short-Term Memory Network in Python">Time Series Forecasting with the Long Short-Term Memory Network in Python</a>
<span class="meta">April 7, 2017</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library"><img alt="Multi-Class Classification Tutorial with the Keras Deep Learning Library" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Multi-Class-Classification-Tutorial-with-the-Keras-Deep-Learning-Library-150x150.jpg" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library" width="45"/></a> <a href="https://machinelearningmastery.com/multi-class-classification-tutorial-keras-deep-learning-library/" title="Multi-Class Classification Tutorial with the Keras Deep Learning Library">Multi-Class Classification Tutorial with the Keras Deep Learning Library</a>
<span class="meta">June 2, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python"><img alt="Regression Tutorial with Keras Deep Learning Library in Python" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/06/Regression-Tutorial-with-Keras-Deep-Learning-Library-in-Python-150x150.jpg" title="Regression Tutorial with the Keras Deep Learning Library in Python" width="45"/></a> <a href="https://machinelearningmastery.com/regression-tutorial-keras-deep-learning-library-python/" title="Regression Tutorial with the Keras Deep Learning Library in Python">Regression Tutorial with the Keras Deep Learning Library in Python</a>
<span class="meta">June 9, 2016</span>
<div class="fix"></div>
</li>
<li>
<a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras"><img alt="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" class="thumbnail wp-post-image" height="45" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/How-to-Grid-Search-Hyperparameters-for-Deep-Learning-Models-in-Python-With-Keras-150x150.jpg" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras" width="45"/></a> <a href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" title="How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras">How to Grid Search Hyperparameters for Deep Learning Models in Python With Keras</a>
<span class="meta">August 9, 2016</span>
<div class="fix"></div>
</li>
</ul>
</div><!-- /.boxes -->
</div><!-- /wooTabs -->
</div> </aside><!-- /#sidebar -->
</div><!-- /#main-sidebar-container -->
</div><!-- /#content -->
<footer class="col-full" id="footer">
<div class="col-left" id="copyright">
<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p> </div>
<div class="col-right" id="credit">
<p></p><p>
<a href="/privacy/">Privacy</a> | 
<a href="/contact/">Contact</a> |
<a href="/about/">About</a>
</p> </div>
</footer>
</div><!-- /#inner-wrapper -->
</div><!-- /#wrapper -->
<div class="fix"></div><!--/.fix-->
<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9556588';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/comment-reply.min.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.9.2" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
var frontend_ajax_object = {"ajax_url":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","ajax_nonce":"555b70787c"};
/* ]]> */
</script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/seo-optimized-share-buttons/js/frontend.js?ver=4.2.2.0.iis7_supports_permalinks" type="text/javascript"></script>
<script src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/js/wp-embed.min.js?ver=4.9.2" type="text/javascript"></script>
<script async="async" src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/plugins/akismet/_inc/form.js?ver=4.0.2" type="text/javascript"></script>
</body>
</html>